/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.96
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */

var CesiumExternal=(()=>{var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty;var __commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __export=(target,all2)=>{for(var name in all2)__defProp(target,name,{get:all2[name],enumerable:!0})},__copyProps=(to,from,except,desc)=>{if(from&&typeof from=="object"||typeof from=="function")for(let key of __getOwnPropNames(from))!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:!0}):target,mod)),__toCommonJS=mod=>__copyProps(__defProp({},"__esModule",{value:!0}),mod);var require_punycode=__commonJS({"node_modules/urijs/src/punycode.js"(exports,module){/*! https://mths.be/punycode v1.4.0 by @mathias */(function(root){var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports,freeModule=typeof module=="object"&&module&&!module.nodeType&&module,freeGlobal=typeof global=="object"&&global;(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal)&&(root=freeGlobal);var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor2=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw new RangeError(errors[type])}function map6(array,fn){for(var length3=array.length,result=[];length3--;)result[length3]=fn(array[length3]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";parts.length>1&&(result=parts[0]+"@",string=parts[1]),string=string.replace(regexSeparators,".");var labels=string.split("."),encoded=map6(labels,fn).join(".");return result+encoded}function ucs2decode(string){for(var output=[],counter=0,length3=string.length,value,extra;counter<length3;)value=string.charCodeAt(counter++),value>=55296&&value<=56319&&counter<length3?(extra=string.charCodeAt(counter++),(extra&64512)==56320?output.push(((value&1023)<<10)+(extra&1023)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){return map6(array,function(value){var output="";return value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|value&1023),output+=stringFromCharCode(value),output}).join("")}function basicToDigit(codePoint){return codePoint-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta2,numPoints,firstTime){var k=0;for(delta2=firstTime?floor2(delta2/damp):delta2>>1,delta2+=floor2(delta2/numPoints);delta2>baseMinusTMin*tMax>>1;k+=base)delta2=floor2(delta2/baseMinusTMin);return floor2(k+(baseMinusTMin+1)*delta2/(delta2+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;for(basic=input.lastIndexOf(delimiter),basic<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;index>=inputLength&&error("invalid-input"),digit=basicToDigit(input.charCodeAt(index++)),(digit>=base||digit>floor2((maxInt-i)/w))&&error("overflow"),i+=digit*w,t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias,!(digit<t);k+=base)baseMinusT=base-t,w>floor2(maxInt/baseMinusT)&&error("overflow"),w*=baseMinusT;out=output.length+1,bias=adapt(i-oldi,out,oldi==0),floor2(i/out)>maxInt-n&&error("overflow"),n+=floor2(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta2,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;for(input=ucs2decode(input),inputLength=input.length,n=initialN,delta2=0,bias=initialBias,j=0;j<inputLength;++j)currentValue=input[j],currentValue<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)currentValue=input[j],currentValue>=n&&currentValue<m&&(m=currentValue);for(handledCPCountPlusOne=handledCPCount+1,m-n>floor2((maxInt-delta2)/handledCPCountPlusOne)&&error("overflow"),delta2+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if(currentValue=input[j],currentValue<n&&++delta2>maxInt&&error("overflow"),currentValue==n){for(q=delta2,k=base;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias,!(q<t);k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor2(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta2,handledCPCountPlusOne,handledCPCount==basicLength),delta2=0,++handledCPCount}++delta2,++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}if(punycode={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode,encode,toASCII,toUnicode},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return punycode});else if(freeExports&&freeModule)if(module.exports==freeExports)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode})(exports)}});var require_IPv6=__commonJS({"node_modules/urijs/src/IPv6.js"(exports,module){/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(root,factory){"use strict";typeof module=="object"&&module.exports?module.exports=factory():typeof define=="function"&&define.amd?define(factory):root.IPv6=factory(root)})(exports,function(root){"use strict";var _IPv6=root&&root.IPv6;function bestPresentation(address){var _address=address.toLowerCase(),segments=_address.split(":"),length3=segments.length,total=8;segments[0]===""&&segments[1]===""&&segments[2]===""?(segments.shift(),segments.shift()):segments[0]===""&&segments[1]===""?segments.shift():segments[length3-1]===""&&segments[length3-2]===""&&segments.pop(),length3=segments.length,segments[length3-1].indexOf(".")!==-1&&(total=7);var pos;for(pos=0;pos<length3&&segments[pos]!=="";pos++);if(pos<total)for(segments.splice(pos,1,"0000");segments.length<total;)segments.splice(pos,0,"0000");for(var _segments,i=0;i<total;i++){_segments=segments[i].split("");for(var j=0;j<3&&(_segments[0]==="0"&&_segments.length>1);j++)_segments.splice(0,1);segments[i]=_segments.join("")}var best=-1,_best=0,_current=0,current=-1,inzeroes=!1;for(i=0;i<total;i++)inzeroes?segments[i]==="0"?_current+=1:(inzeroes=!1,_current>_best&&(best=current,_best=_current)):segments[i]==="0"&&(inzeroes=!0,current=i,_current=1);_current>_best&&(best=current,_best=_current),_best>1&&segments.splice(best,_best,""),length3=segments.length;var result="";for(segments[0]===""&&(result=":"),i=0;i<length3&&(result+=segments[i],i!==length3-1);i++)result+=":";return segments[length3-1]===""&&(result+=":"),result}function noConflict(){return root.IPv6===this&&(root.IPv6=_IPv6),this}return{best:bestPresentation,noConflict}})}});var require_SecondLevelDomains=__commonJS({"node_modules/urijs/src/SecondLevelDomains.js"(exports,module){/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(root,factory){"use strict";typeof module=="object"&&module.exports?module.exports=factory():typeof define=="function"&&define.amd?define(factory):root.SecondLevelDomains=factory(root)})(exports,function(root){"use strict";var _SecondLevelDomains=root&&root.SecondLevelDomains,SLD={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(domain){var tldOffset=domain.lastIndexOf(".");if(tldOffset<=0||tldOffset>=domain.length-1)return!1;var sldOffset=domain.lastIndexOf(".",tldOffset-1);if(sldOffset<=0||sldOffset>=tldOffset-1)return!1;var sldList=SLD.list[domain.slice(tldOffset+1)];return sldList?sldList.indexOf(" "+domain.slice(sldOffset+1,tldOffset)+" ")>=0:!1},is:function(domain){var tldOffset=domain.lastIndexOf(".");if(tldOffset<=0||tldOffset>=domain.length-1)return!1;var sldOffset=domain.lastIndexOf(".",tldOffset-1);if(sldOffset>=0)return!1;var sldList=SLD.list[domain.slice(tldOffset+1)];return sldList?sldList.indexOf(" "+domain.slice(0,tldOffset)+" ")>=0:!1},get:function(domain){var tldOffset=domain.lastIndexOf(".");if(tldOffset<=0||tldOffset>=domain.length-1)return null;var sldOffset=domain.lastIndexOf(".",tldOffset-1);if(sldOffset<=0||sldOffset>=tldOffset-1)return null;var sldList=SLD.list[domain.slice(tldOffset+1)];return!sldList||sldList.indexOf(" "+domain.slice(sldOffset+1,tldOffset)+" ")<0?null:domain.slice(sldOffset+1)},noConflict:function(){return root.SecondLevelDomains===this&&(root.SecondLevelDomains=_SecondLevelDomains),this}};return SLD})}});var require_URI=__commonJS({"node_modules/urijs/src/URI.js"(exports,module){/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(root,factory){"use strict";typeof module=="object"&&module.exports?module.exports=factory(require_punycode(),require_IPv6(),require_SecondLevelDomains()):typeof define=="function"&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],factory):root.URI=factory(root.punycode,root.IPv6,root.SecondLevelDomains,root)})(exports,function(punycode,IPv6,SLD,root){"use strict";var _URI=root&&root.URI;function URI(url,base){var _urlSupplied=arguments.length>=1,_baseSupplied=arguments.length>=2;if(!(this instanceof URI))return _urlSupplied?_baseSupplied?new URI(url,base):new URI(url):new URI;if(url===void 0){if(_urlSupplied)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?url=location.href+"":url=""}if(url===null&&_urlSupplied)throw new TypeError("null is not a valid argument for URI");return this.href(url),base!==void 0?this.absoluteTo(base):this}function isInteger(value){return/^[0-9]+$/.test(value)}URI.version="1.19.11";var p=URI.prototype,hasOwn=Object.prototype.hasOwnProperty;function escapeRegEx(string){return string.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function getType3(value){return value===void 0?"Undefined":String(Object.prototype.toString.call(value)).slice(8,-1)}function isArray2(obj){return getType3(obj)==="Array"}function filterArrayValues(data,value){var lookup={},i,length3;if(getType3(value)==="RegExp")lookup=null;else if(isArray2(value))for(i=0,length3=value.length;i<length3;i++)lookup[value[i]]=!0;else lookup[value]=!0;for(i=0,length3=data.length;i<length3;i++){var _match=lookup&&lookup[data[i]]!==void 0||!lookup&&value.test(data[i]);_match&&(data.splice(i,1),length3--,i--)}return data}function arrayContains(list,value){var i,length3;if(isArray2(value)){for(i=0,length3=value.length;i<length3;i++)if(!arrayContains(list,value[i]))return!1;return!0}var _type=getType3(value);for(i=0,length3=list.length;i<length3;i++)if(_type==="RegExp"){if(typeof list[i]=="string"&&list[i].match(value))return!0}else if(list[i]===value)return!0;return!1}function arraysEqual(one,two){if(!isArray2(one)||!isArray2(two)||one.length!==two.length)return!1;one.sort(),two.sort();for(var i=0,l=one.length;i<l;i++)if(one[i]!==two[i])return!1;return!0}function trimSlashes(text){var trim_expression=/^\/+|\/+$/g;return text.replace(trim_expression,"")}URI._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:URI.preventInvalidHostname,duplicateQueryParameters:URI.duplicateQueryParameters,escapeQuerySpace:URI.escapeQuerySpace}},URI.preventInvalidHostname=!1,URI.duplicateQueryParameters=!1,URI.escapeQuerySpace=!0,URI.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,URI.idn_expression=/[^a-z0-9\._-]/i,URI.punycode_expression=/(xn--)/i,URI.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,URI.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,URI.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,URI.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},URI.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,URI.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,URI.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},URI.hostProtocols=["http","https"],URI.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,URI.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},URI.getDomAttribute=function(node){if(!(!node||!node.nodeName)){var nodeName=node.nodeName.toLowerCase();if(!(nodeName==="input"&&node.type!=="image"))return URI.domAttributes[nodeName]}};function escapeForDumbFirefox36(value){return escape(value)}function strictEncodeURIComponent(string){return encodeURIComponent(string).replace(/[!'()*]/g,escapeForDumbFirefox36).replace(/\*/g,"%2A")}URI.encode=strictEncodeURIComponent,URI.decode=decodeURIComponent,URI.iso8859=function(){URI.encode=escape,URI.decode=unescape},URI.unicode=function(){URI.encode=strictEncodeURIComponent,URI.decode=decodeURIComponent},URI.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},URI.encodeQuery=function(string,escapeQuerySpace){var escaped=URI.encode(string+"");return escapeQuerySpace===void 0&&(escapeQuerySpace=URI.escapeQuerySpace),escapeQuerySpace?escaped.replace(/%20/g,"+"):escaped},URI.decodeQuery=function(string,escapeQuerySpace){string+="",escapeQuerySpace===void 0&&(escapeQuerySpace=URI.escapeQuerySpace);try{return URI.decode(escapeQuerySpace?string.replace(/\+/g,"%20"):string)}catch{return string}};var _parts={encode:"encode",decode:"decode"},_part,generateAccessor=function(_group,_part2){return function(string){try{return URI[_part2](string+"").replace(URI.characters[_group][_part2].expression,function(c){return URI.characters[_group][_part2].map[c]})}catch{return string}}};for(_part in _parts)URI[_part+"PathSegment"]=generateAccessor("pathname",_parts[_part]),URI[_part+"UrnPathSegment"]=generateAccessor("urnpath",_parts[_part]);var generateSegmentedPathFunction=function(_sep,_codingFuncName,_innerCodingFuncName){return function(string){var actualCodingFunc;_innerCodingFuncName?actualCodingFunc=function(string2){return URI[_codingFuncName](URI[_innerCodingFuncName](string2))}:actualCodingFunc=URI[_codingFuncName];for(var segments=(string+"").split(_sep),i=0,length3=segments.length;i<length3;i++)segments[i]=actualCodingFunc(segments[i]);return segments.join(_sep)}};URI.decodePath=generateSegmentedPathFunction("/","decodePathSegment"),URI.decodeUrnPath=generateSegmentedPathFunction(":","decodeUrnPathSegment"),URI.recodePath=generateSegmentedPathFunction("/","encodePathSegment","decode"),URI.recodeUrnPath=generateSegmentedPathFunction(":","encodeUrnPathSegment","decode"),URI.encodeReserved=generateAccessor("reserved","encode"),URI.parse=function(string,parts){var pos;return parts||(parts={preventInvalidHostname:URI.preventInvalidHostname}),string=string.replace(URI.leading_whitespace_expression,""),string=string.replace(URI.ascii_tab_whitespace,""),pos=string.indexOf("#"),pos>-1&&(parts.fragment=string.substring(pos+1)||null,string=string.substring(0,pos)),pos=string.indexOf("?"),pos>-1&&(parts.query=string.substring(pos+1)||null,string=string.substring(0,pos)),string=string.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),string=string.replace(/^[/\\]{2,}/i,"//"),string.substring(0,2)==="//"?(parts.protocol=null,string=string.substring(2),string=URI.parseAuthority(string,parts)):(pos=string.indexOf(":"),pos>-1&&(parts.protocol=string.substring(0,pos)||null,parts.protocol&&!parts.protocol.match(URI.protocol_expression)?parts.protocol=void 0:string.substring(pos+1,pos+3).replace(/\\/g,"/")==="//"?(string=string.substring(pos+3),string=URI.parseAuthority(string,parts)):(string=string.substring(pos+1),parts.urn=!0))),parts.path=string,parts},URI.parseHost=function(string,parts){string||(string=""),string=string.replace(/\\/g,"/");var pos=string.indexOf("/"),bracketPos,t;if(pos===-1&&(pos=string.length),string.charAt(0)==="[")bracketPos=string.indexOf("]"),parts.hostname=string.substring(1,bracketPos)||null,parts.port=string.substring(bracketPos+2,pos)||null,parts.port==="/"&&(parts.port=null);else{var firstColon=string.indexOf(":"),firstSlash=string.indexOf("/"),nextColon=string.indexOf(":",firstColon+1);nextColon!==-1&&(firstSlash===-1||nextColon<firstSlash)?(parts.hostname=string.substring(0,pos)||null,parts.port=null):(t=string.substring(0,pos).split(":"),parts.hostname=t[0]||null,parts.port=t[1]||null)}return parts.hostname&&string.substring(pos).charAt(0)!=="/"&&(pos++,string="/"+string),parts.preventInvalidHostname&&URI.ensureValidHostname(parts.hostname,parts.protocol),parts.port&&URI.ensureValidPort(parts.port),string.substring(pos)||"/"},URI.parseAuthority=function(string,parts){return string=URI.parseUserinfo(string,parts),URI.parseHost(string,parts)},URI.parseUserinfo=function(string,parts){var _string=string,firstBackSlash=string.indexOf("\\");firstBackSlash!==-1&&(string=string.replace(/\\/g,"/"));var firstSlash=string.indexOf("/"),pos=string.lastIndexOf("@",firstSlash>-1?firstSlash:string.length-1),t;return pos>-1&&(firstSlash===-1||pos<firstSlash)?(t=string.substring(0,pos).split(":"),parts.username=t[0]?URI.decode(t[0]):null,t.shift(),parts.password=t[0]?URI.decode(t.join(":")):null,string=_string.substring(pos+1)):(parts.username=null,parts.password=null),string},URI.parseQuery=function(string,escapeQuerySpace){if(!string)return{};if(string=string.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!string)return{};for(var items={},splits=string.split("&"),length3=splits.length,v,name,value,i=0;i<length3;i++)v=splits[i].split("="),name=URI.decodeQuery(v.shift(),escapeQuerySpace),value=v.length?URI.decodeQuery(v.join("="),escapeQuerySpace):null,name!=="__proto__"&&(hasOwn.call(items,name)?((typeof items[name]=="string"||items[name]===null)&&(items[name]=[items[name]]),items[name].push(value)):items[name]=value);return items},URI.build=function(parts){var t="",requireAbsolutePath=!1;return parts.protocol&&(t+=parts.protocol+":"),!parts.urn&&(t||parts.hostname)&&(t+="//",requireAbsolutePath=!0),t+=URI.buildAuthority(parts)||"",typeof parts.path=="string"&&(parts.path.charAt(0)!=="/"&&requireAbsolutePath&&(t+="/"),t+=parts.path),typeof parts.query=="string"&&parts.query&&(t+="?"+parts.query),typeof parts.fragment=="string"&&parts.fragment&&(t+="#"+parts.fragment),t},URI.buildHost=function(parts){var t="";if(parts.hostname)URI.ip6_expression.test(parts.hostname)?t+="["+parts.hostname+"]":t+=parts.hostname;else return"";return parts.port&&(t+=":"+parts.port),t},URI.buildAuthority=function(parts){return URI.buildUserinfo(parts)+URI.buildHost(parts)},URI.buildUserinfo=function(parts){var t="";return parts.username&&(t+=URI.encode(parts.username)),parts.password&&(t+=":"+URI.encode(parts.password)),t&&(t+="@"),t},URI.buildQuery=function(data,duplicateQueryParameters,escapeQuerySpace){var t="",unique,key,i,length3;for(key in data)if(key!=="__proto__"&&hasOwn.call(data,key))if(isArray2(data[key]))for(unique={},i=0,length3=data[key].length;i<length3;i++)data[key][i]!==void 0&&unique[data[key][i]+""]===void 0&&(t+="&"+URI.buildQueryParameter(key,data[key][i],escapeQuerySpace),duplicateQueryParameters!==!0&&(unique[data[key][i]+""]=!0));else data[key]!==void 0&&(t+="&"+URI.buildQueryParameter(key,data[key],escapeQuerySpace));return t.substring(1)},URI.buildQueryParameter=function(name,value,escapeQuerySpace){return URI.encodeQuery(name,escapeQuerySpace)+(value!==null?"="+URI.encodeQuery(value,escapeQuerySpace):"")},URI.addQuery=function(data,name,value){if(typeof name=="object")for(var key in name)hasOwn.call(name,key)&&URI.addQuery(data,key,name[key]);else if(typeof name=="string"){if(data[name]===void 0){data[name]=value;return}else typeof data[name]=="string"&&(data[name]=[data[name]]);isArray2(value)||(value=[value]),data[name]=(data[name]||[]).concat(value)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},URI.setQuery=function(data,name,value){if(typeof name=="object")for(var key in name)hasOwn.call(name,key)&&URI.setQuery(data,key,name[key]);else if(typeof name=="string")data[name]=value===void 0?null:value;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},URI.removeQuery=function(data,name,value){var i,length3,key;if(isArray2(name))for(i=0,length3=name.length;i<length3;i++)data[name[i]]=void 0;else if(getType3(name)==="RegExp")for(key in data)name.test(key)&&(data[key]=void 0);else if(typeof name=="object")for(key in name)hasOwn.call(name,key)&&URI.removeQuery(data,key,name[key]);else if(typeof name=="string")value!==void 0?getType3(value)==="RegExp"?!isArray2(data[name])&&value.test(data[name])?data[name]=void 0:data[name]=filterArrayValues(data[name],value):data[name]===String(value)&&(!isArray2(value)||value.length===1)?data[name]=void 0:isArray2(data[name])&&(data[name]=filterArrayValues(data[name],value)):data[name]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},URI.hasQuery=function(data,name,value,withinArray){switch(getType3(name)){case"String":break;case"RegExp":for(var key in data)if(hasOwn.call(data,key)&&name.test(key)&&(value===void 0||URI.hasQuery(data,key,value)))return!0;return!1;case"Object":for(var _key in name)if(hasOwn.call(name,_key)&&!URI.hasQuery(data,_key,name[_key]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(getType3(value)){case"Undefined":return name in data;case"Boolean":var _booly=Boolean(isArray2(data[name])?data[name].length:data[name]);return value===_booly;case"Function":return!!value(data[name],name,data);case"Array":if(!isArray2(data[name]))return!1;var op=withinArray?arrayContains:arraysEqual;return op(data[name],value);case"RegExp":return isArray2(data[name])?withinArray?arrayContains(data[name],value):!1:Boolean(data[name]&&data[name].match(value));case"Number":value=String(value);case"String":return isArray2(data[name])?withinArray?arrayContains(data[name],value):!1:data[name]===value;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},URI.joinPaths=function(){for(var input=[],segments=[],nonEmptySegments=0,i=0;i<arguments.length;i++){var url=new URI(arguments[i]);input.push(url);for(var _segments=url.segment(),s=0;s<_segments.length;s++)typeof _segments[s]=="string"&&segments.push(_segments[s]),_segments[s]&&nonEmptySegments++}if(!segments.length||!nonEmptySegments)return new URI("");var uri=new URI("").segment(segments);return(input[0].path()===""||input[0].path().slice(0,1)==="/")&&uri.path("/"+uri.path()),uri.normalize()},URI.commonPath=function(one,two){var length3=Math.min(one.length,two.length),pos;for(pos=0;pos<length3;pos++)if(one.charAt(pos)!==two.charAt(pos)){pos--;break}return pos<1?one.charAt(0)===two.charAt(0)&&one.charAt(0)==="/"?"/":"":((one.charAt(pos)!=="/"||two.charAt(pos)!=="/")&&(pos=one.substring(0,pos).lastIndexOf("/")),one.substring(0,pos+1))},URI.withinString=function(string,callback,options){options||(options={});var _start=options.start||URI.findUri.start,_end=options.end||URI.findUri.end,_trim=options.trim||URI.findUri.trim,_parens=options.parens||URI.findUri.parens,_attributeOpen=/[a-z0-9-]=["']?$/i;for(_start.lastIndex=0;;){var match=_start.exec(string);if(!match)break;var start2=match.index;if(options.ignoreHtml){var attributeOpen=string.slice(Math.max(start2-3,0),start2);if(attributeOpen&&_attributeOpen.test(attributeOpen))continue}for(var end=start2+string.slice(start2).search(_end),slice2=string.slice(start2,end),parensEnd=-1;;){var parensMatch=_parens.exec(slice2);if(!parensMatch)break;var parensMatchEnd=parensMatch.index+parensMatch[0].length;parensEnd=Math.max(parensEnd,parensMatchEnd)}if(parensEnd>-1?slice2=slice2.slice(0,parensEnd)+slice2.slice(parensEnd).replace(_trim,""):slice2=slice2.replace(_trim,""),!(slice2.length<=match[0].length)&&!(options.ignore&&options.ignore.test(slice2))){end=start2+slice2.length;var result=callback(slice2,start2,end,string);if(result===void 0){_start.lastIndex=end;continue}result=String(result),string=string.slice(0,start2)+result+string.slice(end),_start.lastIndex=start2+result.length}}return _start.lastIndex=0,string},URI.ensureValidHostname=function(v,protocol){var hasHostname=!!v,hasProtocol=!!protocol,rejectEmptyHostname=!1;if(hasProtocol&&(rejectEmptyHostname=arrayContains(URI.hostProtocols,protocol)),rejectEmptyHostname&&!hasHostname)throw new TypeError("Hostname cannot be empty, if protocol is "+protocol);if(v&&v.match(URI.invalid_hostname_characters)){if(!punycode)throw new TypeError('Hostname "'+v+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(punycode.toASCII(v).match(URI.invalid_hostname_characters))throw new TypeError('Hostname "'+v+'" contains characters other than [A-Z0-9.-:_]')}},URI.ensureValidPort=function(v){if(!!v){var port=Number(v);if(!(isInteger(port)&&port>0&&port<65536))throw new TypeError('Port "'+v+'" is not a valid port')}},URI.noConflict=function(removeAll){if(removeAll){var unconflicted={URI:this.noConflict()};return root.URITemplate&&typeof root.URITemplate.noConflict=="function"&&(unconflicted.URITemplate=root.URITemplate.noConflict()),root.IPv6&&typeof root.IPv6.noConflict=="function"&&(unconflicted.IPv6=root.IPv6.noConflict()),root.SecondLevelDomains&&typeof root.SecondLevelDomains.noConflict=="function"&&(unconflicted.SecondLevelDomains=root.SecondLevelDomains.noConflict()),unconflicted}else root.URI===this&&(root.URI=_URI);return this},p.build=function(deferBuild){return deferBuild===!0?this._deferred_build=!0:(deferBuild===void 0||this._deferred_build)&&(this._string=URI.build(this._parts),this._deferred_build=!1),this},p.clone=function(){return new URI(this)},p.valueOf=p.toString=function(){return this.build(!1)._string};function generateSimpleAccessor(_part2){return function(v,build4){return v===void 0?this._parts[_part2]||"":(this._parts[_part2]=v||null,this.build(!build4),this)}}function generatePrefixAccessor(_part2,_key){return function(v,build4){return v===void 0?this._parts[_part2]||"":(v!==null&&(v=v+"",v.charAt(0)===_key&&(v=v.substring(1))),this._parts[_part2]=v,this.build(!build4),this)}}p.protocol=generateSimpleAccessor("protocol"),p.username=generateSimpleAccessor("username"),p.password=generateSimpleAccessor("password"),p.hostname=generateSimpleAccessor("hostname"),p.port=generateSimpleAccessor("port"),p.query=generatePrefixAccessor("query","?"),p.fragment=generatePrefixAccessor("fragment","#"),p.search=function(v,build4){var t=this.query(v,build4);return typeof t=="string"&&t.length?"?"+t:t},p.hash=function(v,build4){var t=this.fragment(v,build4);return typeof t=="string"&&t.length?"#"+t:t},p.pathname=function(v,build4){if(v===void 0||v===!0){var res=this._parts.path||(this._parts.hostname?"/":"");return v?(this._parts.urn?URI.decodeUrnPath:URI.decodePath)(res):res}else return this._parts.urn?this._parts.path=v?URI.recodeUrnPath(v):"":this._parts.path=v?URI.recodePath(v):"/",this.build(!build4),this},p.path=p.pathname,p.href=function(href,build4){var key;if(href===void 0)return this.toString();this._string="",this._parts=URI._parts();var _URI2=href instanceof URI,_object=typeof href=="object"&&(href.hostname||href.path||href.pathname);if(href.nodeName){var attribute=URI.getDomAttribute(href);href=href[attribute]||"",_object=!1}if(!_URI2&&_object&&href.pathname!==void 0&&(href=href.toString()),typeof href=="string"||href instanceof String)this._parts=URI.parse(String(href),this._parts);else if(_URI2||_object){var src=_URI2?href._parts:href;for(key in src)key!=="query"&&hasOwn.call(this._parts,key)&&(this._parts[key]=src[key]);src.query&&this.query(src.query,!1)}else throw new TypeError("invalid input");return this.build(!build4),this},p.is=function(what){var ip=!1,ip4=!1,ip6=!1,name=!1,sld=!1,idn=!1,punycode2=!1,relative=!this._parts.urn;switch(this._parts.hostname&&(relative=!1,ip4=URI.ip4_expression.test(this._parts.hostname),ip6=URI.ip6_expression.test(this._parts.hostname),ip=ip4||ip6,name=!ip,sld=name&&SLD&&SLD.has(this._parts.hostname),idn=name&&URI.idn_expression.test(this._parts.hostname),punycode2=name&&URI.punycode_expression.test(this._parts.hostname)),what.toLowerCase()){case"relative":return relative;case"absolute":return!relative;case"domain":case"name":return name;case"sld":return sld;case"ip":return ip;case"ip4":case"ipv4":case"inet4":return ip4;case"ip6":case"ipv6":case"inet6":return ip6;case"idn":return idn;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return punycode2}return null};var _protocol=p.protocol,_port=p.port,_hostname=p.hostname;p.protocol=function(v,build4){if(v&&(v=v.replace(/:(\/\/)?$/,""),!v.match(URI.protocol_expression)))throw new TypeError('Protocol "'+v+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return _protocol.call(this,v,build4)},p.scheme=p.protocol,p.port=function(v,build4){return this._parts.urn?v===void 0?"":this:(v!==void 0&&(v===0&&(v=null),v&&(v+="",v.charAt(0)===":"&&(v=v.substring(1)),URI.ensureValidPort(v))),_port.call(this,v,build4))},p.hostname=function(v,build4){if(this._parts.urn)return v===void 0?"":this;if(v!==void 0){var x2={preventInvalidHostname:this._parts.preventInvalidHostname},res=URI.parseHost(v,x2);if(res!=="/")throw new TypeError('Hostname "'+v+'" contains characters other than [A-Z0-9.-]');v=x2.hostname,this._parts.preventInvalidHostname&&URI.ensureValidHostname(v,this._parts.protocol)}return _hostname.call(this,v,build4)},p.origin=function(v,build4){if(this._parts.urn)return v===void 0?"":this;if(v===void 0){var protocol=this.protocol(),authority=this.authority();return authority?(protocol?protocol+"://":"")+this.authority():""}else{var origin=URI(v);return this.protocol(origin.protocol()).authority(origin.authority()).build(!build4),this}},p.host=function(v,build4){if(this._parts.urn)return v===void 0?"":this;if(v===void 0)return this._parts.hostname?URI.buildHost(this._parts):"";var res=URI.parseHost(v,this._parts);if(res!=="/")throw new TypeError('Hostname "'+v+'" contains characters other than [A-Z0-9.-]');return this.build(!build4),this},p.authority=function(v,build4){if(this._parts.urn)return v===void 0?"":this;if(v===void 0)return this._parts.hostname?URI.buildAuthority(this._parts):"";var res=URI.parseAuthority(v,this._parts);if(res!=="/")throw new TypeError('Hostname "'+v+'" contains characters other than [A-Z0-9.-]');return this.build(!build4),this},p.userinfo=function(v,build4){if(this._parts.urn)return v===void 0?"":this;if(v===void 0){var t=URI.buildUserinfo(this._parts);return t&&t.substring(0,t.length-1)}else return v[v.length-1]!=="@"&&(v+="@"),URI.parseUserinfo(v,this._parts),this.build(!build4),this},p.resource=function(v,build4){var parts;return v===void 0?this.path()+this.search()+this.hash():(parts=URI.parse(v),this._parts.path=parts.path,this._parts.query=parts.query,this._parts.fragment=parts.fragment,this.build(!build4),this)},p.subdomain=function(v,build4){if(this._parts.urn)return v===void 0?"":this;if(v===void 0){if(!this._parts.hostname||this.is("IP"))return"";var end=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,end)||""}else{var e=this._parts.hostname.length-this.domain().length,sub2=this._parts.hostname.substring(0,e),replace=new RegExp("^"+escapeRegEx(sub2));if(v&&v.charAt(v.length-1)!=="."&&(v+="."),v.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return v&&URI.ensureValidHostname(v,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(replace,v),this.build(!build4),this}},p.domain=function(v,build4){if(this._parts.urn)return v===void 0?"":this;if(typeof v=="boolean"&&(build4=v,v=void 0),v===void 0){if(!this._parts.hostname||this.is("IP"))return"";var t=this._parts.hostname.match(/\./g);if(t&&t.length<2)return this._parts.hostname;var end=this._parts.hostname.length-this.tld(build4).length-1;return end=this._parts.hostname.lastIndexOf(".",end-1)+1,this._parts.hostname.substring(end)||""}else{if(!v)throw new TypeError("cannot set domain empty");if(v.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(URI.ensureValidHostname(v,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=v;else{var replace=new RegExp(escapeRegEx(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(replace,v)}return this.build(!build4),this}},p.tld=function(v,build4){if(this._parts.urn)return v===void 0?"":this;if(typeof v=="boolean"&&(build4=v,v=void 0),v===void 0){if(!this._parts.hostname||this.is("IP"))return"";var pos=this._parts.hostname.lastIndexOf("."),tld=this._parts.hostname.substring(pos+1);return build4!==!0&&SLD&&SLD.list[tld.toLowerCase()]&&SLD.get(this._parts.hostname)||tld}else{var replace;if(v)if(v.match(/[^a-zA-Z0-9-]/))if(SLD&&SLD.is(v))replace=new RegExp(escapeRegEx(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(replace,v);else throw new TypeError('TLD "'+v+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");replace=new RegExp(escapeRegEx(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(replace,v)}else throw new TypeError("cannot set TLD empty");return this.build(!build4),this}},p.directory=function(v,build4){if(this._parts.urn)return v===void 0?"":this;if(v===void 0||v===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var end=this._parts.path.length-this.filename().length-1,res=this._parts.path.substring(0,end)||(this._parts.hostname?"/":"");return v?URI.decodePath(res):res}else{var e=this._parts.path.length-this.filename().length,directory=this._parts.path.substring(0,e),replace=new RegExp("^"+escapeRegEx(directory));return this.is("relative")||(v||(v="/"),v.charAt(0)!=="/"&&(v="/"+v)),v&&v.charAt(v.length-1)!=="/"&&(v+="/"),v=URI.recodePath(v),this._parts.path=this._parts.path.replace(replace,v),this.build(!build4),this}},p.filename=function(v,build4){if(this._parts.urn)return v===void 0?"":this;if(typeof v!="string"){if(!this._parts.path||this._parts.path==="/")return"";var pos=this._parts.path.lastIndexOf("/"),res=this._parts.path.substring(pos+1);return v?URI.decodePathSegment(res):res}else{var mutatedDirectory=!1;v.charAt(0)==="/"&&(v=v.substring(1)),v.match(/\.?\//)&&(mutatedDirectory=!0);var replace=new RegExp(escapeRegEx(this.filename())+"$");return v=URI.recodePath(v),this._parts.path=this._parts.path.replace(replace,v),mutatedDirectory?this.normalizePath(build4):this.build(!build4),this}},p.suffix=function(v,build4){if(this._parts.urn)return v===void 0?"":this;if(v===void 0||v===!0){if(!this._parts.path||this._parts.path==="/")return"";var filename=this.filename(),pos=filename.lastIndexOf("."),s,res;return pos===-1?"":(s=filename.substring(pos+1),res=/^[a-z0-9%]+$/i.test(s)?s:"",v?URI.decodePathSegment(res):res)}else{v.charAt(0)==="."&&(v=v.substring(1));var suffix=this.suffix(),replace;if(suffix)v?replace=new RegExp(escapeRegEx(suffix)+"$"):replace=new RegExp(escapeRegEx("."+suffix)+"$");else{if(!v)return this;this._parts.path+="."+URI.recodePath(v)}return replace&&(v=URI.recodePath(v),this._parts.path=this._parts.path.replace(replace,v)),this.build(!build4),this}},p.segment=function(segment,v,build4){var separator=this._parts.urn?":":"/",path=this.path(),absolute=path.substring(0,1)==="/",segments=path.split(separator);if(segment!==void 0&&typeof segment!="number"&&(build4=v,v=segment,segment=void 0),segment!==void 0&&typeof segment!="number")throw new Error('Bad segment "'+segment+'", must be 0-based integer');if(absolute&&segments.shift(),segment<0&&(segment=Math.max(segments.length+segment,0)),v===void 0)return segment===void 0?segments:segments[segment];if(segment===null||segments[segment]===void 0)if(isArray2(v)){segments=[];for(var i=0,l=v.length;i<l;i++)!v[i].length&&(!segments.length||!segments[segments.length-1].length)||(segments.length&&!segments[segments.length-1].length&&segments.pop(),segments.push(trimSlashes(v[i])))}else(v||typeof v=="string")&&(v=trimSlashes(v),segments[segments.length-1]===""?segments[segments.length-1]=v:segments.push(v));else v?segments[segment]=trimSlashes(v):segments.splice(segment,1);return absolute&&segments.unshift(""),this.path(segments.join(separator),build4)},p.segmentCoded=function(segment,v,build4){var segments,i,l;if(typeof segment!="number"&&(build4=v,v=segment,segment=void 0),v===void 0){if(segments=this.segment(segment,v,build4),!isArray2(segments))segments=segments!==void 0?URI.decode(segments):void 0;else for(i=0,l=segments.length;i<l;i++)segments[i]=URI.decode(segments[i]);return segments}if(!isArray2(v))v=typeof v=="string"||v instanceof String?URI.encode(v):v;else for(i=0,l=v.length;i<l;i++)v[i]=URI.encode(v[i]);return this.segment(segment,v,build4)};var q=p.query;return p.query=function(v,build4){if(v===!0)return URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof v=="function"){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace),result=v.call(this,data);return this._parts.query=URI.buildQuery(result||data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!build4),this}else return v!==void 0&&typeof v!="string"?(this._parts.query=URI.buildQuery(v,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!build4),this):q.call(this,v,build4)},p.setQuery=function(name,value,build4){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof name=="string"||name instanceof String)data[name]=value!==void 0?value:null;else if(typeof name=="object")for(var key in name)hasOwn.call(name,key)&&(data[key]=name[key]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=URI.buildQuery(data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof name!="string"&&(build4=value),this.build(!build4),this},p.addQuery=function(name,value,build4){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return URI.addQuery(data,name,value===void 0?null:value),this._parts.query=URI.buildQuery(data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof name!="string"&&(build4=value),this.build(!build4),this},p.removeQuery=function(name,value,build4){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return URI.removeQuery(data,name,value),this._parts.query=URI.buildQuery(data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof name!="string"&&(build4=value),this.build(!build4),this},p.hasQuery=function(name,value,withinArray){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return URI.hasQuery(data,name,value,withinArray)},p.setSearch=p.setQuery,p.addSearch=p.addQuery,p.removeSearch=p.removeQuery,p.hasSearch=p.hasQuery,p.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},p.normalizeProtocol=function(build4){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!build4)),this},p.normalizeHostname=function(build4){return this._parts.hostname&&(this.is("IDN")&&punycode?this._parts.hostname=punycode.toASCII(this._parts.hostname):this.is("IPv6")&&IPv6&&(this._parts.hostname=IPv6.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!build4)),this},p.normalizePort=function(build4){return typeof this._parts.protocol=="string"&&this._parts.port===URI.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!build4)),this},p.normalizePath=function(build4){var _path=this._parts.path;if(!_path)return this;if(this._parts.urn)return this._parts.path=URI.recodeUrnPath(this._parts.path),this.build(!build4),this;if(this._parts.path==="/")return this;_path=URI.recodePath(_path);var _was_relative,_leadingParents="",_parent,_pos;for(_path.charAt(0)!=="/"&&(_was_relative=!0,_path="/"+_path),(_path.slice(-3)==="/.."||_path.slice(-2)==="/.")&&(_path+="/"),_path=_path.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),_was_relative&&(_leadingParents=_path.substring(1).match(/^(\.\.\/)+/)||"",_leadingParents&&(_leadingParents=_leadingParents[0]));_parent=_path.search(/\/\.\.(\/|$)/),_parent!==-1;){if(_parent===0){_path=_path.substring(3);continue}_pos=_path.substring(0,_parent).lastIndexOf("/"),_pos===-1&&(_pos=_parent),_path=_path.substring(0,_pos)+_path.substring(_parent+3)}return _was_relative&&this.is("relative")&&(_path=_leadingParents+_path.substring(1)),this._parts.path=_path,this.build(!build4),this},p.normalizePathname=p.normalizePath,p.normalizeQuery=function(build4){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!build4)),this},p.normalizeFragment=function(build4){return this._parts.fragment||(this._parts.fragment=null,this.build(!build4)),this},p.normalizeSearch=p.normalizeQuery,p.normalizeHash=p.normalizeFragment,p.iso8859=function(){var e=URI.encode,d=URI.decode;URI.encode=escape,URI.decode=decodeURIComponent;try{this.normalize()}finally{URI.encode=e,URI.decode=d}return this},p.unicode=function(){var e=URI.encode,d=URI.decode;URI.encode=strictEncodeURIComponent,URI.decode=unescape;try{this.normalize()}finally{URI.encode=e,URI.decode=d}return this},p.readable=function(){var uri=this.clone();uri.username("").password("").normalize();var t="";if(uri._parts.protocol&&(t+=uri._parts.protocol+"://"),uri._parts.hostname&&(uri.is("punycode")&&punycode?(t+=punycode.toUnicode(uri._parts.hostname),uri._parts.port&&(t+=":"+uri._parts.port)):t+=uri.host()),uri._parts.hostname&&uri._parts.path&&uri._parts.path.charAt(0)!=="/"&&(t+="/"),t+=uri.path(!0),uri._parts.query){for(var q2="",i=0,qp=uri._parts.query.split("&"),l=qp.length;i<l;i++){var kv=(qp[i]||"").split("=");q2+="&"+URI.decodeQuery(kv[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),kv[1]!==void 0&&(q2+="="+URI.decodeQuery(kv[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}t+="?"+q2.substring(1)}return t+=URI.decodeQuery(uri.hash(),!0),t},p.absoluteTo=function(base){var resolved=this.clone(),properties=["protocol","username","password","hostname","port"],basedir,i,p2;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(base instanceof URI||(base=new URI(base)),resolved._parts.protocol||(resolved._parts.protocol=base._parts.protocol,this._parts.hostname))return resolved;for(i=0;p2=properties[i];i++)resolved._parts[p2]=base._parts[p2];return resolved._parts.path?(resolved._parts.path.substring(-2)===".."&&(resolved._parts.path+="/"),resolved.path().charAt(0)!=="/"&&(basedir=base.directory(),basedir=basedir||(base.path().indexOf("/")===0?"/":""),resolved._parts.path=(basedir?basedir+"/":"")+resolved._parts.path,resolved.normalizePath())):(resolved._parts.path=base._parts.path,resolved._parts.query||(resolved._parts.query=base._parts.query)),resolved.build(),resolved},p.relativeTo=function(base){var relative=this.clone().normalize(),relativeParts,baseParts,common,relativePath,basePath;if(relative._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(base=new URI(base).normalize(),relativeParts=relative._parts,baseParts=base._parts,relativePath=relative.path(),basePath=base.path(),relativePath.charAt(0)!=="/")throw new Error("URI is already relative");if(basePath.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(relativeParts.protocol===baseParts.protocol&&(relativeParts.protocol=null),relativeParts.username!==baseParts.username||relativeParts.password!==baseParts.password||relativeParts.protocol!==null||relativeParts.username!==null||relativeParts.password!==null)return relative.build();if(relativeParts.hostname===baseParts.hostname&&relativeParts.port===baseParts.port)relativeParts.hostname=null,relativeParts.port=null;else return relative.build();if(relativePath===basePath)return relativeParts.path="",relative.build();if(common=URI.commonPath(relativePath,basePath),!common)return relative.build();var parents=baseParts.path.substring(common.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return relativeParts.path=parents+relativeParts.path.substring(common.length)||"./",relative.build()},p.equals=function(uri){var one=this.clone(),two=new URI(uri),one_map={},two_map={},checked={},one_query,two_query,key;if(one.normalize(),two.normalize(),one.toString()===two.toString())return!0;if(one_query=one.query(),two_query=two.query(),one.query(""),two.query(""),one.toString()!==two.toString()||one_query.length!==two_query.length)return!1;one_map=URI.parseQuery(one_query,this._parts.escapeQuerySpace),two_map=URI.parseQuery(two_query,this._parts.escapeQuerySpace);for(key in one_map)if(hasOwn.call(one_map,key)){if(isArray2(one_map[key])){if(!arraysEqual(one_map[key],two_map[key]))return!1}else if(one_map[key]!==two_map[key])return!1;checked[key]=!0}for(key in two_map)if(hasOwn.call(two_map,key)&&!checked[key])return!1;return!0},p.preventInvalidHostname=function(v){return this._parts.preventInvalidHostname=!!v,this},p.duplicateQueryParameters=function(v){return this._parts.duplicateQueryParameters=!!v,this},p.escapeQuerySpace=function(v){return this._parts.escapeQuerySpace=!!v,this},URI})}});var require_mersenne_twister=__commonJS({"node_modules/mersenne-twister/src/mersenne-twister.js"(exports,module){var MersenneTwister=function(seed){seed==null&&(seed=new Date().getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,seed.constructor==Array?this.init_by_array(seed,seed.length):this.init_seed(seed)};MersenneTwister.prototype.init_seed=function(s){for(this.mt[0]=s>>>0,this.mti=1;this.mti<this.N;this.mti++){var s=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((s&4294901760)>>>16)*1812433253<<16)+(s&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}};MersenneTwister.prototype.init_by_array=function(init_key,key_length){var i,j,k;for(this.init_seed(19650218),i=1,j=0,k=this.N>key_length?this.N:key_length;k;k--){var s=this.mt[i-1]^this.mt[i-1]>>>30;this.mt[i]=(this.mt[i]^(((s&4294901760)>>>16)*1664525<<16)+(s&65535)*1664525)+init_key[j]+j,this.mt[i]>>>=0,i++,j++,i>=this.N&&(this.mt[0]=this.mt[this.N-1],i=1),j>=key_length&&(j=0)}for(k=this.N-1;k;k--){var s=this.mt[i-1]^this.mt[i-1]>>>30;this.mt[i]=(this.mt[i]^(((s&4294901760)>>>16)*1566083941<<16)+(s&65535)*1566083941)-i,this.mt[i]>>>=0,i++,i>=this.N&&(this.mt[0]=this.mt[this.N-1],i=1)}this.mt[0]=2147483648};MersenneTwister.prototype.random_int=function(){var y2,mag01=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var kk;for(this.mti==this.N+1&&this.init_seed(5489),kk=0;kk<this.N-this.M;kk++)y2=this.mt[kk]&this.UPPER_MASK|this.mt[kk+1]&this.LOWER_MASK,this.mt[kk]=this.mt[kk+this.M]^y2>>>1^mag01[y2&1];for(;kk<this.N-1;kk++)y2=this.mt[kk]&this.UPPER_MASK|this.mt[kk+1]&this.LOWER_MASK,this.mt[kk]=this.mt[kk+(this.M-this.N)]^y2>>>1^mag01[y2&1];y2=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^y2>>>1^mag01[y2&1],this.mti=0}return y2=this.mt[this.mti++],y2^=y2>>>11,y2^=y2<<7&2636928640,y2^=y2<<15&4022730752,y2^=y2>>>18,y2>>>0};MersenneTwister.prototype.random_int31=function(){return this.random_int()>>>1};MersenneTwister.prototype.random_incl=function(){return this.random_int()*(1/4294967295)};MersenneTwister.prototype.random=function(){return this.random_int()*(1/4294967296)};MersenneTwister.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)};MersenneTwister.prototype.random_long=function(){var a=this.random_int()>>>5,b=this.random_int()>>>6;return(a*67108864+b)*(1/9007199254740992)};module.exports=MersenneTwister}});var require_jsep=__commonJS({"node_modules/jsep/build/jsep.js"(exports,module){(function(root){"use strict";var COMPOUND="Compound",IDENTIFIER="Identifier",MEMBER_EXP="MemberExpression",LITERAL="Literal",THIS_EXP="ThisExpression",CALL_EXP="CallExpression",UNARY_EXP="UnaryExpression",BINARY_EXP="BinaryExpression",LOGICAL_EXP="LogicalExpression",CONDITIONAL_EXP="ConditionalExpression",ARRAY_EXP="ArrayExpression",PERIOD_CODE=46,COMMA_CODE=44,SQUOTE_CODE=39,DQUOTE_CODE=34,OPAREN_CODE=40,CPAREN_CODE=41,OBRACK_CODE=91,CBRACK_CODE=93,QUMARK_CODE=63,SEMCOL_CODE=59,COLON_CODE=58,throwError=function(message,index){var error=new Error(message+" at character "+index);throw error.index=index,error.description=message,error},t=!0,unary_ops={"-":t,"!":t,"~":t,"+":t},binary_ops={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},getMaxKeyLen=function(obj){var max_len=0,len;for(var key in obj)(len=key.length)>max_len&&obj.hasOwnProperty(key)&&(max_len=len);return max_len},max_unop_len=getMaxKeyLen(unary_ops),max_binop_len=getMaxKeyLen(binary_ops),literals={true:!0,false:!1,null:null},this_str="this",binaryPrecedence=function(op_val){return binary_ops[op_val]||0},createBinaryExpression=function(operator,left,right){var type=operator==="||"||operator==="&&"?LOGICAL_EXP:BINARY_EXP;return{type,operator,left,right}},isDecimalDigit=function(ch){return ch>=48&&ch<=57},isIdentifierStart=function(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=128&&!binary_ops[String.fromCharCode(ch)]},isIdentifierPart=function(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||ch>=128&&!binary_ops[String.fromCharCode(ch)]},jsep=function(expr){for(var index=0,charAtFunc=expr.charAt,charCodeAtFunc=expr.charCodeAt,exprI=function(i){return charAtFunc.call(expr,i)},exprICode=function(i){return charCodeAtFunc.call(expr,i)},length3=expr.length,gobbleSpaces=function(){for(var ch=exprICode(index);ch===32||ch===9||ch===10||ch===13;)ch=exprICode(++index)},gobbleExpression=function(){var test=gobbleBinaryExpression(),consequent,alternate;if(gobbleSpaces(),exprICode(index)===QUMARK_CODE){if(index++,consequent=gobbleExpression(),consequent||throwError("Expected expression",index),gobbleSpaces(),exprICode(index)===COLON_CODE)return index++,alternate=gobbleExpression(),alternate||throwError("Expected expression",index),{type:CONDITIONAL_EXP,test,consequent,alternate};throwError("Expected :",index)}else return test},gobbleBinaryOp=function(){gobbleSpaces();for(var biop,to_check=expr.substr(index,max_binop_len),tc_len=to_check.length;tc_len>0;){if(binary_ops.hasOwnProperty(to_check)&&(!isIdentifierStart(exprICode(index))||index+to_check.length<expr.length&&!isIdentifierPart(exprICode(index+to_check.length))))return index+=tc_len,to_check;to_check=to_check.substr(0,--tc_len)}return!1},gobbleBinaryExpression=function(){var ch_i2,node2,biop,prec,stack,biop_info,left,right,i,cur_biop;if(left=gobbleToken(),biop=gobbleBinaryOp(),!biop)return left;for(biop_info={value:biop,prec:binaryPrecedence(biop)},right=gobbleToken(),right||throwError("Expected expression after "+biop,index),stack=[left,biop_info,right];(biop=gobbleBinaryOp())&&(prec=binaryPrecedence(biop),prec!==0);){for(biop_info={value:biop,prec},cur_biop=biop;stack.length>2&&prec<=stack[stack.length-2].prec;)right=stack.pop(),biop=stack.pop().value,left=stack.pop(),node2=createBinaryExpression(biop,left,right),stack.push(node2);node2=gobbleToken(),node2||throwError("Expected expression after "+cur_biop,index),stack.push(biop_info,node2)}for(i=stack.length-1,node2=stack[i];i>1;)node2=createBinaryExpression(stack[i-1].value,stack[i-2],node2),i-=2;return node2},gobbleToken=function(){var ch,to_check,tc_len;if(gobbleSpaces(),ch=exprICode(index),isDecimalDigit(ch)||ch===PERIOD_CODE)return gobbleNumericLiteral();if(ch===SQUOTE_CODE||ch===DQUOTE_CODE)return gobbleStringLiteral();if(ch===OBRACK_CODE)return gobbleArray();for(to_check=expr.substr(index,max_unop_len),tc_len=to_check.length;tc_len>0;){if(unary_ops.hasOwnProperty(to_check)&&(!isIdentifierStart(exprICode(index))||index+to_check.length<expr.length&&!isIdentifierPart(exprICode(index+to_check.length))))return index+=tc_len,{type:UNARY_EXP,operator:to_check,argument:gobbleToken(),prefix:!0};to_check=to_check.substr(0,--tc_len)}return isIdentifierStart(ch)||ch===OPAREN_CODE?gobbleVariable():!1},gobbleNumericLiteral=function(){for(var number="",ch,chCode;isDecimalDigit(exprICode(index));)number+=exprI(index++);if(exprICode(index)===PERIOD_CODE)for(number+=exprI(index++);isDecimalDigit(exprICode(index));)number+=exprI(index++);if(ch=exprI(index),ch==="e"||ch==="E"){for(number+=exprI(index++),ch=exprI(index),(ch==="+"||ch==="-")&&(number+=exprI(index++));isDecimalDigit(exprICode(index));)number+=exprI(index++);isDecimalDigit(exprICode(index-1))||throwError("Expected exponent ("+number+exprI(index)+")",index)}return chCode=exprICode(index),isIdentifierStart(chCode)?throwError("Variable names cannot start with a number ("+number+exprI(index)+")",index):chCode===PERIOD_CODE&&throwError("Unexpected period",index),{type:LITERAL,value:parseFloat(number),raw:number}},gobbleStringLiteral=function(){for(var str="",quote=exprI(index++),closed=!1,ch;index<length3;)if(ch=exprI(index++),ch===quote){closed=!0;break}else if(ch==="\\")switch(ch=exprI(index++),ch){case"n":str+=`
`;break;case"r":str+="\r";break;case"t":str+="	";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="\v";break;default:str+=ch}else str+=ch;return closed||throwError('Unclosed quote after "'+str+'"',index),{type:LITERAL,value:str,raw:quote+str+quote}},gobbleIdentifier=function(){var ch=exprICode(index),start2=index,identifier;for(isIdentifierStart(ch)?index++:throwError("Unexpected "+exprI(index),index);index<length3&&(ch=exprICode(index),isIdentifierPart(ch));)index++;return identifier=expr.slice(start2,index),literals.hasOwnProperty(identifier)?{type:LITERAL,value:literals[identifier],raw:identifier}:identifier===this_str?{type:THIS_EXP}:{type:IDENTIFIER,name:identifier}},gobbleArguments=function(termination){for(var ch_i2,args=[],node2,closed=!1,separator_count=0;index<length3;)if(gobbleSpaces(),ch_i2=exprICode(index),ch_i2===termination){closed=!0,index++,termination===CPAREN_CODE&&separator_count&&separator_count>=args.length&&throwError("Unexpected token "+String.fromCharCode(termination),index);break}else if(ch_i2===COMMA_CODE){if(index++,separator_count++,separator_count!==args.length){if(termination===CPAREN_CODE)throwError("Unexpected token ,",index);else if(termination===CBRACK_CODE)for(var arg=args.length;arg<separator_count;arg++)args.push(null)}}else node2=gobbleExpression(),(!node2||node2.type===COMPOUND)&&throwError("Expected comma",index),args.push(node2);return closed||throwError("Expected "+String.fromCharCode(termination),index),args},gobbleVariable=function(){var ch_i2,node2;for(ch_i2=exprICode(index),ch_i2===OPAREN_CODE?node2=gobbleGroup():node2=gobbleIdentifier(),gobbleSpaces(),ch_i2=exprICode(index);ch_i2===PERIOD_CODE||ch_i2===OBRACK_CODE||ch_i2===OPAREN_CODE;)index++,ch_i2===PERIOD_CODE?(gobbleSpaces(),node2={type:MEMBER_EXP,computed:!1,object:node2,property:gobbleIdentifier()}):ch_i2===OBRACK_CODE?(node2={type:MEMBER_EXP,computed:!0,object:node2,property:gobbleExpression()},gobbleSpaces(),ch_i2=exprICode(index),ch_i2!==CBRACK_CODE&&throwError("Unclosed [",index),index++):ch_i2===OPAREN_CODE&&(node2={type:CALL_EXP,arguments:gobbleArguments(CPAREN_CODE),callee:node2}),gobbleSpaces(),ch_i2=exprICode(index);return node2},gobbleGroup=function(){index++;var node2=gobbleExpression();if(gobbleSpaces(),exprICode(index)===CPAREN_CODE)return index++,node2;throwError("Unclosed (",index)},gobbleArray=function(){return index++,{type:ARRAY_EXP,elements:gobbleArguments(CBRACK_CODE)}},nodes=[],ch_i,node;index<length3;)ch_i=exprICode(index),ch_i===SEMCOL_CODE||ch_i===COMMA_CODE?index++:(node=gobbleExpression())?nodes.push(node):index<length3&&throwError('Unexpected "'+exprI(index)+'"',index);return nodes.length===1?nodes[0]:{type:COMPOUND,body:nodes}};if(jsep.version="0.3.5",jsep.toString=function(){return"JavaScript Expression Parser (JSEP) v"+jsep.version},jsep.addUnaryOp=function(op_name){return max_unop_len=Math.max(op_name.length,max_unop_len),unary_ops[op_name]=t,this},jsep.addBinaryOp=function(op_name,precedence){return max_binop_len=Math.max(op_name.length,max_binop_len),binary_ops[op_name]=precedence,this},jsep.addLiteral=function(literal_name,literal_value){return literals[literal_name]=literal_value,this},jsep.removeUnaryOp=function(op_name){return delete unary_ops[op_name],op_name.length===max_unop_len&&(max_unop_len=getMaxKeyLen(unary_ops)),this},jsep.removeAllUnaryOps=function(){return unary_ops={},max_unop_len=0,this},jsep.removeBinaryOp=function(op_name){return delete binary_ops[op_name],op_name.length===max_binop_len&&(max_binop_len=getMaxKeyLen(binary_ops)),this},jsep.removeAllBinaryOps=function(){return binary_ops={},max_binop_len=0,this},jsep.removeLiteral=function(literal_name){return delete literals[literal_name],this},jsep.removeAllLiterals=function(){return literals={},this},typeof exports>"u"){var old_jsep=root.jsep;root.jsep=jsep,jsep.noConflict=function(){return root.jsep===jsep&&(root.jsep=old_jsep),jsep}}else typeof module<"u"&&module.exports?exports=module.exports=jsep:exports.parse=jsep})(exports)}});var CesiumExternal_exports={};__export(CesiumExternal_exports,{Batched3DModel3DTileContent:()=>Batched3DModel3DTileContent_default,Cesium3DTile:()=>Cesium3DTile_default,Cesium3DTileBatchTable:()=>Cesium3DTileBatchTable_default,Cesium3DTileContentFactory:()=>Cesium3DTileContentFactory_default,Cesium3DTileFeature:()=>Cesium3DTileFeature_default,Cesium3DTileFeatureTable:()=>Cesium3DTileFeatureTable_default,Cesium3DTilePass:()=>Cesium3DTilePass_default,Cesium3DTilePointFeature:()=>Cesium3DTilePointFeature_default,Cesium3DTileStyle:()=>Cesium3DTileStyle_default,Cesium3DTileStyleEngine:()=>Cesium3DTileStyleEngine_default,Cesium3DTileset:()=>Cesium3DTileset_default,Cesium3DTilesetTraversal:()=>Cesium3DTilesetTraversal_default,CesiumExternalMixin:()=>CesiumExternalMixin_default,Composite3DTileContent:()=>Composite3DTileContent_default,CompressedTextureBuffer:()=>CompressedTextureBuffer_default,ConditionsExpression:()=>ConditionsExpression_default,DracoLoader:()=>DracoLoader_default,EV_E3MInternalInstance:()=>EV_E3MInternalInstance_default,EV_E3MLayer:()=>EV_E3MLayer_default,EV_E3mLayerManager:()=>EV_E3mLayerManager_default,EV_IndexDBHandler:()=>EV_IndexDBHandler_default,EV_IndexDBType:()=>EV_IndexDBType_default,EV_SelectorEventHandler:()=>EV_SelectorEventHandler_default,EarthViewTerrainProvider:()=>EarthViewTerrainProvider_default,Expression:()=>Expression_default,Instanced3DModel3DTileContent:()=>Instanced3DModel3DTileContent_default,LayerManager:()=>LayerManager_default,LayerType:()=>LayerType_default,Model:()=>Model_default,ModelInstance:()=>ModelInstance_default,ModelInstanceCollection:()=>ModelInstanceCollection_default,ModelLoadResources:()=>ModelLoadResources_default,ModelMaterial:()=>ModelMaterial_default,ModelMesh:()=>ModelMesh_default,ModelOutlineLoader:()=>ModelOutlineLoader_default,ModelUtility:()=>ModelUtility_default,PointCloud:()=>PointCloud_default,PointCloud3DTileContent:()=>PointCloud3DTileContent_default,TerrainLayer:()=>TerrainLayer_default,TerrainLayerCollection:()=>TerrainLayerCollection_default,Texture:()=>Texture_default,Tileset3DTileContent:()=>Tileset3DTileContent_default,VERSION:()=>VERSION,Vector3DTileContent:()=>Vector3DTileContent_default,Vector3DTilePoints:()=>Vector3DTilePoints_default,addDefaults:()=>addDefaults_default,arrayFill:()=>arrayFill_default,arraySlice:()=>arraySlice_default,createTerrainProvider:()=>createTerrainProvider_default,hasExtension:()=>hasExtension_default,loadCRN:()=>loadCRN_default,loadKTX:()=>loadKTX_default,measureText:()=>measureText_default,processModelMaterialsCommon:()=>processModelMaterialsCommon_default,processPbrMaterials:()=>processPbrMaterials_default,updateVersion:()=>updateVersion_default,when:()=>when_default});var ContextLimits={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_maximumSamples:0,_highpFloatSupported:!1,_highpIntSupported:!1};Object.defineProperties(ContextLimits,{maximumCombinedTextureImageUnits:{get:function(){return ContextLimits._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return ContextLimits._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return ContextLimits._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return ContextLimits._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return ContextLimits._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return ContextLimits._maximumTextureSize}},maximumVaryingVectors:{get:function(){return ContextLimits._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return ContextLimits._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return ContextLimits._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return ContextLimits._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return ContextLimits._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return ContextLimits._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return ContextLimits._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return ContextLimits._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return ContextLimits._maximumViewportWidth}},maximumViewportHeight:{get:function(){return ContextLimits._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return ContextLimits._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return ContextLimits._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return ContextLimits._maximumColorAttachments}},maximumSamples:{get:function(){return ContextLimits._maximumSamples}},highpFloatSupported:{get:function(){return ContextLimits._highpFloatSupported}},highpIntSupported:{get:function(){return ContextLimits._highpIntSupported}}});var ContextLimits_default=ContextLimits;function CesiumExternalMixin(viewer2,options){viewer2.scene._context._gl.getExtension("OES_texture_float")?window.NO_support_OES_float=!1:window.NO_support_OES_float=!0,ContextLimits_default._maximumCombinedTextureImageUnits=Cesium.ContextLimits._maximumCombinedTextureImageUnits,ContextLimits_default._maximumCubeMapSize=Cesium.ContextLimits._maximumCubeMapSize,ContextLimits_default._maximumFragmentUniformVectors=Cesium.ContextLimits._maximumFragmentUniformVectors,ContextLimits_default._maximumTextureImageUnits=Cesium.ContextLimits._maximumTextureImageUnits,ContextLimits_default._maximumRenderbufferSize=Cesium.ContextLimits._maximumRenderbufferSize,ContextLimits_default._maximumTextureSize=Cesium.ContextLimits._maximumTextureSize,ContextLimits_default._maximumVertexAttributes=Cesium.ContextLimits._maximumVertexAttributes,ContextLimits_default._maximumVertexTextureImageUnits=Cesium.ContextLimits._maximumVertexTextureImageUnits,ContextLimits_default._maximumVertexUniformVectors=Cesium.ContextLimits._maximumVertexUniformVectors,ContextLimits_default._minimumAliasedLineWidth=Cesium.ContextLimits._minimumAliasedLineWidth,ContextLimits_default._maximumAliasedLineWidth=Cesium.ContextLimits._maximumAliasedLineWidth,ContextLimits_default._minimumAliasedPointSize=Cesium.ContextLimits._minimumAliasedPointSize,ContextLimits_default._maximumAliasedPointSize=Cesium.ContextLimits._maximumAliasedPointSize,ContextLimits_default._maximumViewportWidth=Cesium.ContextLimits._maximumViewportWidth,ContextLimits_default._maximumViewportHeight=Cesium.ContextLimits._maximumViewportHeight,ContextLimits_default._highpFloatSupported=Cesium.ContextLimits._highpFloatSupported,ContextLimits_default._highpIntSupported=Cesium.ContextLimits._highpIntSupported,ContextLimits_default._maximumTextureFilterAnisotropy=Cesium.ContextLimits._maximumTextureFilterAnisotropy,ContextLimits_default._maximumDrawBuffers=Cesium.ContextLimits._maximumDrawBuffers,ContextLimits_default._maximumColorAttachments=Cesium.ContextLimits._maximumColorAttachments}var CesiumExternalMixin_default=CesiumExternalMixin;var LayerType={IMAGE:0,DEM:1,E3M:2,CROSS:3},LayerType_default=Object.freeze(LayerType);var import_urijs=__toESM(require_URI(),1);function TerrainLayerCollection(){this._demLayers=[],this._tilingScheme=void 0,this._maxLevel=void 0}Object.defineProperties(TerrainLayerCollection.prototype,{tiling:{get:function(){return this._tilingScheme}},maxLevel:{get:function(){return this._maxLevel}}});TerrainLayerCollection.prototype.addDEMLayer=function(demLayer){let name=demLayer._name,url=demLayer._url;if(!Cesium.defined(name)||!Cesium.defined(url))throw new Cesium.DeveloperError("\u56FE\u5C42\u540D\u79F0\u6216\u8005\u670D\u52A1\u5668\u5730\u5740\u672A\u5B9A\u4E49\uFF01");if(Cesium.defined(getItem(this._demLayers,name))){console.log("\u6DFB\u52A0\u5931\u8D25\uFF0C\u5DF2\u7ECF\u5B58\u5728\u6B64\u540D\u79F0\u7684\u56FE\u5C42\uFF01");return}let that=this,uri=new import_urijs.default(url);uri.path()!=="/"?(url=`${url}/EV_WebService/MetadataService/GetDEMObjectInfo?demName=${name}`,Cesium.Resource.createIfNeeded(url).fetchXML().then(metadataSuccess).catch(metadataFailure)):(uri=`${url}/earthview/manager/config/getVersionInfo`,Cesium.Resource.createIfNeeded(uri).fetchJson().then(function(serverVersion){serverVersion&&(url+=`/earthview/rest/services/edeserver/getLayerInfo?layer=${name}`,Cesium.Resource.createIfNeeded(url).fetchJson().then(metadataSuccessOfJson).catch(metadataFailure),demLayer._evServerVersion=7)}).catch(function(){url=`${url}/EV_WebService/MetadataService/GetDEMObjectInfo?demName=${name}`,Cesium.Resource.createIfNeeded(url).fetchXML().then(metadataSuccess).catch(metadataFailure),demLayer._evServerVersion=void 0}));function metadataSuccess(xml){if(!Cesium.defined(xml.getElementsByTagName("minDataLevel")[0])){console.log(`${name} \u6DFB\u52A0\u5931\u8D25,\u9519\u8BEF\u7684\u6E90\u6570\u636E\u683C\u5F0F\uFF01`);return}demLayer._minDataLevel=parseInt(xml.getElementsByTagName("minDataLevel")[0].textContent),demLayer._maxDataLevel=parseInt(xml.getElementsByTagName("maxDataLevel")[0].textContent);let srs=xml.getElementsByTagName("SRS")[0].textContent;if(srs==="WGS_1984"){if(Cesium.defined(that._tilingScheme)){if(that._tilingScheme instanceof Cesium.WebMercatorTilingScheme)throw new Cesium.DeveloperError("\u56FE\u5C42\u6295\u5F71\u5750\u6807\u7CFB\u4E0D\u4E00\u81F4\uFF01");demLayer._tilingScheme=that._tilingScheme}else demLayer._tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:18,numberOfLevelZeroTilesY:9});let west=Cesium.Math.toRadians(parseFloat(xml.getElementsByTagName("minX")[0].textContent)),south=Cesium.Math.toRadians(parseFloat(xml.getElementsByTagName("minY")[0].textContent)),east=Cesium.Math.toRadians(parseFloat(xml.getElementsByTagName("maxX")[0].textContent)),north=Cesium.Math.toRadians(parseFloat(xml.getElementsByTagName("maxY")[0].textContent));demLayer._rectangle=new Cesium.Rectangle(west,south,east,north)}else if(srs==="Mercator_Web"){if(Cesium.defined(that._tilingScheme)){if(that._tilingScheme instanceof Cesium.GeographicTilingScheme)throw new Cesium.DeveloperError("\u56FE\u5C42\u6295\u5F71\u5750\u6807\u7CFB\u4E0D\u4E00\u81F4\uFF01");demLayer._tilingScheme=that._tilingScheme}else demLayer._tilingScheme=new Cesium.WebMercatorTilingScheme;let west=parseFloat(xml.getElementsByTagName("minX")[0].textContent),south=parseFloat(xml.getElementsByTagName("minY")[0].textContent),east=parseFloat(xml.getElementsByTagName("maxX")[0].textContent),north=parseFloat(xml.getElementsByTagName("maxY")[0].textContent);north=trans(north),south=trans(south),demLayer._rectangle=new Cesium.Rectangle(west,south,east,north)}else{metadataFailure(`SRS ${srs} is not supported.`);return}Cesium.defined(that._tilingScheme)||(that._tilingScheme=demLayer._tilingScheme),demLayer._demType=xml.getElementsByTagName("demType")[0].textContent,demLayer._tileSize=parseInt(xml.getElementsByTagName("samplesPerTile")[0].textContent),demLayer._vaild=!0,that._demLayers.push(demLayer),updateMaxLevel(that),demLayer._readyPromise.resolve(!0)}function metadataSuccessOfJson(layerInfo){demLayer._minDataLevel=layerInfo.minLevel,demLayer._maxDataLevel=layerInfo.maxLevel;let tileType=layerInfo.tileModel;if(tileType==="TM_DEM_WGS84")demLayer._tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:18,numberOfLevelZeroTilesY:9}),demLayer._rectangle=new Rectangle.fromDegrees(layerInfo.minx,layerInfo.miny,layerInfo.maxx,layerInfo.maxy);else if(tileType==="TM_DEM_WebMercator"){demLayer._tilingScheme=new Cesium.WebMercatorTilingScheme;let projection2=new Cesium.WebMercatorProjection,lower84=projection2.unproject(new Cesium.Cartesian3(layerInfo.minx,layerInfo.miny)),upper84=projection2.unproject(new Cesium.Cartesian3(layerInfo.maxx,layerInfo.maxy));demLayer._rectangle=new Cesium.Rectangle(lower84.longitude,lower84.latitude,upper84.longitude,upper84.latitude)}else{metadataFailure(`SRS ${tileType} is not supported.`);return}switch(Cesium.defined(that._tilingScheme)||(that._tilingScheme=demLayer._tilingScheme),demLayer._demType=layerInfo.tileDataFormat,demLayer._tileSize=layerInfo.tileWidth,demLayer._heightMapWidth||(demLayer._heightMapWidth=layerInfo.tileWidth),layerInfo.dataStorageFormat){case"DataStorageType_BIL_7Z":demLayer._dataStorageFormat="7z";break;case"DataStorageType_BIL_GZIP":demLayer._dataStorageFormat="gz";break;default:demLayer._dataStorageFormat="";break}demLayer._vaild=!0,that._demLayers.push(demLayer),updateMaxLevel(that),demLayer._readyPromise.resolve(!0)}function metadataFailure(e){console.log(`${name} \u6DFB\u52A0\u5931\u8D25\uFF0C\u8BF7\u6C42\u8BBF\u95EE\u5931\u8D25\uFF01`)}function requestMetadata(){resource.fetchXML().then(metadataSuccess).catch(metadataFailure)}function trans(radian){let t_f=180/(4*Math.atan(1)),degree=Math.atan(Math.sinh(radian));return degree*=t_f,degree>85&&(degree=90),degree<-85&&(degree=-90),Cesium.Math.toRadians(degree)}return demLayer};TerrainLayerCollection.prototype.removeDEMLayer=function(demLayer){let layer;typeof demLayer=="string"?layer=this.getDEMLayer(demLayer):typeof demLayer=="object"&&(layer=demLayer),removeItem(this._demLayers,layer),updateMaxLevel(this)};TerrainLayerCollection.prototype.getDEMLayer=function(layerName){return getItem(this._demLayers,layerName)};TerrainLayerCollection.prototype.getFitLayer=function(x2,y2,level){if(!Cesium.defined(this._tilingScheme))return;let targetLayer,tileRect=this._tilingScheme.tileXYToRectangle(x2,y2,level);for(let i=0;i<this._demLayers.length;i++){let demLayer=this._demLayers[i];demLayer._vaild&&demLayer._show&&Cesium.Rectangle.simpleIntersection(tileRect,demLayer._rectangle)&&(Cesium.defined(targetLayer)||(targetLayer=demLayer),demLayer._maxDataLevel>targetLayer._maxDataLevel&&(targetLayer=demLayer))}return targetLayer};TerrainLayerCollection.prototype.isTileDataAvailable=function(x2,y2,level){if(Cesium.defined(this._maxLevel)||updateMaxLevel(this),Cesium.defined(this._maxLevel)&&this._maxLevel<level)return!1;if(level===0)return!0;if(!Cesium.defined(this._tilingScheme))return!1;let tileRect=this._tilingScheme.tileXYToRectangle(x2,y2,level),outOfRange=!0;for(let i=0;i<this._demLayers.length;i++){let demLayer=this._demLayers[i];if(demLayer._vaild&&demLayer._show&&Cesium.Rectangle.simpleIntersection(tileRect,demLayer._rectangle)){outOfRange=!1;break}}if(outOfRange)return!1};TerrainLayerCollection.prototype.getRectangles=function(){let rectangles=[];for(let i=0;i<this._demLayers.length;i++){let demLayer=this._demLayers[i];demLayer._vaild&&demLayer._show&&rectangles.push(demLayer._rectangle)}return rectangles};TerrainLayerCollection.prototype.getFitLayers=function(x2,y2,level){if(!Cesium.defined(this._tilingScheme))return;let targetLayers=[],maxDemLayer,tileRect=this._tilingScheme.tileXYToRectangle(x2,y2,level);for(let i=0;i<this._demLayers.length;i++){let demLayer=this._demLayers[i];demLayer._vaild&&demLayer._show&&Cesium.Rectangle.simpleIntersection(tileRect,demLayer._rectangle)&&(Cesium.defined(maxDemLayer)||(maxDemLayer=demLayer),demLayer._maxDataLevel>maxDemLayer._maxDataLevel&&(maxDemLayer=demLayer),demLayer._maxDataLevel>=level&&targetLayers.push(demLayer))}return targetLayers.length===0&&targetLayers.push(maxDemLayer),targetLayers};function getIndex(array,item){for(let i=0;i<array.length;i++)if(array[i]===item)return i;return-1}function removeItem(array,item){let index=getIndex(array,item);index>-1&&array.splice(index,1)}function getItem(array,layerName){for(let i=0;i<array.length;i++)if(array[i].name===layerName)return array[i]}function updateMaxLevel(collection){let maxLevel,array=collection._demLayers;for(let i=0;i<array.length;i++){let demLayer=array[i];demLayer._vaild&&demLayer._show&&(Cesium.defined(maxLevel)?maxLevel<array[i]._maxDataLevel&&(maxLevel=array[i]._maxDataLevel):maxLevel=array[i]._maxDataLevel)}Cesium.defined(maxLevel)&&(collection._maxLevel=maxLevel,collection._tilingScheme instanceof Cesium.WebMercatorTilingScheme&&collection._maxLevel--)}var TerrainLayerCollection_default=TerrainLayerCollection;function TerrainLayer(options){let name=options.name;if(!Cesium.defined(name))throw new Cesium.DeveloperError("name is required");if(typeof name!="string")throw new Cesium.DeveloperError("name is required to be a string ");let url=options.url;if(!Cesium.defined(url))throw new Cesium.DeveloperError("url is required");if(this._scene=options.scene,this._name=name,this._url=url,this._type=Cesium.EV_LayerType.DEM,this._minDataLevel=0,this._maxDataLevel=0,this._rectangle=void 0,this._vaild=!1,this._tilingScheme=void 0,this._demType=void 0,this._tileSize=void 0,this._heightMapWidth=void 0,this._evServerVersion=void 0,this._readyPromise=Cesium.defer(),this._customTag=options.customTag,Cesium.defined(options.demOption)&&Cesium.defined(options.demOption.heightMapWidth)){let heightMapWidth=options.demOption.heightMapWidth;if(typeof heightMapWidth!="number")throw new Cesium.DeveloperError("heightMapWidth is required to be a number ");options.heightMapWidth=heightMapWidth,this._heightMapWidth=heightMapWidth}options.url=`${options.url}/EV_WebService/MetadataService/GetDEMObjectInfo?demName=${options.name}`,this._cesiumLayer=void 0,this.layerShownOrHidden=new Cesium.Event,this._show=!0}Object.defineProperties(TerrainLayer.prototype,{name:{get:function(){return this._name}},url:{get:function(){return this._url}},type:{get:function(){return this._type}},readyPromise:{get:function(){return this._readyPromise.promise}},customTag:{get:function(){return this._customTag},set:function(customTag){this._customTag=customTag}},show:{get:function(){return this._show},set:function(visible){typeof visible!="boolean"?console.warn("visible is required to be a boolean"):this._show!==visible&&(this._show=visible,this.layerShownOrHidden.raiseEvent(this,0,this._show))}},rectangle:{get:function(){return this._rectangle}},vaild:{get:function(){return this._vaild}},minDataLevel:{get:function(){return this._minDataLevel}},maxDataLevel:{get:function(){return this._maxDataLevel}},useIndexedDBCache:{get:function(){return this._useIndexedDBCache},set:function(blIDB){typeof blIDB!="boolean"?this._useIndexedDBCache=!1:this._useIndexedDBCache=blIDB}},scene:{get:function(){return this._scene},set:function(value){if(value instanceof Cesium.Scene)this._scene=value;else throw new Cesium.DeveloperError("value must be a instance of Cesium.Scene.")}}});TerrainLayer.prototype.getCesiumLayer=function(){return this._cesiumLayer};TerrainLayer.prototype.getHeight=function(cartographic){let globe=this._scene.globe,levelZeroTiles=globe._surface._levelZeroTiles;if(!Cesium.defined(levelZeroTiles))return;let scratchGetHeightCartesian=new Cesium.Cartesian3,scratchGetHeightIntersection=new Cesium.Cartesian3,scratchGetHeightCartographic=new Cesium.Cartographic,scratchGetHeightRay=new Cesium.Ray,tile,i,length3=levelZeroTiles.length;for(i=0;i<length3&&(tile=levelZeroTiles[i],!Cesium.Rectangle.contains(tile.rectangle,cartographic));++i);if(i>=length3)return;for(;tile._lastSelectionResult===Cesium.TileSelectionResult.REFINED;)tile=tileIfContainsCartographic(tile.southwestChild,cartographic)||tileIfContainsCartographic(tile.southeastChild,cartographic)||tileIfContainsCartographic(tile.northwestChild,cartographic)||tile.northeastChild;if(!Cesium.defined(tile.data)||!Cesium.defined(tile.data.renderedMesh))return;let ellipsoid=globe._surface._tileProvider.tilingScheme.ellipsoid,cartesian2=Cesium.Cartesian3.fromRadians(cartographic.longitude,cartographic.latitude,0,ellipsoid,scratchGetHeightCartesian),ray=scratchGetHeightRay,surfaceNormal=ellipsoid.geodeticSurfaceNormal(cartesian2,ray.direction),rayOrigin=ellipsoid.getSurfaceNormalIntersectionWithZAxis(cartesian2,11500,ray.origin);if(!Cesium.defined(rayOrigin)){let magnitude2=Math.min(Cesium.defaultValue(tile.data.minimumHeight,0),-11500),vectorToMinimumPoint=Cesium.Cartesian3.multiplyByScalar(surfaceNormal,Math.abs(magnitude2)+1,scratchGetHeightIntersection);Cesium.Cartesian3.subtract(cartesian2,vectorToMinimumPoint,ray.origin)}let intersection9=tile.data.pick(ray,void 0,void 0,!1,scratchGetHeightIntersection);if(!Cesium.defined(intersection9))return;let height2=ellipsoid.cartesianToCartographic(intersection9,scratchGetHeightCartographic).height;return height2=height2<0?0:height2,height2};function tileIfContainsCartographic(tile,cartographic){return Cesium.Rectangle.contains(tile.rectangle,cartographic)?tile:void 0}var TerrainLayer_default=TerrainLayer;function EarthViewTerrainProvider(options){options=Cesium.defaultValue(options,Cesium.defaultValue.EMPTY_OBJECT),this._errorEvent=new Cesium.Event,this._ready=!1,this._readyPromise=Cesium.defer(),this._heightmapWidth=Cesium.defaultValue(options.heightMapWidth,65),this._terrainModifyInfoCollection=new Cesium.AssociativeArray,this._terrainDataStructure={heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:-256*128*256*256,highestEncodedHeight:256*128*256*256-1,terrainModifyInfoCollection:this._terrainModifyInfoCollection};let credit=options.credit;typeof credit=="string"&&(credit=new Cesium.Credit({text:credit})),this._credit=credit,this._heightmapWidth=Cesium.defaultValue(options.heightMapWidth,65),this._heightmapHeight=this._heightmapWidth,this._demLayerCollection=options.demLayerCollection,this._tilingScheme=this._demLayerCollection._tilingScheme,this._levelZeroMaximumGeometricError=Cesium.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(Cesium.Ellipsoid.WGS84,this._heightmapHeight,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._ready=!0,this._readyPromise.resolve(!0)}Object.defineProperties(EarthViewTerrainProvider.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},terrainModifyInfoCollection:{get:function(){return this._terrainModifyInfoCollection}},maxDataLevel:{get:function(){return this._demLayerCollection._maxLevel}},useIndexedDBCache:{get:function(){return this._useIndexedDBCache},set:function(blIDB){typeof blIDB!="boolean"?this._useIndexedDBCache=!1:this._useIndexedDBCache=blIDB}}});EarthViewTerrainProvider.prototype.getRequestTileGeometryUrlAndUpsampling=function(x2,y2,level,demLayer){let level2=level,row2=y2,col2=x2;this._tilingScheme instanceof Cesium.GeographicTilingScheme?row2=this._tilingScheme.getNumberOfYTilesAtLevel(level)-y2-1:level2++;let fitLayer;if(Cesium.defined(demLayer)?fitLayer=demLayer:fitLayer=this._demLayerCollection.getFitLayer(x2,y2,level),!Cesium.defined(fitLayer))return{url:void 0,createdByUpsampling:!1};let tileSize=fitLayer._tileSize,demType=fitLayer._demType,maxDataLevel=fitLayer._maxDataLevel,createdByUpsampling=!1;return level>maxDataLevel&&(createdByUpsampling=!0),{url:`${fitLayer._url}/EV_WebService/get/globeservice/10000/GetDEMData/${fitLayer._name}/${level2}/${row2}/${col2}`,createdByUpsampling}};EarthViewTerrainProvider.prototype.getFitLayers=function(x2,y2,level){let level2=level,row2=y2,col2=x2;return this._tilingScheme instanceof Cesium.GeographicTilingScheme?row2=this._tilingScheme.getNumberOfYTilesAtLevel(level)-y2-1:level2++,this._demLayerCollection.getFitLayers(x2,y2,level)};EarthViewTerrainProvider.prototype.createHeightmapTerrainData=function(buffer3,level,x2,y2,createdByUpsampling){let heightmapTerrain=new Cesium.HeightmapTerrainData({buffer:buffer3,width:this._heightmapWidth,height:this._heightmapWidth,childTileMask:getChildMask(this,x2,y2,level),structure:this._terrainDataStructure,createdByUpsampling}),ellipsoid=this.tilingScheme.ellipsoid,thisLevelMaxError=Cesium.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(ellipsoid,heightmapTerrain._width,this.tilingScheme.getNumberOfXTilesAtLevel(0))/(1<<level);return heightmapTerrain._skirtHeight=Math.min(thisLevelMaxError*64,1e3),heightmapTerrain};EarthViewTerrainProvider.prototype.requestTileGeometry=function(x2,y2,level,request,demLayer){let level2=level,row2=y2,col2=x2;this._tilingScheme instanceof Cesium.GeographicTilingScheme?row2=this._tilingScheme.getNumberOfYTilesAtLevel(level)-y2-1:level2++;let that=this,fitLayer=Cesium.defined(demLayer)?demLayer:this._demLayerCollection.getFitLayer(x2,y2,level);if(!Cesium.defined(fitLayer)){let p=new Promise(function(resolve2,reject2){resolve2()});return Promise.resolve(p).then(function(){return new Cesium.HeightmapTerrainData({buffer:new Float32Array(17*17),width:17,height:17,childTileMask:getChildMask(that,x2,y2,level),structure:that._terrainDataStructure,createdByUpsampling:!1})})}let tileSize=fitLayer._tileSize,demType=fitLayer._demType,maxDataLevel=fitLayer._maxDataLevel,url2;fitLayer._evServerVersion?url2=`${fitLayer._url}/earthview/rest/services/edeserver/tms/${fitLayer._name}/${level2}/${col2}/${row2}.${fitLayer._dataStorageFormat}`:url2=`${fitLayer._url}/EV_WebService/get/globeservice/10000/GetDEMData/${fitLayer._name}/${level2}/${row2}/${col2}`;let promise=Cesium.Resource.createIfNeeded(url2).fetchArrayBuffer();if(!!Cesium.defined(promise))return Cesium.defined(request)&&(request.url=url2),Promise.resolve(promise).then(function(blob){if((!Cesium.defined(blob)||blob.byteLength===0)&&level!==0)throw new DeveloperError("terrain data is empty!");let arr,arr2,invalidHeightIndexArry=[],bufsize=that._heightmapWidth*that._heightmapWidth;demType==="DEM_Byte"?(arr=new Uint8Array(blob),arr2=new Float32Array(bufsize)):demType==="DEM_UInt16"||demType==="DEM_UInt"?(arr=new Uint16Array(blob),arr2=new Float32Array(bufsize)):demType==="DEM_Int16"||demType==="DEM_Int"||demType==="TDF_DEM_Int16"?(arr=new Int16Array(blob),arr2=new Float32Array(bufsize)):demType==="DEM_UInt32"?(arr=new Uint32Array(blob),arr2=new Float32Array(bufsize)):demType==="DEM_Int32"?(arr=new Int32Array(blob),arr2=new Float32Array(bufsize)):demType==="DEM_Float32"||demType==="DEM_Float"||demType==="TDF_DEM_Float"?(arr=new Float32Array(blob),arr2=new Float32Array(bufsize)):(demType==="DEM_Float64"||demType==="DEM_Double"||demType==="TDF_DEM_Double")&&(arr=new Float64Array(blob),arr2=new Float64Array(bufsize));let createdByUpsampling=!1;if(tileSize===that._heightmapWidth)for(let i=0;i<that._heightmapWidth;++i)for(let j=0;j<that._heightmapWidth;++j){let m=i*that._heightmapWidth+j;!isNaN(arr[m])&&arr[m]<9999&&arr[m]>-2e4?arr2[m]=arr[m]:invalidHeightIndexArry.push(m)}else{let pointNorth=0,pointWest=0,rectangle=that._tilingScheme.tileXYToRectangle(x2,y2,level),westDegree=Cesium.Math.toDegrees(rectangle.west),southDegree=Cesium.Math.toDegrees(rectangle.south),eastDegree=Cesium.Math.toDegrees(rectangle.east),northDegree=Cesium.Math.toDegrees(rectangle.north);level>maxDataLevel&&(createdByUpsampling=!0);let vertexSpaceY=(northDegree-southDegree)/(that._heightmapWidth-1),vertexSpaceX=(eastDegree-westDegree)/(that._heightmapWidth-1);for(let i=0;i<that._heightmapWidth;++i){pointNorth=i==that._heightmapWidth-1?southDegree:northDegree-i*vertexSpaceY;for(let j=0;j<that._heightmapWidth;++j){pointWest=j==that._heightmapWidth-1?eastDegree:westDegree+j*vertexSpaceX,pointWest>180?pointWest=pointWest-360:pointWest<-180&&(pointWest=360+pointWest),pointNorth>90?pointNorth=180-pointNorth:pointNorth<-90&&(pointNorth=-pointNorth-180);let latitude=pointNorth,longitude=pointWest,getHeightFromTile=function(latitude2,longitude2,tileNorth,tileWest,tileSouth,tileEast,samplesPerTile){if(!arr||arr.length===0)return 0;let deltaLat=tileNorth-latitude2,deltaLon=longitude2-tileWest,lat_pixel=deltaLat*(samplesPerTile-1)/(tileNorth-tileSouth),lon_pixel=deltaLon*(samplesPerTile-1)/(tileEast-tileWest),lat_min=Math.floor(lat_pixel),lat_max=Math.ceil(lat_pixel),lon_min=Math.floor(lon_pixel),lon_max=Math.ceil(lon_pixel);lat_min>=samplesPerTile&&(lat_min=samplesPerTile-1),lat_max>=samplesPerTile&&(lat_max=samplesPerTile-1),lon_min>=samplesPerTile&&(lon_min=samplesPerTile-1),lon_max>=samplesPerTile&&(lon_max=samplesPerTile-1);let delta2=lat_pixel-lat_min,lat_min_lon_min_offset=lat_min*samplesPerTile+lon_min,lat_min_lon_max_offset=lat_min_lon_min_offset+1,lat_max_lon_min_offset=lat_max*samplesPerTile+lon_min,lat_max_lon_max_offset=lat_max_lon_min_offset+1;arr.length>0&&lat_min_lon_min_offset>=arr.length&&(lat_min_lon_min_offset=arr.length-1),arr.length>0&&lat_min_lon_max_offset>=arr.length&&(lat_min_lon_max_offset=arr.length-1),arr.length>0&&lat_max_lon_min_offset>=arr.length&&(lat_max_lon_min_offset=arr.length-1),arr.length>0&&lat_max_lon_max_offset>=arr.length&&(lat_max_lon_max_offset=arr.length-1);let westElevation=0,eastElevation=0,bilSize=arr.byteLength,valid=!0,height3=0;(demType=="DEM_Float32"||demType=="DEM_Float")&&(lat_min_lon_min_offset*4>bilSize||lat_max_lon_min_offset*4>bilSize||lat_min_lon_max_offset*4>bilSize||lat_max_lon_max_offset*4>bilSize)&&(valid=!1);let val1=arr[lat_min_lon_min_offset];valid&&!validElevationF(val1)&&(valid=!1);let val2=arr[lat_max_lon_min_offset];valid&&!validElevationF(val2)&&(valid=!1);let val3=arr[lat_min_lon_max_offset];valid&&!validElevationF(val3)&&(valid=!1);let val4=arr[lat_max_lon_max_offset];return valid&&!validElevationF(val4)&&(valid=!1),valid&&(westElevation=val1*(1-delta2)+val2*delta2,eastElevation=val3*(1-delta2)+val4*delta2),Math.abs(westElevation)>1e5&&(valid=!1),Math.abs(eastElevation)>1e5&&(valid=!1),valid&&(delta2=lon_pixel-lon_min,height3=westElevation*(1-delta2)+eastElevation*delta2),height3},m=i*that._heightmapWidth+j,height2=getHeightFromTile(latitude,longitude,northDegree,westDegree,southDegree,eastDegree,tileSize);isNaN(height2)||(arr2[m]=height2)}}}return arr2&&arr2.length>0?new Cesium.HeightmapTerrainData({buffer:arr2,width:that._heightmapWidth,height:that._heightmapWidth,childTileMask:getChildMask(that,x2,y2,level),structure:that._terrainDataStructure,createdByUpsampling,invalidHeightIndex:invalidHeightIndexArry}):new Cesium.HeightmapTerrainData({buffer:new Float32Array(bufsize),width:that._heightmapWidth,height:that._heightmapWidth,childTileMask:getChildMask(that,x2,y2,level),structure:that._terrainDataStructure,createdByUpsampling})})};EarthViewTerrainProvider.prototype.getLevelMaximumGeometricError=function(level){return this._levelZeroMaximumGeometricError/(1<<level)};function getChildMask(provider,x2,y2,level){let tilingScheme=provider._tilingScheme,rectangles=provider._demLayerCollection.getRectangles(),parentRectangle=tilingScheme.tileXYToRectangle(x2,y2,level),childMask=15;if(level>provider._demLayerCollection._maxLevel-1)return 0;for(let i=0;i<rectangles.length&&childMask!==15;++i){let rectangle=rectangles[i];if(rectangle.maxLevel<=level)continue;let testRectangle=rectangle.rectangle,rectangleScratch=new Cesium.Rectangle,intersection9=Cesium.Rectangle.intersection(testRectangle,parentRectangle,rectangleScratch);Cesium.defined(intersection9)&&(isTileInRectangle(tilingScheme,testRectangle,x2*2,y2*2,level+1,rectangleScratch)&&(childMask|=4),isTileInRectangle(tilingScheme,testRectangle,x2*2+1,y2*2,level+1,rectangleScratch)&&(childMask|=8),isTileInRectangle(tilingScheme,testRectangle,x2*2,y2*2+1,level+1,rectangleScratch)&&(childMask|=1),isTileInRectangle(tilingScheme,testRectangle,x2*2+1,y2*2+1,level+1,rectangleScratch)&&(childMask|=2))}return childMask}function isTileInRectangle(tilingScheme,rectangle,x2,y2,level,rectangleScratch){let tileRectangle=tilingScheme.tileXYToRectangle(x2,y2,level);return Cesium.defined(Cesium.Rectangle.intersection(tileRectangle,rectangle,rectangleScratch))}function validElevationF(val){return Math.abs(Math.abs(val)-9999)>1e-4}EarthViewTerrainProvider.prototype.getTileDataAvailable=function(x2,y2,level){return this._demLayerCollection.isTileDataAvailable(x2,y2,level)};EarthViewTerrainProvider.prototype.addTerrainModifyInfo=function(terrainModifyInfo){if(!Cesium.defined(terrainModifyInfo)||!Cesium.defined(terrainModifyInfo.name)||!Cesium.defined(terrainModifyInfo.terrainModifyType)||!Cesium.defined(terrainModifyInfo.points)||!Cesium.defined(terrainModifyInfo.value))throw new Cesium.DeveloperError("terrainModifyInfo name,terrainModifyType,polygonGraphics,value is required.");return this._terrainModifyInfoCollection.contains(terrainModifyInfo.name)?(console.log("\u5730\u5F62\u4FEE\u6539\u540D\u79F0\u5DF2\u7ECF\u5B58\u5728"),!1):(this._terrainModifyInfoCollection.set(terrainModifyInfo.name,terrainModifyInfo),!0)};EarthViewTerrainProvider.prototype.containsTerrainModifyInfo=function(name){return this._terrainModifyInfoCollection.contains(name)};EarthViewTerrainProvider.prototype.removeTerrainModifyInfo=function(name){this._terrainModifyInfoCollection.contains(name)&&this._terrainModifyInfoCollection.remove(name)};EarthViewTerrainProvider.prototype.removeAllTerrainModifyInfo=function(){this._terrainModifyInfoCollection.removeAll()};EarthViewTerrainProvider.prototype.getTerrainModifyInfo=function(name){return this._terrainModifyInfoCollection.contains(name)?this._terrainModifyInfoCollection.get(name):null};var EarthViewTerrainProvider_default=EarthViewTerrainProvider;function createTerrainProvider(options){let demLayerCollection=new TerrainLayerCollection_default;demLayerCollection._tilingScheme=new Cesium.WebMercatorTilingScheme;let layer=new TerrainLayer_default({name:options.name,url:options.url}),demLayer=demLayerCollection.addDEMLayer(layer),evTerrainProvider=new EarthViewTerrainProvider_default({demLayerCollection});return Cesium.defined(demLayer)&&demLayer.readyPromise.then(function(){evTerrainProvider._heightmapWidth=Cesium.defaultValue(demLayer._heightMapWidth,65),evTerrainProvider._demLayerCollection=demLayerCollection,evTerrainProvider._tilingScheme=demLayerCollection._tilingScheme,evTerrainProvider._levelZeroMaximumGeometricError=Cesium.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(Cesium.Ellipsoid.WGS84,evTerrainProvider._heightmapWidth,evTerrainProvider._tilingScheme.getNumberOfXTilesAtLevel(0))}),evTerrainProvider}var createTerrainProvider_default=createTerrainProvider;/**
  @license
  when.js - https://github.com/cujojs/when

  MIT License (c) copyright B Cavalier & J Hann

 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @version 1.7.1
 */var reduceArray,slice,undef;when.defer=defer;when.resolve=resolve;when.reject=reject;when.join=join;when.all=all;when.map=map;when.reduce=reduce;when.any=any;when.some=some;when.chain=chain;when.isPromise=isPromise;function when(promiseOrValue,onFulfilled,onRejected,onProgress){return resolve(promiseOrValue).then(onFulfilled,onRejected,onProgress)}function resolve(promiseOrValue){var promise,deferred;return promiseOrValue instanceof Promise2?promise=promiseOrValue:isPromise(promiseOrValue)?(deferred=defer(),promiseOrValue.then(function(value){deferred.resolve(value)},function(reason){deferred.reject(reason)},function(update3){deferred.progress(update3)}),promise=deferred.promise):promise=fulfilled(promiseOrValue),promise}function reject(promiseOrValue){return when(promiseOrValue,rejected)}function Promise2(then){this.then=then}Promise2.prototype={always:function(onFulfilledOrRejected,onProgress){return this.then(onFulfilledOrRejected,onFulfilledOrRejected,onProgress)},otherwise:function(onRejected){return this.then(undef,onRejected)},catch:function(onRejected){return this.then(undef,onRejected)},yield:function(value){return this.then(function(){return value})},spread:function(onFulfilled){return this.then(function(array){return all(array,function(array2){return onFulfilled.apply(undef,array2)})})}};function fulfilled(value){var p=new Promise2(function(onFulfilled){try{return resolve(onFulfilled?onFulfilled(value):value)}catch(e){return rejected(e)}});return p}function rejected(reason){var p=new Promise2(function(_,onRejected){try{return onRejected?resolve(onRejected(reason)):rejected(reason)}catch(e){return rejected(e)}});return p}function defer(){var deferred,promise,handlers,progressHandlers,_then,_progress,_resolve;return promise=new Promise2(then),deferred={then,resolve:promiseResolve,reject:promiseReject,progress:promiseProgress,promise,resolver:{resolve:promiseResolve,reject:promiseReject,progress:promiseProgress}},handlers=[],progressHandlers=[],_then=function(onFulfilled,onRejected,onProgress){var deferred2,progressHandler;return deferred2=defer(),progressHandler=typeof onProgress=="function"?function(update3){try{deferred2.progress(onProgress(update3))}catch(e){deferred2.progress(e)}}:function(update3){deferred2.progress(update3)},handlers.push(function(promise2){promise2.then(onFulfilled,onRejected).then(deferred2.resolve,deferred2.reject,progressHandler)}),progressHandlers.push(progressHandler),deferred2.promise},_progress=function(update3){return processQueue(progressHandlers,update3),update3},_resolve=function(value){return value=resolve(value),_then=value.then,_resolve=resolve,_progress=noop,processQueue(handlers,value),progressHandlers=handlers=undef,value},deferred;function then(onFulfilled,onRejected,onProgress){return _then(onFulfilled,onRejected,onProgress)}function promiseResolve(val){return _resolve(val)}function promiseReject(err){return _resolve(rejected(err))}function promiseProgress(update3){return _progress(update3)}}function isPromise(promiseOrValue){return promiseOrValue&&typeof promiseOrValue.then=="function"}function some(promisesOrValues,howMany,onFulfilled,onRejected,onProgress){return checkCallbacks(2,arguments),when(promisesOrValues,function(promisesOrValues2){var toResolve,toReject,values3,reasons,deferred,fulfillOne,rejectOne,progress,len,i;if(len=promisesOrValues2.length>>>0,toResolve=Math.max(0,Math.min(howMany,len)),values3=[],toReject=len-toResolve+1,reasons=[],deferred=defer(),!toResolve)deferred.resolve(values3);else for(progress=deferred.progress,rejectOne=function(reason){reasons.push(reason),--toReject||(fulfillOne=rejectOne=noop,deferred.reject(reasons))},fulfillOne=function(val){values3.push(val),--toResolve||(fulfillOne=rejectOne=noop,deferred.resolve(values3))},i=0;i<len;++i)i in promisesOrValues2&&when(promisesOrValues2[i],fulfiller,rejecter,progress);return deferred.then(onFulfilled,onRejected,onProgress);function rejecter(reason){rejectOne(reason)}function fulfiller(val){fulfillOne(val)}})}function any(promisesOrValues,onFulfilled,onRejected,onProgress){function unwrapSingleResult(val){return onFulfilled?onFulfilled(val[0]):val[0]}return some(promisesOrValues,1,unwrapSingleResult,onRejected,onProgress)}function all(promisesOrValues,onFulfilled,onRejected,onProgress){return checkCallbacks(1,arguments),map(promisesOrValues,identity).then(onFulfilled,onRejected,onProgress)}function join(){return map(arguments,identity)}function map(promise,mapFunc){return when(promise,function(array){var results,len,toResolve,resolve2,i,d;if(toResolve=len=array.length>>>0,results=[],d=defer(),!toResolve)d.resolve(results);else for(resolve2=function(item,i2){when(item,mapFunc).then(function(mapped){results[i2]=mapped,--toResolve||d.resolve(results)},d.reject)},i=0;i<len;i++)i in array?resolve2(array[i],i):--toResolve;return d.promise})}function reduce(promise,reduceFunc){var args=slice.call(arguments,1);return when(promise,function(array){var total;return total=array.length,args[0]=function(current,val,i){return when(current,function(c){return when(val,function(value){return reduceFunc(c,value,i,total)})})},reduceArray.apply(array,args)})}function chain(promiseOrValue,resolver,resolveValue){var useResolveValue=arguments.length>2;return when(promiseOrValue,function(val){return val=useResolveValue?resolveValue:val,resolver.resolve(val),val},function(reason){return resolver.reject(reason),rejected(reason)},resolver.progress)}function processQueue(queue,value){for(var handler,i=0;handler=queue[i++];)handler(value)}function checkCallbacks(start2,arrayOfCallbacks){for(var arg,i=arrayOfCallbacks.length;i>start2;)if(arg=arrayOfCallbacks[--i],arg!=null&&typeof arg!="function")throw new Error("arg "+i+" must be a function")}function noop(){}slice=[].slice;reduceArray=[].reduce||function(reduceFunc){var arr,args,reduced,len,i;if(i=0,arr=Object(this),len=arr.length>>>0,args=arguments,args.length<=1)for(;;){if(i in arr){reduced=arr[i++];break}if(++i>=len)throw new TypeError}else reduced=args[1];for(;i<len;++i)i in arr&&(reduced=reduceFunc(reduced,arr[i],i,arr));return reduced};function identity(x2){return x2}var when_default=when;function arrayFill(array,value,start2,end){if(typeof array.fill=="function")return array.fill(value,start2,end);for(var length3=array.length>>>0,relativeStart=Cesium.defaultValue(start2,0),k=relativeStart<0?Math.max(length3+relativeStart,0):Math.min(relativeStart,length3),relativeEnd=Cesium.defaultValue(end,length3),last=relativeEnd<0?Math.max(length3+relativeEnd,0):Math.min(relativeEnd,length3);k<last;)array[k]=value,k++;return array}var arrayFill_default=arrayFill;function Texture(options){options=Cesium.defaultValue(options,Cesium.defaultValue.EMPTY_OBJECT);var context=options.context,width2=options.width,height2=options.height,source=options.source,numberOfMipmapLevels=1;Cesium.defined(source)&&Cesium.defined(source.length)&&source.length>0&&!Cesium.defined(source.arrayBufferView)&&(source.arrayBufferView={},source.arrayBufferView.byteLength=source[0].bufferView.byteLength,numberOfMipmapLevels=source.length),Cesium.defined(source)&&(Cesium.defined(width2)||(width2=Cesium.defaultValue(source.videoWidth,source.width)),Cesium.defined(height2)||(height2=Cesium.defaultValue(source.videoHeight,source.height)));var pixelFormat=Cesium.defaultValue(options.pixelFormat,Cesium.PixelFormat.RGBA),pixelDatatype=Cesium.defaultValue(options.pixelDatatype,Cesium.PixelDatatype.UNSIGNED_BYTE),internalFormat=pixelFormat,isCompressed=Cesium.PixelFormat.isCompressedFormat(internalFormat);if(context.webgl2){if(pixelFormat===Cesium.PixelFormat.DEPTH_STENCIL?internalFormat=Cesium.WebGLConstants.DEPTH24_STENCIL8:pixelFormat===Cesium.PixelFormat.DEPTH_COMPONENT&&(pixelDatatype===Cesium.PixelDatatype.UNSIGNED_SHORT?internalFormat=Cesium.WebGLConstants.DEPTH_COMPONENT16:pixelDatatype===Cesium.PixelDatatype.UNSIGNED_INT&&(internalFormat=Cesium.WebGLConstants.DEPTH_COMPONENT24)),pixelDatatype===Cesium.PixelDatatype.FLOAT)switch(pixelFormat){case Cesium.PixelFormat.RGBA:internalFormat=Cesium.WebGLConstants.RGBA32F;break;case Cesium.PixelFormat.RGB:internalFormat=Cesium.WebGLConstants.RGB32F;break;case Cesium.PixelFormat.RG:internalFormat=Cesium.WebGLConstants.RG32F;break;case Cesium.PixelFormat.R:internalFormat=Cesium.WebGLConstants.R32F;break}else if(pixelDatatype===Cesium.PixelDatatype.HALF_FLOAT)switch(pixelFormat){case Cesium.PixelFormat.RGBA:internalFormat=Cesium.WebGLConstants.RGBA16F;break;case Cesium.PixelFormat.RGB:internalFormat=Cesium.WebGLConstants.RGB16F;break;case Cesium.PixelFormat.RG:internalFormat=Cesium.WebGLConstants.RG16F;break;case Cesium.PixelFormat.R:internalFormat=Cesium.WebGLConstants.R16F;break}}var preMultiplyAlpha=options.preMultiplyAlpha||pixelFormat===Cesium.PixelFormat.RGB||pixelFormat===Cesium.PixelFormat.LUMINANCE,flipY=Cesium.defaultValue(options.flipY,!0),initialized=!0,gl=context._gl,textureTarget=gl.TEXTURE_2D,texture=gl.createTexture();gl.activeTexture(gl.TEXTURE0),gl.bindTexture(textureTarget,texture),context.webgl2&&pixelDatatype===Cesium.PixelDatatype.HALF_FLOAT&&(pixelDatatype=Cesium.WebGLConstants.HALF_FLOAT);var unpackAlignment=4;if(Cesium.defined(source)&&Cesium.defined(source.arrayBufferView)&&!isCompressed&&(unpackAlignment=Cesium.PixelFormat.alignmentInBytes(pixelFormat,pixelDatatype,width2)),gl.pixelStorei(gl.UNPACK_ALIGNMENT,unpackAlignment),Cesium.defined(source))if(Cesium.defined(source.arrayBufferView)){gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1);var arrayBufferView=source.arrayBufferView;if(isCompressed)if(Cesium.defined(source.length)&&source.length>0){var currentWidth=width2,currentHeight=height2,offset=0,level=0;if(context.webgl2){for(var tempByteLength=0,totalByteLength=0,mipmapTexs=[],tempWidth=currentWidth,tempHeight=currentHeight;numberOfMipmapLevels===1||tempWidth>=1||tempHeight>=1;){var bufferSize=Cesium.PixelFormat.compressedTextureSizeInBytes(internalFormat,tempWidth,tempHeight),buffer3;if(level<numberOfMipmapLevels?(buffer3=source[level].bufferView,mipmapTexs.push({level,width:tempWidth,height:tempHeight,offset:tempByteLength,imageSize:buffer3.length}),level<numberOfMipmapLevels-1&&(tempByteLength+=buffer3.byteLength),totalByteLength+=buffer3.byteLength,offset+=bufferSize):mipmapTexs.push({level,width:tempWidth,height:tempHeight,offset:tempByteLength,imageSize:bufferSize}),tempWidth==1&&tempHeight==1||numberOfMipmapLevels===1)break;tempWidth!=1&&(tempWidth/=2),tempHeight!=1&&(tempHeight/=2),level++}for(var offset1=0,resultArrayBuffer=new Uint8Array(totalByteLength),index=0;index<source.length&&mipmapTexs.length>=source.length;index++)resultArrayBuffer.set(source[index].bufferView,offset1),offset1+=source[index].bufferView.length;var buf=gl.createBuffer();gl.bindBuffer(gl.PIXEL_UNPACK_BUFFER,buf),gl.bufferData(gl.PIXEL_UNPACK_BUFFER,resultArrayBuffer,gl.STATIC_DRAW);for(var j=0;j<mipmapTexs.length;j++)gl.compressedTexImage2D(textureTarget,mipmapTexs[j].level,internalFormat,mipmapTexs[j].width,mipmapTexs[j].height,0,mipmapTexs[j].imageSize,mipmapTexs[j].offset);gl.bindBuffer(gl.PIXEL_UNPACK_BUFFER,null)}else for(;numberOfMipmapLevels===1||currentWidth>=1||currentHeight>=1;){let bufferSize2=Cesium.PixelFormat.compressedTextureSizeInBytes(internalFormat,currentWidth,currentHeight),buffer4;if(level<numberOfMipmapLevels?buffer4=source[level].bufferView:buffer4=source[numberOfMipmapLevels-1].bufferView.subarray(0,bufferSize2),gl.compressedTexImage2D(textureTarget,level,internalFormat,currentWidth,currentHeight,0,buffer4),currentWidth==1&&currentHeight==1||numberOfMipmapLevels===1)break;currentWidth!=1&&(currentWidth/=2),currentHeight!=1&&(currentHeight/=2),offset+=bufferSize2,level++}numberOfMipmapLevels=level}else if(context.webgl2){var buf=gl.createBuffer();gl.bindBuffer(gl.PIXEL_UNPACK_BUFFER,buf),gl.bufferData(gl.PIXEL_UNPACK_BUFFER,arrayBufferView,gl.STATIC_DRAW),gl.compressedTexImage2D(textureTarget,0,internalFormat,width2,height2,0,arrayBufferView.length,0),gl.bindBuffer(gl.PIXEL_UNPACK_BUFFER,null)}else gl.compressedTexImage2D(textureTarget,0,internalFormat,width2,height2,0,arrayBufferView);else if(flipY&&(arrayBufferView=Cesium.PixelFormat.flipY(arrayBufferView,pixelFormat,pixelDatatype,width2,height2)),gl.texImage2D(textureTarget,0,internalFormat,width2,height2,0,pixelFormat,pixelDatatype,arrayBufferView),Cesium.defined(source.mipLevels))for(var mipWidth=width2,mipHeight=height2,i=0;i<source.mipLevels.length;++i)mipWidth=Math.floor(mipWidth/2)|0,mipWidth<1&&(mipWidth=1),mipHeight=Math.floor(mipHeight/2)|0,mipHeight<1&&(mipHeight=1),gl.texImage2D(textureTarget,i+1,internalFormat,mipWidth,mipHeight,0,pixelFormat,pixelDatatype,source.mipLevels[i])}else Cesium.defined(source.framebuffer)?(gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1),source.framebuffer!==context.defaultFramebuffer&&source.framebuffer._bind(),gl.copyTexImage2D(textureTarget,0,internalFormat,source.xOffset,source.yOffset,width2,height2,0),source.framebuffer!==context.defaultFramebuffer&&source.framebuffer._unBind()):(gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,preMultiplyAlpha),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,flipY),gl.texImage2D(textureTarget,0,internalFormat,pixelFormat,pixelDatatype,source));else gl.texImage2D(textureTarget,0,internalFormat,width2,height2,0,pixelFormat,pixelDatatype,null),initialized=!1;gl.bindTexture(textureTarget,null);var sizeInBytes;isCompressed?sizeInBytes=Cesium.PixelFormat.compressedTextureSizeInBytes(pixelFormat,width2,height2):sizeInBytes=Cesium.PixelFormat.textureSizeInBytes(pixelFormat,pixelDatatype,width2,height2),this._id=Cesium.createGuid(),this._context=context,this._textureFilterAnisotropic=context._textureFilterAnisotropic,this._textureTarget=textureTarget,this._texture=texture,this._pixelFormat=pixelFormat,this._pixelDatatype=pixelDatatype,this._width=width2,this._height=height2,this._dimensions=new Cesium.Cartesian2(width2,height2),this._hasMipmap=!1,this._sizeInBytes=sizeInBytes,this._preMultiplyAlpha=preMultiplyAlpha,this._flipY=flipY,this._initialized=initialized,this._sampler=void 0,this.sampler=Cesium.defined(options.sampler)?options.sampler:new Cesium.Sampler}Texture.create=function(options){return new Texture(options)};Texture.fromFramebuffer=function(options){options=Cesium.defaultValue(options,Cesium.defaultValue.EMPTY_OBJECT);var context=options.context,gl=context._gl,pixelFormat=Cesium.defaultValue(options.pixelFormat,Cesium.PixelFormat.RGB),framebufferXOffset=Cesium.defaultValue(options.framebufferXOffset,0),framebufferYOffset=Cesium.defaultValue(options.framebufferYOffset,0),width2=Cesium.defaultValue(options.width,gl.drawingBufferWidth),height2=Cesium.defaultValue(options.height,gl.drawingBufferHeight),framebuffer=options.framebuffer,texture=new Texture({context,width:width2,height:height2,pixelFormat,source:{framebuffer:Cesium.defined(framebuffer)?framebuffer:context.defaultFramebuffer,xOffset:framebufferXOffset,yOffset:framebufferYOffset,width:width2,height:height2}});return texture};Object.defineProperties(Texture.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(sampler){var minificationFilter=sampler.minificationFilter,magnificationFilter=sampler.magnificationFilter,mipmap=minificationFilter===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST||minificationFilter===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_LINEAR||minificationFilter===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_NEAREST||minificationFilter===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR,context=this._context,pixelDatatype=this._pixelDatatype;(pixelDatatype===Cesium.PixelDatatype.FLOAT&&!context.textureFloatLinear||pixelDatatype===Cesium.PixelDatatype.HALF_FLOAT&&!context.textureHalfFloatLinear)&&(minificationFilter=mipmap?Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST:Cesium.TextureMinificationFilter.NEAREST,magnificationFilter=Cesium.TextureMagnificationFilter.NEAREST);var gl=context._gl,target=this._textureTarget;gl.activeTexture(gl.TEXTURE0),gl.bindTexture(target,this._texture),gl.texParameteri(target,gl.TEXTURE_MIN_FILTER,minificationFilter),gl.texParameteri(target,gl.TEXTURE_MAG_FILTER,magnificationFilter),gl.texParameteri(target,gl.TEXTURE_WRAP_S,sampler.wrapS),gl.texParameteri(target,gl.TEXTURE_WRAP_T,sampler.wrapT),Cesium.defined(this._textureFilterAnisotropic)&&gl.texParameteri(target,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,sampler.maximumAnisotropy),gl.bindTexture(target,null),this._sampler=sampler}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(this._sizeInBytes*4/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}});Texture.prototype.copyFrom=function(source,xOffset,yOffset){xOffset=Cesium.defaultValue(xOffset,0),yOffset=Cesium.defaultValue(yOffset,0);var gl=this._context._gl,target=this._textureTarget;gl.activeTexture(gl.TEXTURE0),gl.bindTexture(target,this._texture);var width2=source.width,height2=source.height,arrayBufferView=source.arrayBufferView,textureWidth=this._width,textureHeight=this._height,pixelFormat=this._pixelFormat,pixelDatatype=this._pixelDatatype,preMultiplyAlpha=this._preMultiplyAlpha,flipY=this._flipY,unpackAlignment=4;Cesium.defined(arrayBufferView)&&(unpackAlignment=Cesium.PixelFormat.alignmentInBytes(pixelFormat,pixelDatatype,width2)),gl.pixelStorei(gl.UNPACK_ALIGNMENT,unpackAlignment);var uploaded=!1;if(!this._initialized){if(xOffset===0&&yOffset===0&&width2===textureWidth&&height2===textureHeight)Cesium.defined(arrayBufferView)?(gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1),flipY&&(arrayBufferView=Cesium.PixelFormat.flipY(arrayBufferView,pixelFormat,pixelDatatype,textureWidth,textureHeight)),gl.texImage2D(target,0,pixelFormat,textureWidth,textureHeight,0,pixelFormat,pixelDatatype,arrayBufferView)):(gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,preMultiplyAlpha),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,flipY),gl.texImage2D(target,0,pixelFormat,pixelFormat,pixelDatatype,source)),uploaded=!0;else{gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1);var bufferView=Cesium.PixelFormat.createTypedArray(pixelFormat,pixelDatatype,textureWidth,textureHeight);gl.texImage2D(target,0,pixelFormat,textureWidth,textureHeight,0,pixelFormat,pixelDatatype,bufferView)}this._initialized=!0}uploaded||(Cesium.defined(arrayBufferView)?(gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1),flipY&&(arrayBufferView=Cesium.PixelFormat.flipY(arrayBufferView,pixelFormat,pixelDatatype,width2,height2)),gl.texSubImage2D(target,0,xOffset,yOffset,width2,height2,pixelFormat,pixelDatatype,arrayBufferView)):(gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,preMultiplyAlpha),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,flipY),xOffset==0&&yOffset==0?gl.texImage2D(target,0,pixelFormat,pixelFormat,pixelDatatype,source):gl.texSubImage2D(target,0,xOffset,yOffset,pixelFormat,pixelDatatype,source)))};Texture.prototype.copyFromFramebuffer=function(xOffset,yOffset,framebufferXOffset,framebufferYOffset,width2,height2){xOffset=Cesium.defaultValue(xOffset,0),yOffset=Cesium.defaultValue(yOffset,0),framebufferXOffset=Cesium.defaultValue(framebufferXOffset,0),framebufferYOffset=Cesium.defaultValue(framebufferYOffset,0),width2=Cesium.defaultValue(width2,this._width),height2=Cesium.defaultValue(height2,this._height);var gl=this._context._gl,target=this._textureTarget;gl.activeTexture(gl.TEXTURE0),gl.bindTexture(target,this._texture),gl.copyTexSubImage2D(target,0,xOffset,yOffset,framebufferXOffset,framebufferYOffset,width2,height2),gl.bindTexture(target,null),this._initialized=!0};Texture.prototype.generateMipmap=function(hint){hint=Cesium.defaultValue(hint,Cesium.MipmapHint.DONT_CARE),this._hasMipmap=!0;var gl=this._context._gl,target=this._textureTarget;gl.hint(gl.GENERATE_MIPMAP_HINT,hint),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(target,this._texture),gl.generateMipmap(target),gl.bindTexture(target,null)};Texture.prototype.isDestroyed=function(){return!1};Texture.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),Cesium.destroyObject(this)};var Texture_default=Texture;var DEFAULT_COLOR_VALUE=Cesium.Color.WHITE,DEFAULT_SHOW_VALUE=!0,DEFAULT_TRANS_VALUE=Cesium.Cartesian3.ZERO;function Cesium3DTileBatchTable(content,featuresLength,batchTableJson,batchTableBinary,colorChangedCallback){this.featuresLength=featuresLength,this._translucentFeaturesLength=0;var extensions;Cesium.defined(batchTableJson)&&(extensions=batchTableJson.extensions),this._extensions=Cesium.defaultValue(extensions,{});var properties=initializeProperties(batchTableJson);this._properties=properties,initializeLODInfo(batchTableJson,content),this._batchTableHierarchy=initializeHierarchy(this,batchTableJson,batchTableBinary),this._batchTableBinaryProperties=getBinaryProperties(featuresLength,properties,batchTableBinary),this._showAlphaProperties=void 0,this._batchValues=void 0,this._batchValuesDirty=!1,this._batchTexture=void 0,this._defaultTexture=void 0,this._transValues=void 0,this._translationTexture=void 0,this._defaultTransTexture=void 0,this._scaleValues=void 0,this._scaleTexture=void 0,this._defaultScaleTexture=void 0,this._rotationValues=void 0,this._rotationTexture=void 0,this._defaultRotationTexture=void 0,this._pickTexture=void 0,this._pickIds=[],this._content=content,this._colorChangedCallback=colorChangedCallback;var textureDimensions,textureStep;if(featuresLength>0){var width2=Math.min(featuresLength,Cesium.ContextLimits.maximumTextureSize),height2=Math.ceil(featuresLength/Cesium.ContextLimits.maximumTextureSize),stepX=1/width2,centerX=stepX*.5,stepY=1/height2,centerY=stepY*.5;textureDimensions=new Cesium.Cartesian2(width2,height2),textureStep=new Cesium.Cartesian4(stepX,centerX,stepY,centerY)}this._textureDimensions=textureDimensions,this._textureStep=textureStep}Cesium3DTileBatchTable._deprecationWarning=Cesium.deprecationWarning;Object.defineProperties(Cesium3DTileBatchTable.prototype,{memorySizeInBytes:{get:function(){var memory=0;return Cesium.defined(this._pickTexture)&&(memory+=this._pickTexture.sizeInBytes),Cesium.defined(this._batchTexture)&&(memory+=this._batchTexture.sizeInBytes),Cesium.defined(this._translationTexture)&&(memory+=this._translationTexture.sizeInBytes),Cesium.defined(this._scaleTexture)&&(memory+=this._scaleTexture.sizeInBytes),Cesium.defined(this._rotationTexture)&&(memory+=this._rotationTexture.sizeInBytes),memory}}});function initializeProperties(jsonHeader){var properties={};if(!Cesium.defined(jsonHeader))return properties;for(var propertyName in jsonHeader)jsonHeader.hasOwnProperty(propertyName)&&propertyName!=="HIERARCHY"&&propertyName!=="extensions"&&propertyName!=="extras"&&(properties[propertyName]=Cesium.clone(jsonHeader[propertyName],!0));return properties}function initializeLODInfo(jsonHeader,content){if(!(!Cesium.defined(jsonHeader)||!Cesium.defined(jsonHeader.extensions))){var lodInfo=jsonHeader.extensions["3DTILES_batch_table_EVFORMAT"];if(Cesium.defined(lodInfo)){var tileset=content._tileset,parent=content._tile,children=lodInfo.children;tileset.addNode_ev(parent,children)}}}function initializeHierarchy(batchTable,jsonHeader,binaryBody){if(!!Cesium.defined(jsonHeader)){var hierarchy=batchTable._extensions["3DTILES_batch_table_hierarchy"],legacyHierarchy=jsonHeader.HIERARCHY;if(Cesium.defined(legacyHierarchy)&&(Cesium3DTileBatchTable._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),batchTable._extensions["3DTILES_batch_table_hierarchy"]=legacyHierarchy,hierarchy=legacyHierarchy),!!Cesium.defined(hierarchy))return initializeHierarchyValues(hierarchy,binaryBody)}}function initializeHierarchyValues(hierarchyJson,binaryBody){var i,classId,binaryAccessor,instancesLength=hierarchyJson.instancesLength,classes=hierarchyJson.classes,classIds=hierarchyJson.classIds,parentCounts=hierarchyJson.parentCounts,parentIds=hierarchyJson.parentIds,parentIdsLength=instancesLength;Cesium.defined(classIds.byteOffset)&&(classIds.componentType=Cesium.defaultValue(classIds.componentType,Cesium.ComponentDatatype.UNSIGNED_SHORT),classIds.type=Cesium.AttributeType.SCALAR,binaryAccessor=Cesium.getBinaryAccessor(classIds),classIds=binaryAccessor.createArrayBufferView(binaryBody.buffer,binaryBody.byteOffset+classIds.byteOffset,instancesLength));var parentIndexes;if(Cesium.defined(parentCounts))for(Cesium.defined(parentCounts.byteOffset)&&(parentCounts.componentType=Cesium.defaultValue(parentCounts.componentType,Cesium.ComponentDatatype.UNSIGNED_SHORT),parentCounts.type=Cesium.AttributeType.SCALAR,binaryAccessor=Cesium.getBinaryAccessor(parentCounts),parentCounts=binaryAccessor.createArrayBufferView(binaryBody.buffer,binaryBody.byteOffset+parentCounts.byteOffset,instancesLength)),parentIndexes=new Uint16Array(instancesLength),parentIdsLength=0,i=0;i<instancesLength;++i)parentIndexes[i]=parentIdsLength,parentIdsLength+=parentCounts[i];Cesium.defined(parentIds)&&Cesium.defined(parentIds.byteOffset)&&(parentIds.componentType=Cesium.defaultValue(parentIds.componentType,Cesium.ComponentDatatype.UNSIGNED_SHORT),parentIds.type=Cesium.AttributeType.SCALAR,binaryAccessor=Cesium.getBinaryAccessor(parentIds),parentIds=binaryAccessor.createArrayBufferView(binaryBody.buffer,binaryBody.byteOffset+parentIds.byteOffset,parentIdsLength));var classesLength=classes.length;for(i=0;i<classesLength;++i){var classInstancesLength=classes[i].length,properties=classes[i].instances,binaryProperties=getBinaryProperties(classInstancesLength,properties,binaryBody);classes[i].instances=Cesium.combine(binaryProperties,properties)}var classCounts=arrayFill_default(new Array(classesLength),0),classIndexes=new Uint16Array(instancesLength);for(i=0;i<instancesLength;++i)classId=classIds[i],classIndexes[i]=classCounts[classId],++classCounts[classId];var hierarchy={classes,classIds,classIndexes,parentCounts,parentIndexes,parentIds};return hierarchy}function getBinaryProperties(featuresLength,properties,binaryBody){var binaryProperties;for(var name in properties)if(properties.hasOwnProperty(name)){var property=properties[name],byteOffset=property.byteOffset;if(Cesium.defined(byteOffset)){var componentType=property.componentType,type=property.type;if(!Cesium.defined(componentType))throw new Cesium.RuntimeError("componentType is required.");if(!Cesium.defined(type))throw new Cesium.RuntimeError("type is required.");if(!Cesium.defined(binaryBody))throw new Cesium.RuntimeError("Property "+name+" requires a batch table binary.");var binaryAccessor=Cesium.getBinaryAccessor(property),componentCount=binaryAccessor.componentsPerAttribute,classType=binaryAccessor.classType,typedArray=binaryAccessor.createArrayBufferView(binaryBody.buffer,binaryBody.byteOffset+byteOffset,featuresLength);Cesium.defined(binaryProperties)||(binaryProperties={}),binaryProperties[name]={typedArray,componentCount,type:classType}}}return binaryProperties}Cesium3DTileBatchTable.getBinaryProperties=function(featuresLength,batchTableJson,batchTableBinary){return getBinaryProperties(featuresLength,batchTableJson,batchTableBinary)};function getByteLength(batchTable){var dimensions=batchTable._textureDimensions;return dimensions.x*dimensions.y*4}function getBatchValues(batchTable){if(!Cesium.defined(batchTable._batchValues)){var byteLength=getByteLength(batchTable),bytes=new Uint8Array(byteLength);arrayFill_default(bytes,255),batchTable._batchValues=bytes}return batchTable._batchValues}function getTransValues(batchTable){if(!Cesium.defined(batchTable._transValues)){var byteLength=getByteLength(batchTable),bytes=new Float32Array(byteLength);arrayFill_default(bytes,0),batchTable._transValues=bytes}return batchTable._transValues}function getScaleValues(batchTable){if(!Cesium.defined(batchTable._scaleValues)){var byteLength=getByteLength(batchTable),bytes=new Float32Array(byteLength);arrayFill_default(bytes,1),batchTable._scaleValues=bytes}return batchTable._scaleValues}function getRotationValues(batchTable){if(!Cesium.defined(batchTable._rotationValues)){for(var byteLength=getByteLength(batchTable),bytes=new Float32Array(byteLength),i=0;i<byteLength;i+=4)bytes[i]=0,bytes[i+1]=0,bytes[i+2]=0,bytes[i+3]=1;batchTable._rotationValues=bytes}return batchTable._rotationValues}function getShowAlphaProperties(batchTable){if(!Cesium.defined(batchTable._showAlphaProperties)){var byteLength=2*batchTable.featuresLength,bytes=new Uint8Array(byteLength);arrayFill_default(bytes,255),batchTable._showAlphaProperties=bytes}return batchTable._showAlphaProperties}Cesium3DTileBatchTable.prototype.setShow=function(batchId,show){if(!(show&&!Cesium.defined(this._showAlphaProperties))){var showAlphaProperties=getShowAlphaProperties(this),propertyOffset=batchId*2,newShow=show?255:0;if(showAlphaProperties[propertyOffset]!==newShow){showAlphaProperties[propertyOffset]=newShow;var batchValues=getBatchValues(this),offset=batchId*4+3;batchValues[offset]=show?showAlphaProperties[propertyOffset+1]:0,this._batchValuesDirty=!0}}};Cesium3DTileBatchTable.prototype.setAllShow=function(show){for(var featuresLength=this.featuresLength,i=0;i<featuresLength;++i)this.setShow(i,show)};Cesium3DTileBatchTable.prototype.hasPropertyBySemantic=function(){return!1};Cesium3DTileBatchTable.prototype.getShow=function(batchId){if(!Cesium.defined(this._showAlphaProperties))return!0;var offset=batchId*2;return this._showAlphaProperties[offset]===255};var scratchColorBytes=new Array(4);Cesium3DTileBatchTable.prototype.setColor=function(batchId,color){if(!(Cesium.Color.equals(color,DEFAULT_COLOR_VALUE)&&!Cesium.defined(this._batchValues))){var newColor=color.toBytes(scratchColorBytes),newAlpha=newColor[3],batchValues=getBatchValues(this),offset=batchId*4,showAlphaProperties=getShowAlphaProperties(this),propertyOffset=batchId*2;if(batchValues[offset]!==newColor[0]||batchValues[offset+1]!==newColor[1]||batchValues[offset+2]!==newColor[2]||showAlphaProperties[propertyOffset+1]!==newAlpha){batchValues[offset]=newColor[0],batchValues[offset+1]=newColor[1],batchValues[offset+2]=newColor[2];var wasTranslucent=showAlphaProperties[propertyOffset+1]!==255,show=showAlphaProperties[propertyOffset]!==0;batchValues[offset+3]=show?newAlpha:0,showAlphaProperties[propertyOffset+1]=newAlpha;var isTranslucent2=newAlpha!==255;isTranslucent2&&!wasTranslucent?++this._translucentFeaturesLength:!isTranslucent2&&wasTranslucent&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,Cesium.defined(this._colorChangedCallback)&&this._colorChangedCallback(batchId,color)}}};Cesium3DTileBatchTable.prototype.setTranslation=function(batchId,translation){if(!(Cesium.Cartesian3.equals(translation,DEFAULT_TRANS_VALUE)&&!Cesium.defined(this._transValues))){Cesium.defined(this.upMatrix)&&Cesium.Matrix4.multiplyByPoint(this.upMatrix,translation,translation);var newTran=[];newTran.push(translation.x/1),newTran.push(translation.y/1),newTran.push(translation.z/1);var batchValues=getTransValues(this),offset=batchId*4;(batchValues[offset]!==newTran[0]||batchValues[offset+1]!==newTran[1]||batchValues[offset+2]!==newTran[2])&&(batchValues[offset]=newTran[0],batchValues[offset+1]=newTran[1],batchValues[offset+2]=newTran[2],this._batchValuesDirty=!0)}};var DEFAULT_SCALE_VALUE=new Cesium.Cartesian3(1,1,1);Cesium3DTileBatchTable.prototype.setScale=function(batchId,scale4){if(!(Cesium.Cartesian3.equals(scale4,DEFAULT_SCALE_VALUE)&&!Cesium.defined(this._scaleValues))){if(Cesium.defined(this.upMatrix)){var y2=scale4.y;scale4.y=scale4.z,scale4.z=y2}var newScale=[];newScale.push(scale4.x/1),newScale.push(scale4.y/1),newScale.push(scale4.z/1);var batchValues=getScaleValues(this),offset=batchId*4;(batchValues[offset]!==newScale[0]||batchValues[offset+1]!==newScale[1]||batchValues[offset+2]!==newScale[2])&&(batchValues[offset]=newScale[0],batchValues[offset+1]=newScale[1],batchValues[offset+2]=newScale[2],this._batchValuesDirty=!0)}};var DEFAULT_ROTATION_VALUE=new Cesium.Cartesian4(0,0,0,1);Cesium3DTileBatchTable.prototype.setRotation=function(batchId,rotation2){if(!(Cesium.Cartesian4.equals(rotation2,DEFAULT_ROTATION_VALUE)&&!Cesium.defined(this._rotationValues))){if(Cesium.defined(this.upMatrix)){var quaternion=new Cesium.Quaternion(rotation2.x,rotation2.y,rotation2.z,rotation2.w),angle3=Cesium.Quaternion.computeAngle(quaternion),axis=Cesium.Quaternion.computeAxis(quaternion,new Cesium.Cartesian3);Cesium.Matrix4.multiplyByPoint(this.upMatrix,axis,axis),rotation2=Cesium.Quaternion.fromAxisAngle(axis,angle3)}var newRotation=[];newRotation.push(rotation2.x),newRotation.push(rotation2.y),newRotation.push(rotation2.z),newRotation.push(rotation2.w);var batchValues=getRotationValues(this),offset=batchId*4;(batchValues[offset]!==newRotation[0]||batchValues[offset+1]!==newRotation[1]||batchValues[offset+2]!==newRotation[2]||batchValues[offset+3]!==newRotation[3])&&(batchValues[offset]=newRotation[0],batchValues[offset+1]=newRotation[1],batchValues[offset+2]=newRotation[2],batchValues[offset+3]=newRotation[3],this._batchValuesDirty=!0)}};Cesium3DTileBatchTable.prototype.setAllColor=function(color){for(var featuresLength=this.featuresLength,i=0;i<featuresLength;++i)this.setColor(i,color)};Cesium3DTileBatchTable.prototype.getColor=function(batchId,result){if(!Cesium.defined(this._batchValues))return Cesium.Color.clone(DEFAULT_COLOR_VALUE,result);var batchValues=this._batchValues,offset=batchId*4,showAlphaProperties=this._showAlphaProperties,propertyOffset=batchId*2;return Cesium.Color.fromBytes(batchValues[offset],batchValues[offset+1],batchValues[offset+2],showAlphaProperties[propertyOffset+1],result)};Cesium3DTileBatchTable.prototype.getPickColor=function(batchId){return this._pickIds[batchId]};var scratchColor=new Cesium.Color;Cesium3DTileBatchTable.prototype.applyStyle=function(style){if(!Cesium.defined(style)){this.setAllColor(DEFAULT_COLOR_VALUE),this.setAllShow(DEFAULT_SHOW_VALUE);return}for(var content=this._content,length3=this.featuresLength,i=0;i<length3;++i){var feature2=content.getFeature(i),color=Cesium.defined(style.color)?style.color.evaluateColor(feature2,scratchColor):DEFAULT_COLOR_VALUE,show=Cesium.defined(style.show)?style.show.evaluate(feature2):DEFAULT_SHOW_VALUE;if(this.setColor(i,color),this.setShow(i,show),Cesium.defined(style.translation)){var translation=style.translation.evaluate(feature2);this.setTranslation(i,translation)}if(Cesium.defined(style.scale)){var scale4=style.scale.evaluate(feature2);this.setScale(i,scale4)}if(Cesium.defined(style.rotation)){var rotation2=style.rotation.evaluate(feature2);this.setRotation(i,rotation2)}}};function getBinaryProperty(binaryProperty,index){var typedArray=binaryProperty.typedArray,componentCount=binaryProperty.componentCount;return componentCount===1?typedArray[index]:binaryProperty.type.unpack(typedArray,index*componentCount)}function setBinaryProperty(binaryProperty,index,value){var typedArray=binaryProperty.typedArray,componentCount=binaryProperty.componentCount;componentCount===1?typedArray[index]=value:binaryProperty.type.pack(value,typedArray,index*componentCount)}var scratchVisited=[],scratchStack=[],marker=0;function traverseHierarchyMultipleParents(hierarchy,instanceIndex,endConditionCallback){var classIds=hierarchy.classIds,parentCounts=hierarchy.parentCounts,parentIds=hierarchy.parentIds,parentIndexes=hierarchy.parentIndexes,instancesLength=classIds.length,visited=scratchVisited;visited.length=Math.max(visited.length,instancesLength);var visitedMarker=++marker,stack=scratchStack;for(stack.length=0,stack.push(instanceIndex);stack.length>0;)if(instanceIndex=stack.pop(),visited[instanceIndex]!==visitedMarker){visited[instanceIndex]=visitedMarker;var result=endConditionCallback(hierarchy,instanceIndex);if(Cesium.defined(result))return result;for(var parentCount=parentCounts[instanceIndex],parentIndex=parentIndexes[instanceIndex],i=0;i<parentCount;++i){var parentId=parentIds[parentIndex+i];parentId!==instanceIndex&&stack.push(parentId)}}}function traverseHierarchySingleParent(hierarchy,instanceIndex,endConditionCallback){for(var hasParent=!0;hasParent;){var result=endConditionCallback(hierarchy,instanceIndex);if(Cesium.defined(result))return result;var parentId=hierarchy.parentIds[instanceIndex];hasParent=parentId!==instanceIndex,instanceIndex=parentId}}function traverseHierarchy(hierarchy,instanceIndex,endConditionCallback){var parentCounts=hierarchy.parentCounts,parentIds=hierarchy.parentIds;if(Cesium.defined(parentIds)){if(Cesium.defined(parentCounts))return traverseHierarchyMultipleParents(hierarchy,instanceIndex,endConditionCallback)}else return endConditionCallback(hierarchy,instanceIndex);return traverseHierarchySingleParent(hierarchy,instanceIndex,endConditionCallback)}function hasPropertyInHierarchy(batchTable,batchId,name){var hierarchy=batchTable._batchTableHierarchy,result=traverseHierarchy(hierarchy,batchId,function(hierarchy2,instanceIndex){var classId=hierarchy2.classIds[instanceIndex],instances=hierarchy2.classes[classId].instances;if(Cesium.defined(instances[name]))return!0});return Cesium.defined(result)}function getPropertyNamesInHierarchy(batchTable,batchId,results){var hierarchy=batchTable._batchTableHierarchy;traverseHierarchy(hierarchy,batchId,function(hierarchy2,instanceIndex){var classId=hierarchy2.classIds[instanceIndex],instances=hierarchy2.classes[classId].instances;for(var name in instances)instances.hasOwnProperty(name)&&results.indexOf(name)===-1&&results.push(name)})}function getHierarchyProperty(batchTable,batchId,name){var hierarchy=batchTable._batchTableHierarchy;return traverseHierarchy(hierarchy,batchId,function(hierarchy2,instanceIndex){var classId=hierarchy2.classIds[instanceIndex],instanceClass=hierarchy2.classes[classId],indexInClass=hierarchy2.classIndexes[instanceIndex],propertyValues=instanceClass.instances[name];if(Cesium.defined(propertyValues))return Cesium.defined(propertyValues.typedArray)?getBinaryProperty(propertyValues,indexInClass):Cesium.clone(propertyValues[indexInClass],!0)})}function setHierarchyProperty(batchTable,batchId,name,value){var hierarchy=batchTable._batchTableHierarchy,result=traverseHierarchy(hierarchy,batchId,function(hierarchy2,instanceIndex){var classId=hierarchy2.classIds[instanceIndex],instanceClass=hierarchy2.classes[classId],indexInClass=hierarchy2.classIndexes[instanceIndex],propertyValues=instanceClass.instances[name];if(Cesium.defined(propertyValues))return Cesium.defined(propertyValues.typedArray)?setBinaryProperty(propertyValues,indexInClass,value):propertyValues[indexInClass]=Cesium.clone(value,!0),!0});return Cesium.defined(result)}Cesium3DTileBatchTable.prototype.isClass=function(batchId,className){var hierarchy=this._batchTableHierarchy;if(!Cesium.defined(hierarchy))return!1;var result=traverseHierarchy(hierarchy,batchId,function(hierarchy2,instanceIndex){var classId=hierarchy2.classIds[instanceIndex],instanceClass=hierarchy2.classes[classId];if(instanceClass.name===className)return!0});return Cesium.defined(result)};Cesium3DTileBatchTable.prototype.isExactClass=function(batchId,className){return this.getExactClassName(batchId)===className};Cesium3DTileBatchTable.prototype.getExactClassName=function(batchId){var hierarchy=this._batchTableHierarchy;if(!!Cesium.defined(hierarchy)){var classId=hierarchy.classIds[batchId],instanceClass=hierarchy.classes[classId];return instanceClass.name}};Cesium3DTileBatchTable.prototype.hasProperty=function(batchId,name){return Cesium.defined(this._properties[name])||Cesium.defined(this._batchTableHierarchy)&&hasPropertyInHierarchy(this,batchId,name)};Cesium3DTileBatchTable.prototype.getPropertyNames=function(batchId,results){results=Cesium.defined(results)?results:[],results.length=0;var propertyNames=Object.keys(this._properties);return results.push.apply(results,propertyNames),Cesium.defined(this._batchTableHierarchy)&&getPropertyNamesInHierarchy(this,batchId,results),results};Cesium3DTileBatchTable.prototype.getProperty=function(batchId,name){if(Cesium.defined(this._batchTableBinaryProperties)){var binaryProperty=this._batchTableBinaryProperties[name];if(Cesium.defined(binaryProperty))return getBinaryProperty(binaryProperty,batchId)}var propertyValues=this._properties[name];if(Cesium.defined(propertyValues))return Cesium.clone(propertyValues[batchId],!0);if(Cesium.defined(this._batchTableHierarchy)){var hierarchyProperty=getHierarchyProperty(this,batchId,name);if(Cesium.defined(hierarchyProperty))return hierarchyProperty}};Cesium3DTileBatchTable.prototype.setProperty=function(batchId,name,value){var featuresLength=this.featuresLength;if(Cesium.defined(this._batchTableBinaryProperties)){var binaryProperty=this._batchTableBinaryProperties[name];if(Cesium.defined(binaryProperty)){setBinaryProperty(binaryProperty,batchId,value);return}}if(!(Cesium.defined(this._batchTableHierarchy)&&setHierarchyProperty(this,batchId,name,value))){var propertyValues=this._properties[name];Cesium.defined(propertyValues)||(this._properties[name]=new Array(featuresLength),propertyValues=this._properties[name]),propertyValues[batchId]=Cesium.clone(value,!0)}};function getGlslComputeSt(batchTable){return batchTable._textureDimensions.y===1?`uniform vec4 tile_textureStep; 
vec2 computeSt(float batchId) 
{ 
    float stepX = tile_textureStep.x; 
    float centerX = tile_textureStep.y; 
    return vec2(centerX + (batchId * stepX), 0.5); 
} 
`:`uniform vec4 tile_textureStep; 
uniform vec2 tile_textureDimensions; 
vec2 computeSt(float batchId) 
{ 
    float stepX = tile_textureStep.x; 
    float centerX = tile_textureStep.y; 
    float stepY = tile_textureStep.z; 
    float centerY = tile_textureStep.w; 
    float xId = mod(batchId, tile_textureDimensions.x); 
    float yId = floor(batchId / tile_textureDimensions.x); 
    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); 
} 
`}var ev_fromTranslationQuaternionRotationScale=`mat4 ev_fromTranslationQuaternionRotationScale(vec3 translation, vec4 quaternion, vec3 scale)
{
      float x2 = quaternion.x * quaternion.x;
      float xy = quaternion.x * quaternion.y;
      float xz = quaternion.x * quaternion.z;
      float xw = quaternion.x * quaternion.w;
      float y2 = quaternion.y * quaternion.y;
      float yz = quaternion.y * quaternion.z;
      float yw = quaternion.y * quaternion.w;
      float z2 = quaternion.z * quaternion.z;
      float zw = quaternion.z * quaternion.w;
      float w2 = quaternion.w * quaternion.w;

      float m00 = x2 - y2 - z2 + w2;
      float m01 = 2.0 * (xy - zw);
      float m02 = 2.0 * (xz + yw);

      float m10 = 2.0 * (xy + zw);
      float m11 = -x2 + y2 - z2 + w2;
      float m12 = 2.0 * (yz - xw);

      float m20 = 2.0 * (xz - yw);
      float m21 = 2.0 * (yz + xw);
      float m22 = -x2 - y2 + z2 + w2;
      return mat4(
        m00 * scale.x , m01* scale.x, m02* scale.x, 0.0,
        m10 * scale.y, m11 * scale.y, m12 * scale.y, 0.0,
        m20 * scale.z, m21 * scale.z, m22 * scale.z, 0.0,
        translation.x, translation.y, translation.z, 1.0);
}
`;Cesium3DTileBatchTable.prototype.getVertexShaderCallback=function(handleTranslucent,batchIdAttributeName,diffuseAttributeOrUniformName){if(this.featuresLength!==0){var that=this;return function(source){var renamedSource=modifyDiffuse(source,diffuseAttributeOrUniformName,!1),addEv=!1;NO_support_OES_float||(renamedSource.indexOf("gl_Position = u_modelViewProj * vec4(a_position,1.0);")!=-1?(addEv=!0,renamedSource=renamedSource.replace("attribute vec3 a_position;",`attribute vec3 a_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),renamedSource=renamedSource.replace("gl_Position = u_modelViewProj * vec4(a_position,1.0);","gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(a_position,1.0));"),renamedSource=ev_fromTranslationQuaternionRotationScale+renamedSource):renamedSource.indexOf("vec3 gltf_a_dec_position")!=-1?(addEv=!0,renamedSource=renamedSource.replace("vec3 gltf_a_dec_position;",`vec3 gltf_a_dec_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),renamedSource.indexOf("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0)")!=-1?renamedSource=renamedSource.replace("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0);"," gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0));"):renamedSource.indexOf("gl_Position = czm_instanced_modelViewProjection * vec4(gltf_a_dec_position,1.0)")!=-1?renamedSource=renamedSource.replace("gltf_a_dec_position = gltf_u_dec_position_min + a_position * gltf_u_dec_position_normConstant;","gltf_a_dec_position = gltf_u_dec_position_min + (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(a_position,1.0)).xyz* gltf_u_dec_position_normConstant;"):renamedSource.indexOf("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0)")!=-1&&(renamedSource=renamedSource.replace("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0);","xlat_temp_input.position = ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0);")),renamedSource=ev_fromTranslationQuaternionRotationScale+renamedSource):renamedSource.indexOf("position = u_modelViewMatrix * position")!=-1&&(addEv=!0,renamedSource=renamedSource.replace("attribute vec3 a_position;",`attribute vec3 a_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),renamedSource=renamedSource.replace("position = u_modelViewMatrix * position;","position = u_modelViewMatrix * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * position);"),renamedSource=ev_fromTranslationQuaternionRotationScale+renamedSource));var newMain;Cesium.ContextLimits.maximumVertexTextureImageUnits>0?(newMain="",handleTranslucent&&(newMain+=`uniform bool tile_translucentCommand; 
`),addEv&&(newMain+=`uniform sampler2D tile_transTexture; 
uniform sampler2D tile_scaleTexture; 
uniform sampler2D tile_rotationTexture; 
`),newMain+=`uniform sampler2D tile_batchTexture; 
varying vec4 tile_featureColor; 
varying vec2 tile_featureSt; 
void main() 
{ 
    vec2 st = computeSt(`+batchIdAttributeName+`); 
    vec4 featureProperties = texture2D(tile_batchTexture, st); 
`,addEv&&(newMain+=`    trans = texture2D(tile_transTexture, vec2(st.x,0.0)); 
`,newMain+=`    scale = texture2D(tile_scaleTexture, vec2(st.x,0.0)); 
`,newMain+=`    rotation = texture2D(tile_rotationTexture, vec2(st.x,0.0)); 
`),newMain+=`    tile_color(featureProperties); 
    float show = ceil(featureProperties.a); 
    gl_Position *= show; 
`,handleTranslucent&&(newMain+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
`),newMain+=`    tile_featureColor = featureProperties; 
    tile_featureSt = st; 
}`):newMain=`varying vec2 tile_featureSt; 
void main() 
{ 
    tile_color(vec4(1.0)); 
    tile_featureSt = computeSt(`+batchIdAttributeName+`); 
}`;var drawVS=renamedSource+`
`+getGlslComputeSt(that)+newMain;return that._content.constructor.name==="Vector3DTileContent"&&that._content._tileset._tilesetFlat&&(drawVS=that._content._tileset._tilesetFlat._updateVertexShader(drawVS)),drawVS}}};function getDefaultShader(source,applyHighlight){return source=Cesium.ShaderSource.replaceMain(source,"tile_main"),applyHighlight?source+`uniform float tile_colorBlend; 
void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    gl_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
 if(!all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ 
	if(highlight== 0.0){
		gl_FragColor.rgb = mix(tile_featureColor.rgb, gl_FragColor.rgb, 0.4);
	}else if(highlight== 1.0){
		gl_FragColor.rgb = tile_featureColor.rgb;
	}else{
		gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight);
	}
 } 
} 
`:source+`void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
} 
`}function replaceDiffuseTextureCalls(source,diffuseAttributeOrUniformName){for(var functionCall="texture2D("+diffuseAttributeOrUniformName,fromIndex=0,startIndex=source.indexOf(functionCall,fromIndex),endIndex;startIndex>-1;){for(var nestedLevel=0,i=startIndex;i<source.length;++i){var character=source.charAt(i);if(character==="(")++nestedLevel;else if(character===")"&&(--nestedLevel,nestedLevel===0)){endIndex=i+1;break}}var extractedFunction=source.slice(startIndex,endIndex),replacedFunction="tile_diffuse_final("+extractedFunction+", tile_diffuse)";source=source.slice(0,startIndex)+replacedFunction+source.slice(endIndex),fromIndex=startIndex+replacedFunction.length,startIndex=source.indexOf(functionCall,fromIndex)}return source}function modifyDiffuse(source,diffuseAttributeOrUniformName,applyHighlight){if(!Cesium.defined(diffuseAttributeOrUniformName))return getDefaultShader(source,applyHighlight);var regex=new RegExp("(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+"+diffuseAttributeOrUniformName+";"),uniformMatch=source.match(regex);if(!Cesium.defined(uniformMatch))return getDefaultShader(source,applyHighlight);var declaration=uniformMatch[0],type=uniformMatch[2];source=Cesium.ShaderSource.replaceMain(source,"tile_main"),source=source.replace(declaration,"");var finalDiffuseFunction=`bool isWhite(vec3 color) 
{ 
    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); 
} 
vec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) 
{ 
    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); 
    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; 
    return vec4(diffuse.rgb, sourceDiffuse.a); 
} 
`,highlight=`    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    gl_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
 if(!all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ 
	if(highlight== 0.0){
		gl_FragColor.rgb = mix(tile_featureColor.rgb, gl_FragColor.rgb, 0.4);
	}else if(highlight== 1.0){
		gl_FragColor.rgb = tile_featureColor.rgb;
	}else{
		gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight);
	}
 }`,setColor2;if(type==="vec3"||type==="vec4"){var sourceDiffuse=type==="vec3"?"vec4("+diffuseAttributeOrUniformName+", 1.0)":diffuseAttributeOrUniformName,replaceDiffuse=type==="vec3"?"tile_diffuse.xyz":"tile_diffuse";regex=new RegExp(diffuseAttributeOrUniformName,"g"),source=source.replace(regex,replaceDiffuse),setColor2="    vec4 source = "+sourceDiffuse+`; 
    tile_diffuse = tile_diffuse_final(source, tile_featureColor); 
    tile_main(); 
`}else type==="sampler2D"&&(source=replaceDiffuseTextureCalls(source,diffuseAttributeOrUniformName),setColor2=`    tile_diffuse = tile_featureColor; 
    tile_main(); 
`);return source=`uniform float tile_colorBlend; 
vec4 tile_diffuse = vec4(1.0); 
`+finalDiffuseFunction+declaration+`
`+source+`
void tile_color(vec4 tile_featureColor) 
{ 
`+setColor2,applyHighlight&&(source+=highlight),source+=`} 
`,source}Cesium3DTileBatchTable.prototype.getFragmentShaderCallback=function(handleTranslucent,diffuseAttributeOrUniformName){if(this.featuresLength!==0)return function(source){return source=modifyDiffuse(source,diffuseAttributeOrUniformName,!0),Cesium.ContextLimits.maximumVertexTextureImageUnits>0?source+=`uniform sampler2D tile_pickTexture; 
varying vec2 tile_featureSt; 
varying vec4 tile_featureColor; 
void main() 
{ 
    tile_color(tile_featureColor); 
}`:(handleTranslucent&&(source+=`uniform bool tile_translucentCommand; 
`),source+=`uniform sampler2D tile_pickTexture; 
uniform sampler2D tile_batchTexture; 
varying vec2 tile_featureSt; 
void main() 
{ 
    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); 
    if (featureProperties.a == 0.0) { 
        discard; 
    } 
`,handleTranslucent&&(source+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            discard; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            discard; 
        } 
    } 
`),source+=`    tile_color(featureProperties); 
} 
`),source}};Cesium3DTileBatchTable.prototype.getClassificationFragmentShaderCallback=function(){if(this.featuresLength!==0)return function(source){return source=Cesium.ShaderSource.replaceMain(source,"tile_main"),Cesium.ContextLimits.maximumVertexTextureImageUnits>0?source+=`uniform sampler2D tile_pickTexture;
varying vec2 tile_featureSt; 
varying vec4 tile_featureColor; 
void main() 
{ 
    tile_main(); 
    gl_FragColor = tile_featureColor; 
}`:source+=`uniform sampler2D tile_batchTexture; 
uniform sampler2D tile_pickTexture;
varying vec2 tile_featureSt; 
void main() 
{ 
    tile_main(); 
    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); 
    if (featureProperties.a == 0.0) { 
        discard; 
    } 
    gl_FragColor = featureProperties; 
} 
`,source}};function getColorBlend(batchTable){var tileset=batchTable._content.tileset,colorBlendMode=tileset.colorBlendMode,colorBlendAmount=tileset.colorBlendAmount;if(colorBlendMode===Cesium.Cesium3DTileColorBlendMode.HIGHLIGHT)return 0;if(colorBlendMode===Cesium.Cesium3DTileColorBlendMode.REPLACE)return 1;if(colorBlendMode===Cesium.Cesium3DTileColorBlendMode.MIX)return Cesium.Math.clamp(colorBlendAmount,Cesium.Math.EPSILON4,1)}Cesium3DTileBatchTable.prototype.getUniformMapCallback=function(){if(this.featuresLength!==0){var that=this;return function(uniformMap){var batchUniformMap={tile_batchTexture:function(){return Cesium.defaultValue(that._batchTexture,that._defaultTexture)},tile_transTexture:function(){return Cesium.defaultValue(that._translationTexture,that._defaultTransTexture)},tile_scaleTexture:function(){return Cesium.defaultValue(that._scaleTexture,that._defaultScaleTexture)},tile_rotationTexture:function(){return Cesium.defaultValue(that._rotationTexture,that._defaultRotationTexture)},tile_textureDimensions:function(){return that._textureDimensions},tile_textureStep:function(){return that._textureStep},tile_colorBlend:function(){return getColorBlend(that)},tile_pickTexture:function(){return Cesium.defaultValue(that._pickTexture,that._defaultTexture)}};return that._content.constructor.name==="Vector3DTileContent"&&that._content._tileset._tilesetFlat&&(uniformMap=Cesium.combine(uniformMap,that._content._tileset._tilesetFlat._updateModelUniformMap())),Cesium.combine(uniformMap,batchUniformMap)}}};Cesium3DTileBatchTable.prototype.getPickId=function(){return"texture2D(tile_pickTexture, tile_featureSt)"};var StyleCommandsNeeded={ALL_OPAQUE:0,ALL_TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2};Cesium3DTileBatchTable.prototype.addDerivedCommands=function(frameState,commandStart){for(var commandList=frameState.commandList,commandEnd=commandList.length,tile=this._content._tile,finalResolution=tile._finalResolution,tileset=tile.tileset,bivariateVisibilityTest=tileset._skipLevelOfDetail&&tileset._hasMixedContent&&frameState.context.stencilBuffer,styleCommandsNeeded=getStyleCommandsNeeded(this),i=commandStart;i<commandEnd;++i){var command=commandList[i],derivedCommands=command.derivedCommands.tileset;(!Cesium.defined(derivedCommands)||command.dirty)&&(derivedCommands={},command.derivedCommands.tileset=derivedCommands,derivedCommands.originalCommand=deriveCommand(command),command.dirty=!1);var originalCommand=derivedCommands.originalCommand;styleCommandsNeeded!==StyleCommandsNeeded.ALL_OPAQUE&&command.pass!==Cesium.Pass.TRANSLUCENT&&(Cesium.defined(derivedCommands.translucent)||(derivedCommands.translucent=deriveTranslucentCommand(originalCommand))),styleCommandsNeeded!==StyleCommandsNeeded.ALL_TRANSLUCENT&&command.pass!==Cesium.Pass.TRANSLUCENT&&(Cesium.defined(derivedCommands.opaque)||(derivedCommands.opaque=deriveOpaqueCommand(originalCommand)),bivariateVisibilityTest&&(finalResolution||(Cesium.defined(derivedCommands.zback)||(derivedCommands.zback=deriveZBackfaceCommand(frameState.context,originalCommand)),tileset._backfaceCommands.push(derivedCommands.zback)),(!Cesium.defined(derivedCommands.stencil)||tile._selectionDepth!==getLastSelectionDepth(derivedCommands.stencil))&&(command.renderState.depthMask?derivedCommands.stencil=deriveStencilCommand(originalCommand,tile._selectionDepth):derivedCommands.stencil=derivedCommands.opaque)));var opaqueCommand=bivariateVisibilityTest?derivedCommands.stencil:derivedCommands.opaque,translucentCommand=derivedCommands.translucent;command.pass!==Cesium.Pass.TRANSLUCENT?(styleCommandsNeeded===StyleCommandsNeeded.ALL_OPAQUE&&(commandList[i]=opaqueCommand),styleCommandsNeeded===StyleCommandsNeeded.ALL_TRANSLUCENT&&(commandList[i]=translucentCommand),styleCommandsNeeded===StyleCommandsNeeded.OPAQUE_AND_TRANSLUCENT&&(commandList[i]=opaqueCommand,commandList.push(translucentCommand))):commandList[i]=originalCommand}};function getStyleCommandsNeeded(batchTable){var translucentFeaturesLength=batchTable._translucentFeaturesLength;return translucentFeaturesLength===0?StyleCommandsNeeded.ALL_OPAQUE:translucentFeaturesLength===batchTable.featuresLength?StyleCommandsNeeded.ALL_TRANSLUCENT:StyleCommandsNeeded.OPAQUE_AND_TRANSLUCENT}function deriveCommand(command){var derivedCommand=Cesium.DrawCommand.shallowClone(command),translucentCommand=derivedCommand.pass===Cesium.Pass.TRANSLUCENT;return derivedCommand.uniformMap=Cesium.defined(derivedCommand.uniformMap)?derivedCommand.uniformMap:{},derivedCommand.uniformMap.tile_translucentCommand=function(){return translucentCommand},derivedCommand}function deriveTranslucentCommand(command){var derivedCommand=Cesium.DrawCommand.shallowClone(command);return derivedCommand.pass=Cesium.Pass.TRANSLUCENT,derivedCommand.renderState=getTranslucentRenderState(command.renderState),derivedCommand}function deriveOpaqueCommand(command){var derivedCommand=Cesium.DrawCommand.shallowClone(command);return derivedCommand.renderState=getOpaqueRenderState(command.renderState),derivedCommand}function getLogDepthPolygonOffsetFragmentShaderProgram(context,shaderProgram){var shader=context.shaderCache.getDerivedShaderProgram(shaderProgram,"zBackfaceLogDepth");if(!Cesium.defined(shader)){var fs=shaderProgram.fragmentShaderSource.clone();fs.defines=Cesium.defined(fs.defines)?fs.defines.slice(0):[],fs.defines.push("POLYGON_OFFSET"),fs.sources.unshift(`#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
#endif
`),shader=context.shaderCache.createDerivedShaderProgram(shaderProgram,"zBackfaceLogDepth",{vertexShaderSource:shaderProgram.vertexShaderSource,fragmentShaderSource:fs,attributeLocations:shaderProgram._attributeLocations})}return shader}function deriveZBackfaceCommand(context,command){var derivedCommand=Cesium.DrawCommand.shallowClone(command),rs=Cesium.clone(derivedCommand.renderState,!0);rs.cull.enabled=!0,rs.cull.face=Cesium.CullFace.FRONT,rs.colorMask={red:!1,green:!1,blue:!1,alpha:!1},rs.polygonOffset={enabled:!0,factor:5,units:5},rs.stencilTest=Cesium.StencilConstants.setCesium3DTileBit(),rs.stencilMask=Cesium.StencilConstants.CESIUM_3D_TILE_MASK,derivedCommand.renderState=Cesium.RenderState.fromCache(rs),derivedCommand.castShadows=!1,derivedCommand.receiveShadows=!1,derivedCommand.uniformMap=Cesium.clone(command.uniformMap);var polygonOffset=new Cesium.Cartesian2(5,5);return derivedCommand.uniformMap.u_polygonOffset=function(){return polygonOffset},derivedCommand.shaderProgram=getLogDepthPolygonOffsetFragmentShaderProgram(context,command.shaderProgram),derivedCommand}function deriveStencilCommand(command,reference){var derivedCommand=Cesium.DrawCommand.shallowClone(command),rs=Cesium.clone(derivedCommand.renderState,!0);return rs.stencilTest.enabled=!0,rs.stencilTest.mask=Cesium.StencilConstants.SKIP_LOD_MASK,rs.stencilTest.reference=Cesium.StencilConstants.CESIUM_3D_TILE_MASK|reference<<Cesium.StencilConstants.SKIP_LOD_BIT_SHIFT,rs.stencilTest.frontFunction=Cesium.StencilFunction.GREATER_OR_EQUAL,rs.stencilTest.frontOperation.zPass=Cesium.StencilOperation.REPLACE,rs.stencilTest.backFunction=Cesium.StencilFunction.GREATER_OR_EQUAL,rs.stencilTest.backOperation.zPass=Cesium.StencilOperation.REPLACE,rs.stencilMask=Cesium.StencilConstants.CESIUM_3D_TILE_MASK|Cesium.StencilConstants.SKIP_LOD_MASK,derivedCommand.renderState=Cesium.RenderState.fromCache(rs),derivedCommand}function getLastSelectionDepth(stencilCommand){var reference=stencilCommand.renderState.stencilTest.reference;return(reference&Cesium.StencilConstants.SKIP_LOD_MASK)>>>Cesium.StencilConstants.SKIP_LOD_BIT_SHIFT}function getTranslucentRenderState(renderState){var rs=Cesium.clone(renderState,!0);return rs.cull.enabled=!1,rs.depthTest.enabled=!0,rs.depthMask=!1,rs.blending=Cesium.BlendingState.ALPHA_BLEND,Cesium.RenderState.fromCache(rs)}function getOpaqueRenderState(renderState){var rs=Cesium.clone(renderState,!0);return rs.stencilTest=Cesium.StencilConstants.setCesium3DTileBit(),rs.stencilMask=Cesium.StencilConstants.CESIUM_3D_TILE_MASK,Cesium.RenderState.fromCache(rs)}function createTexture(batchTable,context,bytes){var dimensions=batchTable._textureDimensions;return new Texture_default({context,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_BYTE,source:{width:dimensions.x,height:dimensions.y,arrayBufferView:bytes},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function createSRTTexture(batchTable,context,bytes){var dimensions=batchTable._textureDimensions;return new Texture_default({context,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:dimensions.x,height:dimensions.y,arrayBufferView:bytes},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function createPickTexture(batchTable,context){var featuresLength=batchTable.featuresLength;if(!Cesium.defined(batchTable._pickTexture)&&featuresLength>0){for(var pickIds=batchTable._pickIds,byteLength=getByteLength(batchTable),bytes=new Uint8Array(byteLength),content=batchTable._content,i=0;i<featuresLength;++i){var pickId=context.createPickId(content.getFeature(i));pickIds.push(pickId);var pickColor=pickId.color,offset=i*4;bytes[offset]=Cesium.Color.floatToByte(pickColor.red),bytes[offset+1]=Cesium.Color.floatToByte(pickColor.green),bytes[offset+2]=Cesium.Color.floatToByte(pickColor.blue),bytes[offset+3]=Cesium.Color.floatToByte(pickColor.alpha)}batchTable._pickTexture=createTexture(batchTable,context,bytes),content.tileset._statistics.batchTableByteLength+=batchTable._pickTexture.sizeInBytes}}function updateBatchTexture(batchTable){var dimensions=batchTable._textureDimensions;batchTable._batchTexture.copyFrom({width:dimensions.x,height:dimensions.y,arrayBufferView:batchTable._batchValues})}function updateSRTTexture(batchTable,arrayBuffer,texture){var dimensions=batchTable._textureDimensions;texture.copyFrom({width:dimensions.x,height:dimensions.y,arrayBufferView:arrayBuffer})}function createDefaultTRTexture(batchTable,context){return new Texture_default({context,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([0,0,0,1])},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function createDefaultScaleTexture(batchTable,context){return new Texture_default({context,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([1,1,1,1])},flipY:!1,sampler:Cesium.Sampler.NEAREST})}Cesium3DTileBatchTable.prototype.update=function(tileset,frameState){var context=frameState.context;this._defaultTexture=context.defaultTexture,!NO_support_OES_float&&!Cesium.defined(this._defaultTransTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultTransTexture=createDefaultTRTexture(this,context)),!NO_support_OES_float&&!Cesium.defined(this._defaultScaleTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultScaleTexture=createDefaultScaleTexture(this,context)),!NO_support_OES_float&&!Cesium.defined(this._defaultRotationTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultRotationTexture=createDefaultTRTexture(this,context));var passes=frameState.passes;(passes.pick||passes.postProcess)&&createPickTexture(this,context),this._batchValuesDirty&&(this._batchValuesDirty=!1,!Cesium.defined(this._batchTexture)&&Cesium.defined(this._batchValues)&&(this._batchTexture=createTexture(this,context,this._batchValues),tileset._statistics.batchTableByteLength+=this._batchTexture.sizeInBytes),!NO_support_OES_float&&!Cesium.defined(this._translationTexture)&&Cesium.defined(this._transValues)&&(this._translationTexture=createSRTTexture(this,context,this._transValues)),!NO_support_OES_float&&!Cesium.defined(this._scaleTexture)&&Cesium.defined(this._scaleValues)&&(this._scaleTexture=createSRTTexture(this,context,this._scaleValues)),!NO_support_OES_float&&!Cesium.defined(this._rotationTexture)&&Cesium.defined(this._rotationValues)&&(this._rotationTexture=createSRTTexture(this,context,this._rotationValues)),Cesium.defined(this._batchValues)&&updateBatchTexture(this),!NO_support_OES_float&&Cesium.defined(this._transValues)&&updateSRTTexture(this,this._transValues,this._translationTexture),!NO_support_OES_float&&Cesium.defined(this._scaleValues)&&updateSRTTexture(this,this._scaleValues,this._scaleTexture),!NO_support_OES_float&&Cesium.defined(this._rotationValues)&&updateSRTTexture(this,this._rotationValues,this._rotationTexture))};Cesium3DTileBatchTable.prototype.updateNoStatistics=function(tileset,frameState){var context=frameState.context;this._defaultTexture=context.defaultTexture,!NO_support_OES_float&&!Cesium.defined(this._defaultTransTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultTransTexture=createDefaultTRTexture(this,context)),!NO_support_OES_float&&!Cesium.defined(this._defaultScaleTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultTransTexture=createDefaultScaleTexture(this,context)),!NO_support_OES_float&&!Cesium.defined(this._defaultRotationTexture)&&Cesium.defined(this._textureDimensions)&&(this._defaultTransTexture=createDefaultTRTexture(this,context));var passes=frameState.passes;(passes.pick||passes.postProcess)&&createPickTexture(this,context),this._batchValuesDirty&&(this._batchValuesDirty=!1,!Cesium.defined(this._batchTexture)&&Cesium.defined(this._batchValues)&&(this._batchTexture=createTexture(this,context,this._batchValues)),!NO_support_OES_float&&!Cesium.defined(this._translationTexture)&&Cesium.defined(this._transValues)&&(this._translationTexture=createSRTTexture(this,context,this._transValues)),!NO_support_OES_float&&!Cesium.defined(this._scaleTexture)&&Cesium.defined(this._scaleValues)&&(this._scaleTexture=createSRTTexture(this,context,this._scaleValues)),!NO_support_OES_float&&!Cesium.defined(this._rotationTexture)&&Cesium.defined(this._rotationValues)&&(this._rotationTexture=createSRTTexture(this,context,this._rotationValues)),Cesium.defined(this._batchValues)&&updateBatchTexture(this),!NO_support_OES_float&&Cesium.defined(this._transValues)&&updateSRTTexture(this,this._transValues,this._translationTexture),!NO_support_OES_float&&Cesium.defined(this._scaleValues)&&updateSRTTexture(this,this._scaleValues,this._scaleTexture),!NO_support_OES_float&&Cesium.defined(this._rotationValues)&&updateSRTTexture(this,this._rotationValues,this._rotationTexture))};Cesium3DTileBatchTable.prototype.isDestroyed=function(){return!1};Cesium3DTileBatchTable.prototype.destroy=function(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._translationTexture=this._translationTexture&&this._translationTexture.destroy(),this._scaleTexture=this._scaleTexture&&this._scaleTexture.destroy(),this._rotationTexture=this._rotationTexture&&this._rotationTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy();for(var pickIds=this._pickIds,length3=pickIds.length,i=0;i<length3;++i)pickIds[i].destroy();return Cesium.destroyObject(this)};Cesium3DTileBatchTable._DEFAULT_COLOR_VALUE=DEFAULT_COLOR_VALUE;Cesium3DTileBatchTable._DEFAULT_SHOW_VALUE=DEFAULT_SHOW_VALUE;var Cesium3DTileBatchTable_default=Cesium3DTileBatchTable;function Cesium3DTileFeature(content,batchId){this._content=content,this._batchId=batchId,this._color=void 0,this.cesium3DTileFeature=!0}Object.defineProperties(Cesium3DTileFeature.prototype,{show:{get:function(){return this._content.batchTable.getShow(this._batchId)},set:function(value){this._content.batchTable.setShow(this._batchId,value)}},color:{get:function(){return Cesium.defined(this._color)||(this._color=new Cesium.Color),this._content.batchTable.getColor(this._batchId,this._color)},set:function(value){this._content.batchTable.setColor(this._batchId,value)}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickId:{get:function(){if(!this._content.isDestroyed())return this._content.batchTable.getPickColor(this._batchId)}}});Cesium3DTileFeature.prototype.hasProperty=function(name){return this._content.batchTable.hasProperty(this._batchId,name)};Cesium3DTileFeature.prototype.getPropertyNames=function(results){return this._content.batchTable.getPropertyNames(this._batchId,results)};Cesium3DTileFeature.prototype.getProperty=function(name){return this._content.batchTable.getProperty(this._batchId,name)};Cesium3DTileFeature.prototype.getPropertyInherited=function(name){return this._content.batchTable.getProperty(this._batchId,name)};Cesium3DTileFeature.prototype.setProperty=function(name,value){this._content.batchTable.setProperty(this._batchId,name,value),this._content.featurePropertiesDirty=!0};Cesium3DTileFeature.prototype.setTranslation=function(value){this._content.batchTable.setTranslation(this._batchId,value)};Cesium3DTileFeature.prototype.setScale=function(value){this._content.batchTable.setScale(this._batchId,value)};Cesium3DTileFeature.prototype.setRotation=function(value){this._content.batchTable.setRotation(this._batchId,value)};Cesium3DTileFeature.prototype.isExactClass=function(className){return this._content.batchTable.isExactClass(this._batchId,className)};Cesium3DTileFeature.prototype.isClass=function(className){return this._content.batchTable.isClass(this._batchId,className)};Cesium3DTileFeature.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var Cesium3DTileFeature_default=Cesium3DTileFeature;function Cesium3DTileFeatureTable(featureTableJson,featureTableBinary){this.json=featureTableJson,this.buffer=featureTableBinary,this._cachedTypedArrays={},this.featuresLength=0}function getTypedArrayFromBinary(featureTable,semantic,componentType,componentLength,count2,byteOffset){var cachedTypedArrays=featureTable._cachedTypedArrays,typedArray=cachedTypedArrays[semantic];return Cesium.defined(typedArray)||(typedArray=Cesium.ComponentDatatype.createArrayBufferView(componentType,featureTable.buffer.buffer,featureTable.buffer.byteOffset+byteOffset,count2*componentLength),cachedTypedArrays[semantic]=typedArray),typedArray}function getTypedArrayFromArray(featureTable,semantic,componentType,array){var cachedTypedArrays=featureTable._cachedTypedArrays,typedArray=cachedTypedArrays[semantic];return Cesium.defined(typedArray)||(typedArray=Cesium.ComponentDatatype.createTypedArray(componentType,array),cachedTypedArrays[semantic]=typedArray),typedArray}Cesium3DTileFeatureTable.prototype.getGlobalProperty=function(semantic,componentType,componentLength){var jsonValue=this.json[semantic];if(!!Cesium.defined(jsonValue))return Cesium.defined(jsonValue.byteOffset)?(componentType=Cesium.defaultValue(componentType,Cesium.ComponentDatatype.UNSIGNED_INT),componentLength=Cesium.defaultValue(componentLength,1),getTypedArrayFromBinary(this,semantic,componentType,componentLength,1,jsonValue.byteOffset)):jsonValue};Cesium3DTileFeatureTable.prototype.getPropertyArray=function(semantic,componentType,componentLength){var jsonValue=this.json[semantic];if(!!Cesium.defined(jsonValue))return Cesium.defined(jsonValue.byteOffset)?(Cesium.defined(jsonValue.componentType)&&(componentType=Cesium.ComponentDatatype.fromName(jsonValue.componentType)),getTypedArrayFromBinary(this,semantic,componentType,componentLength,this.featuresLength,jsonValue.byteOffset)):getTypedArrayFromArray(this,semantic,componentType,jsonValue)};Cesium3DTileFeatureTable.prototype.getProperty=function(semantic,componentType,componentLength,featureId,result){var jsonValue=this.json[semantic];if(!!Cesium.defined(jsonValue)){var typedArray=this.getPropertyArray(semantic,componentType,componentLength);if(componentLength===1)return typedArray[featureId];for(var i=0;i<componentLength;++i)result[i]=typedArray[componentLength*featureId+i];return result}};var Cesium3DTileFeatureTable_default=Cesium3DTileFeatureTable;function CompressedTextureBuffer(internalFormat,width2,height2,buffer3){this._format=internalFormat,this._width=width2,this._height=height2,this._buffer=buffer3}Object.defineProperties(CompressedTextureBuffer.prototype,{internalFormat:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},bufferView:{get:function(){return this._buffer}}});CompressedTextureBuffer.clone=function(object2){if(!!Cesium.defined(object2))return new CompressedTextureBuffer(object2._format,object2._width,object2._height,object2._buffer)};CompressedTextureBuffer.prototype.clone=function(){return CompressedTextureBuffer.clone(this)};var CompressedTextureBuffer_default=CompressedTextureBuffer;var transcodeTaskProcessor=new Cesium.TaskProcessor("transcodeCRNToDXT",Number.POSITIVE_INFINITY);function loadCRN(resourceOrUrlOrBuffer){let loadPromise;if(resourceOrUrlOrBuffer instanceof ArrayBuffer||ArrayBuffer.isView(resourceOrUrlOrBuffer)?loadPromise=Promise.resolve(resourceOrUrlOrBuffer):loadPromise=Cesium.Resource.createIfNeeded(resourceOrUrlOrBuffer).fetchArrayBuffer(),!!Cesium.defined(loadPromise))return loadPromise.then(function(data){if(!Cesium.defined(data))return;let transferrableObjects=[];return data instanceof ArrayBuffer?transferrableObjects.push(data):(data.byteOffset===0&&data.byteLength===data.buffer.byteLength||(data=data.slice(0,data.length)),transferrableObjects.push(data.buffer)),transcodeTaskProcessor.scheduleTask(data,transferrableObjects)}).then(function(compressedTextureBuffer){return CompressedTextureBuffer_default.clone(compressedTextureBuffer)})}var loadCRN_default=loadCRN;function loadKTX(resourceOrUrlOrBuffer){var loadPromise;if(resourceOrUrlOrBuffer instanceof ArrayBuffer||ArrayBuffer.isView(resourceOrUrlOrBuffer))loadPromise=when_default.resolve(resourceOrUrlOrBuffer);else{var resource2=Cesium.Resource.createIfNeeded(resourceOrUrlOrBuffer);loadPromise=resource2.fetchArrayBuffer()}if(!!Cesium.defined(loadPromise))return loadPromise.then(function(data){if(Cesium.defined(data))return parseKTX(data)})}var fileIdentifier=[171,75,84,88,32,49,49,187,13,10,26,10],endiannessTest=67305985,faceOrder=["positiveX","negativeX","positiveY","negativeY","positiveZ","negativeZ"],sizeOfUint32=4;function parseKTX(data){var byteBuffer=new Uint8Array(data),isKTX=!0,i;for(i=0;i<fileIdentifier.length;++i)if(fileIdentifier[i]!==byteBuffer[i]){isKTX=!1;break}if(!isKTX)throw new Cesium.RuntimeError("Invalid KTX file.");var view,byteOffset;Cesium.defined(data.buffer)?(view=new DataView(data.buffer),byteOffset=data.byteOffset):(view=new DataView(data),byteOffset=0),byteOffset+=12;var endianness=view.getUint32(byteOffset,!0);if(byteOffset+=sizeOfUint32,endianness!==endiannessTest)throw new Cesium.RuntimeError("File is the wrong endianness.");var glType=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var glTypeSize=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var glFormat=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var glInternalFormat=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var glBaseInternalFormat=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var pixelWidth=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var pixelHeight=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var pixelDepth=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var numberOfArrayElements=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var numberOfFaces=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var numberOfMipmapLevels=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var bytesOfKeyValueByteSize=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32,byteOffset+=bytesOfKeyValueByteSize;var imageSize=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint32;var texture;if(Cesium.defined(data.buffer)?texture=new Uint8Array(data.buffer,byteOffset,imageSize):texture=new Uint8Array(data,byteOffset,imageSize),glInternalFormat===Cesium.WebGLConstants.RGB8?glInternalFormat=Cesium.PixelFormat.RGB:glInternalFormat===Cesium.WebGLConstants.RGBA8&&(glInternalFormat=Cesium.PixelFormat.RGBA),!Cesium.PixelFormat.validate(glInternalFormat))throw new Cesium.RuntimeError("glInternalFormat is not a valid format.");if(Cesium.PixelFormat.isCompressedFormat(glInternalFormat)){if(glType!==0)throw new Cesium.RuntimeError("glType must be zero when the texture is compressed.");if(glTypeSize!==1)throw new Cesium.RuntimeError("The type size for compressed textures must be 1.");if(glFormat!==0)throw new Cesium.RuntimeError("glFormat must be zero when the texture is compressed.")}else{if(glType!==Cesium.WebGLConstants.UNSIGNED_BYTE)throw new Cesium.RuntimeError("Only unsigned byte buffers are supported.");if(glBaseInternalFormat!==glFormat)throw new Cesium.RuntimeError("The base internal format must be the same as the format for uncompressed textures.")}if(pixelDepth!==0)throw new Cesium.RuntimeError("3D textures are unsupported.");if(numberOfArrayElements!==0)throw new Cesium.RuntimeError("Texture arrays are unsupported.");var offset=texture.byteOffset,mipmaps=new Array(numberOfMipmapLevels);for(i=0;i<numberOfMipmapLevels;++i){for(var level=mipmaps[i]={},j=0;j<numberOfFaces;++j){var width2=pixelWidth>>i,height2=pixelHeight>>i;width2<1&&(width2=1),height2<1&&(height2=1);var levelSize=Cesium.PixelFormat.isCompressedFormat(glInternalFormat)?Cesium.PixelFormat.compressedTextureSizeInBytes(glInternalFormat,width2,height2):Cesium.PixelFormat.textureSizeInBytes(glInternalFormat,glType,width2,height2),levelBuffer=new Uint8Array(texture.buffer,offset,levelSize);level[faceOrder[j]]=new CompressedTextureBuffer_default(glInternalFormat,width2,height2,levelBuffer),offset+=levelSize}Cesium.defined(data.buffer)?offset+=4:offset+=3-(offset+3)%4+4}var result=mipmaps;if(numberOfFaces===1)for(i=0;i<numberOfMipmapLevels;++i)result[i]=result[i][faceOrder[0]];return numberOfMipmapLevels===1&&(result=result[0]),result}var loadKTX_default=loadKTX;function hasExtension(gltf,extension){return Cesium.defined(gltf.extensionsUsed)&&gltf.extensionsUsed.indexOf(extension)>=0}var hasExtension_default=hasExtension;function arraySlice(array,begin,end){if(typeof array.slice=="function")return array.slice(begin,end);for(var copy7=Array.prototype.slice.call(array,begin,end),typedArrayTypes2=Cesium.FeatureDetection.typedArrayTypes,length3=typedArrayTypes2.length,i=0;i<length3;++i)if(array instanceof typedArrayTypes2[i]){copy7=new typedArrayTypes2[i](copy7);break}return copy7}var arraySlice_default=arraySlice;function DracoLoader(){}DracoLoader._maxDecodingConcurrency=Math.max(Cesium.FeatureDetection.hardwareConcurrency-1,1);DracoLoader._decoderTaskProcessor=void 0;DracoLoader._taskProcessorReady=!1;DracoLoader._getDecoderTaskProcessor=function(){if(!Cesium.defined(DracoLoader._decoderTaskProcessor)){var processor=new Cesium.TaskProcessor("decodeDraco",DracoLoader._maxDecodingConcurrency);processor.initWebAssemblyModule({modulePath:"ThirdParty/Workers/draco_wasm_wrapper.js",wasmBinaryFile:"ThirdParty/draco_decoder1.wasm",fallbackModulePath:"ThirdParty/Workers/draco_decoder.js"}).then(function(){DracoLoader._taskProcessorReady=!0}),DracoLoader._decoderTaskProcessor=processor}return DracoLoader._decoderTaskProcessor};DracoLoader.hasExtension=function(model){return Cesium.defined(model.extensionsRequired.KHR_draco_mesh_compression)||Cesium.defined(model.extensionsUsed.KHR_draco_mesh_compression)};function addBufferToLoadResources(loadResources,typedArray){var bufferViewId="runtime."+Object.keys(loadResources.createdBufferViews).length,loadResourceBuffers=loadResources.buffers,id=Object.keys(loadResourceBuffers).length;return loadResourceBuffers[id]=typedArray,loadResources.createdBufferViews[bufferViewId]={buffer:id,byteOffset:0,byteLength:typedArray.byteLength},bufferViewId}function addNewVertexBuffer(typedArray,model,context){var loadResources=model._loadResources,id=addBufferToLoadResources(loadResources,typedArray);return loadResources.vertexBuffersToCreate.enqueue(id),id}function addNewIndexBuffer(indexArray,model,context){var typedArray=indexArray.typedArray,loadResources=model._loadResources,id=addBufferToLoadResources(loadResources,typedArray);return loadResources.indexBuffersToCreate.enqueue({id,componentType:Cesium.ComponentDatatype.fromTypedArray(typedArray)}),{bufferViewId:id,numberOfIndices:indexArray.numberOfIndices}}function scheduleDecodingTask(decoderTaskProcessor,model,loadResources,context){if(!!DracoLoader._taskProcessorReady){var taskData=loadResources.primitivesToDecode.peek();if(!!Cesium.defined(taskData)){var promise=decoderTaskProcessor.scheduleTask(taskData,[taskData.array.buffer]);if(!!Cesium.defined(promise))return loadResources.activeDecodingTasks++,loadResources.primitivesToDecode.dequeue(),promise.then(function(result){result.taskDataMesh=taskData.mesh,result.taskDataPrimitive=taskData.primitive,model.meshPrimitives.push(result),loadResources.activeDecodingTasks--;var decodedIndexBuffer=addNewIndexBuffer(result.indexArray,model,context),attributes={},decodedAttributeData=result.attributeData;for(var attributeName in decodedAttributeData)if(decodedAttributeData.hasOwnProperty(attributeName)){var attribute=decodedAttributeData[attributeName],vertexArray=attribute.array,vertexBufferView=addNewVertexBuffer(vertexArray,model,context),data=attribute.data;data.bufferView=vertexBufferView,attributes[attributeName]=data}model._decodedData[taskData.mesh+".primitive."+taskData.primitive]={bufferView:decodedIndexBuffer.bufferViewId,numberOfIndices:decodedIndexBuffer.numberOfIndices,attributes}})}}}DracoLoader._decodedModelResourceCache=void 0;DracoLoader.parse=function(model,context){if(!!DracoLoader.hasExtension(model)){var loadResources=model._loadResources,cacheKey=model.cacheKey;if(Cesium.defined(cacheKey)){Cesium.defined(DracoLoader._decodedModelResourceCache)||(Cesium.defined(context.cache.modelDecodingCache)||(context.cache.modelDecodingCache={}),DracoLoader._decodedModelResourceCache=context.cache.modelDecodingCache);var cachedData=DracoLoader._decodedModelResourceCache[cacheKey];if(Cesium.defined(cachedData)){cachedData.count++,loadResources.pendingDecodingCache=!0;return}}var dequantizeInShader=model._dequantizeInShader,gltf=model.gltf;Cesium.ForEach.mesh(gltf,function(mesh,meshId){Cesium.ForEach.meshPrimitive(mesh,function(primitive,primitiveId){if(!!Cesium.defined(primitive.extensions)){var compressionData=primitive.extensions.KHR_draco_mesh_compression;if(!!Cesium.defined(compressionData)){var bufferView=gltf.bufferViews[compressionData.bufferView],typedArray=arraySlice_default(gltf.buffers[bufferView.buffer].extras._pipeline.source,bufferView.byteOffset,bufferView.byteOffset+bufferView.byteLength);loadResources.primitivesToDecode.enqueue({mesh:meshId,primitive:primitiveId,array:typedArray,bufferView,compressedAttributes:compressionData.attributes,dequantizeInShader})}}})})}};DracoLoader.parseDecodedData=function(decodedData,model,context){if(!Cesium.defined(decodedData.taskDataMesh)||!Cesium.defined(decodedData.taskDataPrimitive)||!Cesium.defined(decodedData.indexArray)||!Cesium.defined(decodedData.attributeData)){console.log("indexeddb\u4E2D\u5B58\u50A8\u6A21\u578Bmesh\u6570\u636E\u6709\u95EE\u9898");return}var decodedIndexBuffer=addNewIndexBuffer(decodedData.indexArray,model,context),attributes={},decodedAttributeData=decodedData.attributeData;for(var attributeName in decodedAttributeData)if(decodedAttributeData.hasOwnProperty(attributeName)){var attribute=decodedAttributeData[attributeName],vertexArray=attribute.array,vertexBufferView=addNewVertexBuffer(vertexArray,model,context),data=attribute.data;data.bufferView=vertexBufferView,attributes[attributeName]=data}model._decodedData[decodedData.taskDataMesh+".primitive."+decodedData.taskDataPrimitive]={bufferView:decodedIndexBuffer.bufferViewId,numberOfIndices:decodedIndexBuffer.numberOfIndices,attributes}};DracoLoader.decodeModel=function(model,context){if(!DracoLoader.hasExtension(model))return when_default.resolve();var loadResources=model._loadResources,cacheKey=model.cacheKey;if(Cesium.defined(cacheKey)&&Cesium.defined(DracoLoader._decodedModelResourceCache)){var cachedData=DracoLoader._decodedModelResourceCache[cacheKey];if(Cesium.defined(cachedData)&&loadResources.pendingDecodingCache)return when_default(cachedData.ready,function(){model._decodedData=cachedData.data,loadResources.pendingDecodingCache=!1});DracoLoader._decodedModelResourceCache[cacheKey]={ready:!1,count:1,data:void 0}}if(loadResources.primitivesToDecode.length===0)return when_default.resolve();for(var decoderTaskProcessor=DracoLoader._getDecoderTaskProcessor(),decodingPromises=[],promise=scheduleDecodingTask(decoderTaskProcessor,model,loadResources,context);Cesium.defined(promise);)decodingPromises.push(promise),promise=scheduleDecodingTask(decoderTaskProcessor,model,loadResources,context);return when_default.all(decodingPromises)};DracoLoader.decodePointCloud=function(parameters){var decoderTaskProcessor=DracoLoader._getDecoderTaskProcessor();if(!!DracoLoader._taskProcessorReady)return decoderTaskProcessor.scheduleTask(parameters,[parameters.buffer.buffer])};DracoLoader.cacheDataForModel=function(model){var cacheKey=model.cacheKey;if(Cesium.defined(cacheKey)&&Cesium.defined(DracoLoader._decodedModelResourceCache)){var cachedData=DracoLoader._decodedModelResourceCache[cacheKey];Cesium.defined(cachedData)&&(cachedData.ready=!0,cachedData.data=model._decodedData)}};DracoLoader.parseGltf=function(gltf,dequantizeInShader,attributes){var taskDatas=[];Cesium.ForEach.mesh(gltf,function(mesh,meshId){Cesium.ForEach.meshPrimitive(mesh,function(primitive,primitiveId){if(!!Cesium.defined(primitive.extensions)){var compressionData=primitive.extensions.KHR_draco_mesh_compression;if(!!Cesium.defined(compressionData)){var bufferView=gltf.bufferViews[compressionData.bufferView],typedArray=arraySlice_default(gltf.buffers[bufferView.buffer].extras._pipeline.source,bufferView.byteOffset,bufferView.byteOffset+bufferView.byteLength);taskDatas.push({mesh:meshId,primitive:primitiveId,array:typedArray,bufferView,compressedAttributes:compressionData.attributes,dequantizeInShader})}}})});var decoderTaskProcessor=DracoLoader._getDecoderTaskProcessor();decoderTaskProcessor._maximumActiveTasks=taskDatas.length+1;for(var decodingPromises=[],i=0;i<taskDatas.length;i++){var taskData=taskDatas[i];if(!Cesium.defined(taskData))return;var promise=scheduleDecodingTask1(decoderTaskProcessor,taskData,attributes);Cesium.defined(promise)&&decodingPromises.push(promise)}return when_default.all(decodingPromises)};function scheduleDecodingTask1(decoderTaskProcessor,taskData,attributes){if(!!DracoLoader._taskProcessorReady&&!!Cesium.defined(taskData)){var promise=decoderTaskProcessor.scheduleTask(taskData,[taskData.array.buffer]);if(!!Cesium.defined(promise))return promise.then(function(result){result.taskDataMesh=taskData.mesh,result.taskDataPrimitive=taskData.primitive,attributes.push(result)})}}DracoLoader.destroyCachedDataForModel=function(model){var cacheKey=model.cacheKey;if(Cesium.defined(cacheKey)&&Cesium.defined(DracoLoader._decodedModelResourceCache)){var cachedData=DracoLoader._decodedModelResourceCache[cacheKey];Cesium.defined(cachedData)&&--cachedData.count===0&&delete DracoLoader._decodedModelResourceCache[cacheKey]}};var DracoLoader_default=DracoLoader;var ModelUtility={};ModelUtility.updateForwardAxis=function(model){var cachedSourceVersion=model.gltf.extras.sourceVersion;(Cesium.defined(cachedSourceVersion)&&cachedSourceVersion!=="2.0"||ModelUtility.getAssetVersion(model.gltf)!=="2.0")&&(model._gltfForwardAxis=Cesium.Axis.X)};ModelUtility.getAssetVersion=function(gltf){return!Cesium.defined(gltf.asset)||!Cesium.defined(gltf.asset.version)?"1.0":gltf.asset.version};ModelUtility.splitIncompatibleMaterials=function(gltf){var accessors=gltf.accessors,materials=gltf.materials,primitiveInfoByMaterial={};return Cesium.ForEach.mesh(gltf,function(mesh){Cesium.ForEach.meshPrimitive(mesh,function(primitive){var materialIndex=primitive.material,material=materials[materialIndex],jointAccessorId=primitive.attributes.JOINTS_0,componentType,type;if(Cesium.defined(jointAccessorId)){var jointAccessor=accessors[jointAccessorId];componentType=jointAccessor.componentType,type=jointAccessor.type}var isSkinned=Cesium.defined(jointAccessorId),hasVertexColors=Cesium.defined(primitive.attributes.COLOR_0),hasMorphTargets=Cesium.defined(primitive.targets),hasNormals=Cesium.defined(primitive.attributes.NORMAL),hasTangents=Cesium.defined(primitive.attributes.TANGENT),hasTexCoords=Cesium.defined(primitive.attributes.TEXCOORD_0),hasOutline=Cesium.defined(primitive.extensions)&&Cesium.defined(primitive.extensions.CESIUM_primitive_outline),primitiveInfo=primitiveInfoByMaterial[materialIndex];if(!Cesium.defined(primitiveInfo))primitiveInfoByMaterial[materialIndex]={skinning:{skinned:isSkinned,componentType,type},hasVertexColors,hasMorphTargets,hasNormals,hasTangents,hasTexCoords,hasOutline};else if(primitiveInfo.skinning.skinned!==isSkinned||primitiveInfo.skinning.type!==type||primitiveInfo.hasVertexColors!==hasVertexColors||primitiveInfo.hasMorphTargets!==hasMorphTargets||primitiveInfo.hasNormals!==hasNormals||primitiveInfo.hasTangents!==hasTangents||primitiveInfo.hasTexCoords!==hasTexCoords||primitiveInfo.hasOutline!==hasOutline){var clonedMaterial=Cesium.clone(material,!0);materialIndex=Cesium.addToArray(materials,clonedMaterial),primitive.material=materialIndex,primitiveInfoByMaterial[materialIndex]={skinning:{skinned:isSkinned,componentType,type},hasVertexColors,hasMorphTargets,hasNormals,hasTangents,hasTexCoords,hasOutline}}})}),primitiveInfoByMaterial};ModelUtility.getShaderVariable=function(type){return type==="SCALAR"?"float":type.toLowerCase()};ModelUtility.ModelState={NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3};ModelUtility.getFailedLoadFunction=function(model,type,path){return function(error){model._state=ModelUtility.ModelState.FAILED;var message="Failed to load "+type+": "+path;Cesium.defined(error)&&(message+=`
`+error.message),model._readyPromise.reject(new Cesium.RuntimeError(message))}};ModelUtility.parseBuffers=function(model,bufferLoad2){var loadResources=model._loadResources;Cesium.ForEach.buffer(model.gltf,function(buffer3,bufferViewId){if(Cesium.defined(buffer3.extras._pipeline.source))loadResources.buffers[bufferViewId]=buffer3.extras._pipeline.source;else if(Cesium.defined(bufferLoad2)){var bufferResource=model._resource.getDerivedResource({url:buffer3.uri});++loadResources.pendingBufferLoads,bufferResource.fetchArrayBuffer().then(bufferLoad2(model,bufferViewId)).catch(ModelUtility.getFailedLoadFunction(model,"buffer",bufferResource.url))}})};var aMinScratch=new Cesium.Cartesian3,aMaxScratch=new Cesium.Cartesian3;ModelUtility.computeBoundingSphere=function(model){for(var gltf=model.gltf,gltfNodes=gltf.nodes,gltfMeshes=gltf.meshes,rootNodes=gltf.scenes[gltf.scene].nodes,rootNodesLength=rootNodes.length,nodeStack=[],min4=new Cesium.Cartesian3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),max3=new Cesium.Cartesian3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i=0;i<rootNodesLength;++i){var n=gltfNodes[rootNodes[i]];for(n._transformToRoot=ModelUtility.getTransform(n),nodeStack.push(n);nodeStack.length>0;){n=nodeStack.pop();var transformToRoot=n._transformToRoot,meshId=n.mesh;if(Cesium.defined(meshId))for(var mesh=gltfMeshes[meshId],primitives=mesh.primitives,primitivesLength=primitives.length,m=0;m<primitivesLength;++m){var positionAccessor=primitives[m].attributes.POSITION;if(Cesium.defined(positionAccessor)){var minMax=ModelUtility.getAccessorMinMax(gltf,positionAccessor);if(Cesium.defined(minMax.min)&&Cesium.defined(minMax.max)){var aMin=Cesium.Cartesian3.fromArray(minMax.min,0,aMinScratch),aMax=Cesium.Cartesian3.fromArray(minMax.max,0,aMaxScratch);Cesium.defined(min4)&&Cesium.defined(max3)&&(Cesium.Matrix4.multiplyByPoint(transformToRoot,aMin,aMin),Cesium.Matrix4.multiplyByPoint(transformToRoot,aMax,aMax),Cesium.Cartesian3.minimumByComponent(min4,aMin,min4),Cesium.Cartesian3.maximumByComponent(max3,aMax,max3))}}}var children=n.children;if(Cesium.defined(children))for(var childrenLength=children.length,k=0;k<childrenLength;++k){var child=gltfNodes[children[k]];child._transformToRoot=ModelUtility.getTransform(child),Cesium.Matrix4.multiplyTransformation(transformToRoot,child._transformToRoot,child._transformToRoot),nodeStack.push(child)}delete n._transformToRoot}}var boundingSphere=Cesium.BoundingSphere.fromCornerPoints(min4,max3);return model._forwardAxis===Cesium.Axis.Z&&Cesium.BoundingSphere.transformWithoutScale(boundingSphere,Cesium.Axis.Z_UP_TO_X_UP,boundingSphere),model._upAxis===Cesium.Axis.Y?Cesium.BoundingSphere.transformWithoutScale(boundingSphere,Cesium.Axis.Y_UP_TO_Z_UP,boundingSphere):model._upAxis===Cesium.Axis.X&&Cesium.BoundingSphere.transformWithoutScale(boundingSphere,Cesium.Axis.X_UP_TO_Z_UP,boundingSphere),boundingSphere};function techniqueAttributeForSemantic(technique,semantic){return Cesium.ForEach.techniqueAttribute(technique,function(attribute,attributeName){if(attribute.semantic===semantic)return attributeName})}function ensureSemanticExistenceForPrimitive(gltf,primitive){var accessors=gltf.accessors,materials=gltf.materials,techniquesWebgl=gltf.extensions.KHR_techniques_webgl,techniques=techniquesWebgl.techniques,programs=techniquesWebgl.programs,shaders=techniquesWebgl.shaders,targets=primitive.targets,attributes=primitive.attributes;for(var target in targets)if(targets.hasOwnProperty(target)){var targetAttributes=targets[target];for(var attribute in targetAttributes)attribute!=="extras"&&(attributes[attribute+"_"+target]=targetAttributes[attribute])}var material=materials[primitive.material],technique=techniques[material.extensions.KHR_techniques_webgl.technique],program=programs[technique.program],vertexShader=shaders[program.vertexShader];for(var semantic in attributes)if(attributes.hasOwnProperty(semantic)&&!Cesium.defined(techniqueAttributeForSemantic(technique,semantic))){var accessorId=attributes[semantic],accessor=accessors[accessorId],lowerCase=semantic.toLowerCase();lowerCase.charAt(0)==="_"&&(lowerCase=lowerCase.slice(1));var attributeName="a_"+lowerCase;technique.attributes[attributeName]={semantic,type:accessor.componentType};var pipelineExtras=vertexShader.extras._pipeline,shaderText=pipelineExtras.source;shaderText="attribute "+ModelUtility.getShaderVariable(accessor.type)+" "+attributeName+`;
`+shaderText,pipelineExtras.source=shaderText}}ModelUtility.ensureSemanticExistence=function(gltf){return Cesium.ForEach.mesh(gltf,function(mesh){Cesium.ForEach.meshPrimitive(mesh,function(primitive){ensureSemanticExistenceForPrimitive(gltf,primitive)})}),gltf};ModelUtility.createAttributeLocations=function(technique,precreatedAttributes){var attributeLocations={},hasIndex0=!1,i=1;if(Cesium.ForEach.techniqueAttribute(technique,function(attribute,attributeName2){/pos/i.test(attributeName2)&&!hasIndex0?(attributeLocations[attributeName2]=0,hasIndex0=!0):attributeLocations[attributeName2]=i++}),Cesium.defined(precreatedAttributes))for(var attributeName in precreatedAttributes)precreatedAttributes.hasOwnProperty(attributeName)&&(attributeLocations[attributeName]=i++);return attributeLocations};ModelUtility.getAccessorMinMax=function(gltf,accessorId){var accessor=gltf.accessors[accessorId],extensions=accessor.extensions,accessorMin=accessor.min,accessorMax=accessor.max;if(Cesium.defined(extensions)){var quantizedAttributes=extensions.WEB3D_quantized_attributes;Cesium.defined(quantizedAttributes)&&(accessorMin=quantizedAttributes.decodedMin,accessorMax=quantizedAttributes.decodedMax)}return{min:accessorMin,max:accessorMax}};function getTechniqueAttributeOrUniformFunction(gltf,technique,semantic,ignoreNodes){return hasExtension_default(gltf,"KHR_techniques_webgl")?function(attributeOrUniform,attributeOrUniformName){if(attributeOrUniform.semantic===semantic&&(!ignoreNodes||!Cesium.defined(attributeOrUniform.node)))return attributeOrUniformName}:function(parameterName,attributeOrUniformName){var attributeOrUniform=technique.parameters[parameterName];if(attributeOrUniform.semantic===semantic&&(!ignoreNodes||!Cesium.defined(attributeOrUniform.node)))return attributeOrUniformName}}ModelUtility.getAttributeOrUniformBySemantic=function(gltf,semantic,programId,ignoreNodes){return Cesium.ForEach.technique(gltf,function(technique){if(!(Cesium.defined(programId)&&technique.program!==programId)){var value=Cesium.ForEach.techniqueAttribute(technique,getTechniqueAttributeOrUniformFunction(gltf,technique,semantic,ignoreNodes));return Cesium.defined(value)?value:Cesium.ForEach.techniqueUniform(technique,getTechniqueAttributeOrUniformFunction(gltf,technique,semantic,ignoreNodes))}})};ModelUtility.getDiffuseAttributeOrUniform=function(gltf,programId){var diffuseUniformName=ModelUtility.getAttributeOrUniformBySemantic(gltf,"COLOR_0",programId);return Cesium.defined(diffuseUniformName)||(diffuseUniformName=ModelUtility.getAttributeOrUniformBySemantic(gltf,"_3DTILESDIFFUSE",programId)),diffuseUniformName};var nodeTranslationScratch=new Cesium.Cartesian3,nodeQuaternionScratch=new Cesium.Quaternion,nodeScaleScratch=new Cesium.Cartesian3;ModelUtility.getTransform=function(node,result){return Cesium.defined(node.matrix)?Cesium.Matrix4.fromColumnMajorArray(node.matrix,result):Cesium.Matrix4.fromTranslationQuaternionRotationScale(Cesium.Cartesian3.fromArray(node.translation,0,nodeTranslationScratch),Cesium.Quaternion.unpack(node.rotation,0,nodeQuaternionScratch),Cesium.Cartesian3.fromArray(node.scale,0,nodeScaleScratch),result)};ModelUtility.getUsedExtensions=function(gltf){var extensionsUsed=gltf.extensionsUsed,cachedExtensionsUsed={};if(Cesium.defined(extensionsUsed))for(var extensionsUsedLength=extensionsUsed.length,i=0;i<extensionsUsedLength;i++){var extension=extensionsUsed[i];cachedExtensionsUsed[extension]=!0}return cachedExtensionsUsed};ModelUtility.getRequiredExtensions=function(gltf){var extensionsRequired=gltf.extensionsRequired,cachedExtensionsRequired={};if(Cesium.defined(extensionsRequired))for(var extensionsRequiredLength=extensionsRequired.length,i=0;i<extensionsRequiredLength;i++){var extension=extensionsRequired[i];cachedExtensionsRequired[extension]=!0}return cachedExtensionsRequired};ModelUtility.supportedExtensions={AGI_articulations:!0,CESIUM_RTC:!0,EXT_texture_webp:!0,KHR_blend:!0,KHR_binary_glTF:!0,KHR_draco_mesh_compression:!0,KHR_materials_common:!0,KHR_techniques_webgl:!0,KHR_materials_unlit:!0,KHR_materials_pbrSpecularGlossiness:!0,KHR_texture_transform:!0,WEB3D_quantized_attributes:!0};ModelUtility.checkSupportedExtensions=function(extensionsRequired,browserSupportsWebp){for(var extension in extensionsRequired)if(extensionsRequired.hasOwnProperty(extension)){if(!ModelUtility.supportedExtensions[extension])throw new Cesium.RuntimeError("Unsupported glTF Extension: "+extension);if(extension==="EXT_texture_webp"&&browserSupportsWebp===!1)throw new Cesium.RuntimeError("Loaded model requires WebP but browser does not support it.")}};ModelUtility.checkSupportedGlExtensions=function(extensionsUsed,context){if(Cesium.defined(extensionsUsed))for(var glExtensionsUsedLength=extensionsUsed.length,i=0;i<glExtensionsUsedLength;i++){var extension=extensionsUsed[i];if(extension!=="OES_element_index_uint")throw new Cesium.RuntimeError("Unsupported WebGL Extension: "+extension);if(!context.elementIndexUint)throw new Cesium.RuntimeError("OES_element_index_uint WebGL extension is not enabled.")}};function replaceAllButFirstInString(string,find4,replace){find4+="(?!\\w)",find4=new RegExp(find4,"g");var index=string.search(find4);return string.replace(find4,function(match,offset){return index===offset?match:replace})}function getQuantizedAttributes(gltf,accessorId){var accessor=gltf.accessors[accessorId],extensions=accessor.extensions;if(Cesium.defined(extensions))return extensions.WEB3D_quantized_attributes}function getAttributeVariableName(gltf,primitive,attributeSemantic){var materialId=primitive.material,material=gltf.materials[materialId];if(!(!hasExtension_default(gltf,"KHR_techniques_webgl")||!Cesium.defined(material.extensions)||!Cesium.defined(material.extensions.KHR_techniques_webgl))){var techniqueId=material.extensions.KHR_techniques_webgl.technique,techniquesWebgl=gltf.extensions.KHR_techniques_webgl,technique=techniquesWebgl.techniques[techniqueId];return Cesium.ForEach.techniqueAttribute(technique,function(attribute,attributeName){var semantic=attribute.semantic;if(semantic===attributeSemantic)return attributeName})}}ModelUtility.modifyShaderForDracoQuantizedAttributes=function(gltf,primitive,shader,decodedAttributes){var quantizedUniforms={};for(var attributeSemantic in decodedAttributes)if(decodedAttributes.hasOwnProperty(attributeSemantic)){var attribute=decodedAttributes[attributeSemantic],quantization=attribute.quantization;if(!Cesium.defined(quantization))continue;var attributeVarName=getAttributeVariableName(gltf,primitive,attributeSemantic);if(!Cesium.defined(attributeVarName))continue;attributeSemantic.charAt(0)==="_"&&(attributeSemantic=attributeSemantic.substring(1));var decodeUniformVarName="gltf_u_dec_"+attributeSemantic.toLowerCase();if(!Cesium.defined(quantizedUniforms[decodeUniformVarName])){var newMain="gltf_decoded_"+attributeSemantic,decodedAttributeVarName=attributeVarName.replace("a_","gltf_a_dec_"),size11=attribute.componentsPerAttribute;shader=replaceAllButFirstInString(shader,attributeVarName,decodedAttributeVarName);var variableType;quantization.octEncoded?variableType="vec3":size11>1?variableType="vec"+size11:variableType="float",shader=variableType+" "+decodedAttributeVarName+`;
`+shader;var vec3Color=size11===3&&attributeSemantic==="COLOR_0";vec3Color&&(shader=replaceAllButFirstInString(shader,decodedAttributeVarName,"vec4("+decodedAttributeVarName+", 1.0)"));var decode="";if(quantization.octEncoded){var decodeUniformVarNameRangeConstant=decodeUniformVarName+"_rangeConstant";shader="uniform float "+decodeUniformVarNameRangeConstant+`;
`+shader,decode=`
void main() {
    `+decodedAttributeVarName+" = czm_octDecode("+attributeVarName+".xy, "+decodeUniformVarNameRangeConstant+`).zxy;
    `+newMain+`();
}
`}else{var decodeUniformVarNameNormConstant=decodeUniformVarName+"_normConstant",decodeUniformVarNameMin=decodeUniformVarName+"_min";shader="uniform float "+decodeUniformVarNameNormConstant+`;
uniform `+variableType+" "+decodeUniformVarNameMin+`;
`+shader;var attributeVarAccess=vec3Color?".xyz":"";decode=`
void main() {
    `+decodedAttributeVarName+" = "+decodeUniformVarNameMin+" + "+attributeVarName+attributeVarAccess+" * "+decodeUniformVarNameNormConstant+`;
    `+newMain+`();
}
`}shader=Cesium.ShaderSource.replaceMain(shader,newMain),shader+=decode}}return{shader}};ModelUtility.modifyShaderForQuantizedAttributes=function(gltf,primitive,shader){var quantizedUniforms={},attributes=primitive.attributes;for(var attributeSemantic in attributes)if(attributes.hasOwnProperty(attributeSemantic)){var attributeVarName=getAttributeVariableName(gltf,primitive,attributeSemantic),accessorId=primitive.attributes[attributeSemantic];attributeSemantic.charAt(0)==="_"&&(attributeSemantic=attributeSemantic.substring(1));var decodeUniformVarName="gltf_u_dec_"+attributeSemantic.toLowerCase(),decodeUniformVarNameScale=decodeUniformVarName+"_scale",decodeUniformVarNameTranslate=decodeUniformVarName+"_translate";if(!Cesium.defined(quantizedUniforms[decodeUniformVarName])&&!Cesium.defined(quantizedUniforms[decodeUniformVarNameScale])){var quantizedAttributes=getQuantizedAttributes(gltf,accessorId);if(Cesium.defined(quantizedAttributes)){var decodeMatrix=quantizedAttributes.decodeMatrix,newMain="gltf_decoded_"+attributeSemantic,decodedAttributeVarName=attributeVarName.replace("a_","gltf_a_dec_"),size11=Math.floor(Math.sqrt(decodeMatrix.length));shader=replaceAllButFirstInString(shader,attributeVarName,decodedAttributeVarName);var variableType;size11>2?variableType="vec"+(size11-1):variableType="float",shader=variableType+" "+decodedAttributeVarName+`;
`+shader;var decode="";size11===5?(shader="uniform mat4 "+decodeUniformVarNameScale+`;
`+shader,shader="uniform vec4 "+decodeUniformVarNameTranslate+`;
`+shader,decode=`
void main() {
    `+decodedAttributeVarName+" = "+decodeUniformVarNameScale+" * "+attributeVarName+" + "+decodeUniformVarNameTranslate+`;
    `+newMain+`();
}
`,quantizedUniforms[decodeUniformVarNameScale]={mat:4},quantizedUniforms[decodeUniformVarNameTranslate]={vec:4}):(shader="uniform mat"+size11+" "+decodeUniformVarName+`;
`+shader,decode=`
void main() {
    `+decodedAttributeVarName+" = "+variableType+"("+decodeUniformVarName+" * vec"+size11+"("+attributeVarName+`,1.0));
    `+newMain+`();
}
`,quantizedUniforms[decodeUniformVarName]={mat:size11}),shader=Cesium.ShaderSource.replaceMain(shader,newMain),shader+=decode}}}return{shader,uniforms:quantizedUniforms}};ModelUtility.toClipCoordinatesGLSL=function(gltf,shader){var positionName=ModelUtility.getAttributeOrUniformBySemantic(gltf,"POSITION"),decodedPositionName=positionName.replace("a_","gltf_a_dec_");shader.indexOf(decodedPositionName)!==-1&&(positionName=decodedPositionName);var modelViewProjectionName=ModelUtility.getAttributeOrUniformBySemantic(gltf,"MODELVIEWPROJECTION",void 0,!0);if(!Cesium.defined(modelViewProjectionName)||shader.indexOf(modelViewProjectionName)===-1){var projectionName=ModelUtility.getAttributeOrUniformBySemantic(gltf,"PROJECTION",void 0,!0),modelViewName=ModelUtility.getAttributeOrUniformBySemantic(gltf,"MODELVIEW",void 0,!0);shader.indexOf("czm_instanced_modelView ")!==-1?modelViewName="czm_instanced_modelView":Cesium.defined(modelViewName)||(modelViewName=ModelUtility.getAttributeOrUniformBySemantic(gltf,"CESIUM_RTC_MODELVIEW",void 0,!0)),modelViewProjectionName=projectionName+" * "+modelViewName}return modelViewProjectionName+" * vec4("+positionName+".xyz, 1.0)"};ModelUtility.modifyFragmentShaderForLogDepth=function(shader){return shader=Cesium.ShaderSource.replaceMain(shader,"czm_depth_main"),shader+=`
void main() 
{ 
    czm_depth_main(); 
    czm_writeLogDepth(); 
} 
`,shader};ModelUtility.modifyFragmentShaderForLogDepthAddRoller=function(shader){return shader=Cesium.ShaderSource.replaceMain(shader,"czm_depth_main"),shader+=`
void main() 
{ 
    czm_rollerShutter(gl_FragCoord.xy,u_rollerRegion); 
    czm_depth_main(); 
    czm_writeLogDepth(); 
} 
`,shader};ModelUtility.modifyVertexShaderForLogDepth=function(shader,toClipCoordinatesGLSL){return shader=Cesium.ShaderSource.replaceMain(shader,"czm_depth_main"),shader+=`
void main() 
{ 
    czm_depth_main(); 
    czm_vertexLogDepth(`+toClipCoordinatesGLSL+`); 
} 
`,shader};function getScalarUniformFunction(value){var that={value,clone:function(source,result){return source},func:function(){return that.value}};return that}function getVec2UniformFunction(value){var that={value:Cesium.Cartesian2.fromArray(value),clone:Cesium.Cartesian2.clone,func:function(){return that.value}};return that}function getVec3UniformFunction(value){var that={value:Cesium.Cartesian3.fromArray(value),clone:Cesium.Cartesian3.clone,func:function(){return that.value}};return that}function getVec4UniformFunction(value){var that={value:Cesium.Cartesian4.fromArray(value),clone:Cesium.Cartesian4.clone,func:function(){return that.value}};return that}function getMat2UniformFunction(value){var that={value:Cesium.Matrix2.fromColumnMajorArray(value),clone:Cesium.Matrix2.clone,func:function(){return that.value}};return that}function getMat3UniformFunction(value){var that={value:Cesium.Matrix3.fromColumnMajorArray(value),clone:Cesium.Matrix3.clone,func:function(){return that.value}};return that}function getMat4UniformFunction(value){var that={value:Cesium.Matrix4.fromColumnMajorArray(value),clone:Cesium.Matrix4.clone,func:function(){return that.value}};return that}function DelayLoadedTextureUniform(value,textures,defaultTexture){this._value=void 0,this._textureId=value.index,this._textures=textures,this._defaultTexture=defaultTexture}Object.defineProperties(DelayLoadedTextureUniform.prototype,{value:{get:function(){if(!Cesium.defined(this._value)){var texture=this._textures[this._textureId];if(Cesium.defined(texture))this._value=texture;else return this._defaultTexture}return this._value},set:function(value){this._value=value}}});DelayLoadedTextureUniform.prototype.clone=function(source){return source};DelayLoadedTextureUniform.prototype.func=void 0;function getTextureUniformFunction(value,textures,defaultTexture){var uniform=new DelayLoadedTextureUniform(value,textures,defaultTexture);return uniform.func=function(){return uniform.value},uniform}var gltfUniformFunctions={};gltfUniformFunctions[Cesium.WebGLConstants.FLOAT]=getScalarUniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.FLOAT_VEC2]=getVec2UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.FLOAT_VEC3]=getVec3UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.FLOAT_VEC4]=getVec4UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.INT]=getScalarUniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.INT_VEC2]=getVec2UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.INT_VEC3]=getVec3UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.INT_VEC4]=getVec4UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.BOOL]=getScalarUniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.BOOL_VEC2]=getVec2UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.BOOL_VEC3]=getVec3UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.BOOL_VEC4]=getVec4UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.FLOAT_MAT2]=getMat2UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.FLOAT_MAT3]=getMat3UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.FLOAT_MAT4]=getMat4UniformFunction;gltfUniformFunctions[Cesium.WebGLConstants.SAMPLER_2D]=getTextureUniformFunction;ModelUtility.createUniformFunction=function(type,value,textures,defaultTexture){return gltfUniformFunctions[type](value,textures,defaultTexture)};function scaleFromMatrix5Array(matrix){return[matrix[0],matrix[1],matrix[2],matrix[3],matrix[5],matrix[6],matrix[7],matrix[8],matrix[10],matrix[11],matrix[12],matrix[13],matrix[15],matrix[16],matrix[17],matrix[18]]}function translateFromMatrix5Array(matrix){return[matrix[20],matrix[21],matrix[22],matrix[23]]}ModelUtility.createUniformsForDracoQuantizedAttributes=function(decodedAttributes){var uniformMap={};for(var attribute in decodedAttributes)if(decodedAttributes.hasOwnProperty(attribute)){var decodedData=decodedAttributes[attribute],quantization=decodedData.quantization;if(!Cesium.defined(quantization))continue;attribute.charAt(0)==="_"&&(attribute=attribute.substring(1));var uniformVarName="gltf_u_dec_"+attribute.toLowerCase();if(quantization.octEncoded){var uniformVarNameRangeConstant=uniformVarName+"_rangeConstant",rangeConstant=(1<<quantization.quantizationBits)-1;uniformMap[uniformVarNameRangeConstant]=getScalarUniformFunction(rangeConstant).func;continue}var uniformVarNameNormConstant=uniformVarName+"_normConstant",normConstant=quantization.range/(1<<quantization.quantizationBits);uniformMap[uniformVarNameNormConstant]=getScalarUniformFunction(normConstant).func;var uniformVarNameMin=uniformVarName+"_min";switch(decodedData.componentsPerAttribute){case 1:uniformMap[uniformVarNameMin]=getScalarUniformFunction(quantization.minValues).func;break;case 2:uniformMap[uniformVarNameMin]=getVec2UniformFunction(quantization.minValues).func;break;case 3:uniformMap[uniformVarNameMin]=getVec3UniformFunction(quantization.minValues).func;break;case 4:uniformMap[uniformVarNameMin]=getVec4UniformFunction(quantization.minValues).func;break}}return uniformMap};ModelUtility.createUniformsForQuantizedAttributes=function(gltf,primitive,quantizedUniforms){var accessors=gltf.accessors,setUniforms={},uniformMap={},attributes=primitive.attributes;for(var attribute in attributes)if(attributes.hasOwnProperty(attribute)){var accessorId=attributes[attribute],a=accessors[accessorId],extensions=a.extensions;if(attribute.charAt(0)==="_"&&(attribute=attribute.substring(1)),Cesium.defined(extensions)){var quantizedAttributes=extensions.WEB3D_quantized_attributes;if(Cesium.defined(quantizedAttributes)){var decodeMatrix=quantizedAttributes.decodeMatrix,uniformVariable="gltf_u_dec_"+attribute.toLowerCase();switch(a.type){case Cesium.AttributeType.SCALAR:uniformMap[uniformVariable]=getMat2UniformFunction(decodeMatrix).func,setUniforms[uniformVariable]=!0;break;case Cesium.AttributeType.VEC2:uniformMap[uniformVariable]=getMat3UniformFunction(decodeMatrix).func,setUniforms[uniformVariable]=!0;break;case Cesium.AttributeType.VEC3:uniformMap[uniformVariable]=getMat4UniformFunction(decodeMatrix).func,setUniforms[uniformVariable]=!0;break;case Cesium.AttributeType.VEC4:var uniformVariableScale=uniformVariable+"_scale",uniformVariableTranslate=uniformVariable+"_translate";uniformMap[uniformVariableScale]=getMat4UniformFunction(scaleFromMatrix5Array(decodeMatrix)).func,uniformMap[uniformVariableTranslate]=getVec4UniformFunction(translateFromMatrix5Array(decodeMatrix)).func,setUniforms[uniformVariableScale]=!0,setUniforms[uniformVariableTranslate]=!0;break}}}}for(var quantizedUniform in quantizedUniforms)if(quantizedUniforms.hasOwnProperty(quantizedUniform)&&!setUniforms[quantizedUniform]){var properties=quantizedUniforms[quantizedUniform];Cesium.defined(properties.mat)&&(properties.mat===2?uniformMap[quantizedUniform]=getMat2UniformFunction(Cesium.Matrix2.IDENTITY).func:properties.mat===3?uniformMap[quantizedUniform]=getMat3UniformFunction(Cesium.Matrix3.IDENTITY).func:properties.mat===4&&(uniformMap[quantizedUniform]=getMat4UniformFunction(Cesium.Matrix4.IDENTITY).func)),Cesium.defined(properties.vec)&&properties.vec===4&&(uniformMap[quantizedUniform]=getVec4UniformFunction([0,0,0,0]).func)}return uniformMap};var scratchTranslationRtc=new Cesium.Cartesian3,gltfSemanticUniforms={MODEL:function(uniformState,model){return function(){return uniformState.model}},VIEW:function(uniformState,model){return function(){return uniformState.view}},PROJECTION:function(uniformState,model){return function(){return uniformState.projection}},MODELVIEW:function(uniformState,model){return function(){return uniformState.modelView}},CESIUM_RTC_MODELVIEW:function(uniformState,model){var mvRtc=new Cesium.Matrix4;return function(){return Cesium.defined(model._rtcCenter)?(Cesium.Matrix4.getTranslation(uniformState.model,scratchTranslationRtc),Cesium.Cartesian3.add(scratchTranslationRtc,model._rtcCenter,scratchTranslationRtc),Cesium.Matrix4.multiplyByPoint(uniformState.view,scratchTranslationRtc,scratchTranslationRtc),Cesium.Matrix4.setTranslation(uniformState.modelView,scratchTranslationRtc,mvRtc)):uniformState.modelView}},MODELVIEWPROJECTION:function(uniformState,model){return function(){return uniformState.modelViewProjection}},MODELINVERSE:function(uniformState,model){return function(){return uniformState.inverseModel}},VIEWINVERSE:function(uniformState,model){return function(){return uniformState.inverseView}},PROJECTIONINVERSE:function(uniformState,model){return function(){return uniformState.inverseProjection}},MODELVIEWINVERSE:function(uniformState,model){return function(){return uniformState.inverseModelView}},MODELVIEWPROJECTIONINVERSE:function(uniformState,model){return function(){return uniformState.inverseModelViewProjection}},MODELINVERSETRANSPOSE:function(uniformState,model){return function(){return uniformState.inverseTransposeModel}},MODELVIEWINVERSETRANSPOSE:function(uniformState,model){return function(){return uniformState.normal}},VIEWPORT:function(uniformState,model){return function(){return uniformState.viewportCartesian4}}};ModelUtility.getGltfSemanticUniforms=function(){return gltfSemanticUniforms};var ModelUtility_default=ModelUtility;function GltfInstanceCollection(options){this._meshId=Cesium.defaultValue(options.meshId,-1),this._instances=Cesium.defaultValue(options.instances,[]),this._model=Cesium.defaultValue(options.model,void 0),this._frameState=Cesium.defaultValue(options.frameState,void 0),this.show=Cesium.defaultValue(options.show,!0),this._instancingSupported=!1,this._dynamic=Cesium.defaultValue(options.dynamic,!1),this._allowPicking=Cesium.defaultValue(options.allowPicking,!0),this._dirty=!1,this.resource=options.model.content._resource,this._cull=Cesium.defaultValue(options.cull,!0),this._opaquePass=Cesium.defaultValue(options.opaquePass,Cesium.Pass.OPAQUE),this._drawCommands=[];let parentbatchTable=this._model.content._batchTable,evID=0;Cesium.defined(parentbatchTable)&&Cesium.defined(parentbatchTable._properties.EVID)?evID=Cesium.defined(parentbatchTable._properties.EVID[0])?parentbatchTable._properties.EVID[0]:1:evID=parentbatchTable._content._tile._header.EVID;let batchTableJson={EVID:[],id:[],name:[]},nodes=this._model.gltf.nodes;for(let i=0;i<this._instances.length;i++){let nodeId=this._instances[i]._nodeId,node=nodes[nodeId];this._instances[i]._instanceId=node.instanceIndex,batchTableJson.id.push(node.componentID),batchTableJson.name.push(node.componentName),batchTableJson.EVID.push(evID)}this._batchTable=new Cesium3DTileBatchTable_default(Cesium.defined(this._model)?this._model.content:void 0,this._instances.length,batchTableJson),this._batchTable.upMatrix=Cesium.Axis.Y_UP_TO_Z_UP,this._features=void 0,this._vertexBufferTypedArray=void 0,this._vertexBuffer=void 0,this._batchIdBuffer=void 0,this._pickIdBuffer=void 0,this._features=void 0,this._drawCommands=[],this._modelCommands=void 0,Cesium.defined(this._model.content._tile._boundingVolume)?this._boundingSphere=Cesium.BoundingSphere.clone(this._model.content._tile._boundingVolume._boundingSphere):this._boundingSphere=createBoundingSphere(this),this._center=Cesium.Cartesian3.clone(this._boundingSphere.center),this._rtcTransform=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._rtcModelView=new Cesium.Matrix4,this._mode=void 0,this.modelMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._modelMatrix=Cesium.Matrix4.clone(this.modelMatrix),this._boundingVolume=createBoundingVolume(this._boundingSphere,this.modelMatrix),this._asynchronous=options.asynchronous,this._incrementallyLoadTextures=options.incrementallyLoadTextures,this._upAxis=options.upAxis,this._forwardAxis=options.forwardAxis,this._tileset=this._model.content.tileset}Object.defineProperties(GltfInstanceCollection.prototype,{length:{get:function(){return this._instances.length}},featuresLength:{get:function(){return this._batchTable.featuresLength}},tileset:{get:function(){return this._tileset}},batchTable:{get:function(){return this._batchTable}},url:{get:function(){return this.resource.getUrlComponent(!0)}}});GltfInstanceCollection.prototype.isDestroyed=function(){return!1};GltfInstanceCollection.prototype.destroy=function(){return this._instances=[],Cesium.defined(this._pickIdBuffer)&&!this._pickIdBuffer.isDestroyed()&&this._pickIdBuffer.destroy(),Cesium.defined(this._batchIdBuffer)&&!this._batchIdBuffer.isDestroyed()&&this._batchIdBuffer.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Cesium.destroyObject(this)};function createBoundingSphere(collection){let instancesLength=collection.length,points2=new Array(instancesLength);for(let i=0;i<instancesLength;++i)points2[i]=Cesium.Matrix4.getTranslation(collection._instances[i]._modelMatrix,new Cesium.Cartesian3);return Cesium.BoundingSphere.fromPoints(points2)}var scratchScale=new Cesium.Cartesian3;function createBoundingVolume(boundingSphere,transform3){if(!Cesium.defined(boundingSphere))throw new Cesium.RuntimeError("boundingSphere must be defined");if(Cesium.defined(boundingSphere)){let center2=boundingSphere.center,radius=boundingSphere.radius;center2=Cesium.Matrix4.multiplyByPoint(transform3,center2,center2);let scale4=Cesium.Matrix4.getScale(transform3,scratchScale);return radius*=Cesium.Cartesian3.maximumComponent(scale4),new Cesium.TileBoundingSphere(center2,radius)}}function EV_E3MInternalInstance(options){if(!Cesium.defined(options.model))throw new Cesium.DeveloperError("EV_E3MInternalInstance: options.model is required.");this._model=options.model,this.modelInstanceCollections=[],this._instancedUniformsByProgram=void 0,this._usesBatchTable=!0,this._tileset=this._model.content.tileset,this._precreatedAttributes=void 0}EV_E3MInternalInstance.prototype.postUpdate=function(frameState,model){for(let i=0;i<this.modelInstanceCollections.length;i++){let collection=this.modelInstanceCollections[i],modeChanged=frameState.mode!==collection._mode,modelMatrix=model.modelMatrix,modelMatrixChanged=!Cesium.Matrix4.equals(collection._modelMatrix,modelMatrix);applyDebugSettings(collection,collection._tileset,frameState),(modeChanged||modelMatrixChanged)&&(collection._mode=frameState.mode,Cesium.Matrix4.clone(modelMatrix,collection._modelMatrix),collection._rtcTransform=collection._modelMatrix)}};function applyDebugSettings(collection,tileset,frameState){if(tileset.debugShowBoundingVolume||tileset.debugShowContentBoundingVolume){let color=Cesium.Color.BLUE;Cesium.defined(collection._debugBoundingVolume)||(collection._debugBoundingVolume=collection._boundingVolume.createDebugVolume(color)),collection._debugBoundingVolume.update(frameState)}}EV_E3MInternalInstance.prototype.generateInstanceCommandByGltf=function(model,context,instances,frameState){let drawCommands=[];for(let meshId in instances._hash)if(instances.length>0){let gltfInstanceCollection=new GltfInstanceCollection({instances:instances._hash[meshId],model,meshId,frameState});frameState&&this.cesium3DTileBatchTableUpdate(model.content,frameState),createDrawCommand(this,gltfInstanceCollection,context,frameState.scene3DOnly),this.modelInstanceCollections.push(gltfInstanceCollection)}};var featureScratchColor=new Cesium.Color;EV_E3MInternalInstance.prototype.applyStyle=function(style){for(let j=0;j<this.modelInstanceCollections.length;j++){let collection=this.modelInstanceCollections[j];if(collection.featuresLength===0){let hasColorStyle=Cesium.defined(style)&&Cesium.defined(style.color),hasShowStyle=Cesium.defined(style)&&Cesium.defined(style.show);collection._model.color=hasColorStyle?style.color.evaluateColor(void 0,collection._model.color):Cesium.Color.clone(Cesium.Color.WHITE,collection._model.color),collection._model.show=hasShowStyle?style.show.evaluate(void 0):!0}else{if(!Cesium.defined(style)){collection._batchTable.setAllColor(Cesium3DTileBatchTable_default._DEFAULT_COLOR_VALUE),collection._batchTable.setAllShow(Cesium3DTileBatchTable_default._DEFAULT_SHOW_VALUE);return}let length3=collection._batchTable.featuresLength;for(let i=0;i<length3;++i){let feature2=getFeature(collection,i),color=Cesium.defined(style.color)?style.color.evaluateColor(feature2,featureScratchColor):Cesium3DTileBatchTable_default._DEFAULT_COLOR_VALUE,show=Cesium.defined(style.show)?style.show.evaluate(feature2):Cesium3DTileBatchTable_default._DEFAULT_SHOW_VALUE;if(collection._batchTable.setColor(i,color),collection._batchTable.setShow(i,show),Cesium.defined(style.translation)){let translation=style.translation.evaluate(feature2);collection._batchTable.setTranslation(i,translation)}if(Cesium.defined(style.scale)){let scale4=style.scale.evaluate(feature2);collection._batchTable.setScale(i,scale4)}if(Cesium.defined(style.rotation)){let rotation2=style.rotation.evaluate(feature2);collection._batchTable.setRotation(i,rotation2)}}}}};EV_E3MInternalInstance.prototype.cesium3DTileBatchTableUpdate=function(tileset,frameState){let context=frameState.context,passes=frameState.passes;for(let i=0;i<this.modelInstanceCollections.length;i++){let collection=this.modelInstanceCollections[i],batchTable=collection._batchTable;batchTable._defaultTexture=context.defaultTexture,!NO_support_OES_float&&!Cesium.defined(batchTable._defaultTransTexture)&&Cesium.defined(batchTable._textureDimensions)&&(batchTable._defaultTransTexture=createDefaultTRTexture2(batchTable,context)),!NO_support_OES_float&&!Cesium.defined(batchTable._defaultScaleTexture)&&Cesium.defined(batchTable._textureDimensions)&&(batchTable._defaultScaleTexture=createDefaultScaleTexture2(batchTable,context)),!NO_support_OES_float&&!Cesium.defined(batchTable._defaultRotationTexture)&&Cesium.defined(batchTable._textureDimensions)&&(batchTable._defaultRotationTexture=createDefaultTRTexture2(batchTable,context)),(passes.pick||passes.postProcess)&&createPickTexture2(batchTable,context,collection),batchTable._batchValuesDirty&&(batchTable._batchValuesDirty=!1,!Cesium.defined(batchTable._batchTexture)&&Cesium.defined(batchTable._batchValues)&&(batchTable._batchTexture=createBatchTexture(batchTable,context,batchTable._batchValues),tileset._statistics.batchTableByteLength+=batchTable._batchTexture.sizeInBytes),!NO_support_OES_float&&!Cesium.defined(batchTable._translationTexture)&&Cesium.defined(batchTable._transValues)&&(batchTable._translationTexture=createSRTTexture2(batchTable,context,batchTable._transValues)),!NO_support_OES_float&&!Cesium.defined(batchTable._scaleTexture)&&Cesium.defined(batchTable._scaleValues)&&(batchTable._scaleTexture=createSRTTexture2(batchTable,context,batchTable._scaleValues)),!NO_support_OES_float&&!Cesium.defined(batchTable._rotationTexture)&&Cesium.defined(batchTable._rotationValues)&&(batchTable._rotationTexture=createSRTTexture2(batchTable,context,batchTable._rotationValues)),Cesium.defined(batchTable._batchValues)&&updateBatchTexture2(batchTable),!NO_support_OES_float&&Cesium.defined(batchTable._transValues)&&updateSRTTexture2(batchTable,batchTable._transValues,batchTable._translationTexture),!NO_support_OES_float&&Cesium.defined(batchTable._scaleValues)&&updateSRTTexture2(batchTable,batchTable._scaleValues,batchTable._scaleTexture),!NO_support_OES_float&&Cesium.defined(batchTable._rotationValues)&&updateSRTTexture2(batchTable,batchTable._rotationValues,batchTable._rotationTexture))}};EV_E3MInternalInstance.prototype.destroy=function(){Cesium.defined(this._precreatedAttributes)&&destroy(this._model._rendererResources.vertexArrays);for(let i=0;i<this.modelInstanceCollections.length;i++)this.modelInstanceCollections[i].destroy(),this.modelInstanceCollections[i]=void 0;return this.modelInstanceCollections=[],this._model=null,Cesium.destroyObject(this)};EV_E3MInternalInstance.prototype.regenerateShaders=function(programToCreate,model,context){recreateProgram(programToCreate,model,context,this)};EV_E3MInternalInstance.prototype.getFeature=function(collection,batchId){return getFeature(collection,batchId)};function destroy(property){for(let name in property)property.hasOwnProperty(name)&&(property[name].isDestroyed()||property[name].destroy())}function createPickTexture2(batchTable,context,collection){let featuresLength=batchTable.featuresLength;if(!Cesium.defined(batchTable._pickTexture)&&featuresLength>0){let pickIds=batchTable._pickIds,dimensions=batchTable._textureDimensions,byteLength=dimensions.x*dimensions.y*4,bytes=new Uint8Array(byteLength),content=batchTable._content;for(let i=0;i<featuresLength;++i){let pickId=context.createPickId(getFeature(collection,i));pickIds.push(pickId);let pickColor=pickId.color,offset=i*4;bytes[offset]=Cesium.Color.floatToByte(pickColor.red),bytes[offset+1]=Cesium.Color.floatToByte(pickColor.green),bytes[offset+2]=Cesium.Color.floatToByte(pickColor.blue),bytes[offset+3]=Cesium.Color.floatToByte(pickColor.alpha)}batchTable._pickTexture=createBatchTexture(batchTable,context,bytes),content.tileset._statistics.batchTableByteLength+=batchTable._pickTexture.sizeInBytes}}function getFeature(collection,batchId){let featuresLength=collection.featuresLength;return createFeatures(collection),collection._features[batchId]}function createFeatures(collection){let featuresLength=collection.featuresLength;if(!Cesium.defined(collection._features)&&featuresLength>0){let features=new Array(featuresLength);for(let i=0;i<featuresLength;++i)features[i]=new Cesium3DTileFeature_default(collection,i);collection._features=features}}function createBatchTexture(batchTable,context,bytes){let dimensions=batchTable._textureDimensions;return new Texture_default({context,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_BYTE,source:{width:dimensions.x,height:dimensions.y,arrayBufferView:bytes},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function createSRTTexture2(batchTable,context,bytes){let dimensions=batchTable._textureDimensions;return new Texture_default({context,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:dimensions.x,height:dimensions.y,arrayBufferView:bytes},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function updateBatchTexture2(batchTable){let dimensions=batchTable._textureDimensions;batchTable._batchTexture.copyFrom({width:dimensions.x,height:dimensions.y,arrayBufferView:batchTable._batchValues})}function updateSRTTexture2(batchTable,arrayBuffer,texture){let dimensions=batchTable._textureDimensions;texture.copyFrom({width:dimensions.x,height:dimensions.y,arrayBufferView:arrayBuffer})}function createDefaultTRTexture2(batchTable,context){return new Texture_default({context,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([0,0,0,1])},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function createDefaultScaleTexture2(batchTable,context){return new Texture_default({context,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([1,1,1,1])},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function createVertexBuffer(collection,context){let i,instancesLength=collection._instances.length,dynamic=collection._dynamic,usesBatchTable=Cesium.defined(collection._batchTable);if(usesBatchTable){let batchIdBufferData=new Uint16Array(instancesLength);for(i=0;i<instancesLength;++i)batchIdBufferData[i]=i;collection._batchIdBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray:batchIdBufferData,usage:Cesium.BufferUsage.STATIC_DRAW})}if(!usesBatchTable){let pickIdBuffer=new Uint8Array(instancesLength*4);for(i=0;i<instancesLength;++i){let pickColor=collection._pickIds[i].color,offset=i*4;pickIdBuffer[offset]=Cesium.Color.floatToByte(pickColor.red),pickIdBuffer[offset+1]=Cesium.Color.floatToByte(pickColor.green),pickIdBuffer[offset+2]=Cesium.Color.floatToByte(pickColor.blue),pickIdBuffer[offset+3]=Cesium.Color.floatToByte(pickColor.alpha)}collection._pickIdBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray:pickIdBuffer,usage:Cesium.BufferUsage.STATIC_DRAW})}let vertexBufferTypedArray=getVertexBufferTypedArray(collection);collection._vertexBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray:vertexBufferTypedArray,usage:dynamic?Cesium.BufferUsage.STREAM_DRAW:Cesium.BufferUsage.STATIC_DRAW})}var scratchGltfMatrix=new Cesium.Matrix4;function getVertexBufferTypedArray(collection){let instances=collection._instances,instancesLength=instances.length,collectionCenter=collection._center,vertexSizeInFloats=12,bufferData=collection._vertexBufferTypedArray;Cesium.defined(bufferData)||(bufferData=new Float32Array(instancesLength*vertexSizeInFloats)),collection._dynamic&&(collection._vertexBufferTypedArray=bufferData);for(let i=0;i<instancesLength;++i){let modelMatrix=instances[i]._modelMatrix,instanceMatrix=Cesium.Matrix4.clone(modelMatrix,scratchGltfMatrix),offset=i*vertexSizeInFloats;bufferData[offset+0]=instanceMatrix[0],bufferData[offset+1]=instanceMatrix[4],bufferData[offset+2]=instanceMatrix[8],bufferData[offset+3]=instanceMatrix[12],bufferData[offset+4]=instanceMatrix[1],bufferData[offset+5]=instanceMatrix[5],bufferData[offset+6]=instanceMatrix[9],bufferData[offset+7]=instanceMatrix[13],bufferData[offset+8]=instanceMatrix[2],bufferData[offset+9]=instanceMatrix[6],bufferData[offset+10]=instanceMatrix[10],bufferData[offset+11]=instanceMatrix[14]}return bufferData}function createDrawCommand(gltfInstance,collection,context,scene3DOnly){createVertexBuffer(collection,context);let usesBatchTable=Cesium.defined(collection._batchTable),vertexSizeInFloats=12,componentSizeInBytes=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),instancedAttributes={czm_modelMatrixRow0:{index:0,vertexBuffer:collection._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:componentSizeInBytes*vertexSizeInFloats,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:collection._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:componentSizeInBytes*4,strideInBytes:componentSizeInBytes*vertexSizeInFloats,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:collection._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:componentSizeInBytes*8,strideInBytes:componentSizeInBytes*vertexSizeInFloats,instanceDivisor:1}};usesBatchTable&&(instancedAttributes.a_batchId={index:0,vertexBuffer:collection._batchIdBuffer,componentsPerAttribute:1,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),usesBatchTable||(instancedAttributes.pickColor={index:0,vertexBuffer:collection._pickIdBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1});let model=collection._model;gltfInstance._precreatedAttributes=instancedAttributes;let nodeCommands=model._nodeCommands,pickIds=model._pickIds,allowPicking=model.allowPicking,runtimeMeshesByName=model._runtime.meshesByName,resources=model._rendererResources,rendererVertexArrays=resources.vertexArrays,rendererPrograms=resources.programs,rendererRenderStates=resources.renderStates,uniformMaps=model._uniformMaps,runtimeNodes=model._runtime.nodes,gltf=model.gltf,accessors=gltf.accessors,mesh=gltf.meshes[collection._meshId],primitives=mesh.primitives,length3=primitives.length;for(let i=0;i<length3;++i){let primitive=primitives[i],ix=accessors[primitive.indices],material=model._runtime.materialsById[primitive.material],programId=material._program,decodedData=model._decodedData[`${collection._meshId}.primitive.${i}`],boundingSphere,positionAccessor=primitive.attributes.POSITION;if(Cesium.defined(positionAccessor)){let minMax=ModelUtility_default.getAccessorMinMax(gltf,positionAccessor);boundingSphere=Cesium.BoundingSphere.fromCornerPoints(Cesium.Cartesian3.fromArray(minMax.min),Cesium.Cartesian3.fromArray(minMax.max))}createResources(gltfInstance,collection,material._technique,model,context);let gltfNode=gltf.nodes[collection._instances[0]._nodeId],runtimeNode=runtimeNodes[collection._instances[0]._nodeId];if(runtimeNode.matrix=Cesium.Matrix4.IDENTITY,!Cesium.defined(gltfNode.mesh))continue;let vertexArray=rendererVertexArrays[`${collection._meshId}.primitive.${i}`],offset,count2;Cesium.defined(decodedData)?(count2=decodedData.numberOfIndices,offset=0):Cesium.defined(ix)?(count2=ix.count,offset=ix.byteOffset/Cesium.IndexDatatype.getSizeInBytes(ix.componentType)):(count2=accessors[primitive.attributes.POSITION].count,offset=0),model._trianglesLength+=triangleCountFromPrimitiveIndices(primitive,count2);let um=uniformMaps[primitive.material],uniformMap=um.uniformMap;if(Cesium.defined(um.jointMatrixUniformName)){let jointUniformMap={};jointUniformMap[um.jointMatrixUniformName]=createJointMatricesFunction(runtimeNode),uniformMap=Cesium.combine(uniformMap,jointUniformMap)}if(model._tilesetFlat&&(uniformMap=Cesium.combine(uniformMap,model._tilesetFlat._updateModelUniformMap())),Cesium.defined(um.morphWeightsUniformName)){let morphWeightsUniformMap={};morphWeightsUniformMap[um.morphWeightsUniformName]=createMorphWeightsFunction(runtimeNode),uniformMap=Cesium.combine(uniformMap,morphWeightsUniformMap)}uniformMap=Cesium.combine(uniformMap,{gltf_color:createColorFunction(model),gltf_colorBlend:createColorBlendFunction(model),gltf_clippingPlanes:createClippingPlanesFunction(model),gltf_clippingPlanesEdgeStyle:createClippingPlanesEdgeStyleFunction(model),gltf_clippingPlanesMatrix:createClippingPlanesMatrixFunction(model),gltf_iblFactor:createIBLFactorFunction(model),gltf_lightColor:createLightColorFunction(model),gltf_sphericalHarmonicCoefficients:createSphericalHarmonicCoefficientsFunction(model),gltf_specularMap:createSpecularEnvironmentMapFunction(model),gltf_specularMapSize:createSpecularEnvironmentMapSizeFunction(model),gltf_maxSpecularLOD:createSpecularEnvironmentMapLOD(model),gltf_luminanceAtZenith:createLuminanceAtZenithFunction(model)}),uniformMap=getInstancedUniformMap(collection,context,uniformMap,programId,runtimeNode);let quantizedUniformMap={};model.extensionsUsed.WEB3D_quantized_attributes?quantizedUniformMap=createUniformsForQuantizedAttributes(model,primitive):model._dequantizeInShader&&Cesium.defined(decodedData)&&(quantizedUniformMap=createUniformsForDracoQuantizedAttributes(decodedData)),uniformMap=Cesium.combine(uniformMap,quantizedUniformMap);let rs=rendererRenderStates[primitive.material],isTranslucent2=rs.blending.enabled,owner;Cesium.defined(owner)||(owner={primitive:model,id:model.id,node:runtimeNode.publicNode,mesh:runtimeMeshesByName[mesh.name],meshId:collection._meshId});let castShadows=Cesium.ShadowMode.castShadows(model._shadows),receiveShadows=Cesium.ShadowMode.receiveShadows(model._shadows),pickId;if(allowPicking&&!Cesium.defined(model._uniformMapLoaded)){pickId=context.createPickId(owner),pickIds.push(pickId);let pickUniforms={czm_pickColor:createPickColorFunction(pickId.color)};uniformMap=Cesium.combine(uniformMap,pickUniforms)}allowPicking&&(Cesium.defined(model._pickIdLoaded)&&Cesium.defined(model._uniformMapLoaded)?pickId=model._pickIdLoaded():pickId="czm_pickColor");let command=new Cesium.DrawCommand({boundingVolume:new Cesium.BoundingSphere,cull:model.cull,modelMatrix:new Cesium.Matrix4,primitiveType:primitive.mode,vertexArray,count:count2,offset,shaderProgram:rendererPrograms[programId],castShadows,receiveShadows,uniformMap,renderState:rs,owner,pass:isTranslucent2?Cesium.Pass.TRANSLUCENT:model.opaquePass,pickId,debugShowBoundingVolume:!1}),command2D;scene3DOnly||(command2D=Cesium.DrawCommand.shallowClone(command),command2D.boundingVolume=new Cesium.BoundingSphere,command2D.modelMatrix=new Cesium.Matrix4);let nodeCommand={show:!0,boundingSphere,command,command2D,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,programId};collection._instancingSupported=context.instancedArrays;let instancingSupported=collection._instancingSupported;generateModelCommands(collection,instancingSupported,[nodeCommand.command]),updateShadows(collection),updateWireframe(collection),updateShowBoundingVolume(collection),Cesium.ForEach.object(collection._drawCommands,function(drawCommand,index){runtimeNode.gltfInstaced=!0,nodeCommand.command=drawCommand,runtimeNode.commands.push(nodeCommand),nodeCommands.push(nodeCommand)})}}function getInstancedUniformMap(collection,context,uniformMap,programId,node){uniformMap=Cesium.clone(uniformMap),uniformMap.czm_instanced_modifiedModelView=createModifiedModelView(collection,context),uniformMap.czm_instanced_nodeTransform=createNodeTransformFunction(node),uniformMap.czm_instanced_modelMatrix=createModelMatrix(collection),uniformMap.czm_instanced_inverseModelMatrix=createInverseModelMatrix(collection);let instancedUniforms=getInstancedUniforms(collection,programId);for(let uniform in instancedUniforms)instancedUniforms.hasOwnProperty(uniform)&&delete uniformMap[uniform];return Cesium.defined(collection._batchTable)&&(uniformMap=collection._batchTable.getUniformMapCallback()(uniformMap)),uniformMap}function createNodeTransformFunction(node){return function(){return node.computedMatrix}}function createModifiedModelView(collection,context){return function(){return Cesium.Matrix4.multiply(context.uniformState.view,collection._rtcTransform,collection._rtcModelView)}}function createModelMatrix(collection){return function(){return collection._rtcTransform}}function createInverseModelMatrix(collection){return function(){return Cesium.Matrix4.inverse(collection._rtcTransform,new Cesium.Matrix4)}}function updateShadows(collection){if(collection.shadows!==collection._shadows){collection._shadows=collection.shadows;let castShadows=Cesium.ShadowMode.castShadows(collection.shadows),receiveShadows=Cesium.ShadowMode.receiveShadows(collection.shadows),drawCommands=collection._drawCommands,length3=drawCommands.length;for(let i=0;i<length3;++i){let drawCommand=drawCommands[i];drawCommand.castShadows=castShadows,drawCommand.receiveShadows=receiveShadows}}}function updateWireframe(collection){if(collection._debugWireframe!==collection.debugWireframe){collection._debugWireframe=collection.debugWireframe;let primitiveType=collection.debugWireframe?Cesium.PrimitiveType.LINES:Cesium.PrimitiveType.TRIANGLES,commands=collection._drawCommands,length3=commands.length;for(let i=0;i<length3;++i)commands[i].primitiveType=primitiveType}}function updateShowBoundingVolume(collection){if(collection.debugShowBoundingVolume!==collection._debugShowBoundingVolume){collection._debugShowBoundingVolume=collection.debugShowBoundingVolume;let commands=collection._drawCommands,length3=commands.length;for(let i=0;i<length3;++i)commands[i].debugShowBoundingVolume=collection.debugShowBoundingVolume}}function generateModelCommands(modelInstanceCollection,instancingSupported,drawCommands){instancingSupported?createCommandsInstanced(modelInstanceCollection,drawCommands):(createCommandsNonInstanced(modelInstanceCollection,drawCommands),updateCommandsNonInstanced(modelInstanceCollection))}function createCommandsInstanced(collection,drawCommands){let commandsLength=drawCommands.length,instancesLength=collection.length,boundingSphere=collection._boundingSphere,cull=collection._cull;for(let i=0;i<commandsLength;++i){let drawCommand=Cesium.DrawCommand.shallowClone(drawCommands[i]);drawCommand.instanceCount=instancesLength,drawCommand.boundingVolume=boundingSphere,drawCommand.cull=cull,Cesium.defined(collection._batchTable)?drawCommand.pickId=collection._batchTable.getPickId():drawCommand.pickId="v_pickColor",collection._drawCommands.push(drawCommand)}}function createCommandsNonInstanced(collection,drawCommands){let instances=collection._instances,commandsLength=drawCommands.length,instancesLength=collection.length,batchTable=collection._batchTable,usesBatchTable=Cesium.defined(batchTable),cull=collection._cull;for(let i=0;i<commandsLength;++i)for(let j=0;j<instancesLength;++j){let drawCommand=Cesium.DrawCommand.shallowClone(drawCommands[i]);if(drawCommand.modelMatrix=new Cesium.Matrix4,drawCommand.boundingVolume=new Cesium.BoundingSphere,drawCommand.cull=cull,drawCommand.uniformMap=Cesium.clone(drawCommand.uniformMap),usesBatchTable)drawCommand.uniformMap.a_batchId=createBatchIdFunction(instances[j]._instanceId);else{let pickId=collection._pickIds[j];drawCommand.uniformMap.czm_pickColor=createPickColorFunction(pickId.color)}collection._drawCommands.push(drawCommand)}}function updateCommandsNonInstanced(collection){let modelCommands=collection._modelCommands,commandsLength=modelCommands.length,instancesLength=collection.length,collectionTransform=collection._rtcTransform,collectionCenter=collection._center;for(let i=0;i<commandsLength;++i){let modelCommand=modelCommands[i];for(let j=0;j<instancesLength;++j){let commandIndex=i*instancesLength+j,drawCommand=collection._drawCommands[commandIndex],instanceMatrix=Cesium.Matrix4.clone(collection._instances[j]._modelMatrix,void 0);instanceMatrix[12]-=collectionCenter.x,instanceMatrix[13]-=collectionCenter.y,instanceMatrix[14]-=collectionCenter.z,instanceMatrix=Cesium.Matrix4.multiply(collectionTransform,instanceMatrix,void 0);let nodeMatrix=modelCommand.modelMatrix,modelMatrix=drawCommand.modelMatrix;Cesium.Matrix4.multiply(instanceMatrix,nodeMatrix,modelMatrix);let nodeBoundingSphere=modelCommand.boundingVolume,boundingSphere=drawCommand.boundingVolume;Cesium.BoundingSphere.transform(nodeBoundingSphere,instanceMatrix,boundingSphere)}}}function triangleCountFromPrimitiveIndices(primitive,indicesCount){switch(primitive.mode){case Cesium.PrimitiveType.TRIANGLES:return indicesCount/3;case Cesium.PrimitiveType.TRIANGLE_STRIP:case Cesium.PrimitiveType.TRIANGLE_FAN:return Math.max(indicesCount-2,0);default:return 0}}function createResources(gltfInstance,collection,techniqueId,model,context){let quantizedVertexShaders=model._quantizedVertexShaders,toClipCoordinates=Cesium.defined(model._toClipCoordinatesGLSL)?model._toClipCoordinatesGLSL:model._toClipCoordinatesGLSL={},shaders=model._rendererResources.sourceShaders,techniques=model._sourceTechniques,programs=model._sourcePrograms;if(techniques.hasOwnProperty(techniqueId)){let programId=techniques[techniqueId].program,program=programs[programId],shader=shaders[program.vertexShader];if(ModelUtility_default.checkSupportedGlExtensions(program.glExtensions,context),model.extensionsUsed.WEB3D_quantized_attributes||model._dequantizeInShader){let quantizedVS=quantizedVertexShaders[programId];Cesium.defined(quantizedVS)||(quantizedVS=modifyShaderForQuantizedAttributes(shader,programId,model),quantizedVertexShaders[programId]=quantizedVS),shader=quantizedVS}shader=modifyShader(collection,techniqueId,shader,programId,gltfInstance),toClipCoordinates[programId]=ModelUtility_default.toClipCoordinatesGLSL(model.gltf,shader),createProgram({programId,techniqueId},collection,model,context,gltfInstance),createVertexArrays(model,collection._meshId,context,gltfInstance)}}function getInstancedUniforms(gltfInstance,techniqueId,programId){if(Cesium.defined(gltfInstance._instancedUniformsByProgram)&&gltfInstance._instancedUniformsByProgram.hasOwnProperty(programId))return gltfInstance._instancedUniformsByProgram[programId];let instancedUniformsByProgram={};gltfInstance._instancedUniformsByProgram=instancedUniformsByProgram;let modelSemantics=["MODEL","MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELINVERSE","MODELVIEWINVERSE","MODELVIEWPROJECTIONINVERSE","MODELINVERSETRANSPOSE","MODELVIEWINVERSETRANSPOSE"],supportedSemantics=["MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELVIEWINVERSETRANSPOSE"],techniques=gltfInstance._model._sourceTechniques;if(techniques.hasOwnProperty(techniqueId)){let technique=techniques[techniqueId],program=technique.program;if(!Cesium.defined(instancedUniformsByProgram[program])){let uniformMap={};instancedUniformsByProgram[program]=uniformMap,Cesium.ForEach.techniqueUniform(technique,getCheckUniformSemanticFunction(modelSemantics,supportedSemantics,programId,uniformMap))}}return instancedUniformsByProgram[programId]}function getCheckUniformSemanticFunction(modelSemantics,supportedSemantics,programId,uniformMap){return function(uniform,uniformName){let semantic=uniform.semantic;if(Cesium.defined(semantic)&&modelSemantics.indexOf(semantic)>-1)if(supportedSemantics.indexOf(semantic)>-1)uniformMap[uniformName]=semantic;else throw new Cesium.RuntimeError(`Shader program cannot be optimized for instancing. Uniform "${uniformName}" in program "${programId}" uses unsupported semantic "${semantic}"`)}}function modifyFragmentShader(fs,programId,gltfInstance){let batchTable=gltfInstance._usesBatchTable;if(Cesium.defined(batchTable)){let gltf=gltfInstance._model.gltf,diffuseAttributeOrUniformName=ModelUtility_default.getDiffuseAttributeOrUniform(gltf,programId);fs=getBatchTableFragmentShaderCallback(!0,diffuseAttributeOrUniformName,fs)}else fs=`varying vec4 v_pickColor;
${fs}`;return fs}function modifyVertexShader(vs,programId,techniqueId,gltfInstance){let instancedUniforms=getInstancedUniforms(gltfInstance,techniqueId,programId),usesBatchTable=gltfInstance._usesBatchTable,renamedSource=Cesium.ShaderSource.replaceMain(vs,"czm_instancing_main"),globalVarsHeader="",globalVarsMain="";for(let uniform in instancedUniforms)if(instancedUniforms.hasOwnProperty(uniform)){let semantic=instancedUniforms[uniform],varName;semantic==="MODELVIEW"||semantic==="CESIUM_RTC_MODELVIEW"?varName="czm_instanced_modelView":semantic==="MODELVIEWPROJECTION"?(varName="czm_instanced_modelViewProjection",globalVarsHeader+=`mat4 czm_instanced_modelViewProjection;
`,globalVarsMain+=`czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;
`):semantic==="MODELVIEWINVERSETRANSPOSE"&&(varName="czm_instanced_modelViewInverseTranspose",globalVarsHeader+=`mat3 czm_instanced_modelViewInverseTranspose;
`,globalVarsMain+=`czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);
`);let regex=new RegExp(`uniform.*${uniform}.*`);renamedSource=renamedSource.replace(regex,""),regex=new RegExp(`${uniform}\\b`,"g"),renamedSource=renamedSource.replace(regex,varName)}let uniforms=`uniform mat4 czm_instanced_modifiedModelView;
uniform mat4 czm_instanced_modelMatrix;
uniform mat4 czm_instanced_inverseModelMatrix;
uniform mat4 czm_instanced_nodeTransform;
`,batchIdAttribute,pickAttribute,pickVarying;usesBatchTable?(batchIdAttribute="",pickAttribute="",pickVarying=""):(batchIdAttribute="",pickAttribute=`attribute vec4 pickColor;
varying vec4 v_pickColor;
`,pickVarying=`    v_pickColor = pickColor;
`);let instancedSource=`${uniforms+globalVarsHeader}mat4 czm_instanced_modelView;
attribute vec4 czm_modelMatrixRow0;
attribute vec4 czm_modelMatrixRow1;
attribute vec4 czm_modelMatrixRow2;
${batchIdAttribute}${pickAttribute}${renamedSource}void main()
{
    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);
    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model *  czm_instanced_nodeTransform      ;
${globalVarsMain}    czm_instancing_main();
${pickVarying}}
`;if(usesBatchTable){let gltf=gltfInstance._model.gltf,diffuseAttributeOrUniformName=ModelUtility_default.getDiffuseAttributeOrUniform(gltf,programId);instancedSource=getBatchTableVertexShaderCallback(!0,"a_batchId",diffuseAttributeOrUniformName,instancedSource)}return instancedSource}var ev_fromTranslationQuaternionRotationScale2=`mat4 ev_fromTranslationQuaternionRotationScale(vec3 translation, vec4 quaternion, vec3 scale)
{
      float x2 = quaternion.x * quaternion.x;
      float xy = quaternion.x * quaternion.y;
      float xz = quaternion.x * quaternion.z;
      float xw = quaternion.x * quaternion.w;
      float y2 = quaternion.y * quaternion.y;
      float yz = quaternion.y * quaternion.z;
      float yw = quaternion.y * quaternion.w;
      float z2 = quaternion.z * quaternion.z;
      float zw = quaternion.z * quaternion.w;
      float w2 = quaternion.w * quaternion.w;

      float m00 = x2 - y2 - z2 + w2;
      float m01 = 2.0 * (xy - zw);
      float m02 = 2.0 * (xz + yw);

      float m10 = 2.0 * (xy + zw);
      float m11 = -x2 + y2 - z2 + w2;
      float m12 = 2.0 * (yz - xw);

      float m20 = 2.0 * (xz - yw);
      float m21 = 2.0 * (yz + xw);
      float m22 = -x2 - y2 + z2 + w2;
      return mat4(
        m00 * scale.x , m01* scale.x, m02* scale.x, 0.0,
        m10 * scale.y, m11 * scale.y, m12 * scale.y, 0.0,
        m20 * scale.z, m21 * scale.z, m22 * scale.z, 0.0,
        translation.x, translation.y, translation.z, 1.0);
}
`;function getBatchTableVertexShaderCallback(handleTranslucent,batchIdAttributeName,diffuseAttributeOrUniformName,source){let renamedSource=modifyDiffuse2(source,diffuseAttributeOrUniformName,!1),addEv=!1;NO_support_OES_float||(renamedSource.indexOf("gl_Position = u_modelViewProj * vec4(a_position,1.0);")!==-1?(addEv=!0,renamedSource=renamedSource.replace("attribute vec3 a_position;",`attribute vec3 a_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),renamedSource=renamedSource.replace("gl_Position = u_modelViewProj * vec4(a_position,1.0);","gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(a_position,1.0));"),renamedSource=ev_fromTranslationQuaternionRotationScale2+renamedSource):renamedSource.indexOf("vec3 gltf_a_dec_position")!==-1?(addEv=!0,renamedSource=renamedSource.replace("vec3 gltf_a_dec_position;",`vec3 gltf_a_dec_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),renamedSource.indexOf("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0)")!==-1?renamedSource=renamedSource.replace("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0);"," gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0));"):renamedSource.indexOf("gl_Position = czm_instanced_modelViewProjection * vec4(gltf_a_dec_position,1.0)")!==-1?renamedSource=renamedSource.replace("czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model *  czm_instanced_nodeTransform"," czm_instanced_modelView = czm_instanced_modifiedModelView * ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz)* czm_instanced_model * czm_instanced_nodeTransform"):renamedSource.indexOf("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0)")!==-1&&(renamedSource=renamedSource.replace("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0);","xlat_temp_input.position = ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0);")),renamedSource=ev_fromTranslationQuaternionRotationScale2+renamedSource):renamedSource.indexOf("position = u_modelViewMatrix * position")!==-1&&(addEv=!0,renamedSource=renamedSource.replace("attribute vec3 a_position;",`attribute vec3 a_position;
vec4 trans;
vec4 scale;
vec4 rotation;`),renamedSource=renamedSource.replace("position = u_modelViewMatrix * position;","position = u_modelViewMatrix * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * position);"),renamedSource=ev_fromTranslationQuaternionRotationScale2+renamedSource));let newMain;return Cesium.ContextLimits.maximumVertexTextureImageUnits>0?(newMain="",handleTranslucent&&(newMain+=`uniform bool tile_translucentCommand; 
`),addEv&&(newMain+=`uniform sampler2D tile_transTexture; 
uniform sampler2D tile_scaleTexture; 
uniform sampler2D tile_rotationTexture; 
`),newMain+=`uniform sampler2D tile_batchTexture; 
varying vec4 tile_featureColor; 
varying vec2 tile_featureSt; 
void main() 
{ 
    vec2 st = computeSt(${batchIdAttributeName}); 
    vec4 featureProperties = texture2D(tile_batchTexture, st); 
`,addEv&&(newMain+=`    trans = texture2D(tile_transTexture, vec2(st.x,0.0)); 
`,newMain+=`    scale = texture2D(tile_scaleTexture, vec2(st.x,0.0)); 
`,newMain+=`    rotation = texture2D(tile_rotationTexture, vec2(st.x,0.0)); 
`),newMain+=`    tile_color(featureProperties); 
    float show = ceil(featureProperties.a); 
    gl_Position *= show; 
`,handleTranslucent&&(newMain+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
`),newMain+=`    tile_featureColor = featureProperties; 
    tile_featureSt = st; 
}`):newMain=`varying vec2 tile_featureSt; 
void main() 
{ 
    tile_color(vec4(1.0)); 
    tile_featureSt = computeSt(${batchIdAttributeName}); 
}`,`${renamedSource}
${getGlslComputeSt2()}${newMain}`}function getBatchTableFragmentShaderCallback(handleTranslucent,diffuseAttributeOrUniformName,source){return source=modifyDiffuse2(source,diffuseAttributeOrUniformName,!0),Cesium.ContextLimits.maximumVertexTextureImageUnits>0?source+=`uniform sampler2D tile_pickTexture; 
varying vec2 tile_featureSt; 
varying vec4 tile_featureColor; 
void main() 
{ 
    tile_color(tile_featureColor); 
}`:(handleTranslucent&&(source+=`uniform bool tile_translucentCommand; 
`),source+=`uniform sampler2D tile_pickTexture; 
uniform sampler2D tile_batchTexture; 
varying vec2 tile_featureSt; 
void main() 
{ 
    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); 
    if (featureProperties.a == 0.0) { 
        discard; 
    } 
`,handleTranslucent&&(source+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            discard; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            discard; 
        } 
    } 
`),source+=`    tile_color(featureProperties); 
} 
`),source}function modifyDiffuse2(source,diffuseAttributeOrUniformName,applyHighlight){if(!Cesium.defined(diffuseAttributeOrUniformName))return getDefaultShader2(source,applyHighlight);let regex=new RegExp(`(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+${diffuseAttributeOrUniformName};`),uniformMatch=source.match(regex);if(!Cesium.defined(uniformMatch))return getDefaultShader2(source,applyHighlight);let declaration=uniformMatch[0],type=uniformMatch[2];source=Cesium.ShaderSource.replaceMain(source,"tile_main"),source=source.replace(declaration,"");let finalDiffuseFunction=`bool isWhite(vec3 color) 
{ 
    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); 
} 
vec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) 
{ 
    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); 
    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; 
    return vec4(diffuse.rgb, sourceDiffuse.a); 
} 
`,highlight=`    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    gl_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
 if(!all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ 
	if(highlight== 0.0){
		gl_FragColor.rgb = mix(tile_featureColor.rgb, gl_FragColor.rgb, 0.4);
	}else if(highlight== 1.0){
		gl_FragColor.rgb = tile_featureColor.rgb;
	}else{
		gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight);
	}
 }`,setColor2;if(type==="vec3"||type==="vec4"){let sourceDiffuse=type==="vec3"?`vec4(${diffuseAttributeOrUniformName}, 1.0)`:diffuseAttributeOrUniformName,replaceDiffuse=type==="vec3"?"tile_diffuse.xyz":"tile_diffuse";regex=new RegExp(diffuseAttributeOrUniformName,"g"),source=source.replace(regex,replaceDiffuse),setColor2=`    vec4 source = ${sourceDiffuse}; 
    tile_diffuse = tile_diffuse_final(source, tile_featureColor); 
    tile_main(); 
`}else type==="sampler2D"&&(source=replaceDiffuseTextureCalls2(source,diffuseAttributeOrUniformName),setColor2=`    tile_diffuse = tile_featureColor; 
    tile_main(); 
`);return source=`uniform float tile_colorBlend; 
vec4 tile_diffuse = vec4(1.0); 
${finalDiffuseFunction}${declaration}
${source}
void tile_color(vec4 tile_featureColor) 
{ 
${setColor2}`,applyHighlight&&(source+=highlight),source+=`} 
`,source}function getDefaultShader2(source,applyHighlight){return source=Cesium.ShaderSource.replaceMain(source,"tile_main"),applyHighlight?`${source}uniform float tile_colorBlend; 
void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    gl_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
    gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); 
     if(highlight==1.0 && !all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ 
       gl_FragColor.rgb = tile_featureColor.rgb; 
      } 
} 
`:`${source}void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
} 
`}function replaceDiffuseTextureCalls2(source,diffuseAttributeOrUniformName){let functionCall=`texture2D(${diffuseAttributeOrUniformName}`,fromIndex=0,startIndex=source.indexOf(functionCall,fromIndex),endIndex;for(;startIndex>-1;){let nestedLevel=0;for(let i=startIndex;i<source.length;++i){let character=source.charAt(i);if(character==="(")++nestedLevel;else if(character===")"&&(--nestedLevel,nestedLevel===0)){endIndex=i+1;break}}let replacedFunction=`tile_diffuse_final(${source.slice(startIndex,endIndex)}, tile_diffuse)`;source=source.slice(0,startIndex)+replacedFunction+source.slice(endIndex),fromIndex=startIndex+replacedFunction.length,startIndex=source.indexOf(functionCall,fromIndex)}return source}function getGlslComputeSt2(){return`uniform vec4 tile_textureStep; 
uniform vec2 tile_textureDimensions; 
vec2 computeSt(float batchId) 
{ 
    float stepX = tile_textureStep.x; 
    float centerX = tile_textureStep.y; 
    float stepY = tile_textureStep.z; 
    float centerY = tile_textureStep.w; 
    float xId = mod(batchId, tile_textureDimensions.x); 
    float yId = floor(batchId / tile_textureDimensions.x); 
    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); 
} 
`}function modifyShader(collection,techniqueId,shader,programName,gltfInstance){let vs=shader,programId=programName,instancedUniforms=getInstancedUniforms(gltfInstance,techniqueId,programId),usesBatchTable=Cesium.defined(collection._batchTable),renamedSource=Cesium.ShaderSource.replaceMain(vs,"czm_instancing_main"),globalVarsHeader="",globalVarsMain="";for(let uniform in instancedUniforms)if(instancedUniforms.hasOwnProperty(uniform)){let semantic=instancedUniforms[uniform],varName;semantic==="MODELVIEW"||semantic==="CESIUM_RTC_MODELVIEW"?varName="czm_instanced_modelView":semantic==="MODELVIEWPROJECTION"?(varName="czm_instanced_modelViewProjection",globalVarsHeader+=`mat4 czm_instanced_modelViewProjection;
`,globalVarsMain+=`czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;
`):semantic==="MODELVIEWINVERSETRANSPOSE"&&(varName="czm_instanced_modelViewInverseTranspose",globalVarsHeader+=`mat3 czm_instanced_modelViewInverseTranspose;
`,globalVarsMain+=`czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);
`);let regex=new RegExp(`uniform.*${uniform}.*`);renamedSource=renamedSource.replace(regex,""),regex=new RegExp(`${uniform}\\b`,"g"),renamedSource=renamedSource.replace(regex,varName)}let uniforms=`uniform mat4 czm_instanced_modifiedModelView;
uniform mat4 czm_instanced_modelMatrix;
uniform mat4 czm_instanced_inverseModelMatrix;
uniform mat4 czm_instanced_nodeTransform;
`,batchIdAttribute,pickAttribute,pickVarying;usesBatchTable?(batchIdAttribute="",pickAttribute="",pickVarying=""):(batchIdAttribute="",pickAttribute=`attribute vec4 pickColor;
varying vec4 v_pickColor;
`,pickVarying=`    v_pickColor = pickColor;
`);let instancedSource=`${uniforms+globalVarsHeader}mat4 czm_instanced_modelView;
attribute vec4 czm_modelMatrixRow0;
attribute vec4 czm_modelMatrixRow1;
attribute vec4 czm_modelMatrixRow2;
${batchIdAttribute}${pickAttribute}${renamedSource}void main()
{
    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);
    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model * czm_instanced_nodeTransform  ;
${globalVarsMain}    czm_instancing_main();
${pickVarying}}
`;if(usesBatchTable){let gltf=collection._model.gltf,diffuseAttributeOrUniformName=ModelUtility_default.getDiffuseAttributeOrUniform(gltf,programId);instancedSource=collection._batchTable.getVertexShaderCallback(!0,"a_batchId",diffuseAttributeOrUniformName)(instancedSource)}return shader=instancedSource,shader}function modifyShaderForQuantizedAttributes(shader,programName,model){let primitive,primitives=model._programPrimitives[programName];if(!Cesium.defined(primitives))return shader;let primitiveId;for(primitiveId in primitives)if(primitives.hasOwnProperty(primitiveId)&&(primitive=primitives[primitiveId],getProgramForPrimitive(model,primitive)===programName))break;model._programPrimitives[programName]=void 0;let result;if(model.extensionsUsed.WEB3D_quantized_attributes)result=ModelUtility_default.modifyShaderForQuantizedAttributes(model.gltf,primitive,shader),model._quantizedUniforms[programName]=result.uniforms;else{let decodedData=model._decodedData[primitiveId];if(Cesium.defined(decodedData))result=ModelUtility_default.modifyShaderForDracoQuantizedAttributes(model.gltf,primitive,shader,decodedData.attributes);else return shader}return result.shader}var scratchRoller=new Cesium.Cartesian4(0,0,1,1);function recreateProgram(programToCreate,model,context,gltfInstance){let programId=programToCreate.programId,techniqueId=programToCreate.techniqueId;gltfInstance._model=model;let program=model._sourcePrograms[programId],shaders=model._rendererResources.sourceShaders,quantizedVertexShaders=model._quantizedVertexShaders,clippingPlaneCollection=model.clippingPlanes,addClippingPlaneCode=isClippingEnabled(model),vs=shaders[program.vertexShader],fs=shaders[program.fragmentShader];if(fs+="uniform vec4 u_rollerRegion;",(model.extensionsUsed.WEB3D_quantized_attributes||model._dequantizeInShader)&&(vs=quantizedVertexShaders[programId]),(model.extensionsUsed.WEB3D_quantized_attributes||model._dequantizeInShader)&&model._toClipCoordinatesGLSL[programId].indexOf("czm_instanced_modelView ")===-1){let tempShader=`
czm_instanced_modelView `;vs.indexOf("gltf_a_dec_position")!==-1&&(tempShader=`${tempShader}
gltf_a_dec_position `),model._toClipCoordinatesGLSL[programId]=ModelUtility_default.toClipCoordinatesGLSL(model.gltf,tempShader)}let toClipCoordinatesGLSL=model._toClipCoordinatesGLSL[programId],finalFS=fs;isColorShadingEnabled(model)&&(finalFS=modifyShaderForColor(finalFS)),addClippingPlaneCode&&(finalFS=modifyShaderForClippingPlanes(finalFS,clippingPlaneCollection,context,model));let drawVS=modifyVertexShader(vs,programId,techniqueId,gltfInstance),drawFS=modifyFragmentShader(finalFS,programId,gltfInstance);if(model._tilesetFlat&&(drawVS=model._tilesetFlat._updateVertexShader(drawVS)),Cesium.FeatureDetection.isInternetExplorer()||(drawVS=ModelUtility_default.modifyVertexShaderForLogDepth(drawVS,toClipCoordinatesGLSL),model.rollerRegion.equals(scratchRoller)?drawFS=ModelUtility_default.modifyFragmentShaderForLogDepth(drawFS):drawFS=ModelUtility_default.modifyFragmentShaderForLogDepthAddRoller(drawFS)),Cesium.defined(model._uniformMapLoaded)||(drawFS=`uniform vec4 czm_pickColor;
${drawFS}`),Cesium.defined(model._scene)&&Cesium.defined(model._scene.ev_Fog)&&model._scene.ev_Fog.enabled){if(drawVS.indexOf("u_modelViewMatrix")>-1){drawVS=`
 varying vec4 v_viewPosition; 
`+drawVS;var vsCalculateWorldPos=`v_viewPosition = u_modelViewMatrix * vec4(a_position.xyz, 1.0); 
`;drawVS.indexOf("gltf_a_dec_position")!=-1&&(vsCalculateWorldPos=`v_viewPosition = u_modelViewMatrix * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var index=drawVS.lastIndexOf("}");index&&(drawVS=drawVS.slice(0,index)+vsCalculateWorldPos+drawVS.slice(index)),drawFS=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+drawFS,model._scene.fog.enabled&&(drawFS=`#define FOG 

`+drawFS)}else if(drawVS.indexOf("u_modelViewProj")>-1&&drawVS.indexOf("u_projectionMatrix")>-1){drawVS=`
 varying vec4 v_viewPosition; 
`+drawVS;var vsCalculateWorldPos=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(a_position.xyz, 1.0); 
`;drawVS.indexOf("gltf_a_dec_position")!=-1&&(vsCalculateWorldPos=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var index=drawVS.lastIndexOf("}");index&&(drawVS=drawVS.slice(0,index)+vsCalculateWorldPos+drawVS.slice(index)),drawFS=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+drawFS,model._scene.fog.enabled&&(drawFS=`#define FOG 

`+drawFS)}}let useIBL=model._imageBasedLightingFactor.x>0||model._imageBasedLightingFactor.y>0;if(useIBL&&(drawFS=`#define USE_IBL_LIGHTING 

${drawFS}`),Cesium.defined(model._lightColor)&&(drawFS=`#define USE_CUSTOM_LIGHT_COLOR 

${drawFS}`),(model._sourceVersion!=="2.0"||model._sourceKHRTechniquesWebGL)&&(drawFS=Cesium.ShaderSource.replaceMain(drawFS,"non_gamma_corrected_main"),drawFS=`${drawFS}
void main() { 
    non_gamma_corrected_main(); 
    gl_FragColor = czm_gammaCorrect(gl_FragColor); 
} 
`),Cesium.defined(model._scene)&&Cesium.defined(model._scene.ev_Fog)&&model._scene.ev_Fog.enabled){let fogCalculateFS=`
#if defined(FOG)
  vec4 finalColor =  gl_FragColor; 
  float vDistance =  length(v_viewPosition.xyz); 
  vec4 worldPosition = czm_inverseView3D * v_viewPosition;  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(worldPosition.x, worldPosition.y, worldPosition.z), false, vec3(0.0));
  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);
 #ifndef HDR
  const float fExposure = 4.0;
  fogColor = vec3(1.0) - exp(-fExposure * fogColor);
 #endif
 #ifdef FOG
   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)
      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);
      fogColor *= darken;
   #endif
   #ifdef HDR
       const float modifier = 0.15;
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);
    #else
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);
    #endif
 #endif
 gl_FragColor = finalColor;
#endif
`,indexFS=drawFS.lastIndexOf("}");indexFS&&(drawFS=drawFS.slice(0,indexFS)+fogCalculateFS+drawFS.slice(indexFS))}if(Cesium.OctahedralProjectedCubeMap.isSupported(context)){let usesSH=Cesium.defined(model._sphericalHarmonicCoefficients)||model._useDefaultSphericalHarmonics,usesSM=Cesium.defined(model._specularEnvironmentMapAtlas)&&model._specularEnvironmentMapAtlas.ready||model._useDefaultSpecularMaps;!addClippingPlaneCode&&(usesSH||usesSM||useIBL)&&(drawFS=`uniform mat4 gltf_clippingPlanesMatrix; 
${drawFS}`),Cesium.defined(model._sphericalHarmonicCoefficients)?drawFS=`#define DIFFUSE_IBL 
#define CUSTOM_SPHERICAL_HARMONICS 
uniform vec3 gltf_sphericalHarmonicCoefficients[9]; 
${drawFS}`:model._useDefaultSphericalHarmonics&&(drawFS=`#define DIFFUSE_IBL 
${drawFS}`),Cesium.defined(model._specularEnvironmentMapAtlas)&&model._specularEnvironmentMapAtlas.ready?drawFS=`#define SPECULAR_IBL 
#define CUSTOM_SPECULAR_IBL 
uniform sampler2D gltf_specularMap; 
uniform vec2 gltf_specularMapSize; 
uniform float gltf_maxSpecularLOD; 
${drawFS}`:model._useDefaultSpecularMaps&&(drawFS=`#define SPECULAR_IBL 
${drawFS}`)}Cesium.defined(model._luminanceAtZenith)&&(drawFS=`#define USE_SUN_LUMINANCE 
uniform float gltf_luminanceAtZenith;
${drawFS}`),createAttributesAndProgram(programId,techniqueId,drawFS,drawVS,model,context,gltfInstance)}function createProgram(programToCreate,collection,model,context,gltfInstance){let programId=programToCreate.programId,techniqueId=programToCreate.techniqueId,program=model._sourcePrograms[programId],shaders=model._rendererResources.sourceShaders;if(gltfInstance._model=model,Cesium.defined(program.name)&&Cesium.defined(model.instancedPrograms[program.name])){if(model.instancedPrograms[program.name].attributeLocations===model._rendererResources.programs[programId]._attributeLocations)return;let programCache=model.instancedPrograms[program.name];model._rendererResources.programs[programId]=Cesium.ShaderProgram.fromCache({context,vertexShaderSource:programCache.vertexShaderSource,fragmentShaderSource:programCache.fragmentShaderSource,attributeLocations:programCache.attributeLocations});return}let vs=shaders[program.vertexShader],fs=shaders[program.fragmentShader];fs+="uniform vec4 u_rollerRegion;";let quantizedVertexShaders=model._quantizedVertexShaders,toClipCoordinatesGLSL=model._toClipCoordinatesGLSL[programId];if(model.extensionsUsed.WEB3D_quantized_attributes||model._dequantizeInShader){let quantizedVS=quantizedVertexShaders[programId];Cesium.defined(quantizedVS)||(quantizedVS=modifyShaderForQuantizedAttributes(vs,programId,model),quantizedVertexShaders[programId]=quantizedVS),vs=quantizedVS}let drawVS=modifyVertexShader(vs,programId,techniqueId,gltfInstance),drawFS=modifyFragmentShader(fs,programId,gltfInstance);if(model._tilesetFlat&&(drawVS=model._tilesetFlat._updateVertexShader(drawVS)),Cesium.FeatureDetection.isInternetExplorer()||(drawVS=ModelUtility_default.modifyVertexShaderForLogDepth(drawVS,toClipCoordinatesGLSL),model.rollerRegion.equals(scratchRoller)?drawFS=ModelUtility_default.modifyFragmentShaderForLogDepth(drawFS):drawFS=ModelUtility_default.modifyFragmentShaderForLogDepthAddRoller(drawFS)),Cesium.defined(model._uniformMapLoaded)||(drawFS=`uniform vec4 czm_pickColor;
${drawFS}`),Cesium.defined(model._scene)&&Cesium.defined(model._scene.ev_Fog)&&model._scene.ev_Fog.enabled){if(drawVS.indexOf("u_modelViewMatrix")>-1){drawVS=`
 varying vec4 v_viewPosition; 
`+drawVS;var vsCalculateWorldPos=`v_viewPosition = u_modelViewMatrix * vec4(a_position.xyz, 1.0); 
`;drawVS.indexOf("gltf_a_dec_position")!=-1&&(vsCalculateWorldPos=`v_viewPosition = u_modelViewMatrix * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var index=drawVS.lastIndexOf("}");index&&(drawVS=drawVS.slice(0,index)+vsCalculateWorldPos+drawVS.slice(index)),drawFS=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+drawFS,model._scene.fog.enabled&&(drawFS=`#define FOG 

`+drawFS)}else if(drawVS.indexOf("u_modelViewProj")>-1&&drawVS.indexOf("u_projectionMatrix")>-1){drawVS=`
 varying vec4 v_viewPosition; 
`+drawVS;var vsCalculateWorldPos=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(a_position.xyz, 1.0); 
`;drawVS.indexOf("gltf_a_dec_position")!=-1&&(vsCalculateWorldPos=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var index=drawVS.lastIndexOf("}");index&&(drawVS=drawVS.slice(0,index)+vsCalculateWorldPos+drawVS.slice(index)),drawFS=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+drawFS,model._scene.fog.enabled&&(drawFS=`#define FOG 

`+drawFS)}}let useIBL=model._imageBasedLightingFactor.x>0||model._imageBasedLightingFactor.y>0;if(useIBL&&(drawFS=`#define USE_IBL_LIGHTING 

${drawFS}`),Cesium.defined(model._lightColor)&&(drawFS=`#define USE_CUSTOM_LIGHT_COLOR 

${drawFS}`),(model._sourceVersion!=="2.0"||model._sourceKHRTechniquesWebGL)&&(drawFS=Cesium.ShaderSource.replaceMain(drawFS,"non_gamma_corrected_main"),drawFS=`${drawFS}
void main() { 
    non_gamma_corrected_main(); 
    gl_FragColor = czm_gammaCorrect(gl_FragColor); 
} 
`),Cesium.defined(model._scene)&&Cesium.defined(model._scene.ev_Fog)&&model._scene.ev_Fog.enabled){let fogCalculateFS=`
#if defined(FOG)
  vec4 finalColor =  gl_FragColor; 
  float vDistance =  length(v_viewPosition.xyz); 
  vec4 worldPosition = czm_inverseView3D * v_viewPosition;  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(worldPosition.x, worldPosition.y, worldPosition.z), false, vec3(0.0));
  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);
 #ifndef HDR
  const float fExposure = 4.0;
  fogColor = vec3(1.0) - exp(-fExposure * fogColor);
 #endif
 #ifdef FOG
   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)
      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);
      fogColor *= darken;
   #endif
   #ifdef HDR
       const float modifier = 0.15;
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);
    #else
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);
    #endif
 #endif
 gl_FragColor = finalColor;
#endif
`,indexFS=drawFS.lastIndexOf("}");indexFS&&(drawFS=drawFS.slice(0,indexFS)+fogCalculateFS+drawFS.slice(indexFS))}if(Cesium.OctahedralProjectedCubeMap.isSupported(context)){let usesSH=Cesium.defined(model._sphericalHarmonicCoefficients)||model._useDefaultSphericalHarmonics,usesSM=Cesium.defined(model._specularEnvironmentMapAtlas)&&model._specularEnvironmentMapAtlas.ready||model._useDefaultSpecularMaps;(usesSH||usesSM||useIBL)&&(drawFS=`uniform mat4 gltf_clippingPlanesMatrix; 
${drawFS}`),Cesium.defined(model._sphericalHarmonicCoefficients)?drawFS=`#define DIFFUSE_IBL 
#define CUSTOM_SPHERICAL_HARMONICS 
uniform vec3 gltf_sphericalHarmonicCoefficients[9]; 
${drawFS}`:model._useDefaultSphericalHarmonics&&(drawFS=`#define DIFFUSE_IBL 
${drawFS}`),Cesium.defined(model._specularEnvironmentMapAtlas)&&model._specularEnvironmentMapAtlas.ready?drawFS=`#define SPECULAR_IBL 
#define CUSTOM_SPECULAR_IBL 
uniform sampler2D gltf_specularMap; 
uniform vec2 gltf_specularMapSize; 
uniform float gltf_maxSpecularLOD; 
${drawFS}`:model._useDefaultSpecularMaps&&(drawFS=`#define SPECULAR_IBL 
${drawFS}`)}Cesium.defined(model._luminanceAtZenith)&&(drawFS=`#define USE_SUN_LUMINANCE 
uniform float gltf_luminanceAtZenith;
${drawFS}`),createAttributesAndProgram(programId,techniqueId,drawFS,drawVS,model,context,gltfInstance,collection)}function createAttributesAndProgram(programId,techniqueId,drawFS,drawVS,model,context,gltfInstance){let technique=model._sourceTechniques[techniqueId],program=model._sourcePrograms[programId],attributeLocations=ModelUtility_default.createAttributeLocations(technique,gltfInstance._precreatedAttributes);model._rendererResources.programs[programId]=Cesium.ShaderProgram.fromCache({context,vertexShaderSource:drawVS,fragmentShaderSource:drawFS,attributeLocations}),model.instancedPrograms[program.name]={vertexShaderSource:drawVS,fragmentShaderSource:drawFS,attributeLocations}}function createVertexArrays(model,meshId,context,gltfInstance){let rendererBuffers=model._rendererResources.buffers,rendererVertexArrays=model._rendererResources.vertexArrays,gltf=model.gltf,accessors=gltf.accessors,mesh=gltf.meshes[meshId];Cesium.ForEach.meshPrimitive(mesh,function(primitive,primitiveId){let attributes=[],attributeLocation,attributeLocations=getAttributeLocations(model,primitive,gltfInstance),decodedData=model._decodedData[`${meshId}.primitive.${primitiveId}`];Cesium.ForEach.meshPrimitiveAttribute(primitive,function(accessorId,attributeName2){if(attributeLocation=attributeLocations[attributeName2],Cesium.defined(attributeLocation)){if(Cesium.defined(decodedData)){let decodedAttributes=decodedData.attributes;if(decodedAttributes.hasOwnProperty(attributeName2)){let decodedAttribute=decodedAttributes[attributeName2];attributes.push({index:attributeLocation,vertexBuffer:rendererBuffers[decodedAttribute.bufferView],componentsPerAttribute:decodedAttribute.componentsPerAttribute,componentDatatype:decodedAttribute.componentDatatype,normalize:decodedAttribute.normalized,offsetInBytes:decodedAttribute.byteOffset,strideInBytes:decodedAttribute.byteStride});return}}let a=accessors[accessorId],normalize6=Cesium.defined(a.normalized)&&a.normalized;attributes.push({index:attributeLocation,vertexBuffer:rendererBuffers[a.bufferView],componentsPerAttribute:Cesium.numberOfComponentsForType(a.type),componentDatatype:a.componentType,normalize:normalize6,offsetInBytes:a.byteOffset,strideInBytes:Cesium.getAccessorByteStride(gltf,a)})}});let attribute,attributeName,precreatedAttributes=gltfInstance._precreatedAttributes;if(Cesium.defined(precreatedAttributes))for(attributeName in precreatedAttributes)precreatedAttributes.hasOwnProperty(attributeName)&&(attributeLocation=attributeLocations[attributeName],Cesium.defined(attributeLocation)&&(attribute=precreatedAttributes[attributeName],attribute.index=attributeLocation,attributes.push(attribute)));let indexBuffer;if(Cesium.defined(primitive.indices)){let bufferView=accessors[primitive.indices].bufferView;Cesium.defined(decodedData)&&(bufferView=decodedData.bufferView),indexBuffer=rendererBuffers[bufferView]}rendererVertexArrays[`${meshId}.primitive.${primitiveId}`]=new Cesium.VertexArray({context,attributes,indexBuffer})})}function getAttributeLocations(model,primitive,gltfInstance){let techniques=model._sourceTechniques,attributeLocations={},location2,index,material=model._runtime.materialsById[primitive.material];if(!Cesium.defined(material))return attributeLocations;let technique=techniques[material._technique];if(!Cesium.defined(technique))return attributeLocations;let attributes=technique.attributes,program=model._rendererResources.programs[technique.program],programVertexAttributes=program.vertexAttributes,programAttributeLocations=program._attributeLocations;for(location2 in programVertexAttributes)if(programVertexAttributes.hasOwnProperty(location2)){let attribute=attributes[location2];Cesium.defined(attribute)&&(index=programAttributeLocations[location2],attributeLocations[attribute.semantic]=index)}let precreatedAttributes=gltfInstance._precreatedAttributes;if(Cesium.defined(precreatedAttributes))for(location2 in precreatedAttributes)precreatedAttributes.hasOwnProperty(location2)&&(index=programAttributeLocations[location2],attributeLocations[location2]=index);return attributeLocations}function modifyShaderForClippingPlanes(shader,clippingPlaneCollection,context,model){return shader=Cesium.ShaderSource.replaceMain(shader,"gltf_clip_main"),shader+=`${Cesium.getClippingFunction(clippingPlaneCollection,context)}
`,shader+=`uniform sampler2D gltf_clippingPlanes; 
uniform mat4 gltf_clippingPlanesMatrix; 
uniform vec4 gltf_clippingPlanesEdgeStyle; 
void main() 
{ 
    gltf_clip_main(); 
${Cesium.getClipAndStyleCode("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")}} 
`,shader}function isColorShadingEnabled(model){return!Cesium.Color.equals(model.color,Cesium.Color.WHITE)||model.colorBlendMode!==Cesium.ColorBlendMode.HIGHLIGHT}function isClippingEnabled(model){let clippingPlanes=model._clippingPlanes;return Cesium.defined(clippingPlanes)&&clippingPlanes.enabled&&clippingPlanes.length!==0}function createJointMatricesFunction(runtimeNode){return function(){return runtimeNode.computedJointMatrices}}function createMorphWeightsFunction(runtimeNode){return function(){return runtimeNode.weights}}function createColorFunction(model){return function(){return model.color}}function createColorBlendFunction(model){return function(){return Cesium.ColorBlendMode.getColorBlend(model.colorBlendMode,model.colorBlendAmount)}}function createClippingPlanesFunction(model){return function(){let clippingPlanes=model.clippingPlanes;return!Cesium.defined(clippingPlanes)||!clippingPlanes.enabled?model._defaultTexture:clippingPlanes.texture}}function createClippingPlanesEdgeStyleFunction(model){return function(){let clippingPlanes=model.clippingPlanes;if(!Cesium.defined(clippingPlanes))return Cesium.Color.WHITE.withAlpha(0);let style=Cesium.Color.clone(clippingPlanes.edgeColor);return style.alpha=clippingPlanes.edgeWidth,style}}var scratchClippingPlaneMatrix=new Cesium.Matrix4;function createClippingPlanesMatrixFunction(model){return function(){let clippingPlanes=model.clippingPlanes;if(!Cesium.defined(clippingPlanes)&&!Cesium.defined(model._sphericalHarmonicCoefficients)&&!Cesium.defined(model._specularEnvironmentMaps))return Cesium.Matrix4.IDENTITY;let modelMatrix=Cesium.defined(clippingPlanes)?clippingPlanes.modelMatrix:Cesium.Matrix4.IDENTITY;return Cesium.Matrix4.multiply(model._clippingPlaneModelViewMatrix,modelMatrix,scratchClippingPlaneMatrix)}}function modifyShaderForColor(shader){return shader=Cesium.ShaderSource.replaceMain(shader,"gltf_blend_main"),shader+=`uniform vec4 gltf_color; 
uniform float gltf_colorBlend; 
void main() 
{ 
    gltf_blend_main(); 
    gl_FragColor.rgb = mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); 
    float highlight = ceil(gltf_colorBlend); 
    gl_FragColor.rgb *= mix(gltf_color.rgb, vec3(1.0), highlight); 
    gl_FragColor.a *= gltf_color.a; 
} 
`,shader}function createIBLFactorFunction(model){return function(){return model._imageBasedLightingFactor}}function createLightColorFunction(model){return function(){return model._lightColor}}function createLuminanceAtZenithFunction(model){return function(){return model.luminanceAtZenith}}function createSphericalHarmonicCoefficientsFunction(model){return function(){return model._sphericalHarmonicCoefficients}}function createSpecularEnvironmentMapFunction(model){return function(){return model._specularEnvironmentMapAtlas.texture}}function createSpecularEnvironmentMapSizeFunction(model){return function(){return model._specularEnvironmentMapAtlas.texture.dimensions}}function createSpecularEnvironmentMapLOD(model){return function(){return model._specularEnvironmentMapAtlas.maximumMipmapLevel}}function createUniformsForQuantizedAttributes(model,primitive){let programId=getProgramForPrimitive(model,primitive),quantizedUniforms=model._quantizedUniforms[programId];return ModelUtility_default.createUniformsForQuantizedAttributes(model.gltf,primitive,quantizedUniforms)}function getProgramForPrimitive(model,primitive){let material=model._runtime.materialsById[primitive.material];if(!!Cesium.defined(material))return material._program}function createUniformsForDracoQuantizedAttributes(decodedData){return ModelUtility_default.createUniformsForDracoQuantizedAttributes(decodedData.attributes)}function createPickColorFunction(color){return function(){return color}}var EV_E3MInternalInstance_default=EV_E3MInternalInstance;function ModelLoadResources(){this.initialized=!1,this.resourcesParsed=!1,this.vertexBuffersToCreate=new Cesium.Queue,this.indexBuffersToCreate=new Cesium.Queue,this.buffers={},this.pendingBufferLoads=0,this.programsToCreate=new Cesium.Queue,this.shaders={},this.pendingShaderLoads=0,this.texturesToCreate=new Cesium.Queue,this.pendingTextureLoads=0,this.texturesToCreateFromBufferView=new Cesium.Queue,this.pendingBufferViewToImage=0,this.createSamplers=!0,this.createSkins=!0,this.createRuntimeAnimations=!0,this.createVertexArrays=!0,this.createRenderStates=!0,this.createUniformMaps=!0,this.createRuntimeNodes=!0,this.createdBufferViews={},this.primitivesToDecode=new Cesium.Queue,this.activeDecodingTasks=0,this.pendingDecodingCache=!1,this.skinnedNodesIds=[]}function getSubarray(array,offset,length3){return array.subarray(offset,offset+length3)}ModelLoadResources.prototype.getBuffer=function(bufferView){return getSubarray(this.buffers[bufferView.buffer],bufferView.byteOffset,bufferView.byteLength)};ModelLoadResources.prototype.finishedPendingBufferLoads=function(){return this.pendingBufferLoads===0};ModelLoadResources.prototype.finishedBuffersCreation=function(){return this.pendingBufferLoads===0&&this.vertexBuffersToCreate.length===0&&this.indexBuffersToCreate.length===0};ModelLoadResources.prototype.finishedProgramCreation=function(){return this.pendingShaderLoads===0&&this.programsToCreate.length===0};ModelLoadResources.prototype.finishedTextureCreation=function(){let finishedPendingLoads=this.pendingTextureLoads===0,finishedResourceCreation=this.texturesToCreate.length===0&&this.texturesToCreateFromBufferView.length===0;return finishedPendingLoads&&finishedResourceCreation};ModelLoadResources.prototype.finishedEverythingButTextureCreation=function(){let finishedPendingLoads=this.pendingBufferLoads===0&&this.pendingShaderLoads===0,finishedResourceCreation=this.vertexBuffersToCreate.length===0&&this.indexBuffersToCreate.length===0&&this.programsToCreate.length===0&&this.pendingBufferViewToImage===0;return this.finishedDecoding()&&finishedPendingLoads&&finishedResourceCreation};ModelLoadResources.prototype.finishedDecoding=function(){return this.primitivesToDecode.length===0&&this.activeDecodingTasks===0&&!this.pendingDecodingCache};ModelLoadResources.prototype.finished=function(){return this.finishedDecoding()&&this.finishedTextureCreation()&&this.finishedEverythingButTextureCreation()};var ModelLoadResources_default=ModelLoadResources;function processModelMaterialsCommon(gltf,options){if(options=Cesium.defaultValue(options,Cesium.defaultValue.EMPTY_OBJECT),!Cesium.defined(gltf)||!Cesium.usesExtension(gltf,"KHR_materials_common"))return;Cesium.usesExtension(gltf,"KHR_techniques_webgl")||(Cesium.defined(gltf.extensions)||(gltf.extensions={}),gltf.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},gltf.extensionsUsed.push("KHR_techniques_webgl"),gltf.extensionsRequired.push("KHR_techniques_webgl"));let techniquesWebgl=gltf.extensions.KHR_techniques_webgl;lightDefaults(gltf);let lightParameters=generateLightParameters(gltf),primitiveByMaterial=ModelUtility_default.splitIncompatibleMaterials(gltf),techniques={},generatedTechniques=!1;return Cesium.ForEach.material(gltf,function(material,materialIndex){if(Cesium.defined(material.extensions)&&Cesium.defined(material.extensions.KHR_materials_common)){let khrMaterialsCommon=material.extensions.KHR_materials_common,primitiveInfo=primitiveByMaterial[materialIndex],techniqueKey=getTechniqueKey(khrMaterialsCommon,primitiveInfo),technique=techniques[techniqueKey];Cesium.defined(technique)||(technique=generateTechnique(gltf,techniquesWebgl,primitiveInfo,khrMaterialsCommon,lightParameters,options.addBatchIdToGeneratedShaders),techniques[techniqueKey]=technique,generatedTechniques=!0);let materialValues={},values3=khrMaterialsCommon.values,uniformName;for(let valueName in values3)values3.hasOwnProperty(valueName)&&valueName!=="transparent"&&valueName!=="doubleSided"&&(uniformName=`u_${valueName.toLowerCase()}`,materialValues[uniformName]=values3[valueName]);material.extensions.KHR_techniques_webgl={technique,values:materialValues},material.alphaMode="OPAQUE",khrMaterialsCommon.transparent&&(material.alphaMode="BLEND"),khrMaterialsCommon.doubleSided&&(material.doubleSided=!0)}}),generatedTechniques&&ModelUtility_default.ensureSemanticExistence(gltf),gltf}function generateLightParameters(gltf){let result={},lights;if(Cesium.defined(gltf.extensions)&&Cesium.defined(gltf.extensions.KHR_materials_common)&&(lights=gltf.extensions.KHR_materials_common.lights),Cesium.defined(lights)){let nodes=gltf.nodes;for(let nodeName in nodes)if(nodes.hasOwnProperty(nodeName)){let node=nodes[nodeName];if(Cesium.defined(node.extensions)&&Cesium.defined(node.extensions.KHR_materials_common)){let nodeLightId=node.extensions.KHR_materials_common.light;Cesium.defined(nodeLightId)&&Cesium.defined(lights[nodeLightId])&&(lights[nodeLightId].node=nodeName),delete node.extensions.KHR_materials_common}}let lightCount=0;for(let lightName in lights)if(lights.hasOwnProperty(lightName)){let light=lights[lightName],lightType=light.type;if(lightType!=="ambient"&&!Cesium.defined(light.node)){delete lights[lightName];continue}let lightBaseName=`light${lightCount.toString()}`;light.baseName=lightBaseName;let ambient,directional,point4,spot;switch(lightType){case"ambient":ambient=light.ambient,result[`${lightBaseName}Color`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:ambient.color};break;case"directional":directional=light.directional,result[`${lightBaseName}Color`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:directional.color},Cesium.defined(light.node)&&(result[`${lightBaseName}Transform`]={node:light.node,semantic:"MODELVIEW",type:Cesium.WebGLConstants.FLOAT_MAT4});break;case"point":point4=light.point,result[`${lightBaseName}Color`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:point4.color},Cesium.defined(light.node)&&(result[`${lightBaseName}Transform`]={node:light.node,semantic:"MODELVIEW",type:Cesium.WebGLConstants.FLOAT_MAT4}),result[`${lightBaseName}Attenuation`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:[point4.constantAttenuation,point4.linearAttenuation,point4.quadraticAttenuation]};break;case"spot":spot=light.spot,result[`${lightBaseName}Color`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:spot.color},Cesium.defined(light.node)&&(result[`${lightBaseName}Transform`]={node:light.node,semantic:"MODELVIEW",type:Cesium.WebGLConstants.FLOAT_MAT4},result[`${lightBaseName}InverseTransform`]={node:light.node,semantic:"MODELVIEWINVERSE",type:Cesium.WebGLConstants.FLOAT_MAT4,useInFragment:!0}),result[`${lightBaseName}Attenuation`]={type:Cesium.WebGLConstants.FLOAT_VEC3,value:[spot.constantAttenuation,spot.linearAttenuation,spot.quadraticAttenuation]},result[`${lightBaseName}FallOff`]={type:Cesium.WebGLConstants.FLOAT_VEC2,value:[spot.fallOffAngle,spot.fallOffExponent]};break}++lightCount}}return result}function generateTechnique(gltf,techniquesWebgl,primitiveInfo,khrMaterialsCommon,lightParameters,addBatchIdToGeneratedShaders){Cesium.defined(khrMaterialsCommon)||(khrMaterialsCommon={}),addBatchIdToGeneratedShaders=Cesium.defaultValue(addBatchIdToGeneratedShaders,!1);let techniques=techniquesWebgl.techniques,shaders=techniquesWebgl.shaders,programs=techniquesWebgl.programs,lightingModel=khrMaterialsCommon.technique.toUpperCase(),lights;Cesium.defined(gltf.extensions)&&Cesium.defined(gltf.extensions.KHR_materials_common)&&(lights=gltf.extensions.KHR_materials_common.lights);let parameterValues=khrMaterialsCommon.values,jointCount=Cesium.defaultValue(khrMaterialsCommon.jointCount,0),skinningInfo,hasSkinning=!1,hasVertexColors=!1;Cesium.defined(primitiveInfo)&&(skinningInfo=primitiveInfo.skinning,hasSkinning=skinningInfo.skinned,hasVertexColors=primitiveInfo.hasVertexColors);let vertexShader=`precision highp float;
`,fragmentShader=`precision highp float;
`,hasNormals=lightingModel!=="CONSTANT",techniqueUniforms={u_modelViewMatrix:{semantic:Cesium.usesExtension(gltf,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:Cesium.WebGLConstants.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:Cesium.WebGLConstants.FLOAT_MAT4}};hasNormals&&(techniqueUniforms.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:Cesium.WebGLConstants.FLOAT_MAT3}),hasSkinning&&(techniqueUniforms.u_jointMatrix={count:jointCount,semantic:"JOINTMATRIX",type:Cesium.WebGLConstants.FLOAT_MAT4});let uniformName,hasTexCoords=!1;for(let name in parameterValues)if(parameterValues.hasOwnProperty(name)&&name!=="transparent"&&name!=="doubleSided"){let uniformType=getKHRMaterialsCommonValueType(name,parameterValues[name]);uniformName=`u_${name.toLowerCase()}`,!hasTexCoords&&uniformType===Cesium.WebGLConstants.SAMPLER_2D&&(hasTexCoords=!0),techniqueUniforms[uniformName]={type:uniformType}}if(Cesium.defined(techniqueUniforms.u_diffuse)&&(techniqueUniforms.u_diffuse.semantic="_3DTILESDIFFUSE"),Cesium.defined(lightParameters))for(let lightParamName in lightParameters)lightParameters.hasOwnProperty(lightParamName)&&(uniformName=`u_${lightParamName}`,techniqueUniforms[uniformName]=lightParameters[lightParamName]);for(uniformName in techniqueUniforms)if(techniqueUniforms.hasOwnProperty(uniformName)){let uniform=techniqueUniforms[uniformName],arraySize=Cesium.defined(uniform.count)?`[${uniform.count}]`:"";uniform.type!==Cesium.WebGLConstants.FLOAT_MAT3&&uniform.type!==Cesium.WebGLConstants.FLOAT_MAT4||uniform.useInFragment?(fragmentShader+=`uniform ${Cesium.webGLConstantToGlslType(uniform.type)} ${uniformName}${arraySize};
`,delete uniform.useInFragment):vertexShader+=`uniform ${Cesium.webGLConstantToGlslType(uniform.type)} ${uniformName}${arraySize};
`}let vertexShaderMain="";hasSkinning&&(vertexShaderMain+=`    mat4 skinMatrix =
        a_weight.x * u_jointMatrix[int(a_joint.x)] +
        a_weight.y * u_jointMatrix[int(a_joint.y)] +
        a_weight.z * u_jointMatrix[int(a_joint.z)] +
        a_weight.w * u_jointMatrix[int(a_joint.w)];
`);let techniqueAttributes={a_position:{semantic:"POSITION"}};vertexShader+=`attribute vec3 a_position;
`,vertexShader+=`varying vec3 v_positionEC;
`,hasSkinning?vertexShaderMain+=`  vec4 pos = u_modelViewMatrix * skinMatrix * vec4(a_position,1.0);
`:vertexShaderMain+=`  vec4 pos = u_modelViewMatrix * vec4(a_position,1.0);
`,vertexShaderMain+=`  v_positionEC = pos.xyz;
`,vertexShaderMain+=`  gl_Position = u_projectionMatrix * pos;
`,fragmentShader+=`varying vec3 v_positionEC;
`,hasNormals&&(techniqueAttributes.a_normal={semantic:"NORMAL"},vertexShader+=`attribute vec3 a_normal;
`,vertexShader+=`varying vec3 v_normal;
`,hasSkinning?vertexShaderMain+=`  v_normal = u_normalMatrix * mat3(skinMatrix) * a_normal;
`:vertexShaderMain+=`  v_normal = u_normalMatrix * a_normal;
`,fragmentShader+=`varying vec3 v_normal;
`);let v_texcoord;hasTexCoords&&(techniqueAttributes.a_texcoord_0={semantic:"TEXCOORD_0"},v_texcoord="v_texcoord_0",vertexShader+=`attribute vec2 a_texcoord_0;
`,vertexShader+=`varying vec2 ${v_texcoord};
`,vertexShaderMain+=`  ${v_texcoord} = a_texcoord_0;
`,fragmentShader+=`varying vec2 ${v_texcoord};
`),hasSkinning&&(techniqueAttributes.a_joint={semantic:"JOINTS_0"},techniqueAttributes.a_weight={semantic:"WEIGHTS_0"},vertexShader+=`attribute vec4 a_joint;
`,vertexShader+=`attribute vec4 a_weight;
`),hasVertexColors&&(techniqueAttributes.a_vertexColor={semantic:"COLOR_0"},vertexShader+=`attribute vec4 a_vertexColor;
`,vertexShader+=`varying vec4 v_vertexColor;
`,vertexShaderMain+=`  v_vertexColor = a_vertexColor;
`,fragmentShader+=`varying vec4 v_vertexColor;
`),addBatchIdToGeneratedShaders&&(techniqueAttributes.a_batchId={semantic:"_BATCHID"},vertexShader+=`attribute float a_batchId;
`);let hasSpecular=hasNormals&&(lightingModel==="BLINN"||lightingModel==="PHONG")&&Cesium.defined(techniqueUniforms.u_specular)&&Cesium.defined(techniqueUniforms.u_shininess)&&techniqueUniforms.u_shininess>0,hasNonAmbientLights=!1,hasAmbientLights=!1,fragmentLightingBlock="";for(let lightName in lights)if(lights.hasOwnProperty(lightName)){let light=lights[lightName],lightType=light.type.toLowerCase(),lightBaseName=light.baseName;fragmentLightingBlock+=`  {
`;let lightColorName=`u_${lightBaseName}Color`;if(lightType==="ambient")hasAmbientLights=!0,fragmentLightingBlock+=`    ambientLight += ${lightColorName};
`;else if(hasNormals){hasNonAmbientLights=!0;let varyingDirectionName=`v_${lightBaseName}Direction`,varyingPositionName=`v_${lightBaseName}Position`;lightType!=="point"&&(vertexShader+=`varying vec3 ${varyingDirectionName};
`,fragmentShader+=`varying vec3 ${varyingDirectionName};
`,vertexShaderMain+=`  ${varyingDirectionName} = mat3(u_${lightBaseName}Transform) * vec3(0.,0.,1.);
`,lightType==="directional"&&(fragmentLightingBlock+=`    vec3 l = normalize(${varyingDirectionName});
`)),lightType!=="directional"?(vertexShader+=`varying vec3 ${varyingPositionName};
`,fragmentShader+=`varying vec3 ${varyingPositionName};
`,vertexShaderMain+=`  ${varyingPositionName} = u_${lightBaseName}Transform[3].xyz;
`,fragmentLightingBlock+=`    vec3 VP = ${varyingPositionName} - v_positionEC;
`,fragmentLightingBlock+=`    vec3 l = normalize(VP);
`,fragmentLightingBlock+=`    float range = length(VP);
`,fragmentLightingBlock+=`    float attenuation = 1.0 / (u_${lightBaseName}Attenuation.x + `,fragmentLightingBlock+=`(u_${lightBaseName}Attenuation.y * range) + `,fragmentLightingBlock+=`(u_${lightBaseName}Attenuation.z * range * range));
`):fragmentLightingBlock+=`    float attenuation = 1.0;
`,lightType==="spot"&&(fragmentLightingBlock+=`    float spotDot = dot(l, normalize(${varyingDirectionName}));
`,fragmentLightingBlock+=`    if (spotDot < cos(u_${lightBaseName}FallOff.x * 0.5))
`,fragmentLightingBlock+=`    {
`,fragmentLightingBlock+=`      attenuation = 0.0;
`,fragmentLightingBlock+=`    }
`,fragmentLightingBlock+=`    else
`,fragmentLightingBlock+=`    {
`,fragmentLightingBlock+=`        attenuation *= max(0.0, pow(spotDot, u_${lightBaseName}FallOff.y));
`,fragmentLightingBlock+=`    }
`),fragmentLightingBlock+=`    diffuseLight += ${lightColorName}* max(dot(normal,l), 0.) * attenuation;
`,hasSpecular&&(lightingModel==="BLINN"?(fragmentLightingBlock+=`    vec3 h = normalize(l + viewDir);
`,fragmentLightingBlock+=`    float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess)) * attenuation;
`):(fragmentLightingBlock+=`    vec3 reflectDir = reflect(-l, normal);
`,fragmentLightingBlock+=`    float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess)) * attenuation;
`),fragmentLightingBlock+=`    specularLight += ${lightColorName} * specularIntensity;
`)}fragmentLightingBlock+=`  }
`}hasAmbientLights||(fragmentLightingBlock+=`  ambientLight += vec3(0.2, 0.2, 0.2);
`),!hasNonAmbientLights&&lightingModel!=="CONSTANT"&&(fragmentShader+=`#ifdef USE_CUSTOM_LIGHT_COLOR 
`,fragmentShader+=`uniform vec3 gltf_lightColor; 
`,fragmentShader+=`#endif 
`,fragmentLightingBlock+=`#ifndef USE_CUSTOM_LIGHT_COLOR 
`,fragmentLightingBlock+=`    vec3 lightColor = czm_lightColor;
`,fragmentLightingBlock+=`#else 
`,fragmentLightingBlock+=`    vec3 lightColor = gltf_lightColor;
`,fragmentLightingBlock+=`#endif 
`,fragmentLightingBlock+=`  vec3 l = normalize(czm_lightDirectionEC);
`,fragmentLightingBlock+=`  diffuseLight += lightColor * max(dot(normal,l), 0.2);
`,hasSpecular&&(lightingModel==="BLINN"?(fragmentLightingBlock+=`  vec3 h = normalize(l + viewDir);
`,fragmentLightingBlock+=`  float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess));
`):(fragmentLightingBlock+=`  vec3 reflectDir = reflect(-l, normal);
`,fragmentLightingBlock+=`  float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess));
`),fragmentLightingBlock+=`  specularLight += lightColor * specularIntensity;
`)),vertexShader+=`void main(void) {
`,vertexShader+=vertexShaderMain,vertexShader+=`}
`,fragmentShader+=`void main(void) {
`;let colorCreationBlock=`  vec3 color = vec3(0.0, 0.0, 0.0);
`;hasNormals&&(fragmentShader+=`  vec3 normal = normalize(v_normal);
`,khrMaterialsCommon.doubleSided&&(fragmentShader+=`  if (czm_backFacing())
`,fragmentShader+=`  {
`,fragmentShader+=`    normal = -normal;
`,fragmentShader+=`  }
`));let finalColorComputation;lightingModel!=="CONSTANT"?(Cesium.defined(techniqueUniforms.u_diffuse)&&(techniqueUniforms.u_diffuse.type===Cesium.WebGLConstants.SAMPLER_2D?fragmentShader+=`  vec4 diffuse = texture2D(u_diffuse, ${v_texcoord});
`:fragmentShader+=`  vec4 diffuse = u_diffuse;
`,fragmentShader+=`  vec3 diffuseLight = vec3(0.0, 0.0, 0.0);
`,colorCreationBlock+=`  color += diffuse.rgb * diffuseLight;
`),hasSpecular&&(techniqueUniforms.u_specular.type===Cesium.WebGLConstants.SAMPLER_2D?fragmentShader+=`  vec3 specular = texture2D(u_specular, ${v_texcoord}).rgb;
`:fragmentShader+=`  vec3 specular = u_specular.rgb;
`,fragmentShader+=`  vec3 specularLight = vec3(0.0, 0.0, 0.0);
`,colorCreationBlock+=`  color += specular * specularLight;
`),Cesium.defined(techniqueUniforms.u_transparency)?finalColorComputation=`  gl_FragColor = vec4(color * diffuse.a * u_transparency, diffuse.a * u_transparency);
`:finalColorComputation=`  gl_FragColor = vec4(color * diffuse.a, diffuse.a);
`):Cesium.defined(techniqueUniforms.u_transparency)?finalColorComputation=`  gl_FragColor = vec4(color * u_transparency, u_transparency);
`:finalColorComputation=`  gl_FragColor = vec4(color, 1.0);
`,hasVertexColors&&(colorCreationBlock+=`  color *= v_vertexColor.rgb;
`),Cesium.defined(techniqueUniforms.u_emission)&&(techniqueUniforms.u_emission.type===Cesium.WebGLConstants.SAMPLER_2D?fragmentShader+=`  vec3 emission = texture2D(u_emission, ${v_texcoord}).rgb;
`:fragmentShader+=`  vec3 emission = u_emission.rgb;
`,colorCreationBlock+=`  color += emission;
`),(Cesium.defined(techniqueUniforms.u_ambient)||lightingModel!=="CONSTANT")&&(Cesium.defined(techniqueUniforms.u_ambient)?techniqueUniforms.u_ambient.type===Cesium.WebGLConstants.SAMPLER_2D?fragmentShader+=`  vec3 ambient = texture2D(u_ambient, ${v_texcoord}).rgb;
`:fragmentShader+=`  vec3 ambient = u_ambient.rgb;
`:fragmentShader+=`  vec3 ambient = diffuse.rgb;
`,colorCreationBlock+=`  color += ambient * ambientLight;
`),fragmentShader+=`  vec3 viewDir = -normalize(v_positionEC);
`,fragmentShader+=`  vec3 ambientLight = vec3(0.0, 0.0, 0.0);
`,fragmentShader+=fragmentLightingBlock,fragmentShader+=colorCreationBlock,fragmentShader+=finalColorComputation,fragmentShader+=`}
`;let vertexShaderId=Cesium.addToArray(shaders,{type:Cesium.WebGLConstants.VERTEX_SHADER,extras:{_pipeline:{source:vertexShader,extension:".glsl"}}}),fragmentShaderId=Cesium.addToArray(shaders,{type:Cesium.WebGLConstants.FRAGMENT_SHADER,extras:{_pipeline:{source:fragmentShader,extension:".glsl"}}}),programId=Cesium.addToArray(programs,{fragmentShader:fragmentShaderId,vertexShader:vertexShaderId});return Cesium.addToArray(techniques,{attributes:techniqueAttributes,program:programId,uniforms:techniqueUniforms})}function getKHRMaterialsCommonValueType(paramName,paramValue){let value;switch(Cesium.defined(paramValue.value)?value=paramValue.value:Cesium.defined(paramValue.index)?value=[paramValue.index]:value=paramValue,paramName){case"ambient":return value.length===1?Cesium.WebGLConstants.SAMPLER_2D:Cesium.WebGLConstants.FLOAT_VEC4;case"diffuse":return value.length===1?Cesium.WebGLConstants.SAMPLER_2D:Cesium.WebGLConstants.FLOAT_VEC4;case"emission":return value.length===1?Cesium.WebGLConstants.SAMPLER_2D:Cesium.WebGLConstants.FLOAT_VEC4;case"specular":return value.length===1?Cesium.WebGLConstants.SAMPLER_2D:Cesium.WebGLConstants.FLOAT_VEC4;case"shininess":return Cesium.WebGLConstants.FLOAT;case"transparency":return Cesium.WebGLConstants.FLOAT;case"transparent":return Cesium.WebGLConstants.BOOL;case"doubleSided":return Cesium.WebGLConstants.BOOL}}function getTechniqueKey(khrMaterialsCommon,primitiveInfo){let techniqueKey="";techniqueKey+=`technique:${khrMaterialsCommon.technique};`;let values3=khrMaterialsCommon.values,keys2=Object.keys(values3).sort(),keysCount=keys2.length;for(let i=0;i<keysCount;++i){let name=keys2[i];values3.hasOwnProperty(name)&&(techniqueKey+=`${name}:${getKHRMaterialsCommonValueType(name,values3[name])}`,techniqueKey+=";")}let jointCount=Cesium.defaultValue(khrMaterialsCommon.jointCount,0);if(techniqueKey+=`${jointCount.toString()};`,Cesium.defined(primitiveInfo)){let skinningInfo=primitiveInfo.skinning;jointCount>0&&(techniqueKey+=`${skinningInfo.type};`),techniqueKey+=primitiveInfo.hasVertexColors}return techniqueKey}function lightDefaults(gltf){let khrMaterialsCommon=gltf.extensions.KHR_materials_common;if(!Cesium.defined(khrMaterialsCommon)||!Cesium.defined(khrMaterialsCommon.lights))return;let lights=khrMaterialsCommon.lights,lightsLength=lights.length;for(let lightId=0;lightId<lightsLength;lightId++){let light=lights[lightId];if(light.type==="ambient"){Cesium.defined(light.ambient)||(light.ambient={});let ambientLight=light.ambient;Cesium.defined(ambientLight.color)||(ambientLight.color=[1,1,1])}else if(light.type==="directional"){Cesium.defined(light.directional)||(light.directional={});let directionalLight=light.directional;Cesium.defined(directionalLight.color)||(directionalLight.color=[1,1,1])}else if(light.type==="point"){Cesium.defined(light.point)||(light.point={});let pointLight=light.point;Cesium.defined(pointLight.color)||(pointLight.color=[1,1,1]),pointLight.constantAttenuation=Cesium.defaultValue(pointLight.constantAttenuation,1),pointLight.linearAttenuation=Cesium.defaultValue(pointLight.linearAttenuation,0),pointLight.quadraticAttenuation=Cesium.defaultValue(pointLight.quadraticAttenuation,0)}else if(light.type==="spot"){Cesium.defined(light.spot)||(light.spot={});let spotLight=light.spot;Cesium.defined(spotLight.color)||(spotLight.color=[1,1,1]),spotLight.constantAttenuation=Cesium.defaultValue(spotLight.constantAttenuation,1),spotLight.fallOffAngle=Cesium.defaultValue(spotLight.fallOffAngle,3.14159265),spotLight.fallOffExponent=Cesium.defaultValue(spotLight.fallOffExponent,0),spotLight.linearAttenuation=Cesium.defaultValue(spotLight.linearAttenuation,0),spotLight.quadraticAttenuation=Cesium.defaultValue(spotLight.quadraticAttenuation,0)}}}var processModelMaterialsCommon_default=processModelMaterialsCommon;function processPbrMaterials(gltf,options){if(options=Cesium.defaultValue(options,Cesium.defaultValue.EMPTY_OBJECT),Cesium.usesExtension(gltf,"KHR_techniques_webgl")||!Cesium.defined(gltf.materials)||gltf.materials.length===0)return gltf;Cesium.defined(gltf.extensions)||(gltf.extensions={}),Cesium.defined(gltf.extensionsUsed)||(gltf.extensionsUsed=[]),Cesium.defined(gltf.extensionsRequired)||(gltf.extensionsRequired=[]),gltf.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},gltf.extensionsUsed.push("KHR_techniques_webgl"),gltf.extensionsRequired.push("KHR_techniques_webgl");let primitiveByMaterial=ModelUtility_default.splitIncompatibleMaterials(gltf);return Cesium.ForEach.material(gltf,function(material,materialIndex){let generatedMaterialValues={},technique=generateTechnique2(gltf,material,materialIndex,generatedMaterialValues,primitiveByMaterial,options);Cesium.defined(material.extensions)||(material.extensions={}),material.extensions.KHR_techniques_webgl={values:generatedMaterialValues,technique}}),ModelUtility_default.ensureSemanticExistence(gltf),gltf}function isSpecularGlossinessMaterial(material){return Cesium.defined(material.extensions)&&Cesium.defined(material.extensions.KHR_materials_pbrSpecularGlossiness)}function addTextureCoordinates(gltf,textureName,generatedMaterialValues,defaultTexCoord,result){let texCoord,texInfo=generatedMaterialValues[textureName];return Cesium.defined(texInfo)&&Cesium.defined(texInfo.texCoord)&&texInfo.texCoord===1&&(defaultTexCoord=defaultTexCoord.replace("0","1")),Cesium.defined(generatedMaterialValues[`${textureName}Offset`])?(texCoord=`${textureName}Coord`,result.fragmentShaderMain+=`    vec2 ${texCoord} = computeTexCoord(${defaultTexCoord}, ${textureName}Offset, ${textureName}Rotation, ${textureName}Scale);
`):texCoord=defaultTexCoord,texCoord}var DEFAULT_TEXTURE_OFFSET=[0,0],DEFAULT_TEXTURE_ROTATION=[0],DEFAULT_TEXTURE_SCALE=[1,1];function handleKHRTextureTransform(parameterName,value,generatedMaterialValues){if(parameterName.indexOf("Texture")===-1||!Cesium.defined(value.extensions)||!Cesium.defined(value.extensions.KHR_texture_transform))return;let uniformName=`u_${parameterName}`,extension=value.extensions.KHR_texture_transform;generatedMaterialValues[`${uniformName}Offset`]=Cesium.defaultValue(extension.offset,DEFAULT_TEXTURE_OFFSET),generatedMaterialValues[`${uniformName}Rotation`]=Cesium.defaultValue(extension.rotation,DEFAULT_TEXTURE_ROTATION),generatedMaterialValues[`${uniformName}Scale`]=Cesium.defaultValue(extension.scale,DEFAULT_TEXTURE_SCALE),Cesium.defined(value.texCoord)&&Cesium.defined(extension.texCoord)&&(generatedMaterialValues[uniformName].texCoord=extension.texCoord)}function generateTechnique2(gltf,material,materialIndex,generatedMaterialValues,primitiveByMaterial,options){let addBatchIdToGeneratedShaders=Cesium.defaultValue(options.addBatchIdToGeneratedShaders,!1),techniquesWebgl=gltf.extensions.KHR_techniques_webgl,techniques=techniquesWebgl.techniques,shaders=techniquesWebgl.shaders,programs=techniquesWebgl.programs,useSpecGloss=isSpecularGlossinessMaterial(material),uniformName,parameterName,value;if(!useSpecGloss){let pbrMetallicRoughness=material.pbrMetallicRoughness;if(Cesium.defined(pbrMetallicRoughness))for(parameterName in pbrMetallicRoughness)pbrMetallicRoughness.hasOwnProperty(parameterName)&&(value=pbrMetallicRoughness[parameterName],uniformName=`u_${parameterName}`,generatedMaterialValues[uniformName]=value,handleKHRTextureTransform(parameterName,value,generatedMaterialValues));else generatedMaterialValues.u_baseColorFactor=[1,1,1,1]}if(useSpecGloss){let pbrSpecularGlossiness=material.extensions.KHR_materials_pbrSpecularGlossiness;for(parameterName in pbrSpecularGlossiness)pbrSpecularGlossiness.hasOwnProperty(parameterName)&&(value=pbrSpecularGlossiness[parameterName],uniformName=`u_${parameterName}`,generatedMaterialValues[uniformName]=value,handleKHRTextureTransform(parameterName,value,generatedMaterialValues))}for(let additional in material)material.hasOwnProperty(additional)&&(additional.indexOf("Texture")>=0||additional.indexOf("Factor")>=0)&&(value=material[additional],uniformName=`u_${additional}`,generatedMaterialValues[uniformName]=value,handleKHRTextureTransform(additional,value,generatedMaterialValues));let vertexShader=`precision highp float;
`,fragmentShader=`precision highp float;
`,skin;Cesium.defined(gltf.skins)&&(skin=gltf.skins[0]);let joints=Cesium.defined(skin)?skin.joints:[],jointCount=joints.length,primitiveInfo=primitiveByMaterial[materialIndex],skinningInfo,hasSkinning=!1,hasVertexColors=!1,hasMorphTargets=!1,hasNormals=!1,hasTangents=!1,hasTexCoords=!1,hasTexCoord1=!1,hasOutline=!1,isUnlit=!1;Cesium.defined(primitiveInfo)&&(skinningInfo=primitiveInfo.skinning,hasSkinning=skinningInfo.skinned&&joints.length>0,hasVertexColors=primitiveInfo.hasVertexColors,hasMorphTargets=primitiveInfo.hasMorphTargets,hasNormals=primitiveInfo.hasNormals,hasTangents=primitiveInfo.hasTangents,hasTexCoords=primitiveInfo.hasTexCoords,hasTexCoord1=primitiveInfo.hasTexCoord1,hasOutline=primitiveInfo.hasOutline);let morphTargets;hasMorphTargets&&Cesium.ForEach.mesh(gltf,function(mesh){Cesium.ForEach.meshPrimitive(mesh,function(primitive){if(primitive.material===materialIndex){let targets=primitive.targets;Cesium.defined(targets)&&(morphTargets=targets)}})});let techniqueUniforms={u_modelViewMatrix:{semantic:Cesium.usesExtension(gltf,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:Cesium.WebGLConstants.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:Cesium.WebGLConstants.FLOAT_MAT4}};Cesium.defined(material.extensions)&&Cesium.defined(material.extensions.KHR_materials_unlit)&&(isUnlit=!0),hasNormals&&(techniqueUniforms.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:Cesium.WebGLConstants.FLOAT_MAT3}),hasSkinning&&(techniqueUniforms.u_jointMatrix={count:jointCount,semantic:"JOINTMATRIX",type:Cesium.WebGLConstants.FLOAT_MAT4}),hasMorphTargets&&(techniqueUniforms.u_morphWeights={count:morphTargets.length,semantic:"MORPHWEIGHTS",type:Cesium.WebGLConstants.FLOAT});let alphaMode=material.alphaMode;Cesium.defined(alphaMode)&&alphaMode==="MASK"&&(techniqueUniforms.u_alphaCutoff={semantic:"ALPHACUTOFF",type:Cesium.WebGLConstants.FLOAT});for(uniformName in generatedMaterialValues)generatedMaterialValues.hasOwnProperty(uniformName)&&(techniqueUniforms[uniformName]={type:getPBRValueType(uniformName)});let baseColorUniform=Cesium.defaultValue(techniqueUniforms.u_baseColorTexture,techniqueUniforms.u_baseColorFactor);Cesium.defined(baseColorUniform)&&(baseColorUniform.semantic="_3DTILESDIFFUSE");for(uniformName in techniqueUniforms)if(techniqueUniforms.hasOwnProperty(uniformName)){let uniform=techniqueUniforms[uniformName],arraySize=Cesium.defined(uniform.count)?`[${uniform.count}]`:"";uniform.type!==Cesium.WebGLConstants.FLOAT_MAT3&&uniform.type!==Cesium.WebGLConstants.FLOAT_MAT4&&uniformName!=="u_morphWeights"||uniform.useInFragment?(fragmentShader+=`uniform ${Cesium.webGLConstantToGlslType(uniform.type)} ${uniformName}${arraySize};
`,delete uniform.useInFragment):vertexShader+=`uniform ${Cesium.webGLConstantToGlslType(uniform.type)} ${uniformName}${arraySize};
`}hasOutline&&(fragmentShader+=`uniform sampler2D u_outlineTexture;
`);let vertexShaderMain="";hasSkinning&&(vertexShaderMain+=`    mat4 skinMatrix =
        a_weight.x * u_jointMatrix[int(a_joint.x)] +
        a_weight.y * u_jointMatrix[int(a_joint.y)] +
        a_weight.z * u_jointMatrix[int(a_joint.z)] +
        a_weight.w * u_jointMatrix[int(a_joint.w)];
`);let techniqueAttributes={a_position:{semantic:"POSITION"}};if(hasOutline&&(techniqueAttributes.a_outlineCoordinates={semantic:"_OUTLINE_COORDINATES"}),vertexShader+=`attribute vec3 a_position;
`,hasNormals&&(vertexShader+=`varying vec3 v_positionEC;
`),hasOutline&&(vertexShader+=`attribute vec3 a_outlineCoordinates;
`,vertexShader+=`varying vec3 v_outlineCoordinates;
`),vertexShaderMain+=`    vec3 weightedPosition = a_position;
`,hasNormals&&(vertexShaderMain+=`    vec3 weightedNormal = a_normal;
`),hasTangents&&(vertexShaderMain+=`    vec4 weightedTangent = a_tangent;
`),hasMorphTargets)for(let k=0;k<morphTargets.length;k++){let targetAttributes=morphTargets[k];for(let targetAttribute in targetAttributes)if(targetAttributes.hasOwnProperty(targetAttribute)&&targetAttribute!=="extras"){let attributeName=`a_${targetAttribute}_${k}`;techniqueAttributes[attributeName]={semantic:`${targetAttribute}_${k}`},vertexShader+=`attribute vec3 ${attributeName};
`,targetAttribute==="POSITION"?vertexShaderMain+=`    weightedPosition += u_morphWeights[${k}] * ${attributeName};
`:targetAttribute==="NORMAL"?vertexShaderMain+=`    weightedNormal += u_morphWeights[${k}] * ${attributeName};
`:hasTangents&&targetAttribute==="TANGENT"&&(vertexShaderMain+=`    weightedTangent.xyz += u_morphWeights[${k}] * ${attributeName};
`)}}hasSkinning?vertexShaderMain+=`    vec4 position = skinMatrix * vec4(weightedPosition, 1.0);
`:vertexShaderMain+=`    vec4 position = vec4(weightedPosition, 1.0);
`,vertexShaderMain+=`    position = u_modelViewMatrix * position;
`,hasNormals&&(vertexShaderMain+=`    v_positionEC = position.xyz;
`),vertexShaderMain+=`    gl_Position = u_projectionMatrix * position;
`,hasOutline&&(vertexShaderMain+=`    v_outlineCoordinates = a_outlineCoordinates;
`),hasNormals&&(techniqueAttributes.a_normal={semantic:"NORMAL"},vertexShader+=`attribute vec3 a_normal;
`,isUnlit||(vertexShader+=`varying vec3 v_normal;
`,hasSkinning?vertexShaderMain+=`    v_normal = u_normalMatrix * mat3(skinMatrix) * weightedNormal;
`:vertexShaderMain+=`    v_normal = u_normalMatrix * weightedNormal;
`,fragmentShader+=`varying vec3 v_normal;
`),fragmentShader+=`varying vec3 v_positionEC;
`),hasTangents&&(techniqueAttributes.a_tangent={semantic:"TANGENT"},vertexShader+=`attribute vec4 a_tangent;
`,vertexShader+=`varying vec4 v_tangent;
`,vertexShaderMain+=`    v_tangent.xyz = u_normalMatrix * weightedTangent.xyz;
`,vertexShaderMain+=`    v_tangent.w = weightedTangent.w;
`,fragmentShader+=`varying vec4 v_tangent;
`),hasOutline&&(fragmentShader+=`varying vec3 v_outlineCoordinates;
`);let fragmentShaderMain="",v_texCoord,normalTexCoord,baseColorTexCoord,specularGlossinessTexCoord,diffuseTexCoord,metallicRoughnessTexCoord,occlusionTexCoord,emissiveTexCoord;if(hasTexCoords){if(techniqueAttributes.a_texcoord_0={semantic:"TEXCOORD_0"},v_texCoord="v_texcoord_0",vertexShader+=`attribute vec2 a_texcoord_0;
`,vertexShader+=`varying vec2 ${v_texCoord};
`,vertexShaderMain+=`    ${v_texCoord} = a_texcoord_0;
`,fragmentShader+=`varying vec2 ${v_texCoord};
`,hasTexCoord1){techniqueAttributes.a_texcoord_1={semantic:"TEXCOORD_1"};let v_texCoord1=v_texCoord.replace("0","1");vertexShader+=`attribute vec2 a_texcoord_1;
`,vertexShader+=`varying vec2 ${v_texCoord1};
`,vertexShaderMain+=`    ${v_texCoord1} = a_texcoord_1;
`,fragmentShader+=`varying vec2 ${v_texCoord1};
`}let result={fragmentShaderMain};normalTexCoord=addTextureCoordinates(gltf,"u_normalTexture",generatedMaterialValues,v_texCoord,result),baseColorTexCoord=addTextureCoordinates(gltf,"u_baseColorTexture",generatedMaterialValues,v_texCoord,result),specularGlossinessTexCoord=addTextureCoordinates(gltf,"u_specularGlossinessTexture",generatedMaterialValues,v_texCoord,result),diffuseTexCoord=addTextureCoordinates(gltf,"u_diffuseTexture",generatedMaterialValues,v_texCoord,result),metallicRoughnessTexCoord=addTextureCoordinates(gltf,"u_metallicRoughnessTexture",generatedMaterialValues,v_texCoord,result),occlusionTexCoord=addTextureCoordinates(gltf,"u_occlusionTexture",generatedMaterialValues,v_texCoord,result),emissiveTexCoord=addTextureCoordinates(gltf,"u_emissiveTexture",generatedMaterialValues,v_texCoord,result),fragmentShaderMain=result.fragmentShaderMain}hasSkinning&&(techniqueAttributes.a_joint={semantic:"JOINTS_0"},techniqueAttributes.a_weight={semantic:"WEIGHTS_0"},vertexShader+=`attribute vec4 a_joint;
`,vertexShader+=`attribute vec4 a_weight;
`),hasVertexColors&&(techniqueAttributes.a_vertexColor={semantic:"COLOR_0"},vertexShader+=`attribute vec4 a_vertexColor;
`,vertexShader+=`varying vec4 v_vertexColor;
`,vertexShaderMain+=`  v_vertexColor = a_vertexColor;
`,fragmentShader+=`varying vec4 v_vertexColor;
`),addBatchIdToGeneratedShaders&&(techniqueAttributes.a_batchId={semantic:"_BATCHID"},vertexShader+=`attribute float a_batchId;
`),vertexShader+=`void main(void) 
{
`,vertexShader+=vertexShaderMain,vertexShader+=`}
`,hasNormals&&!isUnlit&&(fragmentShader+=`const float M_PI = 3.141592653589793;
`,fragmentShader+=`vec3 lambertianDiffuse(vec3 diffuseColor) 
{
    return diffuseColor / M_PI;
}

`,fragmentShader+=`vec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) 
{
    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);
}

`,fragmentShader+=`vec3 fresnelSchlick(float metalness, float VdotH) 
{
    return metalness + (vec3(1.0) - metalness) * pow(1.0 - VdotH, 5.0);
}

`,fragmentShader+=`float smithVisibilityG1(float NdotV, float roughness) 
{
    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;
    return NdotV / (NdotV * (1.0 - k) + k);
}

`,fragmentShader+=`float smithVisibilityGGX(float roughness, float NdotL, float NdotV) 
{
    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);
}

`,fragmentShader+=`float GGX(float roughness, float NdotH) 
{
    float roughnessSquared = roughness * roughness;
    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;
    return roughnessSquared / (M_PI * f * f);
}

`),fragmentShader+=`vec3 SRGBtoLINEAR3(vec3 srgbIn) 
{
    return pow(srgbIn, vec3(2.2));
}

`,fragmentShader+=`vec4 SRGBtoLINEAR4(vec4 srgbIn) 
{
    vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));
    return vec4(linearOut, srgbIn.a);
}

`,fragmentShader+=`vec3 applyTonemapping(vec3 linearIn) 
{
#ifndef HDR 
    return czm_acesTonemapping(linearIn);
#else 
    return linearIn;
#endif 
}

`,fragmentShader+=`vec3 LINEARtoSRGB(vec3 linearIn) 
{
#ifndef HDR 
    return pow(linearIn, vec3(1.0/2.2));
#else 
    return linearIn;
#endif 
}

`,fragmentShader+=`vec2 computeTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) 
{
    rotation = -rotation; 
    mat3 transform = mat3(
        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, 
       -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, 
        offset.x, offset.y, 1.0); 
    vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy; 
    return transformedTexCoords; 
}

`,fragmentShader+=`#ifdef USE_IBL_LIGHTING 
`,fragmentShader+=`uniform vec2 gltf_iblFactor; 
`,fragmentShader+=`#endif 
`,fragmentShader+=`#ifdef USE_CUSTOM_LIGHT_COLOR 
`,fragmentShader+=`uniform vec3 gltf_lightColor; 
`,fragmentShader+=`#endif 
`,fragmentShader+=`void main(void) 
{
`,fragmentShader+=fragmentShaderMain,hasNormals&&!isUnlit&&(fragmentShader+=`    vec3 ng = normalize(v_normal);
`,fragmentShader+=`    vec3 positionWC = vec3(czm_inverseView * vec4(v_positionEC, 1.0));
`,Cesium.defined(generatedMaterialValues.u_normalTexture)?hasTangents?(fragmentShader+=`    vec3 t = normalize(v_tangent.xyz);
`,fragmentShader+=`    vec3 b = normalize(cross(ng, t) * v_tangent.w);
`,fragmentShader+=`    mat3 tbn = mat3(t, b, ng);
`,fragmentShader+=`    vec3 n = texture2D(u_normalTexture, ${normalTexCoord}).rgb;
`,fragmentShader+=`    n = normalize(tbn * (2.0 * n - 1.0));
`):(fragmentShader=`#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
#endif
${fragmentShader}`,fragmentShader+=`#ifdef GL_OES_standard_derivatives
`,fragmentShader+=`    vec3 pos_dx = dFdx(v_positionEC);
`,fragmentShader+=`    vec3 pos_dy = dFdy(v_positionEC);
`,fragmentShader+=`    vec3 tex_dx = dFdx(vec3(${normalTexCoord},0.0));
`,fragmentShader+=`    vec3 tex_dy = dFdy(vec3(${normalTexCoord},0.0));
`,fragmentShader+=`    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
`,fragmentShader+=`    t = normalize(t - ng * dot(ng, t));
`,fragmentShader+=`    vec3 b = normalize(cross(ng, t));
`,fragmentShader+=`    mat3 tbn = mat3(t, b, ng);
`,fragmentShader+=`    vec3 n = texture2D(u_normalTexture, ${normalTexCoord}).rgb;
`,fragmentShader+=`    n = normalize(tbn * (2.0 * n - 1.0));
`,fragmentShader+=`#else
`,fragmentShader+=`    vec3 n = ng;
`,fragmentShader+=`#endif
`):fragmentShader+=`    vec3 n = ng;
`),Cesium.defined(generatedMaterialValues.u_baseColorTexture)?(fragmentShader+=`    vec4 baseColorWithAlpha = SRGBtoLINEAR4(texture2D(u_baseColorTexture, ${baseColorTexCoord}));
`,Cesium.defined(generatedMaterialValues.u_baseColorFactor)&&(fragmentShader+=`    baseColorWithAlpha *= u_baseColorFactor;
`)):Cesium.defined(generatedMaterialValues.u_baseColorFactor)?fragmentShader+=`    vec4 baseColorWithAlpha = u_baseColorFactor;
`:fragmentShader+=`    vec4 baseColorWithAlpha = vec4(1.0);
`,hasVertexColors&&(fragmentShader+=`    baseColorWithAlpha *= v_vertexColor;
`),fragmentShader+=`    vec3 baseColor = baseColorWithAlpha.rgb;
`,hasNormals&&!isUnlit?(useSpecGloss?(Cesium.defined(generatedMaterialValues.u_specularGlossinessTexture)?(fragmentShader+=`    vec4 specularGlossiness = SRGBtoLINEAR4(texture2D(u_specularGlossinessTexture, ${specularGlossinessTexCoord}));
`,fragmentShader+=`    vec3 specular = specularGlossiness.rgb;
`,fragmentShader+=`    float glossiness = specularGlossiness.a;
`,Cesium.defined(generatedMaterialValues.u_specularFactor)&&(fragmentShader+=`    specular *= u_specularFactor;
`),Cesium.defined(generatedMaterialValues.u_glossinessFactor)&&(fragmentShader+=`    glossiness *= u_glossinessFactor;
`)):(Cesium.defined(generatedMaterialValues.u_specularFactor)?fragmentShader+=`    vec3 specular = clamp(u_specularFactor, vec3(0.0), vec3(1.0));
`:fragmentShader+=`    vec3 specular = vec3(1.0);
`,Cesium.defined(generatedMaterialValues.u_glossinessFactor)?fragmentShader+=`    float glossiness = clamp(u_glossinessFactor, 0.0, 1.0);
`:fragmentShader+=`    float glossiness = 1.0;
`),Cesium.defined(generatedMaterialValues.u_diffuseTexture)?(fragmentShader+=`    vec4 diffuse = SRGBtoLINEAR4(texture2D(u_diffuseTexture, ${diffuseTexCoord}));
`,Cesium.defined(generatedMaterialValues.u_diffuseFactor)&&(fragmentShader+=`    diffuse *= u_diffuseFactor;
`)):Cesium.defined(generatedMaterialValues.u_diffuseFactor)?fragmentShader+=`    vec4 diffuse = clamp(u_diffuseFactor, vec4(0.0), vec4(1.0));
`:fragmentShader+=`    vec4 diffuse = vec4(1.0);
`,fragmentShader+=`    baseColorWithAlpha.a = diffuse.a;
`):Cesium.defined(generatedMaterialValues.u_metallicRoughnessTexture)?(fragmentShader+=`    vec3 metallicRoughness = texture2D(u_metallicRoughnessTexture, ${metallicRoughnessTexCoord}).rgb;
`,fragmentShader+=`    float metalness = clamp(metallicRoughness.b, 0.0, 1.0);
`,fragmentShader+=`    float roughness = clamp(metallicRoughness.g, 0.04, 1.0);
`,Cesium.defined(generatedMaterialValues.u_metallicFactor)&&(fragmentShader+=`    metalness *= u_metallicFactor;
`),Cesium.defined(generatedMaterialValues.u_roughnessFactor)&&(fragmentShader+=`    roughness *= u_roughnessFactor;
`)):(Cesium.defined(generatedMaterialValues.u_metallicFactor)?fragmentShader+=`    float metalness = clamp(u_metallicFactor, 0.0, 1.0);
`:fragmentShader+=`    float metalness = 1.0;
`,Cesium.defined(generatedMaterialValues.u_roughnessFactor)?fragmentShader+=`    float roughness = clamp(u_roughnessFactor, 0.04, 1.0);
`:fragmentShader+=`    float roughness = 1.0;
`),fragmentShader+=`    vec3 v = -normalize(v_positionEC);
`,fragmentShader+=`#ifndef USE_CUSTOM_LIGHT_COLOR 
`,fragmentShader+=`    vec3 lightColorHdr = czm_lightColorHdr;
`,fragmentShader+=`#else 
`,fragmentShader+=`    vec3 lightColorHdr = gltf_lightColor;
`,fragmentShader+=`#endif 
`,fragmentShader+=`    vec3 l = normalize(czm_lightDirectionEC);
`,fragmentShader+=`    vec3 h = normalize(v + l);
`,fragmentShader+=`    float NdotL = clamp(dot(n, l), 0.001, 1.0);
`,fragmentShader+=`    float NdotV = abs(dot(n, v)) + 0.001;
`,fragmentShader+=`    float NdotH = clamp(dot(n, h), 0.0, 1.0);
`,fragmentShader+=`    float LdotH = clamp(dot(l, h), 0.0, 1.0);
`,fragmentShader+=`    float VdotH = clamp(dot(v, h), 0.0, 1.0);
`,fragmentShader+=`    vec3 f0 = vec3(0.04);
`,useSpecGloss?(fragmentShader+=`    float roughness = 1.0 - glossiness;
`,fragmentShader+=`    vec3 diffuseColor = diffuse.rgb * (1.0 - max(max(specular.r, specular.g), specular.b));
`,fragmentShader+=`    vec3 specularColor = specular;
`):(fragmentShader+=`    vec3 diffuseColor = baseColor * (1.0 - metalness) * (1.0 - f0);
`,fragmentShader+=`    vec3 specularColor = mix(f0, baseColor, metalness);
`),fragmentShader+=`    float alpha = roughness * roughness;
`,fragmentShader+=`    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
`,fragmentShader+=`    vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));
`,fragmentShader+=`    vec3 r0 = specularColor.rgb;
`,fragmentShader+=`    vec3 F = fresnelSchlick2(r0, r90, VdotH);
`,fragmentShader+=`    float G = smithVisibilityGGX(alpha, NdotL, NdotV);
`,fragmentShader+=`    float D = GGX(alpha, NdotH);
`,fragmentShader+=`    vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);
`,fragmentShader+=`    vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);
`,fragmentShader+=`    vec3 color = NdotL * lightColorHdr * (diffuseContribution + specularContribution);
`,fragmentShader+=`#if Cesium.defined(USE_IBL_LIGHTING) && !Cesium.defined(DIFFUSE_IBL) && !Cesium.defined(SPECULAR_IBL) 
`,fragmentShader+=`    vec3 r = normalize(czm_inverseViewRotation * normalize(reflect(v, n)));
`,fragmentShader+=`    float vertexRadius = length(positionWC);
`,fragmentShader+=`    float horizonDotNadir = 1.0 - min(1.0, czm_ellipsoidRadii.x / vertexRadius);
`,fragmentShader+=`    float reflectionDotNadir = dot(r, normalize(positionWC));
`,fragmentShader+=`    r.x = -r.x;
`,fragmentShader+=`    r = -normalize(czm_temeToPseudoFixed * r);
`,fragmentShader+=`    r.x = -r.x;
`,fragmentShader+=`    float inverseRoughness = 1.04 - roughness;
`,fragmentShader+=`    inverseRoughness *= inverseRoughness;
`,fragmentShader+=`    vec3 sceneSkyBox = textureCube(czm_environmentMap, r).rgb * inverseRoughness;
`,fragmentShader+=`    float atmosphereHeight = 0.05;
`,fragmentShader+=`    float blendRegionSize = 0.1 * ((1.0 - inverseRoughness) * 8.0 + 1.1 - horizonDotNadir);
`,fragmentShader+=`    float blendRegionOffset = roughness * -1.0;
`,fragmentShader+=`    float farAboveHorizon = clamp(horizonDotNadir - blendRegionSize * 0.5 + blendRegionOffset, 1.0e-10 - blendRegionSize, 0.99999);
`,fragmentShader+=`    float aroundHorizon = clamp(horizonDotNadir + blendRegionSize * 0.5, 1.0e-10 - blendRegionSize, 0.99999);
`,fragmentShader+=`    float farBelowHorizon = clamp(horizonDotNadir + blendRegionSize * 1.5, 1.0e-10 - blendRegionSize, 0.99999);
`,fragmentShader+=`    float smoothstepHeight = smoothstep(0.0, atmosphereHeight, horizonDotNadir);
`,fragmentShader+=`    vec3 belowHorizonColor = mix(vec3(0.1, 0.15, 0.25), vec3(0.4, 0.7, 0.9), smoothstepHeight);
`,fragmentShader+=`    vec3 nadirColor = belowHorizonColor * 0.5;
`,fragmentShader+=`    vec3 aboveHorizonColor = mix(vec3(0.9, 1.0, 1.2), belowHorizonColor, roughness * 0.5);
`,fragmentShader+=`    vec3 blueSkyColor = mix(vec3(0.18, 0.26, 0.48), aboveHorizonColor, reflectionDotNadir * inverseRoughness * 0.5 + 0.75);
`,fragmentShader+=`    vec3 zenithColor = mix(blueSkyColor, sceneSkyBox, smoothstepHeight);
`,fragmentShader+=`    vec3 blueSkyDiffuseColor = vec3(0.7, 0.85, 0.9);
`,fragmentShader+=`    float diffuseIrradianceFromEarth = (1.0 - horizonDotNadir) * (reflectionDotNadir * 0.25 + 0.75) * smoothstepHeight;
`,fragmentShader+=`    float diffuseIrradianceFromSky = (1.0 - smoothstepHeight) * (1.0 - (reflectionDotNadir * 0.25 + 0.25));
`,fragmentShader+=`    vec3 diffuseIrradiance = blueSkyDiffuseColor * clamp(diffuseIrradianceFromEarth + diffuseIrradianceFromSky, 0.0, 1.0);
`,fragmentShader+=`    float notDistantRough = (1.0 - horizonDotNadir * roughness * 0.8);
`,fragmentShader+=`    vec3 specularIrradiance = mix(zenithColor, aboveHorizonColor, smoothstep(farAboveHorizon, aroundHorizon, reflectionDotNadir) * notDistantRough);
`,fragmentShader+=`    specularIrradiance = mix(specularIrradiance, belowHorizonColor, smoothstep(aroundHorizon, farBelowHorizon, reflectionDotNadir) * inverseRoughness);
`,fragmentShader+=`    specularIrradiance = mix(specularIrradiance, nadirColor, smoothstep(farBelowHorizon, 1.0, reflectionDotNadir) * inverseRoughness);
`,fragmentShader+=`#ifdef USE_SUN_LUMINANCE 
`,fragmentShader+=`    float LdotZenith = clamp(dot(normalize(czm_inverseViewRotation * l), normalize(positionWC * -1.0)), 0.001, 1.0);
`,fragmentShader+=`    float S = acos(LdotZenith);
`,fragmentShader+=`    float NdotZenith = clamp(dot(normalize(czm_inverseViewRotation * n), normalize(positionWC * -1.0)), 0.001, 1.0);
`,fragmentShader+=`    float gamma = acos(NdotL);
`,fragmentShader+=`    float numerator = ((0.91 + 10.0 * exp(-3.0 * gamma) + 0.45 * pow(NdotL, 2.0)) * (1.0 - exp(-0.32 / NdotZenith)));
`,fragmentShader+=`    float denominator = (0.91 + 10.0 * exp(-3.0 * S) + 0.45 * pow(LdotZenith,2.0)) * (1.0 - exp(-0.32));
`,fragmentShader+=`    float luminance = gltf_luminanceAtZenith * (numerator / denominator);
`,fragmentShader+=`#endif 
`,fragmentShader+=`    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;
`,fragmentShader+=`    vec3 IBLColor = (diffuseIrradiance * diffuseColor * gltf_iblFactor.x) + (specularIrradiance * SRGBtoLINEAR3(specularColor * brdfLut.x + brdfLut.y) * gltf_iblFactor.y);
`,fragmentShader+=`    float maximumComponent = max(max(lightColorHdr.x, lightColorHdr.y), lightColorHdr.z);
`,fragmentShader+=`    vec3 lightColor = lightColorHdr / max(maximumComponent, 1.0);
`,fragmentShader+=`    IBLColor *= lightColor;
`,fragmentShader+=`#ifdef USE_SUN_LUMINANCE 
`,fragmentShader+=`    color += IBLColor * luminance;
`,fragmentShader+=`#else 
`,fragmentShader+=`    color += IBLColor; 
`,fragmentShader+=`#endif 
`,fragmentShader+=`#elif Cesium.defined(DIFFUSE_IBL) || Cesium.defined(SPECULAR_IBL) 
`,fragmentShader+=`    const mat3 yUpToZUp = mat3(-1.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 1.0, 0.0); 
`,fragmentShader+=`    vec3 cubeDir = normalize(yUpToZUp * gltf_iblReferenceFrameMatrix * normalize(reflect(-v, n))); 
`,fragmentShader+=`#ifdef DIFFUSE_IBL 
`,fragmentShader+=`#ifdef CUSTOM_SPHERICAL_HARMONICS 
`,fragmentShader+=`    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, gltf_sphericalHarmonicCoefficients); 
`,fragmentShader+=`#else 
`,fragmentShader+=`    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, czm_sphericalHarmonicCoefficients); 
`,fragmentShader+=`#endif 
`,fragmentShader+=`#else 
`,fragmentShader+=`    vec3 diffuseIrradiance = vec3(0.0); 
`,fragmentShader+=`#endif 
`,fragmentShader+=`#ifdef SPECULAR_IBL 
`,fragmentShader+=`    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;
`,fragmentShader+=`#ifdef CUSTOM_SPECULAR_IBL 
`,fragmentShader+=`    vec3 specularIBL = czm_sampleOctahedralProjection(gltf_specularMap, gltf_specularMapSize, cubeDir,  roughness * gltf_maxSpecularLOD, gltf_maxSpecularLOD);
`,fragmentShader+=`#else 
`,fragmentShader+=`    vec3 specularIBL = czm_sampleOctahedralProjection(czm_specularEnvironmentMaps, czm_specularEnvironmentMapSize, cubeDir,  roughness * czm_specularEnvironmentMapsMaximumLOD, czm_specularEnvironmentMapsMaximumLOD);
`,fragmentShader+=`#endif 
`,fragmentShader+=`    specularIBL *= F * brdfLut.x + brdfLut.y;
`,fragmentShader+=`#else 
`,fragmentShader+=`    vec3 specularIBL = vec3(0.0); 
`,fragmentShader+=`#endif 
`,fragmentShader+=`    color += diffuseIrradiance * diffuseColor + specularColor * specularIBL;
`,fragmentShader+=`#endif 
`):fragmentShader+=`    vec3 color = baseColor;
`,isUnlit||(Cesium.defined(generatedMaterialValues.u_occlusionTexture)&&(fragmentShader+=`    color *= texture2D(u_occlusionTexture, ${occlusionTexCoord}).r;
`),Cesium.defined(generatedMaterialValues.u_emissiveTexture)?(fragmentShader+=`    vec3 emissive = SRGBtoLINEAR3(texture2D(u_emissiveTexture, ${emissiveTexCoord}).rgb);
`,Cesium.defined(generatedMaterialValues.u_emissiveFactor)&&(fragmentShader+=`    emissive *= u_emissiveFactor;
`),fragmentShader+=`    color += emissive;
`):Cesium.defined(generatedMaterialValues.u_emissiveFactor)&&(fragmentShader+=`    color += u_emissiveFactor;
`)),isUnlit||(fragmentShader+=`    color = applyTonemapping(color);
`),fragmentShader+=`    color = LINEARtoSRGB(color);
`,hasOutline&&(fragmentShader+=`    float outlineness = max(
`,fragmentShader+=`        texture2D(u_outlineTexture, vec2(v_outlineCoordinates.x, 0.5)).r,
`,fragmentShader+=`        max(
`,fragmentShader+=`          texture2D(u_outlineTexture, vec2(v_outlineCoordinates.y, 0.5)).r,
`,fragmentShader+=`          texture2D(u_outlineTexture, vec2(v_outlineCoordinates.z, 0.5)).r));
`,fragmentShader+=`    color = mix(color, vec3(0.0, 0.0, 0.0), outlineness);
`),Cesium.defined(alphaMode)?alphaMode==="MASK"?(fragmentShader+=`    if (baseColorWithAlpha.a < u_alphaCutoff) {
`,fragmentShader+=`        discard;
`,fragmentShader+=`    }
`,fragmentShader+=`    gl_FragColor = vec4(color, 1.0);
`):alphaMode==="BLEND"?fragmentShader+=`    gl_FragColor = vec4(color, baseColorWithAlpha.a);
`:fragmentShader+=`    gl_FragColor = vec4(color, 1.0);
`:fragmentShader+=`    gl_FragColor = vec4(color, 1.0);
`,fragmentShader+=`}
`;let vertexShaderId=Cesium.addToArray(shaders,{type:Cesium.WebGLConstants.VERTEX_SHADER,extras:{_pipeline:{source:vertexShader,extension:".glsl"}}}),fragmentShaderId=Cesium.addToArray(shaders,{type:Cesium.WebGLConstants.FRAGMENT_SHADER,extras:{_pipeline:{source:fragmentShader,extension:".glsl"}}}),programId=Cesium.addToArray(programs,{fragmentShader:fragmentShaderId,vertexShader:vertexShaderId});return Cesium.addToArray(techniques,{attributes:techniqueAttributes,program:programId,uniforms:techniqueUniforms})}function getPBRValueType(paramName){if(paramName.indexOf("Offset")!==-1)return Cesium.WebGLConstants.FLOAT_VEC2;if(paramName.indexOf("Rotation")!==-1)return Cesium.WebGLConstants.FLOAT;if(paramName.indexOf("Scale")!==-1)return Cesium.WebGLConstants.FLOAT_VEC2;if(paramName.indexOf("Texture")!==-1)return Cesium.WebGLConstants.SAMPLER_2D;switch(paramName){case"u_baseColorFactor":return Cesium.WebGLConstants.FLOAT_VEC4;case"u_metallicFactor":return Cesium.WebGLConstants.FLOAT;case"u_roughnessFactor":return Cesium.WebGLConstants.FLOAT;case"u_emissiveFactor":return Cesium.WebGLConstants.FLOAT_VEC3;case"u_diffuseFactor":return Cesium.WebGLConstants.FLOAT_VEC4;case"u_specularFactor":return Cesium.WebGLConstants.FLOAT_VEC3;case"u_glossinessFactor":return Cesium.WebGLConstants.FLOAT}}var processPbrMaterials_default=processPbrMaterials;function ModelMaterial(model,material,id){this._name=material.name,this._id=id,this._uniformMap=model._uniformMaps[id],this._technique=void 0,this._program=void 0,this._values=void 0}Object.defineProperties(ModelMaterial.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}}});ModelMaterial.prototype.setValue=function(name,value){let uniformName=`u_${name}`,v=this._uniformMap.values[uniformName];v.value=v.clone(value,v.value)};ModelMaterial.prototype.getValue=function(name){let uniformName=`u_${name}`,v=this._uniformMap.values[uniformName];if(!!Cesium.defined(v))return v.value};var ModelMaterial_default=ModelMaterial;function ModelMesh(mesh,runtimeMaterialsById,id){let materials=[],primitives=mesh.primitives,length3=primitives.length;for(let i=0;i<length3;++i){let p=primitives[i];materials[i]=runtimeMaterialsById[p.material]}this._name=mesh.name,this._materials=materials,this._id=id}Object.defineProperties(ModelMesh.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},materials:{get:function(){return this._materials}}});var ModelMesh_default=ModelMesh;var MAX_GLTF_UINT16_INDEX=65534;function ModelOutlineLoader(){}ModelOutlineLoader.hasExtension=function(model){return Cesium.defined(model.extensionsRequired.CESIUM_primitive_outline)||Cesium.defined(model.extensionsUsed.CESIUM_primitive_outline)};ModelOutlineLoader.outlinePrimitives=function(model){if(!ModelOutlineLoader.hasExtension(model))return;let gltf=model.gltfInternal,vertexNumberingScopes=[];Cesium.ForEach.mesh(gltf,function(mesh,meshId){Cesium.ForEach.meshPrimitive(mesh,function(primitive,primitiveId){if(!Cesium.defined(primitive.extensions))return;let outlineData=primitive.extensions.CESIUM_primitive_outline;if(!Cesium.defined(outlineData))return;let vertexNumberingScope=getVertexNumberingScope(model,primitive);vertexNumberingScope!==void 0&&(vertexNumberingScopes.indexOf(vertexNumberingScope)<0&&vertexNumberingScopes.push(vertexNumberingScope),addOutline(model,meshId,primitiveId,outlineData.indices,vertexNumberingScope))})});for(let i=0;i<vertexNumberingScopes.length;++i)updateBufferViewsWithNewVertices(model,vertexNumberingScopes[i].bufferViews);compactBuffers(model)};ModelOutlineLoader.createTexture=function(model,context){let cache=context.cache.modelOutliningCache;if(Cesium.defined(cache)||(cache=context.cache.modelOutliningCache={}),Cesium.defined(cache.outlineTexture))return cache.outlineTexture;let maxSize=Math.min(4096,Cesium.ContextLimits.maximumTextureSize),size11=maxSize,levelZero=createTexture2(size11),mipLevels=[];for(;size11>1;)size11>>=1,mipLevels.push(createTexture2(size11));let texture=new Texture_default({context,source:{arrayBufferView:levelZero,mipLevels},width:maxSize,height:1,pixelFormat:Cesium.PixelFormat.LUMINANCE,sampler:new Cesium.Sampler({wrapS:Cesium.TextureWrap.CLAMP_TO_EDGE,wrapT:Cesium.TextureWrap.CLAMP_TO_EDGE,minificationFilter:Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR,magnificationFilter:Cesium.TextureMagnificationFilter.LINEAR})});return cache.outlineTexture=texture,texture};function addOutline(model,meshId,primitiveId,edgeIndicesAccessorId,vertexNumberingScope){let vertexCopies=vertexNumberingScope.vertexCopies,extraVertices=vertexNumberingScope.extraVertices,outlineCoordinates=vertexNumberingScope.outlineCoordinates,gltf=model.gltfInternal,primitive=gltf.meshes[meshId].primitives[primitiveId],accessors=gltf.accessors,bufferViews=gltf.bufferViews,numVertices;for(let semantic in primitive.attributes)if(primitive.attributes.hasOwnProperty(semantic)){let attributeId=primitive.attributes[semantic],accessor=accessors[attributeId];if(Cesium.defined(accessor)){numVertices=accessor.count;break}}if(!Cesium.defined(numVertices))return;let triangleIndexAccessorGltf=accessors[primitive.indices],triangleIndexBufferViewGltf=bufferViews[triangleIndexAccessorGltf.bufferView],edgeIndexAccessorGltf=accessors[edgeIndicesAccessorId],edgeIndexBufferViewGltf=bufferViews[edgeIndexAccessorGltf.bufferView],loadResources=model._loadResources,triangleIndexBufferView=loadResources.getBuffer(triangleIndexBufferViewGltf),edgeIndexBufferView=loadResources.getBuffer(edgeIndexBufferViewGltf),triangleIndices=triangleIndexAccessorGltf.componentType===5123?new Uint16Array(triangleIndexBufferView.buffer,triangleIndexBufferView.byteOffset+triangleIndexAccessorGltf.byteOffset,triangleIndexAccessorGltf.count):new Uint32Array(triangleIndexBufferView.buffer,triangleIndexBufferView.byteOffset+triangleIndexAccessorGltf.byteOffset,triangleIndexAccessorGltf.count),edgeIndices=edgeIndexAccessorGltf.componentType===5123?new Uint16Array(edgeIndexBufferView.buffer,edgeIndexBufferView.byteOffset+edgeIndexAccessorGltf.byteOffset,edgeIndexAccessorGltf.count):new Uint32Array(edgeIndexBufferView.buffer,edgeIndexBufferView.byteOffset+edgeIndexAccessorGltf.byteOffset,edgeIndexAccessorGltf.count),edgeSmallMultiplier=numVertices,edges2=[edgeSmallMultiplier],i;for(i=0;i<edgeIndices.length;i+=2){let a=edgeIndices[i],b=edgeIndices[i+1],small=Math.min(a,b),big=Math.max(a,b);edges2[small*edgeSmallMultiplier+big]=1}for(i=0;i<triangleIndices.length;i+=3){let i0=triangleIndices[i],i1=triangleIndices[i+1],i2=triangleIndices[i+2],all2=!1,has01=all2||isHighlighted(edges2,i0,i1),has12=all2||isHighlighted(edges2,i1,i2),has20=all2||isHighlighted(edges2,i2,i0),unmatchableVertexIndex=matchAndStoreCoordinates(outlineCoordinates,i0,i1,i2,has01,has12,has20);for(;unmatchableVertexIndex>=0;){let copy7;if(unmatchableVertexIndex===i0?copy7=vertexCopies[i0]:unmatchableVertexIndex===i1?copy7=vertexCopies[i1]:copy7=vertexCopies[i2],copy7===void 0){copy7=numVertices+extraVertices.length;let original=unmatchableVertexIndex;for(;original>=numVertices;)original=extraVertices[original-numVertices];extraVertices.push(original),vertexCopies[unmatchableVertexIndex]=copy7}copy7>MAX_GLTF_UINT16_INDEX&&triangleIndices instanceof Uint16Array&&(triangleIndices=new Uint32Array(triangleIndices),triangleIndexAccessorGltf.componentType=5125,triangleIndexBufferViewGltf.buffer=gltf.buffers.push({byteLength:triangleIndices.byteLength,extras:{_pipeline:{source:triangleIndices.buffer}}})-1,triangleIndexBufferViewGltf.byteLength=triangleIndices.byteLength,triangleIndexBufferViewGltf.byteOffset=0,model._loadResources.buffers[triangleIndexBufferViewGltf.buffer]=new Uint8Array(triangleIndices.buffer,0,triangleIndices.byteLength),loadResources.indexBuffersToCreate._array.forEach(function(toCreate){!Cesium.defined(toCreate)||toCreate.id===triangleIndexAccessorGltf.bufferView&&(toCreate.componentType=triangleIndexAccessorGltf.componentType)})),unmatchableVertexIndex===i0?(i0=copy7,triangleIndices[i]=copy7):unmatchableVertexIndex===i1?(i1=copy7,triangleIndices[i+1]=copy7):(i2=copy7,triangleIndices[i+2]=copy7),Cesium.defined(triangleIndexAccessorGltf.max)&&(triangleIndexAccessorGltf.max[0]=Math.max(triangleIndexAccessorGltf.max[0],copy7)),unmatchableVertexIndex=matchAndStoreCoordinates(outlineCoordinates,i0,i1,i2,has01,has12,has20)}}}function computeOrderMask(outlineCoordinates,vertexIndex,a,b,c){let startIndex=vertexIndex*3,first=outlineCoordinates[startIndex],second=outlineCoordinates[startIndex+1],third=outlineCoordinates[startIndex+2];return first===void 0?63:((first===a&&second===b&&third===c)<<0)+((first===a&&second===c&&third===b)<<1)+((first===b&&second===a&&third===c)<<2)+((first===b&&second===c&&third===a)<<3)+((first===c&&second===a&&third===b)<<4)+((first===c&&second===b&&third===a)<<5)}function popcount0to63(value){return(value&1)+(value>>1&1)+(value>>2&1)+(value>>3&1)+(value>>4&1)+(value>>5&1)}function matchAndStoreCoordinates(outlineCoordinates,i0,i1,i2,has01,has12,has20){let a0=has20?1:0,b0=has01?1:0,c0=0,i0Mask=computeOrderMask(outlineCoordinates,i0,a0,b0,c0);if(i0Mask===0)return i0;let a1=0,b1=has01?1:0,c1=has12?1:0,i1Mask=computeOrderMask(outlineCoordinates,i1,a1,b1,c1);if(i1Mask===0)return i1;let a2=has20?1:0,b2=0,c2=has12?1:0,i2Mask=computeOrderMask(outlineCoordinates,i2,a2,b2,c2);if(i2Mask===0)return i2;let workingOrders=i0Mask&i1Mask&i2Mask,a,b,c;if(workingOrders&1<<0)a=0,b=1,c=2;else if(workingOrders&1<<1)a=0,c=1,b=2;else if(workingOrders&1<<2)b=0,a=1,c=2;else if(workingOrders&1<<3)b=0,c=1,a=2;else if(workingOrders&1<<4)c=0,a=1,b=2;else if(workingOrders&1<<5)c=0,b=1,a=2;else{let i0Popcount=popcount0to63(i0Mask),i1Popcount=popcount0to63(i1Mask),i2Popcount=popcount0to63(i2Mask);return i0Popcount<i1Popcount&&i0Popcount<i2Popcount?i0:i1Popcount<i2Popcount?i1:i2}let i0Start=i0*3;outlineCoordinates[i0Start+a]=a0,outlineCoordinates[i0Start+b]=b0,outlineCoordinates[i0Start+c]=c0;let i1Start=i1*3;outlineCoordinates[i1Start+a]=a1,outlineCoordinates[i1Start+b]=b1,outlineCoordinates[i1Start+c]=c1;let i2Start=i2*3;return outlineCoordinates[i2Start+a]=a2,outlineCoordinates[i2Start+b]=b2,outlineCoordinates[i2Start+c]=c2,-1}function isHighlighted(edges2,i0,i1){let edgeSmallMultiplier=edges2[0],index=Math.min(i0,i1)*edgeSmallMultiplier+Math.max(i0,i1);return edges2[index]===1}function createTexture2(size11){let texture=new Uint8Array(size11);return texture[size11-1]=192,size11===8?texture[size11-1]=96:size11===4?texture[size11-1]=48:size11===2?texture[size11-1]=24:size11===1&&(texture[size11-1]=12),texture}function updateBufferViewsWithNewVertices(model,bufferViews){let gltf=model.gltfInternal,loadResources=model._loadResources,i,j;for(i=0;i<bufferViews.length;++i){let bufferView=bufferViews[i],vertexNumberingScope=bufferView.extras._pipeline.vertexNumberingScope;bufferView.extras._pipeline.vertexNumberingScope=void 0;let newVertices=vertexNumberingScope.extraVertices,sourceData=loadResources.getBuffer(bufferView),byteStride=bufferView.byteStride||4,newVerticesLength=newVertices.length,destData=new Uint8Array(sourceData.byteLength+newVerticesLength*byteStride);for(destData.set(sourceData),j=0;j<newVerticesLength;++j){let sourceIndex=newVertices[j]*byteStride,destIndex=sourceData.length+j*byteStride;for(let k=0;k<byteStride;++k)destData[destIndex+k]=destData[sourceIndex+k]}bufferView.byteOffset=0,bufferView.byteLength=destData.byteLength;let bufferId=gltf.buffers.push({byteLength:destData.byteLength,extras:{_pipeline:{source:destData.buffer}}})-1;bufferView.buffer=bufferId,loadResources.buffers[bufferId]=destData;let accessors=vertexNumberingScope.accessors;for(j=0;j<accessors.length;++j){let accessorId=accessors[j];gltf.accessors[accessorId].count+=newVerticesLength}if(!vertexNumberingScope.createdOutlines){let outlineCoordinates=vertexNumberingScope.outlineCoordinates,outlineCoordinateBuffer=new Float32Array(outlineCoordinates),bufferIndex=model.gltfInternal.buffers.push({byteLength:outlineCoordinateBuffer.byteLength,extras:{_pipeline:{source:outlineCoordinateBuffer.buffer}}})-1;loadResources.buffers[bufferIndex]=new Uint8Array(outlineCoordinateBuffer.buffer,0,outlineCoordinateBuffer.byteLength);let bufferViewIndex=model.gltfInternal.bufferViews.push({buffer:bufferIndex,byteLength:outlineCoordinateBuffer.byteLength,byteOffset:0,byteStride:3*Float32Array.BYTES_PER_ELEMENT,target:34962})-1,accessorIndex=model.gltfInternal.accessors.push({bufferView:bufferViewIndex,byteOffset:0,componentType:5126,count:outlineCoordinateBuffer.length/3,type:"VEC3",min:[0,0,0],max:[1,1,1]})-1,primitives=vertexNumberingScope.primitives;for(j=0;j<primitives.length;++j)primitives[j].attributes._OUTLINE_COORDINATES=accessorIndex;loadResources.vertexBuffersToCreate.enqueue(bufferViewIndex),vertexNumberingScope.createdOutlines=!0}}}function compactBuffers(model){let gltf=model.gltfInternal,loadResources=model._loadResources,i;for(i=0;i<gltf.buffers.length;++i){let buffer3=gltf.buffers[i],bufferViewsUsingThisBuffer=gltf.bufferViews.filter(usesBuffer.bind(void 0,i)),newLength=bufferViewsUsingThisBuffer.reduce(function(previous,current){return previous+current.byteLength},0);if(newLength===buffer3.byteLength)continue;let newBuffer=new Uint8Array(newLength),offset=0;for(let j=0;j<bufferViewsUsingThisBuffer.length;++j){let bufferView=bufferViewsUsingThisBuffer[j],sourceData=loadResources.getBuffer(bufferView);newBuffer.set(sourceData,offset),bufferView.byteOffset=offset,offset+=sourceData.byteLength}loadResources.buffers[i]=newBuffer,buffer3.extras._pipeline.source=newBuffer.buffer,buffer3.byteLength=newLength}}function usesBuffer(bufferId,bufferView){return bufferView.buffer===bufferId}function getVertexNumberingScope(model,primitive){let attributes=primitive.attributes;if(attributes===void 0)return;let gltf=model.gltfInternal,vertexNumberingScope;for(let semantic in attributes){if(!attributes.hasOwnProperty(semantic))continue;let accessorId=attributes[semantic],bufferViewId=gltf.accessors[accessorId].bufferView,bufferView=gltf.bufferViews[bufferViewId];if(Cesium.defined(bufferView.extras)||(bufferView.extras={}),Cesium.defined(bufferView.extras._pipeline)||(bufferView.extras._pipeline={}),!Cesium.defined(bufferView.extras._pipeline.vertexNumberingScope))bufferView.extras._pipeline.vertexNumberingScope=vertexNumberingScope||{vertexCopies:[],extraVertices:[],outlineCoordinates:[],accessors:[],bufferViews:[],primitives:[],createdOutlines:!1};else if(vertexNumberingScope!==void 0&&bufferView.extras._pipeline.vertexNumberingScope!==vertexNumberingScope)return;vertexNumberingScope=bufferView.extras._pipeline.vertexNumberingScope,vertexNumberingScope.bufferViews.indexOf(bufferView)<0&&vertexNumberingScope.bufferViews.push(bufferView),vertexNumberingScope.accessors.indexOf(accessorId)<0&&vertexNumberingScope.accessors.push(accessorId)}return vertexNumberingScope.primitives.push(primitive),vertexNumberingScope}var ModelOutlineLoader_default=ModelOutlineLoader;function addDefaults(gltf){Cesium.ForEach.accessor(gltf,function(accessor){Cesium.defined(accessor.bufferView)&&(accessor.byteOffset=Cesium.defaultValue(accessor.byteOffset,0))}),Cesium.ForEach.bufferView(gltf,function(bufferView){Cesium.defined(bufferView.buffer)&&(bufferView.byteOffset=Cesium.defaultValue(bufferView.byteOffset,0))}),Cesium.ForEach.mesh(gltf,function(mesh){Cesium.ForEach.meshPrimitive(mesh,function(primitive){if(primitive.mode=Cesium.defaultValue(primitive.mode,Cesium.WebGLConstants.TRIANGLES),!Cesium.defined(primitive.material)){Cesium.defined(gltf.materials)||(gltf.materials=[]);let defaultMaterial={name:"default"};primitive.material=Cesium.addToArray(gltf.materials,defaultMaterial)}})}),Cesium.ForEach.accessorContainingVertexAttributeData(gltf,function(accessorId){let accessor=gltf.accessors[accessorId],bufferViewId=accessor.bufferView;if(accessor.normalized=Cesium.defaultValue(accessor.normalized,!1),Cesium.defined(bufferViewId)){let bufferView=gltf.bufferViews[bufferViewId];bufferView.byteStride=Cesium.getAccessorByteStride(gltf,accessor),bufferView.target=Cesium.WebGLConstants.ARRAY_BUFFER}}),Cesium.ForEach.accessorContainingIndexData(gltf,function(accessorId){let bufferViewId=gltf.accessors[accessorId].bufferView;if(Cesium.defined(bufferViewId)){let bufferView=gltf.bufferViews[bufferViewId];bufferView.target=Cesium.WebGLConstants.ELEMENT_ARRAY_BUFFER}}),Cesium.ForEach.material(gltf,function(material){let extensions=Cesium.defaultValue(material.extensions,Cesium.defaultValue.EMPTY_OBJECT),materialsCommon=extensions.KHR_materials_common;if(Cesium.defined(materialsCommon)){let technique=materialsCommon.technique,values3=Cesium.defined(materialsCommon.values)?materialsCommon.values:{};materialsCommon.values=values3,values3.ambient=Cesium.defined(values3.ambient)?values3.ambient:[0,0,0,1],values3.emission=Cesium.defined(values3.emission)?values3.emission:[0,0,0,1],values3.transparency=Cesium.defaultValue(values3.transparency,1),values3.transparent=Cesium.defaultValue(values3.transparent,!1),values3.doubleSided=Cesium.defaultValue(values3.doubleSided,!1),technique!=="CONSTANT"&&(values3.diffuse=Cesium.defined(values3.diffuse)?values3.diffuse:[0,0,0,1],technique!=="LAMBERT"&&(values3.specular=Cesium.defined(values3.specular)?values3.specular:[0,0,0,1],values3.shininess=Cesium.defaultValue(values3.shininess,0)));return}material.emissiveFactor=Cesium.defaultValue(material.emissiveFactor,[0,0,0]),material.alphaMode=Cesium.defaultValue(material.alphaMode,"OPAQUE"),material.doubleSided=Cesium.defaultValue(material.doubleSided,!1),material.alphaMode==="MASK"&&(material.alphaCutoff=Cesium.defaultValue(material.alphaCutoff,.5));let techniquesExtension=extensions.KHR_techniques_webgl;Cesium.defined(techniquesExtension)&&Cesium.ForEach.materialValue(material,function(materialValue){Cesium.defined(materialValue.index)&&addTextureDefaults(materialValue)}),addTextureDefaults(material.emissiveTexture),addTextureDefaults(material.normalTexture),addTextureDefaults(material.occlusionTexture);let pbrMetallicRoughness=material.pbrMetallicRoughness;Cesium.defined(pbrMetallicRoughness)&&(pbrMetallicRoughness.baseColorFactor=Cesium.defaultValue(pbrMetallicRoughness.baseColorFactor,[1,1,1,1]),pbrMetallicRoughness.metallicFactor=Cesium.defaultValue(pbrMetallicRoughness.metallicFactor,1),pbrMetallicRoughness.roughnessFactor=Cesium.defaultValue(pbrMetallicRoughness.roughnessFactor,1),addTextureDefaults(pbrMetallicRoughness.baseColorTexture),addTextureDefaults(pbrMetallicRoughness.metallicRoughnessTexture));let pbrSpecularGlossiness=extensions.KHR_materials_pbrSpecularGlossiness;Cesium.defined(pbrSpecularGlossiness)&&(pbrSpecularGlossiness.diffuseFactor=Cesium.defaultValue(pbrSpecularGlossiness.diffuseFactor,[1,1,1,1]),pbrSpecularGlossiness.specularFactor=Cesium.defaultValue(pbrSpecularGlossiness.specularFactor,[1,1,1]),pbrSpecularGlossiness.glossinessFactor=Cesium.defaultValue(pbrSpecularGlossiness.glossinessFactor,1),addTextureDefaults(pbrSpecularGlossiness.specularGlossinessTexture))}),Cesium.ForEach.animation(gltf,function(animation){Cesium.ForEach.animationSampler(animation,function(sampler){sampler.interpolation=Cesium.defaultValue(sampler.interpolation,"LINEAR")})});let animatedNodes=getAnimatedNodes(gltf);return Cesium.ForEach.node(gltf,function(node,id){Cesium.defined(animatedNodes[id])||Cesium.defined(node.translation)||Cesium.defined(node.rotation)||Cesium.defined(node.scale)?(node.translation=Cesium.defaultValue(node.translation,[0,0,0]),node.rotation=Cesium.defaultValue(node.rotation,[0,0,0,1]),node.scale=Cesium.defaultValue(node.scale,[1,1,1])):node.matrix=Cesium.defaultValue(node.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}),Cesium.ForEach.sampler(gltf,function(sampler){sampler.wrapS=Cesium.defaultValue(sampler.wrapS,Cesium.WebGLConstants.REPEAT),sampler.wrapT=Cesium.defaultValue(sampler.wrapT,Cesium.WebGLConstants.REPEAT)}),Cesium.defined(gltf.scenes)&&!Cesium.defined(gltf.scene)&&(gltf.scene=0),gltf}function getAnimatedNodes(gltf){let nodes={};return Cesium.ForEach.animation(gltf,function(animation){Cesium.ForEach.animationChannel(animation,function(channel){let target=channel.target,nodeId=target.node,path=target.path;(path==="translation"||path==="rotation"||path==="scale")&&(nodes[nodeId]=!0)})}),nodes}function addTextureDefaults(texture){Cesium.defined(texture)&&(texture.texCoord=Cesium.defaultValue(texture.texCoord,0))}var addDefaults_default=addDefaults;var updateFunctions={.8:glTF08to10,"1.0":glTF10to20,"2.0":void 0};function updateVersion(gltf,options){options=Cesium.defaultValue(options,Cesium.defaultValue.EMPTY_OBJECT);let targetVersion=options.targetVersion,version=gltf.version;gltf.asset=Cesium.defaultValue(gltf.asset,{version:"1.0"}),gltf.asset.version=Cesium.defaultValue(gltf.asset.version,"1.0"),version=Cesium.defaultValue(version,gltf.asset.version).toString(),Object.prototype.hasOwnProperty.call(updateFunctions,version)||(Cesium.defined(version)&&(version=version.substring(0,3)),Object.prototype.hasOwnProperty.call(updateFunctions,version)||(version="1.0"));let updateFunction=updateFunctions[version];for(;Cesium.defined(updateFunction)&&version!==targetVersion;)updateFunction(gltf,options),version=gltf.asset.version,updateFunction=updateFunctions[version];return gltf}function updateInstanceTechniques(gltf){let materials=gltf.materials;for(let materialId in materials)if(Object.prototype.hasOwnProperty.call(materials,materialId)){let material=materials[materialId],instanceTechnique=material.instanceTechnique;Cesium.defined(instanceTechnique)&&(material.technique=instanceTechnique.technique,material.values=instanceTechnique.values,delete material.instanceTechnique)}}function setPrimitiveModes(gltf){let meshes=gltf.meshes;for(let meshId in meshes)if(Object.prototype.hasOwnProperty.call(meshes,meshId)){let primitives=meshes[meshId].primitives;if(Cesium.defined(primitives)){let primitivesLength=primitives.length;for(let i=0;i<primitivesLength;++i){let primitive=primitives[i],defaultMode=Cesium.defaultValue(primitive.primitive,Cesium.WebGLConstants.TRIANGLES);primitive.mode=Cesium.defaultValue(primitive.mode,defaultMode),delete primitive.primitive}}}}function updateNodes(gltf){let nodes=gltf.nodes,axis=new Cesium.Cartesian3,quat=new Cesium.Quaternion;for(let nodeId in nodes)if(Object.prototype.hasOwnProperty.call(nodes,nodeId)){let node=nodes[nodeId];if(Cesium.defined(node.rotation)){let rotation2=node.rotation;Cesium.Cartesian3.fromArray(rotation2,0,axis),Cesium.Quaternion.fromAxisAngle(axis,rotation2[3],quat),node.rotation=[quat.x,quat.y,quat.z,quat.w]}let instanceSkin=node.instanceSkin;Cesium.defined(instanceSkin)&&(node.skeletons=instanceSkin.skeletons,node.skin=instanceSkin.skin,node.meshes=instanceSkin.meshes,delete node.instanceSkin)}}function updateAnimations(gltf){let animations=gltf.animations,accessors=gltf.accessors,bufferViews=gltf.bufferViews,buffers=gltf.buffers,updatedAccessors={},axis=new Cesium.Cartesian3,quat=new Cesium.Quaternion;for(let animationId in animations)if(Object.prototype.hasOwnProperty.call(animations,animationId)){let animation=animations[animationId],channels=animation.channels,parameters=animation.parameters,samplers=animation.samplers;if(Cesium.defined(channels)){let channelsLength=channels.length;for(let i=0;i<channelsLength;++i){let channel=channels[i];if(channel.target.path==="rotation"){let accessorId=parameters[samplers[channel.sampler].output];if(Cesium.defined(updatedAccessors[accessorId]))continue;updatedAccessors[accessorId]=!0;let accessor=accessors[accessorId],bufferView=bufferViews[accessor.bufferView],source=buffers[bufferView.buffer].extras._pipeline.source,byteOffset=source.byteOffset+bufferView.byteOffset+accessor.byteOffset,componentType=accessor.componentType,count2=accessor.count,componentsLength=Cesium.numberOfComponentsForType(accessor.type),length3=accessor.count*componentsLength,typedArray=Cesium.ComponentDatatype.createArrayBufferView(componentType,source.buffer,byteOffset,length3);for(let j=0;j<count2;j++){let offset=j*componentsLength;Cesium.Cartesian3.unpack(typedArray,offset,axis);let angle3=typedArray[offset+3];Cesium.Quaternion.fromAxisAngle(axis,angle3,quat),Cesium.Quaternion.pack(quat,typedArray,offset)}}}}}}function removeTechniquePasses(gltf){let techniques=gltf.techniques;for(let techniqueId in techniques)if(Object.prototype.hasOwnProperty.call(techniques,techniqueId)){let technique=techniques[techniqueId],passes=technique.passes;if(Cesium.defined(passes)){let passName=Cesium.defaultValue(technique.pass,"defaultPass");if(Object.prototype.hasOwnProperty.call(passes,passName)){let pass=passes[passName],instanceProgram=pass.instanceProgram;technique.attributes=Cesium.defaultValue(technique.attributes,instanceProgram.attributes),technique.program=Cesium.defaultValue(technique.program,instanceProgram.program),technique.uniforms=Cesium.defaultValue(technique.uniforms,instanceProgram.uniforms),technique.states=Cesium.defaultValue(technique.states,pass.states)}delete technique.passes,delete technique.pass}}}function glTF08to10(gltf){Cesium.defined(gltf.asset)||(gltf.asset={});let asset=gltf.asset;if(asset.version="1.0",typeof asset.profile=="string"){let split2=asset.profile.split(" ");asset.profile={api:split2[0],version:split2[1]}}else asset.profile={};if(Cesium.defined(gltf.version)&&delete gltf.version,updateInstanceTechniques(gltf),setPrimitiveModes(gltf),updateNodes(gltf),updateAnimations(gltf),removeTechniquePasses(gltf),Cesium.defined(gltf.allExtensions)&&(gltf.extensionsUsed=gltf.allExtensions,delete gltf.allExtensions),Cesium.defined(gltf.lights)){let extensions=Cesium.defaultValue(gltf.extensions,{});gltf.extensions=extensions;let materialsCommon=Cesium.defaultValue(extensions.KHR_materials_common,{});extensions.KHR_materials_common=materialsCommon,materialsCommon.lights=gltf.lights,delete gltf.lights,Cesium.addExtensionsUsed(gltf,"KHR_materials_common")}}function removeAnimationSamplersIndirection(gltf){let animations=gltf.animations;for(let animationId in animations)if(Object.prototype.hasOwnProperty.call(animations,animationId)){let animation=animations[animationId],parameters=animation.parameters;if(Cesium.defined(parameters)){let samplers=animation.samplers;for(let samplerId in samplers)if(Object.prototype.hasOwnProperty.call(samplers,samplerId)){let sampler=samplers[samplerId];sampler.input=parameters[sampler.input],sampler.output=parameters[sampler.output]}delete animation.parameters}}}function objectToArray(object2,mapping){let array=[];for(let id in object2)if(Object.prototype.hasOwnProperty.call(object2,id)){let value=object2[id];mapping[id]=array.length,array.push(value),Cesium.defined(value.name)||(value.name=id)}return array}function objectsToArrays(gltf){let i,globalMapping={accessors:{},animations:{},buffers:{},bufferViews:{},cameras:{},images:{},materials:{},meshes:{},nodes:{},programs:{},samplers:{},scenes:{},shaders:{},skins:{},textures:{},techniques:{}},jointName,jointNameToId={},nodes=gltf.nodes;for(let id in nodes)Object.prototype.hasOwnProperty.call(nodes,id)&&(jointName=nodes[id].jointName,Cesium.defined(jointName)&&(jointNameToId[jointName]=id));for(let topLevelId in gltf)if(Object.prototype.hasOwnProperty.call(gltf,topLevelId)&&Cesium.defined(globalMapping[topLevelId])){let objectMapping={},object2=gltf[topLevelId];gltf[topLevelId]=objectToArray(object2,objectMapping),globalMapping[topLevelId]=objectMapping}for(jointName in jointNameToId)Object.prototype.hasOwnProperty.call(jointNameToId,jointName)&&(jointNameToId[jointName]=globalMapping.nodes[jointNameToId[jointName]]);Cesium.defined(gltf.scene)&&(gltf.scene=globalMapping.scenes[gltf.scene]),Cesium.ForEach.bufferView(gltf,function(bufferView){Cesium.defined(bufferView.buffer)&&(bufferView.buffer=globalMapping.buffers[bufferView.buffer])}),Cesium.ForEach.accessor(gltf,function(accessor){Cesium.defined(accessor.bufferView)&&(accessor.bufferView=globalMapping.bufferViews[accessor.bufferView])}),Cesium.ForEach.shader(gltf,function(shader){let extensions=shader.extensions;if(Cesium.defined(extensions)){let binaryGltf=extensions.KHR_binary_glTF;Cesium.defined(binaryGltf)&&(shader.bufferView=globalMapping.bufferViews[binaryGltf.bufferView],delete extensions.KHR_binary_glTF),Object.keys(extensions).length===0&&delete shader.extensions}}),Cesium.ForEach.program(gltf,function(program){Cesium.defined(program.vertexShader)&&(program.vertexShader=globalMapping.shaders[program.vertexShader]),Cesium.defined(program.fragmentShader)&&(program.fragmentShader=globalMapping.shaders[program.fragmentShader])}),Cesium.ForEach.technique(gltf,function(technique){Cesium.defined(technique.program)&&(technique.program=globalMapping.programs[technique.program]),Cesium.ForEach.techniqueParameter(technique,function(parameter){Cesium.defined(parameter.node)&&(parameter.node=globalMapping.nodes[parameter.node]);let value=parameter.value;typeof value=="string"&&(parameter.value={index:globalMapping.textures[value]})})}),Cesium.ForEach.mesh(gltf,function(mesh){Cesium.ForEach.meshPrimitive(mesh,function(primitive){Cesium.defined(primitive.indices)&&(primitive.indices=globalMapping.accessors[primitive.indices]),Cesium.ForEach.meshPrimitiveAttribute(primitive,function(accessorId,semantic){primitive.attributes[semantic]=globalMapping.accessors[accessorId]}),Cesium.defined(primitive.material)&&(primitive.material=globalMapping.materials[primitive.material])})}),Cesium.ForEach.node(gltf,function(node){let children=node.children;if(Cesium.defined(children)){let childrenLength=children.length;for(i=0;i<childrenLength;++i)children[i]=globalMapping.nodes[children[i]]}if(Cesium.defined(node.meshes)){let meshes=node.meshes,meshesLength=meshes.length;if(meshesLength>0)for(node.mesh=globalMapping.meshes[meshes[0]],i=1;i<meshesLength;++i){let meshNode={mesh:globalMapping.meshes[meshes[i]]},meshNodeId=Cesium.addToArray(gltf.nodes,meshNode);Cesium.defined(children)||(children=[],node.children=children),children.push(meshNodeId)}delete node.meshes}if(Cesium.defined(node.camera)&&(node.camera=globalMapping.cameras[node.camera]),Cesium.defined(node.skin)&&(node.skin=globalMapping.skins[node.skin]),Cesium.defined(node.skeletons)){let skeletons=node.skeletons;if(skeletons.length>0&&Cesium.defined(node.skin)){let skin=gltf.skins[node.skin];skin.skeleton=globalMapping.nodes[skeletons[0]]}delete node.skeletons}Cesium.defined(node.jointName)&&delete node.jointName}),Cesium.ForEach.skin(gltf,function(skin){Cesium.defined(skin.inverseBindMatrices)&&(skin.inverseBindMatrices=globalMapping.accessors[skin.inverseBindMatrices]);let jointNames=skin.jointNames;if(Cesium.defined(jointNames)){let joints=[],jointNamesLength=jointNames.length;for(i=0;i<jointNamesLength;++i)joints[i]=jointNameToId[jointNames[i]];skin.joints=joints,delete skin.jointNames}}),Cesium.ForEach.scene(gltf,function(scene){let sceneNodes=scene.nodes;if(Cesium.defined(sceneNodes)){let sceneNodesLength=sceneNodes.length;for(i=0;i<sceneNodesLength;++i)sceneNodes[i]=globalMapping.nodes[sceneNodes[i]]}}),Cesium.ForEach.animation(gltf,function(animation){let samplerMapping={};animation.samplers=objectToArray(animation.samplers,samplerMapping),Cesium.ForEach.animationSampler(animation,function(sampler){sampler.input=globalMapping.accessors[sampler.input],sampler.output=globalMapping.accessors[sampler.output]}),Cesium.ForEach.animationChannel(animation,function(channel){channel.sampler=samplerMapping[channel.sampler];let target=channel.target;Cesium.defined(target)&&(target.node=globalMapping.nodes[target.id],delete target.id)})}),Cesium.ForEach.material(gltf,function(material){Cesium.defined(material.technique)&&(material.technique=globalMapping.techniques[material.technique]),Cesium.ForEach.materialValue(material,function(value,name){typeof value=="string"&&(material.values[name]={index:globalMapping.textures[value]})});let extensions=material.extensions;if(Cesium.defined(extensions)){let materialsCommon=extensions.KHR_materials_common;Cesium.defined(materialsCommon)&&Cesium.ForEach.materialValue(materialsCommon,function(value,name){typeof value=="string"&&(materialsCommon.values[name]={index:globalMapping.textures[value]})})}}),Cesium.ForEach.image(gltf,function(image){let extensions=image.extensions;if(Cesium.defined(extensions)){let binaryGltf=extensions.KHR_binary_glTF;Cesium.defined(binaryGltf)&&(image.bufferView=globalMapping.bufferViews[binaryGltf.bufferView],image.mimeType=binaryGltf.mimeType,delete extensions.KHR_binary_glTF),Object.keys(extensions).length===0&&delete image.extensions}}),Cesium.ForEach.texture(gltf,function(texture){Cesium.defined(texture.sampler)&&(texture.sampler=globalMapping.samplers[texture.sampler]),Cesium.defined(texture.source)&&(texture.source=globalMapping.images[texture.source])})}function removeAnimationSamplerNames(gltf){Cesium.ForEach.animation(gltf,function(animation){Cesium.ForEach.animationSampler(animation,function(sampler){delete sampler.name})})}function removeEmptyArrays(gltf){for(let topLevelId in gltf)if(Object.prototype.hasOwnProperty.call(gltf,topLevelId)){let array=gltf[topLevelId];Array.isArray(array)&&array.length===0&&delete gltf[topLevelId]}Cesium.ForEach.node(gltf,function(node){Cesium.defined(node.children)&&node.children.length===0&&delete node.children})}function stripAsset(gltf){let asset=gltf.asset;delete asset.profile,delete asset.premultipliedAlpha}var knownExtensions={CESIUM_RTC:!0,KHR_materials_common:!0,WEB3D_quantized_attributes:!0};function requireKnownExtensions(gltf){let extensionsUsed=gltf.extensionsUsed;if(gltf.extensionsRequired=Cesium.defaultValue(gltf.extensionsRequired,[]),Cesium.defined(extensionsUsed)){let extensionsUsedLength=extensionsUsed.length;for(let i=0;i<extensionsUsedLength;++i){let extension=extensionsUsed[i];Cesium.defined(knownExtensions[extension])&&gltf.extensionsRequired.push(extension)}}}function removeBufferType(gltf){Cesium.ForEach.buffer(gltf,function(buffer3){delete buffer3.type})}function removeTextureProperties(gltf){Cesium.ForEach.texture(gltf,function(texture){delete texture.format,delete texture.internalFormat,delete texture.target,delete texture.type})}function requireAttributeSetIndex(gltf){Cesium.ForEach.mesh(gltf,function(mesh){Cesium.ForEach.meshPrimitive(mesh,function(primitive){Cesium.ForEach.meshPrimitiveAttribute(primitive,function(accessorId,semantic){semantic==="TEXCOORD"?primitive.attributes.TEXCOORD_0=accessorId:semantic==="COLOR"&&(primitive.attributes.COLOR_0=accessorId)}),delete primitive.attributes.TEXCOORD,delete primitive.attributes.COLOR})}),Cesium.ForEach.technique(gltf,function(technique){Cesium.ForEach.techniqueParameter(technique,function(parameter){let semantic=parameter.semantic;Cesium.defined(semantic)&&(semantic==="TEXCOORD"?parameter.semantic="TEXCOORD_0":semantic==="COLOR"&&(parameter.semantic="COLOR_0"))})})}var knownSemantics={POSITION:!0,NORMAL:!0,TANGENT:!0},indexedSemantics={COLOR:"COLOR",JOINT:"JOINTS",JOINTS:"JOINTS",TEXCOORD:"TEXCOORD",WEIGHT:"WEIGHTS",WEIGHTS:"WEIGHTS"};function underscoreApplicationSpecificSemantics(gltf){let mappedSemantics={};Cesium.ForEach.mesh(gltf,function(mesh){Cesium.ForEach.meshPrimitive(mesh,function(primitive){Cesium.ForEach.meshPrimitiveAttribute(primitive,function(accessorId,semantic){if(semantic.charAt(0)!=="_"){let setIndex=semantic.search(/_[0-9]+/g),strippedSemantic=semantic,suffix="_0";setIndex>=0&&(strippedSemantic=semantic.substring(0,setIndex),suffix=semantic.substring(setIndex));let newSemantic,indexedSemantic=indexedSemantics[strippedSemantic];Cesium.defined(indexedSemantic)?(newSemantic=indexedSemantic+suffix,mappedSemantics[semantic]=newSemantic):Cesium.defined(knownSemantics[strippedSemantic])||(newSemantic="_"+semantic,mappedSemantics[semantic]=newSemantic)}});for(let semantic in mappedSemantics)if(Object.prototype.hasOwnProperty.call(mappedSemantics,semantic)){let mappedSemantic=mappedSemantics[semantic],accessorId=primitive.attributes[semantic];Cesium.defined(accessorId)&&(delete primitive.attributes[semantic],primitive.attributes[mappedSemantic]=accessorId)}})}),Cesium.ForEach.technique(gltf,function(technique){Cesium.ForEach.techniqueParameter(technique,function(parameter){let mappedSemantic=mappedSemantics[parameter.semantic];Cesium.defined(mappedSemantic)&&(parameter.semantic=mappedSemantic)})})}function clampCameraParameters(gltf){Cesium.ForEach.camera(gltf,function(camera){let perspective=camera.perspective;if(Cesium.defined(perspective)){let aspectRatio=perspective.aspectRatio;Cesium.defined(aspectRatio)&&aspectRatio===0&&delete perspective.aspectRatio;let yfov=perspective.yfov;Cesium.defined(yfov)&&yfov===0&&(perspective.yfov=1)}})}function computeAccessorByteStride(gltf,accessor){return Cesium.defined(accessor.byteStride)&&accessor.byteStride!==0?accessor.byteStride:Cesium.getAccessorByteStride(gltf,accessor)}function requireByteLength(gltf){Cesium.ForEach.buffer(gltf,function(buffer3){Cesium.defined(buffer3.byteLength)||(buffer3.byteLength=buffer3.extras._pipeline.source.length)}),Cesium.ForEach.accessor(gltf,function(accessor){let bufferViewId=accessor.bufferView;if(Cesium.defined(bufferViewId)){let bufferView=gltf.bufferViews[bufferViewId],accessorByteStride=computeAccessorByteStride(gltf,accessor),accessorByteEnd=accessor.byteOffset+accessor.count*accessorByteStride;bufferView.byteLength=Math.max(Cesium.defaultValue(bufferView.byteLength,0),accessorByteEnd)}})}function moveByteStrideToBufferView(gltf){let i,j,bufferView,bufferViews=gltf.bufferViews,bufferViewHasVertexAttributes={};Cesium.ForEach.accessorContainingVertexAttributeData(gltf,function(accessorId){let accessor=gltf.accessors[accessorId];Cesium.defined(accessor.bufferView)&&(bufferViewHasVertexAttributes[accessor.bufferView]=!0)});let bufferViewMap={};Cesium.ForEach.accessor(gltf,function(accessor){Cesium.defined(accessor.bufferView)&&(bufferViewMap[accessor.bufferView]=Cesium.defaultValue(bufferViewMap[accessor.bufferView],[]),bufferViewMap[accessor.bufferView].push(accessor))});for(let bufferViewId in bufferViewMap)if(Object.prototype.hasOwnProperty.call(bufferViewMap,bufferViewId)){bufferView=bufferViews[bufferViewId];let accessors=bufferViewMap[bufferViewId];accessors.sort(function(a,b){return a.byteOffset-b.byteOffset});let currentByteOffset=0,currentIndex=0,accessorsLength=accessors.length;for(i=0;i<accessorsLength;++i){let accessor=accessors[i],accessorByteStride=computeAccessorByteStride(gltf,accessor),accessorByteOffset=accessor.byteOffset,accessorByteLength=accessor.count*accessorByteStride;delete accessor.byteStride;let hasNextAccessor=i<accessorsLength-1,nextAccessorByteStride=hasNextAccessor?computeAccessorByteStride(gltf,accessors[i+1]):void 0;if(accessorByteStride!==nextAccessorByteStride){let newBufferView=Cesium.clone(bufferView,!0);bufferViewHasVertexAttributes[bufferViewId]&&(newBufferView.byteStride=accessorByteStride),newBufferView.byteOffset+=currentByteOffset,newBufferView.byteLength=accessorByteOffset+accessorByteLength-currentByteOffset;let newBufferViewId=Cesium.addToArray(bufferViews,newBufferView);for(j=currentIndex;j<=i;++j)accessor=accessors[j],accessor.bufferView=newBufferViewId,accessor.byteOffset=accessor.byteOffset-currentByteOffset;currentByteOffset=hasNextAccessor?accessors[i+1].byteOffset:void 0,currentIndex=i+1}}}Cesium.removeUnusedElements(gltf,["accessor","bufferView","buffer"])}function requirePositionAccessorMinMax(gltf){Cesium.ForEach.accessorWithSemantic(gltf,"POSITION",function(accessorId){let accessor=gltf.accessors[accessorId];if(!Cesium.defined(accessor.min)||!Cesium.defined(accessor.max)){let minMax=Cesium.findAccessorMinMax(gltf,accessor);accessor.min=minMax.min,accessor.max=minMax.max}})}function isNodeEmpty(node){return(!Cesium.defined(node.children)||node.children.length===0)&&(!Cesium.defined(node.meshes)||node.meshes.length===0)&&!Cesium.defined(node.camera)&&!Cesium.defined(node.skin)&&!Cesium.defined(node.skeletons)&&!Cesium.defined(node.jointName)&&(!Cesium.defined(node.translation)||Cesium.Cartesian3.fromArray(node.translation).equals(Cesium.Cartesian3.ZERO))&&(!Cesium.defined(node.scale)||Cesium.Cartesian3.fromArray(node.scale).equals(new Cesium.Cartesian3(1,1,1)))&&(!Cesium.defined(node.rotation)||Cesium.Cartesian4.fromArray(node.rotation).equals(new Cesium.Cartesian4(0,0,0,1)))&&(!Cesium.defined(node.matrix)||Cesium.Matrix4.fromColumnMajorArray(node.matrix).equals(Cesium.Matrix4.IDENTITY))&&!Cesium.defined(node.extensions)&&!Cesium.defined(node.extras)}function deleteNode(gltf,nodeId){Cesium.ForEach.scene(gltf,function(scene){let sceneNodes=scene.nodes;if(Cesium.defined(sceneNodes)){let sceneNodesLength=sceneNodes.length;for(let i=sceneNodesLength;i>=0;--i)if(sceneNodes[i]===nodeId){sceneNodes.splice(i,1);return}}}),Cesium.ForEach.node(gltf,function(parentNode,parentNodeId){if(Cesium.defined(parentNode.children)){let index=parentNode.children.indexOf(nodeId);index>-1&&(parentNode.children.splice(index,1),isNodeEmpty(parentNode)&&deleteNode(gltf,parentNodeId))}}),delete gltf.nodes[nodeId]}function removeEmptyNodes(gltf){return Cesium.ForEach.node(gltf,function(node,nodeId){isNodeEmpty(node)&&deleteNode(gltf,nodeId)}),gltf}function requireAnimationAccessorMinMax(gltf){Cesium.ForEach.animation(gltf,function(animation){Cesium.ForEach.animationSampler(animation,function(sampler){let accessor=gltf.accessors[sampler.input];if(!Cesium.defined(accessor.min)||!Cesium.defined(accessor.max)){let minMax=Cesium.findAccessorMinMax(gltf,accessor);accessor.min=minMax.min,accessor.max=minMax.max}})})}function glTF10to20(gltf){gltf.asset=Cesium.defaultValue(gltf.asset,{}),gltf.asset.version="2.0",updateInstanceTechniques(gltf),removeAnimationSamplersIndirection(gltf),removeEmptyNodes(gltf),objectsToArrays(gltf),removeAnimationSamplerNames(gltf),stripAsset(gltf),requireKnownExtensions(gltf),requireByteLength(gltf),moveByteStrideToBufferView(gltf),requirePositionAccessorMinMax(gltf),requireAnimationAccessorMinMax(gltf),removeBufferType(gltf),removeTextureProperties(gltf),requireAttributeSetIndex(gltf),underscoreApplicationSpecificSemantics(gltf),Cesium.updateAccessorComponentTypes(gltf),clampCameraParameters(gltf),Cesium.moveTechniqueRenderStates(gltf),Cesium.moveTechniquesToExtension(gltf),removeEmptyArrays(gltf)}var updateVersion_default=updateVersion;var EV_IndexDBType={TERRAIN:0,IMAGERY:1,TILES3D:2,BIN:3,IMAGE:4,FILE:5},EV_IndexDBType_default=Object.freeze(EV_IndexDBType);function EV_IndexDBHandler(){}EV_IndexDBHandler._maxTaskConcurrency=500;EV_IndexDBHandler.indexDbCache=new Cesium.AssociativeArray;EV_IndexDBHandler._saverTaskProcessor=void 0;EV_IndexDBHandler._loadTaskProcessor=void 0;EV_IndexDBHandler._getSaverTaskProcessor=function(){return Cesium.defined(EV_IndexDBHandler._saverTaskProcessor)||(EV_IndexDBHandler._saverTaskProcessor=new Cesium.TaskProcessor("indexDBSaveWorker",EV_IndexDBHandler._maxTaskConcurrency)),EV_IndexDBHandler._saverTaskProcessor};EV_IndexDBHandler._getLoadTaskProcessor=function(){return Cesium.defined(EV_IndexDBHandler._loadTaskProcessor)||(EV_IndexDBHandler._loadTaskProcessor=new Cesium.TaskProcessor("indexDBLoadWorker",EV_IndexDBHandler._maxTaskConcurrency)),EV_IndexDBHandler._loadTaskProcessor};function onLoadMessage(event){let receiveData=event.data;if(Cesium.defined(receiveData.workerType)){let tempTerrainPacks=EV_IndexDBHandler.indexDbCache.get(receiveData.dataName);switch(receiveData.workerType){case EV_IndexDBType_default.TERRAIN:case EV_IndexDBType_default.IMAGERY:if(Cesium.defined(tempTerrainPacks)){for(let i=0;i<tempTerrainPacks.length;i++)Cesium.defined(receiveData.data)&&receiveData.success?Cesium.defined(tempTerrainPacks[i])&&Cesium.defined(tempTerrainPacks[i].downloadSuccessFun)&&(tempTerrainPacks[i].data=receiveData.data,tempTerrainPacks[i].level=receiveData.level,tempTerrainPacks[i].x=receiveData.x,tempTerrainPacks[i].y=receiveData.y,tempTerrainPacks[i].upsample=receiveData.upsample,tempTerrainPacks[i].downloadSuccessFun(tempTerrainPacks[i],receiveData.data)):Cesium.defined(tempTerrainPacks[i].downloadErrorFun)&&tempTerrainPacks[i].downloadErrorFun(tempTerrainPacks[i]);EV_IndexDBHandler.indexDbCache.remove(receiveData.dataName)}break;case EV_IndexDBType_default.TILES3D:if(Cesium.defined(tempTerrainPacks)){for(let i=0;i<tempTerrainPacks.length;i++)Cesium.defined(receiveData.data)&&receiveData.success?Cesium.defined(tempTerrainPacks[i])&&Cesium.defined(tempTerrainPacks[i].downloadSuccessFun)&&(tempTerrainPacks[i].meshPrimitives=receiveData.meshPrimitives,tempTerrainPacks[i].downloadSuccessFun(tempTerrainPacks[i],receiveData.data)):Cesium.defined(tempTerrainPacks[i].downloadErrorFun)&&tempTerrainPacks[i].downloadErrorFun(tempTerrainPacks[i]);EV_IndexDBHandler.indexDbCache.remove(receiveData.dataName)}break;case EV_IndexDBType_default.BIN:if(Cesium.defined(tempTerrainPacks)){for(let i=0;i<tempTerrainPacks.length;i++)Cesium.defined(receiveData.data)&&receiveData.success?Cesium.defined(tempTerrainPacks[i])&&Cesium.defined(tempTerrainPacks[i].downloadSuccessFun)&&tempTerrainPacks[i].downloadSuccessFun(receiveData.data):Cesium.defined(tempTerrainPacks[i].downloadErrorFun)&&tempTerrainPacks[i].downloadErrorFun(tempTerrainPacks[i]);EV_IndexDBHandler.indexDbCache.remove(receiveData.dataName)}break;case EV_IndexDBType_default.IMAGE:if(Cesium.defined(tempTerrainPacks)){for(let i=0;i<tempTerrainPacks.length;i++)Cesium.defined(receiveData.data)&&receiveData.success?Cesium.defined(tempTerrainPacks[i])&&Cesium.defined(tempTerrainPacks[i].downloadSuccessFun)&&tempTerrainPacks[i].downloadSuccessFun(tempTerrainPacks[i],receiveData.data):Cesium.defined(tempTerrainPacks[i].downloadErrorFun)&&tempTerrainPacks[i].downloadErrorFun(tempTerrainPacks[i]);EV_IndexDBHandler.indexDbCache.remove(receiveData.dataName)}break;case EV_IndexDBType_default.FILE:if(Cesium.defined(tempTerrainPacks)){for(let i=0;i<tempTerrainPacks.length;i++)Cesium.defined(receiveData.data)&&receiveData.success?Cesium.defined(tempTerrainPacks[i])&&Cesium.defined(tempTerrainPacks[i].downloadSuccessFun)&&tempTerrainPacks[i].downloadSuccessFun(receiveData.data):Cesium.defined(tempTerrainPacks[i].downloadErrorFun)&&tempTerrainPacks[i].downloadErrorFun(tempTerrainPacks[i]);EV_IndexDBHandler.indexDbCache.remove(receiveData.dataName)}break}completeTask(EV_IndexDBHandler._loadTaskProcessor,receiveData.workerTaskID)}}function onSaveMessage(event){let receiveData=event.data;if(Cesium.defined(receiveData.workerType)){let keyName=`save_${receiveData.dataName}`,callbacks=EV_IndexDBHandler.indexDbCache.get(keyName);switch(receiveData.workerType){case EV_IndexDBType_default.TERRAIN:if(callbacks){for(let i=0;i<callbacks.length;i++)callbacks[i]&&callbacks[i]();EV_IndexDBHandler.indexDbCache.remove(keyName)}break;case EV_IndexDBType_default.TILES3D:EV_IndexDBHandler.indexDbCache.remove(keyName);break;case EV_IndexDBType_default.BIN:EV_IndexDBHandler.indexDbCache.remove(keyName);break;case EV_IndexDBType_default.IMAGE:EV_IndexDBHandler.indexDbCache.remove(keyName);break;case EV_IndexDBType_default.FILE:EV_IndexDBHandler.indexDbCache.remove(keyName);break}completeTask(EV_IndexDBHandler._saverTaskProcessor,receiveData.workerTaskID)}}EV_IndexDBHandler.saveCesium3DTile=function(c3DTilePack){if(!Cesium.defined(EV_IndexDBHandler._saverTaskProcessor))return EV_IndexDBHandler._getSaverTaskProcessor(),!1;let keyName=`save_${c3DTilePack.keyName}`;if(EV_IndexDBHandler.indexDbCache.contains(keyName))return EV_IndexDBHandler.indexDbCache.get(keyName).push(c3DTilePack),!0;let promise=EV_IndexDBHandler._saverTaskProcessor.scheduleTask({taskData:{keyName:c3DTilePack.keyName,data:c3DTilePack.data,meshPrimitives:Cesium.defined(c3DTilePack.meshPrimitives)?c3DTilePack.meshPrimitives:[],workerType:EV_IndexDBType_default.TILES3D}});if(Cesium.defined(promise))EV_IndexDBHandler._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(EV_IndexDBHandler._saverTaskProcessor._worker.onmessage=onSaveMessage);else return!1;return!0};EV_IndexDBHandler.loadCesium3DTile=function(c3DTilePack){if(!Cesium.defined(EV_IndexDBHandler._loadTaskProcessor))return EV_IndexDBHandler._getLoadTaskProcessor(),!1;if(EV_IndexDBHandler.indexDbCache.contains(c3DTilePack.keyName))return EV_IndexDBHandler.indexDbCache.get(c3DTilePack.keyName).push(c3DTilePack),!0;let promise=EV_IndexDBHandler._loadTaskProcessor.scheduleTask({taskData:{keyName:c3DTilePack.keyName,data:void 0,workerType:EV_IndexDBType_default.TILES3D}});if(Cesium.defined(promise))EV_IndexDBHandler.indexDbCache.set(c3DTilePack.keyName,[c3DTilePack]),EV_IndexDBHandler._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(EV_IndexDBHandler._loadTaskProcessor._worker.onmessage=onLoadMessage);else return!1;return!0};EV_IndexDBHandler.saveGltfBin=function(cBinPack){if(!Cesium.defined(EV_IndexDBHandler._saverTaskProcessor))return EV_IndexDBHandler._getSaverTaskProcessor(),!1;let keyName=`save_${cBinPack.keyName}`;if(EV_IndexDBHandler.indexDbCache.contains(keyName))return EV_IndexDBHandler.indexDbCache.get(keyName).push(cBinPack),!0;let promise=EV_IndexDBHandler._saverTaskProcessor.scheduleTask({taskData:{keyName:cBinPack.keyName,data:cBinPack.data,workerType:EV_IndexDBType_default.BIN}});if(EV_IndexDBHandler.indexDbCache.set(keyName,[cBinPack]),Cesium.defined(promise))EV_IndexDBHandler._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(EV_IndexDBHandler._saverTaskProcessor._worker.onmessage=onSaveMessage);else return!1;return!0};EV_IndexDBHandler.loadGltfBin=function(cBinPack){if(!Cesium.defined(EV_IndexDBHandler._loadTaskProcessor))return EV_IndexDBHandler._getLoadTaskProcessor(),!1;if(EV_IndexDBHandler.indexDbCache.contains(cBinPack.keyName))return EV_IndexDBHandler.indexDbCache.get(cBinPack.keyName).push(cBinPack),!0;let promise=EV_IndexDBHandler._loadTaskProcessor.scheduleTask({taskData:{keyName:cBinPack.keyName,workerType:EV_IndexDBType_default.BIN,data:void 0}});if(Cesium.defined(promise))EV_IndexDBHandler.indexDbCache.set(cBinPack.keyName,[cBinPack]),this._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(this._loadTaskProcessor._worker.onmessage=onLoadMessage);else return!1;return!0};EV_IndexDBHandler.saveDEM=function(terrainPack){if(!Cesium.defined(EV_IndexDBHandler._saverTaskProcessor))return EV_IndexDBHandler._getSaverTaskProcessor(),!1;let keyName=`save_${terrainPack.keyName}`;if(EV_IndexDBHandler.indexDbCache.contains(keyName))return EV_IndexDBHandler.indexDbCache.get(keyName).push(terrainPack.callbackFun),!0;let promise=EV_IndexDBHandler._saverTaskProcessor.scheduleTask({taskData:{keyName:terrainPack.keyName,level:terrainPack.level,x:terrainPack.x,y:terrainPack.y,data:terrainPack.data,upsample:terrainPack.upsample,workerType:EV_IndexDBType_default.TERRAIN}});if(EV_IndexDBHandler.indexDbCache.set(keyName,[terrainPack.callbackFun]),Cesium.defined(promise))EV_IndexDBHandler._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(EV_IndexDBHandler._saverTaskProcessor._worker.onmessage=onSaveMessage);else return!1;return!0};EV_IndexDBHandler.loadDEM=function(terrainPack){if(!Cesium.defined(EV_IndexDBHandler._loadTaskProcessor))return EV_IndexDBHandler._getLoadTaskProcessor(),!1;if(EV_IndexDBHandler.indexDbCache.contains(terrainPack.keyName))return EV_IndexDBHandler.indexDbCache.get(terrainPack.keyName).push(terrainPack),!1;let promise=EV_IndexDBHandler._loadTaskProcessor.scheduleTask({taskData:{keyName:terrainPack.keyName,workerType:EV_IndexDBType_default.TERRAIN,data:void 0}});if(Cesium.defined(promise))EV_IndexDBHandler.indexDbCache.set(terrainPack.keyName,[terrainPack]),this._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(this._loadTaskProcessor._worker.onmessage=onLoadMessage);else return!1;return!0};EV_IndexDBHandler.saveImagery=function(terrainPack,callback){if(!Cesium.defined(EV_IndexDBHandler._saverTaskProcessor))return EV_IndexDBHandler._getSaverTaskProcessor(),!1;let promise=EV_IndexDBHandler._saverTaskProcessor.scheduleTask({taskData:{keyName:terrainPack.keyName,level:terrainPack.level,x:terrainPack.x,y:terrainPack.y,data:terrainPack.data,upsample:terrainPack.upsample,workerType:EV_IndexDBType_default.IMAGERY}});if(Cesium.defined(promise))EV_IndexDBHandler._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(EV_IndexDBHandler._saverTaskProcessor._worker.onmessage=onSaveMessage);else return!1;return!0};EV_IndexDBHandler.loadImagery=function(terrainPack){if(!Cesium.defined(EV_IndexDBHandler._loadTaskProcessor))return EV_IndexDBHandler._getLoadTaskProcessor(),!1;if(EV_IndexDBHandler.indexDbCache.contains(terrainPack.keyName))return EV_IndexDBHandler.indexDbCache.get(terrainPack.keyName).push(terrainPack),!1;let promise=EV_IndexDBHandler._loadTaskProcessor.scheduleTask({taskData:{keyName:terrainPack.keyName,workerType:EV_IndexDBType_default.IMAGERY,data:void 0}});if(Cesium.defined(promise))EV_IndexDBHandler.indexDbCache.set(terrainPack.keyName,[terrainPack]),this._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(this._loadTaskProcessor._worker.onmessage=onLoadMessage);else return!1;return!0};EV_IndexDBHandler.saveFile=function(cTextPack){if(!Cesium.defined(EV_IndexDBHandler._saverTaskProcessor))return EV_IndexDBHandler._getSaverTaskProcessor(),!1;let keyName=`save_${cTextPack.keyName}`;if(EV_IndexDBHandler.indexDbCache.contains(keyName))return EV_IndexDBHandler.indexDbCache.get(keyName).push(cTextPack),!0;let promise=EV_IndexDBHandler._saverTaskProcessor.scheduleTask({taskData:{keyName:cTextPack.keyName,data:cTextPack.data,workerType:EV_IndexDBType_default.FILE}});if(EV_IndexDBHandler.indexDbCache.set(keyName,[cTextPack]),Cesium.defined(promise))EV_IndexDBHandler._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(EV_IndexDBHandler._saverTaskProcessor._worker.onmessage=onSaveMessage);else return!1;return!0};EV_IndexDBHandler.loadFile=function(cTextPack){if(!Cesium.defined(EV_IndexDBHandler._loadTaskProcessor))return EV_IndexDBHandler._getLoadTaskProcessor(),!1;if(EV_IndexDBHandler.indexDbCache.contains(cTextPack.keyName))return EV_IndexDBHandler.indexDbCache.get(cTextPack.keyName).push(cTextPack),!0;let promise=EV_IndexDBHandler._loadTaskProcessor.scheduleTask({taskData:{keyName:cTextPack.keyName,workerType:EV_IndexDBType_default.FILE,data:void 0}});if(Cesium.defined(promise))EV_IndexDBHandler.indexDbCache.set(cTextPack.keyName,[cTextPack]),this._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(this._loadTaskProcessor._worker.onmessage=onLoadMessage);else return!1;return!0};EV_IndexDBHandler.saveImage=function(texturePack){if(!Cesium.defined(EV_IndexDBHandler._saverTaskProcessor))return EV_IndexDBHandler._getSaverTaskProcessor(),!1;let keyName=`save_${texturePack.keyName}`;if(EV_IndexDBHandler.indexDbCache.contains(keyName))return EV_IndexDBHandler.indexDbCache.get(keyName).push(texturePack),!0;let promise=EV_IndexDBHandler._saverTaskProcessor.scheduleTask({taskData:{keyName:texturePack.keyName,data:texturePack.data,workerType:EV_IndexDBType_default.IMAGE}});if(EV_IndexDBHandler.indexDbCache.set(keyName,[texturePack]),Cesium.defined(promise))EV_IndexDBHandler._saverTaskProcessor._worker.onmessage.name!=="onSaveMessage"&&(EV_IndexDBHandler._saverTaskProcessor._worker.onmessage=onSaveMessage);else return!1;return!0};EV_IndexDBHandler.loadImage=function(texturePack){if(!Cesium.defined(EV_IndexDBHandler._loadTaskProcessor))return EV_IndexDBHandler._getLoadTaskProcessor(),!1;if(EV_IndexDBHandler.indexDbCache.contains(texturePack.keyName))return EV_IndexDBHandler.indexDbCache.get(texturePack.keyName).push(texturePack),!0;let promise=EV_IndexDBHandler._loadTaskProcessor.scheduleTask({taskData:{keyName:texturePack.keyName,workerType:EV_IndexDBType_default.IMAGE,data:void 0}});if(Cesium.defined(promise))EV_IndexDBHandler.indexDbCache.set(texturePack.keyName,[texturePack]),this._loadTaskProcessor._worker.onmessage.name!=="onLoadMessage"&&(this._loadTaskProcessor._worker.onmessage=onLoadMessage);else return!1;return!0};function completeTask(taskProcessor,taskId){if(--taskProcessor._activeTasks,!Cesium.defined(taskId))return;let deferreds=taskProcessor._deferreds,deferred=deferreds[taskId];Cesium.defined(deferred)&&delete deferreds[taskId]}var EV_IndexDBHandler_default=EV_IndexDBHandler;var boundingSphereCartesian3Scratch=new Cesium.Cartesian3,ModelState=ModelUtility_default.ModelState,defaultModelAccept="model/gltf-binary,model/gltf+json;q=0.8,application/json;q=0.2,*/*;q=0.01",articulationEpsilon=Cesium.Math.EPSILON16;function setCachedGltf(model,cachedGltf){model._cachedGltf=cachedGltf}function CachedGltf(options){this._gltf=options.gltf,this.ready=options.ready,this.modelsToLoad=[],this.count=0}Object.defineProperties(CachedGltf.prototype,{gltf:{set:function(value){this._gltf=value},get:function(){return this._gltf}}});CachedGltf.prototype.makeReady=function(gltfJson){this.gltf=gltfJson;for(var models=this.modelsToLoad,length3=models.length,i=0;i<length3;++i){var m=models[i];m.isDestroyed()||setCachedGltf(m,this)}this.modelsToLoad=void 0,this.ready=!0};var gltfCache={},uriToGuid={};function Model(options){options=Cesium.defaultValue(options,Cesium.defaultValue.EMPTY_OBJECT);var cacheKey=options.cacheKey;this._cacheKey=cacheKey,this._cachedGltf=void 0,this._releaseGltfJson=Cesium.defaultValue(options.releaseGltfJson,!1);var cachedGltf;if(Cesium.defined(cacheKey)&&Cesium.defined(gltfCache[cacheKey])&&gltfCache[cacheKey].ready)cachedGltf=gltfCache[cacheKey],++cachedGltf.count;else{var gltf=options.gltf;if(Cesium.defined(gltf)){if(gltf instanceof ArrayBuffer&&(gltf=new Uint8Array(gltf)),gltf instanceof Uint8Array){var parsedGltf=Cesium.parseGlb(gltf);Cesium.defined(options.imagesSourceBuf)&&(parsedGltf=addTextureByGltf(parsedGltf,options.imagesSourceBuf)),cachedGltf=new CachedGltf({gltf:parsedGltf,ready:!0})}else cachedGltf=new CachedGltf({gltf:options.gltf,ready:!0});cachedGltf.count=1,Cesium.defined(cacheKey)&&(gltfCache[cacheKey]=cachedGltf)}}setCachedGltf(this,cachedGltf);var basePath=Cesium.defaultValue(options.basePath,"");this._resource=Cesium.Resource.createIfNeeded(basePath);var credit=options.credit;typeof credit=="string"&&(credit=new Cesium.Credit(credit)),this._credit=credit,this._resourceCredits=[],this.show=Cesium.defaultValue(options.show,!0),this.silhouetteColor=Cesium.defaultValue(options.silhouetteColor,Cesium.Color.RED),this._silhouetteColor=new Cesium.Color,this._silhouetteColorPreviousAlpha=1,this._normalAttributeName=void 0,this.silhouetteSize=Cesium.defaultValue(options.silhouetteSize,0),this.modelMatrix=Cesium.Matrix4.clone(Cesium.defaultValue(options.modelMatrix,Cesium.Matrix4.IDENTITY)),this._modelMatrix=Cesium.Matrix4.clone(this.modelMatrix),this._clampedModelMatrix=void 0,this.scale=Cesium.defaultValue(options.scale,1),this._scale=this.scale,this.minimumPixelSize=Cesium.defaultValue(options.minimumPixelSize,0),this._minimumPixelSize=this.minimumPixelSize,this.maximumScale=options.maximumScale,this._maximumScale=this.maximumScale,this.id=options.id,this._id=options.id,this.heightReference=Cesium.defaultValue(options.heightReference,Cesium.HeightReference.NONE),this._heightReference=this.heightReference,this._heightChanged=!1,this._removeUpdateHeightCallback=void 0;var scene=options.scene;this._scene=scene,Cesium.defined(scene)&&Cesium.defined(scene.terrainProviderChanged)&&(this._terrainProviderChangedCallback=scene.terrainProviderChanged.addEventListener(function(){this._heightChanged=!0},this)),this._pickObject=options.pickObject,this._allowPicking=Cesium.defaultValue(options.allowPicking,!0),this._ready=!1,this._readyPromise=when_default.defer(),this.activeAnimations=new Cesium.ModelAnimationCollection(this),this.clampAnimations=Cesium.defaultValue(options.clampAnimations,!0),this._defaultTexture=void 0,this._incrementallyLoadTextures=Cesium.defaultValue(options.incrementallyLoadTextures,!0),this._asynchronous=Cesium.defaultValue(options.asynchronous,!0),this.shadows=Cesium.defaultValue(options.shadows,Cesium.ShadowMode.ENABLED),this._shadows=this.shadows,this.color=Cesium.Color.clone(Cesium.defaultValue(options.color,Cesium.Color.WHITE)),this._colorPreviousAlpha=1,this.colorBlendMode=Cesium.defaultValue(options.colorBlendMode,Cesium.ColorBlendMode.HIGHLIGHT),this.colorBlendAmount=Cesium.defaultValue(options.colorBlendAmount,.5),this._colorShadingEnabled=!1,this._clippingPlanes=void 0,this.clippingPlanes=options.clippingPlanes,this._clippingPlanesState=0,this.clippingPlanesOriginMatrix=void 0,this.debugShowBoundingVolume=Cesium.defaultValue(options.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Cesium.defaultValue(options.debugWireframe,!1),this._debugWireframe=!1,this._distanceDisplayCondition=options.distanceDisplayCondition,this._addBatchIdToGeneratedShaders=options.addBatchIdToGeneratedShaders,this._precreatedAttributes=options.precreatedAttributes,this._vertexShaderLoaded=options.vertexShaderLoaded,this._fragmentShaderLoaded=options.fragmentShaderLoaded,this._uniformMapLoaded=options.uniformMapLoaded,this._pickIdLoaded=options.pickIdLoaded,this._ignoreCommands=Cesium.defaultValue(options.ignoreCommands,!1),this._requestType=options.requestType,this._upAxis=Cesium.defaultValue(options.upAxis,Cesium.Axis.Y),this._gltfForwardAxis=Cesium.Axis.Z,this._forwardAxis=options.forwardAxis,this._gradual=options.gradual,this._update=!1,this.cull=Cesium.defaultValue(options.cull,!0),this.opaquePass=Cesium.defaultValue(options.opaquePass,Cesium.Pass.OPAQUE),this._computedModelMatrix=new Cesium.Matrix4,this._clippingPlaneModelViewMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new Cesium.BoundingSphere,this._state=ModelState.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._perNodeShowDirty=!1,this._cesiumAnimationsDirty=!1,this._dirty=!1,this._maxDirtyNumber=0,this._runtime={animations:void 0,articulationsByName:void 0,articulationsByStageKey:void 0,stagesByKey:void 0,rootNodes:void 0,nodes:void 0,nodesByName:void 0,skinnedNodes:void 0,meshesByName:void 0,materialsByName:void 0,materialsById:void 0},this._uniformMaps={},this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms={},this._programPrimitives={},this._rendererResources={buffers:{},vertexArrays:{},programs:{},sourceShaders:{},silhouettePrograms:{},textures:{},samplers:{},renderStates:{}},this._cachedRendererResources=void 0,this._loadRendererResourcesFromCache=!1,this._dequantizeInShader=Cesium.defaultValue(options.dequantizeInShader,!0),this._decodedData={},this._cachedGeometryByteLength=0,this._cachedTexturesByteLength=0,this._geometryByteLength=0,this._texturesByteLength=0,this._trianglesLength=0,this._sourceTechniques={},this._sourcePrograms={},this._quantizedVertexShaders={},this._nodeCommands=[],this._pickIds=[],this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0,this._sourceVersion=void 0,this._sourceKHRTechniquesWebGL=void 0,this._imageBasedLightingFactor=new Cesium.Cartesian2(1,1),Cesium.Cartesian2.clone(options.imageBasedLightingFactor,this._imageBasedLightingFactor),this._lightColor=Cesium.Cartesian3.clone(options.lightColor),this._luminanceAtZenith=void 0,this.luminanceAtZenith=Cesium.defaultValue(options.luminanceAtZenith,.2),this._sphericalHarmonicCoefficients=options.sphericalHarmonicCoefficients,this._specularEnvironmentMaps=options.specularEnvironmentMaps,this._shouldUpdateSpecularMapAtlas=!0,this._specularEnvironmentMapAtlas=void 0,this._useDefaultSphericalHarmonics=!1,this._useDefaultSpecularMaps=!1,this._shouldRegenerateShaders=!1,this._enableFog=!1,this.meshPrimitives=[],Cesium.defined(options.sharedResources)?(this.childrenTilesetUri=options.sharedResources.ktxs.name,this.ktxs=options.sharedResources.ktxs,this.instancedPrograms=options.sharedResources.instancedPrograms.shadredData):(this.childrenTilesetUri="",this.ktxs={},this.instancedPrograms={}),this.content=Cesium.defaultValue(options.content,void 0),this.ev_E3MInternalInstance=Cesium.defined(this.content)?new EV_E3MInternalInstance_default({model:this}):void 0,this.modelSpecular=Cesium.defaultValue(options.specular,.5),this.rollerRegion=Cesium.defaultValue(options.rollerRegion,new Cesium.Cartesian4(0,0,1,1)),this._update=!1}Object.defineProperties(Model.prototype,{gltf:{get:function(){return Cesium.defined(this._cachedGltf)?this._cachedGltf.gltf:void 0}},gltfInternal:{get:function(){return this.gltf}},releaseGltfJson:{get:function(){return this._releaseGltfJson}},cacheKey:{get:function(){return this._cacheKey}},basePath:{get:function(){return this._resource.url}},boundingSphere:{get:function(){var modelMatrix=this.modelMatrix;this.heightReference!==Cesium.HeightReference.NONE&&this._clampedModelMatrix&&(modelMatrix=this._clampedModelMatrix);var nonUniformScale=Cesium.Matrix4.getScale(modelMatrix,boundingSphereCartesian3Scratch),scale4=Cesium.defined(this.maximumScale)?Math.min(this.maximumScale,this.scale):this.scale;Cesium.Cartesian3.multiplyByScalar(nonUniformScale,scale4,nonUniformScale);var scaledBoundingSphere=this._scaledBoundingSphere;return scaledBoundingSphere.center=Cesium.Cartesian3.multiplyComponents(this._boundingSphere.center,nonUniformScale,scaledBoundingSphere.center),scaledBoundingSphere.radius=Cesium.Cartesian3.maximumComponent(nonUniformScale)*this._initialRadius,Cesium.defined(this._rtcCenter)&&Cesium.Cartesian3.add(this._rtcCenter,scaledBoundingSphere.center,scaledBoundingSphere.center),scaledBoundingSphere}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},asynchronous:{get:function(){return this._asynchronous}},allowPicking:{get:function(){return this._allowPicking}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},pendingTextureLoads:{get:function(){return Cesium.defined(this._loadResources)?this._loadResources.pendingTextureLoads:0}},dirty:{get:function(){return this._dirty}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(value){this._distanceDisplayCondition=Cesium.DistanceDisplayCondition.clone(value,this._distanceDisplayCondition)}},extensionsUsed:{get:function(){return Cesium.defined(this._extensionsUsed)||(this._extensionsUsed=ModelUtility_default.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return Cesium.defined(this._extensionsRequired)||(this._extensionsRequired=ModelUtility_default.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},forwardAxis:{get:function(){return Cesium.defined(this._forwardAxis)?this._forwardAxis:this._gltfForwardAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return this._texturesByteLength}},cachedGeometryByteLength:{get:function(){return this._cachedGeometryByteLength}},cachedTexturesByteLength:{get:function(){return this._cachedTexturesByteLength}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(value){value!==this._clippingPlanes&&Cesium.ClippingPlaneCollection.setOwner(value,this,"_clippingPlanes")}},pickIds:{get:function(){return this._pickIds}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(value){var imageBasedLightingFactor=this._imageBasedLightingFactor;value===imageBasedLightingFactor||Cesium.Cartesian2.equals(value,imageBasedLightingFactor)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._imageBasedLightingFactor.x>0&&value.x===0||this._imageBasedLightingFactor.x===0&&value.x>0,this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._imageBasedLightingFactor.y>0&&value.y===0||this._imageBasedLightingFactor.y===0&&value.y>0,Cesium.Cartesian2.clone(value,this._imageBasedLightingFactor))}},lightColor:{get:function(){return this._lightColor},set:function(value){var lightColor=this._lightColor;value===lightColor||Cesium.Cartesian3.equals(value,lightColor)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Cesium.defined(lightColor)&&!Cesium.defined(value)||Cesium.defined(value)&&!Cesium.defined(lightColor),this._lightColor=Cesium.Cartesian3.clone(value,lightColor))}},luminanceAtZenith:{get:function(){return this._luminanceAtZenith},set:function(value){var lum=this._luminanceAtZenith;value!==lum&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Cesium.defined(lum)&&!Cesium.defined(value)||Cesium.defined(value)&&!Cesium.defined(lum),this._luminanceAtZenith=value)}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients},set:function(value){value!==this._sphericalHarmonicCoefficients&&(this._sphericalHarmonicCoefficients=value,this._shouldRegenerateShaders=!0)}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps},set:function(value){this._shouldUpdateSpecularMapAtlas=this._shouldUpdateSpecularMapAtlas||value!==this._specularEnvironmentMaps,this._specularEnvironmentMaps=value}},credit:{get:function(){return this._credit}}});function silhouetteSupported(context){return context.stencilBuffer}function isColorShadingEnabled2(model){return!Cesium.Color.equals(model.color,Cesium.Color.WHITE)||model.colorBlendMode!==Cesium.ColorBlendMode.HIGHLIGHT}function isClippingEnabled2(model){var clippingPlanes=model._clippingPlanes;return Cesium.defined(clippingPlanes)&&clippingPlanes.enabled&&clippingPlanes.length!==0}Model.silhouetteSupported=function(scene){return silhouetteSupported(scene.context)};function containsGltfMagic(uint8Array){var magic=Cesium.getMagic(uint8Array);return magic==="glTF"}Model.fromGltf=function(options){var url=options.url;options=Cesium.clone(options);var modelResource=Cesium.Resource.createIfNeeded(url),basePath=Cesium.defaultValue(options.basePath,modelResource.clone()),resource2=Cesium.Resource.createIfNeeded(basePath),cacheKey=Cesium.defaultValue(options.cacheKey,uriToGuid[Cesium.getAbsoluteUri(modelResource.url)]);Cesium.defined(cacheKey)||(cacheKey=Cesium.createGuid(),uriToGuid[Cesium.getAbsoluteUri(modelResource.url)]=cacheKey),Cesium.defined(options.basePath)&&!Cesium.defined(options.cacheKey)&&(cacheKey+=resource2.url),options.cacheKey=cacheKey,options.basePath=resource2;var model=new Model(options),cachedGltf=gltfCache[cacheKey];return Cesium.defined(cachedGltf)?cachedGltf.ready||(++cachedGltf.count,cachedGltf.modelsToLoad.push(model)):(cachedGltf=new CachedGltf({ready:!1}),cachedGltf.count=1,cachedGltf.modelsToLoad.push(model),setCachedGltf(model,cachedGltf),gltfCache[cacheKey]=cachedGltf,Cesium.defined(modelResource.headers.Accept)||(modelResource.headers.Accept=defaultModelAccept),modelResource.fetchArrayBuffer().then(function(arrayBuffer){var array=new Uint8Array(arrayBuffer);if(containsGltfMagic(array)){var parsedGltf=Cesium.parseGlb(array);cachedGltf.makeReady(parsedGltf)}else{var json=Cesium.getStringFromTypedArray(array);cachedGltf.makeReady(JSON.parse(json))}var resourceCredits=model._resourceCredits,credits=modelResource.credits;if(Cesium.defined(credits))for(var length3=credits.length,i=0;i<length3;i++)resourceCredits.push(credits[i])}).catch(ModelUtility_default.getFailedLoadFunction(model,"model",modelResource.url))),model};Model._gltfCache=gltfCache;function getRuntime(model,runtimeName,name){return model._runtime[runtimeName][name]}Model.prototype.getNode=function(name){var node=getRuntime(this,"nodesByName",name);return Cesium.defined(node)?node.publicNode:void 0};Model.prototype.getMesh=function(name){return getRuntime(this,"meshesByName",name)};Model.prototype.getMaterial=function(name){return getRuntime(this,"materialsByName",name)};Model.prototype.setArticulationStage=function(articulationStageKey,value){var stage=getRuntime(this,"stagesByKey",articulationStageKey),articulation=getRuntime(this,"articulationsByStageKey",articulationStageKey);Cesium.defined(stage)&&Cesium.defined(articulation)&&(value=Cesium.Math.clamp(value,stage.minimumValue,stage.maximumValue),Cesium.Math.equalsEpsilon(stage.currentValue,value,articulationEpsilon)||(stage.currentValue=value,articulation.isDirty=!0))};var scratchArticulationCartesian=new Cesium.Cartesian3,scratchArticulationRotation=new Cesium.Matrix3;function applyArticulationStageMatrix(stage,result){var value=stage.currentValue,cartesian2=scratchArticulationCartesian,rotation2;switch(stage.type){case"xRotate":rotation2=Cesium.Matrix3.fromRotationX(Cesium.Math.toRadians(value),scratchArticulationRotation),Cesium.Matrix4.multiplyByMatrix3(result,rotation2,result);break;case"yRotate":rotation2=Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(value),scratchArticulationRotation),Cesium.Matrix4.multiplyByMatrix3(result,rotation2,result);break;case"zRotate":rotation2=Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(value),scratchArticulationRotation),Cesium.Matrix4.multiplyByMatrix3(result,rotation2,result);break;case"xTranslate":cartesian2.x=value,cartesian2.y=0,cartesian2.z=0,Cesium.Matrix4.multiplyByTranslation(result,cartesian2,result);break;case"yTranslate":cartesian2.x=0,cartesian2.y=value,cartesian2.z=0,Cesium.Matrix4.multiplyByTranslation(result,cartesian2,result);break;case"zTranslate":cartesian2.x=0,cartesian2.y=0,cartesian2.z=value,Cesium.Matrix4.multiplyByTranslation(result,cartesian2,result);break;case"xScale":cartesian2.x=value,cartesian2.y=1,cartesian2.z=1,Cesium.Matrix4.multiplyByScale(result,cartesian2,result);break;case"yScale":cartesian2.x=1,cartesian2.y=value,cartesian2.z=1,Cesium.Matrix4.multiplyByScale(result,cartesian2,result);break;case"zScale":cartesian2.x=1,cartesian2.y=1,cartesian2.z=value,Cesium.Matrix4.multiplyByScale(result,cartesian2,result);break;case"uniformScale":Cesium.Matrix4.multiplyByUniformScale(result,value,result);break;default:break}return result}var scratchApplyArticulationTransform=new Cesium.Matrix4;Model.prototype.applyArticulations=function(){var articulationsByName=this._runtime.articulationsByName;for(var articulationName in articulationsByName)if(articulationsByName.hasOwnProperty(articulationName)){var articulation=articulationsByName[articulationName];if(articulation.isDirty){articulation.isDirty=!1;for(var numNodes=articulation.nodes.length,n=0;n<numNodes;++n){for(var node=articulation.nodes[n],transform3=Cesium.Matrix4.clone(node.originalMatrix,scratchApplyArticulationTransform),numStages=articulation.stages.length,s=0;s<numStages;++s){var stage=articulation.stages[s];transform3=applyArticulationStageMatrix(stage,transform3)}node.matrix=transform3}}}};function addBuffersToLoadResources(model){var gltf=model.gltf,loadResources=model._loadResources;Cesium.ForEach.buffer(gltf,function(buffer3,id){loadResources.buffers[id]=buffer3.extras._pipeline.source})}function bufferLoad(model,id){return function(arrayBuffer){var loadResources=model._loadResources,buffer3=new Uint8Array(arrayBuffer);--loadResources.pendingBufferLoads,model.gltf.buffers[id].extras._pipeline.source=buffer3}}function parseBufferViews(model){var bufferViews=model.gltf.bufferViews,vertexBuffersToCreate=model._loadResources.vertexBuffersToCreate;Cesium.ForEach.bufferView(model.gltf,function(bufferView,id){bufferView.target===Cesium.WebGLConstants.ARRAY_BUFFER&&vertexBuffersToCreate.enqueue(id)});var indexBuffersToCreate=model._loadResources.indexBuffersToCreate,indexBufferIds={};Cesium.ForEach.accessor(model.gltf,function(accessor){var bufferViewId=accessor.bufferView;if(!!Cesium.defined(bufferViewId)){var bufferView=bufferViews[bufferViewId];bufferView.target===Cesium.WebGLConstants.ELEMENT_ARRAY_BUFFER&&!Cesium.defined(indexBufferIds[bufferViewId])&&(indexBufferIds[bufferViewId]=!0,indexBuffersToCreate.enqueue({id:bufferViewId,componentType:accessor.componentType}))}})}function parseTechniques(model){var gltf=model.gltf;if(!!hasExtension_default(gltf,"KHR_techniques_webgl")){var sourcePrograms=model._sourcePrograms,sourceTechniques=model._sourceTechniques,programs=gltf.extensions.KHR_techniques_webgl.programs;Cesium.ForEach.technique(gltf,function(technique,techniqueId){sourceTechniques[techniqueId]=Cesium.clone(technique);var programId=technique.program;Cesium.defined(sourcePrograms[programId])||(sourcePrograms[programId]=Cesium.clone(programs[programId]))})}}function shaderLoad(model,type,id,uri){return function(source){var gltfShader=model.gltfShader,loadResources=model._loadResources;loadResources.shaders[id]={source,type,bufferView:void 0},--loadResources.pendingShaderLoads,model._rendererResources.sourceShaders[id]=source,model.useIndexedDBCache&&EV_IndexDBHandler_default.saveFile({keyName:uri,data:source})}}function loadShader(model,type,id,source){var loadResources=model._loadResources;source=source.replace("material.shininess = 1.0;","material.shininess = 2.0;"),loadResources.shaders[id]={source,type,bufferView:void 0},--loadResources.pendingShaderLoads,model._rendererResources.sourceShaders[id]=source}function parseShaders(model){var gltf=model.gltf,buffers=gltf.buffers,bufferViews=gltf.bufferViews,sourceShaders=model._rendererResources.sourceShaders;Cesium.ForEach.shader(gltf,function(shader,id){if(Cesium.defined(shader.bufferView)){var bufferViewId=shader.bufferView,bufferView=bufferViews[bufferViewId],bufferId=bufferView.buffer,buffer3=buffers[bufferId],source=Cesium.getStringFromTypedArray(buffer3.extras._pipeline.source,bufferView.byteOffset,bufferView.byteLength);sourceShaders[id]=source}else if(Cesium.defined(shader.extras._pipeline.source))sourceShaders[id]=shader.extras._pipeline.source;else{++model._loadResources.pendingShaderLoads;var uri=model._resource._url.substring(0,model._resource._url.lastIndexOf("/")+1)+shader.uri;if(model.useIndexedDBCache)requestGLSLByIndexedDB(model,shader,id);else{var shaderResource=model._resource.getDerivedResource({url:shader.uri,queryParameters:model._resource.queryParameters}),promise=shaderResource.fetchText();Cesium.defined(model.gltfShader)&&(model.gltfShader[uri]=promise),promise.then(shaderLoad(model,shader.type,id,shaderResource._url)).catch(ModelUtility_default.getFailedLoadFunction(model,"shader",shaderResource.url))}}})}function parsePrograms(model){var sourceTechniques=model._sourceTechniques;for(var techniqueId in sourceTechniques)if(sourceTechniques.hasOwnProperty(techniqueId)){var technique=sourceTechniques[techniqueId];model._loadResources.programsToCreate.enqueue({programId:technique.program,techniqueId})}}function requestGLSLByIndexedDB(model,shader,id){function downloadSuccessFormIdbCallback2(source){loadShader(model,shader.type,id,source)}function downloadErrorFormIdbCallback2(){var shaderResource=model._resource.getDerivedResource({url:shader.uri,queryParameters:model._resource.queryParameters}),promise=shaderResource.fetchText();promise.then(shaderLoad(model,shader.type,id,shaderResource._url)).catch(ModelUtility_default.getFailedLoadFunction(model,"shader",shaderResource.url))}var uri=model._resource._url.substring(0,model._resource._url.lastIndexOf("/")+1)+shader.uri,shaderData={keyName:uri,downloadSuccessFun:downloadSuccessFormIdbCallback2,downloadErrorFun:downloadErrorFormIdbCallback2};EV_IndexDBHandler_default.loadFile(shaderData)||downloadErrorFormIdbCallback2()}function parseArticulations(model){var articulationsByName={},articulationsByStageKey={},runtimeStagesByKey={};model._runtime.articulationsByName=articulationsByName,model._runtime.articulationsByStageKey=articulationsByStageKey,model._runtime.stagesByKey=runtimeStagesByKey;var gltf=model.gltf;if(!(!hasExtension_default(gltf,"AGI_articulations")||!Cesium.defined(gltf.extensions)||!Cesium.defined(gltf.extensions.AGI_articulations))){var gltfArticulations=gltf.extensions.AGI_articulations.articulations;if(!!Cesium.defined(gltfArticulations))for(var numArticulations=gltfArticulations.length,i=0;i<numArticulations;++i){var articulation=Cesium.clone(gltfArticulations[i]);articulation.nodes=[],articulation.isDirty=!0,articulationsByName[articulation.name]=articulation;for(var numStages=articulation.stages.length,s=0;s<numStages;++s){var stage=articulation.stages[s];stage.currentValue=stage.initialValue;var stageKey=articulation.name+" "+stage.name;articulationsByStageKey[stageKey]=articulation,runtimeStagesByKey[stageKey]=stage}}}}function imageLoadAndSaveIDB(model,textureId,uri,dataInfo){return function(image){dataInfo.data=image,image.constructor.name!="HTMLImageElement"&&EV_IndexDBHandler_default.saveImage(dataInfo);var loadResources=model._loadResources;--loadResources.pendingTextureLoads,loadResources.texturesToCreate.enqueue({id:textureId,image,bufferView:image.bufferView,width:image.width,height:image.height,internalFormat:image.internalFormat})}}function imageLoad(model,textureId,uri){return function(image){Cesium.defined(uri)&&Cesium.defined(model.ktxs)&&(Cesium.defined(model.ktxs[uri])&&typeof model.ktxs[uri].then=="function"||!Cesium.defined(model.ktxs[uri]))&&(model.ktxs[uri]=image);var loadResources=model._loadResources;--loadResources.pendingTextureLoads;let mipLevels;Array.isArray(image)&&(mipLevels=image.slice(1,image.length).map(function(mipLevel){return mipLevel.bufferView}),image=image[0]),loadResources.texturesToCreate.enqueue({id:textureId,image,bufferView:image.bufferView,width:image.width,height:image.height,internalFormat:image.internalFormat})}}function loadImage(model,textureId,image){var loadResources=model._loadResources;--loadResources.pendingTextureLoads,loadResources.texturesToCreate.enqueue({id:textureId,image,bufferView:image.bufferView,width:image.width,height:image.height,internalFormat:image.internalFormat})}var ktxRegex=/(^data:image\/ktx)|(data:image\/ktx)|(\.ktx$)|(\.ktx.gz$)/i,crnRegex=/(^data:image\/crn)|(\.crn$)/i,etcRegex=/(^data:image\/pkm)|(\.pkm$)|(\.pkm.gz$)/i;function parseTextures(model,context,supportsWebP2){if(model.useIndexedDBCache){parseTexturesFromIndexedDB(model,context,supportsWebP2);return}var gltf=model.gltf,images=gltf.images,uri;Cesium.ForEach.texture(gltf,function(texture,id){var imageId=texture.source;Cesium.defined(texture.extensions)&&Cesium.defined(texture.extensions.EXT_texture_webp)&&supportsWebP2&&(imageId=texture.extensions.EXT_texture_webp.source);var gltfImage=images[imageId],extras=gltfImage.extras,bufferViewId=gltfImage.bufferView,mimeType=gltfImage.mimeType;if(uri=gltfImage.uri,Cesium.defined(extras)&&Cesium.defined(extras.compressedImage3DTiles)){var crunch=extras.compressedImage3DTiles.crunch,s3tc=extras.compressedImage3DTiles.s3tc,pvrtc=extras.compressedImage3DTiles.pvrtc1,etc1=extras.compressedImage3DTiles.etc1;context.s3tc&&Cesium.defined(crunch)?(mimeType=crunch.mimeType,Cesium.defined(crunch.bufferView)?bufferViewId=crunch.bufferView:uri=crunch.uri):context.s3tc&&Cesium.defined(s3tc)?(mimeType=s3tc.mimeType,Cesium.defined(s3tc.bufferView)?bufferViewId=s3tc.bufferView:uri=s3tc.uri):context.pvrtc&&Cesium.defined(pvrtc)?(mimeType=pvrtc.mimeType,Cesium.defined(pvrtc.bufferView)?bufferViewId=pvrtc.bufferView:uri=pvrtc.uri):context.etc1&&Cesium.defined(etc1)&&(mimeType=etc1.mimeType,Cesium.defined(etc1.bufferView)?bufferViewId=etc1.bufferView:uri=etc1.uri)}if(Cesium.defined(bufferViewId))model._loadResources.texturesToCreateFromBufferView.enqueue({id,image:void 0,bufferView:bufferViewId,mimeType});else{++model._loadResources.pendingTextureLoads;var imageResource=model._resource.getDerivedResource({url:uri}),ktxs=model.ktxs;if(Cesium.defined(ktxs)&&uri.indexOf("data:image/")===-1){var ktx=ktxs[imageResource._url];if(Cesium.defined(ktx))typeof ktx.then=="function"?ktx.then(imageLoad(model,id,imageResource._url)).catch(ModelUtility_default.getFailedLoadFunction(model,"image",imageResource.url)):(Cesium.defined(ktx.arrayBufferView)&&delete ktx.arrayBufferView,loadImage(model,id,ktx));else{var promise;ktxRegex.test(uri)?promise=loadKTX_default(imageResource):crnRegex.test(uri)?promise=loadCRN_default(imageResource):etcRegex.test(uri)?promise=Cesium.EV_LoadETC(imageResource):promise=imageResource.fetchImage(),ktxs[imageResource._url]=promise,promise.then(imageLoad(model,id,imageResource._url)).catch(ModelUtility_default.getFailedLoadFunction(model,"image",imageResource.url))}}else{var promise;ktxRegex.test(uri)?promise=loadKTX_default(imageResource):crnRegex.test(uri)?promise=loadCRN_default(imageResource):promise=imageResource.fetchImage(),promise.then(imageLoad(model,id)).catch(ModelUtility_default.getFailedLoadFunction(model,"image",imageResource.url))}}})}function parseTexturesFromIndexedDB(model,context,supportsWebP2){var gltf=model.gltf,images=gltf.images,tilesetUri=model.childrenTilesetUri,uri;Cesium.ForEach.texture(gltf,function(texture,id){var imageId=texture.source;Cesium.defined(texture.extensions)&&Cesium.defined(texture.extensions.EXT_texture_webp)&&supportsWebP2&&(imageId=texture.extensions.EXT_texture_webp.source);var gltfImage=images[imageId];if(!!Cesium.defined(gltfImage)){var extras=gltfImage.extras,bufferViewId=gltfImage.bufferView,mimeType=gltfImage.mimeType;if(uri=gltfImage.uri,Cesium.defined(extras)&&Cesium.defined(extras.compressedImage3DTiles)){var crunch=extras.compressedImage3DTiles.crunch,s3tc=extras.compressedImage3DTiles.s3tc,pvrtc=extras.compressedImage3DTiles.pvrtc1,etc1=extras.compressedImage3DTiles.etc1;context.s3tc&&Cesium.defined(crunch)?(mimeType=crunch.mimeType,Cesium.defined(crunch.bufferView)?bufferViewId=crunch.bufferView:uri=crunch.uri):context.s3tc&&Cesium.defined(s3tc)?(mimeType=s3tc.mimeType,Cesium.defined(s3tc.bufferView)?bufferViewId=s3tc.bufferView:uri=s3tc.uri):context.pvrtc&&Cesium.defined(pvrtc)?(mimeType=pvrtc.mimeType,Cesium.defined(pvrtc.bufferView)?bufferViewId=pvrtc.bufferView:uri=pvrtc.uri):context.etc1&&Cesium.defined(etc1)&&(mimeType=etc1.mimeType,Cesium.defined(etc1.bufferView)?bufferViewId=etc1.bufferView:uri=etc1.uri)}if(Cesium.defined(bufferViewId))model._loadResources.texturesToCreateFromBufferView.enqueue({id,image:void 0,bufferView:bufferViewId,mimeType});else{++model._loadResources.pendingTextureLoads;var imageResource=model._resource.getDerivedResource({url:uri});if(model.useIndexedDBCache&&uri.indexOf("data:image/")===-1){var textureData={keyName:imageResource._url,model,imageResource,uri,id,data:void 0,downloadSuccessFun:downloadTextureSuccessFormIdbCallback,downloadErrorFun:downloadTextureErrorFormIdbCallback};EV_IndexDBHandler_default.loadImage(textureData)}else{var promise;ktxRegex.test(uri)?promise=loadKTX_default(imageResource):crnRegex.test(uri)?promise=loadCRN_default(imageResource):etcRegex.test(uri)?promise=Cesium.EV_LoadETC(imageResource):promise=imageResource.fetchImage(),promise.then(imageLoad(model,id)).catch(ModelUtility_default.getFailedLoadFunction(model,"image",imageResource.url))}}}})}function downloadTextureErrorFormIdbCallback(dataInfo){if(Cesium.defined(dataInfo)){var model=dataInfo.model,imageResource=dataInfo.imageResource,url=dataInfo.keyName,id=dataInfo.id,promise;ktxRegex.test(url)?promise=loadKTX_default(imageResource):crnRegex.test(url)?promise=loadCRN_default(imageResource):etcRegex.test(url)?promise=Cesium.EV_LoadETC(imageResource):promise=imageResource.fetchImage(),promise.then(imageLoadAndSaveIDB(model,id,url,dataInfo)).catch(ModelUtility_default.getFailedLoadFunction(model,"image",imageResource.url))}}function downloadTextureSuccessFormIdbCallback(dataInfo,array){if(Cesium.defined(dataInfo)){var model=dataInfo.model,url=dataInfo.keyName,id=dataInfo.id,image;if(array.length>0){for(var textures=new Array(array.length),i=0;i<array.length;i++)textures[i]=new CompressedTextureBuffer_default(array[i]._format,array[i]._width,array[i]._height,array[i]._buffer);image=textures}Cesium.defined(array._buffer)&&(image=new CompressedTextureBuffer_default(array._format,array._width,array._height,array._buffer)),Cesium.defined(image)&&loadImage(model,id,image)}}var scratchArticulationStageInitialTransform=new Cesium.Matrix4;function parseNodes(model){var runtimeNodes={},runtimeNodesByName={},skinnedNodes=[],skinnedNodesIds=model._loadResources.skinnedNodesIds,articulationsByName=model._runtime.articulationsByName;Cesium.ForEach.node(model.gltf,function(node,id){var runtimeNode={matrix:void 0,translation:void 0,rotation:void 0,scale:void 0,computedShow:!0,transformToRoot:new Cesium.Matrix4,computedMatrix:new Cesium.Matrix4,dirtyNumber:0,commands:[],inverseBindMatrices:void 0,bindShapeMatrix:void 0,joints:[],computedJointMatrices:[],jointName:node.jointName,weights:[],children:[],parents:[],publicNode:void 0};if(runtimeNode.publicNode=new Cesium.ModelNode(model,node,runtimeNode,id,ModelUtility_default.getTransform(node)),runtimeNodes[id]=runtimeNode,runtimeNodesByName[node.name]=runtimeNode,Cesium.defined(node.skin)&&(skinnedNodesIds.push(id),skinnedNodes.push(runtimeNode)),Cesium.defined(node.extensions)&&Cesium.defined(node.extensions.AGI_articulations)){var articulationName=node.extensions.AGI_articulations.articulationName;if(Cesium.defined(articulationName)){var transform3=Cesium.Matrix4.clone(runtimeNode.publicNode.originalMatrix,scratchArticulationStageInitialTransform),articulation=articulationsByName[articulationName];articulation.nodes.push(runtimeNode.publicNode);for(var numStages=articulation.stages.length,s=0;s<numStages;++s){var stage=articulation.stages[s];transform3=applyArticulationStageMatrix(stage,transform3)}runtimeNode.publicNode.matrix=transform3}}}),model._runtime.nodes=runtimeNodes,model._runtime.nodesByName=runtimeNodesByName,model._runtime.skinnedNodes=skinnedNodes}function parseMaterials(model){var gltf=model.gltf,techniques=model._sourceTechniques,runtimeMaterialsByName={},runtimeMaterialsById={},uniformMaps=model._uniformMaps;Cesium.ForEach.material(gltf,function(material,materialId){uniformMaps[materialId]={uniformMap:void 0,values:void 0,jointMatrixUniformName:void 0,morphWeightsUniformName:void 0};var modelMaterial=new ModelMaterial_default(model,material,materialId);if(Cesium.defined(material.extensions)&&Cesium.defined(material.extensions.KHR_techniques_webgl)){var techniqueId=material.extensions.KHR_techniques_webgl.technique;modelMaterial._technique=techniqueId,modelMaterial._program=techniques[techniqueId].program,Cesium.ForEach.materialValue(material,function(value,uniformName){Cesium.defined(modelMaterial._values)||(modelMaterial._values={}),modelMaterial._values[uniformName]=Cesium.clone(value),uniformName=="u_specular"&&(modelMaterial._values[uniformName][0]=model.modelSpecular)})}runtimeMaterialsByName[material.name]=modelMaterial,runtimeMaterialsById[materialId]=modelMaterial}),model._runtime.materialsByName=runtimeMaterialsByName,model._runtime.materialsById=runtimeMaterialsById}function parseMeshes(model){var runtimeMeshesByName={},runtimeMaterialsById=model._runtime.materialsById;Cesium.ForEach.mesh(model.gltf,function(mesh,meshId){runtimeMeshesByName[mesh.name]=new ModelMesh_default(mesh,runtimeMaterialsById,meshId),(Cesium.defined(model.extensionsUsed.WEB3D_quantized_attributes)||model._dequantizeInShader)&&Cesium.ForEach.meshPrimitive(mesh,function(primitive,primitiveId){var programId=getProgramForPrimitive2(model,primitive),programPrimitives=model._programPrimitives[programId];Cesium.defined(programPrimitives)||(programPrimitives={},model._programPrimitives[programId]=programPrimitives),programPrimitives[meshId+".primitive."+primitiveId]=primitive})}),model._runtime.meshesByName=runtimeMeshesByName}var CreateVertexBufferJob=function(){this.id=void 0,this.model=void 0,this.context=void 0};CreateVertexBufferJob.prototype.set=function(id,model,context){this.id=id,this.model=model,this.context=context};CreateVertexBufferJob.prototype.execute=function(){createVertexBuffer2(this.id,this.model,this.context)};function createVertexBuffer2(bufferViewId,model,context){var loadResources=model._loadResources,bufferViews=model.gltf.bufferViews,bufferView=bufferViews[bufferViewId];Cesium.defined(bufferView)||(bufferView=loadResources.createdBufferViews[bufferViewId]);var vertexBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray:loadResources.getBuffer(bufferView),usage:Cesium.BufferUsage.STATIC_DRAW});vertexBuffer.vertexArrayDestroyable=!1,model._rendererResources.buffers[bufferViewId]=vertexBuffer,model._geometryByteLength+=vertexBuffer.sizeInBytes}var CreateIndexBufferJob=function(){this.id=void 0,this.componentType=void 0,this.model=void 0,this.context=void 0};CreateIndexBufferJob.prototype.set=function(id,componentType,model,context){this.id=id,this.componentType=componentType,this.model=model,this.context=context};CreateIndexBufferJob.prototype.execute=function(){createIndexBuffer(this.id,this.componentType,this.model,this.context)};function createIndexBuffer(bufferViewId,componentType,model,context){var loadResources=model._loadResources,bufferViews=model.gltf.bufferViews,bufferView=bufferViews[bufferViewId];Cesium.defined(bufferView)||(bufferView=loadResources.createdBufferViews[bufferViewId]);var indexBuffer=Cesium.Buffer.createIndexBuffer({context,typedArray:loadResources.getBuffer(bufferView),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:componentType});indexBuffer.vertexArrayDestroyable=!1,model._rendererResources.buffers[bufferViewId]=indexBuffer,model._geometryByteLength+=indexBuffer.sizeInBytes}var scratchVertexBufferJob=new CreateVertexBufferJob,scratchIndexBufferJob=new CreateIndexBufferJob;function createBuffers(model,frameState){var loadResources=model._loadResources;if(loadResources.pendingBufferLoads===0){var context=frameState.context,vertexBuffersToCreate=loadResources.vertexBuffersToCreate,indexBuffersToCreate=loadResources.indexBuffersToCreate,i;if(model.asynchronous){for(;vertexBuffersToCreate.length>0&&(scratchVertexBufferJob.set(vertexBuffersToCreate.peek(),model,context),!!frameState.jobScheduler.execute(scratchVertexBufferJob,Cesium.JobType.BUFFER));)vertexBuffersToCreate.dequeue();for(;indexBuffersToCreate.length>0&&(i=indexBuffersToCreate.peek(),scratchIndexBufferJob.set(i.id,i.componentType,model,context),!!frameState.jobScheduler.execute(scratchIndexBufferJob,Cesium.JobType.BUFFER));)indexBuffersToCreate.dequeue()}else{for(;vertexBuffersToCreate.length>0;)createVertexBuffer2(vertexBuffersToCreate.dequeue(),model,context);for(;indexBuffersToCreate.length>0;)i=indexBuffersToCreate.dequeue(),createIndexBuffer(i.id,i.componentType,model,context)}}}function getProgramForPrimitive2(model,primitive){var material=model._runtime.materialsById[primitive.material];if(!!Cesium.defined(material))return material._program}function modifyShaderForQuantizedAttributes2(shader,programName,model){var primitive,primitives=model._programPrimitives[programName];if(!Cesium.defined(primitives))return shader;var primitiveId;for(primitiveId in primitives)if(primitives.hasOwnProperty(primitiveId)&&(primitive=primitives[primitiveId],getProgramForPrimitive2(model,primitive)===programName))break;model._programPrimitives[programName]=void 0;var result;if(model.extensionsUsed.WEB3D_quantized_attributes)result=ModelUtility_default.modifyShaderForQuantizedAttributes(model.gltf,primitive,shader),model._quantizedUniforms[programName]=result.uniforms;else{var decodedData=model._decodedData[primitiveId];if(Cesium.defined(decodedData))result=ModelUtility_default.modifyShaderForDracoQuantizedAttributes(model.gltf,primitive,shader,decodedData.attributes);else return shader}return result.shader}function modifyShaderForColor2(shader){return shader=Cesium.ShaderSource.replaceMain(shader,"gltf_blend_main"),shader+=`uniform vec4 gltf_color; 
uniform float gltf_colorBlend; 
void main() 
{ 
    gltf_blend_main(); 
    gl_FragColor.rgb = mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); 
    float highlight = ceil(gltf_colorBlend); 
    gl_FragColor.rgb *= mix(gltf_color.rgb, vec3(1.0), highlight); 
    gl_FragColor.a *= gltf_color.a; 
} 
`,shader}function modifyShader2(shader,programName,callback){return Cesium.defined(callback)&&(shader=callback(shader,programName)),shader}var CreateProgramJob=function(){this.programToCreate=void 0,this.model=void 0,this.context=void 0};CreateProgramJob.prototype.set=function(programToCreate,model,context){this.programToCreate=programToCreate,this.model=model,this.context=context};CreateProgramJob.prototype.execute=function(){createProgram2(this.programToCreate,this.model,this.context)};function createProgram2(programToCreate,model,context){var programId=programToCreate.programId,techniqueId=programToCreate.techniqueId,program=model._sourcePrograms[programId],shaders=model._rendererResources.sourceShaders,vs=shaders[program.vertexShader],fs=shaders[program.fragmentShader];fs+="uniform vec4 u_rollerRegion;";var quantizedVertexShaders=model._quantizedVertexShaders,toClipCoordinatesGLSL=model._toClipCoordinatesGLSL[programId];if(model.extensionsUsed.WEB3D_quantized_attributes||model._dequantizeInShader){var quantizedVS=quantizedVertexShaders[programId];Cesium.defined(quantizedVS)||(quantizedVS=modifyShaderForQuantizedAttributes2(vs,programId,model),quantizedVertexShaders[programId]=quantizedVS),vs=quantizedVS}var drawVS=modifyShader2(vs,programId,model._vertexShaderLoaded),drawFS=modifyShader2(fs,programId,model._fragmentShaderLoaded);if(model._tilesetFlat&&(drawVS=model._tilesetFlat._updateVertexShader(drawVS)),Cesium.FeatureDetection.isInternetExplorer()||(drawVS=ModelUtility_default.modifyVertexShaderForLogDepth(drawVS,toClipCoordinatesGLSL),model.rollerRegion.equals(scratchRoller2)?drawFS=ModelUtility_default.modifyFragmentShaderForLogDepth(drawFS):drawFS=ModelUtility_default.modifyFragmentShaderForLogDepthAddRoller(drawFS)),Cesium.defined(model._uniformMapLoaded)||(drawFS=`uniform vec4 czm_pickColor;
`+drawFS),Cesium.defined(model._scene)&&Cesium.defined(model._scene.ev_Fog)&&model._scene.ev_Fog.enabled){if(drawVS.indexOf("u_modelViewMatrix")>-1){drawVS=`
 varying vec4 v_viewPosition; 
`+drawVS;var vsCalculateWorldPos=`v_viewPosition = u_modelViewMatrix * vec4(a_position.xyz, 1.0); 
`;drawVS.indexOf("gltf_a_dec_position")!=-1&&(vsCalculateWorldPos=`v_viewPosition = u_modelViewMatrix * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var index=drawVS.lastIndexOf("}");index&&(drawVS=drawVS.slice(0,index)+vsCalculateWorldPos+drawVS.slice(index)),drawFS=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+drawFS,model._scene.fog.enabled&&(drawFS=`#define FOG 

`+drawFS)}else if(drawVS.indexOf("u_modelViewProj")>-1&&drawVS.indexOf("u_projectionMatrix")>-1){drawVS=`
 varying vec4 v_viewPosition; 
`+drawVS;var vsCalculateWorldPos=`v_viewPosition = u_modelViewProj *u_projectionMatrix* vec4(a_position.xyz, 1.0); 
`;drawVS.indexOf("gltf_a_dec_position")!=-1&&(vsCalculateWorldPos=`v_viewPosition = u_modelViewProj *u_projectionMatrix*vec4(gltf_a_dec_position.xyz, 1.0); 
`);var index=drawVS.lastIndexOf("}");index&&(drawVS=drawVS.slice(0,index)+vsCalculateWorldPos+drawVS.slice(index)),drawFS=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+drawFS,model._scene.fog.enabled&&(drawFS=`#define FOG 

`+drawFS)}}var useIBL=model._imageBasedLightingFactor.x>0||model._imageBasedLightingFactor.y>0;if(useIBL&&(drawFS=`#define USE_IBL_LIGHTING 

`+drawFS),Cesium.defined(model._lightColor)&&(drawFS=`#define USE_CUSTOM_LIGHT_COLOR 

`+drawFS),(model._sourceVersion!=="2.0"||model._sourceKHRTechniquesWebGL)&&(drawFS=Cesium.ShaderSource.replaceMain(drawFS,"non_gamma_corrected_main"),drawFS=drawFS+`
void main() { 
    non_gamma_corrected_main(); 
    gl_FragColor = czm_gammaCorrect(gl_FragColor); 
} 
`),Cesium.defined(model._scene)&&Cesium.defined(model._scene.ev_Fog)&&model._scene.ev_Fog.enabled){var fogCalculateFS=`
#if defined(FOG)
  vec4 finalColor =  gl_FragColor; 
  float vDistance =  length(v_viewPosition.xyz); 
  vec4 worldPosition = czm_inverseView3D * v_viewPosition; 
  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(worldPosition.x, worldPosition.y, worldPosition.z), false, vec3(0.0));
  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);
 #ifndef HDR
  const float fExposure = 4.0;
  fogColor = vec3(1.0) - exp(-fExposure * fogColor);
 #endif
 #ifdef FOG
   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)
      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);
      fogColor *= darken;
   #endif
   #ifdef HDR
       const float modifier = 0.15;
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);
    #else
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);
    #endif
 #endif
 gl_FragColor = finalColor;
#endif
`,indexFS=drawFS.lastIndexOf("}");indexFS&&(drawFS=drawFS.slice(0,indexFS)+fogCalculateFS+drawFS.slice(indexFS))}if(Cesium.OctahedralProjectedCubeMap.isSupported(context)){var usesSH=Cesium.defined(model._sphericalHarmonicCoefficients)||model._useDefaultSphericalHarmonics,usesSM=Cesium.defined(model._specularEnvironmentMapAtlas)&&model._specularEnvironmentMapAtlas.ready||model._useDefaultSpecularMaps,addMatrix=usesSH||usesSM||useIBL;addMatrix&&(drawFS=`uniform mat4 gltf_clippingPlanesMatrix; 
`+drawFS),Cesium.defined(model._sphericalHarmonicCoefficients)?drawFS=`#define DIFFUSE_IBL 
#define CUSTOM_SPHERICAL_HARMONICS 
uniform vec3 gltf_sphericalHarmonicCoefficients[9]; 
`+drawFS:model._useDefaultSphericalHarmonics&&(drawFS=`#define DIFFUSE_IBL 
`+drawFS),Cesium.defined(model._specularEnvironmentMapAtlas)&&model._specularEnvironmentMapAtlas.ready?drawFS=`#define SPECULAR_IBL 
#define CUSTOM_SPECULAR_IBL 
uniform sampler2D gltf_specularMap; 
uniform vec2 gltf_specularMapSize; 
uniform float gltf_maxSpecularLOD; 
`+drawFS:model._useDefaultSpecularMaps&&(drawFS=`#define SPECULAR_IBL 
`+drawFS)}Cesium.defined(model._luminanceAtZenith)&&(drawFS=`#define USE_SUN_LUMINANCE 
uniform float gltf_luminanceAtZenith;
`+drawFS),createAttributesAndProgram2(programId,techniqueId,drawFS,drawVS,model,context)}var scratchRoller2=new Cesium.Cartesian4(0,0,1,1);function recreateProgram2(programToCreate,model,context){var programId=programToCreate.programId,techniqueId=programToCreate.techniqueId,program=model._sourcePrograms[programId],shaders=model._rendererResources.sourceShaders,quantizedVertexShaders=model._quantizedVertexShaders,toClipCoordinatesGLSL=model._toClipCoordinatesGLSL[programId],clippingPlaneCollection=model.clippingPlanes,addClippingPlaneCode=isClippingEnabled2(model),vs=shaders[program.vertexShader],fs=shaders[program.fragmentShader];fs+="uniform vec4 u_rollerRegion;",(model.extensionsUsed.WEB3D_quantized_attributes||model._dequantizeInShader)&&(vs=quantizedVertexShaders[programId]);var finalFS=fs;isColorShadingEnabled2(model)&&(finalFS=Model._modifyShaderForColor(finalFS)),addClippingPlaneCode&&(finalFS=modifyShaderForClippingPlanes2(finalFS,clippingPlaneCollection,context));var drawVS=modifyShader2(vs,programId,model._vertexShaderLoaded),drawFS=modifyShader2(finalFS,programId,model._fragmentShaderLoaded);if(model._tilesetFlat&&(drawVS=model._tilesetFlat._updateVertexShader(drawVS)),Cesium.FeatureDetection.isInternetExplorer()||(drawVS=ModelUtility_default.modifyVertexShaderForLogDepth(drawVS,toClipCoordinatesGLSL),model.rollerRegion.equals(scratchRoller2)?drawFS=ModelUtility_default.modifyFragmentShaderForLogDepth(drawFS):drawFS=ModelUtility_default.modifyFragmentShaderForLogDepthAddRoller(drawFS)),Cesium.defined(model._uniformMapLoaded)||(drawFS=`uniform vec4 czm_pickColor;
`+drawFS),Cesium.defined(model._scene)&&Cesium.defined(model._scene.ev_Fog)&&model._scene.ev_Fog.enabled){if(drawVS.indexOf("u_modelViewMatrix")>-1){drawVS=`
 varying vec4 v_viewPosition; 
`+drawVS;var vsCalculateWorldPos=`v_viewPosition = u_modelViewMatrix * vec4(a_position.xyz, 1.0); 
`;drawVS.indexOf("gltf_a_dec_position")!=-1&&(vsCalculateWorldPos=`v_viewPosition = u_modelViewMatrix * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var index=drawVS.lastIndexOf("}");index&&(drawVS=drawVS.slice(0,index)+vsCalculateWorldPos+drawVS.slice(index)),drawFS=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+drawFS,model._scene.fog.enabled&&(drawFS=`#define FOG 

`+drawFS)}else if(drawVS.indexOf("u_modelViewProj")>-1&&drawVS.indexOf("u_projectionMatrix")>-1){drawVS=`
 varying vec4 v_viewPosition; 
`+drawVS;var vsCalculateWorldPos=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(a_position.xyz, 1.0); 
`;drawVS.indexOf("gltf_a_dec_position")!=-1&&(vsCalculateWorldPos=`v_viewPosition = u_projectionMatrix*u_modelViewProj * vec4(gltf_a_dec_position.xyz, 1.0); 
`);var index=drawVS.lastIndexOf("}");index&&(drawVS=drawVS.slice(0,index)+vsCalculateWorldPos+drawVS.slice(index)),drawFS=`
varying vec4 v_viewPosition; 
#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) 
uniform float u_minimumBrightness ;
#endif 
vec3 colorCorrect(vec3 rgb) {
#ifdef COLOR_CORRECT
    // Convert rgb color to hsb
    vec3 hsb = czm_RGBToHSB(rgb);
    // Perform hsb shift
    hsb.x += u_hsbShift.x; // hue
    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness
    // Convert shifted hsb back to rgb
    rgb = czm_HSBToRGB(hsb);
#endif
    return rgb;
} 
`+Cesium._shadersGroundAtmosphereOld+`
`+drawFS,model._scene.fog.enabled&&(drawFS=`#define FOG 

`+drawFS)}}var useIBL=model._imageBasedLightingFactor.x>0||model._imageBasedLightingFactor.y>0;if(useIBL&&(drawFS=`#define USE_IBL_LIGHTING 

`+drawFS),Cesium.defined(model._lightColor)&&(drawFS=`#define USE_CUSTOM_LIGHT_COLOR 

`+drawFS),(model._sourceVersion!=="2.0"||model._sourceKHRTechniquesWebGL)&&(drawFS=Cesium.ShaderSource.replaceMain(drawFS,"non_gamma_corrected_main"),drawFS=drawFS+`
void main() { 
    non_gamma_corrected_main(); 
    gl_FragColor = czm_gammaCorrect(gl_FragColor); 
} 
`),Cesium.defined(model._scene)&&Cesium.defined(model._scene.ev_Fog)&&model._scene.ev_Fog.enabled){var fogCalculateFS=`
#if defined(FOG)
  vec4 finalColor =  gl_FragColor; 
  float vDistance =  length(v_viewPosition.xyz); 
  vec4 worldPosition = czm_inverseView3D * v_viewPosition;  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(worldPosition.x, worldPosition.y, worldPosition.z), false, vec3(0.0));
  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);
 #ifndef HDR
  const float fExposure = 4.0;
  fogColor = vec3(1.0) - exp(-fExposure * fogColor);
 #endif
 #ifdef FOG
   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)
      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);
      fogColor *= darken;
   #endif
   #ifdef HDR
       const float modifier = 0.15;
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);
    #else
      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);
    #endif
 #endif
 gl_FragColor = finalColor;
#endif
`,indexFS=drawFS.lastIndexOf("}");indexFS&&(drawFS=drawFS.slice(0,indexFS)+fogCalculateFS+drawFS.slice(indexFS))}if(Cesium.OctahedralProjectedCubeMap.isSupported(context)){var usesSH=Cesium.defined(model._sphericalHarmonicCoefficients)||model._useDefaultSphericalHarmonics,usesSM=Cesium.defined(model._specularEnvironmentMapAtlas)&&model._specularEnvironmentMapAtlas.ready||model._useDefaultSpecularMaps,addMatrix=!addClippingPlaneCode&&(usesSH||usesSM||useIBL);addMatrix&&(drawFS=`uniform mat4 gltf_clippingPlanesMatrix; 
`+drawFS),Cesium.defined(model._sphericalHarmonicCoefficients)?drawFS=`#define DIFFUSE_IBL 
#define CUSTOM_SPHERICAL_HARMONICS 
uniform vec3 gltf_sphericalHarmonicCoefficients[9]; 
`+drawFS:model._useDefaultSphericalHarmonics&&(drawFS=`#define DIFFUSE_IBL 
`+drawFS),Cesium.defined(model._specularEnvironmentMapAtlas)&&model._specularEnvironmentMapAtlas.ready?drawFS=`#define SPECULAR_IBL 
#define CUSTOM_SPECULAR_IBL 
uniform sampler2D gltf_specularMap; 
uniform vec2 gltf_specularMapSize; 
uniform float gltf_maxSpecularLOD; 
`+drawFS:model._useDefaultSpecularMaps&&(drawFS=`#define SPECULAR_IBL 
`+drawFS)}Cesium.defined(model._luminanceAtZenith)&&(drawFS=`#define USE_SUN_LUMINANCE 
uniform float gltf_luminanceAtZenith;
`+drawFS),createAttributesAndProgram2(programId,techniqueId,drawFS,drawVS,model,context)}function createAttributesAndProgram2(programId,techniqueId,drawFS,drawVS,model,context){var technique=model._sourceTechniques[techniqueId],attributeLocations=ModelUtility_default.createAttributeLocations(technique,model._precreatedAttributes);typeof drawFS=="string"&&(drawFS=drawFS.replace(/czm_phong\(normalize\(positionToEyeEC\)\, material\)/g,"czm_phong(normalize(positionToEyeEC), material,czm_lightDirectionEC)")),model._rendererResources.programs[programId]=Cesium.ShaderProgram.fromCache({context,vertexShaderSource:drawVS,fragmentShaderSource:drawFS,attributeLocations})}var scratchCreateProgramJob=new CreateProgramJob;function createPrograms(model,frameState){var loadResources=model._loadResources,programsToCreate=loadResources.programsToCreate;if(loadResources.pendingShaderLoads===0&&loadResources.pendingBufferLoads===0){var context=frameState.context;if(model.asynchronous)for(;programsToCreate.length>0&&(scratchCreateProgramJob.set(programsToCreate.peek(),model,context),!!frameState.jobScheduler.execute(scratchCreateProgramJob,Cesium.JobType.PROGRAM));)programsToCreate.dequeue();else for(;programsToCreate.length>0;)createProgram2(programsToCreate.dequeue(),model,context)}}function getOnImageCreatedFromTypedArray(loadResources,gltfTexture){return function(image){loadResources.texturesToCreate.enqueue({id:gltfTexture.id,image,bufferView:void 0}),--loadResources.pendingBufferViewToImage}}function loadTexturesFromBufferViews(model){var loadResources=model._loadResources;if(loadResources.pendingBufferLoads===0)for(;loadResources.texturesToCreateFromBufferView.length>0;){var gltfTexture=loadResources.texturesToCreateFromBufferView.dequeue(),gltf=model.gltf,bufferView=gltf.bufferViews[gltfTexture.bufferView],imageId=gltf.textures[gltfTexture.id].source,onerror=ModelUtility_default.getFailedLoadFunction(model,"image","id: "+gltfTexture.id+", bufferView: "+gltfTexture.bufferView);if(gltfTexture.mimeType==="image/ktx")loadKTX_default(loadResources.getBuffer(bufferView)).then(imageLoad(model,gltfTexture.id,imageId)).otherwise(onerror),++model._loadResources.pendingTextureLoads;else if(gltfTexture.mimeType==="image/crn")loadCRN_default(loadResources.getBuffer(bufferView)).then(imageLoad(model,gltfTexture.id,imageId)).otherwise(onerror),++model._loadResources.pendingTextureLoads;else if(gltfTexture.mimeType==="image/pkm")Cesium.EV_LoadETC(loadResources.getBuffer(bufferView)).then(imageLoad(model,gltfTexture.id,imageId)).otherwise(onerror),++model._loadResources.pendingTextureLoads;else{var onload=getOnImageCreatedFromTypedArray(loadResources,gltfTexture);Cesium.loadImageFromTypedArray({uint8Array:loadResources.getBuffer(bufferView),format:gltfTexture.mimeType,flipY:!1}).then(onload).catch(onerror),++loadResources.pendingBufferViewToImage}}}function createSamplers(model){var loadResources=model._loadResources;if(loadResources.createSamplers){loadResources.createSamplers=!1;var rendererSamplers=model._rendererResources.samplers;Cesium.ForEach.sampler(model.gltf,function(sampler,samplerId){rendererSamplers[samplerId]=new Cesium.Sampler({wrapS:sampler.wrapS,wrapT:sampler.wrapT,minificationFilter:sampler.minFilter,magnificationFilter:sampler.magFilter})})}}var CreateTextureJob=function(){this.gltfTexture=void 0,this.model=void 0,this.context=void 0};CreateTextureJob.prototype.set=function(gltfTexture,model,context){this.gltfTexture=gltfTexture,this.model=model,this.context=context};CreateTextureJob.prototype.execute=function(){createTexture3(this.gltfTexture,this.model,this.context)};function createTexture3(gltfTexture,model,context){var textures=model.gltf.textures,texture=textures[gltfTexture.id],rendererSamplers=model._rendererResources.samplers,sampler=rendererSamplers[texture.sampler];Cesium.defined(sampler)||(sampler=new Cesium.Sampler({wrapS:Cesium.TextureWrap.REPEAT,wrapT:Cesium.TextureWrap.REPEAT}));for(var usesTextureTransform=!1,materials=model.gltf.materials,materialsLength=materials.length,i=0;i<materialsLength;++i){var material=materials[i];if(Cesium.defined(material.extensions)&&Cesium.defined(material.extensions.KHR_techniques_webgl)){var values3=material.extensions.KHR_techniques_webgl.values;for(var valueName in values3)if(values3.hasOwnProperty(valueName)&&valueName.indexOf("Texture")!==-1){var value=values3[valueName];if(value.index===gltfTexture.id&&Cesium.defined(value.extensions)&&Cesium.defined(value.extensions.KHR_texture_transform)){usesTextureTransform=!0;break}}}if(usesTextureTransform)break}var wrapS=sampler.wrapS,wrapT=sampler.wrapT,minFilter=sampler.minificationFilter;usesTextureTransform&&minFilter!==Cesium.TextureMinificationFilter.LINEAR&&minFilter!==Cesium.TextureMinificationFilter.NEAREST&&(minFilter===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST||minFilter===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_LINEAR?minFilter=Cesium.TextureMinificationFilter.NEAREST:minFilter=Cesium.TextureMinificationFilter.LINEAR,sampler=new Cesium.Sampler({wrapS:sampler.wrapS,wrapT:sampler.wrapT,textureMinificationFilter:minFilter,textureMagnificationFilter:sampler.magnificationFilter}));var internalFormat=gltfTexture.internalFormat,mipmap=!(Cesium.defined(internalFormat)&&Cesium.PixelFormat.isCompressedFormat(internalFormat))&&(minFilter===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST||minFilter===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_LINEAR||minFilter===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_NEAREST||minFilter===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR),requiresNpot=mipmap||wrapS===Cesium.TextureWrap.REPEAT||wrapS===Cesium.TextureWrap.MIRRORED_REPEAT||wrapT===Cesium.TextureWrap.REPEAT||wrapT===Cesium.TextureWrap.MIRRORED_REPEAT,tx,source;if(Cesium.defined(gltfTexture.image.length)?source=Cesium.clone(gltfTexture.image,!1):source=gltfTexture.image,Cesium.defined(internalFormat)){npot=!Cesium.Math.isPowerOfTwo(gltfTexture.width)||!Cesium.Math.isPowerOfTwo(gltfTexture.height),!context.webgl2&&Cesium.PixelFormat.isCompressedFormat(internalFormat)&&npot&&requiresNpot&&console.warn("Compressed texture uses REPEAT or MIRRORED_REPEAT texture wrap mode and dimensions are not powers of two. The texture may be rendered incorrectly. See the Model.js constructor documentation for more information.");let minificationFilter=sampler.minificationFilter;!Cesium.defined(gltfTexture.mipLevels)&&(minFilter===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST||minFilter===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_LINEAR)?minificationFilter=Cesium.TextureMinificationFilter.NEAREST:!Cesium.defined(gltfTexture.mipLevels)&&(minFilter===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_NEAREST||minFilter===Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR)&&(minificationFilter=Cesium.TextureMinificationFilter.LINEAR),sampler=new Cesium.Sampler({wrapS:sampler.wrapS,wrapT:sampler.wrapT,minificationFilter,magnificationFilter:sampler.magnificationFilter}),tx=new Texture_default({context,source:{arrayBufferView:gltfTexture.bufferView},width:gltfTexture.width,height:gltfTexture.height,pixelFormat:internalFormat,sampler})}else if(Cesium.defined(source)){if(Cesium.defined(source.width)&&Cesium.defined(source.height)){var npot=!Cesium.Math.isPowerOfTwo(source.width)||!Cesium.Math.isPowerOfTwo(source.height);if(requiresNpot&&npot){var canvas=document.createElement("canvas");canvas.width=Cesium.Math.nextPowerOfTwo(source.width),canvas.height=Cesium.Math.nextPowerOfTwo(source.height);var canvasContext=canvas.getContext("2d",{willReadFrequently:!0});canvasContext.drawImage(source,0,0,source.width,source.height,0,0,canvas.width,canvas.height),source=canvas}tx=new Texture_default({context,source,pixelFormat:texture.internalFormat,sampler,flipY:!1}),mipmap&&tx.generateMipmap()}else if(Cesium.defined(source.length)&&source.length>0){var mipmap0=source[0];tx=new Texture_default({context,source,width:mipmap0.width,height:mipmap0.height,pixelFormat:mipmap0.internalFormat,sampler})}}Cesium.defined(tx)&&(model._rendererResources.textures[gltfTexture.id]=tx,model._texturesByteLength+=tx.sizeInBytes)}var scratchCreateTextureJob=new CreateTextureJob;function createTextures(model,frameState){var context=frameState.context,texturesToCreate=model._loadResources.texturesToCreate;if(model.asynchronous)for(;texturesToCreate.length>0&&(scratchCreateTextureJob.set(texturesToCreate.peek(),model,context),!!frameState.jobScheduler.execute(scratchCreateTextureJob,Cesium.JobType.TEXTURE));)texturesToCreate.dequeue();else for(;texturesToCreate.length>0;)createTexture3(texturesToCreate.dequeue(),model,context)}function getAttributeLocations2(model,primitive){var techniques=model._sourceTechniques,attributeLocations={},location2,index,material=model._runtime.materialsById[primitive.material];if(!Cesium.defined(material))return attributeLocations;var technique=techniques[material._technique];if(!Cesium.defined(technique))return attributeLocations;var attributes=technique.attributes,program=model._rendererResources.programs[technique.program],programVertexAttributes=program.vertexAttributes,programAttributeLocations=program._attributeLocations;for(location2 in programVertexAttributes)if(programVertexAttributes.hasOwnProperty(location2)){var attribute=attributes[location2];Cesium.defined(attribute)&&(index=programAttributeLocations[location2],attributeLocations[attribute.semantic]=index)}var precreatedAttributes=model._precreatedAttributes;if(Cesium.defined(precreatedAttributes))for(location2 in precreatedAttributes)precreatedAttributes.hasOwnProperty(location2)&&(index=programAttributeLocations[location2],attributeLocations[location2]=index);return attributeLocations}function createJoints(model,runtimeSkins){for(var gltf=model.gltf,skins=gltf.skins,nodes=gltf.nodes,runtimeNodes=model._runtime.nodes,skinnedNodesIds=model._loadResources.skinnedNodesIds,length3=skinnedNodesIds.length,j=0;j<length3;++j){var id=skinnedNodesIds[j],skinnedNode=runtimeNodes[id],node=nodes[id],runtimeSkin=runtimeSkins[node.skin];skinnedNode.inverseBindMatrices=runtimeSkin.inverseBindMatrices,skinnedNode.bindShapeMatrix=runtimeSkin.bindShapeMatrix;for(var gltfJoints=skins[node.skin].joints,jointsLength=gltfJoints.length,i=0;i<jointsLength;++i){var nodeId=gltfJoints[i],jointNode=runtimeNodes[nodeId];skinnedNode.joints.push(jointNode)}}}function createSkins(model){var loadResources=model._loadResources;if(loadResources.pendingBufferLoads===0&&!!loadResources.createSkins){loadResources.createSkins=!1;var gltf=model.gltf,accessors=gltf.accessors,runtimeSkins={};Cesium.ForEach.skin(gltf,function(skin,id){var accessor=accessors[skin.inverseBindMatrices],bindShapeMatrix;Cesium.Matrix4.equals(skin.bindShapeMatrix,Cesium.Matrix4.IDENTITY)||(bindShapeMatrix=Cesium.Matrix4.clone(skin.bindShapeMatrix)),runtimeSkins[id]={inverseBindMatrices:Cesium.ModelAnimationCache.getSkinInverseBindMatrices(model,accessor),bindShapeMatrix}}),createJoints(model,runtimeSkins)}}function getChannelEvaluator(model,runtimeNode,targetPath,spline){return function(localAnimationTime){Cesium.defined(spline)&&(localAnimationTime=model.clampAnimations?spline.clampTime(localAnimationTime):spline.wrapTime(localAnimationTime),runtimeNode[targetPath]=spline.evaluate(localAnimationTime,runtimeNode[targetPath]),runtimeNode.dirtyNumber=model._maxDirtyNumber)}}function createRuntimeAnimations(model){var loadResources=model._loadResources;if(!!loadResources.finishedPendingBufferLoads()&&!!loadResources.createRuntimeAnimations){loadResources.createRuntimeAnimations=!1,model._runtime.animations=[];var runtimeNodes=model._runtime.nodes,accessors=model.gltf.accessors;Cesium.ForEach.animation(model.gltf,function(animation,i){for(var channels=animation.channels,samplers=animation.samplers,startTime=Number.MAX_VALUE,stopTime=-Number.MAX_VALUE,channelsLength=channels.length,channelEvaluators=new Array(channelsLength),j=0;j<channelsLength;++j){var channel=channels[j],target=channel.target,path=target.path,sampler=samplers[channel.sampler],input=Cesium.ModelAnimationCache.getAnimationParameterValues(model,accessors[sampler.input]),output=Cesium.ModelAnimationCache.getAnimationParameterValues(model,accessors[sampler.output]);startTime=Math.min(startTime,input[0]),stopTime=Math.max(stopTime,input[input.length-1]);var spline=Cesium.ModelAnimationCache.getAnimationSpline(model,i,animation,channel.sampler,sampler,input,path,output);channelEvaluators[j]=getChannelEvaluator(model,runtimeNodes[target.node],target.path,spline)}model._runtime.animations[i]={name:animation.name,startTime,stopTime,channelEvaluators}})}}function createVertexArrays2(model,context){var loadResources=model._loadResources;if(!(!loadResources.finishedBuffersCreation()||!loadResources.finishedProgramCreation()||!loadResources.createVertexArrays)){loadResources.createVertexArrays=!1;var rendererBuffers=model._rendererResources.buffers,rendererVertexArrays=model._rendererResources.vertexArrays,gltf=model.gltf,accessors=gltf.accessors;Cesium.ForEach.mesh(gltf,function(mesh,meshId){Cesium.ForEach.meshPrimitive(mesh,function(primitive,primitiveId){var attributes=[],attributeLocation,attributeLocations=getAttributeLocations2(model,primitive),decodedData=model._decodedData[meshId+".primitive."+primitiveId];Cesium.ForEach.meshPrimitiveAttribute(primitive,function(accessorId,attributeName2){if(attributeLocation=attributeLocations[attributeName2],Cesium.defined(attributeLocation)){if(Cesium.defined(decodedData)){var decodedAttributes=decodedData.attributes;if(decodedAttributes.hasOwnProperty(attributeName2)){var decodedAttribute=decodedAttributes[attributeName2];attributes.push({index:attributeLocation,vertexBuffer:rendererBuffers[decodedAttribute.bufferView],componentsPerAttribute:decodedAttribute.componentsPerAttribute,componentDatatype:decodedAttribute.componentDatatype,normalize:decodedAttribute.normalized,offsetInBytes:decodedAttribute.byteOffset,strideInBytes:decodedAttribute.byteStride});return}}var a=accessors[accessorId],normalize6=Cesium.defined(a.normalized)&&a.normalized;attributes.push({index:attributeLocation,vertexBuffer:rendererBuffers[a.bufferView],componentsPerAttribute:Cesium.numberOfComponentsForType(a.type),componentDatatype:a.componentType,normalize:normalize6,offsetInBytes:a.byteOffset,strideInBytes:Cesium.getAccessorByteStride(gltf,a)})}});var attribute,attributeName,precreatedAttributes=model._precreatedAttributes;if(Cesium.defined(precreatedAttributes))for(attributeName in precreatedAttributes)precreatedAttributes.hasOwnProperty(attributeName)&&(attributeLocation=attributeLocations[attributeName],Cesium.defined(attributeLocation)&&(attribute=precreatedAttributes[attributeName],attribute.index=attributeLocation,attributes.push(attribute)));var indexBuffer;if(Cesium.defined(primitive.indices)){var accessor=accessors[primitive.indices],bufferView=accessor.bufferView;Cesium.defined(decodedData)&&(bufferView=decodedData.bufferView),indexBuffer=rendererBuffers[bufferView]}rendererVertexArrays[meshId+".primitive."+primitiveId]=new Cesium.VertexArray({context,attributes,indexBuffer})})})}}function createRenderStates(model){var loadResources=model._loadResources;loadResources.createRenderStates&&(loadResources.createRenderStates=!1,Cesium.ForEach.material(model.gltf,function(material,materialId){createRenderStateForMaterial(model,material,materialId)}))}function createRenderStateForMaterial(model,material,materialId){var rendererRenderStates=model._rendererResources.renderStates,blendEquationSeparate=[Cesium.WebGLConstants.FUNC_ADD,Cesium.WebGLConstants.FUNC_ADD],blendFuncSeparate=[Cesium.WebGLConstants.ONE,Cesium.WebGLConstants.ONE_MINUS_SRC_ALPHA,Cesium.WebGLConstants.ONE,Cesium.WebGLConstants.ONE_MINUS_SRC_ALPHA];Cesium.defined(material.extensions)&&Cesium.defined(material.extensions.KHR_blend)&&(blendEquationSeparate=material.extensions.KHR_blend.blendEquation,blendFuncSeparate=material.extensions.KHR_blend.blendFactors);var enableCulling=!material.doubleSided,blendingEnabled=material.alphaMode==="BLEND";rendererRenderStates[materialId]=Cesium.RenderState.fromCache({cull:{enabled:enableCulling},depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL},depthMask:!blendingEnabled,blending:{enabled:blendingEnabled,equationRgb:blendEquationSeparate[0],equationAlpha:blendEquationSeparate[1],functionSourceRgb:blendFuncSeparate[0],functionDestinationRgb:blendFuncSeparate[1],functionSourceAlpha:blendFuncSeparate[2],functionDestinationAlpha:blendFuncSeparate[3]}})}var gltfUniformsFromNode={MODEL:function(uniformState,model,runtimeNode){return function(){return runtimeNode.computedMatrix}},VIEW:function(uniformState,model,runtimeNode){return function(){return uniformState.view}},PROJECTION:function(uniformState,model,runtimeNode){return function(){return uniformState.projection}},MODELVIEW:function(uniformState,model,runtimeNode){var mv=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(uniformState.view,runtimeNode.computedMatrix,mv)}},CESIUM_RTC_MODELVIEW:function(uniformState,model,runtimeNode){var mvRtc=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(uniformState.view,runtimeNode.computedMatrix,mvRtc),Cesium.Matrix4.setTranslation(mvRtc,model._rtcCenterEye,mvRtc)}},MODELVIEWPROJECTION:function(uniformState,model,runtimeNode){var mvp=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(uniformState.view,runtimeNode.computedMatrix,mvp),Cesium.Matrix4.multiply(uniformState._projection,mvp,mvp)}},MODELINVERSE:function(uniformState,model,runtimeNode){var mInverse=new Cesium.Matrix4;return function(){return Cesium.Matrix4.inverse(runtimeNode.computedMatrix,mInverse)}},VIEWINVERSE:function(uniformState,model){return function(){return uniformState.inverseView}},PROJECTIONINVERSE:function(uniformState,model,runtimeNode){return function(){return uniformState.inverseProjection}},MODELVIEWINVERSE:function(uniformState,model,runtimeNode){var mv=new Cesium.Matrix4,mvInverse=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(uniformState.view,runtimeNode.computedMatrix,mv),Cesium.Matrix4.inverse(mv,mvInverse)}},MODELVIEWPROJECTIONINVERSE:function(uniformState,model,runtimeNode){var mvp=new Cesium.Matrix4,mvpInverse=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(uniformState.view,runtimeNode.computedMatrix,mvp),Cesium.Matrix4.multiply(uniformState._projection,mvp,mvp),Cesium.Matrix4.inverse(mvp,mvpInverse)}},MODELINVERSETRANSPOSE:function(uniformState,model,runtimeNode){var mInverse=new Cesium.Matrix4,mInverseTranspose=new Cesium.Matrix3;return function(){return Cesium.Matrix4.inverse(runtimeNode.computedMatrix,mInverse),Cesium.Matrix4.getMatrix3(mInverse,mInverseTranspose),Cesium.Matrix3.transpose(mInverseTranspose,mInverseTranspose)}},MODELVIEWINVERSETRANSPOSE:function(uniformState,model,runtimeNode){var mv=new Cesium.Matrix4,mvInverse=new Cesium.Matrix4,mvInverseTranspose=new Cesium.Matrix3;return function(){return Cesium.Matrix4.multiplyTransformation(uniformState.view,runtimeNode.computedMatrix,mv),Cesium.Matrix4.inverse(mv,mvInverse),Cesium.Matrix4.getMatrix3(mvInverse,mvInverseTranspose),Cesium.Matrix3.transpose(mvInverseTranspose,mvInverseTranspose)}},VIEWPORT:function(uniformState,model,runtimeNode){return function(){return uniformState.viewportCartesian4}}};function getUniformFunctionFromSource(source,model,semantic,uniformState){var runtimeNode=model._runtime.nodes[source];return gltfUniformsFromNode[semantic](uniformState,model,runtimeNode)}function createUniformsForMaterial(model,material,technique,instanceValues,context,textures,defaultTexture){var uniformMap={},uniformValues={},jointMatrixUniformName,morphWeightsUniformName;return Cesium.ForEach.techniqueUniform(technique,function(uniform,uniformName){var uv;if(Cesium.defined(instanceValues)&&Cesium.defined(instanceValues[uniformName]))uv=ModelUtility_default.createUniformFunction(uniform.type,instanceValues[uniformName],textures,defaultTexture),uniformMap[uniformName]=uv.func,uniformValues[uniformName]=uv;else if(Cesium.defined(uniform.node))uniformMap[uniformName]=getUniformFunctionFromSource(uniform.node,model,uniform.semantic,context.uniformState);else if(Cesium.defined(uniform.semantic))if(uniform.semantic==="JOINTMATRIX")jointMatrixUniformName=uniformName;else if(uniform.semantic==="MORPHWEIGHTS")morphWeightsUniformName=uniformName;else if(uniform.semantic==="ALPHACUTOFF"){var alphaMode=material.alphaMode;if(Cesium.defined(alphaMode)&&alphaMode==="MASK"){var alphaCutoffValue=Cesium.defaultValue(material.alphaCutoff,.5);uv=ModelUtility_default.createUniformFunction(uniform.type,alphaCutoffValue,textures,defaultTexture),uniformMap[uniformName]=uv.func,uniformValues[uniformName]=uv}}else uniformMap[uniformName]=ModelUtility_default.getGltfSemanticUniforms()[uniform.semantic](context.uniformState,model);else if(Cesium.defined(uniform.value)){var uv2=ModelUtility_default.createUniformFunction(uniform.type,uniform.value,textures,defaultTexture);uniformMap[uniformName]=uv2.func,uniformValues[uniformName]=uv2}}),{map:uniformMap,values:uniformValues,jointMatrixUniformName,morphWeightsUniformName}}function createUniformMaps(model,context){var loadResources=model._loadResources;if(!!loadResources.finishedProgramCreation()&&!!loadResources.createUniformMaps){loadResources.createUniformMaps=!1;var gltf=model.gltf,techniques=model._sourceTechniques,uniformMaps=model._uniformMaps,textures=model._rendererResources.textures,defaultTexture=model._defaultTexture;Cesium.ForEach.material(gltf,function(material,materialId){var modelMaterial=model._runtime.materialsById[materialId],technique=techniques[modelMaterial._technique],instanceValues=modelMaterial._values,uniforms=createUniformsForMaterial(model,material,technique,instanceValues,context,textures,defaultTexture);uniforms.map.u_rollerRegion=function(){return model.rollerRegion};var u=uniformMaps[materialId];if(u.uniformMap=uniforms.map,u.values=uniforms.values,u.jointMatrixUniformName=uniforms.jointMatrixUniformName,u.morphWeightsUniformName=uniforms.morphWeightsUniformName,Cesium.defined(technique.attributes.a_outlineCoordinates)){var outlineTexture=ModelOutlineLoader_default.createTexture(model,context);u.uniformMap.u_outlineTexture=function(){return outlineTexture}}})}}function createUniformsForDracoQuantizedAttributes2(decodedData){return ModelUtility_default.createUniformsForDracoQuantizedAttributes(decodedData.attributes)}function createUniformsForQuantizedAttributes2(model,primitive){var programId=getProgramForPrimitive2(model,primitive),quantizedUniforms=model._quantizedUniforms[programId];return ModelUtility_default.createUniformsForQuantizedAttributes(model.gltf,primitive,quantizedUniforms)}function createPickColorFunction2(color){return function(){return color}}function createJointMatricesFunction2(runtimeNode){return function(){return runtimeNode.computedJointMatrices}}function createMorphWeightsFunction2(runtimeNode){return function(){return runtimeNode.weights}}function createSilhouetteColorFunction(model){return function(){return model.silhouetteColor}}function createSilhouetteSizeFunction(model){return function(){return model.silhouetteSize}}function createColorFunction2(model){return function(){return model.color}}var scratchClippingPlaneMatrix2=new Cesium.Matrix4;function createClippingPlanesMatrixFunction2(model){return function(){var clippingPlanes=model.clippingPlanes;if(!Cesium.defined(clippingPlanes)&&!Cesium.defined(model._sphericalHarmonicCoefficients)&&!Cesium.defined(model._specularEnvironmentMaps))return Cesium.Matrix4.IDENTITY;var modelMatrix=Cesium.defined(clippingPlanes)?clippingPlanes.modelMatrix:Cesium.Matrix4.IDENTITY;return Cesium.Matrix4.multiply(model._clippingPlaneModelViewMatrix,modelMatrix,scratchClippingPlaneMatrix2)}}function createClippingPlanesFunction2(model){return function(){var clippingPlanes=model.clippingPlanes;return!Cesium.defined(clippingPlanes)||!clippingPlanes.enabled?model._defaultTexture:clippingPlanes.texture}}function createClippingPlanesEdgeStyleFunction2(model){return function(){var clippingPlanes=model.clippingPlanes;if(!Cesium.defined(clippingPlanes))return Cesium.Color.WHITE.withAlpha(0);var style=Cesium.Color.clone(clippingPlanes.edgeColor);return style.alpha=clippingPlanes.edgeWidth,style}}function createColorBlendFunction2(model){return function(){return Cesium.ColorBlendMode.getColorBlend(model.colorBlendMode,model.colorBlendAmount)}}function createIBLFactorFunction2(model){return function(){return model._imageBasedLightingFactor}}function createLightColorFunction2(model){return function(){return model._lightColor}}function createLuminanceAtZenithFunction2(model){return function(){return model.luminanceAtZenith}}function createSphericalHarmonicCoefficientsFunction2(model){return function(){return model._sphericalHarmonicCoefficients}}function createSpecularEnvironmentMapFunction2(model){return function(){return model._specularEnvironmentMapAtlas.texture}}function createSpecularEnvironmentMapSizeFunction2(model){return function(){return model._specularEnvironmentMapAtlas.texture.dimensions}}function createSpecularEnvironmentMapLOD2(model){return function(){return model._specularEnvironmentMapAtlas.maximumMipmapLevel}}function triangleCountFromPrimitiveIndices2(primitive,indicesCount){switch(primitive.mode){case Cesium.PrimitiveType.TRIANGLES:return indicesCount/3;case Cesium.PrimitiveType.TRIANGLE_STRIP:case Cesium.PrimitiveType.TRIANGLE_FAN:return Math.max(indicesCount-2,0);default:return 0}}function createCommand(model,gltfNode,runtimeNode,context,scene3DOnly){for(var nodeCommands=model._nodeCommands,pickIds=model._pickIds,allowPicking=model.allowPicking,runtimeMeshesByName=model._runtime.meshesByName,resources=model._rendererResources,rendererVertexArrays=resources.vertexArrays,rendererPrograms=resources.programs,rendererRenderStates=resources.renderStates,uniformMaps=model._uniformMaps,gltf=model.gltf,accessors=gltf.accessors,gltfMeshes=gltf.meshes,id=gltfNode.mesh,mesh=gltfMeshes[id],primitives=mesh.primitives,length3=primitives.length,i=0;i<length3;++i){var primitive=primitives[i],ix=accessors[primitive.indices],material=model._runtime.materialsById[primitive.material],programId=material._program,decodedData=model._decodedData[id+".primitive."+i],boundingSphere,positionAccessor=primitive.attributes.POSITION;if(Cesium.defined(positionAccessor)){var minMax=ModelUtility_default.getAccessorMinMax(gltf,positionAccessor);boundingSphere=Cesium.BoundingSphere.fromCornerPoints(Cesium.Cartesian3.fromArray(minMax.min),Cesium.Cartesian3.fromArray(minMax.max))}var vertexArray=rendererVertexArrays[id+".primitive."+i],offset,count2;if(Cesium.defined(decodedData))count2=decodedData.numberOfIndices,offset=0;else if(Cesium.defined(ix))count2=ix.count,offset=ix.byteOffset/Cesium.IndexDatatype.getSizeInBytes(ix.componentType);else{var positions=accessors[primitive.attributes.POSITION];count2=positions.count,offset=0}model._trianglesLength+=triangleCountFromPrimitiveIndices2(primitive,count2);var um=uniformMaps[primitive.material],uniformMap=um.uniformMap;if(Cesium.defined(um.jointMatrixUniformName)){var jointUniformMap={};jointUniformMap[um.jointMatrixUniformName]=createJointMatricesFunction2(runtimeNode),uniformMap=Cesium.combine(uniformMap,jointUniformMap)}if(model._tilesetFlat&&(uniformMap=Cesium.combine(uniformMap,model._tilesetFlat._updateModelUniformMap())),Cesium.defined(um.morphWeightsUniformName)){var morphWeightsUniformMap={};morphWeightsUniformMap[um.morphWeightsUniformName]=createMorphWeightsFunction2(runtimeNode),uniformMap=Cesium.combine(uniformMap,morphWeightsUniformMap)}uniformMap=Cesium.combine(uniformMap,{gltf_color:createColorFunction2(model),gltf_colorBlend:createColorBlendFunction2(model),gltf_clippingPlanes:createClippingPlanesFunction2(model),gltf_clippingPlanesEdgeStyle:createClippingPlanesEdgeStyleFunction2(model),gltf_clippingPlanesMatrix:createClippingPlanesMatrixFunction2(model),gltf_iblFactor:createIBLFactorFunction2(model),gltf_lightColor:createLightColorFunction2(model),gltf_sphericalHarmonicCoefficients:createSphericalHarmonicCoefficientsFunction2(model),gltf_specularMap:createSpecularEnvironmentMapFunction2(model),gltf_specularMapSize:createSpecularEnvironmentMapSizeFunction2(model),gltf_maxSpecularLOD:createSpecularEnvironmentMapLOD2(model),gltf_luminanceAtZenith:createLuminanceAtZenithFunction2(model)}),Cesium.defined(model._uniformMapLoaded)&&(uniformMap=model._uniformMapLoaded(uniformMap,programId,runtimeNode));var quantizedUniformMap={};model.extensionsUsed.WEB3D_quantized_attributes?quantizedUniformMap=createUniformsForQuantizedAttributes2(model,primitive):model._dequantizeInShader&&Cesium.defined(decodedData)&&(quantizedUniformMap=createUniformsForDracoQuantizedAttributes2(decodedData)),uniformMap=Cesium.combine(uniformMap,quantizedUniformMap);var rs=rendererRenderStates[primitive.material],isTranslucent2=rs.blending.enabled,owner=model._pickObject;Cesium.defined(owner)||(owner={primitive:model,id:model.id,node:runtimeNode.publicNode,mesh:runtimeMeshesByName[mesh.name]});var castShadows=Cesium.ShadowMode.castShadows(model._shadows),receiveShadows=Cesium.ShadowMode.receiveShadows(model._shadows),pickId;if(allowPicking&&!Cesium.defined(model._uniformMapLoaded)){pickId=context.createPickId(owner),pickIds.push(pickId);var pickUniforms={czm_pickColor:createPickColorFunction2(pickId.color)};uniformMap=Cesium.combine(uniformMap,pickUniforms)}allowPicking&&(Cesium.defined(model._pickIdLoaded)&&Cesium.defined(model._uniformMapLoaded)?pickId=model._pickIdLoaded():pickId="czm_pickColor");var command=new Cesium.DrawCommand({boundingVolume:new Cesium.BoundingSphere,cull:model.cull,modelMatrix:new Cesium.Matrix4,primitiveType:primitive.mode,vertexArray,count:count2,offset,shaderProgram:rendererPrograms[programId],castShadows,receiveShadows,uniformMap,renderState:rs,owner,pass:isTranslucent2?Cesium.Pass.TRANSLUCENT:model.opaquePass,pickId}),command2D;scene3DOnly||(command2D=Cesium.DrawCommand.shallowClone(command),command2D.boundingVolume=new Cesium.BoundingSphere,command2D.modelMatrix=new Cesium.Matrix4);var nodeCommand={show:!0,boundingSphere,command,command2D,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,programId};runtimeNode.commands.push(nodeCommand),nodeCommands.push(nodeCommand)}}function createRuntimeNodes(model,context,frameState){var loadResources=model._loadResources;if(!!loadResources.finishedEverythingButTextureCreation()&&!!loadResources.createRuntimeNodes){loadResources.createRuntimeNodes=!1;for(var rootNodes=[],runtimeNodes=model._runtime.nodes,gltf=model.gltf,nodes=gltf.nodes,scene=gltf.scenes[gltf.scene],sceneNodes=scene.nodes,length3=sceneNodes.length,stack=[],seen={},instanceCollections=new Cesium.AssociativeArray,blGltfInstance=!1,gltfVersion=gltf.asset.version,i=0;i<length3;++i)for(stack.push({parentRuntimeNode:void 0,gltfNode:nodes[sceneNodes[i]],id:sceneNodes[i]});stack.length>0;){var n=stack.pop();seen[n.id]=!0;var parentRuntimeNode=n.parentRuntimeNode,gltfNode=n.gltfNode,runtimeNode=runtimeNodes[n.id];if(runtimeNode.parents.length===0)if(Cesium.defined(gltfNode.matrix))runtimeNode.matrix=Cesium.Matrix4.fromColumnMajorArray(gltfNode.matrix);else{var rotation2=gltfNode.rotation;runtimeNode.translation=Cesium.Cartesian3.fromArray(gltfNode.translation),runtimeNode.rotation=Cesium.Quaternion.unpack(rotation2),runtimeNode.scale=Cesium.Cartesian3.fromArray(gltfNode.scale)}if(Cesium.defined(parentRuntimeNode)?(parentRuntimeNode.children.push(runtimeNode),runtimeNode.parents.push(parentRuntimeNode)):rootNodes.push(runtimeNode),Cesium.defined(gltfNode.instanceIndex)&&Cesium.defined(model.content)&&gltfVersion=="2.0"){var meshID=gltfNode.mesh;if(model.content.constructor.name==="Batched3DModel3DTileContent")if(Cesium.defined(gltfNode.matrix)){var instanceMat4=Cesium.Matrix4.clone(gltfNode.matrix,new Cesium.Matrix4);instanceMat4[1]=-gltfNode.matrix[2],instanceMat4[2]=gltfNode.matrix[1],instanceMat4[4]=-gltfNode.matrix[8],instanceMat4[5]=gltfNode.matrix[10],instanceMat4[6]=-gltfNode.matrix[9],instanceMat4[8]=gltfNode.matrix[4],instanceMat4[9]=-gltfNode.matrix[6],instanceMat4[10]=gltfNode.matrix[5],instanceMat4[13]=-gltfNode.matrix[14],instanceMat4[14]=gltfNode.matrix[13],instanceCollections.contains(meshID)?instanceCollections.get(meshID).push({_modelMatrix:instanceMat4,_nodeId:n.id,_instanceId:gltfNode.instanceIndex}):instanceCollections.set(meshID,[{_modelMatrix:instanceMat4,_nodeId:n.id,_instanceId:gltfNode.instanceIndex}])}else console.log("node.matrix is empty");blGltfInstance=!0}else Cesium.defined(gltfNode.mesh)&&createCommand(model,gltfNode,runtimeNode,context,frameState.scene3DOnly);var children=gltfNode.children;if(Cesium.defined(children))for(var childrenLength=children.length,j=0;j<childrenLength;j++){var childId=children[j];seen[childId]||stack.push({parentRuntimeNode:runtimeNode,gltfNode:nodes[childId],id:children[j]})}}model.ev_E3MInternalInstance&&(blGltfInstance&&instanceCollections.length>0&&model.content.constructor.name==="Batched3DModel3DTileContent"?(model._releaseGltfJson=!1,model.ev_E3MInternalInstance.generateInstanceCommandByGltf(model,context,instanceCollections,frameState)):blGltfInstance&&model.content.constructor.name==="Instanced3DModel3DTileContent"&&(nodes[0].matrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),runtimeNodes[0].matrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),createCommand(model,nodes[0],runtimeNodes[0],context,frameState.scene3DOnly))),model._runtime.rootNodes=rootNodes,model._runtime.nodes=runtimeNodes}}function getGeometryByteLength(buffers){var memory=0;for(var id in buffers)buffers.hasOwnProperty(id)&&(memory+=buffers[id].sizeInBytes);return memory}function getTexturesByteLength(textures){var memory=0;for(var id in textures)textures.hasOwnProperty(id)&&(memory+=textures[id].sizeInBytes);return memory}function createResources2(model,frameState){var context=frameState.context,scene3DOnly=frameState.scene3DOnly,quantizedVertexShaders=model._quantizedVertexShaders,toClipCoordinates=model._toClipCoordinatesGLSL={},techniques=model._sourceTechniques,programs=model._sourcePrograms,resources=model._rendererResources,shaders=resources.sourceShaders;model._loadRendererResourcesFromCache&&(shaders=resources.sourceShaders=model._cachedRendererResources.sourceShaders);for(var techniqueId in techniques)if(techniques.hasOwnProperty(techniqueId)){var programId=techniques[techniqueId].program,program=programs[programId],shader=shaders[program.vertexShader];if(ModelUtility_default.checkSupportedGlExtensions(program.glExtensions,context),model.extensionsUsed.WEB3D_quantized_attributes||model._dequantizeInShader){var quantizedVS=quantizedVertexShaders[programId];Cesium.defined(quantizedVS)||(quantizedVS=modifyShaderForQuantizedAttributes2(shader,programId,model),quantizedVertexShaders[programId]=quantizedVS),shader=quantizedVS}shader=modifyShader2(shader,programId,model._vertexShaderLoaded),toClipCoordinates[programId]=ModelUtility_default.toClipCoordinatesGLSL(model.gltf,shader)}if(model._loadRendererResourcesFromCache){var cachedResources=model._cachedRendererResources;resources.buffers=cachedResources.buffers,resources.vertexArrays=cachedResources.vertexArrays,resources.programs=cachedResources.programs,resources.silhouettePrograms=cachedResources.silhouettePrograms,resources.textures=cachedResources.textures,resources.samplers=cachedResources.samplers,resources.renderStates=cachedResources.renderStates,Cesium.defined(model._precreatedAttributes)&&createVertexArrays2(model,context),model._cachedGeometryByteLength+=getGeometryByteLength(cachedResources.buffers),model._cachedTexturesByteLength+=getTexturesByteLength(cachedResources.textures)}else createBuffers(model,frameState),createPrograms(model,frameState),createSamplers(model,context),loadTexturesFromBufferViews(model),createTextures(model,frameState);createSkins(model),createRuntimeAnimations(model),model._loadRendererResourcesFromCache||(createVertexArrays2(model,context),createRenderStates(model)),createUniformMaps(model,context),createRuntimeNodes(model,context,frameState)}function getNodeMatrix(node,result){var publicNode=node.publicNode,publicMatrix=publicNode.matrix;publicNode.useMatrix&&Cesium.defined(publicMatrix)?Cesium.Matrix4.clone(publicMatrix,result):Cesium.defined(node.matrix)?Cesium.Matrix4.clone(node.matrix,result):(Cesium.Matrix4.fromTranslationQuaternionRotationScale(node.translation,node.rotation,node.scale,result),publicNode.setMatrix(result))}var scratchNodeStack=[],scratchComputedTranslation=new Cesium.Cartesian4,scratchComputedMatrixIn2D=new Cesium.Matrix4;function updateNodeHierarchyModelMatrix(model,modelTransformChanged,justLoaded,projection2){var maxDirtyNumber=model._maxDirtyNumber,rootNodes=model._runtime.rootNodes,length3=rootNodes.length,nodeStack=scratchNodeStack,computedModelMatrix=model._computedModelMatrix;if(model._mode!==Cesium.SceneMode.SCENE3D&&!model._ignoreCommands){var translation=Cesium.Matrix4.getColumn(computedModelMatrix,3,scratchComputedTranslation);if(!Cesium.Cartesian4.equals(translation,Cesium.Cartesian4.UNIT_W))computedModelMatrix=Cesium.Transforms.basisTo2D(projection2,computedModelMatrix,scratchComputedMatrixIn2D),model._rtcCenter=model._rtcCenter3D;else{var center2=model.boundingSphere.center,to2D=Cesium.Transforms.wgs84To2DModelMatrix(projection2,center2,scratchComputedMatrixIn2D);computedModelMatrix=Cesium.Matrix4.multiply(to2D,computedModelMatrix,scratchComputedMatrixIn2D),Cesium.defined(model._rtcCenter)&&(Cesium.Matrix4.setTranslation(computedModelMatrix,Cesium.Cartesian4.UNIT_W,computedModelMatrix),model._rtcCenter=model._rtcCenter2D)}}var axisTransformMat4=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY);model._upAxis===Cesium.Axis.Y?Cesium.Matrix4.multiplyTransformation(axisTransformMat4,Cesium.Axis.Y_UP_TO_Z_UP,axisTransformMat4):model._upAxis===Cesium.Axis.X&&Cesium.Matrix4.multiplyTransformation(axisTransformMat4,Cesium.Axis.X_UP_TO_Z_UP,axisTransformMat4),model.forwardAxis===Cesium.Axis.Z&&Cesium.Matrix4.multiplyTransformation(axisTransformMat4,Cesium.Axis.Z_UP_TO_X_UP,axisTransformMat4);for(var i=0;i<length3;++i){var n=rootNodes[i];for(getNodeMatrix(n,n.transformToRoot),nodeStack.push(n);nodeStack.length>0;){n=nodeStack.pop();var transformToRoot=n.transformToRoot,commands=n.commands;if(n.dirtyNumber===maxDirtyNumber||modelTransformChanged||justLoaded){var nodeMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY);!Cesium.defined(n.gltfInstaced)||!n.gltfInstaced?nodeMatrix=Cesium.Matrix4.multiplyTransformation(computedModelMatrix,transformToRoot,n.computedMatrix):nodeMatrix=Cesium.Matrix4.multiplyTransformation(axisTransformMat4,transformToRoot,n.computedMatrix);var commandsLength=commands.length;if(commandsLength>0)for(var j=0;j<commandsLength;++j){var primitiveCommand=commands[j],command=primitiveCommand.command;Cesium.Matrix4.clone(nodeMatrix,command.modelMatrix),(!Cesium.defined(n.gltfInstaced)||!n.gltfInstaced)&&Cesium.BoundingSphere.transform(primitiveCommand.boundingSphere,command.modelMatrix,command.boundingVolume),Cesium.defined(model._rtcCenter)&&Cesium.Cartesian3.add(model._rtcCenter,command.boundingVolume.center,command.boundingVolume.center),command=primitiveCommand.command2D,Cesium.defined(command)&&model._mode===Cesium.SceneMode.SCENE2D&&(Cesium.Matrix4.clone(nodeMatrix,command.modelMatrix),command.modelMatrix[13]-=Cesium.Math.sign(command.modelMatrix[13])*2*Cesium.Math.PI*projection2.ellipsoid.maximumRadius,Cesium.BoundingSphere.transform(primitiveCommand.boundingSphere,command.modelMatrix,command.boundingVolume))}}var children=n.children;if(Cesium.defined(children))for(var childrenLength=children.length,k=0;k<childrenLength;++k){var child=children[k];child.dirtyNumber=Math.max(child.dirtyNumber,n.dirtyNumber),(child.dirtyNumber===maxDirtyNumber||justLoaded)&&(getNodeMatrix(child,child.transformToRoot),Cesium.Matrix4.multiplyTransformation(transformToRoot,child.transformToRoot,child.transformToRoot)),nodeStack.push(child)}}}++model._maxDirtyNumber}var scratchObjectSpace=new Cesium.Matrix4;function applySkins(model){for(var skinnedNodes=model._runtime.skinnedNodes,length3=skinnedNodes.length,i=0;i<length3;++i){var node=skinnedNodes[i];scratchObjectSpace=Cesium.Matrix4.inverseTransformation(node.transformToRoot,scratchObjectSpace);for(var computedJointMatrices=node.computedJointMatrices,joints=node.joints,bindShapeMatrix=node.bindShapeMatrix,inverseBindMatrices=node.inverseBindMatrices,inverseBindMatricesLength=inverseBindMatrices.length,m=0;m<inverseBindMatricesLength;++m)Cesium.defined(computedJointMatrices[m])||(computedJointMatrices[m]=new Cesium.Matrix4),computedJointMatrices[m]=Cesium.Matrix4.multiplyTransformation(scratchObjectSpace,joints[m].transformToRoot,computedJointMatrices[m]),computedJointMatrices[m]=Cesium.Matrix4.multiplyTransformation(computedJointMatrices[m],inverseBindMatrices[m],computedJointMatrices[m]),Cesium.defined(bindShapeMatrix)&&(computedJointMatrices[m]=Cesium.Matrix4.multiplyTransformation(computedJointMatrices[m],bindShapeMatrix,computedJointMatrices[m]))}}function updatePerNodeShow(model){for(var rootNodes=model._runtime.rootNodes,length3=rootNodes.length,nodeStack=scratchNodeStack,i=0;i<length3;++i){var n=rootNodes[i];for(n.computedShow=n.publicNode.show,nodeStack.push(n);nodeStack.length>0;){n=nodeStack.pop();for(var show=n.computedShow,nodeCommands=n.commands,nodeCommandsLength=nodeCommands.length,j=0;j<nodeCommandsLength;++j)nodeCommands[j].show=show;var children=n.children;if(Cesium.defined(children))for(var childrenLength=children.length,k=0;k<childrenLength;++k){var child=children[k];child.computedShow=show&&child.publicNode.show,nodeStack.push(child)}}}}function updatePickIds(model,context){var id=model.id;if(model._id!==id){model._id=id;for(var pickIds=model._pickIds,length3=pickIds.length,i=0;i<length3;++i)pickIds[i].object.id=id}}function updateWireframe2(model){if(model._debugWireframe!==model.debugWireframe){model._debugWireframe=model.debugWireframe;for(var primitiveType=model.debugWireframe?Cesium.PrimitiveType.LINES:Cesium.PrimitiveType.TRIANGLES,nodeCommands=model._nodeCommands,length3=nodeCommands.length,i=0;i<length3;++i)nodeCommands[i].command.primitiveType=primitiveType}}function updateShowBoundingVolume2(model){if(model.debugShowBoundingVolume!==model._debugShowBoundingVolume){model._debugShowBoundingVolume=model.debugShowBoundingVolume;for(var debugShowBoundingVolume=model.debugShowBoundingVolume,nodeCommands=model._nodeCommands,length3=nodeCommands.length,i=0;i<length3;++i)nodeCommands[i].command.debugShowBoundingVolume=debugShowBoundingVolume}}function updateShadows2(model){if(model.shadows!==model._shadows){model._shadows=model.shadows;for(var castShadows=Cesium.ShadowMode.castShadows(model.shadows),receiveShadows=Cesium.ShadowMode.receiveShadows(model.shadows),nodeCommands=model._nodeCommands,length3=nodeCommands.length,i=0;i<length3;i++){var nodeCommand=nodeCommands[i];nodeCommand.command.castShadows=castShadows,nodeCommand.command.receiveShadows=receiveShadows}}}function getTranslucentRenderState2(renderState){var rs=Cesium.clone(renderState,!0);return rs.cull.enabled=!1,rs.depthTest.enabled=!0,rs.depthMask=!1,rs.blending=Cesium.BlendingState.ALPHA_BLEND,Cesium.RenderState.fromCache(rs)}function deriveTranslucentCommand2(command){var translucentCommand=Cesium.DrawCommand.shallowClone(command);return translucentCommand.pass=Cesium.Pass.TRANSLUCENT,translucentCommand.renderState=getTranslucentRenderState2(command.renderState),translucentCommand}function updateColor(model,frameState,forceDerive){var scene3DOnly=frameState.scene3DOnly,alpha=model.color.alpha;if(alpha>0&&alpha<1){var nodeCommands=model._nodeCommands,length3=nodeCommands.length;if(length3>0&&!Cesium.defined(nodeCommands[0].translucentCommand)||forceDerive)for(var i=0;i<length3;++i){var nodeCommand=nodeCommands[i],command=nodeCommand.command;if(nodeCommand.translucentCommand=deriveTranslucentCommand2(command),!scene3DOnly){var command2D=nodeCommand.command2D;nodeCommand.translucentCommand2D=deriveTranslucentCommand2(command2D)}}}}function getProgramId(model,program){var programs=model._rendererResources.programs;for(var id in programs)if(programs.hasOwnProperty(id)&&programs[id]===program)return id}function createSilhouetteProgram(model,program,frameState){var vs=program.vertexShaderSource.sources[0],attributeLocations=program._attributeLocations,normalAttributeName=model._normalAttributeName;vs=Cesium.ShaderSource.replaceMain(vs,"gltf_silhouette_main"),vs+=`uniform float gltf_silhouetteSize; 
void main() 
{ 
    gltf_silhouette_main(); 
    vec3 n = normalize(czm_normal3D * `+normalAttributeName+`); 
    n.x *= czm_projection[0][0]; 
    n.y *= czm_projection[1][1]; 
    vec4 clip = gl_Position; 
    clip.xy += n.xy * clip.w * gltf_silhouetteSize * czm_pixelRatio / czm_viewport.z; 
    gl_Position = clip; 
}`;var fs=`uniform vec4 gltf_silhouetteColor; 
void main() 
{ 
    gl_FragColor = czm_gammaCorrect(gltf_silhouetteColor); 
}`;return Cesium.ShaderProgram.fromCache({context:frameState.context,vertexShaderSource:vs,fragmentShaderSource:fs,attributeLocations})}function hasSilhouette(model,frameState){return silhouetteSupported(frameState.context)&&model.silhouetteSize>0&&model.silhouetteColor.alpha>0&&Cesium.defined(model._normalAttributeName)}function hasTranslucentCommands(model){for(var nodeCommands=model._nodeCommands,length3=nodeCommands.length,i=0;i<length3;++i){var nodeCommand=nodeCommands[i],command=nodeCommand.command;if(command.pass===Cesium.Pass.TRANSLUCENT)return!0}return!1}function isTranslucent(model){return model.color.alpha>0&&model.color.alpha<1}function isInvisible(model){return model.color.alpha===0}function alphaDirty(currAlpha,prevAlpha){return Math.floor(currAlpha)!==Math.floor(prevAlpha)||Math.ceil(currAlpha)!==Math.ceil(prevAlpha)}var silhouettesLength=0;function createSilhouetteCommands(model,frameState){for(var stencilReference=++silhouettesLength%255,silhouetteTranslucent=hasTranslucentCommands(model)||isTranslucent(model)||model.silhouetteColor.alpha<1,silhouettePrograms=model._rendererResources.silhouettePrograms,scene3DOnly=frameState.scene3DOnly,nodeCommands=model._nodeCommands,length3=nodeCommands.length,i=0;i<length3;++i){var nodeCommand=nodeCommands[i],command=nodeCommand.command,modelCommand=isTranslucent(model)?nodeCommand.translucentCommand:command,silhouetteModelCommand=Cesium.DrawCommand.shallowClone(modelCommand),renderState=Cesium.clone(modelCommand.renderState);renderState.stencilTest={enabled:!0,frontFunction:Cesium.WebGLConstants.ALWAYS,backFunction:Cesium.WebGLConstants.ALWAYS,reference:stencilReference,mask:-1,frontOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.REPLACE},backOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.REPLACE}},isInvisible(model)&&(renderState.colorMask={red:!1,green:!1,blue:!1,alpha:!1},renderState.depthMask=!1),renderState=Cesium.RenderState.fromCache(renderState),silhouetteModelCommand.renderState=renderState,nodeCommand.silhouetteModelCommand=silhouetteModelCommand;var silhouetteColorCommand=Cesium.DrawCommand.shallowClone(command);renderState=Cesium.clone(command.renderState,!0),renderState.depthTest.enabled=!0,renderState.cull.enabled=!1,silhouetteTranslucent&&(silhouetteColorCommand.pass=Cesium.Pass.TRANSLUCENT,renderState.depthMask=!1,renderState.blending=Cesium.BlendingState.ALPHA_BLEND),renderState.stencilTest={enabled:!0,frontFunction:Cesium.WebGLConstants.NOTEQUAL,backFunction:Cesium.WebGLConstants.NOTEQUAL,reference:stencilReference,mask:-1,frontOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.KEEP},backOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.KEEP}},renderState=Cesium.RenderState.fromCache(renderState);var program=command.shaderProgram,id=getProgramId(model,program),silhouetteProgram=silhouettePrograms[id];Cesium.defined(silhouetteProgram)||(silhouetteProgram=createSilhouetteProgram(model,program,frameState),silhouettePrograms[id]=silhouetteProgram);var silhouetteUniformMap=Cesium.combine(command.uniformMap,{gltf_silhouetteColor:createSilhouetteColorFunction(model),gltf_silhouetteSize:createSilhouetteSizeFunction(model)});if(silhouetteColorCommand.renderState=renderState,silhouetteColorCommand.shaderProgram=silhouetteProgram,silhouetteColorCommand.uniformMap=silhouetteUniformMap,silhouetteColorCommand.castShadows=!1,silhouetteColorCommand.receiveShadows=!1,nodeCommand.silhouetteColorCommand=silhouetteColorCommand,!scene3DOnly){var command2D=nodeCommand.command2D,silhouetteModelCommand2D=Cesium.DrawCommand.shallowClone(silhouetteModelCommand);silhouetteModelCommand2D.boundingVolume=command2D.boundingVolume,silhouetteModelCommand2D.modelMatrix=command2D.modelMatrix,nodeCommand.silhouetteModelCommand2D=silhouetteModelCommand2D;var silhouetteColorCommand2D=Cesium.DrawCommand.shallowClone(silhouetteColorCommand);silhouetteModelCommand2D.boundingVolume=command2D.boundingVolume,silhouetteModelCommand2D.modelMatrix=command2D.modelMatrix,nodeCommand.silhouetteColorCommand2D=silhouetteColorCommand2D}}}function modifyShaderForClippingPlanes2(shader,clippingPlaneCollection,context){return shader=Cesium.ShaderSource.replaceMain(shader,"gltf_clip_main"),shader+=Model._getClippingFunction(clippingPlaneCollection,context)+`
`,shader+=`uniform sampler2D gltf_clippingPlanes; 
uniform mat4 gltf_clippingPlanesMatrix; 
uniform vec4 gltf_clippingPlanesEdgeStyle; 
void main() 
{ 
    gltf_clip_main(); 
`+Cesium.getClipAndStyleCode("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")+`} 
`,shader=shader.replace("czm_transformPlane(","czm_transformPlaneOld("),shader}function updateSilhouette(model,frameState,force){if(!!hasSilhouette(model,frameState)){var nodeCommands=model._nodeCommands,dirty=alphaDirty(model.color.alpha,model._colorPreviousAlpha)||alphaDirty(model.silhouetteColor.alpha,model._silhouetteColorPreviousAlpha)||!Cesium.defined(nodeCommands[0].silhouetteModelCommand);model._colorPreviousAlpha=model.color.alpha,model._silhouetteColorPreviousAlpha=model.silhouetteColor.alpha,(dirty||force)&&createSilhouetteCommands(model,frameState)}}function updateClippingPlanes(model,frameState){var clippingPlanes=model._clippingPlanes;Cesium.defined(clippingPlanes)&&clippingPlanes.owner===model&&clippingPlanes.enabled&&clippingPlanes.update(frameState)}var scratchBoundingSphere=new Cesium.BoundingSphere;function scaleInPixels(positionWC,radius,frameState){return scratchBoundingSphere.center=positionWC,scratchBoundingSphere.radius=radius,frameState.camera.getPixelSize(scratchBoundingSphere,frameState.context.drawingBufferWidth,frameState.context.drawingBufferHeight)}var scratchPosition=new Cesium.Cartesian3,scratchCartographic=new Cesium.Cartographic;function getScale(model,frameState){var scale4=model.scale;if(model.minimumPixelSize!==0){var context=frameState.context,maxPixelSize=Math.max(context.drawingBufferWidth,context.drawingBufferHeight),m=Cesium.defined(model._clampedModelMatrix)?model._clampedModelMatrix:model.modelMatrix;if(scratchPosition.x=m[12],scratchPosition.y=m[13],scratchPosition.z=m[14],Cesium.defined(model._rtcCenter)&&Cesium.Cartesian3.add(model._rtcCenter,scratchPosition,scratchPosition),model._mode!==Cesium.SceneMode.SCENE3D){var projection2=frameState.mapProjection,cartographic=projection2.ellipsoid.cartesianToCartographic(scratchPosition,scratchCartographic);projection2.project(cartographic,scratchPosition),Cesium.Cartesian3.fromElements(scratchPosition.z,scratchPosition.x,scratchPosition.y,scratchPosition)}var radius=model.boundingSphere.radius,metersPerPixel=scaleInPixels(scratchPosition,radius,frameState),pixelsPerMeter=1/metersPerPixel,diameterInPixels=Math.min(pixelsPerMeter*(2*radius),maxPixelSize);diameterInPixels<model.minimumPixelSize&&(scale4=model.minimumPixelSize*metersPerPixel/(2*model._initialRadius))}return Cesium.defined(model.maximumScale)?Math.min(model.maximumScale,scale4):scale4}function releaseCachedGltf(model){Cesium.defined(model._cacheKey)&&Cesium.defined(model._cachedGltf)&&--model._cachedGltf.count===0&&delete gltfCache[model._cacheKey],model._cachedGltf=void 0}function CachedRendererResources(context,cacheKey){this.buffers=void 0,this.vertexArrays=void 0,this.programs=void 0,this.sourceShaders=void 0,this.silhouettePrograms=void 0,this.textures=void 0,this.samplers=void 0,this.renderStates=void 0,this.ready=!1,this.context=context,this.cacheKey=cacheKey,this.count=0}function destroy2(property){for(var name in property)property.hasOwnProperty(name)&&(property[name].isDestroyed()||property[name].destroy())}function destroyCachedRendererResources(resources){destroy2(resources.buffers),destroy2(resources.vertexArrays),destroy2(resources.programs),destroy2(resources.silhouettePrograms),destroy2(resources.textures)}CachedRendererResources.prototype.release=function(){if(--this.count===0)return Cesium.defined(this.cacheKey)&&delete this.context.cache.modelRendererResourceCache[this.cacheKey],destroyCachedRendererResources(this),Cesium.destroyObject(this)};function getUpdateHeightCallback(model,ellipsoid,cartoPosition){return function(clampedPosition){if(model.heightReference===Cesium.HeightReference.RELATIVE_TO_GROUND){var clampedCart=ellipsoid.cartesianToCartographic(clampedPosition,scratchCartographic);clampedCart.height+=cartoPosition.height,ellipsoid.cartographicToCartesian(clampedCart,clampedPosition)}var clampedModelMatrix=model._clampedModelMatrix;Cesium.Matrix4.clone(model.modelMatrix,clampedModelMatrix),clampedModelMatrix[12]=clampedPosition.x,clampedModelMatrix[13]=clampedPosition.y,clampedModelMatrix[14]=clampedPosition.z,model._heightChanged=!0}}function updateClamping(model){Cesium.defined(model._removeUpdateHeightCallback)&&(model._removeUpdateHeightCallback(),model._removeUpdateHeightCallback=void 0);var scene=model._scene;if(!Cesium.defined(scene)||!Cesium.defined(scene.globe)||model.heightReference===Cesium.HeightReference.NONE){model._clampedModelMatrix=void 0;return}var globe=scene.globe,ellipsoid=globe.ellipsoid,modelMatrix=model.modelMatrix;scratchPosition.x=modelMatrix[12],scratchPosition.y=modelMatrix[13],scratchPosition.z=modelMatrix[14];var cartoPosition=ellipsoid.cartesianToCartographic(scratchPosition);Cesium.defined(model._clampedModelMatrix)||(model._clampedModelMatrix=Cesium.Matrix4.clone(modelMatrix,new Cesium.Matrix4));var surface=globe._surface;model._removeUpdateHeightCallback=surface.updateHeight(cartoPosition,getUpdateHeightCallback(model,ellipsoid,cartoPosition));var height2=globe.getHeight(cartoPosition);if(Cesium.defined(height2)){var cb=getUpdateHeightCallback(model,ellipsoid,cartoPosition);Cesium.Cartographic.clone(cartoPosition,scratchCartographic),scratchCartographic.height=height2,ellipsoid.cartographicToCartesian(scratchCartographic,scratchPosition),cb(scratchPosition)}}var scratchDisplayConditionCartesian=new Cesium.Cartesian3,scratchDistanceDisplayConditionCartographic=new Cesium.Cartographic;function distanceDisplayConditionVisible(model,frameState){var distance22,ddc=model.distanceDisplayCondition,nearSquared=ddc.near*ddc.near,farSquared=ddc.far*ddc.far;if(frameState.mode===Cesium.SceneMode.SCENE2D){var frustum2DWidth=frameState.camera.frustum.right-frameState.camera.frustum.left;distance22=frustum2DWidth*.5,distance22=distance22*distance22}else{var position=Cesium.Matrix4.getTranslation(model.modelMatrix,scratchDisplayConditionCartesian);if(frameState.mode===Cesium.SceneMode.COLUMBUS_VIEW){var projection2=frameState.mapProjection,ellipsoid=projection2.ellipsoid,cartographic=ellipsoid.cartesianToCartographic(position,scratchDistanceDisplayConditionCartographic);position=projection2.project(cartographic,position),Cesium.Cartesian3.fromElements(position.z,position.x,position.y,position)}distance22=Cesium.Cartesian3.distanceSquared(position,frameState.camera.positionWC)}return distance22>=nearSquared&&distance22<=farSquared}Model.prototype.update=function(frameState){if(Cesium.defined(this._scene)||(this._scene=frameState.camera._scene),frameState.mode!==Cesium.SceneMode.MORPHING){if(!Cesium.FeatureDetection.supportsWebP.initialized){Cesium.FeatureDetection.supportsWebP.initialize();return}var supportsWebP2=Cesium.FeatureDetection.supportsWebP(),context=frameState.context;this._defaultTexture=context.defaultTexture;var scene=this._scene,globe=scene.globe;if(Cesium.defined(globe)&&globe.enableLighting){if(Cesium.defined(globe._surfaceNormal))var surfaceNormal=globe._surfaceNormal;else var cartographic=scene.camera.positionCartographic,ellipsoid=globe._surface._tileProvider.tilingScheme.ellipsoid,cartesian2=Cesium.Cartesian3.fromRadians(cartographic.longitude,cartographic.latitude,0,ellipsoid),surfaceNormal=ellipsoid.geodeticSurfaceNormal(cartesian2);var lightDirection=scene.context._us.lightDirectionWC,diffuse=Cesium.Cartesian3.dot(surfaceNormal,lightDirection);if((!this.hasDiffuse||!!Math.ceil(this.hasDiffuse)!=!!Math.ceil(diffuse))&&this._runtime&&this._runtime.materialsById){var specular=diffuse>0?this.modelSpecular:0,materialsById=this._runtime.materialsById;for(var key in materialsById)Cesium.defined(materialsById[key]._values.u_specular)&&(materialsById[key]._values.u_specular[0]=specular),Cesium.defined(materialsById[key]._uniformMap.values)&&Cesium.defined(materialsById[key]._uniformMap.values.u_specular)&&(materialsById[key]._uniformMap.values.u_specular.value.x=specular);this.hasDiffuse=diffuse}}if(this._state===ModelState.NEEDS_LOAD&&Cesium.defined(this.gltf)){var cachedRendererResources,cacheKey=this.cacheKey;if(Cesium.defined(cacheKey)){context.cache.modelRendererResourceCache=Cesium.defaultValue(context.cache.modelRendererResourceCache,{});var modelCaches=context.cache.modelRendererResourceCache;if(cachedRendererResources=modelCaches[this.cacheKey],Cesium.defined(cachedRendererResources)){if(!cachedRendererResources.ready)return;++cachedRendererResources.count,this._loadRendererResourcesFromCache=!0}else cachedRendererResources=new CachedRendererResources(context,cacheKey),cachedRendererResources.count=1,modelCaches[this.cacheKey]=cachedRendererResources;this._cachedRendererResources=cachedRendererResources}else cachedRendererResources=new CachedRendererResources(context),cachedRendererResources.count=1,this._cachedRendererResources=cachedRendererResources;if(this._state=ModelState.LOADING,this._state!==ModelState.FAILED){var extensions=this.gltf.extensions;if(Cesium.defined(extensions)&&Cesium.defined(extensions.CESIUM_RTC)){var center2=Cesium.Cartesian3.fromArray(extensions.CESIUM_RTC.center);if(!Cesium.Cartesian3.equals(center2,Cesium.Cartesian3.ZERO)){this._rtcCenter3D=center2;var projection2=frameState.mapProjection,ellipsoid=projection2.ellipsoid,cartographic=ellipsoid.cartesianToCartographic(this._rtcCenter3D),projectedCart=projection2.project(cartographic);Cesium.Cartesian3.fromElements(projectedCart.z,projectedCart.x,projectedCart.y,projectedCart),this._rtcCenter2D=projectedCart,this._rtcCenterEye=new Cesium.Cartesian3,this._rtcCenter=this._rtcCenter3D}}Cesium.addPipelineExtras(this.gltf),this._loadResources=new ModelLoadResources_default,this._loadRendererResourcesFromCache||ModelUtility_default.parseBuffers(this,bufferLoad)}}var loadResources=this._loadResources,incrementallyLoadTextures=this._incrementallyLoadTextures,justLoaded=!1;if(this._state===ModelState.LOADING){if(loadResources.pendingBufferLoads===0){if(!loadResources.initialized){if(frameState.brdfLutGenerator.update(frameState),ModelUtility_default.checkSupportedExtensions(this.extensionsRequired,supportsWebP2),ModelUtility_default.updateForwardAxis(this),!Cesium.defined(this.gltf.extras.sourceVersion)){var gltf=this.gltf;gltf.extras.sourceVersion=ModelUtility_default.getAssetVersion(gltf),gltf.extras.sourceKHRTechniquesWebGL=Cesium.defined(ModelUtility_default.getUsedExtensions(gltf).KHR_techniques_webgl),this._sourceVersion=gltf.extras.sourceVersion,this._sourceKHRTechniquesWebGL=gltf.extras.sourceKHRTechniquesWebGL,updateVersion_default(gltf),addDefaults_default(gltf);var options={addBatchIdToGeneratedShaders:this._addBatchIdToGeneratedShaders};processModelMaterialsCommon_default(gltf,options),processPbrMaterials_default(gltf,options)}this._sourceVersion=this.gltf.extras.sourceVersion,this._sourceKHRTechniquesWebGL=this.gltf.extras.sourceKHRTechniquesWebGL,this._dequantizeInShader=this._dequantizeInShader&&DracoLoader_default.hasExtension(this),addBuffersToLoadResources(this),parseArticulations(this),parseTechniques(this),this._loadRendererResourcesFromCache||(parseBufferViews(this),parseShaders(this),parsePrograms(this),parseTextures(this,context,supportsWebP2)),parseMaterials(this),parseMeshes(this),parseNodes(this);var curGltf=this.gltf;if(Cesium.defined(curGltf)&&curGltf.meshes.length>0&&this.meshPrimitives.length>0){for(var k=0;k<this.meshPrimitives.length;k++)DracoLoader_default.parseDecodedData(this.meshPrimitives[k],this,context);this.meshPrimitives.length=0}else DracoLoader_default.parse(this,context);loadResources.initialized=!0}loadResources.finishedDecoding()||DracoLoader_default.decodeModel(this,context).otherwise(ModelUtility_default.getFailedLoadFunction(this,"model",this.basePath)),loadResources.finishedDecoding()&&!loadResources.resourcesParsed&&(this._boundingSphere=ModelUtility_default.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,DracoLoader_default.cacheDataForModel(this),loadResources.resourcesParsed=!0),loadResources.resourcesParsed&&loadResources.pendingShaderLoads===0&&(ModelOutlineLoader_default.outlinePrimitives(this),createResources2(this,frameState))}(loadResources.finished()||incrementallyLoadTextures&&loadResources.finishedEverythingButTextureCreation())&&(this._state=ModelState.LOADED,justLoaded=!0)}if(Cesium.defined(loadResources)&&this._state===ModelState.LOADED&&(incrementallyLoadTextures&&!justLoaded&&createResources2(this,frameState),loadResources.finished())){this._loadResources=void 0;var resources=this._rendererResources,cachedResources=this._cachedRendererResources;cachedResources.buffers=resources.buffers,cachedResources.vertexArrays=resources.vertexArrays,cachedResources.programs=resources.programs,cachedResources.sourceShaders=resources.sourceShaders,cachedResources.silhouettePrograms=resources.silhouettePrograms,cachedResources.textures=resources.textures,cachedResources.samplers=resources.samplers,cachedResources.renderStates=resources.renderStates,cachedResources.ready=!0,this._normalAttributeName=ModelUtility_default.getAttributeOrUniformBySemantic(this.gltf,"NORMAL"),Cesium.defined(this._precreatedAttributes)&&(cachedResources.vertexArrays={}),this.releaseGltfJson&&releaseCachedGltf(this)}var iblSupported=Cesium.OctahedralProjectedCubeMap.isSupported(context);if(this._shouldUpdateSpecularMapAtlas&&iblSupported){if(this._shouldUpdateSpecularMapAtlas=!1,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._specularEnvironmentMapAtlas=void 0,Cesium.defined(this._specularEnvironmentMaps)){this._specularEnvironmentMapAtlas=new Cesium.OctahedralProjectedCubeMap(this._specularEnvironmentMaps);var that=this;this._specularEnvironmentMapAtlas.readyPromise.then(function(){that._shouldRegenerateShaders=!0}).otherwise(function(error){console.error("Error loading specularEnvironmentMaps: "+error)})}this._shouldRegenerateShaders=!0}Cesium.defined(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(frameState);var recompileWithDefaultAtlas=!Cesium.defined(this._specularEnvironmentMapAtlas)&&Cesium.defined(frameState.specularEnvironmentMaps)&&!this._useDefaultSpecularMaps,recompileWithoutDefaultAtlas=!Cesium.defined(frameState.specularEnvironmentMaps)&&this._useDefaultSpecularMaps,recompileWithDefaultSHCoeffs=!Cesium.defined(this._sphericalHarmonicCoefficients)&&Cesium.defined(frameState.sphericalHarmonicCoefficients)&&!this._useDefaultSphericalHarmonics,recompileWithoutDefaultSHCoeffs=!Cesium.defined(frameState.sphericalHarmonicCoefficients)&&this._useDefaultSphericalHarmonics;this._shouldRegenerateShaders=this._shouldRegenerateShaders||recompileWithDefaultAtlas||recompileWithoutDefaultAtlas||recompileWithDefaultSHCoeffs||recompileWithoutDefaultSHCoeffs,this._useDefaultSpecularMaps=!Cesium.defined(this._specularEnvironmentMapAtlas)&&Cesium.defined(frameState.specularEnvironmentMaps),this._useDefaultSphericalHarmonics=!Cesium.defined(this._sphericalHarmonicCoefficients)&&Cesium.defined(frameState.sphericalHarmonicCoefficients);var silhouette=hasSilhouette(this,frameState),translucent=isTranslucent(this),invisible=isInvisible(this),displayConditionPassed=Cesium.defined(this.distanceDisplayCondition)?distanceDisplayConditionVisible(this,frameState):!0,show=this.show&&displayConditionPassed&&this.scale!==0&&(!invisible||silhouette);if(show&&this._state===ModelState.LOADED||justLoaded){var animated=this.activeAnimations.update(frameState)||this._cesiumAnimationsDirty;this._cesiumAnimationsDirty=!1,this._dirty=!1;var modelMatrix=this.modelMatrix,modeChanged=frameState.mode!==this._mode;this._mode=frameState.mode;var modelTransformChanged=!Cesium.Matrix4.equals(this._modelMatrix,modelMatrix)||this._scale!==this.scale||this._minimumPixelSize!==this.minimumPixelSize||this.minimumPixelSize!==0||this._maximumScale!==this.maximumScale||this._heightReference!==this.heightReference||this._heightChanged||modeChanged;if(modelTransformChanged||justLoaded){Cesium.Matrix4.clone(modelMatrix,this._modelMatrix),updateClamping(this),Cesium.defined(this._clampedModelMatrix)&&(modelMatrix=this._clampedModelMatrix),this._scale=this.scale,this._minimumPixelSize=this.minimumPixelSize,this._maximumScale=this.maximumScale,this._heightReference=this.heightReference,this._heightChanged=!1;var scale4=getScale(this,frameState),computedModelMatrix=this._computedModelMatrix;Cesium.Matrix4.multiplyByUniformScale(modelMatrix,scale4,computedModelMatrix),this._upAxis===Cesium.Axis.Y?Cesium.Matrix4.multiplyTransformation(computedModelMatrix,Cesium.Axis.Y_UP_TO_Z_UP,computedModelMatrix):this._upAxis===Cesium.Axis.X&&Cesium.Matrix4.multiplyTransformation(computedModelMatrix,Cesium.Axis.X_UP_TO_Z_UP,computedModelMatrix),this.forwardAxis===Cesium.Axis.Z&&Cesium.Matrix4.multiplyTransformation(computedModelMatrix,Cesium.Axis.Z_UP_TO_X_UP,computedModelMatrix)}(animated||modelTransformChanged||justLoaded)&&(updateNodeHierarchyModelMatrix(this,modelTransformChanged,justLoaded,frameState.mapProjection),this._dirty=!0,(animated||justLoaded)&&applySkins(this)),this._perNodeShowDirty&&(this._perNodeShowDirty=!1,updatePerNodeShow(this)),updatePickIds(this,context),updateWireframe2(this),updateShowBoundingVolume2(this),updateShadows2(this),updateClippingPlanes(this,frameState);var clippingPlanes=this._clippingPlanes,currentClippingPlanesState=0,useClippingPlanes=Cesium.defined(clippingPlanes)&&clippingPlanes.enabled&&clippingPlanes.length>0,usesSH=Cesium.defined(this._sphericalHarmonicCoefficients)||this._useDefaultSphericalHarmonics,usesSM=Cesium.defined(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready||this._useDefaultSpecularMaps;if(useClippingPlanes||usesSH||usesSM){var clippingPlanesOriginMatrix=Cesium.defaultValue(this.clippingPlanesOriginMatrix,modelMatrix);Cesium.Matrix4.multiply(context.uniformState.view3D,clippingPlanesOriginMatrix,this._clippingPlaneModelViewMatrix)}useClippingPlanes&&(currentClippingPlanesState=clippingPlanes.clippingPlanesState);var shouldRegenerateShaders=this._shouldRegenerateShaders;shouldRegenerateShaders=shouldRegenerateShaders||this._clippingPlanesState!==currentClippingPlanesState,this._clippingPlanesState=currentClippingPlanesState;var currentlyColorShadingEnabled=isColorShadingEnabled2(this);currentlyColorShadingEnabled!==this._colorShadingEnabled&&(this._colorShadingEnabled=currentlyColorShadingEnabled,shouldRegenerateShaders=!0),this._scene.ev_Fog&&this._enableFog!==this._scene.ev_Fog.enabled&&(shouldRegenerateShaders=!0,this._shouldRegenerateShaders=!0,this._enableFog=this._scene.ev_Fog.enabled),Cesium.defined(this.ev_E3MInternalInstance)&&this.ev_E3MInternalInstance.postUpdate(frameState,this),this._update===!0&&(shouldRegenerateShaders=!0,this._shouldRegenerateShaders=!0,this._update=!1),shouldRegenerateShaders?regenerateShaders(this,frameState):(updateColor(this,frameState,!1),updateSilhouette(this,frameState,!1))}if(justLoaded){var model=this;frameState.afterRender.push(function(){model._ready=!0,model._readyPromise.resolve(model)});return}if(show&&!this._ignoreCommands){var commandList=frameState.commandList,passes=frameState.passes,nodeCommands=this._nodeCommands,length3=nodeCommands.length,i,nc,idl2D=frameState.mapProjection.ellipsoid.maximumRadius*Cesium.Math.PI,boundingVolume;if(passes.render||passes.pick&&this.allowPicking){for(i=0;i<length3;++i)if(nc=nodeCommands[i],nc.show){var command=translucent?nc.translucentCommand:nc.command;if(command=silhouette?nc.silhouetteModelCommand:command,commandList.push(command),boundingVolume=nc.command.boundingVolume,frameState.mode===Cesium.SceneMode.SCENE2D&&(boundingVolume.center.y+boundingVolume.radius>idl2D||boundingVolume.center.y-boundingVolume.radius<idl2D)){var command2D=translucent?nc.translucentCommand2D:nc.command2D;command2D=silhouette?nc.silhouetteModelCommand2D:command2D,commandList.push(command2D)}}if(silhouette&&!passes.pick)for(i=0;i<length3;++i)nc=nodeCommands[i],nc.show&&(commandList.push(nc.silhouetteColorCommand),boundingVolume=nc.command.boundingVolume,frameState.mode===Cesium.SceneMode.SCENE2D&&(boundingVolume.center.y+boundingVolume.radius>idl2D||boundingVolume.center.y-boundingVolume.radius<idl2D)&&commandList.push(nc.silhouetteColorCommand2D))}}var credit=this._credit;Cesium.defined(credit)&&frameState.creditDisplay.addCredit(credit);for(var resourceCredits=this._resourceCredits,creditCount=resourceCredits.length,c=0;c<creditCount;c++)frameState.creditDisplay.addCredit(resourceCredits[c])}};function destroyIfNotCached(rendererResources,cachedRendererResources){rendererResources.programs!==cachedRendererResources.programs&&destroy2(rendererResources.programs),rendererResources.silhouettePrograms!==cachedRendererResources.silhouettePrograms&&destroy2(rendererResources.silhouettePrograms)}function regenerateShaders(model,frameState){var rendererResources=model._rendererResources,cachedRendererResources=model._cachedRendererResources;destroyIfNotCached(rendererResources,cachedRendererResources);var programId;if(isClippingEnabled2(model)||isColorShadingEnabled2(model)||model._shouldRegenerateShaders){model._shouldRegenerateShaders=!1,rendererResources.programs={},rendererResources.silhouettePrograms={},Cesium.defined(model.ev_E3MInternalInstance)&&(model.ev_E3MInternalInstance._instancedUniformsByProgram=void 0);var visitedPrograms={},techniques=model._sourceTechniques,technique;for(var techniqueId in techniques)if(techniques.hasOwnProperty(techniqueId)&&(technique=techniques[techniqueId],programId=technique.program,!visitedPrograms[programId])){visitedPrograms[programId]=!0;var programName=model._sourcePrograms[programId].name;Cesium.defined(model.ev_E3MInternalInstance)&&Cesium.defined(model.ev_E3MInternalInstance._tileset)&&Cesium.defined(programName)&&model.instancedPrograms[programName]?(model.instancedPrograms[programName]=void 0,model.ev_E3MInternalInstance.regenerateShaders({programId,techniqueId},model,frameState.context)):recreateProgram2({programId,techniqueId},model,frameState.context)}}else rendererResources.programs=cachedRendererResources.programs,rendererResources.silhouettePrograms=cachedRendererResources.silhouettePrograms;for(var rendererPrograms=rendererResources.programs,nodeCommands=model._nodeCommands,commandCount=nodeCommands.length,i=0;i<commandCount;++i){var nodeCommand=nodeCommands[i];programId=nodeCommand.programId;var renderProgram=rendererPrograms[programId];nodeCommand.command.shaderProgram=renderProgram,Cesium.defined(nodeCommand.command2D)&&(nodeCommand.command2D.shaderProgram=renderProgram)}updateColor(model,frameState,!0),updateSilhouette(model,frameState,!0)}Model.prototype.isDestroyed=function(){return!1};Model.prototype.destroy=function(){Cesium.defined(this.ev_E3MInternalInstance)&&this.ev_E3MInternalInstance.destroy(),Cesium.defined(this._precreatedAttributes)&&destroy2(this._rendererResources.vertexArrays),Cesium.defined(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),Cesium.defined(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=void 0),Cesium.defined(this._cachedRendererResources)&&destroyIfNotCached(this._rendererResources,this._cachedRendererResources),this._rendererResources=void 0,this._cachedRendererResources=this._cachedRendererResources&&this._cachedRendererResources.release(),DracoLoader_default.destroyCachedDataForModel(this);for(var pickIds=this._pickIds,length3=pickIds.length,i=0;i<length3;++i)pickIds[i].destroy();releaseCachedGltf(this),this._quantizedVertexShaders=void 0;var clippingPlaneCollection=this._clippingPlanes;return Cesium.defined(clippingPlaneCollection)&&!clippingPlaneCollection.isDestroyed()&&clippingPlaneCollection.owner===this&&clippingPlaneCollection.destroy(),this._clippingPlanes=void 0,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._nodeCommands.length=0,this.meshPrimitives.length=0,this.ktxs=void 0,this.instancedPrograms=void 0,this.gltfShader=void 0,Cesium.destroyObject(this)};function addTextureByGltf(gltf,imagesSourceBuf){var normalAccessor=gltf.accessors[gltf.meshes[0].primitives[0].attributes.NORMAL],normalBufferView=gltf.bufferViews[normalAccessor.bufferView],normalBuffer=gltf.buffers[normalBufferView.buffer],normalSource=normalBuffer.extras._pipeline.source,normaValue=normalSource.slice(normalBufferView.byteOffset,normalBufferView.byteOffset+normalBufferView.byteLength),norma32Value=new Float32Array(normaValue.buffer);gltf.meshes[0].primitives[0].attributes.TEXCOORD_0=gltf.accessors.length;var positionCount=gltf.accessors[gltf.meshes[0].primitives[0].attributes.POSITION].count;gltf.accessors.push({bufferView:gltf.bufferViews.length,byteOffset:0,componentType:5126,count:positionCount,max:[1,1],min:[0,0],type:"VEC2"});var bufferTyteLength=positionCount*8;gltf.bufferViews.push({buffer:gltf.buffers.length,byteLength:bufferTyteLength,byteOffset:0,byteStride:8});var buffersArray=new Float32Array(positionCount*2),defaultArr=[[1,0],[0,0],[1,1],[0,1]],curIndex=0;for(let i=0;i<positionCount;i++)norma32Value[3*i]!==0&&norma32Value[3*i+1]!==0&&norma32Value[3*i+2]!==1?(buffersArray[2*i]=defaultArr[curIndex%4][0],buffersArray[2*i+1]=defaultArr[curIndex%4][1],curIndex++):(buffersArray[2*i]=0,buffersArray[2*i+1]=0,curIndex=0);return gltf.buffers.push({byteLength:bufferTyteLength,extras:{_pipeline:{source:new Uint8Array(buffersArray.buffer)}}}),gltf.materials[0].pbrMetallicRoughness.baseColorTexture={index:0},gltf.textures=[],gltf.textures.push({sampler:0,source:0}),gltf.samplers=[],gltf.samplers.push({magFilter:Cesium.TextureMinificationFilter.LINEAR,minFilter:Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR,wrapS:Cesium.TextureWrap.MIRRORED_REPEAT,wrapT:Cesium.TextureWrap.MIRRORED_REPEAT}),gltf.images=[],gltf.images.push({bufferView:gltf.bufferViews.length,mimeType:"image/png",extras:{_pipeline:{}}}),gltf.bufferViews.push({buffer:gltf.buffers.length,byteLength:imagesSourceBuf.length,byteOffset:0}),gltf.buffers.push({byteLength:imagesSourceBuf.length,extras:{_pipeline:{source:new Uint8Array(imagesSourceBuf.buffer)}}}),gltf}Model._getClippingFunction=Cesium.getClippingFunction;Model._modifyShaderForColor=modifyShaderForColor2;var Model_default=Model;function Batched3DModel3DTileContent(tileset,tile,resource2,arrayBuffer,byteOffset){this._tileset=tileset,this._tile=tile,this._resource=resource2,this._model=void 0,this._batchTable=void 0,this._features=void 0,this._batchIdAttributeName=void 0,this._diffuseAttributeOrUniformName={},this._rtcCenterTransform=void 0,this._contentModelMatrix=void 0,this.featurePropertiesDirty=!1,this.useHdr=!0,initialize(this,arrayBuffer,byteOffset)}Batched3DModel3DTileContent._deprecationWarning=Cesium.deprecationWarning;Object.defineProperties(Batched3DModel3DTileContent.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return this._model.trianglesLength}},geometryByteLength:{get:function(){return this._model.geometryByteLength}},texturesByteLength:{get:function(){return this._model.texturesByteLength}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._model.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var sizeOfUint322=Uint32Array.BYTES_PER_ELEMENT;function getBatchIdAttributeName(gltf){var batchIdAttributeName=ModelUtility_default.getAttributeOrUniformBySemantic(gltf,"_BATCHID");return Cesium.defined(batchIdAttributeName)||(batchIdAttributeName=ModelUtility_default.getAttributeOrUniformBySemantic(gltf,"BATCHID"),Cesium.defined(batchIdAttributeName)&&Batched3DModel3DTileContent._deprecationWarning("b3dm-legacy-batchid","The glTF in this b3dm uses the semantic `BATCHID`. Application-specific semantics should be prefixed with an underscore: `_BATCHID`.")),batchIdAttributeName}function getVertexShaderCallback(content){return function(vs,programId){var batchTable=content._batchTable,handleTranslucent=!Cesium.defined(content._tileset.classificationType),gltf=content._model.gltf;Cesium.defined(gltf)&&(content._batchIdAttributeName=getBatchIdAttributeName(gltf),content._diffuseAttributeOrUniformName[programId]=ModelUtility_default.getDiffuseAttributeOrUniform(gltf,programId));var callback=batchTable.getVertexShaderCallback(handleTranslucent,content._batchIdAttributeName,content._diffuseAttributeOrUniformName[programId]);return Cesium.defined(callback)?callback(vs):vs}}function getFragmentShaderCallback(content){return function(fs,programId){var batchTable=content._batchTable,handleTranslucent=!Cesium.defined(content._tileset.classificationType),gltf=content._model.gltf;Cesium.defined(gltf)&&(content._diffuseAttributeOrUniformName[programId]=ModelUtility_default.getDiffuseAttributeOrUniform(gltf,programId));var callback=batchTable.getFragmentShaderCallback(handleTranslucent,content._diffuseAttributeOrUniformName[programId]);return Cesium.defined(callback)?callback(fs):fs}}function getPickIdCallback(content){return function(){return content._batchTable.getPickId()}}function getClassificationFragmentShaderCallback(content){return function(fs){var batchTable=content._batchTable,callback=batchTable.getClassificationFragmentShaderCallback();return Cesium.defined(callback)?callback(fs):fs}}function createColorChangedCallback(content){return function(batchId,color){content._model.updateCommands(batchId,color)}}function initialize(content,arrayBuffer,byteOffset){var tileset=content._tileset,tile=content._tile,resource2=content._resource,byteStart=Cesium.defaultValue(byteOffset,0);byteOffset=byteStart;var uint8Array=new Uint8Array(arrayBuffer),view=new DataView(arrayBuffer);byteOffset+=sizeOfUint322;var version=view.getUint32(byteOffset,!0);if(version!==1)throw new Cesium.RuntimeError("Only Batched 3D Model version 1 is supported.  Version "+version+" is not.");byteOffset+=sizeOfUint322;var byteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint322;var featureTableJsonByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint322;var featureTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint322;var batchTableJsonByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint322;var batchTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint322;var batchLength;batchTableJsonByteLength>=570425344?(byteOffset-=sizeOfUint322*2,batchLength=featureTableJsonByteLength,batchTableJsonByteLength=featureTableBinaryByteLength,batchTableBinaryByteLength=0,featureTableJsonByteLength=0,featureTableBinaryByteLength=0,Batched3DModel3DTileContent._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/master/specification/TileFormats/Batched3DModel.")):batchTableBinaryByteLength>=570425344&&(byteOffset-=sizeOfUint322,batchLength=batchTableJsonByteLength,batchTableJsonByteLength=featureTableJsonByteLength,batchTableBinaryByteLength=featureTableBinaryByteLength,featureTableJsonByteLength=0,featureTableBinaryByteLength=0,Batched3DModel3DTileContent._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/master/specification/TileFormats/Batched3DModel."));var featureTableJson;if(featureTableJsonByteLength===0)featureTableJson={BATCH_LENGTH:Cesium.defaultValue(batchLength,0)};else{var featureTableString=Cesium.getStringFromTypedArray(uint8Array,byteOffset,featureTableJsonByteLength);featureTableJson=JSON.parse(featureTableString),byteOffset+=featureTableJsonByteLength}var featureTableBinary=new Uint8Array(arrayBuffer,byteOffset,featureTableBinaryByteLength);byteOffset+=featureTableBinaryByteLength;var featureTable=new Cesium3DTileFeatureTable_default(featureTableJson,featureTableBinary);batchLength=featureTable.getGlobalProperty("BATCH_LENGTH"),featureTable.featuresLength=batchLength;var radius;if(Cesium.defined(featureTable.json.Radius)&&(content.lineRadius=featureTable.json.Radius,radius=featureTable.json.Radius),Cesium.defined(featureTable.json.FLOWLINE)){var flowLine=featureTable.json.FLOWLINE,j=0;for(var por in flowLine){for(var positions=[],radiansArrayHeights=[],i=0;i<flowLine[por].length;i+=3){var position=Cesium.Cartesian3.fromRadians(flowLine[por][i+0],flowLine[por][i+1],flowLine[por][i+2]);positions.push(position),radius&&(radiansArrayHeights.push(flowLine[por][i+0]),radiansArrayHeights.push(flowLine[por][i+1]),radiansArrayHeights.push(flowLine[por][i+2]+radius[j]))}j++,Cesium.defined(content.tileset.flowLines)||(content.tileset.flowLines=[]),content.tileset.flowLines.push(positions),Cesium.defined(content.flowLines)||(content.flowLines=[],content.centreLine=[]),content.flowLines.push(positions),radius&&content.centreLine.push(radiansArrayHeights)}}var batchTableJson,batchTableBinary;if(batchTableJsonByteLength>0){var batchTableString=Cesium.getStringFromTypedArray(uint8Array,byteOffset,batchTableJsonByteLength);batchTableJson=JSON.parse(batchTableString),byteOffset+=batchTableJsonByteLength,batchTableBinaryByteLength>0&&(batchTableBinary=new Uint8Array(arrayBuffer,byteOffset,batchTableBinaryByteLength),batchTableBinary=new Uint8Array(batchTableBinary),byteOffset+=batchTableBinaryByteLength)}var colorChangedCallback;Cesium.defined(tileset.classificationType)&&(colorChangedCallback=createColorChangedCallback(content));var batchTable=new Cesium3DTileBatchTable_default(content,batchLength,batchTableJson,batchTableBinary,colorChangedCallback);if(content._batchTable=batchTable,Cesium.defined(content._tile._header.EVID))for(var featuresLength=batchTable.featuresLength,i=0;i<featuresLength;i++)batchTable.setProperty(i,"EVID",content._tile._header.EVID);var gltfByteLength=byteStart+byteLength-byteOffset;if(gltfByteLength===0)throw new Cesium.RuntimeError("glTF byte length must be greater than 0.");var gltfView;byteOffset%4===0?gltfView=new Uint8Array(arrayBuffer,byteOffset,gltfByteLength):(Batched3DModel3DTileContent._deprecationWarning("b3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),gltfView=new Uint8Array(uint8Array.subarray(byteOffset,byteOffset+gltfByteLength)));var pickObject={content,primitive:tileset};content._rtcCenterTransform=Cesium.Matrix4.IDENTITY;var rtcCenter=featureTable.getGlobalProperty("RTC_CENTER",Cesium.ComponentDatatype.FLOAT,3);Cesium.defined(rtcCenter)&&(content._rtcCenterTransform=Cesium.Matrix4.fromTranslation(Cesium.Cartesian3.fromArray(rtcCenter))),content._contentModelMatrix=Cesium.Matrix4.multiply(tile.computedTransform,content._rtcCenterTransform,new Cesium.Matrix4),Cesium.defined(tileset.classificationType)?content._model=new Cesium.ClassificationModel({gltf:gltfView,cull:!1,basePath:resource2,requestType:Cesium.RequestType.TILES3D,modelMatrix:content._contentModelMatrix,upAxis:tileset._gltfUpAxis,forwardAxis:Cesium.Axis.X,debugWireframe:tileset.debugWireframe,vertexShaderLoaded:getVertexShaderCallback(content),classificationShaderLoaded:getClassificationFragmentShaderCallback(content),uniformMapLoaded:batchTable.getUniformMapCallback(),pickIdLoaded:getPickIdCallback(content),classificationType:tileset._classificationType,batchTable}):(content._model=new Model_default({gltf:gltfView,cull:!1,releaseGltfJson:!0,opaquePass:Cesium.Pass.CESIUM_3D_TILE,basePath:resource2,requestType:Cesium.RequestType.TILES3D,modelMatrix:content._contentModelMatrix,upAxis:tileset._gltfUpAxis,forwardAxis:Cesium.Axis.X,shadows:tileset.shadows,debugWireframe:tileset.debugWireframe,incrementallyLoadTextures:!1,vertexShaderLoaded:getVertexShaderCallback(content),fragmentShaderLoaded:getFragmentShaderCallback(content),uniformMapLoaded:batchTable.getUniformMapCallback(),pickIdLoaded:getPickIdCallback(content),addBatchIdToGeneratedShaders:batchLength>0,pickObject,imageBasedLightingFactor:tileset.imageBasedLightingFactor,lightColor:tileset.lightColor,luminanceAtZenith:tileset.luminanceAtZenith,sphericalHarmonicCoefficients:tileset.sphericalHarmonicCoefficients,specularEnvironmentMaps:tileset.specularEnvironmentMaps,content,sharedResources:{instancedPrograms:{name:tile.sharedResources.instancedPrograms.name,shadredData:tile.sharedResources.instancedPrograms.shadredData},ktxs:tile.sharedResources.ktxs},specular:tileset.specular,rollerRegion:tileset.rollerRegion,imagesSourceBuf:tileset.imagesSourceBuf}),content._model._tilesetFlat=tileset._tilesetFlat,content._model.readyPromise.then(function(model){model.activeAnimations.addAll({loop:Cesium.ModelAnimationLoop.REPEAT})}))}function createFeatures2(content){var featuresLength=content.featuresLength;if(!Cesium.defined(content._features)&&featuresLength>0){for(var features=new Array(featuresLength),i=0;i<featuresLength;++i)features[i]=new Cesium3DTileFeature_default(content,i);content._features=features}}Batched3DModel3DTileContent.prototype.hasProperty=function(batchId,name){return this._batchTable.hasProperty(batchId,name)};Batched3DModel3DTileContent.prototype.getFeature=function(batchId){return createFeatures2(this),this._features[batchId]};Batched3DModel3DTileContent.prototype.applyDebugSettings=function(enabled,color){color=enabled?color:Cesium.Color.WHITE,this.featuresLength===0?this._model.color=color:this._batchTable.setAllColor(color)};Batched3DModel3DTileContent.prototype.applyStyle=function(style){if(this.featuresLength===0){var hasColorStyle=Cesium.defined(style)&&Cesium.defined(style.color),hasShowStyle=Cesium.defined(style)&&Cesium.defined(style.show);this._model.color=hasColorStyle?style.color.evaluateColor(void 0,this._model.color):Cesium.Color.clone(Cesium.Color.WHITE,this._model.color),this._model.show=hasShowStyle?style.show.evaluate(void 0):!0}else this._batchTable.applyStyle(style);Cesium.defined(this._model.ev_E3MInternalInstance)&&this._model.ev_E3MInternalInstance.applyStyle(style)};Batched3DModel3DTileContent.prototype.update=function(tileset,frameState){var commandStart=frameState.commandList.length;this._batchTable.update(tileset,frameState),Cesium.defined(this._model.ev_E3MInternalInstance)&&this._model.ev_E3MInternalInstance.cesium3DTileBatchTableUpdate(tileset,frameState),this._contentModelMatrix=Cesium.Matrix4.multiply(this._tile.computedTransform,this._rtcCenterTransform,this._contentModelMatrix),this._model.modelMatrix=this._contentModelMatrix,this._model.shadows=this._tileset.shadows,this._model.imageBasedLightingFactor=this._tileset.imageBasedLightingFactor,this._model.lightColor=this._tileset.lightColor,this._model.luminanceAtZenith=this._tileset.luminanceAtZenith,this._model.sphericalHarmonicCoefficients=this._tileset.sphericalHarmonicCoefficients,this._model.specularEnvironmentMaps=this._tileset.specularEnvironmentMaps,this._model.debugWireframe=this._tileset.debugWireframe,this._model.gltfShader=this._tileset.gltfShader,this._model.useIndexedDBCache=this._tileset.useIndexedDBCache;var tilesetClippingPlanes=this._tileset.clippingPlanes;this._model.clippingPlanesOriginMatrix=this._tileset.clippingPlanesOriginMatrix,Cesium.defined(tilesetClippingPlanes)&&this._tile.clippingPlanesDirty&&(this._model._clippingPlanes=tilesetClippingPlanes.enabled&&this._tile._isClipped?tilesetClippingPlanes:void 0),Cesium.defined(tilesetClippingPlanes)&&Cesium.defined(this._model._clippingPlanes)&&this._model._clippingPlanes!==tilesetClippingPlanes&&(this._model._clippingPlanes=tilesetClippingPlanes),this._model._update=this._tileset._update,this._model.update(frameState);var commandEnd=frameState.commandList.length;commandStart<commandEnd&&(frameState.passes.render||frameState.passes.pick)&&!Cesium.defined(tileset.classificationType)&&this._batchTable.addDerivedCommands(frameState,commandStart);for(var i=0;i<frameState.commandList.length;++i){var command=frameState.commandList[i];command.owner.content instanceof Batched3DModel3DTileContent&&(command.dirty=this.useHdr!==frameState.camera._scene._hdr)}this.useHdr=frameState.camera._scene._hdr};Batched3DModel3DTileContent.prototype.isDestroyed=function(){return!1};Batched3DModel3DTileContent.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Cesium.destroyObject(this)};var Batched3DModel3DTileContent_default=Batched3DModel3DTileContent;function Composite3DTileContent(tileset,tile,resource2,arrayBuffer,byteOffset,factory){this._tileset=tileset,this._tile=tile,this._resource=resource2,this._contents=[],this._readyPromise=when_default.defer(),initialize2(this,arrayBuffer,byteOffset,factory)}Object.defineProperties(Composite3DTileContent.prototype,{featurePropertiesDirty:{get:function(){for(var contents=this._contents,length3=contents.length,i=0;i<length3;++i)if(contents[i].featurePropertiesDirty)return!0;return!1},set:function(value){for(var contents=this._contents,length3=contents.length,i=0;i<length3;++i)contents[i].featurePropertiesDirty=value}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}}});var sizeOfUint323=Uint32Array.BYTES_PER_ELEMENT;function initialize2(content,arrayBuffer,byteOffset,factory){byteOffset=Cesium.defaultValue(byteOffset,0);var uint8Array=new Uint8Array(arrayBuffer),view=new DataView(arrayBuffer);byteOffset+=sizeOfUint323;var version=view.getUint32(byteOffset,!0);if(version!==1)throw new Cesium.RuntimeError("Only Composite Tile version 1 is supported. Version "+version+" is not.");byteOffset+=sizeOfUint323,byteOffset+=sizeOfUint323;var tilesLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint323;for(var contentPromises=[],i=0;i<tilesLength;++i){var tileType=Cesium.getMagic(uint8Array,byteOffset),tileByteLength=view.getUint32(byteOffset+sizeOfUint323*2,!0),contentFactory=factory[tileType];if(Cesium.defined(contentFactory)){var innerContent=contentFactory(content._tileset,content._tile,content._resource,arrayBuffer,byteOffset);content._contents.push(innerContent),contentPromises.push(innerContent.readyPromise)}else throw new Cesium.RuntimeError("Unknown tile content type, "+tileType+", inside Composite tile");byteOffset+=tileByteLength}when_default.all(contentPromises).then(function(){content._readyPromise.resolve(content)}).otherwise(function(error){content._readyPromise.reject(error)})}Composite3DTileContent.prototype.hasProperty=function(batchId,name){return!1};Composite3DTileContent.prototype.getFeature=function(batchId){};Composite3DTileContent.prototype.applyDebugSettings=function(enabled,color){for(var contents=this._contents,length3=contents.length,i=0;i<length3;++i)contents[i].applyDebugSettings(enabled,color)};Composite3DTileContent.prototype.applyStyle=function(style){for(var contents=this._contents,length3=contents.length,i=0;i<length3;++i)contents[i].applyStyle(style)};Composite3DTileContent.prototype.update=function(tileset,frameState){for(var contents=this._contents,length3=contents.length,i=0;i<length3;++i)contents[i].update(tileset,frameState)};Composite3DTileContent.prototype.isDestroyed=function(){return!1};Composite3DTileContent.prototype.destroy=function(){for(var contents=this._contents,length3=contents.length,i=0;i<length3;++i)contents[i].destroy();return Cesium.destroyObject(this)};var Composite3DTileContent_default=Composite3DTileContent;function ModelInstance(collection,modelMatrix,instanceId){this.primitive=collection,this._modelMatrix=Cesium.Matrix4.clone(modelMatrix),this._instanceId=instanceId}Object.defineProperties(ModelInstance.prototype,{instanceId:{get:function(){return this._instanceId}},model:{get:function(){return this.primitive._model}},modelMatrix:{get:function(){return Cesium.Matrix4.clone(this._modelMatrix)},set:function(value){Cesium.Matrix4.clone(value,this._modelMatrix),this.primitive.expandBoundingSphere(this._modelMatrix),this.primitive._dirty=!0}}});var ModelInstance_default=ModelInstance;var LoadState={NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3};function ModelInstanceCollection(options){options=Cesium.defaultValue(options,Cesium.defaultValue.EMPTY_OBJECT),this.show=Cesium.defaultValue(options.show,!0),this._instancingSupported=!1,this._dynamic=Cesium.defaultValue(options.dynamic,!1),this._allowPicking=Cesium.defaultValue(options.allowPicking,!0),this._ready=!1,this._readyPromise=when_default.defer(),this._state=LoadState.NEEDS_LOAD,this._dirty=!1,this._cull=Cesium.defaultValue(options.cull,!0),this._opaquePass=Cesium.defaultValue(options.opaquePass,Cesium.Pass.OPAQUE),this._instances=createInstances(this,options.instances),this._batchTable=options.batchTable,this._model=void 0,this._vertexBufferTypedArray=void 0,this._vertexBuffer=void 0,this._batchIdBuffer=void 0,this._instancedUniformsByProgram=void 0,this._drawCommands=[],this._modelCommands=void 0,this._boundingSphere=createBoundingSphere2(this),this._center=Cesium.Cartesian3.clone(this._boundingSphere.center),this._rtcTransform=new Cesium.Matrix4,this._rtcModelView=new Cesium.Matrix4,this._mode=void 0,this.modelMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._modelMatrix=Cesium.Matrix4.clone(this.modelMatrix),this._url=Cesium.Resource.createIfNeeded(options.url),this._requestType=options.requestType,this._gltf=options.gltf,this._basePath=Cesium.Resource.createIfNeeded(options.basePath),this._asynchronous=options.asynchronous,this._incrementallyLoadTextures=options.incrementallyLoadTextures,this._upAxis=options.upAxis,this._forwardAxis=options.forwardAxis,this.shadows=Cesium.defaultValue(options.shadows,Cesium.ShadowMode.ENABLED),this._shadows=this.shadows,this._pickIdLoaded=options.pickIdLoaded,this.debugShowBoundingVolume=Cesium.defaultValue(options.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Cesium.defaultValue(options.debugWireframe,!1),this._debugWireframe=!1,this._imageBasedLightingFactor=new Cesium.Cartesian2(1,1),Cesium.Cartesian2.clone(options.imageBasedLightingFactor,this._imageBasedLightingFactor),this.lightColor=options.lightColor,this.luminanceAtZenith=options.luminanceAtZenith,this.sphericalHarmonicCoefficients=options.sphericalHarmonicCoefficients,this.specularEnvironmentMaps=options.specularEnvironmentMaps,this.modelMeshPrimitives=[],this.content=Cesium.defaultValue(options.content,void 0),this.specular=options.specular,this.rollerRegion=options.rollerRegion}Object.defineProperties(ModelInstanceCollection.prototype,{allowPicking:{get:function(){return this._allowPicking}},length:{get:function(){return this._instances.length}},activeAnimations:{get:function(){return this._model.activeAnimations}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(value){Cesium.Cartesian2.clone(value,this._imageBasedLightingFactor)}}});function createInstances(collection,instancesOptions){instancesOptions=Cesium.defaultValue(instancesOptions,[]);for(var length3=instancesOptions.length,instances=new Array(length3),i=0;i<length3;++i){var instanceOptions=instancesOptions[i],modelMatrix=instanceOptions.modelMatrix,instanceId=Cesium.defaultValue(instanceOptions.batchId,i);instances[i]=new ModelInstance_default(collection,modelMatrix,instanceId)}return instances}function createBoundingSphere2(collection){for(var instancesLength=collection.length,points2=new Array(instancesLength),i=0;i<instancesLength;++i)points2[i]=Cesium.Matrix4.getTranslation(collection._instances[i]._modelMatrix,new Cesium.Cartesian3);return Cesium.BoundingSphere.fromPoints(points2)}var scratchCartesian=new Cesium.Cartesian3,scratchMatrix=new Cesium.Matrix4;ModelInstanceCollection.prototype.expandBoundingSphere=function(instanceModelMatrix){var translation=Cesium.Matrix4.getTranslation(instanceModelMatrix,scratchCartesian);Cesium.BoundingSphere.expand(this._boundingSphere,translation,this._boundingSphere)};function getCheckUniformSemanticFunction2(modelSemantics,supportedSemantics,programId,uniformMap){return function(uniform,uniformName){var semantic=uniform.semantic;if(Cesium.defined(semantic)&&modelSemantics.indexOf(semantic)>-1)if(supportedSemantics.indexOf(semantic)>-1)uniformMap[uniformName]=semantic;else throw new Cesium.RuntimeError('Shader program cannot be optimized for instancing. Uniform "'+uniformName+'" in program "'+programId+'" uses unsupported semantic "'+semantic+'"')}}function getInstancedUniforms2(collection,programId){if(Cesium.defined(collection._instancedUniformsByProgram))return collection._instancedUniformsByProgram[programId];var instancedUniformsByProgram={};collection._instancedUniformsByProgram=instancedUniformsByProgram;var modelSemantics=["MODEL","MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELINVERSE","MODELVIEWINVERSE","MODELVIEWPROJECTIONINVERSE","MODELINVERSETRANSPOSE","MODELVIEWINVERSETRANSPOSE"],supportedSemantics=["MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELVIEWINVERSETRANSPOSE"],techniques=collection._model._sourceTechniques;for(var techniqueId in techniques)if(techniques.hasOwnProperty(techniqueId)){var technique=techniques[techniqueId],program=technique.program;if(!Cesium.defined(instancedUniformsByProgram[program])){var uniformMap={};instancedUniformsByProgram[program]=uniformMap,Cesium.ForEach.techniqueUniform(technique,getCheckUniformSemanticFunction2(modelSemantics,supportedSemantics,programId,uniformMap))}}return instancedUniformsByProgram[programId]}function getVertexShaderCallback2(collection){return function(vs,programId){var instancedUniforms=getInstancedUniforms2(collection,programId),usesBatchTable=Cesium.defined(collection._batchTable),renamedSource=Cesium.ShaderSource.replaceMain(vs,"czm_instancing_main"),globalVarsHeader="",globalVarsMain="";for(var uniform in instancedUniforms)if(instancedUniforms.hasOwnProperty(uniform)){var semantic=instancedUniforms[uniform],varName;semantic==="MODELVIEW"||semantic==="CESIUM_RTC_MODELVIEW"?varName="czm_instanced_modelView":semantic==="MODELVIEWPROJECTION"?(varName="czm_instanced_modelViewProjection",globalVarsHeader+=`mat4 czm_instanced_modelViewProjection;
`,globalVarsMain+=`czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;
`):semantic==="MODELVIEWINVERSETRANSPOSE"&&(varName="czm_instanced_modelViewInverseTranspose",globalVarsHeader+=`mat3 czm_instanced_modelViewInverseTranspose;
`,globalVarsMain+=`czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);
`);var regex=new RegExp("uniform.*"+uniform+".*");renamedSource=renamedSource.replace(regex,""),regex=new RegExp(uniform+"\\b","g"),renamedSource=renamedSource.replace(regex,varName)}var uniforms=`uniform mat4 czm_instanced_modifiedModelView;
uniform mat4 czm_instanced_nodeTransform;
uniform mat4 czm_instanced_modelMatrix;
uniform mat4 czm_instanced_inverseModelMatrix;
`,batchIdAttribute,pickAttribute,pickVarying;usesBatchTable?(batchIdAttribute=`attribute float a_batchId;
`,pickAttribute="",pickVarying=""):(batchIdAttribute="",pickAttribute=`attribute vec4 pickColor;
varying vec4 v_pickColor;
`,pickVarying=`    v_pickColor = pickColor;
`);var instancedSource=uniforms+globalVarsHeader+`mat4 czm_instanced_modelView;
attribute vec4 czm_modelMatrixRow0;
attribute vec4 czm_modelMatrixRow1;
attribute vec4 czm_modelMatrixRow2;
`+batchIdAttribute+pickAttribute+renamedSource+`void main()
{
    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);
    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model * czm_instanced_nodeTransform;
`+globalVarsMain+`    czm_instancing_main();
`+pickVarying+`}
`;if(usesBatchTable){var gltf=collection._model.gltf,diffuseAttributeOrUniformName=ModelUtility_default.getDiffuseAttributeOrUniform(gltf,programId);instancedSource=collection._batchTable.getVertexShaderCallback(!0,"a_batchId",diffuseAttributeOrUniformName)(instancedSource)}return instancedSource}}function getFragmentShaderCallback2(collection){return function(fs,programId){var batchTable=collection._batchTable;if(Cesium.defined(batchTable)){var gltf=collection._model.gltf,diffuseAttributeOrUniformName=ModelUtility_default.getDiffuseAttributeOrUniform(gltf,programId);fs=batchTable.getFragmentShaderCallback(!0,diffuseAttributeOrUniformName)(fs)}else fs=`varying vec4 v_pickColor;
`+fs;return fs}}function createModifiedModelView2(collection,context){return function(){return Cesium.Matrix4.multiply(context.uniformState.view,collection._rtcTransform,collection._rtcModelView)}}function createNodeTransformFunction2(node){return function(){return node.computedMatrix}}function createModelMatrix2(collection){return function(){return collection._rtcTransform}}function createInverseModelMatrix2(collection){return function(){return Cesium.Matrix4.inverse(collection._rtcTransform,new Cesium.Matrix4)}}function getUniformMapCallback(collection,context){return function(uniformMap,programId,node){uniformMap=Cesium.clone(uniformMap),uniformMap.czm_instanced_modifiedModelView=createModifiedModelView2(collection,context),uniformMap.czm_instanced_nodeTransform=createNodeTransformFunction2(node),uniformMap.czm_instanced_modelMatrix=createModelMatrix2(collection),uniformMap.czm_instanced_inverseModelMatrix=createInverseModelMatrix2(collection);var instancedUniforms=getInstancedUniforms2(collection,programId);for(var uniform in instancedUniforms)instancedUniforms.hasOwnProperty(uniform)&&delete uniformMap[uniform];return Cesium.defined(collection._batchTable)&&(uniformMap=collection._batchTable.getUniformMapCallback()(uniformMap)),uniformMap}}function getVertexShaderNonInstancedCallback(collection){return function(vs,programId){if(Cesium.defined(collection._batchTable)){var gltf=collection._model.gltf,diffuseAttributeOrUniformName=ModelUtility_default.getDiffuseAttributeOrUniform(gltf,programId);vs=collection._batchTable.getVertexShaderCallback(!0,"a_batchId",diffuseAttributeOrUniformName)(vs),vs=`uniform float a_batchId
;`+vs}return vs}}function getFragmentShaderNonInstancedCallback(collection){return function(fs,programId){var batchTable=collection._batchTable;if(Cesium.defined(batchTable)){var gltf=collection._model.gltf,diffuseAttributeOrUniformName=ModelUtility_default.getDiffuseAttributeOrUniform(gltf,programId);fs=batchTable.getFragmentShaderCallback(!0,diffuseAttributeOrUniformName)(fs)}else fs=`uniform vec4 czm_pickColor;
`+fs;return fs}}function getUniformMapNonInstancedCallback(collection){return function(uniformMap){return Cesium.defined(collection._batchTable)&&(uniformMap=collection._batchTable.getUniformMapCallback()(uniformMap)),uniformMap}}function getVertexBufferTypedArray2(collection){var instances=collection._instances,instancesLength=collection.length,collectionCenter=collection._center,vertexSizeInFloats=12,bufferData=collection._vertexBufferTypedArray;Cesium.defined(bufferData)||(bufferData=new Float32Array(instancesLength*vertexSizeInFloats)),collection._dynamic&&(collection._vertexBufferTypedArray=bufferData);for(var i=0;i<instancesLength;++i){var modelMatrix=instances[i]._modelMatrix,instanceMatrix=Cesium.Matrix4.clone(modelMatrix,scratchMatrix);instanceMatrix[12]-=collectionCenter.x,instanceMatrix[13]-=collectionCenter.y,instanceMatrix[14]-=collectionCenter.z;var offset=i*vertexSizeInFloats;bufferData[offset+0]=instanceMatrix[0],bufferData[offset+1]=instanceMatrix[4],bufferData[offset+2]=instanceMatrix[8],bufferData[offset+3]=instanceMatrix[12],bufferData[offset+4]=instanceMatrix[1],bufferData[offset+5]=instanceMatrix[5],bufferData[offset+6]=instanceMatrix[9],bufferData[offset+7]=instanceMatrix[13],bufferData[offset+8]=instanceMatrix[2],bufferData[offset+9]=instanceMatrix[6],bufferData[offset+10]=instanceMatrix[10],bufferData[offset+11]=instanceMatrix[14]}return bufferData}function createVertexBuffer3(collection,context){var i,instances=collection._instances,instancesLength=collection.length,dynamic=collection._dynamic,usesBatchTable=Cesium.defined(collection._batchTable);if(usesBatchTable){var batchIdBufferData=new Uint16Array(instancesLength);for(i=0;i<instancesLength;++i)batchIdBufferData[i]=instances[i]._instanceId;collection._batchIdBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray:batchIdBufferData,usage:Cesium.BufferUsage.STATIC_DRAW})}if(!usesBatchTable){var pickIdBuffer=new Uint8Array(instancesLength*4);for(i=0;i<instancesLength;++i){var pickId=collection._pickIds[i],pickColor=pickId.color,offset=i*4;pickIdBuffer[offset]=Cesium.Color.floatToByte(pickColor.red),pickIdBuffer[offset+1]=Cesium.Color.floatToByte(pickColor.green),pickIdBuffer[offset+2]=Cesium.Color.floatToByte(pickColor.blue),pickIdBuffer[offset+3]=Cesium.Color.floatToByte(pickColor.alpha)}collection._pickIdBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray:pickIdBuffer,usage:Cesium.BufferUsage.STATIC_DRAW})}var vertexBufferTypedArray=getVertexBufferTypedArray2(collection);collection._vertexBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray:vertexBufferTypedArray,usage:dynamic?Cesium.BufferUsage.STREAM_DRAW:Cesium.BufferUsage.STATIC_DRAW})}function updateVertexBuffer(collection){var vertexBufferTypedArray=getVertexBufferTypedArray2(collection);collection._vertexBuffer.copyFromArrayView(vertexBufferTypedArray)}function createPickIds(collection,context){for(var instances=collection._instances,instancesLength=instances.length,pickIds=new Array(instancesLength),i=0;i<instancesLength;++i)pickIds[i]=context.createPickId(instances[i]);return pickIds}function createModel(collection,context){var instancingSupported=collection._instancingSupported,usesBatchTable=Cesium.defined(collection._batchTable),allowPicking=collection._allowPicking,modelOptions={url:collection._url,requestType:collection._requestType,gltf:collection._gltf,basePath:collection._basePath,shadows:collection._shadows,cacheKey:void 0,asynchronous:collection._asynchronous,allowPicking,incrementallyLoadTextures:collection._incrementallyLoadTextures,upAxis:collection._upAxis,forwardAxis:collection._forwardAxis,precreatedAttributes:void 0,vertexShaderLoaded:void 0,fragmentShaderLoaded:void 0,uniformMapLoaded:void 0,pickIdLoaded:collection._pickIdLoaded,ignoreCommands:!0,opaquePass:collection._opaquePass,imageBasedLightingFactor:collection.imageBasedLightingFactor,lightColor:collection.lightColor,luminanceAtZenith:collection.luminanceAtZenith,sphericalHarmonicCoefficients:collection.sphericalHarmonicCoefficients,specularEnvironmentMaps:collection.specularEnvironmentMaps,content:collection.content,sharedResources:{instancedPrograms:{name:collection.sharedResources.instancedPrograms.name,shadredData:collection.sharedResources.instancedPrograms.shadredData},ktxs:collection.sharedResources.ktxs},specular:collection.specular,rollerRegion:collection.rollerRegion};if(usesBatchTable||(collection._pickIds=createPickIds(collection,context)),instancingSupported){createVertexBuffer3(collection,context);var vertexSizeInFloats=12,componentSizeInBytes=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),instancedAttributes={czm_modelMatrixRow0:{index:0,vertexBuffer:collection._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:componentSizeInBytes*vertexSizeInFloats,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:collection._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:componentSizeInBytes*4,strideInBytes:componentSizeInBytes*vertexSizeInFloats,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:collection._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:componentSizeInBytes*8,strideInBytes:componentSizeInBytes*vertexSizeInFloats,instanceDivisor:1}};usesBatchTable&&(instancedAttributes.a_batchId={index:0,vertexBuffer:collection._batchIdBuffer,componentsPerAttribute:1,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),usesBatchTable||(instancedAttributes.pickColor={index:0,vertexBuffer:collection._pickIdBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),modelOptions.precreatedAttributes=instancedAttributes,modelOptions.vertexShaderLoaded=getVertexShaderCallback2(collection),modelOptions.fragmentShaderLoaded=getFragmentShaderCallback2(collection),modelOptions.uniformMapLoaded=getUniformMapCallback(collection,context),Cesium.defined(collection._url)&&(modelOptions.cacheKey=collection._url.getUrlComponent()+"#instanced")}else modelOptions.vertexShaderLoaded=getVertexShaderNonInstancedCallback(collection),modelOptions.fragmentShaderLoaded=getFragmentShaderNonInstancedCallback(collection),modelOptions.uniformMapLoaded=getUniformMapNonInstancedCallback(collection,context);Cesium.defined(collection._url)?collection._model=Model_default.fromGltf(modelOptions):collection._model=new Model_default(modelOptions)}function updateWireframe3(collection){if(collection._debugWireframe!==collection.debugWireframe){collection._debugWireframe=collection.debugWireframe;for(var primitiveType=collection.debugWireframe?Cesium.PrimitiveType.LINES:Cesium.PrimitiveType.TRIANGLES,commands=collection._drawCommands,length3=commands.length,i=0;i<length3;++i)commands[i].primitiveType=primitiveType}}function updateShowBoundingVolume3(collection){if(collection.debugShowBoundingVolume!==collection._debugShowBoundingVolume){collection._debugShowBoundingVolume=collection.debugShowBoundingVolume;for(var commands=collection._drawCommands,length3=commands.length,i=0;i<length3;++i)commands[i].debugShowBoundingVolume=collection.debugShowBoundingVolume}}function createCommands(collection,drawCommands){for(var commandsLength=drawCommands.length,instancesLength=collection.length,boundingSphere=collection._boundingSphere,cull=collection._cull,i=0;i<commandsLength;++i){var drawCommand=Cesium.DrawCommand.shallowClone(drawCommands[i]);drawCommand.instanceCount=instancesLength,drawCommand.boundingVolume=boundingSphere,drawCommand.cull=cull,Cesium.defined(collection._batchTable)?drawCommand.pickId=collection._batchTable.getPickId():drawCommand.pickId="v_pickColor",collection._drawCommands.push(drawCommand)}}function createBatchIdFunction2(batchId){return function(){return batchId}}function createPickColorFunction3(color){return function(){return color}}function createCommandsNonInstanced2(collection,drawCommands){for(var instances=collection._instances,commandsLength=drawCommands.length,instancesLength=collection.length,batchTable=collection._batchTable,usesBatchTable=Cesium.defined(batchTable),cull=collection._cull,i=0;i<commandsLength;++i)for(var j=0;j<instancesLength;++j){var drawCommand=Cesium.DrawCommand.shallowClone(drawCommands[i]);if(drawCommand.modelMatrix=new Cesium.Matrix4,drawCommand.boundingVolume=new Cesium.BoundingSphere,drawCommand.cull=cull,drawCommand.uniformMap=Cesium.clone(drawCommand.uniformMap),usesBatchTable)drawCommand.uniformMap.a_batchId=createBatchIdFunction2(instances[j]._instanceId);else{var pickId=collection._pickIds[j];drawCommand.uniformMap.czm_pickColor=createPickColorFunction3(pickId.color)}collection._drawCommands.push(drawCommand)}}function updateCommandsNonInstanced2(collection){for(var modelCommands=collection._modelCommands,commandsLength=modelCommands.length,instancesLength=collection.length,collectionTransform=collection._rtcTransform,collectionCenter=collection._center,i=0;i<commandsLength;++i)for(var modelCommand=modelCommands[i],j=0;j<instancesLength;++j){var commandIndex=i*instancesLength+j,drawCommand=collection._drawCommands[commandIndex],instanceMatrix=Cesium.Matrix4.clone(collection._instances[j]._modelMatrix,scratchMatrix);instanceMatrix[12]-=collectionCenter.x,instanceMatrix[13]-=collectionCenter.y,instanceMatrix[14]-=collectionCenter.z,instanceMatrix=Cesium.Matrix4.multiply(collectionTransform,instanceMatrix,scratchMatrix);var nodeMatrix=modelCommand.modelMatrix,modelMatrix=drawCommand.modelMatrix;Cesium.Matrix4.multiply(instanceMatrix,nodeMatrix,modelMatrix);var nodeBoundingSphere=modelCommand.boundingVolume,boundingSphere=drawCommand.boundingVolume;Cesium.BoundingSphere.transform(nodeBoundingSphere,instanceMatrix,boundingSphere)}}function getModelCommands(model){for(var nodeCommands=model._nodeCommands,length3=nodeCommands.length,drawCommands=[],i=0;i<length3;++i){var nc=nodeCommands[i];nc.show&&drawCommands.push(nc.command)}return drawCommands}function commandsDirty(model){for(var nodeCommands=model._nodeCommands,length3=nodeCommands.length,i=0;i<length3;i++){var nc=nodeCommands[i];if(nc.command.dirty)return!0}return!1}function generateModelCommands2(modelInstanceCollection,instancingSupported){modelInstanceCollection._drawCommands=[];var modelCommands=getModelCommands(modelInstanceCollection._model);instancingSupported?createCommands(modelInstanceCollection,modelCommands):(createCommandsNonInstanced2(modelInstanceCollection,modelCommands),updateCommandsNonInstanced2(modelInstanceCollection))}function updateShadows3(collection){if(collection.shadows!==collection._shadows){collection._shadows=collection.shadows;for(var castShadows=Cesium.ShadowMode.castShadows(collection.shadows),receiveShadows=Cesium.ShadowMode.receiveShadows(collection.shadows),drawCommands=collection._drawCommands,length3=drawCommands.length,i=0;i<length3;++i){var drawCommand=drawCommands[i];drawCommand.castShadows=castShadows,drawCommand.receiveShadows=receiveShadows}}}ModelInstanceCollection.prototype.update=function(frameState){if(frameState.mode!==Cesium.SceneMode.MORPHING&&!!this.show&&this.length!==0){var context=frameState.context;if(this._state===LoadState.NEEDS_LOAD){this._state=LoadState.LOADING,this._instancingSupported=context.instancedArrays,createModel(this,context),this._model._meshPrimitives=this.modelMeshPrimitives;var that=this;this._model.readyPromise.otherwise(function(error){that._state=LoadState.FAILED,that._readyPromise.reject(error)})}var instancingSupported=this._instancingSupported,model=this._model;if(model.imageBasedLightingFactor=this.imageBasedLightingFactor,model.lightColor=this.lightColor,model.luminanceAtZenith=this.luminanceAtZenith,model.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,model.specularEnvironmentMaps=this.specularEnvironmentMaps,model.ktxs=this.ktxs,model.gltfShader=this.gltfShader,model._tilesetFlat=this._tilesetFlat,model.update(frameState),model.ready&&this._state===LoadState.LOADING){this._state=LoadState.LOADED,this._ready=!0;var modelRadius=model.boundingSphere.radius+Cesium.Cartesian3.magnitude(model.boundingSphere.center);this._boundingSphere.radius+=modelRadius,this._modelCommands=getModelCommands(model),generateModelCommands2(this,instancingSupported),this._readyPromise.resolve(this);return}if(this._state===LoadState.LOADED){var modeChanged=frameState.mode!==this._mode,modelMatrix=this.modelMatrix,modelMatrixChanged=!Cesium.Matrix4.equals(this._modelMatrix,modelMatrix);if(modeChanged||modelMatrixChanged){this._mode=frameState.mode,Cesium.Matrix4.clone(modelMatrix,this._modelMatrix);var rtcTransform=Cesium.Matrix4.multiplyByTranslation(this._modelMatrix,this._center,this._rtcTransform);this._mode!==Cesium.SceneMode.SCENE3D&&(rtcTransform=Cesium.Transforms.basisTo2D(frameState.mapProjection,rtcTransform,rtcTransform)),Cesium.Matrix4.getTranslation(rtcTransform,this._boundingSphere.center)}instancingSupported&&this._dirty&&(this._dynamic=!0,this._dirty=!1,updateVertexBuffer(this)),commandsDirty(model)&&generateModelCommands2(this,instancingSupported),!instancingSupported&&(model.dirty||this._dirty||modeChanged||modelMatrixChanged)&&updateCommandsNonInstanced2(this),updateShadows3(this),updateWireframe3(this),updateShowBoundingVolume3(this);var passes=frameState.passes;if(!(!passes.render&&!passes.pick))for(var commandList=frameState.commandList,commands=this._drawCommands,commandsLength=commands.length,i=0;i<commandsLength;++i)commandList.push(commands[i])}}};ModelInstanceCollection.prototype.isDestroyed=function(){return!1};ModelInstanceCollection.prototype.destroy=function(){this._model=this._model&&this._model.destroy(),this.sharedResources.instancedPrograms=void 0,this.sharedResources.ktxs=void 0,this.gltfShader=void 0,this._gltf=void 0,this._instances.length=0;var pickIds=this._pickIds;if(Cesium.defined(pickIds))for(var length3=pickIds.length,i=0;i<length3;++i)pickIds[i].destroy();return Cesium.destroyObject(this)};var ModelInstanceCollection_default=ModelInstanceCollection;function Instanced3DModel3DTileContent(tileset,tile,resource2,arrayBuffer,byteOffset){this._tileset=tileset,this._tile=tile,this._resource=resource2,this._modelInstanceCollection=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,initialize3(this,arrayBuffer,byteOffset)}Instanced3DModel3DTileContent._deprecationWarning=Cesium.deprecationWarning;Object.defineProperties(Instanced3DModel3DTileContent.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){var model=this._modelInstanceCollection._model;return Cesium.defined(model)?model.trianglesLength:0}},geometryByteLength:{get:function(){var model=this._modelInstanceCollection._model;return Cesium.defined(model)?model.geometryByteLength:0}},texturesByteLength:{get:function(){var model=this._modelInstanceCollection._model;return Cesium.defined(model)?model.texturesByteLength:0}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._modelInstanceCollection.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});function getPickIdCallback2(content){return function(){return content._batchTable.getPickId()}}var sizeOfUint324=Uint32Array.BYTES_PER_ELEMENT,propertyScratch1=new Array(4),propertyScratch2=new Array(4);function initialize3(content,arrayBuffer,byteOffset){var byteStart=Cesium.defaultValue(byteOffset,0);byteOffset=byteStart;var uint8Array=new Uint8Array(arrayBuffer),view=new DataView(arrayBuffer);byteOffset+=sizeOfUint324;var version=view.getUint32(byteOffset,!0);if(version!==1)throw new Cesium.RuntimeError("Only Instanced 3D Model version 1 is supported. Version "+version+" is not.");byteOffset+=sizeOfUint324;var byteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint324;var featureTableJsonByteLength=view.getUint32(byteOffset,!0);if(featureTableJsonByteLength===0)throw new Cesium.RuntimeError("featureTableJsonByteLength is zero, the feature table must be defined.");byteOffset+=sizeOfUint324;var featureTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint324;var batchTableJsonByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint324;var batchTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint324;var gltfFormat=view.getUint32(byteOffset,!0);if(gltfFormat!==1&&gltfFormat!==0)throw new Cesium.RuntimeError("Only glTF format 0 (uri) or 1 (embedded) are supported. Format "+gltfFormat+" is not.");byteOffset+=sizeOfUint324;var featureTableString=Cesium.getStringFromTypedArray(uint8Array,byteOffset,featureTableJsonByteLength),featureTableJson=JSON.parse(featureTableString);byteOffset+=featureTableJsonByteLength;var featureTableBinary=new Uint8Array(arrayBuffer,byteOffset,featureTableBinaryByteLength);byteOffset+=featureTableBinaryByteLength;var featureTable=new Cesium3DTileFeatureTable_default(featureTableJson,featureTableBinary),instancesLength=featureTable.getGlobalProperty("INSTANCES_LENGTH");if(featureTable.featuresLength=instancesLength,!Cesium.defined(instancesLength))throw new Cesium.RuntimeError("Feature table global property: INSTANCES_LENGTH must be defined");var batchTableJson,batchTableBinary;if(batchTableJsonByteLength>0){var batchTableString=Cesium.getStringFromTypedArray(uint8Array,byteOffset,batchTableJsonByteLength);batchTableJson=JSON.parse(batchTableString),byteOffset+=batchTableJsonByteLength,batchTableBinaryByteLength>0&&(batchTableBinary=new Uint8Array(arrayBuffer,byteOffset,batchTableBinaryByteLength),batchTableBinary=new Uint8Array(batchTableBinary),byteOffset+=batchTableBinaryByteLength)}if(content._batchTable=new Cesium3DTileBatchTable_default(content,instancesLength,batchTableJson,batchTableBinary),Cesium.defined(content._tile._header.EVID))for(var featuresLength=content._batchTable.featuresLength,i=0;i<featuresLength;i++)content._batchTable.setProperty(i,"EVID",content._tile._header.EVID);var gltfByteLength=byteStart+byteLength-byteOffset;if(gltfByteLength===0)throw new Cesium.RuntimeError("glTF byte length is zero, i3dm must have a glTF to instance.");var gltfView;byteOffset%4===0?gltfView=new Uint8Array(arrayBuffer,byteOffset,gltfByteLength):(Instanced3DModel3DTileContent._deprecationWarning("i3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),gltfView=new Uint8Array(uint8Array.subarray(byteOffset,byteOffset+gltfByteLength)));var tileset=content._tileset,collectionOptions={instances:new Array(instancesLength),batchTable:content._batchTable,cull:!1,url:void 0,requestType:Cesium.RequestType.TILES3D,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,upAxis:tileset._gltfUpAxis,forwardAxis:Cesium.Axis.X,opaquePass:Cesium.Pass.CESIUM_3D_TILE,pickIdLoaded:getPickIdCallback2(content),imageBasedLightingFactor:tileset.imageBasedLightingFactor,lightColor:tileset.lightColor,luminanceAtZenith:tileset.luminanceAtZenith,sphericalHarmonicCoefficients:tileset.sphericalHarmonicCoefficients,specularEnvironmentMaps:tileset.specularEnvironmentMaps,content,specular:tileset.specular,rollerRegion:tileset.rollerRegion};if(gltfFormat===0){var gltfUrl=Cesium.getStringFromTypedArray(gltfView);gltfUrl=gltfUrl.replace(/[\s\0]+$/,""),collectionOptions.url=content._resource.getDerivedResource({url:gltfUrl})}else collectionOptions.gltf=gltfView,collectionOptions.basePath=content._resource.clone();var eastNorthUp=featureTable.getGlobalProperty("EAST_NORTH_UP"),rtcCenter,rtcCenterArray=featureTable.getGlobalProperty("RTC_CENTER",Cesium.ComponentDatatype.FLOAT,3);Cesium.defined(rtcCenterArray)&&(rtcCenter=Cesium.Cartesian3.unpack(rtcCenterArray));for(var instances=collectionOptions.instances,instancePosition=new Cesium.Cartesian3,instancePositionArray=new Array(3),instanceNormalRight=new Cesium.Cartesian3,instanceNormalUp=new Cesium.Cartesian3,instanceNormalForward=new Cesium.Cartesian3,instanceRotation=new Cesium.Matrix3,instanceQuaternion=new Cesium.Quaternion,instanceScale=new Cesium.Cartesian3,instanceTranslationRotationScale=new Cesium.TranslationRotationScale,instanceTransform=new Cesium.Matrix4,i=0;i<instancesLength;i++){var position=featureTable.getProperty("POSITION",Cesium.ComponentDatatype.FLOAT,3,i,propertyScratch1);if(!Cesium.defined(position)){position=instancePositionArray;var positionQuantized=featureTable.getProperty("POSITION_QUANTIZED",Cesium.ComponentDatatype.UNSIGNED_SHORT,3,i,propertyScratch1);if(!Cesium.defined(positionQuantized))throw new Cesium.RuntimeError("Either POSITION or POSITION_QUANTIZED must be defined for each instance.");var quantizedVolumeOffset=featureTable.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Cesium.ComponentDatatype.FLOAT,3);if(!Cesium.defined(quantizedVolumeOffset))throw new Cesium.RuntimeError("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var quantizedVolumeScale=featureTable.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Cesium.ComponentDatatype.FLOAT,3);if(!Cesium.defined(quantizedVolumeScale))throw new Cesium.RuntimeError("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var j=0;j<3;j++)position[j]=positionQuantized[j]/65535*quantizedVolumeScale[j]+quantizedVolumeOffset[j]}Cesium.Cartesian3.unpack(position,0,instancePosition),Cesium.defined(rtcCenter)&&Cesium.Cartesian3.add(instancePosition,rtcCenter,instancePosition),instanceTranslationRotationScale.translation=instancePosition;var normalUp=featureTable.getProperty("NORMAL_UP",Cesium.ComponentDatatype.FLOAT,3,i,propertyScratch1),normalRight=featureTable.getProperty("NORMAL_RIGHT",Cesium.ComponentDatatype.FLOAT,3,i,propertyScratch2),hasCustomOrientation=!1;if(Cesium.defined(normalUp)){if(!Cesium.defined(normalRight))throw new Cesium.RuntimeError("To define a custom orientation, both NORMAL_UP and NORMAL_RIGHT must be defined.");Cesium.Cartesian3.unpack(normalUp,0,instanceNormalUp),Cesium.Cartesian3.unpack(normalRight,0,instanceNormalRight),hasCustomOrientation=!0}else{var octNormalUp=featureTable.getProperty("NORMAL_UP_OCT32P",Cesium.ComponentDatatype.UNSIGNED_SHORT,2,i,propertyScratch1),octNormalRight=featureTable.getProperty("NORMAL_RIGHT_OCT32P",Cesium.ComponentDatatype.UNSIGNED_SHORT,2,i,propertyScratch2);if(Cesium.defined(octNormalUp)){if(!Cesium.defined(octNormalRight))throw new Cesium.RuntimeError("To define a custom orientation with oct-encoded vectors, both NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P must be defined.");Cesium.AttributeCompression.octDecodeInRange(octNormalUp[0],octNormalUp[1],65535,instanceNormalUp),Cesium.AttributeCompression.octDecodeInRange(octNormalRight[0],octNormalRight[1],65535,instanceNormalRight),hasCustomOrientation=!0}else eastNorthUp?(Cesium.Transforms.eastNorthUpToFixedFrame(instancePosition,Cesium.Ellipsoid.WGS84,instanceTransform),Cesium.Matrix4.getMatrix3(instanceTransform,instanceRotation)):Cesium.Matrix3.clone(Cesium.Matrix3.IDENTITY,instanceRotation)}hasCustomOrientation&&(Cesium.Cartesian3.cross(instanceNormalRight,instanceNormalUp,instanceNormalForward),Cesium.Cartesian3.normalize(instanceNormalForward,instanceNormalForward),Cesium.Matrix3.setColumn(instanceRotation,0,instanceNormalRight,instanceRotation),Cesium.Matrix3.setColumn(instanceRotation,1,instanceNormalUp,instanceRotation),Cesium.Matrix3.setColumn(instanceRotation,2,instanceNormalForward,instanceRotation)),Cesium.Quaternion.fromRotationMatrix(instanceRotation,instanceQuaternion),instanceTranslationRotationScale.rotation=instanceQuaternion,instanceScale=Cesium.Cartesian3.fromElements(1,1,1,instanceScale);var scale4=featureTable.getProperty("SCALE",Cesium.ComponentDatatype.FLOAT,1,i);Cesium.defined(scale4)&&Cesium.Cartesian3.multiplyByScalar(instanceScale,scale4,instanceScale);var nonUniformScale=featureTable.getProperty("SCALE_NON_UNIFORM",Cesium.ComponentDatatype.FLOAT,3,i,propertyScratch1);Cesium.defined(nonUniformScale)&&(instanceScale.x*=nonUniformScale[0],instanceScale.y*=nonUniformScale[1],instanceScale.z*=nonUniformScale[2]),instanceTranslationRotationScale.scale=instanceScale;var batchId=featureTable.getProperty("BATCH_ID",Cesium.ComponentDatatype.UNSIGNED_SHORT,1,i);Cesium.defined(batchId)||(batchId=i),Cesium.Matrix4.fromTranslationRotationScale(instanceTranslationRotationScale,instanceTransform);var modelMatrix=instanceTransform.clone();instances[i]={modelMatrix,batchId}}var gltf=collectionOptions.gltf;if(Cesium.defined(gltf)&&(gltf instanceof ArrayBuffer&&(gltf=new Uint8Array(gltf)),gltf instanceof Uint8Array&&(collectionOptions.gltf=Cesium.parseGlb(gltf)),Cesium.defined(collectionOptions.gltf.asset)&&collectionOptions.gltf.asset.version=="2.0")){var oldBatchTable=content._batchTable,blGltfInstance=!1,newBatchTableJson={EVID:[],id:[],name:[]},nodes=collectionOptions.gltf.nodes;if(nodes.length>0&&Cesium.defined(nodes[0].instanceIndex)&&(blGltfInstance=!0),blGltfInstance){for(var newInstances=new Array(collectionOptions.instances.length*nodes.length),m=0;m<collectionOptions.instances.length;m++)for(var n=0;n<nodes.length;n++)if(Cesium.defined(nodes[n].matrix)&&Cesium.defined(nodes[n].instanceIndex)){var newNodeMat4=Cesium.Matrix4.clone(nodes[n].matrix,new Cesium.Matrix4);newNodeMat4[1]=-nodes[n].matrix[2],newNodeMat4[2]=nodes[n].matrix[1],newNodeMat4[4]=-nodes[n].matrix[8],newNodeMat4[5]=nodes[n].matrix[10],newNodeMat4[6]=-nodes[n].matrix[9],newNodeMat4[8]=nodes[n].matrix[4],newNodeMat4[9]=-nodes[n].matrix[6],newNodeMat4[10]=nodes[n].matrix[5],newNodeMat4[13]=-nodes[n].matrix[14],newNodeMat4[14]=nodes[n].matrix[13];var newModelMatrix=Cesium.Matrix4.multiplyTransformation(collectionOptions.instances[m].modelMatrix,newNodeMat4,new Cesium.Matrix4);newInstances[m*nodes.length+n]={modelMatrix:newModelMatrix,batchId:m*nodes.length+n},Cesium.defined(oldBatchTable._properties.EVID)?newBatchTableJson.EVID.push(oldBatchTable._properties.EVID[m]):newBatchTableJson.EVID.push(0),newBatchTableJson.id.push(nodes[n].instanceIndex),newBatchTableJson.name.push(oldBatchTable._properties.name[m])}else throw new Cesium.DeveloperError("Instanced3DModel3DTileContent: nodes["+n+"].instanceIndex is empty");collectionOptions.instances.length=0,collectionOptions.instances=newInstances;var instancesLength=collectionOptions.instances.length;content._batchTable=new Cesium3DTileBatchTable_default(content,instancesLength,newBatchTableJson),collectionOptions.batchTable=content._batchTable}}content._modelInstanceCollection=new ModelInstanceCollection_default(collectionOptions)}function createFeatures3(content){var featuresLength=content.featuresLength;if(!Cesium.defined(content._features)&&featuresLength>0){for(var features=new Array(featuresLength),i=0;i<featuresLength;++i)features[i]=new Cesium3DTileFeature_default(content,i);content._features=features}}Instanced3DModel3DTileContent.prototype.hasProperty=function(batchId,name){return this._batchTable.hasProperty(batchId,name)};Instanced3DModel3DTileContent.prototype.getFeature=function(batchId){var featuresLength=this.featuresLength;return createFeatures3(this),this._features[batchId]};Instanced3DModel3DTileContent.prototype.applyDebugSettings=function(enabled,color){color=enabled?color:Cesium.Color.WHITE,this._batchTable.setAllColor(color)};Instanced3DModel3DTileContent.prototype.applyStyle=function(style){this._batchTable.applyStyle(style)};Instanced3DModel3DTileContent.prototype.update=function(tileset,frameState){var commandStart=frameState.commandList.length;this._batchTable.update(tileset,frameState),this._modelInstanceCollection.modelMatrix=this._tile.computedTransform,this._modelInstanceCollection.shadows=this._tileset.shadows,this._modelInstanceCollection.lightColor=this._tileset.lightColor,this._modelInstanceCollection.luminanceAtZenith=this._tileset.luminanceAtZenith,this._modelInstanceCollection.sphericalHarmonicCoefficients=this._tileset.sphericalHarmonicCoefficients,this._modelInstanceCollection.specularEnvironmentMaps=this._tileset.specularEnvironmentMaps,this._modelInstanceCollection.debugWireframe=this._tileset.debugWireframe,this._modelInstanceCollection._tilesetFlat=this._tileset._tilesetFlat,this._modelInstanceCollection.sharedResources={instancedPrograms:{name:this.tile.sharedResources.instancedPrograms.name,shadredData:this.tile.sharedResources.instancedPrograms.shadredData},ktxs:this.tile.sharedResources.ktxs},this._modelInstanceCollection.gltfShader=this._tileset.gltfShader;var model=this._modelInstanceCollection._model;if(Cesium.defined(model)){model.useIndexedDBCache=this._tileset.useIndexedDBCache;var tilesetClippingPlanes=this._tileset.clippingPlanes;model.clippingPlanesOriginMatrix=this._tileset.clippingPlanesOriginMatrix,Cesium.defined(tilesetClippingPlanes)&&this._tile.clippingPlanesDirty&&(model._clippingPlanes=tilesetClippingPlanes.enabled&&this._tile._isClipped?tilesetClippingPlanes:void 0),Cesium.defined(tilesetClippingPlanes)&&Cesium.defined(model._clippingPlanes)&&model._clippingPlanes!==tilesetClippingPlanes&&(model._clippingPlanes=tilesetClippingPlanes)}this._modelInstanceCollection.update(frameState);var commandEnd=frameState.commandList.length;commandStart<commandEnd&&(frameState.passes.render||frameState.passes.pick)&&this._batchTable.addDerivedCommands(frameState,commandStart,!1)};Instanced3DModel3DTileContent.prototype.isDestroyed=function(){return!1};Instanced3DModel3DTileContent.prototype.destroy=function(){return this._modelInstanceCollection=this._modelInstanceCollection&&this._modelInstanceCollection.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Cesium.destroyObject(this)};var Instanced3DModel3DTileContent_default=Instanced3DModel3DTileContent;function defaultValue(a,b){return a??b}defaultValue.EMPTY_OBJECT=Object.freeze({});var defaultValue_default=defaultValue;function clone(object2,deep){if(object2===null||typeof object2!="object")return object2;deep=defaultValue_default(deep,!1);let result=new object2.constructor;for(let propertyName in object2)if(object2.hasOwnProperty(propertyName)){let value=object2[propertyName];deep&&(value=clone(value,deep)),result[propertyName]=value}return result}var clone_default=clone;var DecodingState={NEEDS_DECODE:0,DECODING:1,READY:2,FAILED:3};function PointCloud(options){this._parsedContent=void 0,this._drawCommand=void 0,this._isTranslucent=!1,this._styleTranslucent=!1,this._constantColor=Cesium.Color.clone(Cesium.Color.DARKGRAY),this._highlightColor=Cesium.Color.clone(Cesium.Color.WHITE),this._pointSize=2,this._rtcCenter=void 0,this._quantizedVolumeScale=void 0,this._quantizedVolumeOffset=void 0,this._styleableShaderAttributes=void 0,this._isQuantized=!1,this._isOctEncoded16P=!1,this._isRGB565=!1,this._hasColors=!1,this._hasNormals=!1,this._hasBatchIds=!1,this._decodingState=DecodingState.READY,this._dequantizeInShader=!0,this._isQuantizedDraco=!1,this._isOctEncodedDraco=!1,this._quantizedRange=0,this._octEncodedRange=0,this.backFaceCulling=!1,this._backFaceCulling=!1,this.normalShading=!0,this._normalShading=!0,this._opaqueRenderState=void 0,this._translucentRenderState=void 0,this._mode=void 0,this._ready=!1,this._readyPromise=when_default.defer(),this._pointsLength=0,this._geometryByteLength=0,this._vertexShaderLoaded=options.vertexShaderLoaded,this._fragmentShaderLoaded=options.fragmentShaderLoaded,this._uniformMapLoaded=options.uniformMapLoaded,this._batchTableLoaded=options.batchTableLoaded,this._pickIdLoaded=options.pickIdLoaded,this._opaquePass=Cesium.defaultValue(options.opaquePass,Cesium.Pass.OPAQUE),this._cull=Cesium.defaultValue(options.cull,!0),this.style=void 0,this._style=void 0,this.styleDirty=!1,this.modelMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._modelMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this.time=0,this.shadows=Cesium.ShadowMode.ENABLED,this._boundingSphere=void 0,this.clippingPlanes=void 0,this.isClipped=!1,this.clippingPlanesDirty=!1,this.clippingPlanesOriginMatrix=void 0,this.attenuation=!1,this._attenuation=!1,this.geometricError=0,this.geometricErrorScale=1,this.maximumAttenuation=this._pointSize,this.useElevation=Cesium.defaultValue(options.useElevation,!1),this.elevationMap=Cesium.defaultValue(options.elevationMap,void 0),this.meshPrimitives=[],this.useDracoDecoded=!1,initialize4(this,options)}Object.defineProperties(PointCloud.prototype,{pointsLength:{get:function(){return this._pointsLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},color:{get:function(){return Cesium.Color.clone(this._highlightColor)},set:function(value){this._highlightColor=Cesium.Color.clone(value,this._highlightColor)}},boundingSphere:{get:function(){if(Cesium.defined(this._drawCommand))return this._drawCommand.boundingVolume},set:function(value){this._boundingSphere=Cesium.BoundingSphere.clone(value,this._boundingSphere)}}});var sizeOfUint325=Uint32Array.BYTES_PER_ELEMENT;function initialize4(pointCloud,options){var arrayBuffer=options.arrayBuffer,byteOffset=Cesium.defaultValue(options.byteOffset,0),uint8Array=new Uint8Array(arrayBuffer),view=new DataView(arrayBuffer);byteOffset+=sizeOfUint325;var version=view.getUint32(byteOffset,!0);if(version!==1)throw new Cesium.RuntimeError("Only Point Cloud tile version 1 is supported.  Version "+version+" is not.");byteOffset+=sizeOfUint325,byteOffset+=sizeOfUint325;var featureTableJsonByteLength=view.getUint32(byteOffset,!0);if(featureTableJsonByteLength===0)throw new Cesium.RuntimeError("Feature table must have a byte length greater than zero");byteOffset+=sizeOfUint325;var featureTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint325;var batchTableJsonByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint325;var batchTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint325;var featureTableString=Cesium.getStringFromTypedArray(uint8Array,byteOffset,featureTableJsonByteLength),featureTableJson=JSON.parse(featureTableString);byteOffset+=featureTableJsonByteLength;var featureTableBinary=new Uint8Array(arrayBuffer,byteOffset,featureTableBinaryByteLength);byteOffset+=featureTableBinaryByteLength;var batchTableJson,batchTableBinary;if(batchTableJsonByteLength>0){var batchTableString=Cesium.getStringFromTypedArray(uint8Array,byteOffset,batchTableJsonByteLength);batchTableJson=JSON.parse(batchTableString),byteOffset+=batchTableJsonByteLength,batchTableBinaryByteLength>0&&(batchTableBinary=new Uint8Array(arrayBuffer,byteOffset,batchTableBinaryByteLength),byteOffset+=batchTableBinaryByteLength)}var featureTable=new Cesium3DTileFeatureTable_default(featureTableJson,featureTableBinary),pointsLength=featureTable.getGlobalProperty("POINTS_LENGTH");if(featureTable.featuresLength=pointsLength,!Cesium.defined(pointsLength))throw new Cesium.RuntimeError("Feature table global property: POINTS_LENGTH must be defined");var rtcCenter=featureTable.getGlobalProperty("RTC_CENTER",Cesium.ComponentDatatype.FLOAT,3);Cesium.defined(rtcCenter)&&(pointCloud._rtcCenter=Cesium.Cartesian3.unpack(rtcCenter));var positions,colors,normals,batchIds,hasPositions=!1,hasColors=!1,hasNormals=!1,hasBatchIds=!1,isQuantized=!1,isTranslucent2=!1,isRGB565=!1,isOctEncoded16P=!1,dracoBuffer,dracoFeatureTableProperties,dracoBatchTableProperties,featureTableDraco=Cesium.defined(featureTableJson.extensions)?featureTableJson.extensions["3DTILES_draco_point_compression"]:void 0,batchTableDraco=Cesium.defined(batchTableJson)&&Cesium.defined(batchTableJson.extensions)?batchTableJson.extensions["3DTILES_draco_point_compression"]:void 0;if(Cesium.defined(batchTableDraco)&&(dracoBatchTableProperties=batchTableDraco.properties),Cesium.defined(featureTableDraco)){dracoFeatureTableProperties=featureTableDraco.properties;var dracoByteOffset=featureTableDraco.byteOffset,dracoByteLength=featureTableDraco.byteLength;if(!Cesium.defined(dracoFeatureTableProperties)||!Cesium.defined(dracoByteOffset)||!Cesium.defined(dracoByteLength))throw new Cesium.RuntimeError("Draco properties, byteOffset, and byteLength must be defined");dracoBuffer=arraySlice_default(featureTableBinary,dracoByteOffset,dracoByteOffset+dracoByteLength),hasPositions=Cesium.defined(dracoFeatureTableProperties.POSITION),hasColors=Cesium.defined(dracoFeatureTableProperties.RGB)||Cesium.defined(dracoFeatureTableProperties.RGBA),hasNormals=Cesium.defined(dracoFeatureTableProperties.NORMAL),hasBatchIds=Cesium.defined(dracoFeatureTableProperties.BATCH_ID),isTranslucent2=Cesium.defined(dracoFeatureTableProperties.RGBA),pointCloud._decodingState=DecodingState.NEEDS_DECODE}var draco;if(Cesium.defined(dracoBuffer)&&(draco={buffer:dracoBuffer,featureTableProperties:dracoFeatureTableProperties,batchTableProperties:dracoBatchTableProperties,properties:Cesium.combine(dracoFeatureTableProperties,dracoBatchTableProperties),dequantizeInShader:pointCloud._dequantizeInShader}),!hasPositions){if(Cesium.defined(featureTableJson.POSITION))positions=featureTable.getPropertyArray("POSITION",Cesium.ComponentDatatype.FLOAT,3),hasPositions=!0;else if(Cesium.defined(featureTableJson.POSITION_QUANTIZED)){positions=featureTable.getPropertyArray("POSITION_QUANTIZED",Cesium.ComponentDatatype.UNSIGNED_SHORT,3),isQuantized=!0,hasPositions=!0;var quantizedVolumeScale=featureTable.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Cesium.ComponentDatatype.FLOAT,3);if(!Cesium.defined(quantizedVolumeScale))throw new Cesium.RuntimeError("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");pointCloud._quantizedVolumeScale=Cesium.Cartesian3.unpack(quantizedVolumeScale),pointCloud._quantizedRange=(1<<16)-1;var quantizedVolumeOffset=featureTable.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Cesium.ComponentDatatype.FLOAT,3);if(!Cesium.defined(quantizedVolumeOffset))throw new Cesium.RuntimeError("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");pointCloud._quantizedVolumeOffset=Cesium.Cartesian3.unpack(quantizedVolumeOffset)}}if(hasColors||(Cesium.defined(featureTableJson.RGBA)?(colors=featureTable.getPropertyArray("RGBA",Cesium.ComponentDatatype.UNSIGNED_BYTE,4),isTranslucent2=!0,hasColors=!0):Cesium.defined(featureTableJson.RGB)?(colors=featureTable.getPropertyArray("RGB",Cesium.ComponentDatatype.UNSIGNED_BYTE,3),hasColors=!0):Cesium.defined(featureTableJson.RGB565)&&(colors=featureTable.getPropertyArray("RGB565",Cesium.ComponentDatatype.UNSIGNED_SHORT,1),isRGB565=!0,hasColors=!0)),hasNormals||(Cesium.defined(featureTableJson.NORMAL)?(normals=featureTable.getPropertyArray("NORMAL",Cesium.ComponentDatatype.FLOAT,3),hasNormals=!0):Cesium.defined(featureTableJson.NORMAL_OCT16P)&&(normals=featureTable.getPropertyArray("NORMAL_OCT16P",Cesium.ComponentDatatype.UNSIGNED_BYTE,2),isOctEncoded16P=!0,hasNormals=!0)),hasBatchIds||Cesium.defined(featureTableJson.BATCH_ID)&&(batchIds=featureTable.getPropertyArray("BATCH_ID",Cesium.ComponentDatatype.UNSIGNED_SHORT,1),hasBatchIds=!0),!hasPositions)throw new Cesium.RuntimeError("Either POSITION or POSITION_QUANTIZED must be defined.");if(Cesium.defined(featureTableJson.CONSTANT_RGBA)){var constantRGBA=featureTable.getGlobalProperty("CONSTANT_RGBA",Cesium.ComponentDatatype.UNSIGNED_BYTE,4);pointCloud._constantColor=Cesium.Color.fromBytes(constantRGBA[0],constantRGBA[1],constantRGBA[2],constantRGBA[3],pointCloud._constantColor)}if(hasBatchIds){var batchLength=featureTable.getGlobalProperty("BATCH_LENGTH");if(!Cesium.defined(batchLength))throw new Cesium.RuntimeError("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");Cesium.defined(batchTableBinary)&&(batchTableBinary=new Uint8Array(batchTableBinary)),Cesium.defined(pointCloud._batchTableLoaded)&&pointCloud._batchTableLoaded(batchLength,batchTableJson,batchTableBinary)}var styleableProperties;(!hasBatchIds||pointCloud.useElevation)&&Cesium.defined(batchTableBinary)&&(styleableProperties=Cesium3DTileBatchTable_default.getBinaryProperties(pointsLength,batchTableJson,batchTableBinary)),pointCloud._parsedContent={positions,colors,normals,batchIds,styleableProperties,draco},pointCloud._pointsLength=pointsLength,pointCloud._isQuantized=isQuantized,pointCloud._isOctEncoded16P=isOctEncoded16P,pointCloud._isRGB565=isRGB565,pointCloud._isTranslucent=isTranslucent2,pointCloud._hasColors=hasColors,pointCloud._hasNormals=hasNormals,pointCloud._hasBatchIds=hasBatchIds}var scratchMin=new Cesium.Cartesian3,scratchMax=new Cesium.Cartesian3,scratchPosition2=new Cesium.Cartesian3,randomValues;function getRandomValues(samplesLength){if(!Cesium.defined(randomValues)){Cesium.Math.setRandomNumberSeed(0),randomValues=new Array(samplesLength);for(var i=0;i<samplesLength;++i)randomValues[i]=Cesium.Math.nextRandomNumber()}return randomValues}function computeApproximateBoundingSphereFromPositions(positions){for(var maximumSamplesLength=20,pointsLength=positions.length/3,samplesLength=Math.min(pointsLength,maximumSamplesLength),randomValues2=getRandomValues(maximumSamplesLength),maxValue=Number.MAX_VALUE,minValue=-Number.MAX_VALUE,min4=Cesium.Cartesian3.fromElements(maxValue,maxValue,maxValue,scratchMin),max3=Cesium.Cartesian3.fromElements(minValue,minValue,minValue,scratchMax),i=0;i<samplesLength;++i){var index=Math.floor(randomValues2[i]*pointsLength),position=Cesium.Cartesian3.unpack(positions,index*3,scratchPosition2);Cesium.Cartesian3.minimumByComponent(min4,position,min4),Cesium.Cartesian3.maximumByComponent(max3,position,max3)}var boundingSphere=Cesium.BoundingSphere.fromCornerPoints(min4,max3);return boundingSphere.radius+=Cesium.Math.EPSILON2,boundingSphere}function prepareVertexAttribute(typedArray,name){var componentDatatype=Cesium.ComponentDatatype.fromTypedArray(typedArray);return componentDatatype===Cesium.ComponentDatatype.INT||componentDatatype===Cesium.ComponentDatatype.UNSIGNED_INT||componentDatatype===Cesium.ComponentDatatype.DOUBLE?(Cesium.oneTimeWarning("Cast pnts property to floats",'Point cloud property "'+name+'" will be casted to a float array because INT, UNSIGNED_INT, and DOUBLE are not valid WebGL vertex attribute types. Some precision may be lost.'),new Float32Array(typedArray)):typedArray}var scratchPointSizeAndTimeAndGeometricErrorAndDepthMultiplier=new Cesium.Cartesian4,scratchQuantizedVolumeScaleAndOctEncodedRange=new Cesium.Cartesian4,scratchColor2=new Cesium.Color,positionLocation=0,colorLocation=1,normalLocation=2,batchIdLocation=3,numberOfAttributes=4,scratchClippingPlaneMatrix3=new Cesium.Matrix4;function createResources3(pointCloud,frameState){var context=frameState.context,parsedContent=pointCloud._parsedContent,pointsLength=pointCloud._pointsLength,positions=parsedContent.positions,colors=parsedContent.colors,normals=parsedContent.normals,batchIds=parsedContent.batchIds,styleableProperties=parsedContent.styleableProperties,hasStyleableProperties=Cesium.defined(styleableProperties),isQuantized=pointCloud._isQuantized,isQuantizedDraco=pointCloud._isQuantizedDraco,isOctEncoded16P=pointCloud._isOctEncoded16P,isOctEncodedDraco=pointCloud._isOctEncodedDraco,quantizedRange=pointCloud._quantizedRange,octEncodedRange=pointCloud._octEncodedRange,isRGB565=pointCloud._isRGB565,isTranslucent2=pointCloud._isTranslucent,hasColors=pointCloud._hasColors,hasNormals=pointCloud._hasNormals,hasBatchIds=pointCloud._hasBatchIds,componentsPerAttribute,componentDatatype,styleableVertexAttributes=[],styleableShaderAttributes={};if(pointCloud._styleableShaderAttributes=styleableShaderAttributes,hasStyleableProperties){var attributeLocation=numberOfAttributes;for(var name in styleableProperties)if(styleableProperties.hasOwnProperty(name)){var property=styleableProperties[name],typedArray=prepareVertexAttribute(property.typedArray,name);componentsPerAttribute=property.componentCount,componentDatatype=Cesium.ComponentDatatype.fromTypedArray(typedArray);var vertexBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray,usage:Cesium.BufferUsage.STATIC_DRAW});pointCloud._geometryByteLength+=vertexBuffer.sizeInBytes;var vertexAttribute={index:attributeLocation,vertexBuffer,componentsPerAttribute,componentDatatype,normalize:!1,offsetInBytes:0,strideInBytes:0};styleableVertexAttributes.push(vertexAttribute),styleableShaderAttributes[name]={location:attributeLocation,componentCount:componentsPerAttribute},++attributeLocation}}var positionsVertexBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray:positions,usage:Cesium.BufferUsage.STATIC_DRAW});pointCloud._geometryByteLength+=positionsVertexBuffer.sizeInBytes;var colorsVertexBuffer;hasColors&&(colorsVertexBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray:colors,usage:Cesium.BufferUsage.STATIC_DRAW}),pointCloud._geometryByteLength+=colorsVertexBuffer.sizeInBytes);var normalsVertexBuffer;hasNormals&&(normalsVertexBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray:normals,usage:Cesium.BufferUsage.STATIC_DRAW}),pointCloud._geometryByteLength+=normalsVertexBuffer.sizeInBytes);var batchIdsVertexBuffer;hasBatchIds&&(batchIds=prepareVertexAttribute(batchIds,"batchIds"),batchIdsVertexBuffer=Cesium.Buffer.createVertexBuffer({context,typedArray:batchIds,usage:Cesium.BufferUsage.STATIC_DRAW}),pointCloud._geometryByteLength+=batchIdsVertexBuffer.sizeInBytes);var attributes=[];if(isQuantized?componentDatatype=Cesium.ComponentDatatype.UNSIGNED_SHORT:isQuantizedDraco?componentDatatype=quantizedRange<=255?Cesium.ComponentDatatype.UNSIGNED_BYTE:Cesium.ComponentDatatype.UNSIGNED_SHORT:componentDatatype=Cesium.ComponentDatatype.FLOAT,attributes.push({index:positionLocation,vertexBuffer:positionsVertexBuffer,componentsPerAttribute:3,componentDatatype,normalize:!1,offsetInBytes:0,strideInBytes:0}),pointCloud._cull&&(isQuantized||isQuantizedDraco?pointCloud._boundingSphere=Cesium.BoundingSphere.fromCornerPoints(Cesium.Cartesian3.ZERO,pointCloud._quantizedVolumeScale):pointCloud._boundingSphere=computeApproximateBoundingSphereFromPositions(positions)),hasColors)if(isRGB565)attributes.push({index:colorLocation,vertexBuffer:colorsVertexBuffer,componentsPerAttribute:1,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0});else{var colorComponentsPerAttribute=isTranslucent2?4:3;attributes.push({index:colorLocation,vertexBuffer:colorsVertexBuffer,componentsPerAttribute:colorComponentsPerAttribute,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0})}hasNormals&&(isOctEncoded16P?(componentsPerAttribute=2,componentDatatype=Cesium.ComponentDatatype.UNSIGNED_BYTE):isOctEncodedDraco?(componentsPerAttribute=2,componentDatatype=octEncodedRange<=255?Cesium.ComponentDatatype.UNSIGNED_BYTE:Cesium.ComponentDatatype.UNSIGNED_SHORT):(componentsPerAttribute=3,componentDatatype=Cesium.ComponentDatatype.FLOAT),attributes.push({index:normalLocation,vertexBuffer:normalsVertexBuffer,componentsPerAttribute,componentDatatype,normalize:!1,offsetInBytes:0,strideInBytes:0})),hasBatchIds&&attributes.push({index:batchIdLocation,vertexBuffer:batchIdsVertexBuffer,componentsPerAttribute:1,componentDatatype:Cesium.ComponentDatatype.fromTypedArray(batchIds),normalize:!1,offsetInBytes:0,strideInBytes:0}),hasStyleableProperties&&(attributes=attributes.concat(styleableVertexAttributes));var vertexArray=new Cesium.VertexArray({context,attributes}),opaqueRenderState={depthTest:{enabled:!0}};pointCloud._opaquePass===Cesium.Pass.CESIUM_3D_TILE&&(opaqueRenderState.stencilTest=Cesium.StencilConstants.setCesium3DTileBit(),opaqueRenderState.stencilMask=Cesium.StencilConstants.CESIUM_3D_TILE_MASK),pointCloud._opaqueRenderState=Cesium.RenderState.fromCache(opaqueRenderState),pointCloud._translucentRenderState=Cesium.RenderState.fromCache({depthTest:{enabled:!0},depthMask:!1,blending:Cesium.BlendingState.ALPHA_BLEND}),pointCloud._drawCommand=new Cesium.DrawCommand({boundingVolume:new Cesium.BoundingSphere,cull:pointCloud._cull,modelMatrix:new Cesium.Matrix4,primitiveType:Cesium.PrimitiveType.POINTS,vertexArray,count:pointsLength,shaderProgram:void 0,uniformMap:void 0,renderState:isTranslucent2?pointCloud._translucentRenderState:pointCloud._opaqueRenderState,pass:isTranslucent2?Cesium.Pass.TRANSLUCENT:pointCloud._opaquePass,owner:pointCloud,castShadows:!1,receiveShadows:!1,pickId:pointCloud._pickIdLoaded()})}function createUniformMap(pointCloud,frameState){var context=frameState.context,isQuantized=pointCloud._isQuantized,isQuantizedDraco=pointCloud._isQuantizedDraco,isOctEncodedDraco=pointCloud._isOctEncodedDraco,uniformMap={u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier:function(){var scratch=scratchPointSizeAndTimeAndGeometricErrorAndDepthMultiplier;if(scratch.x=pointCloud._attenuation?pointCloud.maximumAttenuation:pointCloud._pointSize,scratch.x*=frameState.pixelRatio,scratch.y=pointCloud.time,pointCloud._attenuation){var frustum=frameState.camera.frustum,depthMultiplier;frameState.mode===Cesium.SceneMode.SCENE2D||frustum instanceof Cesium.OrthographicFrustum?depthMultiplier=Number.POSITIVE_INFINITY:depthMultiplier=context.drawingBufferHeight/frameState.camera.frustum.sseDenominator,scratch.z=pointCloud.geometricError*pointCloud.geometricErrorScale,scratch.w=depthMultiplier}return scratch},u_highlightColor:function(){return pointCloud._highlightColor},u_constantColor:function(){return pointCloud._constantColor},u_clippingPlanes:function(){var clippingPlanes=pointCloud.clippingPlanes,isClipped=pointCloud.isClipped;return isClipped?clippingPlanes.texture:context.defaultTexture},u_clippingPlanesEdgeStyle:function(){var clippingPlanes=pointCloud.clippingPlanes;if(!Cesium.defined(clippingPlanes))return Cesium.Color.TRANSPARENT;var style=Cesium.Color.clone(clippingPlanes.edgeColor,scratchColor2);return style.alpha=clippingPlanes.edgeWidth,style},u_clippingPlanesMatrix:function(){var clippingPlanes=pointCloud.clippingPlanes;if(!Cesium.defined(clippingPlanes))return Cesium.Matrix4.IDENTITY;var clippingPlanesOriginMatrix=Cesium.defaultValue(pointCloud.clippingPlanesOriginMatrix,pointCloud._modelMatrix);return Cesium.Matrix4.multiply(context.uniformState.view3D,clippingPlanesOriginMatrix,scratchClippingPlaneMatrix3),Cesium.Matrix4.multiply(scratchClippingPlaneMatrix3,clippingPlanes.modelMatrix,scratchClippingPlaneMatrix3)}};pointCloud.useElevation&&(uniformMap=Cesium.combine(uniformMap,{u_maximumHeight:function(){return pointCloud.elevationMax},u_minimumHeight:function(){return pointCloud.elevationMin},u_image:function(){return createTexture4(context,pointCloud.elevationMap)}})),(isQuantized||isQuantizedDraco||isOctEncodedDraco)&&(uniformMap=Cesium.combine(uniformMap,{u_quantizedVolumeScaleAndOctEncodedRange:function(){var scratch=scratchQuantizedVolumeScaleAndOctEncodedRange;if(Cesium.defined(pointCloud._quantizedVolumeScale)){var scale4=Cesium.Cartesian3.clone(pointCloud._quantizedVolumeScale,scratch);Cesium.Cartesian3.divideByScalar(scale4,pointCloud._quantizedRange,scratch)}return scratch.w=pointCloud._octEncodedRange,scratch}})),Cesium.defined(pointCloud._uniformMapLoaded)&&(uniformMap=pointCloud._uniformMapLoaded(uniformMap)),pointCloud._drawCommand.uniformMap=uniformMap}var defaultProperties=["POSITION","COLOR","NORMAL","POSITION_ABSOLUTE"];function getStyleableProperties(source,properties){for(var regex=/czm_tiles3d_style_(\w+)/g,matches=regex.exec(source);matches!==null;){var name=matches[1];properties.indexOf(name)===-1&&properties.push(name),matches=regex.exec(source)}}function getVertexAttribute(vertexArray,index){for(var numberOfAttributes2=vertexArray.numberOfAttributes,i=0;i<numberOfAttributes2;++i){var attribute=vertexArray.getAttribute(i);if(attribute.index===index)return attribute}}function modifyStyleFunction(source){for(var length3=defaultProperties.length,i=0;i<length3;++i){var property=defaultProperties[i],styleName="czm_tiles3d_style_"+property,replaceName=property.toLowerCase();source=source.replace(new RegExp(styleName+"(\\W)","g"),replaceName+"$1")}return source.replace("()","(vec3 position, vec3 position_absolute, vec4 color, vec3 normal)")}function createShaderforElevation(){return`vec4 getColorFromElevation()
{
     float scaledHeight = clamp((czm_tiles3d_style_elevation - u_minimumHeight) / (u_maximumHeight - u_minimumHeight), 0.0, 1.0);
     vec4 rampColor = texture2D(u_image, vec2(scaledHeight, 0.5));
     rampColor = czm_gammaCorrect(rampColor);
     return rampColor;
}
`}var builtinVariableSubstitutionMap={POSITION:"czm_3dtiles_builtin_property_POSITION",POSITION_ABSOLUTE:"czm_3dtiles_builtin_property_POSITION_ABSOLUTE",COLOR:"czm_3dtiles_builtin_property_COLOR",NORMAL:"czm_3dtiles_builtin_property_NORMAL"};function createShaders(pointCloud,frameState,style){var i,name,attribute,context=frameState.context,hasStyle=Cesium.defined(style),isQuantized=pointCloud._isQuantized,isQuantizedDraco=pointCloud._isQuantizedDraco,isOctEncoded16P=pointCloud._isOctEncoded16P,isOctEncodedDraco=pointCloud._isOctEncodedDraco,isRGB565=pointCloud._isRGB565,isTranslucent2=pointCloud._isTranslucent,hasColors=pointCloud._hasColors,hasNormals=pointCloud._hasNormals,hasBatchIds=pointCloud._hasBatchIds,backFaceCulling=pointCloud._backFaceCulling,normalShading=pointCloud._normalShading,vertexArray=pointCloud._drawCommand.vertexArray,clippingPlanes=pointCloud.clippingPlanes,attenuation=pointCloud._attenuation,colorStyleFunction,showStyleFunction,pointSizeStyleFunction,styleTranslucent=isTranslucent2;let variableSubstitutionMap=clone_default(builtinVariableSubstitutionMap);if(hasStyle){var shaderState={translucent:!1};let parameterList="(vec3 czm_3dtiles_builtin_property_POSITION, vec3 czm_3dtiles_builtin_property_POSITION_ABSOLUTE, vec4 czm_3dtiles_builtin_property_COLOR, vec3 czm_3dtiles_builtin_property_NORMAL)";colorStyleFunction=style.getColorShaderFunction("getColorFromStyle","czm_tiles3d_style_",shaderState),showStyleFunction=style.getShowShaderFunction("getShowFromStyle","czm_tiles3d_style_",shaderState),pointSizeStyleFunction=style.getPointSizeShaderFunction("getPointSizeFromStyle","czm_tiles3d_style_",shaderState),Cesium.defined(colorStyleFunction)&&shaderState.translucent&&(styleTranslucent=!0)}pointCloud._styleTranslucent=styleTranslucent;var hasColorStyle=Cesium.defined(colorStyleFunction),hasShowStyle=Cesium.defined(showStyleFunction),hasPointSizeStyle=Cesium.defined(pointSizeStyleFunction),hasClippedContent=pointCloud.isClipped,styleableProperties=[];hasColorStyle&&(getStyleableProperties(colorStyleFunction,styleableProperties),colorStyleFunction=modifyStyleFunction(colorStyleFunction)),pointCloud.useElevation&&!styleableProperties.includes("elevation")&&styleableProperties.push("elevation"),hasShowStyle&&(getStyleableProperties(showStyleFunction,styleableProperties),showStyleFunction=modifyStyleFunction(showStyleFunction)),hasPointSizeStyle&&(getStyleableProperties(pointSizeStyleFunction,styleableProperties),pointSizeStyleFunction=modifyStyleFunction(pointSizeStyleFunction));var usesColorSemantic=styleableProperties.indexOf("COLOR")>=0,usesNormalSemantic=styleableProperties.indexOf("NORMAL")>=0,userProperties=styleableProperties.filter(function(property){return defaultProperties.indexOf(property)===-1});if(usesNormalSemantic&&!hasNormals)throw new Cesium.RuntimeError("Style references the NORMAL semantic but the point cloud does not have normals");var styleableShaderAttributes=pointCloud._styleableShaderAttributes;for(name in styleableShaderAttributes)if(styleableShaderAttributes.hasOwnProperty(name)){attribute=styleableShaderAttributes[name];var enabled=userProperties.indexOf(name)>=0,vertexAttribute=getVertexAttribute(vertexArray,attribute.location);vertexAttribute.enabled=enabled}var usesColors=hasColors&&(!hasColorStyle||usesColorSemantic);if(hasColors){var colorVertexAttribute=getVertexAttribute(vertexArray,colorLocation);colorVertexAttribute.enabled=usesColors}var usesNormals=hasNormals&&(normalShading||backFaceCulling||usesNormalSemantic);if(hasNormals){var normalVertexAttribute=getVertexAttribute(vertexArray,normalLocation);normalVertexAttribute.enabled=usesNormals}var attributeLocations={a_position:positionLocation};usesColors&&(attributeLocations.a_color=colorLocation),usesNormals&&(attributeLocations.a_normal=normalLocation),hasBatchIds&&(attributeLocations.a_batchId=batchIdLocation);var attributeDeclarations="",length3=userProperties.length;for(i=0;i<length3;++i){if(name=userProperties[i],attribute=styleableShaderAttributes[name],!Cesium.defined(attribute))throw new Cesium.RuntimeError('Style references a property "'+name+'" that does not exist or is not styleable.');var componentCount=attribute.componentCount,attributeName="czm_tiles3d_style_"+name,attributeType;componentCount===1?attributeType="float":attributeType="vec"+componentCount,attributeDeclarations+="attribute "+attributeType+" "+attributeName+`; 
`,attributeLocations[attributeName]=attribute.location}createUniformMap(pointCloud,frameState);var vs=`attribute vec3 a_position; 
varying vec4 v_color; 
uniform vec4 u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier; 
uniform vec4 u_constantColor; 
uniform vec4 u_highlightColor; 
`;vs+=`float u_pointSize; 
float u_time; 
`,attenuation&&(vs+=`float u_geometricError; 
float u_depthMultiplier; 
`),pointCloud.useElevation&&(vs+=`uniform float u_minimumHeight;
uniform float u_maximumHeight; 
uniform sampler2D u_image; 
`),vs+=attributeDeclarations,usesColors&&(isTranslucent2?vs+=`attribute vec4 a_color; 
`:isRGB565?vs+=`attribute float a_color; 
const float SHIFT_RIGHT_11 = 1.0 / 2048.0; 
const float SHIFT_RIGHT_5 = 1.0 / 32.0; 
const float SHIFT_LEFT_11 = 2048.0; 
const float SHIFT_LEFT_5 = 32.0; 
const float NORMALIZE_6 = 1.0 / 64.0; 
const float NORMALIZE_5 = 1.0 / 32.0; 
`:vs+=`attribute vec3 a_color; 
`),usesNormals&&(isOctEncoded16P||isOctEncodedDraco?vs+=`attribute vec2 a_normal; 
`:vs+=`attribute vec3 a_normal; 
`),hasBatchIds&&(vs+=`attribute float a_batchId; 
`),(isQuantized||isQuantizedDraco||isOctEncodedDraco)&&(vs+=`uniform vec4 u_quantizedVolumeScaleAndOctEncodedRange; 
`),pointCloud.useElevation&&(vs+=createShaderforElevation()),hasColorStyle&&(vs+=colorStyleFunction),hasShowStyle&&(vs+=showStyleFunction),hasPointSizeStyle&&(vs+=pointSizeStyleFunction),vs+=`void main() 
{ 
    u_pointSize = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.x; 
    u_time = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.y; 
`,attenuation&&(vs+=`    u_geometricError = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.z; 
    u_depthMultiplier = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.w; 
`),usesColors?isTranslucent2?vs+=`    vec4 color = a_color; 
`:isRGB565?vs+=`    float compressed = a_color; 
    float r = floor(compressed * SHIFT_RIGHT_11); 
    compressed -= r * SHIFT_LEFT_11; 
    float g = floor(compressed * SHIFT_RIGHT_5); 
    compressed -= g * SHIFT_LEFT_5; 
    float b = compressed; 
    vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5); 
    vec4 color = vec4(rgb, 1.0); 
`:vs+=`    vec4 color = vec4(a_color, 1.0); 
`:vs+=`    vec4 color = u_constantColor; 
`,isQuantized||isQuantizedDraco?vs+=`    vec3 position = a_position * u_quantizedVolumeScaleAndOctEncodedRange.xyz; 
`:vs+=`    vec3 position = a_position; 
`,vs+=`    vec3 position_absolute = vec3(czm_model * vec4(position, 1.0)); 
`,usesNormals?(isOctEncoded16P?vs+=`    vec3 normal = czm_octDecode(a_normal); 
`:isOctEncodedDraco?vs+=`    vec3 normal = czm_octDecode(a_normal, u_quantizedVolumeScaleAndOctEncodedRange.w).zxy; 
`:vs+=`    vec3 normal = a_normal; 
`,vs+=`    vec3 normalEC = czm_normal * normal; 
`):vs+=`    vec3 normal = vec3(1.0); 
`,pointCloud.useElevation&&(vs+=`    color = getColorFromElevation(); 
`),hasColorStyle&&(vs+=`    color = getColorFromStyle(position, position_absolute, color, normal); 
`),hasShowStyle&&(vs+=`    float show = float(getShowFromStyle(position, position_absolute, color, normal)); 
`),hasPointSizeStyle?vs+=`    gl_PointSize = getPointSizeFromStyle(position, position_absolute, color, normal) * czm_pixelRatio; 
`:attenuation?vs+=`    vec4 positionEC = czm_modelView * vec4(position, 1.0); 
    float depth = -positionEC.z; 
    gl_PointSize = min((u_geometricError / depth) * u_depthMultiplier, u_pointSize); 
`:vs+=`    gl_PointSize = u_pointSize; 
`,vs+=`    color = color * u_highlightColor; 
`,usesNormals&&normalShading&&(vs+=`    float diffuseStrength = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC); 
    diffuseStrength = max(diffuseStrength, 0.4); 
    color.xyz *= diffuseStrength * czm_lightColor; 
`),vs+=`    v_color = color; 
    gl_Position = czm_modelViewProjection * vec4(position, 1.0); 
`,usesNormals&&backFaceCulling&&(vs+=`    float visible = step(-normalEC.z, 0.0); 
    gl_Position *= visible; 
    gl_PointSize *= visible; 
`),hasShowStyle&&(vs+=`    gl_Position.w *= float(show); 
    gl_PointSize *= float(show); 
`),vs+=`} 
`;var fs=`varying vec4 v_color; 
`;hasClippedContent&&(fs+=`uniform sampler2D u_clippingPlanes; 
uniform mat4 u_clippingPlanesMatrix; 
uniform vec4 u_clippingPlanesEdgeStyle; 
`,fs+=`
`,fs+=Cesium.getClippingFunction(clippingPlanes,context),fs+=`
`),fs+=`void main() 
{ 
    gl_FragColor = czm_gammaCorrect(v_color); 
`,hasClippedContent&&(fs+=Cesium.getClipAndStyleCode("u_clippingPlanes","u_clippingPlanesMatrix","u_clippingPlanesEdgeStyle")),fs+=`} 
`,Cesium.defined(pointCloud._vertexShaderLoaded)&&(vs=pointCloud._vertexShaderLoaded(vs)),Cesium.defined(pointCloud._fragmentShaderLoaded)&&(fs=pointCloud._fragmentShaderLoaded(fs));var drawCommand=pointCloud._drawCommand;Cesium.defined(drawCommand.shaderProgram)&&drawCommand.shaderProgram.destroy(),drawCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context,vertexShaderSource:vs,fragmentShaderSource:fs,attributeLocations});try{drawCommand.shaderProgram._bind()}catch{throw new Cesium.RuntimeError("Error generating style shader: this may be caused by a type mismatch, index out-of-bounds, or other syntax error.")}}function createTexture4(context,elevationMap){if(Cesium.defined(elevationMap.elevationTexture))return elevationMap.elevationTexture;var elevationRamp,colorRamp;if(Cesium.defined(elevationMap.elevationRamp)?elevationRamp=elevationMap.elevationRamp:elevationRamp=[0,.045,.1,.15,.37,.54,1],!Cesium.defined(elevationMap.colorRamp))colorRamp=["#000000","#2747E0","#D33B7D","#D33038","#FF9742","#ffd700","#ffffff"];else{colorRamp=elevationMap.colorRamp;for(var i=0;i<colorRamp.length;i++)colorRamp[i]=RGBAToHex(colorRamp[i])}var ramp=document.createElement("canvas");ramp.width=100,ramp.height=1;for(var ctx=ramp.getContext("2d"),grd=ctx.createLinearGradient(0,0,100,0),len=elevationRamp.length>colorRamp.length?colorRamp.length:elevationRamp.length,i=0;i<len;i++)grd.addColorStop(elevationRamp[i],colorRamp[i]);ctx.fillStyle=grd,ctx.fillRect(0,0,100,1);var texture=new Texture_default({context,source:ramp});return elevationMap.elevationTexture=texture,texture}function RGBAToHex(rgba){var values3=rgba.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),a=parseFloat(values3[3]||1),r=Math.floor(a*parseInt(values3[0])+(1-a)*255),g=Math.floor(a*parseInt(values3[1])+(1-a)*255),b=Math.floor(a*parseInt(values3[2])+(1-a)*255),strHex="#"+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);return strHex}function decodeDraco(pointCloud,context){if(pointCloud._decodingState===DecodingState.READY)return!1;if(pointCloud._decodingState===DecodingState.NEEDS_DECODE){var parsedContent=pointCloud._parsedContent,draco=parsedContent.draco,decodePromise=DracoLoader_default.decodePointCloud(draco,context);Cesium.defined(decodePromise)&&(pointCloud._decodingState=DecodingState.DECODING,decodePromise.then(function(result){pointCloud.meshPrimitives.push(result),pointCloud.useDracoDecoded=!0,pointCloud._decodingState=DecodingState.READY;var decodedPositions=Cesium.defined(result.POSITION)?result.POSITION.array:void 0,decodedRgb=Cesium.defined(result.RGB)?result.RGB.array:void 0,decodedRgba=Cesium.defined(result.RGBA)?result.RGBA.array:void 0,decodedNormals=Cesium.defined(result.NORMAL)?result.NORMAL.array:void 0,decodedBatchIds=Cesium.defined(result.BATCH_ID)?result.BATCH_ID.array:void 0,isQuantizedDraco=Cesium.defined(decodedPositions)&&Cesium.defined(result.POSITION.data.quantization),isOctEncodedDraco=Cesium.defined(decodedNormals)&&Cesium.defined(result.NORMAL.data.quantization);if(isQuantizedDraco){var quantization=result.POSITION.data.quantization,range=quantization.range;pointCloud._quantizedVolumeScale=Cesium.Cartesian3.fromElements(range,range,range),pointCloud._quantizedVolumeOffset=Cesium.Cartesian3.unpack(quantization.minValues),pointCloud._quantizedRange=(1<<quantization.quantizationBits)-1,pointCloud._isQuantizedDraco=!0}isOctEncodedDraco&&(pointCloud._octEncodedRange=(1<<result.NORMAL.data.quantization.quantizationBits)-1,pointCloud._isOctEncodedDraco=!0);var styleableProperties=parsedContent.styleableProperties,batchTableProperties=draco.batchTableProperties;for(var name in batchTableProperties)if(batchTableProperties.hasOwnProperty(name)){var property=result[name];Cesium.defined(styleableProperties)||(styleableProperties={}),styleableProperties[name]={typedArray:property.array,componentCount:property.data.componentsPerAttribute}}parsedContent.positions=Cesium.defaultValue(decodedPositions,parsedContent.positions),parsedContent.colors=Cesium.defaultValue(Cesium.defaultValue(decodedRgba,decodedRgb),parsedContent.colors),parsedContent.normals=Cesium.defaultValue(decodedNormals,parsedContent.normals),parsedContent.batchIds=Cesium.defaultValue(decodedBatchIds,parsedContent.batchIds),parsedContent.styleableProperties=styleableProperties}).catch(function(error){pointCloud._decodingState=DecodingState.FAILED,pointCloud._readyPromise.reject(error)}))}return!0}function parseDecodedData(pointCloud,context,decodedData){if(pointCloud._decodingState===DecodingState.READY)return!1;var parsedContent=pointCloud._parsedContent,draco=parsedContent.draco;pointCloud._decodingState=DecodingState.READY;var decodedPositions=Cesium.defined(decodedData.POSITION)?decodedData.POSITION.array:void 0,decodedRgb=Cesium.defined(decodedData.RGB)?decodedData.RGB.array:void 0,decodedRgba=Cesium.defined(decodedData.RGBA)?decodedData.RGBA.array:void 0,decodedNormals=Cesium.defined(decodedData.NORMAL)?decodedData.NORMAL.array:void 0,decodedBatchIds=Cesium.defined(decodedData.BATCH_ID)?decodedData.BATCH_ID.array:void 0,isQuantizedDraco=Cesium.defined(decodedPositions)&&Cesium.defined(decodedData.POSITION.data.quantization),isOctEncodedDraco=Cesium.defined(decodedNormals)&&Cesium.defined(decodedData.NORMAL.data.quantization);if(isQuantizedDraco){var quantization=decodedData.POSITION.data.quantization,range=quantization.range;pointCloud._quantizedVolumeScale=Cesium.Cartesian3.fromElements(range,range,range),pointCloud._quantizedVolumeOffset=Cesium.Cartesian3.unpack(quantization.minValues),pointCloud._quantizedRange=(1<<quantization.quantizationBits)-1,pointCloud._isQuantizedDraco=!0}isOctEncodedDraco&&(pointCloud._octEncodedRange=(1<<decodedData.NORMAL.data.quantization.quantizationBits)-1,pointCloud._isOctEncodedDraco=!0);var styleableProperties=parsedContent.styleableProperties,batchTableProperties=draco.batchTableProperties;for(var name in batchTableProperties)if(batchTableProperties.hasOwnProperty(name)){var property=decodedData[name];Cesium.defined(styleableProperties)||(styleableProperties={}),styleableProperties[name]={typedArray:property.array,componentCount:property.data.componentsPerAttribute}}return parsedContent.positions=Cesium.defaultValue(decodedPositions,parsedContent.positions),parsedContent.colors=Cesium.defaultValue(Cesium.defaultValue(decodedRgba,decodedRgb),parsedContent.colors),parsedContent.normals=Cesium.defaultValue(decodedNormals,parsedContent.normals),parsedContent.batchIds=Cesium.defaultValue(decodedBatchIds,parsedContent.batchIds),parsedContent.styleableProperties=styleableProperties,!1}var scratchComputedTranslation2=new Cesium.Cartesian4,scratchScale2=new Cesium.Cartesian3;PointCloud.prototype.update=function(frameState){var context=frameState.context,decoding=!1;if(this.meshPrimitives.length>0?(decoding=parseDecodedData(this,context,this.meshPrimitives[0]),this.useDracoDecoded||(this.meshPrimitives.length=0)):decoding=decodeDraco(this,context),!decoding){var shadersDirty=!1,modelMatrixDirty=!Cesium.Matrix4.equals(this._modelMatrix,this.modelMatrix);if(this._mode!==frameState.mode&&(this._mode=frameState.mode,modelMatrixDirty=!0),Cesium.defined(this._drawCommand)||(createResources3(this,frameState),modelMatrixDirty=!0,shadersDirty=!0,this._ready=!0,this._readyPromise.resolve(this),this._parsedContent=void 0),modelMatrixDirty){Cesium.Matrix4.clone(this.modelMatrix,this._modelMatrix);var modelMatrix=this._drawCommand.modelMatrix;if(Cesium.Matrix4.clone(this._modelMatrix,modelMatrix),Cesium.defined(this._rtcCenter)&&Cesium.Matrix4.multiplyByTranslation(modelMatrix,this._rtcCenter,modelMatrix),Cesium.defined(this._quantizedVolumeOffset)&&Cesium.Matrix4.multiplyByTranslation(modelMatrix,this._quantizedVolumeOffset,modelMatrix),frameState.mode!==Cesium.SceneMode.SCENE3D){var projection2=frameState.mapProjection,translation=Cesium.Matrix4.getColumn(modelMatrix,3,scratchComputedTranslation2);Cesium.Cartesian4.equals(translation,Cesium.Cartesian4.UNIT_W)||Cesium.Transforms.basisTo2D(projection2,modelMatrix,modelMatrix)}var boundingSphere=this._drawCommand.boundingVolume;if(Cesium.BoundingSphere.clone(this._boundingSphere,boundingSphere),this._cull){var center2=boundingSphere.center;Cesium.Matrix4.multiplyByPoint(modelMatrix,center2,center2);var scale4=Cesium.Matrix4.getScale(modelMatrix,scratchScale2);boundingSphere.radius*=Cesium.Cartesian3.maximumComponent(scale4)}}this.clippingPlanesDirty&&(this.clippingPlanesDirty=!1,shadersDirty=!0),this._attenuation!==this.attenuation&&(this._attenuation=this.attenuation,shadersDirty=!0),this.backFaceCulling!==this._backFaceCulling&&(this._backFaceCulling=this.backFaceCulling,shadersDirty=!0),this.normalShading!==this._normalShading&&(this._normalShading=this.normalShading,shadersDirty=!0),(this._style!==this.style||this.styleDirty)&&(this._style=this.style,this.styleDirty=!1,shadersDirty=!0),shadersDirty&&createShaders(this,frameState,this._style),this._drawCommand.castShadows=Cesium.ShadowMode.castShadows(this.shadows),this._drawCommand.receiveShadows=Cesium.ShadowMode.receiveShadows(this.shadows);var isTranslucent2=this._highlightColor.alpha<1||this._constantColor.alpha<1||this._styleTranslucent;this._drawCommand.renderState=isTranslucent2?this._translucentRenderState:this._opaqueRenderState,this._drawCommand.pass=isTranslucent2?Cesium.Pass.TRANSLUCENT:this._opaquePass;var commandList=frameState.commandList,passes=frameState.passes;(passes.render||passes.pick)&&commandList.push(this._drawCommand)}};PointCloud.prototype.isDestroyed=function(){return!1};PointCloud.prototype.destroy=function(){var command=this._drawCommand;return Cesium.defined(command)&&(command.vertexArray=command.vertexArray&&command.vertexArray.destroy(),command.shaderProgram=command.shaderProgram&&command.shaderProgram.destroy()),Cesium.destroyObject(this)};var PointCloud_default=PointCloud;function PointCloud3DTileContent(tileset,tile,resource2,arrayBuffer,byteOffset){this._tileset=tileset,this._tile=tile,this._resource=resource2,this._pickId=void 0,this._batchTable=void 0,this._styleDirty=!1,this._features=void 0,this.featurePropertiesDirty=!1,this._pointCloud=new PointCloud_default({arrayBuffer,byteOffset,cull:!1,opaquePass:Cesium.Pass.CESIUM_3D_TILE,useElevation:tileset._useElevation,elevationMap:tileset._elevationMap,vertexShaderLoaded:getVertexShaderLoaded(this),fragmentShaderLoaded:getFragmentShaderLoaded(this),uniformMapLoaded:getUniformMapLoaded(this),batchTableLoaded:getBatchTableLoaded(this),pickIdLoaded:getPickIdLoaded(this)})}Object.defineProperties(PointCloud3DTileContent.prototype,{featuresLength:{get:function(){return Cesium.defined(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return this._pointCloud.pointsLength}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return this._pointCloud.geometryByteLength}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return Cesium.defined(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._pointCloud.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});function getVertexShaderLoaded(content){return function(vs){return Cesium.defined(content._batchTable)?content._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(vs):vs}}function getFragmentShaderLoaded(content){return function(fs){return Cesium.defined(content._batchTable)?content._batchTable.getFragmentShaderCallback(!1,void 0)(fs):`uniform vec4 czm_pickColor;
`+fs}}function getUniformMapLoaded(content){return function(uniformMap){return Cesium.defined(content._batchTable)?content._batchTable.getUniformMapCallback()(uniformMap):Cesium.combine(uniformMap,{czm_pickColor:function(){return content._pickId.color}})}}function getBatchTableLoaded(content){return function(batchLength,batchTableJson,batchTableBinary){var batchTable=new Cesium3DTileBatchTable_default(content,batchLength,batchTableJson,batchTableBinary);if(content._batchTable=batchTable,Cesium.defined(content._tile._header.EVID))for(var featuresLength=batchTable.featuresLength,i=0;i<featuresLength;i++)batchTable.setProperty(i,"EVID",content._tile._header.EVID);this._readyPromise.then(function(pointCloud){if(pointCloud.useElevation){if(Cesium.defined(content.tileset.elevationMax))pointCloud.elevationMax=content.tileset.elevationMax,pointCloud.elevationMin=content.tileset.elevationMin;else{var styleableProperties=pointCloud._parsedContent.styleableProperties;if(styleableProperties.hasOwnProperty("elevation")){for(var property=styleableProperties.elevation,typedArray=property.typedArray,elevationMax=typedArray[0],elevationMin=typedArray[0],len=typedArray.length,i2=1;i2<len;i2++){var tmp=typedArray[i2];elevationMax=elevationMax>tmp?elevationMax:tmp,elevationMin=elevationMin<tmp?elevationMin:tmp}pointCloud.elevationMax=elevationMax,pointCloud.elevationMin=elevationMin,content.tileset.elevationMax?(content.tileset.elevationMax=content.tileset.elevationMax>elevationMax?content.tileset.elevationMax:elevationMax,content.tileset.elevationMin=content.tileset.elevationMin<elevationMin?content.tileset.elevationMin:elevationMin):(content.tileset.elevationMax=elevationMax,content.tileset.elevationMin=elevationMin)}}var styleableProperties=pointCloud._parsedContent.styleableProperties;if(styleableProperties.hasOwnProperty("intensity")&&!content.tileset.hasOwnProperty("intensityMax")){for(var property=styleableProperties.intensity,typedArray=property.typedArray,intensityMax=typedArray[0],intensityMin=typedArray[0],len=typedArray.length,i2=1;i2<len;i2++){var tmp=typedArray[i2];intensityMax=intensityMax>tmp?intensityMax:tmp,intensityMin=intensityMin<tmp?intensityMin:tmp}pointCloud.intensityMax=intensityMax,pointCloud.intensityMin=intensityMin,content.tileset.intensityMax?(content.tileset.intensityMax=content.tileset.intensityMax>intensityMax?content.tileset.intensityMax:intensityMax,content.tileset.intensityMin=content.tileset.intensityMin<intensityMin?content.tileset.intensityMin:intensityMin):(content.tileset.intensityMax=intensityMax,content.tileset.intensityMin=intensityMin)}if(styleableProperties.hasOwnProperty("return")&&!content.tileset.hasOwnProperty("returnMax")){for(var property=styleableProperties.return,typedArray=property.typedArray,returnMax=typedArray[0],returnMin=typedArray[0],len=typedArray.length,i2=1;i2<len;i2++){var tmp=typedArray[i2];returnMax=returnMax>tmp?returnMax:tmp,returnMin=returnMin<tmp?returnMin:tmp}pointCloud.returnMax=returnMax,pointCloud.returnMin=returnMin,content.tileset.returnMax?(content.tileset.returnMax=content.tileset.returnMax>returnMax?content.tileset.returnMax:returnMax,content.tileset.returnMin=content.tileset.returnMin<returnMin?content.tileset.returnMin:returnMin):(content.tileset.returnMax=returnMax,content.tileset.returnMin=returnMin)}if(styleableProperties.hasOwnProperty("classification")&&!content.tileset.hasOwnProperty("classificationMax")){var property=styleableProperties.classification,typedArray=property.typedArray;content.tileset.classification=typedArray[0];for(var classificationMax=typedArray[0],classificationMin=typedArray[0],len=typedArray.length,i2=1;i2<len;i2++){var tmp=typedArray[i2];classificationMax=classificationMax>tmp?classificationMax:tmp,classificationMin=classificationMin<tmp?classificationMin:tmp}pointCloud.classificationMax=classificationMax,pointCloud.classificationMin=classificationMin,content.tileset.classificationMax?(content.tileset.classificationMax=content.tileset.classificationMax>classificationMax?content.tileset.classificationMax:classificationMax,content.tileset.classificationMin=content.tileset.classificationMin<classificationMin?content.tileset.classificationMin:classificationMin):(content.tileset.classificationMax=classificationMax,content.tileset.classificationMin=classificationMin)}}})}}function getPickIdLoaded(content){return function(){return Cesium.defined(content._batchTable)?content._batchTable.getPickId():"czm_pickColor"}}function getGeometricError(content){var pointCloudShading=content._tileset.pointCloudShading,sphereVolume=content._tile.contentBoundingVolume.boundingSphere.volume(),baseResolutionApproximation=Cesium.Math.cbrt(sphereVolume/content.pointsLength),geometricError=content._tile.geometricError;return geometricError===0&&(Cesium.defined(pointCloudShading)&&Cesium.defined(pointCloudShading.baseResolution)?geometricError=pointCloudShading.baseResolution:geometricError=baseResolutionApproximation),geometricError}function createFeatures4(content){var featuresLength=content.featuresLength;if(!Cesium.defined(content._features)&&featuresLength>0){for(var features=new Array(featuresLength),i=0;i<featuresLength;++i)features[i]=new Cesium3DTileFeature_default(content,i);content._features=features}}PointCloud3DTileContent.prototype.hasProperty=function(batchId,name){return Cesium.defined(this._batchTable)?this._batchTable.hasProperty(batchId,name):!1};PointCloud3DTileContent.prototype.getFeature=function(batchId){if(!!Cesium.defined(this._batchTable)){var featuresLength=this.featuresLength;return createFeatures4(this),this._features[batchId]}};PointCloud3DTileContent.prototype.applyDebugSettings=function(enabled,color){this._pointCloud.color=enabled?color:Cesium.Color.WHITE};PointCloud3DTileContent.prototype.applyStyle=function(style){Cesium.defined(this._batchTable)||(this._styleDirty=!0)};var defaultShading=new Cesium.PointCloudShading;PointCloud3DTileContent.prototype.update=function(tileset,frameState){var pointCloud=this._pointCloud,pointCloudShading=Cesium.defaultValue(tileset.pointCloudShading,defaultShading),tile=this._tile,batchTable=this._batchTable,mode=frameState.mode,clippingPlanes=tileset.clippingPlanes;!Cesium.defined(this._pickId)&&!Cesium.defined(batchTable)&&(this._pickId=frameState.context.createPickId({primitive:tileset,content:this})),Cesium.defined(batchTable)&&batchTable.update(tileset,frameState);var boundingSphere;Cesium.defined(tile._contentBoundingVolume)?boundingSphere=mode===Cesium.SceneMode.SCENE3D?tile._contentBoundingVolume.boundingSphere:tile._contentBoundingVolume2D.boundingSphere:boundingSphere=mode===Cesium.SceneMode.SCENE3D?tile._boundingVolume.boundingSphere:tile._boundingVolume2D.boundingSphere;var styleDirty=this._styleDirty;this._styleDirty=!1,pointCloud.clippingPlanesOriginMatrix=tileset.clippingPlanesOriginMatrix,pointCloud.style=tileset.style,pointCloud.styleDirty=styleDirty,pointCloud.modelMatrix=tile.computedTransform,pointCloud.time=tileset.timeSinceLoad,pointCloud.shadows=tileset.shadows,pointCloud.boundingSphere=boundingSphere,pointCloud.clippingPlanes=clippingPlanes,pointCloud.isClipped=Cesium.defined(clippingPlanes)&&clippingPlanes.enabled&&tile._isClipped,pointCloud.clippingPlanesDirty=tile.clippingPlanesDirty,pointCloud.attenuation=pointCloudShading.attenuation,pointCloud.backFaceCulling=pointCloudShading.backFaceCulling,pointCloud.normalShading=pointCloudShading.normalShading,pointCloud.geometricError=getGeometricError(this),pointCloud.geometricErrorScale=pointCloudShading.geometricErrorScale,Cesium.defined(pointCloudShading)&&Cesium.defined(pointCloudShading.maximumAttenuation)?pointCloud.maximumAttenuation=pointCloudShading.maximumAttenuation:tile.refine===Cesium.Cesium3DTileRefine.ADD?pointCloud.maximumAttenuation=5:pointCloud.maximumAttenuation=tileset.maximumScreenSpaceError,pointCloud.update(frameState)};PointCloud3DTileContent.prototype.isDestroyed=function(){return!1};PointCloud3DTileContent.prototype.destroy=function(){return this._pickId=this._pickId&&this._pickId.destroy(),this._pointCloud=this._pointCloud&&this._pointCloud.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Cesium.destroyObject(this)};var PointCloud3DTileContent_default=PointCloud3DTileContent;function Tileset3DTileContent(tileset,tile,resource2,arrayBuffer,byteOffset){this._tileset=tileset,this._tile=tile,this._resource=resource2,this._readyPromise=when_default.defer(),this.featurePropertiesDirty=!1,initialize5(this,arrayBuffer,byteOffset)}Object.defineProperties(Tileset3DTileContent.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}}});function initialize5(content,arrayBuffer,byteOffset){byteOffset=Cesium.defaultValue(byteOffset,0);var uint8Array=new Uint8Array(arrayBuffer),jsonString=Cesium.getStringFromTypedArray(uint8Array,byteOffset),tilesetJson;try{tilesetJson=JSON.parse(jsonString)}catch{content._readyPromise.reject(new Cesium.RuntimeError("Invalid tile content."));return}content._tileset.loadTileset(content._resource,tilesetJson,content._tile),content._readyPromise.resolve(content)}Tileset3DTileContent.prototype.hasProperty=function(batchId,name){return!1};Tileset3DTileContent.prototype.getFeature=function(batchId){};Tileset3DTileContent.prototype.applyDebugSettings=function(enabled,color){};Tileset3DTileContent.prototype.applyStyle=function(style){};Tileset3DTileContent.prototype.update=function(tileset,frameState){};Tileset3DTileContent.prototype.isDestroyed=function(){return!1};Tileset3DTileContent.prototype.destroy=function(){return Cesium.destroyObject(this)};var Tileset3DTileContent_default=Tileset3DTileContent;function createBillboardPointCallback(centerAlpha,cssColor,cssOutlineColor,cssOutlineWidth,pixelSize){return function(){let canvas=document.createElement("canvas"),length3=pixelSize+2*cssOutlineWidth;canvas.height=canvas.width=length3;let context2D=canvas.getContext("2d");return context2D.clearRect(0,0,length3,length3),cssOutlineWidth!==0&&(context2D.beginPath(),context2D.arc(length3/2,length3/2,length3/2,0,2*Math.PI,!0),context2D.closePath(),context2D.fillStyle=cssOutlineColor,context2D.fill(),centerAlpha<1&&(context2D.save(),context2D.globalCompositeOperation="destination-out",context2D.beginPath(),context2D.arc(length3/2,length3/2,pixelSize/2,0,2*Math.PI,!0),context2D.closePath(),context2D.fillStyle="black",context2D.fill(),context2D.restore())),context2D.beginPath(),context2D.arc(length3/2,length3/2,pixelSize/2,0,2*Math.PI,!0),context2D.closePath(),context2D.fillStyle=cssColor,context2D.fill(),canvas}}var createBillboardPointCallback_default=createBillboardPointCallback;function defined(value){return value!=null}var defined_default=defined;function DeveloperError2(message){this.name="DeveloperError",this.message=message;let stack;try{throw new Error}catch(e){stack=e.stack}this.stack=stack}defined_default(Object.create)&&(DeveloperError2.prototype=Object.create(Error.prototype),DeveloperError2.prototype.constructor=DeveloperError2);DeveloperError2.prototype.toString=function(){let str=`${this.name}: ${this.message}`;return defined_default(this.stack)&&(str+=`
${this.stack.toString()}`),str};DeveloperError2.throwInstantiationError=function(){throw new DeveloperError2("This function defines an interface and should not be called directly.")};var DeveloperError_default=DeveloperError2;var Check={};Check.typeOf={};function getUndefinedErrorMessage(name){return`${name} is required, actual value was undefined`}function getFailedTypeErrorMessage(actual,expected,name){return`Expected ${name} to be typeof ${expected}, actual typeof was ${actual}`}Check.defined=function(name,test){if(!defined_default(test))throw new DeveloperError_default(getUndefinedErrorMessage(name))};Check.typeOf.func=function(name,test){if(typeof test!="function")throw new DeveloperError_default(getFailedTypeErrorMessage(typeof test,"function",name))};Check.typeOf.string=function(name,test){if(typeof test!="string")throw new DeveloperError_default(getFailedTypeErrorMessage(typeof test,"string",name))};Check.typeOf.number=function(name,test){if(typeof test!="number")throw new DeveloperError_default(getFailedTypeErrorMessage(typeof test,"number",name))};Check.typeOf.number.lessThan=function(name,test,limit){if(Check.typeOf.number(name,test),test>=limit)throw new DeveloperError_default(`Expected ${name} to be less than ${limit}, actual value was ${test}`)};Check.typeOf.number.lessThanOrEquals=function(name,test,limit){if(Check.typeOf.number(name,test),test>limit)throw new DeveloperError_default(`Expected ${name} to be less than or equal to ${limit}, actual value was ${test}`)};Check.typeOf.number.greaterThan=function(name,test,limit){if(Check.typeOf.number(name,test),test<=limit)throw new DeveloperError_default(`Expected ${name} to be greater than ${limit}, actual value was ${test}`)};Check.typeOf.number.greaterThanOrEquals=function(name,test,limit){if(Check.typeOf.number(name,test),test<limit)throw new DeveloperError_default(`Expected ${name} to be greater than or equal to ${limit}, actual value was ${test}`)};Check.typeOf.object=function(name,test){if(typeof test!="object")throw new DeveloperError_default(getFailedTypeErrorMessage(typeof test,"object",name))};Check.typeOf.bool=function(name,test){if(typeof test!="boolean")throw new DeveloperError_default(getFailedTypeErrorMessage(typeof test,"boolean",name))};Check.typeOf.bigint=function(name,test){if(typeof test!="bigint")throw new DeveloperError_default(getFailedTypeErrorMessage(typeof test,"bigint",name))};Check.typeOf.number.equals=function(name1,name2,test1,test2){if(Check.typeOf.number(name1,test1),Check.typeOf.number(name2,test2),test1!==test2)throw new DeveloperError_default(`${name1} must be equal to ${name2}, the actual values are ${test1} and ${test2}`)};var _supportsFullscreen,_names={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},Fullscreen={};Object.defineProperties(Fullscreen,{element:{get:function(){if(!!Fullscreen.supportsFullscreen())return document[_names.fullscreenElement]}},changeEventName:{get:function(){if(!!Fullscreen.supportsFullscreen())return _names.fullscreenchange}},errorEventName:{get:function(){if(!!Fullscreen.supportsFullscreen())return _names.fullscreenerror}},enabled:{get:function(){if(!!Fullscreen.supportsFullscreen())return document[_names.fullscreenEnabled]}},fullscreen:{get:function(){if(!!Fullscreen.supportsFullscreen())return Fullscreen.element!==null}}});Fullscreen.supportsFullscreen=function(){if(defined_default(_supportsFullscreen))return _supportsFullscreen;_supportsFullscreen=!1;let body=document.body;if(typeof body.requestFullscreen=="function")return _names.requestFullscreen="requestFullscreen",_names.exitFullscreen="exitFullscreen",_names.fullscreenEnabled="fullscreenEnabled",_names.fullscreenElement="fullscreenElement",_names.fullscreenchange="fullscreenchange",_names.fullscreenerror="fullscreenerror",_supportsFullscreen=!0,_supportsFullscreen;let prefixes=["webkit","moz","o","ms","khtml"],name;for(let i=0,len=prefixes.length;i<len;++i){let prefix=prefixes[i];name=`${prefix}RequestFullscreen`,typeof body[name]=="function"?(_names.requestFullscreen=name,_supportsFullscreen=!0):(name=`${prefix}RequestFullScreen`,typeof body[name]=="function"&&(_names.requestFullscreen=name,_supportsFullscreen=!0)),name=`${prefix}ExitFullscreen`,typeof document[name]=="function"?_names.exitFullscreen=name:(name=`${prefix}CancelFullScreen`,typeof document[name]=="function"&&(_names.exitFullscreen=name)),name=`${prefix}FullscreenEnabled`,document[name]!==void 0?_names.fullscreenEnabled=name:(name=`${prefix}FullScreenEnabled`,document[name]!==void 0&&(_names.fullscreenEnabled=name)),name=`${prefix}FullscreenElement`,document[name]!==void 0?_names.fullscreenElement=name:(name=`${prefix}FullScreenElement`,document[name]!==void 0&&(_names.fullscreenElement=name)),name=`${prefix}fullscreenchange`,document[`on${name}`]!==void 0&&(prefix==="ms"&&(name="MSFullscreenChange"),_names.fullscreenchange=name),name=`${prefix}fullscreenerror`,document[`on${name}`]!==void 0&&(prefix==="ms"&&(name="MSFullscreenError"),_names.fullscreenerror=name)}return _supportsFullscreen};Fullscreen.requestFullscreen=function(element,vrDevice){!Fullscreen.supportsFullscreen()||element[_names.requestFullscreen]({vrDisplay:vrDevice})};Fullscreen.exitFullscreen=function(){!Fullscreen.supportsFullscreen()||document[_names.exitFullscreen]()};Fullscreen._names=_names;var Fullscreen_default=Fullscreen;var theNavigator;typeof navigator<"u"?theNavigator=navigator:theNavigator={};function extractVersion(versionString){let parts=versionString.split(".");for(let i=0,len=parts.length;i<len;++i)parts[i]=parseInt(parts[i],10);return parts}var isChromeResult,chromeVersionResult;function isChrome(){if(!defined_default(isChromeResult)&&(isChromeResult=!1,!isEdge())){let fields=/ Chrome\/([\.0-9]+)/.exec(theNavigator.userAgent);fields!==null&&(isChromeResult=!0,chromeVersionResult=extractVersion(fields[1]))}return isChromeResult}function chromeVersion(){return isChrome()&&chromeVersionResult}var isSafariResult,safariVersionResult;function isSafari(){if(!defined_default(isSafariResult)&&(isSafariResult=!1,!isChrome()&&!isEdge()&&/ Safari\/[\.0-9]+/.test(theNavigator.userAgent))){let fields=/ Version\/([\.0-9]+)/.exec(theNavigator.userAgent);fields!==null&&(isSafariResult=!0,safariVersionResult=extractVersion(fields[1]))}return isSafariResult}function safariVersion(){return isSafari()&&safariVersionResult}var isWebkitResult,webkitVersionResult;function isWebkit(){if(!defined_default(isWebkitResult)){isWebkitResult=!1;let fields=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(theNavigator.userAgent);fields!==null&&(isWebkitResult=!0,webkitVersionResult=extractVersion(fields[1]),webkitVersionResult.isNightly=!!fields[2])}return isWebkitResult}function webkitVersion(){return isWebkit()&&webkitVersionResult}var isInternetExplorerResult,internetExplorerVersionResult;function isInternetExplorer(){if(!defined_default(isInternetExplorerResult)){isInternetExplorerResult=!1;let fields;theNavigator.appName==="Microsoft Internet Explorer"?(fields=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(theNavigator.userAgent),fields!==null&&(isInternetExplorerResult=!0,internetExplorerVersionResult=extractVersion(fields[1]))):theNavigator.appName==="Netscape"&&(fields=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(theNavigator.userAgent),fields!==null&&(isInternetExplorerResult=!0,internetExplorerVersionResult=extractVersion(fields[1])))}return isInternetExplorerResult}function internetExplorerVersion(){return isInternetExplorer()&&internetExplorerVersionResult}var isEdgeResult,edgeVersionResult;function isEdge(){if(!defined_default(isEdgeResult)){isEdgeResult=!1;let fields=/ Edg\/([\.0-9]+)/.exec(theNavigator.userAgent);fields!==null&&(isEdgeResult=!0,edgeVersionResult=extractVersion(fields[1]))}return isEdgeResult}function edgeVersion(){return isEdge()&&edgeVersionResult}var isFirefoxResult,firefoxVersionResult;function isFirefox(){if(!defined_default(isFirefoxResult)){isFirefoxResult=!1;let fields=/Firefox\/([\.0-9]+)/.exec(theNavigator.userAgent);fields!==null&&(isFirefoxResult=!0,firefoxVersionResult=extractVersion(fields[1]))}return isFirefoxResult}var isWindowsResult;function isWindows(){return defined_default(isWindowsResult)||(isWindowsResult=/Windows/i.test(theNavigator.appVersion)),isWindowsResult}var isIPadOrIOSResult;function isIPadOrIOS(){return defined_default(isIPadOrIOSResult)||(isIPadOrIOSResult=navigator.platform==="iPhone"||navigator.platform==="iPod"||navigator.platform==="iPad"),isIPadOrIOSResult}function firefoxVersion(){return isFirefox()&&firefoxVersionResult}var hasPointerEvents;function supportsPointerEvents(){return defined_default(hasPointerEvents)||(hasPointerEvents=!isFirefox()&&typeof PointerEvent<"u"&&(!defined_default(theNavigator.pointerEnabled)||theNavigator.pointerEnabled)),hasPointerEvents}var imageRenderingValueResult,supportsImageRenderingPixelatedResult;function supportsImageRenderingPixelated(){if(!defined_default(supportsImageRenderingPixelatedResult)){let canvas=document.createElement("canvas");canvas.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");let tmp=canvas.style.imageRendering;supportsImageRenderingPixelatedResult=defined_default(tmp)&&tmp!=="",supportsImageRenderingPixelatedResult&&(imageRenderingValueResult=tmp)}return supportsImageRenderingPixelatedResult}function imageRenderingValue(){return supportsImageRenderingPixelated()?imageRenderingValueResult:void 0}function supportsWebP(){return supportsWebP._result}supportsWebP._promise=void 0;supportsWebP._result=void 0;supportsWebP.initialize=function(){return defined_default(supportsWebP._promise)||(supportsWebP._promise=new Promise(resolve2=>{let image=new Image;image.onload=function(){supportsWebP._result=image.width>0&&image.height>0,resolve2(supportsWebP._result)},image.onerror=function(){supportsWebP._result=!1,resolve2(supportsWebP._result)},image.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"})),supportsWebP._promise};Object.defineProperties(supportsWebP,{initialized:{get:function(){return defined_default(supportsWebP._result)}}});var typedArrayTypes=[];typeof ArrayBuffer<"u"&&(typedArrayTypes.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),typeof Uint8ClampedArray<"u"&&typedArrayTypes.push(Uint8ClampedArray),typeof Uint8ClampedArray<"u"&&typedArrayTypes.push(Uint8ClampedArray),typeof BigInt64Array<"u"&&typedArrayTypes.push(BigInt64Array),typeof BigUint64Array<"u"&&typedArrayTypes.push(BigUint64Array));var FeatureDetection={isChrome,chromeVersion,isSafari,safariVersion,isWebkit,webkitVersion,isInternetExplorer,internetExplorerVersion,isEdge,edgeVersion,isFirefox,firefoxVersion,isWindows,isIPadOrIOS,hardwareConcurrency:defaultValue_default(theNavigator.hardwareConcurrency,3),supportsPointerEvents,supportsImageRenderingPixelated,supportsWebP,imageRenderingValue,typedArrayTypes};FeatureDetection.supportsBasis=function(scene){return FeatureDetection.supportsWebAssembly()&&scene.context.supportsBasis};FeatureDetection.supportsFullscreen=function(){return Fullscreen_default.supportsFullscreen()};FeatureDetection.supportsTypedArrays=function(){return typeof ArrayBuffer<"u"};FeatureDetection.supportsBigInt64Array=function(){return typeof BigInt64Array<"u"};FeatureDetection.supportsBigUint64Array=function(){return typeof BigUint64Array<"u"};FeatureDetection.supportsBigInt=function(){return typeof BigInt<"u"};FeatureDetection.supportsWebWorkers=function(){return typeof Worker<"u"};FeatureDetection.supportsWebAssembly=function(){return typeof WebAssembly<"u"};var FeatureDetection_default=FeatureDetection;var import_mersenne_twister=__toESM(require_mersenne_twister(),1);var CesiumMath={};CesiumMath.EPSILON1=.1;CesiumMath.EPSILON2=.01;CesiumMath.EPSILON3=.001;CesiumMath.EPSILON4=1e-4;CesiumMath.EPSILON5=1e-5;CesiumMath.EPSILON6=1e-6;CesiumMath.EPSILON7=1e-7;CesiumMath.EPSILON8=1e-8;CesiumMath.EPSILON9=1e-9;CesiumMath.EPSILON10=1e-10;CesiumMath.EPSILON11=1e-11;CesiumMath.EPSILON12=1e-12;CesiumMath.EPSILON13=1e-13;CesiumMath.EPSILON14=1e-14;CesiumMath.EPSILON15=1e-15;CesiumMath.EPSILON16=1e-16;CesiumMath.EPSILON17=1e-17;CesiumMath.EPSILON18=1e-18;CesiumMath.EPSILON19=1e-19;CesiumMath.EPSILON20=1e-20;CesiumMath.EPSILON21=1e-21;CesiumMath.GRAVITATIONALPARAMETER=3986004418e5;CesiumMath.SOLAR_RADIUS=6955e5;CesiumMath.LUNAR_RADIUS=1737400;CesiumMath.SIXTY_FOUR_KILOBYTES=64*1024;CesiumMath.FOUR_GIGABYTES=4*1024*1024*1024;CesiumMath.sign=defaultValue_default(Math.sign,function(value){return value=+value,value===0||value!==value?value:value>0?1:-1});CesiumMath.signNotZero=function(value){return value<0?-1:1};CesiumMath.toSNorm=function(value,rangeMaximum){return rangeMaximum=defaultValue_default(rangeMaximum,255),Math.round((CesiumMath.clamp(value,-1,1)*.5+.5)*rangeMaximum)};CesiumMath.fromSNorm=function(value,rangeMaximum){return rangeMaximum=defaultValue_default(rangeMaximum,255),CesiumMath.clamp(value,0,rangeMaximum)/rangeMaximum*2-1};CesiumMath.normalize=function(value,rangeMinimum,rangeMaximum){return rangeMaximum=Math.max(rangeMaximum-rangeMinimum,0),rangeMaximum===0?0:CesiumMath.clamp((value-rangeMinimum)/rangeMaximum,0,1)};CesiumMath.sinh=defaultValue_default(Math.sinh,function(value){return(Math.exp(value)-Math.exp(-value))/2});CesiumMath.cosh=defaultValue_default(Math.cosh,function(value){return(Math.exp(value)+Math.exp(-value))/2});CesiumMath.lerp=function(p,q,time){return(1-time)*p+time*q};CesiumMath.PI=Math.PI;CesiumMath.ONE_OVER_PI=1/Math.PI;CesiumMath.PI_OVER_TWO=Math.PI/2;CesiumMath.PI_OVER_THREE=Math.PI/3;CesiumMath.PI_OVER_FOUR=Math.PI/4;CesiumMath.PI_OVER_SIX=Math.PI/6;CesiumMath.THREE_PI_OVER_TWO=3*Math.PI/2;CesiumMath.TWO_PI=2*Math.PI;CesiumMath.ONE_OVER_TWO_PI=1/(2*Math.PI);CesiumMath.RADIANS_PER_DEGREE=Math.PI/180;CesiumMath.DEGREES_PER_RADIAN=180/Math.PI;CesiumMath.RADIANS_PER_ARCSECOND=CesiumMath.RADIANS_PER_DEGREE/3600;CesiumMath.toRadians=function(degrees2){return degrees2*CesiumMath.RADIANS_PER_DEGREE};CesiumMath.toDegrees=function(radians2){return radians2*CesiumMath.DEGREES_PER_RADIAN};CesiumMath.convertLongitudeRange=function(angle3){let twoPi=CesiumMath.TWO_PI,simplified=angle3-Math.floor(angle3/twoPi)*twoPi;return simplified<-Math.PI?simplified+twoPi:simplified>=Math.PI?simplified-twoPi:simplified};CesiumMath.clampToLatitudeRange=function(angle3){return CesiumMath.clamp(angle3,-1*CesiumMath.PI_OVER_TWO,CesiumMath.PI_OVER_TWO)};CesiumMath.negativePiToPi=function(angle3){return angle3>=-CesiumMath.PI&&angle3<=CesiumMath.PI?angle3:CesiumMath.zeroToTwoPi(angle3+CesiumMath.PI)-CesiumMath.PI};CesiumMath.zeroToTwoPi=function(angle3){if(angle3>=0&&angle3<=CesiumMath.TWO_PI)return angle3;let mod=CesiumMath.mod(angle3,CesiumMath.TWO_PI);return Math.abs(mod)<CesiumMath.EPSILON14&&Math.abs(angle3)>CesiumMath.EPSILON14?CesiumMath.TWO_PI:mod};CesiumMath.mod=function(m,n){return CesiumMath.sign(m)===CesiumMath.sign(n)&&Math.abs(m)<Math.abs(n)?m:(m%n+n)%n};CesiumMath.equalsEpsilon=function(left,right,relativeEpsilon,absoluteEpsilon){relativeEpsilon=defaultValue_default(relativeEpsilon,0),absoluteEpsilon=defaultValue_default(absoluteEpsilon,relativeEpsilon);let absDiff=Math.abs(left-right);return absDiff<=absoluteEpsilon||absDiff<=relativeEpsilon*Math.max(Math.abs(left),Math.abs(right))};CesiumMath.lessThan=function(left,right,absoluteEpsilon){return left-right<-absoluteEpsilon};CesiumMath.lessThanOrEquals=function(left,right,absoluteEpsilon){return left-right<absoluteEpsilon};CesiumMath.greaterThan=function(left,right,absoluteEpsilon){return left-right>absoluteEpsilon};CesiumMath.greaterThanOrEquals=function(left,right,absoluteEpsilon){return left-right>-absoluteEpsilon};var factorials=[1];CesiumMath.factorial=function(n){let length3=factorials.length;if(n>=length3){let sum=factorials[length3-1];for(let i=length3;i<=n;i++){let next3=sum*i;factorials.push(next3),sum=next3}}return factorials[n]};CesiumMath.incrementWrap=function(n,maximumValue,minimumValue){return minimumValue=defaultValue_default(minimumValue,0),++n,n>maximumValue&&(n=minimumValue),n};CesiumMath.isPowerOfTwo=function(n){return n!==0&&(n&n-1)===0};CesiumMath.nextPowerOfTwo=function(n){return--n,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,++n,n};CesiumMath.previousPowerOfTwo=function(n){return n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,n|=n>>32,n=(n>>>0)-(n>>>1),n};CesiumMath.clamp=function(value,min4,max3){return value<min4?min4:value>max3?max3:value};var randomNumberGenerator=new import_mersenne_twister.default;CesiumMath.setRandomNumberSeed=function(seed){randomNumberGenerator=new import_mersenne_twister.default(seed)};CesiumMath.nextRandomNumber=function(){return randomNumberGenerator.random()};CesiumMath.randomBetween=function(min4,max3){return CesiumMath.nextRandomNumber()*(max3-min4)+min4};CesiumMath.acosClamped=function(value){return Math.acos(CesiumMath.clamp(value,-1,1))};CesiumMath.asinClamped=function(value){return Math.asin(CesiumMath.clamp(value,-1,1))};CesiumMath.chordLength=function(angle3,radius){return 2*radius*Math.sin(angle3*.5)};CesiumMath.logBase=function(number,base){return Math.log(number)/Math.log(base)};CesiumMath.cbrt=defaultValue_default(Math.cbrt,function(number){let result=Math.pow(Math.abs(number),.3333333333333333);return number<0?-result:result});CesiumMath.log2=defaultValue_default(Math.log2,function(number){return Math.log(number)*Math.LOG2E});CesiumMath.fog=function(distanceToCamera,density){let scalar=distanceToCamera*density;return 1-Math.exp(-(scalar*scalar))};CesiumMath.fastApproximateAtan=function(x2){return x2*(-.1784*Math.abs(x2)-.0663*x2*x2+1.0301)};CesiumMath.fastApproximateAtan2=function(x2,y2){let opposite2,t=Math.abs(x2);opposite2=Math.abs(y2);let adjacent=Math.max(t,opposite2);opposite2=Math.min(t,opposite2);let oppositeOverAdjacent=opposite2/adjacent;return t=CesiumMath.fastApproximateAtan(oppositeOverAdjacent),t=Math.abs(y2)>Math.abs(x2)?CesiumMath.PI_OVER_TWO-t:t,t=x2<0?CesiumMath.PI-t:t,t=y2<0?-t:t,t};var Math_default=CesiumMath;function hue2rgb(m1,m2,h){return h<0&&(h+=1),h>1&&(h-=1),h*6<1?m1+(m2-m1)*6*h:h*2<1?m2:h*3<2?m1+(m2-m1)*(2/3-h)*6:m1}function Color(red,green,blue,alpha){this.red=defaultValue_default(red,1),this.green=defaultValue_default(green,1),this.blue=defaultValue_default(blue,1),this.alpha=defaultValue_default(alpha,1)}Color.fromCartesian4=function(cartesian2,result){return defined_default(result)?(result.red=cartesian2.x,result.green=cartesian2.y,result.blue=cartesian2.z,result.alpha=cartesian2.w,result):new Color(cartesian2.x,cartesian2.y,cartesian2.z,cartesian2.w)};Color.fromBytes=function(red,green,blue,alpha,result){return red=Color.byteToFloat(defaultValue_default(red,255)),green=Color.byteToFloat(defaultValue_default(green,255)),blue=Color.byteToFloat(defaultValue_default(blue,255)),alpha=Color.byteToFloat(defaultValue_default(alpha,255)),defined_default(result)?(result.red=red,result.green=green,result.blue=blue,result.alpha=alpha,result):new Color(red,green,blue,alpha)};Color.fromAlpha=function(color,alpha,result){return defined_default(result)?(result.red=color.red,result.green=color.green,result.blue=color.blue,result.alpha=alpha,result):new Color(color.red,color.green,color.blue,alpha)};var scratchArrayBuffer,scratchUint32Array,scratchUint8Array;FeatureDetection_default.supportsTypedArrays()&&(scratchArrayBuffer=new ArrayBuffer(4),scratchUint32Array=new Uint32Array(scratchArrayBuffer),scratchUint8Array=new Uint8Array(scratchArrayBuffer));Color.fromRgba=function(rgba,result){return scratchUint32Array[0]=rgba,Color.fromBytes(scratchUint8Array[0],scratchUint8Array[1],scratchUint8Array[2],scratchUint8Array[3],result)};Color.fromHsl=function(hue,saturation,lightness,alpha,result){hue=defaultValue_default(hue,0)%1,saturation=defaultValue_default(saturation,0),lightness=defaultValue_default(lightness,0),alpha=defaultValue_default(alpha,1);let red=lightness,green=lightness,blue=lightness;if(saturation!==0){let m2;lightness<.5?m2=lightness*(1+saturation):m2=lightness+saturation-lightness*saturation;let m1=2*lightness-m2;red=hue2rgb(m1,m2,hue+1/3),green=hue2rgb(m1,m2,hue),blue=hue2rgb(m1,m2,hue-1/3)}return defined_default(result)?(result.red=red,result.green=green,result.blue=blue,result.alpha=alpha,result):new Color(red,green,blue,alpha)};Color.fromRandom=function(options,result){options=defaultValue_default(options,defaultValue_default.EMPTY_OBJECT);let red=options.red;if(!defined_default(red)){let minimumRed=defaultValue_default(options.minimumRed,0),maximumRed=defaultValue_default(options.maximumRed,1);red=minimumRed+Math_default.nextRandomNumber()*(maximumRed-minimumRed)}let green=options.green;if(!defined_default(green)){let minimumGreen=defaultValue_default(options.minimumGreen,0),maximumGreen=defaultValue_default(options.maximumGreen,1);green=minimumGreen+Math_default.nextRandomNumber()*(maximumGreen-minimumGreen)}let blue=options.blue;if(!defined_default(blue)){let minimumBlue=defaultValue_default(options.minimumBlue,0),maximumBlue=defaultValue_default(options.maximumBlue,1);blue=minimumBlue+Math_default.nextRandomNumber()*(maximumBlue-minimumBlue)}let alpha=options.alpha;if(!defined_default(alpha)){let minimumAlpha=defaultValue_default(options.minimumAlpha,0),maximumAlpha=defaultValue_default(options.maximumAlpha,1);alpha=minimumAlpha+Math_default.nextRandomNumber()*(maximumAlpha-minimumAlpha)}return defined_default(result)?(result.red=red,result.green=green,result.blue=blue,result.alpha=alpha,result):new Color(red,green,blue,alpha)};var rgbaMatcher=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,rrggbbaaMatcher=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,rgbParenthesesMatcher=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,hslParenthesesMatcher=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;Color.fromCssColorString=function(color,result){defined_default(result)||(result=new Color),color=color.replace(/\s/g,"");let namedColor=Color[color.toUpperCase()];if(defined_default(namedColor))return Color.clone(namedColor,result),result;let matches=rgbaMatcher.exec(color);return matches!==null?(result.red=parseInt(matches[1],16)/15,result.green=parseInt(matches[2],16)/15,result.blue=parseInt(matches[3],16)/15,result.alpha=parseInt(defaultValue_default(matches[4],"f"),16)/15,result):(matches=rrggbbaaMatcher.exec(color),matches!==null?(result.red=parseInt(matches[1],16)/255,result.green=parseInt(matches[2],16)/255,result.blue=parseInt(matches[3],16)/255,result.alpha=parseInt(defaultValue_default(matches[4],"ff"),16)/255,result):(matches=rgbParenthesesMatcher.exec(color),matches!==null?(result.red=parseFloat(matches[1])/(matches[1].substr(-1)==="%"?100:255),result.green=parseFloat(matches[2])/(matches[2].substr(-1)==="%"?100:255),result.blue=parseFloat(matches[3])/(matches[3].substr(-1)==="%"?100:255),result.alpha=parseFloat(defaultValue_default(matches[4],"1.0")),result):(matches=hslParenthesesMatcher.exec(color),matches!==null?Color.fromHsl(parseFloat(matches[1])/360,parseFloat(matches[2])/100,parseFloat(matches[3])/100,parseFloat(defaultValue_default(matches[4],"1.0")),result):(result=void 0,result))))};Color.packedLength=4;Color.pack=function(value,array,startingIndex){return startingIndex=defaultValue_default(startingIndex,0),array[startingIndex++]=value.red,array[startingIndex++]=value.green,array[startingIndex++]=value.blue,array[startingIndex]=value.alpha,array};Color.unpack=function(array,startingIndex,result){return startingIndex=defaultValue_default(startingIndex,0),defined_default(result)||(result=new Color),result.red=array[startingIndex++],result.green=array[startingIndex++],result.blue=array[startingIndex++],result.alpha=array[startingIndex],result};Color.byteToFloat=function(number){return number/255};Color.floatToByte=function(number){return number===1?255:number*256|0};Color.clone=function(color,result){if(!!defined_default(color))return defined_default(result)?(result.red=color.red,result.green=color.green,result.blue=color.blue,result.alpha=color.alpha,result):new Color(color.red,color.green,color.blue,color.alpha)};Color.equals=function(left,right){return left===right||defined_default(left)&&defined_default(right)&&left.red===right.red&&left.green===right.green&&left.blue===right.blue&&left.alpha===right.alpha};Color.equalsArray=function(color,array,offset){return color.red===array[offset]&&color.green===array[offset+1]&&color.blue===array[offset+2]&&color.alpha===array[offset+3]};Color.prototype.clone=function(result){return Color.clone(this,result)};Color.prototype.equals=function(other){return Color.equals(this,other)};Color.prototype.equalsEpsilon=function(other,epsilon3){return this===other||defined_default(other)&&Math.abs(this.red-other.red)<=epsilon3&&Math.abs(this.green-other.green)<=epsilon3&&Math.abs(this.blue-other.blue)<=epsilon3&&Math.abs(this.alpha-other.alpha)<=epsilon3};Color.prototype.toString=function(){return`(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`};Color.prototype.toCssColorString=function(){let red=Color.floatToByte(this.red),green=Color.floatToByte(this.green),blue=Color.floatToByte(this.blue);return this.alpha===1?`rgb(${red},${green},${blue})`:`rgba(${red},${green},${blue},${this.alpha})`};Color.prototype.toCssHexString=function(){let r=Color.floatToByte(this.red).toString(16);r.length<2&&(r=`0${r}`);let g=Color.floatToByte(this.green).toString(16);g.length<2&&(g=`0${g}`);let b=Color.floatToByte(this.blue).toString(16);if(b.length<2&&(b=`0${b}`),this.alpha<1){let hexAlpha=Color.floatToByte(this.alpha).toString(16);return hexAlpha.length<2&&(hexAlpha=`0${hexAlpha}`),`#${r}${g}${b}${hexAlpha}`}return`#${r}${g}${b}`};Color.prototype.toBytes=function(result){let red=Color.floatToByte(this.red),green=Color.floatToByte(this.green),blue=Color.floatToByte(this.blue),alpha=Color.floatToByte(this.alpha);return defined_default(result)?(result[0]=red,result[1]=green,result[2]=blue,result[3]=alpha,result):[red,green,blue,alpha]};Color.prototype.toRgba=function(){return scratchUint8Array[0]=Color.floatToByte(this.red),scratchUint8Array[1]=Color.floatToByte(this.green),scratchUint8Array[2]=Color.floatToByte(this.blue),scratchUint8Array[3]=Color.floatToByte(this.alpha),scratchUint32Array[0]};Color.prototype.brighten=function(magnitude2,result){return magnitude2=1-magnitude2,result.red=1-(1-this.red)*magnitude2,result.green=1-(1-this.green)*magnitude2,result.blue=1-(1-this.blue)*magnitude2,result.alpha=this.alpha,result};Color.prototype.darken=function(magnitude2,result){return magnitude2=1-magnitude2,result.red=this.red*magnitude2,result.green=this.green*magnitude2,result.blue=this.blue*magnitude2,result.alpha=this.alpha,result};Color.prototype.withAlpha=function(alpha,result){return Color.fromAlpha(this,alpha,result)};Color.add=function(left,right,result){return result.red=left.red+right.red,result.green=left.green+right.green,result.blue=left.blue+right.blue,result.alpha=left.alpha+right.alpha,result};Color.subtract=function(left,right,result){return result.red=left.red-right.red,result.green=left.green-right.green,result.blue=left.blue-right.blue,result.alpha=left.alpha-right.alpha,result};Color.multiply=function(left,right,result){return result.red=left.red*right.red,result.green=left.green*right.green,result.blue=left.blue*right.blue,result.alpha=left.alpha*right.alpha,result};Color.divide=function(left,right,result){return result.red=left.red/right.red,result.green=left.green/right.green,result.blue=left.blue/right.blue,result.alpha=left.alpha/right.alpha,result};Color.mod=function(left,right,result){return result.red=left.red%right.red,result.green=left.green%right.green,result.blue=left.blue%right.blue,result.alpha=left.alpha%right.alpha,result};Color.lerp=function(start2,end,t,result){return result.red=Math_default.lerp(start2.red,end.red,t),result.green=Math_default.lerp(start2.green,end.green,t),result.blue=Math_default.lerp(start2.blue,end.blue,t),result.alpha=Math_default.lerp(start2.alpha,end.alpha,t),result};Color.multiplyByScalar=function(color,scalar,result){return result.red=color.red*scalar,result.green=color.green*scalar,result.blue=color.blue*scalar,result.alpha=color.alpha*scalar,result};Color.divideByScalar=function(color,scalar,result){return result.red=color.red/scalar,result.green=color.green/scalar,result.blue=color.blue/scalar,result.alpha=color.alpha/scalar,result};Color.ALICEBLUE=Object.freeze(Color.fromCssColorString("#F0F8FF"));Color.ANTIQUEWHITE=Object.freeze(Color.fromCssColorString("#FAEBD7"));Color.AQUA=Object.freeze(Color.fromCssColorString("#00FFFF"));Color.AQUAMARINE=Object.freeze(Color.fromCssColorString("#7FFFD4"));Color.AZURE=Object.freeze(Color.fromCssColorString("#F0FFFF"));Color.BEIGE=Object.freeze(Color.fromCssColorString("#F5F5DC"));Color.BISQUE=Object.freeze(Color.fromCssColorString("#FFE4C4"));Color.BLACK=Object.freeze(Color.fromCssColorString("#000000"));Color.BLANCHEDALMOND=Object.freeze(Color.fromCssColorString("#FFEBCD"));Color.BLUE=Object.freeze(Color.fromCssColorString("#0000FF"));Color.BLUEVIOLET=Object.freeze(Color.fromCssColorString("#8A2BE2"));Color.BROWN=Object.freeze(Color.fromCssColorString("#A52A2A"));Color.BURLYWOOD=Object.freeze(Color.fromCssColorString("#DEB887"));Color.CADETBLUE=Object.freeze(Color.fromCssColorString("#5F9EA0"));Color.CHARTREUSE=Object.freeze(Color.fromCssColorString("#7FFF00"));Color.CHOCOLATE=Object.freeze(Color.fromCssColorString("#D2691E"));Color.CORAL=Object.freeze(Color.fromCssColorString("#FF7F50"));Color.CORNFLOWERBLUE=Object.freeze(Color.fromCssColorString("#6495ED"));Color.CORNSILK=Object.freeze(Color.fromCssColorString("#FFF8DC"));Color.CRIMSON=Object.freeze(Color.fromCssColorString("#DC143C"));Color.CYAN=Object.freeze(Color.fromCssColorString("#00FFFF"));Color.DARKBLUE=Object.freeze(Color.fromCssColorString("#00008B"));Color.DARKCYAN=Object.freeze(Color.fromCssColorString("#008B8B"));Color.DARKGOLDENROD=Object.freeze(Color.fromCssColorString("#B8860B"));Color.DARKGRAY=Object.freeze(Color.fromCssColorString("#A9A9A9"));Color.DARKGREEN=Object.freeze(Color.fromCssColorString("#006400"));Color.DARKGREY=Color.DARKGRAY;Color.DARKKHAKI=Object.freeze(Color.fromCssColorString("#BDB76B"));Color.DARKMAGENTA=Object.freeze(Color.fromCssColorString("#8B008B"));Color.DARKOLIVEGREEN=Object.freeze(Color.fromCssColorString("#556B2F"));Color.DARKORANGE=Object.freeze(Color.fromCssColorString("#FF8C00"));Color.DARKORCHID=Object.freeze(Color.fromCssColorString("#9932CC"));Color.DARKRED=Object.freeze(Color.fromCssColorString("#8B0000"));Color.DARKSALMON=Object.freeze(Color.fromCssColorString("#E9967A"));Color.DARKSEAGREEN=Object.freeze(Color.fromCssColorString("#8FBC8F"));Color.DARKSLATEBLUE=Object.freeze(Color.fromCssColorString("#483D8B"));Color.DARKSLATEGRAY=Object.freeze(Color.fromCssColorString("#2F4F4F"));Color.DARKSLATEGREY=Color.DARKSLATEGRAY;Color.DARKTURQUOISE=Object.freeze(Color.fromCssColorString("#00CED1"));Color.DARKVIOLET=Object.freeze(Color.fromCssColorString("#9400D3"));Color.DEEPPINK=Object.freeze(Color.fromCssColorString("#FF1493"));Color.DEEPSKYBLUE=Object.freeze(Color.fromCssColorString("#00BFFF"));Color.DIMGRAY=Object.freeze(Color.fromCssColorString("#696969"));Color.DIMGREY=Color.DIMGRAY;Color.DODGERBLUE=Object.freeze(Color.fromCssColorString("#1E90FF"));Color.FIREBRICK=Object.freeze(Color.fromCssColorString("#B22222"));Color.FLORALWHITE=Object.freeze(Color.fromCssColorString("#FFFAF0"));Color.FORESTGREEN=Object.freeze(Color.fromCssColorString("#228B22"));Color.FUCHSIA=Object.freeze(Color.fromCssColorString("#FF00FF"));Color.GAINSBORO=Object.freeze(Color.fromCssColorString("#DCDCDC"));Color.GHOSTWHITE=Object.freeze(Color.fromCssColorString("#F8F8FF"));Color.GOLD=Object.freeze(Color.fromCssColorString("#FFD700"));Color.GOLDENROD=Object.freeze(Color.fromCssColorString("#DAA520"));Color.GRAY=Object.freeze(Color.fromCssColorString("#808080"));Color.GREEN=Object.freeze(Color.fromCssColorString("#008000"));Color.GREENYELLOW=Object.freeze(Color.fromCssColorString("#ADFF2F"));Color.GREY=Color.GRAY;Color.HONEYDEW=Object.freeze(Color.fromCssColorString("#F0FFF0"));Color.HOTPINK=Object.freeze(Color.fromCssColorString("#FF69B4"));Color.INDIANRED=Object.freeze(Color.fromCssColorString("#CD5C5C"));Color.INDIGO=Object.freeze(Color.fromCssColorString("#4B0082"));Color.IVORY=Object.freeze(Color.fromCssColorString("#FFFFF0"));Color.KHAKI=Object.freeze(Color.fromCssColorString("#F0E68C"));Color.LAVENDER=Object.freeze(Color.fromCssColorString("#E6E6FA"));Color.LAVENDAR_BLUSH=Object.freeze(Color.fromCssColorString("#FFF0F5"));Color.LAWNGREEN=Object.freeze(Color.fromCssColorString("#7CFC00"));Color.LEMONCHIFFON=Object.freeze(Color.fromCssColorString("#FFFACD"));Color.LIGHTBLUE=Object.freeze(Color.fromCssColorString("#ADD8E6"));Color.LIGHTCORAL=Object.freeze(Color.fromCssColorString("#F08080"));Color.LIGHTCYAN=Object.freeze(Color.fromCssColorString("#E0FFFF"));Color.LIGHTGOLDENRODYELLOW=Object.freeze(Color.fromCssColorString("#FAFAD2"));Color.LIGHTGRAY=Object.freeze(Color.fromCssColorString("#D3D3D3"));Color.LIGHTGREEN=Object.freeze(Color.fromCssColorString("#90EE90"));Color.LIGHTGREY=Color.LIGHTGRAY;Color.LIGHTPINK=Object.freeze(Color.fromCssColorString("#FFB6C1"));Color.LIGHTSEAGREEN=Object.freeze(Color.fromCssColorString("#20B2AA"));Color.LIGHTSKYBLUE=Object.freeze(Color.fromCssColorString("#87CEFA"));Color.LIGHTSLATEGRAY=Object.freeze(Color.fromCssColorString("#778899"));Color.LIGHTSLATEGREY=Color.LIGHTSLATEGRAY;Color.LIGHTSTEELBLUE=Object.freeze(Color.fromCssColorString("#B0C4DE"));Color.LIGHTYELLOW=Object.freeze(Color.fromCssColorString("#FFFFE0"));Color.LIME=Object.freeze(Color.fromCssColorString("#00FF00"));Color.LIMEGREEN=Object.freeze(Color.fromCssColorString("#32CD32"));Color.LINEN=Object.freeze(Color.fromCssColorString("#FAF0E6"));Color.MAGENTA=Object.freeze(Color.fromCssColorString("#FF00FF"));Color.MAROON=Object.freeze(Color.fromCssColorString("#800000"));Color.MEDIUMAQUAMARINE=Object.freeze(Color.fromCssColorString("#66CDAA"));Color.MEDIUMBLUE=Object.freeze(Color.fromCssColorString("#0000CD"));Color.MEDIUMORCHID=Object.freeze(Color.fromCssColorString("#BA55D3"));Color.MEDIUMPURPLE=Object.freeze(Color.fromCssColorString("#9370DB"));Color.MEDIUMSEAGREEN=Object.freeze(Color.fromCssColorString("#3CB371"));Color.MEDIUMSLATEBLUE=Object.freeze(Color.fromCssColorString("#7B68EE"));Color.MEDIUMSPRINGGREEN=Object.freeze(Color.fromCssColorString("#00FA9A"));Color.MEDIUMTURQUOISE=Object.freeze(Color.fromCssColorString("#48D1CC"));Color.MEDIUMVIOLETRED=Object.freeze(Color.fromCssColorString("#C71585"));Color.MIDNIGHTBLUE=Object.freeze(Color.fromCssColorString("#191970"));Color.MINTCREAM=Object.freeze(Color.fromCssColorString("#F5FFFA"));Color.MISTYROSE=Object.freeze(Color.fromCssColorString("#FFE4E1"));Color.MOCCASIN=Object.freeze(Color.fromCssColorString("#FFE4B5"));Color.NAVAJOWHITE=Object.freeze(Color.fromCssColorString("#FFDEAD"));Color.NAVY=Object.freeze(Color.fromCssColorString("#000080"));Color.OLDLACE=Object.freeze(Color.fromCssColorString("#FDF5E6"));Color.OLIVE=Object.freeze(Color.fromCssColorString("#808000"));Color.OLIVEDRAB=Object.freeze(Color.fromCssColorString("#6B8E23"));Color.ORANGE=Object.freeze(Color.fromCssColorString("#FFA500"));Color.ORANGERED=Object.freeze(Color.fromCssColorString("#FF4500"));Color.ORCHID=Object.freeze(Color.fromCssColorString("#DA70D6"));Color.PALEGOLDENROD=Object.freeze(Color.fromCssColorString("#EEE8AA"));Color.PALEGREEN=Object.freeze(Color.fromCssColorString("#98FB98"));Color.PALETURQUOISE=Object.freeze(Color.fromCssColorString("#AFEEEE"));Color.PALEVIOLETRED=Object.freeze(Color.fromCssColorString("#DB7093"));Color.PAPAYAWHIP=Object.freeze(Color.fromCssColorString("#FFEFD5"));Color.PEACHPUFF=Object.freeze(Color.fromCssColorString("#FFDAB9"));Color.PERU=Object.freeze(Color.fromCssColorString("#CD853F"));Color.PINK=Object.freeze(Color.fromCssColorString("#FFC0CB"));Color.PLUM=Object.freeze(Color.fromCssColorString("#DDA0DD"));Color.POWDERBLUE=Object.freeze(Color.fromCssColorString("#B0E0E6"));Color.PURPLE=Object.freeze(Color.fromCssColorString("#800080"));Color.RED=Object.freeze(Color.fromCssColorString("#FF0000"));Color.ROSYBROWN=Object.freeze(Color.fromCssColorString("#BC8F8F"));Color.ROYALBLUE=Object.freeze(Color.fromCssColorString("#4169E1"));Color.SADDLEBROWN=Object.freeze(Color.fromCssColorString("#8B4513"));Color.SALMON=Object.freeze(Color.fromCssColorString("#FA8072"));Color.SANDYBROWN=Object.freeze(Color.fromCssColorString("#F4A460"));Color.SEAGREEN=Object.freeze(Color.fromCssColorString("#2E8B57"));Color.SEASHELL=Object.freeze(Color.fromCssColorString("#FFF5EE"));Color.SIENNA=Object.freeze(Color.fromCssColorString("#A0522D"));Color.SILVER=Object.freeze(Color.fromCssColorString("#C0C0C0"));Color.SKYBLUE=Object.freeze(Color.fromCssColorString("#87CEEB"));Color.SLATEBLUE=Object.freeze(Color.fromCssColorString("#6A5ACD"));Color.SLATEGRAY=Object.freeze(Color.fromCssColorString("#708090"));Color.SLATEGREY=Color.SLATEGRAY;Color.SNOW=Object.freeze(Color.fromCssColorString("#FFFAFA"));Color.SPRINGGREEN=Object.freeze(Color.fromCssColorString("#00FF7F"));Color.STEELBLUE=Object.freeze(Color.fromCssColorString("#4682B4"));Color.TAN=Object.freeze(Color.fromCssColorString("#D2B48C"));Color.TEAL=Object.freeze(Color.fromCssColorString("#008080"));Color.THISTLE=Object.freeze(Color.fromCssColorString("#D8BFD8"));Color.TOMATO=Object.freeze(Color.fromCssColorString("#FF6347"));Color.TURQUOISE=Object.freeze(Color.fromCssColorString("#40E0D0"));Color.VIOLET=Object.freeze(Color.fromCssColorString("#EE82EE"));Color.WHEAT=Object.freeze(Color.fromCssColorString("#F5DEB3"));Color.WHITE=Object.freeze(Color.fromCssColorString("#FFFFFF"));Color.WHITESMOKE=Object.freeze(Color.fromCssColorString("#F5F5F5"));Color.YELLOW=Object.freeze(Color.fromCssColorString("#FFFF00"));Color.YELLOWGREEN=Object.freeze(Color.fromCssColorString("#9ACD32"));Color.TRANSPARENT=Object.freeze(new Color(0,0,0,0));var Color_default=Color;var warnings={};function oneTimeWarning(identifier,message){defined_default(warnings[identifier])||(warnings[identifier]=!0,console.warn(defaultValue_default(message,identifier)))}oneTimeWarning.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.";oneTimeWarning.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored";oneTimeWarning.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored";oneTimeWarning.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";var oneTimeWarning_default=oneTimeWarning;function deprecationWarning(identifier,message){oneTimeWarning_default(identifier,message)}var deprecationWarning_default=deprecationWarning;function Cesium3DTileFeature2(content,batchId){this._content=content,this._batchId=batchId,this._color=void 0}Object.defineProperties(Cesium3DTileFeature2.prototype,{show:{get:function(){return this._content.batchTable.getShow(this._batchId)},set:function(value){this._content.batchTable.setShow(this._batchId,value)}},color:{get:function(){return defined_default(this._color)||(this._color=new Color_default),this._content.batchTable.getColor(this._batchId,this._color)},set:function(value){this._content.batchTable.setColor(this._batchId,value)}},polylinePositions:{get:function(){if(!!defined_default(this._content.getPolylinePositions))return this._content.getPolylinePositions(this._batchId)}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},featureId:{get:function(){return this._batchId}},pickId:{get:function(){return this._content.batchTable.getPickColor(this._batchId)}}});Cesium3DTileFeature2.prototype.hasProperty=function(name){return this._content.batchTable.hasProperty(this._batchId,name)};Cesium3DTileFeature2.prototype.getPropertyNames=function(results){return deprecationWarning_default("Cesium3DTileFeature.getPropertyNames","Cesium3DTileFeature.getPropertyNames was deprecated in CesiumJS 1.95 and will be removed in 1.98. Use Cesium3DTileFeature.getPropertyIds instead"),this._content.batchTable.getPropertyIds(this._batchId,results)};Cesium3DTileFeature2.prototype.getPropertyIds=function(results){return this._content.batchTable.getPropertyIds(this._batchId,results)};Cesium3DTileFeature2.prototype.getProperty=function(name){return this._content.batchTable.getProperty(this._batchId,name)};Cesium3DTileFeature2.getPropertyInherited=function(content,batchId,name){let batchTable=content.batchTable;if(defined_default(batchTable)){if(batchTable.hasPropertyBySemantic(batchId,name))return batchTable.getPropertyBySemantic(batchId,name);if(batchTable.hasProperty(batchId,name))return batchTable.getProperty(batchId,name)}let contentMetadata=content.metadata;if(defined_default(contentMetadata)){if(contentMetadata.hasPropertyBySemantic(name))return contentMetadata.getPropertyBySemantic(name);if(contentMetadata.hasProperty(name))return contentMetadata.getProperty(name)}let tile=content.tile,tileMetadata=tile.metadata;if(defined_default(tileMetadata)){if(tileMetadata.hasPropertyBySemantic(name))return tileMetadata.getPropertyBySemantic(name);if(tileMetadata.hasProperty(name))return tileMetadata.getProperty(name)}let subtreeMetadata;if(defined_default(tile.implicitSubtree)&&(subtreeMetadata=tile.implicitSubtree.metadata),defined_default(subtreeMetadata)){if(subtreeMetadata.hasPropertyBySemantic(name))return subtreeMetadata.getPropertyBySemantic(name);if(subtreeMetadata.hasProperty(name))return subtreeMetadata.getProperty(name)}let groupMetadata=defined_default(content.group)?content.group.metadata:void 0;if(defined_default(groupMetadata)){if(groupMetadata.hasPropertyBySemantic(name))return groupMetadata.getPropertyBySemantic(name);if(groupMetadata.hasProperty(name))return groupMetadata.getProperty(name)}let tilesetMetadata=content.tileset.metadata;if(defined_default(tilesetMetadata)){if(tilesetMetadata.hasPropertyBySemantic(name))return tilesetMetadata.getPropertyBySemantic(name);if(tilesetMetadata.hasProperty(name))return tilesetMetadata.getProperty(name)}};Cesium3DTileFeature2.prototype.getPropertyInherited=function(name){return Cesium3DTileFeature2.getPropertyInherited(this._content,this._batchId,name)};Cesium3DTileFeature2.prototype.setProperty=function(name,value){this._content.batchTable.setProperty(this._batchId,name,value),this._content.featurePropertiesDirty=!0};Cesium3DTileFeature2.prototype.isExactClass=function(className){return this._content.batchTable.isExactClass(this._batchId,className)};Cesium3DTileFeature2.prototype.isClass=function(className){return this._content.batchTable.isClass(this._batchId,className)};Cesium3DTileFeature2.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var Cesium3DTileFeature_default2=Cesium3DTileFeature2;function Cesium3DTilePointFeature(content,batchId,billboard,label,polyline){this._content=content,this._billboard=billboard,this._label=label,this._polyline=polyline,this._batchId=batchId,this._billboardImage=void 0,this._billboardColor=void 0,this._billboardOutlineColor=void 0,this._billboardOutlineWidth=void 0,this._billboardSize=void 0,this._pointSize=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._heightOffset=void 0,this._exOffset=void 0,this._pickIds=new Array(3),setBillboardImage(this)}var scratchCartographic2=new Cesium.Cartographic;Object.defineProperties(Cesium3DTilePointFeature.prototype,{show:{get:function(){return this._label.show},set:function(value){this._label.show=value,this._billboard.show=value,this._polyline.show=value}},color:{get:function(){return this._color},set:function(value){this._color=Cesium.Color.clone(value,this._color),setBillboardImage(this)}},pointSize:{get:function(){return this._pointSize},set:function(value){this._pointSize=value,setBillboardImage(this)}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(value){this._pointOutlineColor=Cesium.Color.clone(value,this._pointOutlineColor),setBillboardImage(this)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(value){this._pointOutlineWidth=value,setBillboardImage(this)}},labelColor:{get:function(){return this._label.fillColor},set:function(value){this._label.fillColor=value,this._polyline.show=this._label.show&&value.alpha>0}},labelOutlineColor:{get:function(){return this._label.outlineColor},set:function(value){this._label.outlineColor=value}},labelOutlineWidth:{get:function(){return this._label.outlineWidth},set:function(value){this._label.outlineWidth=value}},font:{get:function(){return this._label.font},set:function(value){this._label.font=value}},labelStyle:{get:function(){return this._label.style},set:function(value){this._label.style=value}},labelText:{get:function(){return this._label.text},set:function(value){Cesium.defined(value)||(value=""),this._label.text=value}},backgroundColor:{get:function(){return this._label.backgroundColor},set:function(value){this._label.backgroundColor=value}},backgroundPadding:{get:function(){return this._label.backgroundPadding},set:function(value){this._label.backgroundPadding=value}},backgroundEnabled:{get:function(){return this._label.showBackground},set:function(value){this._label.showBackground=value}},scaleByDistance:{get:function(){return this._label.scaleByDistance},set:function(value){this._label.scaleByDistance=value,this._billboard.scaleByDistance=value}},translucencyByDistance:{get:function(){return this._label.translucencyByDistance},set:function(value){this._label.translucencyByDistance=value,this._billboard.translucencyByDistance=value}},distanceDisplayCondition:{get:function(){return this._label.distanceDisplayCondition},set:function(value){this._label.distanceDisplayCondition=value,this._polyline.distanceDisplayCondition=value,this._billboard.distanceDisplayCondition=value}},heightOffset:{get:function(){return this._heightOffset},set:function(value){var offset=Cesium.defaultValue(this._heightOffset,0),ellipsoid=this._content.tileset.ellipsoid,cart=ellipsoid.cartesianToCartographic(this._billboard.position,scratchCartographic2);cart.height=cart.height-offset+value;var newPosition=ellipsoid.cartographicToCartesian(cart);this._billboard.position=newPosition,this._label.position=this._billboard.position,this._polyline.positions=[this._polyline.positions[0],newPosition],this._heightOffset=value}},exOffset:{get:function(){return this._exOffset},set:function(value){if(value instanceof Cesium.Cartesian3||(value=Cesium.Cartesian3.ZERO),!Cesium.Cartesian3.equals(value,Cesium.Cartesian3.ZERO)){var transform3=this.getProperty("worldMatrix"),offsetTran=Cesium.Matrix4.fromArray(transform3),newPosition=new Cesium.Cartesian3;Cesium.Matrix4.multiplyByPoint(offsetTran,value,newPosition),this._billboard.position=newPosition,this._label.position=this._billboard.position,this._polyline.positions=[this._polyline.positions[0],newPosition]}this._exOffset=value}},anchorLineEnabled:{get:function(){return this._polyline.show},set:function(value){this._polyline.show=value}},anchorLineColor:{get:function(){return this._polyline.material.uniforms.color},set:function(value){this._polyline.material.uniforms.color=Cesium.Color.clone(value,this._polyline.material.uniforms.color)}},image:{get:function(){return this._billboardImage},set:function(value){var imageChanged=this._billboardImage!==value;this._billboardImage=value,imageChanged&&setBillboardImage(this)}},disableDepthTestDistance:{get:function(){return this._label.disableDepthTestDistance},set:function(value){this._label.disableDepthTestDistance=value,this._billboard.disableDepthTestDistance=value}},horizontalOrigin:{get:function(){return this._billboard.horizontalOrigin},set:function(value){this._billboard.horizontalOrigin=value}},verticalOrigin:{get:function(){return this._billboard.verticalOrigin},set:function(value){this._billboard.verticalOrigin=value}},labelHorizontalOrigin:{get:function(){return this._label.horizontalOrigin},set:function(value){this._label.horizontalOrigin=value}},labelVerticalOrigin:{get:function(){return this._label.verticalOrigin},set:function(value){this._label.verticalOrigin=value}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickIds:{get:function(){var ids=this._pickIds;return ids[0]=this._billboard.pickId,ids[1]=this._label.pickId,ids[2]=this._polyline.pickId,ids}}});Cesium3DTilePointFeature.defaultColor=Cesium.Color.WHITE;Cesium3DTilePointFeature.defaultPointOutlineColor=Cesium.Color.BLACK;Cesium3DTilePointFeature.defaultPointOutlineWidth=0;Cesium3DTilePointFeature.defaultPointSize=8;function setBillboardImage(feature2){var b=feature2._billboard;if(Cesium.defined(feature2._billboardImage)&&feature2._billboardImage!==b.image){b.image=feature2._billboardImage;return}if(!Cesium.defined(feature2._billboardImage)){var newColor=Cesium.defaultValue(feature2._color,Cesium3DTilePointFeature.defaultColor),newOutlineColor=Cesium.defaultValue(feature2._pointOutlineColor,Cesium3DTilePointFeature.defaultPointOutlineColor),newOutlineWidth=Cesium.defaultValue(feature2._pointOutlineWidth,Cesium3DTilePointFeature.defaultPointOutlineWidth),newPointSize=Cesium.defaultValue(feature2._pointSize,Cesium3DTilePointFeature.defaultPointSize),currentColor=feature2._billboardColor,currentOutlineColor=feature2._billboardOutlineColor,currentOutlineWidth=feature2._billboardOutlineWidth,currentPointSize=feature2._billboardSize;if(!(Cesium.Color.equals(newColor,currentColor)&&Cesium.Color.equals(newOutlineColor,currentOutlineColor)&&newOutlineWidth===currentOutlineWidth&&newPointSize===currentPointSize)){feature2._billboardColor=Cesium.Color.clone(newColor,feature2._billboardColor),feature2._billboardOutlineColor=Cesium.Color.clone(newOutlineColor,feature2._billboardOutlineColor),feature2._billboardOutlineWidth=newOutlineWidth,feature2._billboardSize=newPointSize;var centerAlpha=newColor.alpha,cssColor=newColor.toCssColorString(),cssOutlineColor=newOutlineColor.toCssColorString(),textureId=JSON.stringify([cssColor,newPointSize,cssOutlineColor,newOutlineWidth]);b.setImage(textureId,createBillboardPointCallback_default(centerAlpha,cssColor,cssOutlineColor,newOutlineWidth,newPointSize))}}}Cesium3DTilePointFeature.prototype.hasProperty=function(name){return this._content.batchTable.hasProperty(this._batchId,name)};Cesium3DTilePointFeature.prototype.getPropertyNames=function(results){return this._content.batchTable.getPropertyNames(this._batchId,results)};Cesium3DTilePointFeature.prototype.getProperty=function(name){return this._content.batchTable.getProperty(this._batchId,name)};Cesium3DTilePointFeature.prototype.getPropertyInherited=function(name){return Cesium3DTileFeature_default2.getPropertyInherited(this._content,this._batchId,name)};Cesium3DTilePointFeature.prototype.setProperty=function(name,value){this._content.batchTable.setProperty(this._batchId,name,value),this._content.featurePropertiesDirty=!0};Cesium3DTilePointFeature.prototype.isExactClass=function(className){return this._content.batchTable.isExactClass(this._batchId,className)};Cesium3DTilePointFeature.prototype.isClass=function(className){return this._content.batchTable.isClass(this._batchId,className)};Cesium3DTilePointFeature.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var Cesium3DTilePointFeature_default=Cesium3DTilePointFeature;function Vector3DTilePoints(options){this._positions=options.positions,this._batchTable=options.batchTable,this._batchIds=options.batchIds,this._rectangle=options.rectangle,this._minHeight=options.minimumHeight,this._maxHeight=options.maximumHeight,this._billboardCollection=void 0,this._labelCollection=void 0,this._polylineCollection=void 0,this._verticesPromise=void 0,this._packedBuffer=void 0,this._ready=!1,this._readyPromise=when_default.defer(),this._resolvedPromise=!1,this._heightReference=options.heightReference}Object.defineProperties(Vector3DTilePoints.prototype,{pointsLength:{get:function(){return this._billboardCollection.length}},texturesByteLength:{get:function(){var billboardSize=this._billboardCollection.textureAtlas.texture.sizeInBytes,labelSize=this._labelCollection._textureAtlas.texture.sizeInBytes;return billboardSize+labelSize}},readyPromise:{get:function(){return this._readyPromise.promise}}});function packBuffer(points2,ellipsoid){var rectangle=points2._rectangle,minimumHeight=points2._minHeight,maximumHeight=points2._maxHeight,packedLength=2+Cesium.Rectangle.packedLength+Cesium.Ellipsoid.packedLength,packedBuffer=new Float64Array(packedLength),offset=0;return packedBuffer[offset++]=minimumHeight,packedBuffer[offset++]=maximumHeight,Cesium.Rectangle.pack(rectangle,packedBuffer,offset),offset+=Cesium.Rectangle.packedLength,Cesium.Ellipsoid.pack(ellipsoid,packedBuffer,offset),packedBuffer}var createVerticesTaskProcessor=new Cesium.TaskProcessor("createVectorTilePoints"),scratchPosition3=new Cesium.Cartesian3;function createPoints(points2,ellipsoid){if(!Cesium.defined(points2._billboardCollection)){var positions;if(!Cesium.defined(points2._verticesPromise)){positions=points2._positions;var packedBuffer=points2._packedBuffer;Cesium.defined(packedBuffer)||(positions=points2._positions=arraySlice_default(positions),points2._batchIds=arraySlice_default(points2._batchIds),packedBuffer=points2._packedBuffer=packBuffer(points2,ellipsoid));var transferrableObjects=[positions.buffer,packedBuffer.buffer],parameters={positions:positions.buffer,packedBuffer:packedBuffer.buffer},verticesPromise=points2._verticesPromise=createVerticesTaskProcessor.scheduleTask(parameters,transferrableObjects);if(!Cesium.defined(verticesPromise))return;verticesPromise.then(function(result){points2._positions=new Float64Array(result.positions),points2._ready=!0})}if(points2._ready&&!Cesium.defined(points2._billboardCollection)){positions=points2._positions;var batchTable=points2._batchTable,batchIds=points2._batchIds,billboardCollection=points2._billboardCollection=new Cesium.BillboardCollection({batchTable}),labelCollection=points2._labelCollection=new Cesium.LabelCollection({batchTable}),polylineCollection=points2._polylineCollection=new Cesium.PolylineCollection;polylineCollection._useHighlightColor=!0;for(var numberOfPoints=positions.length/3,i=0;i<numberOfPoints;++i){var id=batchIds[i],position=Cesium.Cartesian3.unpack(positions,i*3,scratchPosition3),b=billboardCollection.add();b.position=position,b._batchIndex=id;var l=labelCollection.add();l.text=" ",l.position=position,l._batchIndex=id;var p=polylineCollection.add();p.positions=[Cesium.Cartesian3.clone(position),Cesium.Cartesian3.clone(position)]}points2._positions=void 0,points2._packedBuffer=void 0}}}Vector3DTilePoints.prototype.createFeatures=function(content,features){for(var billboardCollection=this._billboardCollection,labelCollection=this._labelCollection,polylineCollection=this._polylineCollection,batchIds=this._batchIds,length3=batchIds.length,i=0;i<length3;++i){var batchId=batchIds[i],billboard=billboardCollection.get(i),label=labelCollection.get(i),polyline=polylineCollection.get(i);features[batchId]=new Cesium3DTilePointFeature_default(content,batchId,billboard,label,polyline)}};Vector3DTilePoints.prototype.applyDebugSettings=function(enabled,color){enabled?(Cesium.Color.clone(color,this._billboardCollection._highlightColor),Cesium.Color.clone(color,this._labelCollection._highlightColor),Cesium.Color.clone(color,this._polylineCollection._highlightColor)):(Cesium.Color.clone(Cesium.Color.WHITE,this._billboardCollection._highlightColor),Cesium.Color.clone(Cesium.Color.WHITE,this._labelCollection._highlightColor),Cesium.Color.clone(Cesium.Color.WHITE,this._polylineCollection._highlightColor))};function clearStyle(polygons2,features){for(var batchIds=polygons2._batchIds,length3=batchIds.length,i=0;i<length3;++i){var batchId=batchIds[i],feature2=features[batchId];feature2.show=!0,feature2.pointSize=Cesium.Cesium3DTilePointFeature.defaultPointSize,feature2.color=Cesium.Cesium3DTilePointFeature.defaultColor,feature2.pointOutlineColor=Cesium.Cesium3DTilePointFeature.defaultPointOutlineColor,feature2.pointOutlineWidth=Cesium.Cesium3DTilePointFeature.defaultPointOutlineWidth,feature2.labelColor=Cesium.Color.WHITE,feature2.labelOutlineColor=Cesium.Color.WHITE,feature2.labelOutlineWidth=1,feature2.font="30px sans-serif",feature2.labelStyle=Cesium.LabelStyle.FILL,feature2.labelText=void 0,feature2.backgroundColor=new Cesium.Color(.165,.165,.165,.8),feature2.backgroundPadding=new Cesium.Cartesian2(7,5),feature2.backgroundEnabled=!1,feature2.scaleByDistance=void 0,feature2.translucencyByDistance=void 0,feature2.distanceDisplayCondition=void 0,feature2.heightOffset=0,feature2.anchorLineEnabled=!1,feature2.anchorLineColor=Cesium.Color.WHITE,feature2.image=void 0,feature2.disableDepthTestDistance=0,feature2.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,feature2.verticalOrigin=Cesium.VerticalOrigin.CENTER,feature2.labelHorizontalOrigin=Cesium.HorizontalOrigin.RIGHT,feature2.labelVerticalOrigin=Cesium.VerticalOrigin.BASELINE}}var scratchColor3=new Cesium.Color,scratchColor22=new Cesium.Color,scratchColor32=new Cesium.Color,scratchColor4=new Cesium.Color,scratchColor5=new Cesium.Color,scratchColor6=new Cesium.Color,scratchScaleByDistance=new Cesium.NearFarScalar,scratchTranslucencyByDistance=new Cesium.NearFarScalar,scratchDistanceDisplayCondition=new Cesium.DistanceDisplayCondition;Vector3DTilePoints.prototype.applyStyle=function(style,features){if(!Cesium.defined(style)){clearStyle(this,features);return}for(var batchIds=this._batchIds,length3=batchIds.length,i=0;i<length3;++i){var batchId=batchIds[i],feature2=features[batchId];if(Cesium.defined(style.show)&&(feature2.show=style.show.evaluate(feature2)),Cesium.defined(style.pointSize)&&(feature2.pointSize=style.pointSize.evaluate(feature2)),Cesium.defined(style.color)&&(feature2.color=style.color.evaluateColor(feature2,scratchColor3)),Cesium.defined(style.pointOutlineColor)&&(feature2.pointOutlineColor=style.pointOutlineColor.evaluateColor(feature2,scratchColor22)),Cesium.defined(style.pointOutlineWidth)&&(feature2.pointOutlineWidth=style.pointOutlineWidth.evaluate(feature2)),Cesium.defined(style.labelColor)&&(feature2.labelColor=style.labelColor.evaluateColor(feature2,scratchColor32)),Cesium.defined(style.labelOutlineColor)&&(feature2.labelOutlineColor=style.labelOutlineColor.evaluateColor(feature2,scratchColor4)),Cesium.defined(style.labelOutlineWidth)&&(feature2.labelOutlineWidth=style.labelOutlineWidth.evaluate(feature2)),Cesium.defined(style.font)&&(feature2.font=style.font.evaluate(feature2)),Cesium.defined(style.labelStyle)&&(feature2.labelStyle=style.labelStyle.evaluate(feature2)),Cesium.defined(style.labelText)?feature2.labelText=style.labelText.evaluate(feature2):feature2.labelText=void 0,Cesium.defined(style.backgroundColor)&&(feature2.backgroundColor=style.backgroundColor.evaluateColor(feature2,scratchColor5)),Cesium.defined(style.backgroundPadding)&&(feature2.backgroundPadding=style.backgroundPadding.evaluate(feature2)),Cesium.defined(style.backgroundEnabled)&&(feature2.backgroundEnabled=style.backgroundEnabled.evaluate(feature2)),Cesium.defined(style.scaleByDistance)){var scaleByDistanceCart4=style.scaleByDistance.evaluate(feature2);scratchScaleByDistance.near=scaleByDistanceCart4.x,scratchScaleByDistance.nearValue=scaleByDistanceCart4.y,scratchScaleByDistance.far=scaleByDistanceCart4.z,scratchScaleByDistance.farValue=scaleByDistanceCart4.w,feature2.scaleByDistance=scratchScaleByDistance}else feature2.scaleByDistance=void 0;if(Cesium.defined(style.translucencyByDistance)){var translucencyByDistanceCart4=style.translucencyByDistance.evaluate(feature2);scratchTranslucencyByDistance.near=translucencyByDistanceCart4.x,scratchTranslucencyByDistance.nearValue=translucencyByDistanceCart4.y,scratchTranslucencyByDistance.far=translucencyByDistanceCart4.z,scratchTranslucencyByDistance.farValue=translucencyByDistanceCart4.w,feature2.translucencyByDistance=scratchTranslucencyByDistance}else feature2.translucencyByDistance=void 0;if(Cesium.defined(style.distanceDisplayCondition)){var distanceDisplayConditionCart2=style.distanceDisplayCondition.evaluate(feature2);scratchDistanceDisplayCondition.near=distanceDisplayConditionCart2.x,scratchDistanceDisplayCondition.far=distanceDisplayConditionCart2.y,feature2.distanceDisplayCondition=scratchDistanceDisplayCondition}else feature2.distanceDisplayCondition=void 0;Cesium.defined(style.heightOffset)&&(feature2.heightOffset=style.heightOffset.evaluate(feature2)),Cesium.defined(style.anchorLineEnabled)&&(feature2.anchorLineEnabled=style.anchorLineEnabled.evaluate(feature2)),Cesium.defined(style.anchorLineColor)&&(feature2.anchorLineColor=style.anchorLineColor.evaluateColor(feature2,scratchColor6)),Cesium.defined(style.image)?feature2.image=style.image.evaluate(feature2):feature2.image=void 0,Cesium.defined(style.disableDepthTestDistance)&&(feature2.disableDepthTestDistance=style.disableDepthTestDistance.evaluate(feature2)),Cesium.defined(style.horizontalOrigin)&&(feature2.horizontalOrigin=style.horizontalOrigin.evaluate(feature2)),Cesium.defined(style.verticalOrigin)&&(feature2.verticalOrigin=style.verticalOrigin.evaluate(feature2)),Cesium.defined(style.labelHorizontalOrigin)&&(feature2.labelHorizontalOrigin=style.labelHorizontalOrigin.evaluate(feature2)),Cesium.defined(style.labelVerticalOrigin)&&(feature2.labelVerticalOrigin=style.labelVerticalOrigin.evaluate(feature2)),Cesium.defined(style.exOffset)&&(feature2.exOffset=style.exOffset.evaluate(feature2))}};Vector3DTilePoints.prototype.update=function(frameState){this._heightReference===Cesium.HeightReference.CLAMP_TO_GROUND?createClampingPoints(this,frameState.mapProjection.ellipsoid,frameState.camera._scene):createPoints(this,frameState.mapProjection.ellipsoid),this._ready&&(this._polylineCollection.update(frameState),this._billboardCollection.update(frameState),this._labelCollection.update(frameState),this._resolvedPromise||(this._readyPromise.resolve(),this._resolvedPromise=!0))};function createClampingPoints(points2,ellipsoid,scene){if(!Cesium.defined(points2._billboardCollection)){var positions;if(!Cesium.defined(points2._verticesPromise)){positions=points2._positions;var packedBuffer=points2._packedBuffer;Cesium.defined(packedBuffer)||(positions=points2._positions=arraySlice_default(positions),points2._batchIds=arraySlice_default(points2._batchIds),packedBuffer=points2._packedBuffer=packBuffer(points2,ellipsoid));var transferrableObjects=[positions.buffer,packedBuffer.buffer],parameters={positions:positions.buffer,packedBuffer:packedBuffer.buffer},verticesPromise=points2._verticesPromise=createVerticesTaskProcessor.scheduleTask(parameters,transferrableObjects);if(!Cesium.defined(verticesPromise))return;verticesPromise.then(function(result){points2._positions=new Float64Array(result.positions),points2._ready=!0})}if(points2._ready&&!Cesium.defined(points2._billboardCollection)){positions=points2._positions;var batchTable=points2._batchTable,batchIds=points2._batchIds,billboardCollection=points2._billboardCollection=new Cesium.BillboardCollection({batchTable,scene}),labelCollection=points2._labelCollection=new Cesium.LabelCollection({batchTable,scene}),polylineCollection=points2._polylineCollection=new Cesium.PolylineCollection;polylineCollection._useHighlightColor=!0;for(var numberOfPoints=positions.length/3,i=0;i<numberOfPoints;++i){var id=batchIds[i],position=Cesium.Cartesian3.unpack(positions,i*3,scratchPosition3),b=billboardCollection.add({heightReference:Cesium.HeightReference.CLAMP_TO_GROUND});b.position=position,b._batchIndex=id;var l=labelCollection.add({heightReference:Cesium.HeightReference.CLAMP_TO_GROUND});l.text=" ",l.position=position,l._batchIndex=id;var p=polylineCollection.add();p.positions=[Cesium.Cartesian3.clone(position),Cesium.Cartesian3.clone(position)]}points2._positions=void 0,points2._packedBuffer=void 0}}}Vector3DTilePoints.prototype.isDestroyed=function(){return!1};Vector3DTilePoints.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._polylineCollection=this._polylineCollection&&this._polylineCollection.destroy(),Cesium.destroyObject(this)};var Vector3DTilePoints_default=Vector3DTilePoints;function Vector3DTileContent(tileset,tile,resource2,arrayBuffer,byteOffset){this._tileset=tileset,this._tile=tile,this._resource=resource2,this._polygons=void 0,this._polylines=void 0,this._points=void 0,this._contentReadyPromise=void 0,this._readyPromise=when_default.defer(),this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,initialize6(this,arrayBuffer,byteOffset)}Object.defineProperties(Vector3DTileContent.prototype,{featuresLength:{get:function(){return Cesium.defined(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return Cesium.defined(this._points)?this._points.pointsLength:0}},trianglesLength:{get:function(){var trianglesLength=0;return Cesium.defined(this._polygons)&&(trianglesLength+=this._polygons.trianglesLength),Cesium.defined(this._polylines)&&(trianglesLength+=this._polylines.trianglesLength),trianglesLength}},geometryByteLength:{get:function(){var geometryByteLength=0;return Cesium.defined(this._polygons)&&(geometryByteLength+=this._polygons.geometryByteLength),Cesium.defined(this._polylines)&&(geometryByteLength+=this._polylines.geometryByteLength),geometryByteLength}},texturesByteLength:{get:function(){return Cesium.defined(this._points)?this._points.texturesByteLength:0}},batchTableByteLength:{get:function(){return Cesium.defined(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});function createColorChangedCallback2(content){return function(batchId,color){Cesium.defined(content._polygons)&&content._polygons.updateCommands(batchId,color)}}function getBatchIds(featureTableJson,featureTableBinary){var polygonBatchIds,polylineBatchIds,pointBatchIds,i,numberOfPolygons=Cesium.defaultValue(featureTableJson.POLYGONS_LENGTH,0),numberOfPolylines=Cesium.defaultValue(featureTableJson.POLYLINES_LENGTH,0),numberOfPoints=Cesium.defaultValue(featureTableJson.POINTS_LENGTH,0);if(numberOfPolygons>0&&Cesium.defined(featureTableJson.POLYGON_BATCH_IDS)){var polygonBatchIdsByteOffset=featureTableBinary.byteOffset+featureTableJson.POLYGON_BATCH_IDS.byteOffset;polygonBatchIds=new Uint16Array(featureTableBinary.buffer,polygonBatchIdsByteOffset,numberOfPolygons)}if(numberOfPolylines>0&&Cesium.defined(featureTableJson.POLYLINE_BATCH_IDS)){var polylineBatchIdsByteOffset=featureTableBinary.byteOffset+featureTableJson.POLYLINE_BATCH_IDS.byteOffset;polylineBatchIds=new Uint16Array(featureTableBinary.buffer,polylineBatchIdsByteOffset,numberOfPolylines)}if(numberOfPoints>0&&Cesium.defined(featureTableJson.POINT_BATCH_IDS)){var pointBatchIdsByteOffset=featureTableBinary.byteOffset+featureTableJson.POINT_BATCH_IDS.byteOffset;pointBatchIds=new Uint16Array(featureTableBinary.buffer,pointBatchIdsByteOffset,numberOfPoints)}var atLeastOneDefined=Cesium.defined(polygonBatchIds)||Cesium.defined(polylineBatchIds)||Cesium.defined(pointBatchIds),atLeastOneUndefined=numberOfPolygons>0&&!Cesium.defined(polygonBatchIds)||numberOfPolylines>0&&!Cesium.defined(polylineBatchIds)||numberOfPoints>0&&!Cesium.defined(pointBatchIds);if(atLeastOneDefined&&atLeastOneUndefined)throw new Cesium.RuntimeError("If one group of batch ids is defined, then all batch ids must be defined.");var allUndefinedBatchIds=!Cesium.defined(polygonBatchIds)&&!Cesium.defined(polylineBatchIds)&&!Cesium.defined(pointBatchIds);if(allUndefinedBatchIds){var id=0;if(!Cesium.defined(polygonBatchIds)&&numberOfPolygons>0)for(polygonBatchIds=new Uint16Array(numberOfPolygons),i=0;i<numberOfPolygons;++i)polygonBatchIds[i]=id++;if(!Cesium.defined(polylineBatchIds)&&numberOfPolylines>0)for(polylineBatchIds=new Uint16Array(numberOfPolylines),i=0;i<numberOfPolylines;++i)polylineBatchIds[i]=id++;if(!Cesium.defined(pointBatchIds)&&numberOfPoints>0)for(pointBatchIds=new Uint16Array(numberOfPoints),i=0;i<numberOfPoints;++i)pointBatchIds[i]=id++}return{polygons:polygonBatchIds,polylines:polylineBatchIds,points:pointBatchIds}}var sizeOfUint326=Uint32Array.BYTES_PER_ELEMENT;function initialize6(content,arrayBuffer,byteOffset){byteOffset=Cesium.defaultValue(byteOffset,0);var uint8Array=new Uint8Array(arrayBuffer),view=new DataView(arrayBuffer);byteOffset+=sizeOfUint326;var version=view.getUint32(byteOffset,!0);if(version!==1)throw new Cesium.RuntimeError("Only Vector tile version 1 is supported.  Version "+version+" is not.");byteOffset+=sizeOfUint326;var byteLength=view.getUint32(byteOffset,!0);if(byteOffset+=sizeOfUint326,byteLength===0){content._readyPromise.resolve(content);return}var featureTableJSONByteLength=view.getUint32(byteOffset,!0);if(byteOffset+=sizeOfUint326,featureTableJSONByteLength===0)throw new Cesium.RuntimeError("Feature table must have a byte length greater than zero");var featureTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint326;var batchTableJSONByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint326;var batchTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint326;var indicesByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint326;var positionByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint326;var polylinePositionByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint326;var pointsPositionByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint326;var featureTableString=Cesium.getStringFromTypedArray(uint8Array,byteOffset,featureTableJSONByteLength),featureTableJson=JSON.parse(featureTableString);byteOffset+=featureTableJSONByteLength;var featureTableBinary=new Uint8Array(arrayBuffer,byteOffset,featureTableBinaryByteLength);byteOffset+=featureTableBinaryByteLength;var batchTableJson,batchTableBinary;if(batchTableJSONByteLength>0){var batchTableString=Cesium.getStringFromTypedArray(uint8Array,byteOffset,batchTableJSONByteLength);batchTableJson=JSON.parse(batchTableString),byteOffset+=batchTableJSONByteLength,batchTableBinaryByteLength>0&&(batchTableBinary=new Uint8Array(arrayBuffer,byteOffset,batchTableBinaryByteLength),batchTableBinary=new Uint8Array(batchTableBinary),byteOffset+=batchTableBinaryByteLength)}var numberOfPolygons=Cesium.defaultValue(featureTableJson.POLYGONS_LENGTH,0),numberOfPolylines=Cesium.defaultValue(featureTableJson.POLYLINES_LENGTH,0),numberOfPoints=Cesium.defaultValue(featureTableJson.POINTS_LENGTH,0),totalPrimitives=numberOfPolygons+numberOfPolylines+numberOfPoints,batchTable=new Cesium3DTileBatchTable_default(content,totalPrimitives,batchTableJson,batchTableBinary,createColorChangedCallback2(content));if(content._batchTable=batchTable,totalPrimitives!==0){var featureTable=new Cesium3DTileFeatureTable_default(featureTableJson,featureTableBinary);if(Cesium.defined(featureTable.json.FLOWLINE)){var flowLine=featureTable.json.FLOWLINE;for(var por in flowLine){for(var positions=[],i=0;i<flowLine[por].length;i+=3){var position=Cesium.Cartesian3.fromRadians(flowLine[por][i+0],flowLine[por][i+1],flowLine[por][i+2]);positions.push(position)}Cesium.defined(content.tileset.flowLines)||(content.tileset.flowLines=[]),content.tileset.flowLines.push(positions)}}var region=featureTable.getGlobalProperty("REGION");if(!Cesium.defined(region))throw new Cesium.RuntimeError("Feature table global property: REGION must be defined");var rectangle=Cesium.Rectangle.unpack(region),minHeight=region[4],maxHeight=region[5],modelMatrix=content._tile.computedTransform,center2=featureTable.getGlobalProperty("RTC_CENTER",Cesium.ComponentDatatype.FLOAT,3);Cesium.defined(center2)?(center2=Cesium.Cartesian3.unpack(center2),Cesium.Matrix4.multiplyByPoint(modelMatrix,center2,center2)):(center2=Cesium.Rectangle.center(rectangle),center2.height=Cesium.Math.lerp(minHeight,maxHeight,.5),center2=Cesium.Ellipsoid.WGS84.cartographicToCartesian(center2));var batchIds=getBatchIds(featureTableJson,featureTableBinary);if(byteOffset+=byteOffset%4,numberOfPolygons>0){featureTable.featuresLength=numberOfPolygons;var polygonCounts=Cesium.defaultValue(featureTable.getPropertyArray("POLYGON_COUNTS",Cesium.ComponentDatatype.UNSIGNED_INT,1),featureTable.getPropertyArray("POLYGON_COUNT",Cesium.ComponentDatatype.UNSIGNED_INT,1));if(!Cesium.defined(polygonCounts))throw new Cesium.RuntimeError("Feature table property: POLYGON_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");var polygonIndexCounts=Cesium.defaultValue(featureTable.getPropertyArray("POLYGON_INDEX_COUNTS",Cesium.ComponentDatatype.UNSIGNED_INT,1),featureTable.getPropertyArray("POLYGON_INDEX_COUNT",Cesium.ComponentDatatype.UNSIGNED_INT,1));if(!Cesium.defined(polygonIndexCounts))throw new Cesium.RuntimeError("Feature table property: POLYGON_INDEX_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");var numPolygonPositions=polygonCounts.reduce(function(total,count2){return total+count2*2},0),numPolygonIndices=polygonIndexCounts.reduce(function(total,count2){return total+count2},0),indices=new Uint32Array(arrayBuffer,byteOffset,numPolygonIndices);byteOffset+=indicesByteLength;var polygonPositions=new Uint16Array(arrayBuffer,byteOffset,numPolygonPositions);byteOffset+=positionByteLength;var polygonMinimumHeights,polygonMaximumHeights;Cesium.defined(featureTableJson.POLYGON_MINIMUM_HEIGHTS)&&Cesium.defined(featureTableJson.POLYGON_MAXIMUM_HEIGHTS)&&(polygonMinimumHeights=featureTable.getPropertyArray("POLYGON_MINIMUM_HEIGHTS",Cesium.ComponentDatatype.FLOAT,1),polygonMaximumHeights=featureTable.getPropertyArray("POLYGON_MAXIMUM_HEIGHTS",Cesium.ComponentDatatype.FLOAT,1)),content._polygons=new Cesium.Vector3DTilePolygons({positions:polygonPositions,counts:polygonCounts,indexCounts:polygonIndexCounts,indices,minimumHeight:minHeight,maximumHeight:maxHeight,polygonMinimumHeights,polygonMaximumHeights,center:center2,rectangle,boundingVolume:content.tile.boundingVolume.boundingVolume,batchTable,batchIds:batchIds.polygons,modelMatrix})}if(numberOfPolylines>0){featureTable.featuresLength=numberOfPolylines;var polylineCounts=Cesium.defaultValue(featureTable.getPropertyArray("POLYLINE_COUNTS",Cesium.ComponentDatatype.UNSIGNED_INT,1),featureTable.getPropertyArray("POLYLINE_COUNT",Cesium.ComponentDatatype.UNSIGNED_INT,1));if(!Cesium.defined(polylineCounts))throw new Cesium.RuntimeError("Feature table property: POLYLINE_COUNTS must be defined when POLYLINES_LENGTH is greater than 0");var widths=featureTable.getPropertyArray("POLYLINE_WIDTHS",Cesium.ComponentDatatype.UNSIGNED_SHORT,1);if(!Cesium.defined(widths)){widths=new Uint16Array(numberOfPolylines);var width2=2;Cesium.defined(content._tileset._airWidth)&&(width2=content._tileset._airWidth);for(var i=0;i<numberOfPolylines;++i)widths[i]=width2}var numPolylinePositions=polylineCounts.reduce(function(total,count2){return total+count2*3},0),highPrecision=featureTable.getGlobalProperty("HIGHTPRECISION",Cesium.ComponentDatatype.UNSIGNED_INT,1);if(Cesium.defined(highPrecision)||(highPrecision=content._tileset.highPrecision),Cesium.defined(highPrecision)&&highPrecision)var polylinePositions=new Uint32Array(arrayBuffer,byteOffset,numPolylinePositions);else var polylinePositions=new Uint16Array(arrayBuffer,byteOffset,numPolylinePositions);byteOffset+=polylinePositionByteLength,content._polylines=new Cesium.EV_Vector3DTilePolylines({positions:polylinePositions,widths,counts:polylineCounts,batchIds:batchIds.polylines,minimumHeight:minHeight,maximumHeight:maxHeight,center:center2,rectangle,boundingVolume:content.tile.boundingVolume.boundingVolume,batchTable,material:content._tileset._material,highPrecision,rollerRegion:content._tileset.rollerRegion,disableDepthTestDistance:content._tileset._disableDepthTestDistance})}if(numberOfPoints>0){var pointPositions=new Uint16Array(arrayBuffer,byteOffset,numberOfPoints*3);byteOffset+=pointsPositionByteLength,content._points=new Vector3DTilePoints_default({positions:pointPositions,batchIds:batchIds.points,minimumHeight:minHeight,maximumHeight:maxHeight,rectangle,batchTable,heightReference:content._tileset.heightReference})}}}function createFeatures5(content){var featuresLength=content.featuresLength;if(!Cesium.defined(content._features)&&featuresLength>0){var features=new Array(featuresLength);Cesium.defined(content._polygons)&&content._polygons.createFeatures(content,features),Cesium.defined(content._polylines)&&content._polylines.createFeatures(content,features),Cesium.defined(content._points)&&content._points.createFeatures(content,features),content._features=features}}Vector3DTileContent.prototype.hasProperty=function(batchId,name){return this._batchTable.hasProperty(batchId,name)};Vector3DTileContent.prototype.getFeature=function(batchId){return createFeatures5(this),this._features[batchId]};Vector3DTileContent.prototype.applyDebugSettings=function(enabled,color){Cesium.defined(this._polygons)&&this._polygons.applyDebugSettings(enabled,color),Cesium.defined(this._polylines)&&this._polylines.applyDebugSettings(enabled,color),Cesium.defined(this._points)&&this._points.applyDebugSettings(enabled,color)};Vector3DTileContent.prototype.applyStyle=function(style){createFeatures5(this),Cesium.defined(this._polygons)&&this._polygons.applyStyle(style,this._features),Cesium.defined(this._polylines)&&this._polylines.applyStyle(style,this._features),Cesium.defined(this._points)&&this._points.applyStyle(style,this._features)};Vector3DTileContent.prototype.update=function(tileset,frameState){var ready=!0;if(Cesium.defined(this._polygons)&&(this._polygons.classificationType=this._tileset.classificationType,this._polygons.debugWireframe=this._tileset.debugWireframe,this._polygons.update(frameState),ready=ready&&this._polygons._ready),Cesium.defined(this._polylines)&&(this._polylines.update(frameState),ready=ready&&this._polylines._ready),Cesium.defined(this._points)&&(this._points.update(frameState),ready=ready&&this._points._ready),Cesium.defined(this._batchTable)&&ready&&this._batchTable.update(tileset,frameState),!Cesium.defined(this._contentReadyPromise)){var pointsPromise=Cesium.defined(this._points)?this._points.readyPromise:void 0,polygonPromise=Cesium.defined(this._polygons)?this._polygons.readyPromise:void 0,polylinePromise=Cesium.defined(this._polylines)?this._polylines.readyPromise:void 0,that=this;this._contentReadyPromise=when_default.all([pointsPromise,polygonPromise,polylinePromise]).then(function(){that._readyPromise.resolve(that)})}};Vector3DTileContent.prototype.isDestroyed=function(){return!1};Vector3DTileContent.prototype.destroy=function(){return this._polygons=this._polygons&&this._polygons.destroy(),this._polylines=this._polylines&&this._polylines.destroy(),this._points=this._points&&this._points.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Cesium.destroyObject(this)};var Vector3DTileContent_default=Vector3DTileContent;var Cesium3DTileContentFactory={b3dm:function(tileset,tile,resource2,arrayBuffer,byteOffset){return new Batched3DModel3DTileContent_default(tileset,tile,resource2,arrayBuffer,byteOffset)},pnts:function(tileset,tile,resource2,arrayBuffer,byteOffset){return new PointCloud3DTileContent_default(tileset,tile,resource2,arrayBuffer,byteOffset)},i3dm:function(tileset,tile,resource2,arrayBuffer,byteOffset){return new Instanced3DModel3DTileContent_default(tileset,tile,resource2,arrayBuffer,byteOffset)},cmpt:function(tileset,tile,resource2,arrayBuffer,byteOffset){return new Composite3DTileContent_default(tileset,tile,resource2,arrayBuffer,byteOffset,Cesium3DTileContentFactory)},json:function(tileset,tile,resource2,arrayBuffer,byteOffset){return new Tileset3DTileContent_default(tileset,tile,resource2,arrayBuffer,byteOffset)},geom:function(tileset,tile,resource2,arrayBuffer,byteOffset){return new Cesium.Geometry3DTileContent(tileset,tile,resource2,arrayBuffer,byteOffset)},vctr:function(tileset,tile,resource2,arrayBuffer,byteOffset){return new Vector3DTileContent_default(tileset,tile,resource2,arrayBuffer,byteOffset)}},Cesium3DTileContentFactory_default=Cesium3DTileContentFactory;function Cesium3DTile(tileset,baseResource,header,parent){this._tileset=tileset,this._header=header;var contentHeader=header.content;if(Cesium.defined(header.transform)&&(Cesium.defined(tileset.position)||Cesium.defined(tileset.headingPitchRoll)||Cesium.defined(tileset.scale))){var matrix=Cesium.Matrix4.unpack(header.transform),newWorldPos=Cesium.defined(tileset.position)?Cesium.Cartesian3.fromRadians(tileset.position.longitude,tileset.position.latitude,tileset.position.height):Cesium.Matrix4.getTranslation(matrix,new Cesium.Cartesian3),quaternion=Cesium.defined(tileset.headingPitchRoll)?Cesium.Transforms.headingPitchRollQuaternion(newWorldPos,tileset.headingPitchRoll):Cesium.Quaternion.fromRotationMatrix(Cesium.Matrix4.getMatrix3(matrix,new Cesium.Matrix3),new Cesium.Quaternion),scale4=Cesium.defined(tileset.scale)?tileset.scale:Cesium.Matrix4.getScale(matrix,new Cesium.Cartesian3),newWorldMatrix=Cesium.Matrix4.fromTranslationQuaternionRotationScale(newWorldPos,quaternion,scale4),iMatrix=Cesium.Matrix4.inverse(matrix,new Cesium.Matrix4),trMatrix=Cesium.Matrix4.multiply(newWorldMatrix,iMatrix,new Cesium.Matrix4);tileset.modelMatrix=trMatrix}this.transform=Cesium.defined(header.transform)?Cesium.Matrix4.unpack(header.transform):Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY);var parentTransform=Cesium.defined(parent)?parent.computedTransform:tileset.modelMatrix,computedTransform=Cesium.Matrix4.multiply(parentTransform,this.transform,new Cesium.Matrix4),parentInitialTransform=Cesium.defined(parent)?parent._initialTransform:Cesium.Matrix4.IDENTITY;this._initialTransform=Cesium.Matrix4.multiply(parentInitialTransform,this.transform,new Cesium.Matrix4),this.computedTransform=computedTransform,this._boundingVolume=this.createBoundingVolume(header.boundingVolume,computedTransform),Cesium.defined(tileset.position)&&parentTransform.equals(Cesium.Matrix4.IDENTITY)&&(this._boundingVolume._boundingSphere.center=Cesium.Cartesian3.fromRadians(tileset.position.longitude,tileset.position.latitude,tileset.position.height)),this._boundingVolume2D=void 0;var contentBoundingVolume;Cesium.defined(contentHeader)&&Cesium.defined(contentHeader.boundingVolume)&&(contentBoundingVolume=this.createBoundingVolume(contentHeader.boundingVolume,computedTransform)),this._contentBoundingVolume=contentBoundingVolume,this._contentBoundingVolume2D=void 0;var viewerRequestVolume;Cesium.defined(header.viewerRequestVolume)&&(viewerRequestVolume=this.createBoundingVolume(header.viewerRequestVolume,computedTransform)),this._viewerRequestVolume=viewerRequestVolume,this.geometricError=header.geometricError,this._geometricError=header.geometricError,Cesium.defined(this._geometricError)||(this._geometricError=Cesium.defined(parent)?parent.geometricError:tileset._geometricError,Cesium3DTile._deprecationWarning("geometricErrorUndefined","Required property geometricError is undefined for this tile. Using parent's geometric error instead.")),this.updateGeometricErrorScale(),this.geometricError*=this._tileset._geoErrorRatio,this._geometricError*=this._tileset._geoErrorRatio;var refine;Cesium.defined(header.refine)?((header.refine==="replace"||header.refine==="add")&&Cesium3DTile._deprecationWarning("lowercase-refine",'This tile uses a lowercase refine "'+header.refine+'". Instead use "'+header.refine.toUpperCase()+'".'),refine=header.refine.toUpperCase()==="REPLACE"?Cesium.Cesium3DTileRefine.REPLACE:Cesium.Cesium3DTileRefine.ADD):Cesium.defined(parent)?refine=parent.refine:refine=Cesium.Cesium3DTileRefine.REPLACE,this.refine=refine,this.children=[],this.parent=parent;var content,hasEmptyContent2,contentState,contentResource,serverKey;baseResource=Cesium.Resource.createIfNeeded(baseResource);function encodeWithoutSlash(str){let outStr=str;if(/\//.test(outStr)){let strList=str.split("/");outStr="";let i=0,len=strList.length;if(len>1){for(;i<len-1;++i)outStr+=encodeURIComponent(strList[i])+"/";outStr+=encodeURIComponent(strList[i])}}else outStr=encodeURIComponent(str);return outStr}if(Cesium.defined(contentHeader)){var contentHeaderUri=encodeWithoutSlash(contentHeader.uri);Cesium.defined(contentHeader.url)&&(Cesium3DTile._deprecationWarning("contentUrl",'This tileset JSON uses the "content.url" property which has been deprecated. Use "content.uri" instead.'),contentHeaderUri=encodeWithoutSlash(contentHeader.url)),hasEmptyContent2=!1,contentState=Cesium.Cesium3DTileContentState.UNLOADED,contentResource=baseResource.getDerivedResource({url:contentHeaderUri,queryParameters:baseResource.queryParameters}),serverKey=Cesium.RequestScheduler.getServerKey(contentResource.getUrlComponent())}else content=new Cesium.Empty3DTileContent(tileset,this),hasEmptyContent2=!0,contentState=Cesium.Cesium3DTileContentState.READY;this._content=content,this._contentResource=contentResource,this._contentState=contentState,this._contentReadyToProcessPromise=void 0,this._contentReadyPromise=void 0,this._expiredContent=void 0,this._serverKey=serverKey,this.hasEmptyContent=hasEmptyContent2,this.hasTilesetContent=!1,this.cacheNode=void 0;var expire=header.expire,expireDuration,expireDate;Cesium.defined(expire)&&(expireDuration=expire.duration,Cesium.defined(expire.date)&&(expireDate=Cesium.JulianDate.fromIso8601(expire.date))),this.expireDuration=expireDuration,this.expireDate=expireDate,this.lastStyleTime=0,this._optimChildrenWithinParent=Cesium.Cesium3DTileOptimizationHint.NOT_COMPUTED,this.clippingPlanesDirty=!1,this.priorityDeferred=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._screenSpaceErrorProgressiveResolution=0,this._visibilityPlaneMask=0,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._updatedVisibilityFrame=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._isClipped=!0,this._clippingPlanesState=0,this._debugBoundingVolume=void 0,this._debugContentBoundingVolume=void 0,this._debugViewerRequestVolume=void 0,this._debugColor=Cesium.Color.fromRandom({alpha:1}),this._debugColorizeTiles=!1,this._priority=0,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1,this._loadTimestamp=new Cesium.JulianDate,this._commandsLength=0,this._color=void 0,this._colorDirty=!1,this._request=void 0,this._labels=void 0,this.destroySubtreeFunction=void 0,Cesium.defined(this.parent)&&Cesium.defined(this.parent.sharedResources)&&(this.sharedResources={treeTables:Cesium.defined(this.parent.sharedResources.treeTables)?{name:this.parent.sharedResources.treeTables.name,shadredData:this.parent.sharedResources.treeTables.shadredData}:{},instancedPrograms:{name:this.parent.sharedResources.instancedPrograms.name,shadredData:this.parent.sharedResources.instancedPrograms.shadredData},ktxs:this.parent.sharedResources.ktxs}),Cesium.defined(this._header)&&Cesium.defined(this._header.modeltree)&&request3DTileTreeTable(this,this._header.modeltree.uri)}Cesium3DTile._deprecationWarning=Cesium.deprecationWarning;Object.defineProperties(Cesium3DTile.prototype,{tileset:{get:function(){return this._tileset}},content:{get:function(){return this._content}},boundingVolume:{get:function(){return this._boundingVolume}},contentBoundingVolume:{get:function(){return Cesium.defaultValue(this._contentBoundingVolume,this._boundingVolume)}},boundingSphere:{get:function(){return this._boundingVolume.boundingSphere}},extras:{get:function(){return this._header.extras}},color:{get:function(){return Cesium.defined(this._color)||(this._color=new Cesium.Color),Cesium.Color.clone(this._color)},set:function(value){this._color=Cesium.Color.clone(value,this._color),this._colorDirty=!0}},contentAvailable:{get:function(){return this.contentReady&&!this.hasEmptyContent&&!this.hasTilesetContent||Cesium.defined(this._expiredContent)&&!this.contentFailed}},contentReady:{get:function(){return this._contentState===Cesium.Cesium3DTileContentState.READY}},contentUnloaded:{get:function(){return this._contentState===Cesium.Cesium3DTileContentState.UNLOADED}},contentExpired:{get:function(){return this._contentState===Cesium.Cesium3DTileContentState.EXPIRED}},contentFailed:{get:function(){return this._contentState===Cesium.Cesium3DTileContentState.FAILED}},contentReadyToProcessPromise:{get:function(){if(Cesium.defined(this._contentReadyToProcessPromise))return this._contentReadyToProcessPromise.promise}},contentReadyPromise:{get:function(){if(Cesium.defined(this._contentReadyPromise))return this._contentReadyPromise.promise}},commandsLength:{get:function(){return this._commandsLength}}});var scratchCartesian2=new Cesium.Cartesian3;function isPriorityDeferred(tile,frameState){var tileset=tile._tileset,camera=frameState.camera,boundingSphere=tile.boundingSphere,radius=boundingSphere.radius,scaledCameraDirection=Cesium.Cartesian3.multiplyByScalar(camera.directionWC,tile._centerZDepth,scratchCartesian2),closestPointOnLine=Cesium.Cartesian3.add(camera.positionWC,scaledCameraDirection,scratchCartesian2),toLine2=Cesium.Cartesian3.subtract(closestPointOnLine,boundingSphere.center,scratchCartesian2),distanceToCenterLine=Cesium.Cartesian3.magnitude(toLine2),notTouchingSphere=distanceToCenterLine>radius;if(notTouchingSphere){var toLineNormalized=Cesium.Cartesian3.normalize(toLine2,scratchCartesian2),scaledToLine=Cesium.Cartesian3.multiplyByScalar(toLineNormalized,radius,scratchCartesian2),closestOnSphere=Cesium.Cartesian3.add(boundingSphere.center,scaledToLine,scratchCartesian2),toClosestOnSphere=Cesium.Cartesian3.subtract(closestOnSphere,camera.positionWC,scratchCartesian2),toClosestOnSphereNormalize=Cesium.Cartesian3.normalize(toClosestOnSphere,scratchCartesian2);tile._foveatedFactor=1-Math.abs(Cesium.Cartesian3.dot(camera.directionWC,toClosestOnSphereNormalize))}else tile._foveatedFactor=0;var replace=tile.refine===Cesium.Cesium3DTileRefine.REPLACE,skipLevelOfDetail2=tileset._skipLevelOfDetail;if(replace&&!skipLevelOfDetail2||!tileset.foveatedScreenSpaceError||tileset.foveatedConeSize===1||tile._priorityProgressiveResolution&&replace&&skipLevelOfDetail2||tileset._pass===Cesium.Cesium3DTilePass.PRELOAD_FLIGHT||tileset._pass===Cesium.Cesium3DTilePass.PRELOAD)return!1;var maximumFovatedFactor=1-Math.cos(camera.frustum.fov*.5),foveatedConeFactor=tileset.foveatedConeSize*maximumFovatedFactor;if(tile._foveatedFactor<=foveatedConeFactor)return!1;var range=maximumFovatedFactor-foveatedConeFactor,normalizedFoveatedFactor=Cesium.Math.clamp((tile._foveatedFactor-foveatedConeFactor)/range,0,1),sseRelaxation=tileset.foveatedInterpolationCallback(tileset.foveatedMinimumScreenSpaceErrorRelaxation,tileset.maximumScreenSpaceError,normalizedFoveatedFactor),sse=tile._screenSpaceError===0&&Cesium.defined(tile.parent)?tile.parent._screenSpaceError*.5:tile._screenSpaceError;return tileset.maximumScreenSpaceError-sseRelaxation<=sse}var scratchJulianDate=new Cesium.JulianDate;Cesium3DTile.prototype.getScreenSpaceError=function(frameState,useParentGeometricError,progressiveResolutionHeightFraction){var tileset=this._tileset,heightFraction=Cesium.defaultValue(progressiveResolutionHeightFraction,1),parentGeometricError=Cesium.defined(this.parent)?this.parent.geometricError:tileset._geometricError,geometricError=useParentGeometricError?parentGeometricError:this.geometricError;if(geometricError===0)return 0;var camera=frameState.camera,frustum=camera.frustum,context=frameState.context,width2=context.drawingBufferWidth,height2=context.drawingBufferHeight*heightFraction,error;if(frameState.mode===Cesium.SceneMode.SCENE2D||frustum instanceof Cesium.OrthographicFrustum){Cesium.defined(frustum._offCenterFrustum)&&(frustum=frustum._offCenterFrustum);var pixelSize=Math.max(frustum.top-frustum.bottom,frustum.right-frustum.left)/Math.max(width2,height2);error=geometricError/pixelSize}else{var distance12=Math.max(this._distanceToCamera,Cesium.Math.EPSILON7);if(this._depth===1&&Cesium.defined(tileset._maxHeight)&&Cesium.defined(tileset._minHeight)&&Cesium.defined(tileset._distanceLimit)){var height2=frameState.camera.positionCartographic.height;return tileset._maxHeight>=height2&&tileset._minHeight<=height2&&tileset._distance>=distance12&&tileset._distanceLimit<=distance12?tileset._maximumScreenSpaceError+1:0}if(Cesium.defined(tileset._distance))Cesium.defined(tileset._distance)&&Cesium.defined(tileset._distanceLimit)?tileset._distance>=distance12&&tileset._distanceLimit<=distance12?error=tileset._maximumScreenSpaceError*frameState.pixelRatio+1:error=0:Cesium.defined(tileset._distance)&&(tileset._distance>=distance12?error=tileset._maximumScreenSpaceError*frameState.pixelRatio+1:error=0);else{var sseDenominator=camera.frustum.sseDenominator;if(error=geometricError*height2/(distance12*sseDenominator),tileset.reduceRequest&&camera._positionCartographic.height>0){var rate=camera._positionCartographic.height/distance12;rate=rate>1?1:rate,error*=rate}if(tileset.dynamicScreenSpaceError){var density=tileset._dynamicScreenSpaceErrorComputedDensity,factor=tileset.dynamicScreenSpaceErrorFactor,dynamicError=Cesium.Math.fog(distance12,density)*factor;error-=dynamicError}}}return error/=frameState.pixelRatio,error};function isPriorityProgressiveResolution(tileset,tile){if(tileset.progressiveResolutionHeightFraction<=0||tileset.progressiveResolutionHeightFraction>.5)return!1;var isProgressiveResolutionTile=tile._screenSpaceErrorProgressiveResolution>tileset._maximumScreenSpaceError;tile._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1;var parent=tile.parent,maximumScreenSpaceError=tileset._maximumScreenSpaceError,tilePasses=tile._screenSpaceErrorProgressiveResolution<=maximumScreenSpaceError,parentFails=Cesium.defined(parent)&&parent._screenSpaceErrorProgressiveResolution>maximumScreenSpaceError;return tilePasses&&parentFails&&(tile._priorityProgressiveResolutionScreenSpaceErrorLeaf=!0,isProgressiveResolutionTile=!0),isProgressiveResolutionTile}function getPriorityReverseScreenSpaceError(tileset,tile){var parent=tile.parent,useParentScreenSpaceError=Cesium.defined(parent)&&(!tileset._skipLevelOfDetail||tile._screenSpaceError===0||parent.hasTilesetContent),screenSpaceError=useParentScreenSpaceError?parent._screenSpaceError:tile._screenSpaceError;return tileset.root._screenSpaceError-screenSpaceError}Cesium3DTile.prototype.updateVisibility=function(frameState){var parent=this.parent,tileset=this._tileset,parentTransform=Cesium.defined(parent)?parent.computedTransform:tileset.modelMatrix,parentVisibilityPlaneMask=Cesium.defined(parent)?parent._visibilityPlaneMask:Cesium.CullingVolume.MASK_INDETERMINATE;this.updateTransform(parentTransform),this._distanceToCamera=this.distanceToTile(frameState),this._centerZDepth=this.distanceToTileCenter(frameState),this._screenSpaceError=this.getScreenSpaceError(frameState,!1),this._screenSpaceErrorProgressiveResolution=this.getScreenSpaceError(frameState,!1,tileset.progressiveResolutionHeightFraction),this._visibilityPlaneMask=this.visibility(frameState,parentVisibilityPlaneMask),this._visible=this._visibilityPlaneMask!==Cesium.CullingVolume.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(frameState),this._priorityReverseScreenSpaceError=getPriorityReverseScreenSpaceError(tileset,this),this._priorityProgressiveResolution=isPriorityProgressiveResolution(tileset,this),this.priorityDeferred=isPriorityDeferred(this,frameState)};Cesium3DTile.prototype.updateExpiration=function(){if(Cesium.defined(this.expireDate)&&this.contentReady&&!this.hasEmptyContent){var now=Cesium.JulianDate.now(scratchJulianDate);Cesium.JulianDate.lessThan(this.expireDate,now)&&(this._contentState=Cesium.Cesium3DTileContentState.EXPIRED,this._expiredContent=this._content)}};function updateExpireDate(tile){if(Cesium.defined(tile.expireDuration)){var expireDurationDate=Cesium.JulianDate.now(scratchJulianDate);Cesium.JulianDate.addSeconds(expireDurationDate,tile.expireDuration,expireDurationDate),Cesium.defined(tile.expireDate)?Cesium.JulianDate.lessThan(tile.expireDate,expireDurationDate)&&Cesium.JulianDate.clone(expireDurationDate,tile.expireDate):tile.expireDate=Cesium.JulianDate.clone(expireDurationDate)}}function getContentFailedFunction(tile,tileset){return function(error){tile._contentState===Cesium.Cesium3DTileContentState.PROCESSING?--tileset.statistics.numberOfTilesProcessing:--tileset.statistics.numberOfPendingRequests,tile._contentState=Cesium.Cesium3DTileContentState.FAILED,tile._contentReadyPromise.reject(error),tile._contentReadyToProcessPromise.reject(error)}}function createPriorityFunction(tile){return function(){return tile._priority}}Cesium3DTile.prototype.requestContent=function(){var that=this,tileset=this._tileset;if(this.hasEmptyContent)return!1;var resource2=this._contentResource.clone(),expired=this.contentExpired;expired&&resource2.setQueryParameters({expired:this.expireDate.toString()});var request=new Cesium.Request({throttle:!1,throttleByServer:!1,type:Cesium.RequestType.TILES3D,priorityFunction:createPriorityFunction(this),serverKey:this._serverKey});this._request=request,resource2.request=request;var promise=resource2.fetchArrayBuffer();if(!Cesium.defined(promise))return!1;var contentState=this._contentState;this._contentState=Cesium.Cesium3DTileContentState.LOADING,this._contentReadyToProcessPromise=when_default.defer(),this._contentReadyPromise=when_default.defer();var contentFailedFunction=getContentFailedFunction(this,tileset);return promise.then(function(arrayBuffer){if(that.isDestroyed()){contentFailedFunction();return}var uint8Array=new Uint8Array(arrayBuffer),magic=Cesium.getMagic(uint8Array),contentFactory=Cesium3DTileContentFactory_default[magic],content;return tileset._disableSkipLevelOfDetail=tileset._disableSkipLevelOfDetail||magic==="vctr"||magic==="geom",Cesium.defined(contentFactory)?content=contentFactory(tileset,that,that._contentResource,arrayBuffer,0):(content=Cesium3DTileContentFactory_default.json(tileset,that,that._contentResource,arrayBuffer,0),that.hasTilesetContent=!0),expired&&(that.expireDate=void 0),that._content=content,that._contentState=Cesium.Cesium3DTileContentState.PROCESSING,that._contentReadyToProcessPromise.resolve(content),content.readyPromise.then(function(content2){if(that._request&&(that._request.deferred=void 0,that._request.requestFunction=void 0,that._request.cancelFunction=void 0,that._request.priorityFunction=void 0,that._request=void 0),that.isDestroyed()){contentFailedFunction();return}updateExpireDate(that),that._selectedFrame=0,that.lastStyleTime=0,Cesium.JulianDate.now(that._loadTimestamp),that._contentState=Cesium.Cesium3DTileContentState.READY,that._contentReadyPromise.resolve(content2)})}).catch(function(error){if(request.state===Cesium.RequestState.CANCELLED){that._contentState=contentState,--tileset.statistics.numberOfPendingRequests,++tileset.statistics.numberOfAttemptedRequests;return}contentFailedFunction(error)}),!0};Cesium3DTile.prototype.requestContentByIndexedDB=function(){var that=this;if(this.hasEmptyContent)return!1;var resource2=this._contentResource.clone(),expired=this.contentExpired;expired&&resource2.setQueryParameters({expired:this.expireDate.toString()});var request=new Cesium.Request({throttle:!0,throttleByServer:!0,type:Cesium.RequestType.TILES3D,priorityFunction:createPriorityFunction(this),serverKey:this._serverKey});resource2.request=request;var c3DTileData={keyName:that._contentResource._url,resource:resource2,c3DTile:that,data:void 0,contentState:that._contentState,downloadSuccessFun:downloadSuccessFormIdbCallback,downloadErrorFun:downloadErrorFormIdbCallback};return EV_IndexDBHandler_default.loadCesium3DTile(c3DTileData)?(that._contentState=Cesium.Cesium3DTileContentState.LOADING,that._contentReadyToProcessPromise=when_default.defer(),that._contentReadyPromise=when_default.defer(),!0):!1};function downloadErrorFormIdbCallback(cesium3DTileData){if(Cesium.defined(cesium3DTileData)&&Cesium.defined(cesium3DTileData.resource)&&Cesium.defined(cesium3DTileData.c3DTile)){var cur3DTileData=cesium3DTileData,that=cur3DTileData.c3DTile,resource2=cur3DTileData.resource,tileset=cur3DTileData.c3DTile._tileset,request=resource2.request,statistics=tileset._statistics,promise=resource2.fetchArrayBuffer();if(!Cesium.defined(promise)){++statistics.numberOfAttemptedRequests,that._contentState=cur3DTileData.contentState;return}that.contentExpired&&(that.expireDate=void 0);var contentFailedFunction=getContentFailedFunction(that,tileset);promise.then(function(arrayBuffer){if(that.isDestroyed()){contentFailedFunction();return}cur3DTileData.data=arrayBuffer;var uint8Array=new Uint8Array(arrayBuffer),magic=Cesium.getMagic(uint8Array),contentFactory=Cesium3DTileContentFactory_default[magic],content;return tileset._disableSkipLevelOfDetail=tileset._disableSkipLevelOfDetail||magic==="vctr"||magic==="geom",Cesium.defined(contentFactory)?content=contentFactory(tileset,that,that._contentResource,arrayBuffer,0):(content=Cesium3DTileContentFactory_default.json(tileset,that,that._contentResource,arrayBuffer,0),that.hasTilesetContent=!0),that._content=content,that._contentState=Cesium.Cesium3DTileContentState.PROCESSING,that._contentReadyToProcessPromise.resolve(content),content.readyPromise.then(function(content2){if(that.isDestroyed()){contentFailedFunction();return}var meshPrimitives=[];if(that._content.constructor.name==="Composite3DTileContent")for(var i=0;i<that._content._contents.length;i++){var tempContent=that._content._contents[i];if(tempContent.constructor.name==="Batched3DModel3DTileContent"){if(!Cesium.defined(tempContent._model)){meshPrimitives.push(void 0);continue}meshPrimitives.push(tempContent._model.meshPrimitives)}else if(tempContent.constructor.name==="Instanced3DModel3DTileContent"){if(!Cesium.defined(tempContent._modelInstanceCollection._model)){meshPrimitives.push(void 0);continue}meshPrimitives.push(tempContent._modelInstanceCollection._model.meshPrimitives)}}else that._content.constructor.name==="Batched3DModel3DTileContent"?Cesium.defined(that._content._model)&&meshPrimitives.push(that._content._model.meshPrimitives):that._content.constructor.name==="Instanced3DModel3DTileContent"?Cesium.defined(that._content._modelInstanceCollection._model)&&meshPrimitives.push(that._content._modelInstanceCollection._model.meshPrimitives):that._content.constructor.name==="PointCloud3DTileContent"&&Cesium.defined(that._content._pointCloud)&&meshPrimitives.push(that._content._pointCloud.meshPrimitives);if(cur3DTileData.meshPrimitives=meshPrimitives,EV_IndexDBHandler_default.saveCesium3DTile(cur3DTileData),that._content.constructor.name==="Composite3DTileContent")for(var m=0;m<that._content._contents.length;m++){var tempContent1=that._content._contents[m];tempContent1.constructor.name==="Batched3DModel3DTileContent"?Cesium.defined(tempContent1._model)&&(tempContent1._model.meshPrimitives.length=0):tempContent1.constructor.name==="Instanced3DModel3DTileContent"&&Cesium.defined(tempContent1._modelInstanceCollection._model)&&(tempContent1._modelInstanceCollection._model.meshPrimitives.length=0)}else that._content.constructor.name==="Batched3DModel3DTileContent"?Cesium.defined(that._content._model)&&(that._content._model.meshPrimitives.length=0):that._content.constructor.name==="Instanced3DModel3DTileContent"?Cesium.defined(that._content._modelInstanceCollection._model)&&(that._content._modelInstanceCollection._model.meshPrimitives.length=0):that._content.constructor.name==="PointCloud3DTileContent"&&Cesium.defined(that._content._pointCloud)&&(that._content._pointCloud.meshPrimitives=0);updateExpireDate(that),that._selectedFrame=0,that.lastStyleTime=0,that._contentState=Cesium.Cesium3DTileContentState.READY,that._contentReadyPromise.resolve(content2)})}).catch(function(error){if(request.state===Cesium.RequestState.CANCELLED){that._contentState=cur3DTileData.contentState,--tileset.statistics.numberOfPendingRequests,++tileset.statistics.numberOfAttemptedRequests;return}contentFailedFunction(error)});var expired=that.contentExpired;expired&&(that.hasTilesetContent?that.destroySubtreeFunction(tileset,that):(statistics.decrementLoadCounts(that.content),--statistics.numberOfTilesWithContentReady))}}function downloadSuccessFormIdbCallback(cesium3DTileData,arrayBuffer){if(Cesium.defined(cesium3DTileData)&&Cesium.defined(cesium3DTileData.resource)&&Cesium.defined(cesium3DTileData.c3DTile)){var cur3DTileData=cesium3DTileData,that=cur3DTileData.c3DTile,tileset=cur3DTileData.c3DTile._tileset,statistics=tileset._statistics,contentFailedFunction=getContentFailedFunction(that,tileset);if(that.isDestroyed()){contentFailedFunction();return}var uint8Array=new Uint8Array(arrayBuffer),magic=Cesium.getMagic(uint8Array),contentFactory=Cesium3DTileContentFactory_default[magic],content;tileset._disableSkipLevelOfDetail=tileset._disableSkipLevelOfDetail||magic==="vctr"||magic==="geom",Cesium.defined(contentFactory)?content=contentFactory(tileset,that,that._contentResource,arrayBuffer,0):(content=Cesium3DTileContentFactory_default.json(tileset,that,that._contentResource,arrayBuffer,0),that.hasTilesetContent=!0);var meshPrimitives=cur3DTileData.meshPrimitives;if(content.constructor.name==="Composite3DTileContent")for(var i=0;i<content._contents.length&&i<meshPrimitives.length;i++){var tempContent=content._contents[i];tempContent.constructor.name==="Batched3DModel3DTileContent"?Cesium.defined(tempContent._model)&&(tempContent._model.meshPrimitives=meshPrimitives[i]):tempContent.constructor.name==="Instanced3DModel3DTileContent"&&Cesium.defined(tempContent._modelInstanceCollection)&&(tempContent._modelInstanceCollection.modelMeshPrimitives=meshPrimitives[i])}else content.constructor.name==="Batched3DModel3DTileContent"?Cesium.defined(content._model)&&meshPrimitives.length>0&&(content._model.meshPrimitives=meshPrimitives[0]):content.constructor.name==="Instanced3DModel3DTileContent"?Cesium.defined(content._modelInstanceCollection._model)&&meshPrimitives.length>0&&(content._modelInstanceCollection.modelMeshPrimitives=meshPrimitives[0]):content.constructor.name==="PointCloud3DTileContent"&&Cesium.defined(content._pointCloud)&&meshPrimitives.length>0&&(content._pointCloud.meshPrimitives=meshPrimitives[0]);return that._content=content,that._contentState=Cesium.Cesium3DTileContentState.PROCESSING,that._contentReadyToProcessPromise.resolve(content),content.readyPromise.then(function(content2){if(that.isDestroyed()){contentFailedFunction();return}updateExpireDate(that),that._selectedFrame=0,that.lastStyleTime=0,that._contentState=Cesium.Cesium3DTileContentState.READY,that._contentReadyPromise.resolve(content2)})}}function request3DTileTreeTable(tile,uri){var fileName=uri.substr(uri.lastIndexOf("/")+1),splitName=tile._contentResource._url.substr(tile._contentResource._url.lastIndexOf("/")+1),basePath=tile._contentResource._url.split(splitName);if(uri=basePath[0]+fileName,Cesium.defined(tile._contentResource._queryParameters.role_key)){var key="?role_key="+tile._contentResource._queryParameters.role_key;uri+=key}Cesium.Resource.fetchJson(Cesium.buildModuleUrl(uri)).then(function(json){addParentId(json),tile._tileset.sharedResources.treeTables[tile._header.modeltree.uri]=json,tile._tileset.tramsformTreeTableMap(json)})}function addParentId(json){var children=json.children;if(Cesium.defined(children))for(var length3=children.length,i=0;i<length3;i++)children[i].parentId=json.id,Cesium.defined(children[i].children)&&addParentId(children[i]);else return}Cesium3DTile.prototype.unloadContent=function(){this.hasEmptyContent||this.hasTilesetContent||(this._content=this._content&&this._content.destroy(),this._contentState=Cesium.Cesium3DTileContentState.UNLOADED,this._contentReadyToProcessPromise=void 0,this._contentReadyPromise=void 0,this.lastStyleTime=0,this.clippingPlanesDirty=this._clippingPlanesState===0,this._clippingPlanesState=0,this._debugColorizeTiles=!1,this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())};var scratchProjectedBoundingSphere=new Cesium.BoundingSphere;function getBoundingVolume(tile,frameState){if(frameState.mode!==Cesium.SceneMode.SCENE3D&&!Cesium.defined(tile._boundingVolume2D)){var boundingSphere=tile._boundingVolume.boundingSphere,sphere=Cesium.BoundingSphere.projectTo2D(boundingSphere,frameState.mapProjection,scratchProjectedBoundingSphere);tile._boundingVolume2D=new Cesium.TileBoundingSphere(sphere.center,sphere.radius)}return frameState.mode!==Cesium.SceneMode.SCENE3D?tile._boundingVolume2D:tile._boundingVolume}function getContentBoundingVolume(tile,frameState){if(frameState.mode!==Cesium.SceneMode.SCENE3D&&!Cesium.defined(tile._contentBoundingVolume2D)){var boundingSphere=tile._contentBoundingVolume.boundingSphere,sphere=Cesium.BoundingSphere.projectTo2D(boundingSphere,frameState.mapProjection,scratchProjectedBoundingSphere);tile._contentBoundingVolume2D=new Cesium.TileBoundingSphere(sphere.center,sphere.radius)}return frameState.mode!==Cesium.SceneMode.SCENE3D?tile._contentBoundingVolume2D:tile._contentBoundingVolume}Cesium3DTile.prototype.visibility=function(frameState,parentVisibilityPlaneMask){var cullingVolume=frameState.cullingVolume,boundingVolume=getBoundingVolume(this,frameState),tileset=this._tileset,clippingPlanes=tileset.clippingPlanes;if(Cesium.defined(clippingPlanes)&&clippingPlanes.enabled){var intersection9=clippingPlanes.computeIntersectionWithBoundingVolume(boundingVolume,tileset.clippingPlanesOriginMatrix);if(this._isClipped=intersection9!==Cesium.Intersect.INSIDE,intersection9===Cesium.Intersect.OUTSIDE)return Cesium.CullingVolume.MASK_OUTSIDE}return cullingVolume.computeVisibilityWithPlaneMask(boundingVolume,parentVisibilityPlaneMask)};Cesium3DTile.prototype.contentVisibility=function(frameState){if(!Cesium.defined(this._contentBoundingVolume)||this._visibilityPlaneMask===Cesium.CullingVolume.MASK_INSIDE)return Cesium.Intersect.INSIDE;var cullingVolume=frameState.cullingVolume,boundingVolume=getContentBoundingVolume(this,frameState),tileset=this._tileset,clippingPlanes=tileset.clippingPlanes;if(Cesium.defined(clippingPlanes)&&clippingPlanes.enabled){var intersection9=clippingPlanes.computeIntersectionWithBoundingVolume(boundingVolume,tileset.clippingPlanesOriginMatrix);if(this._isClipped=intersection9!==Cesium.Intersect.INSIDE,intersection9===Cesium.Intersect.OUTSIDE)return Cesium.Intersect.OUTSIDE}return cullingVolume.computeVisibility(boundingVolume)};Cesium3DTile.prototype.distanceToTile=function(frameState){var boundingVolume=getBoundingVolume(this,frameState);return boundingVolume.distanceToCamera(frameState)};var scratchToTileCenter=new Cesium.Cartesian3;Cesium3DTile.prototype.distanceToTileCenter=function(frameState){var tileBoundingVolume=getBoundingVolume(this,frameState),boundingVolume=tileBoundingVolume.boundingVolume,toCenter=Cesium.Cartesian3.subtract(boundingVolume.center,frameState.camera.positionWC,scratchToTileCenter);return Cesium.Cartesian3.dot(frameState.camera.directionWC,toCenter)};Cesium3DTile.prototype.insideViewerRequestVolume=function(frameState){var viewerRequestVolume=this._viewerRequestVolume;return!Cesium.defined(viewerRequestVolume)||viewerRequestVolume.distanceToCamera(frameState)===0};var scratchMatrix2=new Cesium.Matrix3,scratchScale3=new Cesium.Cartesian3,scratchHalfAxes=new Cesium.Matrix3,scratchCenter=new Cesium.Cartesian3,scratchRectangle=new Cesium.Rectangle,scratchOrientedBoundingBox=new Cesium.OrientedBoundingBox,scratchTransform=new Cesium.Matrix4;function createBox(box,transform3,result){var center2=Cesium.Cartesian3.fromElements(box[0],box[1],box[2],scratchCenter),halfAxes=Cesium.Matrix3.fromArray(box,3,scratchHalfAxes);center2=Cesium.Matrix4.multiplyByPoint(transform3,center2,center2);var rotationScale=Cesium.Matrix4.getMatrix3(transform3,scratchMatrix2);return halfAxes=Cesium.Matrix3.multiply(rotationScale,halfAxes,halfAxes),Cesium.defined(result)?(result.update(center2,halfAxes),result):new Cesium.TileOrientedBoundingBox(center2,halfAxes)}function createBoxFromTransformedRegion(region,transform3,initialTransform,result){var rectangle=Cesium.Rectangle.unpack(region,0,scratchRectangle),minimumHeight=region[4],maximumHeight=region[5],orientedBoundingBox=Cesium.OrientedBoundingBox.fromRectangle(rectangle,minimumHeight,maximumHeight,Cesium.Ellipsoid.WGS84,scratchOrientedBoundingBox),center2=orientedBoundingBox.center,halfAxes=orientedBoundingBox.halfAxes;transform3=Cesium.Matrix4.multiplyTransformation(transform3,Cesium.Matrix4.inverse(initialTransform,scratchTransform),scratchTransform),center2=Cesium.Matrix4.multiplyByPoint(transform3,center2,center2);var rotationScale=Cesium.Matrix4.getMatrix3(transform3,scratchMatrix2);return halfAxes=Cesium.Matrix3.multiply(rotationScale,halfAxes,halfAxes),Cesium.defined(result)&&result instanceof Cesium.TileOrientedBoundingBox?(result.update(center2,halfAxes),result):new Cesium.TileOrientedBoundingBox(center2,halfAxes)}function createRegion(region,transform3,initialTransform,result){if(!Cesium.Matrix4.equalsEpsilon(transform3,initialTransform,Cesium.Math.EPSILON8))return createBoxFromTransformedRegion(region,transform3,initialTransform,result);if(Cesium.defined(result))return result;var rectangleRegion=Cesium.Rectangle.unpack(region,0,scratchRectangle);return new Cesium.TileBoundingRegion({rectangle:rectangleRegion,minimumHeight:region[4],maximumHeight:region[5]})}function createSphere(sphere,transform3,result){var center2=Cesium.Cartesian3.fromElements(sphere[0],sphere[1],sphere[2],scratchCenter),radius=sphere[3];center2=Cesium.Matrix4.multiplyByPoint(transform3,center2,center2);var scale4=Cesium.Matrix4.getScale(transform3,scratchScale3),uniformScale=Cesium.Cartesian3.maximumComponent(scale4);return radius*=uniformScale,Cesium.defined(result)?(result.update(center2,radius),result):new Cesium.TileBoundingSphere(center2,radius)}Cesium3DTile.prototype.createBoundingVolume=function(boundingVolumeHeader,transform3,result){if(!Cesium.defined(boundingVolumeHeader))throw new Cesium.RuntimeError("boundingVolume must be defined");if(Cesium.defined(boundingVolumeHeader.box))return createBox(boundingVolumeHeader.box,transform3,result);if(Cesium.defined(boundingVolumeHeader.region))return createRegion(boundingVolumeHeader.region,transform3,this._initialTransform,result);if(Cesium.defined(boundingVolumeHeader.sphere))return createSphere(boundingVolumeHeader.sphere,transform3,result);throw new Cesium.RuntimeError("boundingVolume must contain a sphere, region, or box")};Cesium3DTile.prototype.updateTransform=function(parentTransform){parentTransform=Cesium.defaultValue(parentTransform,Cesium.Matrix4.IDENTITY);var computedTransform=Cesium.Matrix4.multiply(parentTransform,this.transform,scratchTransform),transformChanged=!Cesium.Matrix4.equals(computedTransform,this.computedTransform);if(!!transformChanged){Cesium.Matrix4.clone(computedTransform,this.computedTransform);var header=this._header,content=this._header.content;this._boundingVolume=this.createBoundingVolume(header.boundingVolume,this.computedTransform,this._boundingVolume),Cesium.defined(this._contentBoundingVolume)&&(this._contentBoundingVolume=this.createBoundingVolume(content.boundingVolume,this.computedTransform,this._contentBoundingVolume)),Cesium.defined(this._viewerRequestVolume)&&(this._viewerRequestVolume=this.createBoundingVolume(header.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)),this.updateGeometricErrorScale(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy()}};Cesium3DTile.prototype.updateGeometricErrorScale=function(){var scale4=Cesium.Matrix4.getScale(this.computedTransform,scratchScale3),uniformScale=Cesium.Cartesian3.maximumComponent(scale4)};function applyDebugSettings2(tile,tileset,frameState,passOptions2){if(!!passOptions2.isRender){var hasContentBoundingVolume=Cesium.defined(tile._header.content)&&Cesium.defined(tile._header.content.boundingVolume),empty=tile.hasEmptyContent||tile.hasTilesetContent,showVolume=tileset.debugShowBoundingVolume||tileset.debugShowContentBoundingVolume&&!hasContentBoundingVolume;if(showVolume){var color;tile._finalResolution?empty?color=Cesium.Color.DARKGRAY:color=Cesium.Color.WHITE:color=Cesium.Color.YELLOW,Cesium.defined(tile._debugBoundingVolume)||(tile._debugBoundingVolume=tile._boundingVolume.createDebugVolume(color)),tile._debugBoundingVolume.update(frameState);var attributes=tile._debugBoundingVolume.getGeometryInstanceAttributes("outline");attributes.color=Cesium.ColorGeometryInstanceAttribute.toValue(color,attributes.color)}else!showVolume&&Cesium.defined(tile._debugBoundingVolume)&&(tile._debugBoundingVolume=tile._debugBoundingVolume.destroy());tileset.debugShowContentBoundingVolume&&hasContentBoundingVolume?(Cesium.defined(tile._debugContentBoundingVolume)||(tile._debugContentBoundingVolume=tile._contentBoundingVolume.createDebugVolume(Cesium.Color.BLUE)),tile._debugContentBoundingVolume.update(frameState)):!tileset.debugShowContentBoundingVolume&&Cesium.defined(tile._debugContentBoundingVolume)&&(tile._debugContentBoundingVolume=tile._debugContentBoundingVolume.destroy()),tileset.debugShowViewerRequestVolume&&Cesium.defined(tile._viewerRequestVolume)?(Cesium.defined(tile._debugViewerRequestVolume)||(tile._debugViewerRequestVolume=tile._viewerRequestVolume.createDebugVolume(Cesium.Color.YELLOW)),tile._debugViewerRequestVolume.update(frameState)):!tileset.debugShowViewerRequestVolume&&Cesium.defined(tile._debugViewerRequestVolume)&&(tile._debugViewerRequestVolume=tile._debugViewerRequestVolume.destroy());var debugColorizeTilesOn=tileset.debugColorizeTiles&&!tile._debugColorizeTiles||Cesium.defined(tileset._heatmap.tilePropertyName),debugColorizeTilesOff=!tileset.debugColorizeTiles&&tile._debugColorizeTiles;debugColorizeTilesOn?(tileset._heatmap.colorize(tile,frameState),tile._debugColorizeTiles=!0,tile.color=tile._debugColor):debugColorizeTilesOff&&(tile._debugColorizeTiles=!1,tile.color=Cesium.Color.WHITE),tile._colorDirty&&(tile._colorDirty=!1,tile._content.applyDebugSettings(!0,tile._color)),debugColorizeTilesOff&&tileset.makeStyleDirty()}}function updateContent(tile,tileset,frameState){var content=tile._content,expiredContent=tile._expiredContent;if(Cesium.defined(expiredContent)){if(!tile.contentReady){expiredContent.update(tileset,frameState);return}tile._expiredContent.destroy(),tile._expiredContent=void 0}content.update(tileset,frameState)}function updateClippingPlanes2(tile,tileset){var clippingPlanes=tileset.clippingPlanes,currentClippingPlanesState=0;Cesium.defined(clippingPlanes)&&tile._isClipped&&clippingPlanes.enabled&&(currentClippingPlanesState=clippingPlanes.clippingPlanesState),currentClippingPlanesState!==tile._clippingPlanesState&&(tile._clippingPlanesState=currentClippingPlanesState,tile.clippingPlanesDirty=!0)}Cesium3DTile.prototype.update=function(tileset,frameState,passOptions2){var initCommandLength=frameState.commandList.length;updateClippingPlanes2(this,tileset),applyDebugSettings2(this,tileset,frameState,passOptions2),updateContent(this,tileset,frameState),this._commandsLength=frameState.commandList.length-initCommandLength,this._labels&&frameState.passes.pick&&this._labels.update(frameState),this.clippingPlanesDirty=!1};var scratchCommandList=[];Cesium3DTile.prototype.process=function(tileset,frameState){var savedCommandList=frameState.commandList;frameState.commandList=scratchCommandList,this._content.update(tileset,frameState),scratchCommandList.length=0,frameState.commandList=savedCommandList};function isolateDigits(normalizedValue,numberOfDigits,leftShift){var scaled=normalizedValue*Math.pow(10,numberOfDigits),integer=parseInt(scaled);return integer*Math.pow(10,leftShift)}function priorityNormalizeAndClamp(value,minimum,maximum){return Math.max(Cesium.Math.normalize(value,minimum,maximum)-Cesium.Math.EPSILON7,0)}Cesium3DTile.prototype.updatePriority=function(){var tileset=this.tileset,preferLeaves=tileset.preferLeaves,minimumPriority=tileset._minimumPriority,maximumPriority=tileset._maximumPriority,digitsForANumber=4,digitsForABoolean=1,preferredSortingLeftShift=0,preferredSortingDigitsCount=digitsForANumber,foveatedLeftShift=preferredSortingLeftShift+preferredSortingDigitsCount,foveatedDigitsCount=digitsForANumber,preloadProgressiveResolutionLeftShift=foveatedLeftShift+foveatedDigitsCount,preloadProgressiveResolutionDigitsCount=digitsForABoolean,preloadProgressiveResolutionScale=Math.pow(10,preloadProgressiveResolutionLeftShift),foveatedDeferLeftShift=preloadProgressiveResolutionLeftShift+preloadProgressiveResolutionDigitsCount,foveatedDeferDigitsCount=digitsForABoolean,foveatedDeferScale=Math.pow(10,foveatedDeferLeftShift),preloadFlightLeftShift=foveatedDeferLeftShift+foveatedDeferDigitsCount,preloadFlightScale=Math.pow(10,preloadFlightLeftShift),depthDigits=priorityNormalizeAndClamp(this._depth,minimumPriority.depth,maximumPriority.depth);depthDigits=preferLeaves?1-depthDigits:depthDigits;var useDistance=!tileset._skipLevelOfDetail&&this.refine===Cesium.Cesium3DTileRefine.REPLACE,normalizedPreferredSorting=useDistance?priorityNormalizeAndClamp(this._priorityHolder._distanceToCamera,minimumPriority.distance,maximumPriority.distance):priorityNormalizeAndClamp(this._priorityReverseScreenSpaceError,minimumPriority.reverseScreenSpaceError,maximumPriority.reverseScreenSpaceError),preferredSortingDigits=isolateDigits(normalizedPreferredSorting,preferredSortingDigitsCount,preferredSortingLeftShift),preloadProgressiveResolutionDigits=this._priorityProgressiveResolution?0:preloadProgressiveResolutionScale,normalizedFoveatedFactor=priorityNormalizeAndClamp(this._priorityHolder._foveatedFactor,minimumPriority.foveatedFactor,maximumPriority.foveatedFactor),foveatedDigits=isolateDigits(normalizedFoveatedFactor,foveatedDigitsCount,foveatedLeftShift),foveatedDeferDigits=this.priorityDeferred?foveatedDeferScale:0,preloadFlightDigits=tileset._pass===Cesium.Cesium3DTilePass.PRELOAD_FLIGHT?0:preloadFlightScale;this._priority=depthDigits+preferredSortingDigits+preloadProgressiveResolutionDigits+foveatedDigits+foveatedDeferDigits+preloadFlightDigits};Cesium3DTile.prototype.isDestroyed=function(){return!1};Cesium3DTile.prototype.destroy=function(){return this._content=this._content&&this._content.destroy(),this._expiredContent=this._expiredContent&&!this._expiredContent.isDestroyed()&&this._expiredContent.destroy(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy(),this.sharedResources.instancedPrograms=void 0,this.sharedResources.ktxs=void 0,Cesium.destroyObject(this)};var Cesium3DTile_default=Cesium3DTile;/**
  @license
  fontmetrics.js - https://github.com/Pomax/fontmetrics.js

  Copyright (C) 2011 by Mike "Pomax" Kamermans

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to deal
  in the Software without restriction, including without limitation the rights
  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
  THE SOFTWARE.
**/var getCSSValue=function(element,property){return document.defaultView.getComputedStyle(element,null).getPropertyValue(property)},measureText=function(context2D,textstring,stroke,fill){var metrics=context2D.measureText(textstring),fontFamily=getCSSValue(context2D.canvas,"font-family"),fontSize=getCSSValue(context2D.canvas,"font-size").replace("px",""),fontStyle=getCSSValue(context2D.canvas,"font-style"),fontWeight=getCSSValue(context2D.canvas,"font-weight"),isSpace=!/\S/.test(textstring);metrics.fontsize=fontSize;var leadDiv=document.createElement("div");leadDiv.style.position="absolute",leadDiv.style.opacity=0,leadDiv.style.font=fontStyle+" "+fontWeight+" "+fontSize+"px "+fontFamily,leadDiv.innerHTML=textstring+"<br/>"+textstring,document.body.appendChild(leadDiv),metrics.leading=1.2*fontSize;var leadDivHeight=getCSSValue(leadDiv,"height");if(leadDivHeight=leadDivHeight.replace("px",""),leadDivHeight>=fontSize*2&&(metrics.leading=leadDivHeight/2|0),document.body.removeChild(leadDiv),isSpace)metrics.ascent=0,metrics.descent=0,metrics.bounds={minx:0,maxx:metrics.width,miny:0,maxy:0},metrics.height=0;else{var canvas=document.createElement("canvas"),padding=100;canvas.width=metrics.width+padding,canvas.height=3*fontSize,canvas.style.opacity=1,canvas.style.fontFamily=fontFamily,canvas.style.fontSize=fontSize,canvas.style.fontStyle=fontStyle,canvas.style.fontWeight=fontWeight;var ctx=canvas.getContext("2d");ctx.font=fontStyle+" "+fontWeight+" "+fontSize+"px "+fontFamily;var w=canvas.width,h=canvas.height,baseline=h/2;ctx.fillStyle="white",ctx.fillRect(-1,-1,w+2,h+2),stroke&&(ctx.strokeStyle="black",ctx.lineWidth=context2D.lineWidth,ctx.strokeText(textstring,padding/2,baseline)),fill&&(ctx.fillStyle="black",ctx.fillText(textstring,padding/2,baseline));for(var pixelData=ctx.getImageData(0,0,w,h).data,i=0,w4=w*4,len=pixelData.length;++i<len&&pixelData[i]===255;);var ascent=i/w4|0;for(i=len-1;--i>0&&pixelData[i]===255;);var descent=i/w4|0;for(i=0;i<len&&pixelData[i]===255;)i+=w4,i>=len&&(i=i-len+4);var minx=i%w4/4|0,step=1;for(i=len-3;i>=0&&pixelData[i]===255;)i-=w4,i<0&&(i=len-3-step++*4);var maxx=i%w4/4+1|0;metrics.ascent=baseline-ascent,metrics.descent=descent-baseline,metrics.bounds={minx:minx-padding/2,maxx:maxx-padding/2,miny:0,maxy:descent-ascent},metrics.height=1+(descent-ascent)}return metrics},measureText_default=measureText;function Cesium3DTilesetTraversal(){}function isVisible(tile){return tile._visible&&tile._inRequestVolume}var traversal={stack:new Cesium.ManagedArray,stackMaximumLength:0},emptyTraversal={stack:new Cesium.ManagedArray,stackMaximumLength:0},descendantTraversal={stack:new Cesium.ManagedArray,stackMaximumLength:0},selectionTraversal={stack:new Cesium.ManagedArray,stackMaximumLength:0,ancestorStack:new Cesium.ManagedArray,ancestorStackMaximumLength:0},descendantSelectionDepth=2;Cesium3DTilesetTraversal.selectTiles=function(tileset,frameState){if(tileset._requestedTiles.length=0,tileset.debugFreezeFrame)return;tileset._selectedTiles.length=0,tileset._selectedTilesToStyle.length=0,tileset._emptyTiles.length=0,tileset._hasMixedContent=!1;let root=tileset.root;if(updateTile(tileset,root,frameState),!isVisible(root)||root.getScreenSpaceError(frameState,!0)<=tileset._maximumScreenSpaceError)return;skipLevelOfDetail(tileset)?tileset.immediatelyLoadDesiredLevelOfDetail?executeSkipTraversal(tileset,root,frameState):executeBaseAndSkipTraversal(tileset,root,frameState):executeBaseTraversal(tileset,root,frameState),traversal.stack.trim(traversal.stackMaximumLength),emptyTraversal.stack.trim(emptyTraversal.stackMaximumLength),descendantTraversal.stack.trim(descendantTraversal.stackMaximumLength),selectionTraversal.stack.trim(selectionTraversal.stackMaximumLength),selectionTraversal.ancestorStack.trim(selectionTraversal.ancestorStackMaximumLength);let requestedTiles=tileset._requestedTiles,length3=requestedTiles.length;for(let i=0;i<length3;++i)requestedTiles[i].updatePriority()};function executeBaseTraversal(tileset,root,frameState){let baseScreenSpaceError=tileset._maximumScreenSpaceError,maximumScreenSpaceError=tileset._maximumScreenSpaceError;executeTraversal(tileset,root,baseScreenSpaceError,maximumScreenSpaceError,frameState)}function executeSkipTraversal(tileset,root,frameState){let baseScreenSpaceError=Number.MAX_VALUE,maximumScreenSpaceError=tileset._maximumScreenSpaceError;executeTraversal(tileset,root,baseScreenSpaceError,maximumScreenSpaceError,frameState),traverseAndSelect(tileset,root,frameState)}function executeBaseAndSkipTraversal(tileset,root,frameState){let baseScreenSpaceError=Math.max(tileset.baseScreenSpaceError,tileset.maximumScreenSpaceError),maximumScreenSpaceError=tileset.maximumScreenSpaceError;executeTraversal(tileset,root,baseScreenSpaceError,maximumScreenSpaceError,frameState),traverseAndSelect(tileset,root,frameState)}function skipLevelOfDetail(tileset){return tileset._skipLevelOfDetail}function addEmptyTile(tileset,tile){tileset._emptyTiles.push(tile)}function selectTile(tileset,tile,frameState){if(tile.contentVisibility(frameState)!==Cesium.Intersect.OUTSIDE){let tileContent=tile.content;tileContent.featurePropertiesDirty?(tileContent.featurePropertiesDirty=!1,tile.lastStyleTime=0,tileset._selectedTilesToStyle.push(tile)):tile._selectedFrame<frameState.frameNumber-1&&tileset._selectedTilesToStyle.push(tile),tile._selectedFrame=frameState.frameNumber,tileset._selectedTiles.push(tile)}}function selectDescendants(tileset,root,frameState){let stack=descendantTraversal.stack;for(stack.push(root);stack.length>0;){descendantTraversal.stackMaximumLength=Math.max(descendantTraversal.stackMaximumLength,stack.length);let children=stack.pop().children,childrenLength=children.length;for(let i=0;i<childrenLength;++i){let child=children[i];isVisible(child)&&(child.contentAvailable?(updateTile(tileset,child,frameState),touchTile(tileset,child,frameState),selectTile(tileset,child,frameState)):child._depth-root._depth<descendantSelectionDepth&&stack.push(child))}}}function selectDesiredTile(tileset,tile,frameState){if(!skipLevelOfDetail(tileset)){tile.contentAvailable&&selectTile(tileset,tile,frameState);return}let loadedTile=tile.contentAvailable?tile:tile._ancestorWithContentAvailable;Cesium.defined(loadedTile)?loadedTile._shouldSelect=!0:selectDescendants(tileset,tile,frameState)}function visitTile(tileset,tile,frameState){++tileset._statistics.visited,tile._visitedFrame=frameState.frameNumber}function touchTile(tileset,tile,frameState){tile._touchedFrame!==frameState.frameNumber&&(tileset._cache.touch(tile),tile._touchedFrame=frameState.frameNumber)}function updateMinimumMaximumPriority(tileset,tile){tileset._maximumPriority.distance=Math.max(tile._priorityHolder._distanceToCamera,tileset._maximumPriority.distance),tileset._minimumPriority.distance=Math.min(tile._priorityHolder._distanceToCamera,tileset._minimumPriority.distance),tileset._maximumPriority.depth=Math.max(tile._depth,tileset._maximumPriority.depth),tileset._minimumPriority.depth=Math.min(tile._depth,tileset._minimumPriority.depth),tileset._maximumPriority.foveatedFactor=Math.max(tile._priorityHolder._foveatedFactor,tileset._maximumPriority.foveatedFactor),tileset._minimumPriority.foveatedFactor=Math.min(tile._priorityHolder._foveatedFactor,tileset._minimumPriority.foveatedFactor),tileset._maximumPriority.reverseScreenSpaceError=Math.max(tile._priorityReverseScreenSpaceError,tileset._maximumPriority.reverseScreenSpaceError),tileset._minimumPriority.reverseScreenSpaceError=Math.min(tile._priorityReverseScreenSpaceError,tileset._minimumPriority.reverseScreenSpaceError)}function isOnScreenLongEnough(tileset,tile,frameState){if(!tileset._cullRequestsWhileMoving)return!0;let sphere=tile.boundingSphere,diameter=Math.max(sphere.radius*2,1),camera=frameState.camera,deltaMagnitude=camera.positionWCDeltaMagnitude!==0?camera.positionWCDeltaMagnitude:camera.positionWCDeltaMagnitudeLastFrame;return tileset.cullRequestsWhileMovingMultiplier*deltaMagnitude/diameter<1}function loadTile(tileset,tile,frameState){if(tile._requestedFrame===frameState.frameNumber||!hasUnloadedContent(tile)&&!tile.contentExpired||!isOnScreenLongEnough(tileset,tile,frameState))return;let cameraHasNotStoppedMovingLongEnough=frameState.camera.timeSinceMoved<tileset.foveatedTimeDelay;tile.priorityDeferred&&cameraHasNotStoppedMovingLongEnough||(tile._requestedFrame=frameState.frameNumber,tileset._requestedTiles.push(tile))}function updateVisibility(tileset,tile,frameState){tile._updatedVisibilityFrame!==tileset._updatedVisibilityFrame&&(tile.updateVisibility(frameState),tile._updatedVisibilityFrame=tileset._updatedVisibilityFrame)}function anyChildrenVisible(tileset,tile,frameState){let anyVisible=!1,children=tile.children,length3=children.length;for(let i=0;i<length3;++i){let child=children[i];updateVisibility(tileset,child,frameState),anyVisible=anyVisible||isVisible(child)}return anyVisible}function meetsScreenSpaceErrorEarly(tileset,tile,frameState){let parent=tile.parent;return!Cesium.defined(parent)||parent.hasTilesetContent||parent.hasImplicitContent||parent.refine!==Cesium.Cesium3DTileRefine.ADD?!1:tile.getScreenSpaceError(frameState,!0)<=tileset._maximumScreenSpaceError}function updateTileVisibility(tileset,tile,frameState){if(updateVisibility(tileset,tile,frameState),!isVisible(tile))return;let hasChildren=tile.children.length>0;if((tile.hasTilesetContent||tile.hasImplicitContent)&&hasChildren){let child=tile.children[0];updateTileVisibility(tileset,child,frameState),tile._visible=child._visible;return}if(meetsScreenSpaceErrorEarly(tileset,tile,frameState)){tile._visible=!1;return}let replace=tile.refine===Cesium.Cesium3DTileRefine.REPLACE,useOptimization=tile._optimChildrenWithinParent===Cesium.Cesium3DTileOptimizationHint.USE_OPTIMIZATION;if(replace&&useOptimization&&hasChildren&&!anyChildrenVisible(tileset,tile,frameState)){++tileset._statistics.numberOfTilesCulledWithChildrenUnion,tile._visible=!1;return}}function updateTile(tileset,tile,frameState){updateTileVisibility(tileset,tile,frameState),tile.updateExpiration(),tile._wasMinPriorityChild=!1,tile._priorityHolder=tile,updateMinimumMaximumPriority(tileset,tile),tile._shouldSelect=!1,tile._finalResolution=!0}function updateTileAncestorContentLinks(tile,frameState){tile._ancestorWithContent=void 0,tile._ancestorWithContentAvailable=void 0;let parent=tile.parent;if(Cesium.defined(parent)){let hasContent=!hasUnloadedContent(parent)||parent._requestedFrame===frameState.frameNumber;tile._ancestorWithContent=hasContent?parent:parent._ancestorWithContent,tile._ancestorWithContentAvailable=parent.contentAvailable?parent:parent._ancestorWithContentAvailable}}function hasEmptyContent(tile){return tile.hasEmptyContent||tile.hasTilesetContent||tile.hasImplicitContent}function hasUnloadedContent(tile){return!hasEmptyContent(tile)&&tile.contentUnloaded}function reachedSkippingThreshold(tileset,tile){let ancestor=tile._ancestorWithContent;return!tileset.immediatelyLoadDesiredLevelOfDetail&&(tile._priorityProgressiveResolutionScreenSpaceErrorLeaf||Cesium.defined(ancestor)&&tile._screenSpaceError<ancestor._screenSpaceError/tileset.skipScreenSpaceErrorFactor&&tile._depth>ancestor._depth+tileset.skipLevels)}function sortChildrenByDistanceToCamera(a,b){return b._distanceToCamera===0&&a._distanceToCamera===0?b._centerZDepth-a._centerZDepth:b._distanceToCamera-a._distanceToCamera}function updateAndPushChildren(tileset,tile,stack,frameState){let i,replace=tile.refine===Cesium.Cesium3DTileRefine.REPLACE,children=tile.children,length3=children.length;for(i=0;i<length3;++i)updateTile(tileset,children[i],frameState);children.sort(sortChildrenByDistanceToCamera);let checkRefines=!skipLevelOfDetail(tileset)&&replace&&!hasEmptyContent(tile),refines=!0,anyChildrenVisible2=!1,minIndex=-1,minimumPriority=Number.MAX_VALUE,child;for(i=0;i<length3;++i)if(child=children[i],isVisible(child)?(stack.push(child),child._foveatedFactor<minimumPriority&&(minIndex=i,minimumPriority=child._foveatedFactor),anyChildrenVisible2=!0):(checkRefines||tileset.loadSiblings)&&(child._foveatedFactor<minimumPriority&&(minIndex=i,minimumPriority=child._foveatedFactor),loadTile(tileset,child,frameState),touchTile(tileset,child,frameState)),checkRefines){let childRefines;child._inRequestVolume?hasEmptyContent(child)?childRefines=executeEmptyTraversal(tileset,child,frameState):childRefines=child.contentAvailable:childRefines=!1,refines=refines&&childRefines}if(anyChildrenVisible2||(refines=!1),minIndex!==-1&&!skipLevelOfDetail(tileset)&&replace){let minPriorityChild=children[minIndex];minPriorityChild._wasMinPriorityChild=!0;let priorityHolder=(tile._wasMinPriorityChild||tile===tileset.root)&&minimumPriority<=tile._priorityHolder._foveatedFactor?tile._priorityHolder:tile;for(priorityHolder._foveatedFactor=Math.min(minPriorityChild._foveatedFactor,priorityHolder._foveatedFactor),priorityHolder._distanceToCamera=Math.min(minPriorityChild._distanceToCamera,priorityHolder._distanceToCamera),i=0;i<length3;++i)child=children[i],child._priorityHolder=priorityHolder}return refines}function inBaseTraversal(tileset,tile,baseScreenSpaceError){return skipLevelOfDetail(tileset)?tileset.immediatelyLoadDesiredLevelOfDetail?!1:Cesium.defined(tile._ancestorWithContent)?tile._screenSpaceError===0?tile.parent._screenSpaceError>baseScreenSpaceError:tile._screenSpaceError>baseScreenSpaceError:!0:!0}function canTraverse(tileset,tile){return tile.children.length===0?!1:tile.hasTilesetContent||tile.hasImplicitContent?!tile.contentExpired:tile._screenSpaceError>tileset._maximumScreenSpaceError}function executeTraversal(tileset,root,baseScreenSpaceError,maximumScreenSpaceError,frameState){let stack=traversal.stack;for(stack.push(root);stack.length>0;){traversal.stackMaximumLength=Math.max(traversal.stackMaximumLength,stack.length);let tile=stack.pop();updateTileAncestorContentLinks(tile,frameState);let baseTraversal=inBaseTraversal(tileset,tile,baseScreenSpaceError),add16=tile.refine===Cesium.Cesium3DTileRefine.ADD,replace=tile.refine===Cesium.Cesium3DTileRefine.REPLACE,parent=tile.parent,parentRefines=!Cesium.defined(parent)||parent._refines,refines=!1;canTraverse(tileset,tile)&&(refines=updateAndPushChildren(tileset,tile,stack,frameState)&&parentRefines);let stoppedRefining=!refines&&parentRefines;hasEmptyContent(tile)?(addEmptyTile(tileset,tile,frameState),loadTile(tileset,tile,frameState),stoppedRefining&&selectDesiredTile(tileset,tile,frameState)):add16?(selectDesiredTile(tileset,tile,frameState),loadTile(tileset,tile,frameState)):replace&&(baseTraversal?(loadTile(tileset,tile,frameState),stoppedRefining&&selectDesiredTile(tileset,tile,frameState)):stoppedRefining?(selectDesiredTile(tileset,tile,frameState),loadTile(tileset,tile,frameState)):reachedSkippingThreshold(tileset,tile)&&loadTile(tileset,tile,frameState)),visitTile(tileset,tile,frameState),touchTile(tileset,tile,frameState),tile._refines=refines}}function executeEmptyTraversal(tileset,root,frameState){let allDescendantsLoaded=!0,stack=emptyTraversal.stack;for(stack.push(root);stack.length>0;){emptyTraversal.stackMaximumLength=Math.max(emptyTraversal.stackMaximumLength,stack.length);let tile=stack.pop(),children=tile.children,childrenLength=children.length,emptyContent=hasEmptyContent(tile),traverse=emptyContent&&canTraverse(tileset,tile),emptyLeaf=emptyContent&&tile.children.length===0;if(!traverse&&!tile.contentAvailable&&!emptyLeaf&&(allDescendantsLoaded=!1),updateTile(tileset,tile,frameState),isVisible(tile)||(loadTile(tileset,tile,frameState),touchTile(tileset,tile,frameState)),traverse)for(let i=0;i<childrenLength;++i){let child=children[i];stack.push(child)}}return allDescendantsLoaded}function traverseAndSelect(tileset,root,frameState){let stack=selectionTraversal.stack,ancestorStack=selectionTraversal.ancestorStack,lastAncestor;for(stack.push(root);stack.length>0||ancestorStack.length>0;){if(selectionTraversal.stackMaximumLength=Math.max(selectionTraversal.stackMaximumLength,stack.length),selectionTraversal.ancestorStackMaximumLength=Math.max(selectionTraversal.ancestorStackMaximumLength,ancestorStack.length),ancestorStack.length>0){let waitingTile=ancestorStack.peek();if(waitingTile._stackLength===stack.length){ancestorStack.pop(),waitingTile!==lastAncestor&&(waitingTile._finalResolution=!1),selectTile(tileset,waitingTile,frameState);continue}}let tile=stack.pop();if(!Cesium.defined(tile))continue;let add16=tile.refine===Cesium.Cesium3DTileRefine.ADD,shouldSelect=tile._shouldSelect,children=tile.children,childrenLength=children.length,traverse=canTraverse(tileset,tile);if(shouldSelect&&selectTile(tileset,tile,frameState),traverse)for(let i=0;i<childrenLength;++i){let child=children[i];isVisible(child)&&stack.push(child)}}}var Cesium3DTilesetTraversal_default=Cesium3DTilesetTraversal;var Cesium3DTilePass={RENDER:0,PICK:1,SHADOW:2,PRELOAD:3,PRELOAD_FLIGHT:4,REQUEST_RENDER_MODE_DEFER_CHECK:5,MOST_DETAILED_PRELOAD:6,MOST_DETAILED_PICK:7,NUMBER_OF_PASSES:8},passOptions=new Array(Cesium3DTilePass.NUMBER_OF_PASSES);passOptions[Cesium3DTilePass.RENDER]=Object.freeze({traversal:Cesium3DTilesetTraversal_default,isRender:!0,requestTiles:!0,ignoreCommands:!1});passOptions[Cesium3DTilePass.PICK]=Object.freeze({traversal:Cesium3DTilesetTraversal_default,isRender:!1,requestTiles:!1,ignoreCommands:!1});passOptions[Cesium3DTilePass.SHADOW]=Object.freeze({traversal:Cesium3DTilesetTraversal_default,isRender:!1,requestTiles:!0,ignoreCommands:!1});passOptions[Cesium3DTilePass.PRELOAD]=Object.freeze({traversal:Cesium3DTilesetTraversal_default,isRender:!1,requestTiles:!0,ignoreCommands:!0});passOptions[Cesium3DTilePass.PRELOAD_FLIGHT]=Object.freeze({traversal:Cesium3DTilesetTraversal_default,isRender:!1,requestTiles:!0,ignoreCommands:!0});passOptions[Cesium3DTilePass.REQUEST_RENDER_MODE_DEFER_CHECK]=Object.freeze({traversal:Cesium3DTilesetTraversal_default,isRender:!1,requestTiles:!0,ignoreCommands:!0});passOptions[Cesium3DTilePass.MOST_DETAILED_PRELOAD]=Object.freeze({traversal:Cesium.Cesium3DTilesetMostDetailedTraversal,isRender:!1,requestTiles:!0,ignoreCommands:!0});passOptions[Cesium3DTilePass.MOST_DETAILED_PICK]=Object.freeze({traversal:Cesium.Cesium3DTilesetMostDetailedTraversal,isRender:!1,requestTiles:!1,ignoreCommands:!1});Cesium3DTilePass.getPassOptions=function(pass){return passOptions[pass]};var Cesium3DTilePass_default=Object.freeze(Cesium3DTilePass);function Cesium3DTileset(options){options=Cesium.defaultValue(options,Cesium.defaultValue.EMPTY_OBJECT),this._url=void 0,this._basePath=void 0,this._root=void 0,this._asset=void 0,this._properties=void 0,this._geometricError=void 0,this._extensionsUsed=void 0,this._extensions=void 0,this._gltfUpAxis=void 0,this._cache=new Cesium.Cesium3DTilesetCache,this._processingQueue=[],this._selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._loadTimestamp=void 0,this._timeSinceLoad=0,this._updatedVisibilityFrame=0,this._updatedModelMatrixFrame=0,this._modelMatrixChanged=!1,this._previousModelMatrix=void 0,this._extras=void 0,this._credits=void 0,this._imagesSourceBuf=void 0,this._cullWithChildrenBounds=Cesium.defaultValue(options.cullWithChildrenBounds,!0),this._allTilesAdditive=!0,this._tilesetFlat=Cesium.defaultValue(options.tilesetFlat,void 0),this._hasMixedContent=!1,this._stencilClearCommand=void 0,this._backfaceCommands=new Cesium.ManagedArray,this._maximumScreenSpaceError=Cesium.defaultValue(options.maximumScreenSpaceError,16),this._maximumMemoryUsage=Cesium.defaultValue(options.maximumMemoryUsage,512),this._useStencilProcess=Cesium.defaultValue(options.useStencilProcess,!1),this._styleEngine=new Cesium.Cesium3DTileStyleEngine,this._modelMatrix=Cesium.defined(options.modelMatrix)?Cesium.Matrix4.clone(options.modelMatrix):Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._statistics=new Cesium.Cesium3DTilesetStatistics,this._statisticsLast=new Cesium.Cesium3DTilesetStatistics,this._statisticsPerPass=new Array(Cesium3DTilePass_default.NUMBER_OF_PASSES);for(var i=0;i<Cesium3DTilePass_default.NUMBER_OF_PASSES;++i)this._statisticsPerPass[i]=new Cesium.Cesium3DTilesetStatistics;this._requestedTilesInFlight=[],this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE},this._heatmap=new Cesium.Cesium3DTilesetHeatmap(options.debugHeatmapTilePropertyName),this.cullRequestsWhileMoving=Cesium.defaultValue(options.cullRequestsWhileMoving,!0),this._cullRequestsWhileMoving=!1,this.cullRequestsWhileMovingMultiplier=Cesium.defaultValue(options.cullRequestsWhileMovingMultiplier,60),this.progressiveResolutionHeightFraction=Cesium.Math.clamp(Cesium.defaultValue(options.progressiveResolutionHeightFraction,.3),0,.5),this.preferLeaves=Cesium.defaultValue(options.preferLeaves,!1),this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._tileDebugLabels=void 0,this._readyPromise=when_default.defer(),this._classificationType=options.classificationType,this._ellipsoid=Cesium.defaultValue(options.ellipsoid,Cesium.Ellipsoid.WGS84),this._initialClippingPlanesOriginMatrix=Cesium.Matrix4.IDENTITY,this._clippingPlanesOriginMatrix=void 0,this._clippingPlanesOriginMatrixDirty=!0,this._geoErrorRatio=Cesium.defaultValue(options.geoErrorRatio,1),this.EVDataSetName=void 0,this._distance=Cesium.defaultValue(options.distance,void 0),this._height=Cesium.defaultValue(options.height,void 0),this.rollerRegion=new Cesium.Cartesian4(0,0,1,1),this._distanceLimit=Cesium.defaultValue(options.distanceLimit,void 0),this._maxHeight=Cesium.defaultValue(options.maxHeight,void 0),this._minHeight=Cesium.defaultValue(options.minHeight,void 0),this._airDataShowNameCount=Cesium.defaultValue(options.airDataShowNameCount,void 0),this._annotationLabel=options.annotationLabel,Cesium.defined(this._annotationLabel)||(this._annotationLabel={font:"30px sans-serif",fillColor:Cesium.Color.WHITE,outlineColor:Cesium.Color.RED,disableDepthTestDistance:Number.POSITIVE_INFINITY,outlineWidth:5,style:Cesium.LabelStyle.FILL_AND_OUTLINE}),this._airWidth=options.airWidth,this._material=options.material,this._disableDepthTestDistance=options.disableDepthTestDistance,this.gltfShader={},this._startListener=void 0,this._stopListener=void 0,this._timer=void 0,this._useElevation=Cesium.defaultValue(options.useElevation,!1);var elevationMap={elevationRamp:[0,.045,.1,.15,.37,.54,1],colorRamp:["rgba(0,0,0,1)","rgba(39,71,224,1)","rgba(211,59,125,1)","rgba(211,48,56,1)","rgba(255,151,66,1)","rgba(255,215,0,1)","rgba(255,255,255,1)"]};this._elevationMap=Cesium.defaultValue(options.elevationMap,elevationMap),this.reduceRequest=Cesium.defaultValue(options.reduceRequest,!0),this.enableUndergroundDataDistance=Cesium.defaultValue(options.enableUndergroundDataDistance,!1),this.undergroundDataDistance=void 0,this.enableUndergroundDataDistance&&(this.undergroundDataDistance=Cesium.defaultValue(options.undergroundDataDistance,300)),this.specular=Cesium.defaultValue(options.specular,.5),this.gradual=options.gradual,this.preloadWhenHidden=Cesium.defaultValue(options.preloadWhenHidden,!1),this.preloadFlightDestinations=Cesium.defaultValue(options.preloadFlightDestinations,!0),this._pass=void 0,this.dynamicScreenSpaceError=Cesium.defaultValue(options.dynamicScreenSpaceError,!1),this.foveatedScreenSpaceError=Cesium.defaultValue(options.foveatedScreenSpaceError,!0),this._foveatedConeSize=Cesium.defaultValue(options.foveatedConeSize,.1),this._foveatedMinimumScreenSpaceErrorRelaxation=Cesium.defaultValue(options.foveatedMinimumScreenSpaceErrorRelaxation,0),this.foveatedInterpolationCallback=Cesium.defaultValue(options.foveatedInterpolationCallback,Cesium.Math.lerp),this.foveatedTimeDelay=Cesium.defaultValue(options.foveatedTimeDelay,.2),this.dynamicScreenSpaceErrorDensity=.00278,this.dynamicScreenSpaceErrorFactor=4,this.dynamicScreenSpaceErrorHeightFalloff=.25,this._dynamicScreenSpaceErrorComputedDensity=0,this.shadows=Cesium.defaultValue(options.shadows,Cesium.ShadowMode.ENABLED),this.show=Cesium.defaultValue(options.show,!0),this.colorBlendMode=Cesium.Cesium3DTileColorBlendMode.REPLACE,this.colorBlendAmount=.5,this.pointCloudShading=new Cesium.PointCloudShading(options.pointCloudShading),this._pointCloudEyeDomeLighting=new Cesium.PointCloudEyeDomeLighting,this.loadProgress=new Cesium.Event,this.loadedTreeTables=new Cesium.Event,this.allTilesLoaded=new Cesium.Event,this.initialTilesLoaded=new Cesium.Event,this.tileLoad=new Cesium.Event,this.tileUnload=new Cesium.Event,this.tileFailed=new Cesium.Event,this.tileVisible=new Cesium.Event,this.skipLevelOfDetail=Cesium.defaultValue(options.skipLevelOfDetail,!0),this._skipLevelOfDetail=this.skipLevelOfDetail,this._disableSkipLevelOfDetail=!1,this.baseScreenSpaceError=Cesium.defaultValue(options.baseScreenSpaceError,1024),this.skipScreenSpaceErrorFactor=Cesium.defaultValue(options.skipScreenSpaceErrorFactor,16),this.skipLevels=Cesium.defaultValue(options.skipLevels,1),this.immediatelyLoadDesiredLevelOfDetail=Cesium.defaultValue(options.immediatelyLoadDesiredLevelOfDetail,!1),this.loadSiblings=Cesium.defaultValue(options.loadSiblings,!1),this._clippingPlanes=void 0,this.clippingPlanes=options.clippingPlanes,this._imageBasedLightingFactor=new Cesium.Cartesian2(1,1),Cesium.Cartesian2.clone(options.imageBasedLightingFactor,this._imageBasedLightingFactor),this.lightColor=options.lightColor,this.luminanceAtZenith=Cesium.defaultValue(options.luminanceAtZenith,.2),this.sphericalHarmonicCoefficients=options.sphericalHarmonicCoefficients,this.specularEnvironmentMaps=options.specularEnvironmentMaps,this.debugFreezeFrame=Cesium.defaultValue(options.debugFreezeFrame,!1),this.debugColorizeTiles=Cesium.defaultValue(options.debugColorizeTiles,!1),this.debugWireframe=Cesium.defaultValue(options.debugWireframe,!1),this.debugShowBoundingVolume=Cesium.defaultValue(options.debugShowBoundingVolume,!1),this.debugShowContentBoundingVolume=Cesium.defaultValue(options.debugShowContentBoundingVolume,!1),this.debugShowViewerRequestVolume=Cesium.defaultValue(options.debugShowViewerRequestVolume,!1),this._tileDebugLabels=void 0,this.debugPickedTileLabelOnly=!1,this.debugPickedTile=void 0,this.debugPickPosition=void 0,this.debugShowGeometricError=Cesium.defaultValue(options.debugShowGeometricError,!1),this.debugShowRenderingStatistics=Cesium.defaultValue(options.debugShowRenderingStatistics,!1),this.debugShowMemoryUsage=Cesium.defaultValue(options.debugShowMemoryUsage,!1),this.debugShowUrl=Cesium.defaultValue(options.debugShowUrl,!1),this.position=Cesium.defaultValue(options.position,void 0),this.headingPitchRoll=Cesium.defaultValue(options.headingPitchRoll,void 0),this.scale=Cesium.defaultValue(options.scale,void 0),this.useIndexedDBCache=Cesium.defaultValue(options.useIndexedDBCache,!1),this.sharedResources={treeTables:{},instancedPrograms:{},ktxs:{}},this.treeTableMaps=[],this.selectedTiles=void 0,this._customTag=options.customTag;var that=this,resource2;when_default.all([getImagesSourceBuf(options.imageUrl),options.url]).then(function(paramArr){that._imagesSourceBuf=paramArr[0];var basePath;return resource2=Cesium.Resource.createIfNeeded(paramArr[1]),resource2._queryParameters.fileName&&(resource2._url+=resource2._queryParameters.fileName),that._credits=resource2.credits,resource2.extension==="json"?basePath=resource2.getBaseUri(!0):resource2.isDataUri&&(basePath=""),that._url=resource2.url,that._basePath=basePath,Cesium3DTileset.loadJson(resource2)}).then(function(tilesetJson){Cesium.defined(options.versionValue)&&options.versionValue>7e3&&(resource2.url=options.mongoUrl,that._url=resource2.url),that._root=that.loadTileset(resource2,tilesetJson);var gltfUpAxis=Cesium.defined(tilesetJson.asset.gltfUpAxis)?Cesium.Axis.fromName(tilesetJson.asset.gltfUpAxis):Cesium.Axis.Y,asset=tilesetJson.asset;that._asset=asset,that._properties=tilesetJson.properties,that._geometricError=tilesetJson.geometricError,that._geometricError*=that._geoErrorRatio,that._extensionsUsed=tilesetJson.extensionsUsed,that._extensions=tilesetJson.extensions,that._gltfUpAxis=gltfUpAxis,that._extras=tilesetJson.extras,that.EVDataSetName=tilesetJson.EVDataSetName,tilesetJson.elevationRange&&(that.elevationMin=tilesetJson.elevationRange[0],that.elevationMax=tilesetJson.elevationRange[1]);var extras=asset.extras;if(Cesium.defined(extras)&&Cesium.defined(extras.cesium)&&Cesium.defined(extras.cesium.credits)){var extraCredits=extras.cesium.credits,credits=that._credits;Cesium.defined(credits)||(credits=[],that._credits=credits);for(var i2=0;i2<extraCredits.length;++i2){var credit=extraCredits[i2];credits.push(new Cesium.Credit(credit.html,credit.showOnScreen))}}var boundingVolume=that._root.createBoundingVolume(tilesetJson.root.boundingVolume,Cesium.Matrix4.IDENTITY),clippingPlanesOrigin=boundingVolume.boundingSphere.center,originCartographic=that._ellipsoid.cartesianToCartographic(clippingPlanesOrigin);Cesium.defined(originCartographic)&&originCartographic.height>Cesium.ApproximateTerrainHeights._defaultMinTerrainHeight&&(that._initialClippingPlanesOriginMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(clippingPlanesOrigin)),that._clippingPlanesOriginMatrix=Cesium.Matrix4.clone(that._initialClippingPlanesOriginMatrix),that._readyPromise.resolve(that)}).otherwise(function(error){that._readyPromise.reject(error)})}Object.defineProperties(Cesium3DTileset.prototype,{isCesium3DTileset:{get:function(){return!0}},imagesSourceBuf:{get:function(){return this._imagesSourceBuf}},asset:{get:function(){return this._asset}},extensions:{get:function(){return this._extensions}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(value){Cesium.ClippingPlaneCollection.setOwner(value,this,"_clippingPlanes")}},properties:{get:function(){return this._properties}},ready:{get:function(){return Cesium.defined(this._root)}},readyPromise:{get:function(){return this._readyPromise.promise}},tilesLoaded:{get:function(){return this._tilesLoaded}},url:{get:function(){return this._url}},basePath:{get:function(){return Cesium.deprecationWarning("Cesium3DTileset.basePath","Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead."),this._basePath}},style:{get:function(){return this._styleEngine.style},set:function(value){this._styleEngine.style=value}},maximumScreenSpaceError:{get:function(){return this._maximumScreenSpaceError},set:function(value){this._maximumScreenSpaceError=value}},maximumMemoryUsage:{get:function(){return this._maximumMemoryUsage},set:function(value){this._maximumMemoryUsage=value}},root:{get:function(){return this._root}},boundingSphere:{get:function(){return this._root.updateTransform(this._modelMatrix),this._root.boundingSphere}},modelMatrix:{get:function(){return this._modelMatrix},set:function(value){this._modelMatrix=Cesium.Matrix4.clone(value,this._modelMatrix)}},timeSinceLoad:{get:function(){return this._timeSinceLoad}},totalMemoryUsageInBytes:{get:function(){var statistics=this._statistics;return statistics.texturesByteLength+statistics.geometryByteLength+statistics.batchTableByteLength}},clippingPlanesOriginMatrix:{get:function(){return Cesium.defined(this._clippingPlanesOriginMatrix)?(this._clippingPlanesOriginMatrixDirty&&(Cesium.Matrix4.multiply(this.root.computedTransform,this._initialClippingPlanesOriginMatrix,this._clippingPlanesOriginMatrix),this._clippingPlanesOriginMatrixDirty=!1),this._clippingPlanesOriginMatrix):Cesium.Matrix4.IDENTITY}},styleEngine:{get:function(){return this._styleEngine}},statistics:{get:function(){return this._statistics}},classificationType:{get:function(){return this._classificationType}},ellipsoid:{get:function(){return this._ellipsoid}},foveatedConeSize:{get:function(){return this._foveatedConeSize},set:function(value){this._foveatedConeSize=value}},foveatedMinimumScreenSpaceErrorRelaxation:{get:function(){return this._foveatedMinimumScreenSpaceErrorRelaxation},set:function(value){this._foveatedMinimumScreenSpaceErrorRelaxation=value}},extras:{get:function(){return this._extras}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(value){Cesium.Cartesian2.clone(value,this._imageBasedLightingFactor)}},airWidth:{get:function(){return this._airWidth},set:function(value){this._airWidth=value}},treeTable:{get:function(){return Cesium.defined(this.sharedResources.treeTables)?this.sharedResources.treeTables:void 0}}});Cesium3DTileset.loadJson=function(tilesetUrl){var resource2=Cesium.Resource.createIfNeeded(tilesetUrl);return resource2.fetchJson()};Cesium3DTileset.prototype.makeStyleDirty=function(){this._styleEngine.makeDirty()};Cesium3DTileset.prototype.loadTileset=function(resource2,tilesetJson,parentTile){var asset=tilesetJson.asset;if(!Cesium.defined(asset))throw new Cesium.RuntimeError("Tileset must have an asset property.");if(asset.version!=="0.0"&&asset.version!=="1.0")throw new Cesium.RuntimeError("The tileset must be 3D Tiles version 0.0 or 1.0.");var statistics=this._statistics,tilesetVersion=asset.tilesetVersion;Cesium.defined(tilesetVersion)&&(this._basePath+="?v="+tilesetVersion,resource2.setQueryParameters({v:tilesetVersion}));var rootTile=new Cesium3DTile_default(this,resource2,tilesetJson.root,parentTile);Cesium.defined(parentTile)&&(parentTile.children.push(rootTile),rootTile._depth=parentTile._depth+1);var stack=[];for(stack.push(rootTile),rootTile.sharedResources=this.sharedResources;stack.length>0;){var tile=stack.pop();++statistics.numberOfTilesTotal,this._allTilesAdditive=this._allTilesAdditive&&tile.refine===Cesium.Cesium3DTileRefine.ADD;var children=tile._header.children;if(Cesium.defined(children))for(var length3=children.length,i=0;i<length3;++i){var childHeader=children[i],sharedName=Cesium.createGuid();Cesium.defined(childHeader.content)&&Cesium.defined(childHeader.content.uri)?sharedName=childHeader.content.uri:Cesium.defined(childHeader.content)&&Cesium.defined(childHeader.content.url)&&(sharedName=childHeader.content.url),Cesium.defined(this.sharedResources.ktxs)||(this.sharedResources.ktxs={}),this.sharedResources.instancedPrograms[sharedName]={},Cesium.defined(childHeader.modeltree)&&(this.sharedResources.treeTables[childHeader.modeltree.uri]={});var childTile=new Cesium3DTile_default(this,resource2,childHeader,tile);tile.children.push(childTile),childTile._depth=tile._depth+1,stack.push(childTile),childTile.sharedResources={treeTables:Cesium.defined(childHeader.modeltree)?{name:childHeader.modeltree.uri,shadredData:this.sharedResources.treeTables[childHeader.modeltree.uri]}:{},instancedPrograms:{name:sharedName,shadredData:this.sharedResources.instancedPrograms[sharedName]},ktxs:this.sharedResources.ktxs}}this._cullWithChildrenBounds&&Cesium.Cesium3DTileOptimizations.checkChildrenWithinParent(tile)}return rootTile};var scratchPositionNormal=new Cesium.Cartesian3,scratchCartographic3=new Cesium.Cartographic,scratchMatrix3=new Cesium.Matrix4,scratchCenter2=new Cesium.Cartesian3,scratchPosition4=new Cesium.Cartesian3,scratchDirection=new Cesium.Cartesian3;function updateDynamicScreenSpaceError(tileset,frameState){var up,direction,height2,minimumHeight,maximumHeight,camera=frameState.camera,root=tileset._root,tileBoundingVolume=root.contentBoundingVolume;if(tileBoundingVolume instanceof Cesium.TileBoundingRegion)up=Cesium.Cartesian3.normalize(camera.positionWC,scratchPositionNormal),direction=camera.directionWC,height2=camera.positionCartographic.height,minimumHeight=tileBoundingVolume.minimumHeight,maximumHeight=tileBoundingVolume.maximumHeight;else{var transformLocal=Cesium.Matrix4.inverseTransformation(root.computedTransform,scratchMatrix3),ellipsoid=frameState.mapProjection.ellipsoid,boundingVolume=tileBoundingVolume.boundingVolume,centerLocal=Cesium.Matrix4.multiplyByPoint(transformLocal,boundingVolume.center,scratchCenter2);if(Cesium.Cartesian3.magnitude(centerLocal)>ellipsoid.minimumRadius){var centerCartographic=Cesium.Cartographic.fromCartesian(centerLocal,ellipsoid,scratchCartographic3);up=Cesium.Cartesian3.normalize(camera.positionWC,scratchPositionNormal),direction=camera.directionWC,height2=camera.positionCartographic.height,minimumHeight=0,maximumHeight=centerCartographic.height*2}else{var positionLocal=Cesium.Matrix4.multiplyByPoint(transformLocal,camera.positionWC,scratchPosition4);if(up=Cesium.Cartesian3.UNIT_Z,direction=Cesium.Matrix4.multiplyByPointAsVector(transformLocal,camera.directionWC,scratchDirection),direction=Cesium.Cartesian3.normalize(direction,direction),height2=positionLocal.z,tileBoundingVolume instanceof Cesium.TileOrientedBoundingBox){var boxHeight=root._header.boundingVolume.box[11];minimumHeight=centerLocal.z-boxHeight,maximumHeight=centerLocal.z+boxHeight}else if(tileBoundingVolume instanceof Cesium.TileBoundingSphere){var radius=boundingVolume.radius;minimumHeight=centerLocal.z-radius,maximumHeight=centerLocal.z+radius}}}var heightFalloff=tileset.dynamicScreenSpaceErrorHeightFalloff,heightClose=minimumHeight+(maximumHeight-minimumHeight)*heightFalloff,heightFar=maximumHeight,t=Cesium.Math.clamp((height2-heightClose)/(heightFar-heightClose),0,1),dot2=Math.abs(Cesium.Cartesian3.dot(direction,up)),horizonFactor=1-dot2;horizonFactor=horizonFactor*(1-t);var density=tileset.dynamicScreenSpaceErrorDensity;density*=horizonFactor,tileset._dynamicScreenSpaceErrorComputedDensity=density}function requestContent(tileset,tile){if(!tile.hasEmptyContent){if(tileset.useIndexedDBCache){requestContentByIndexedDB(tileset,tile);return}var statistics=tileset._statistics,expired=tile.contentExpired,requested=tile.requestContent();if(!requested){++statistics.numberOfAttemptedRequests;return}expired&&(tile.hasTilesetContent?destroySubtree(tileset,tile):(statistics.decrementLoadCounts(tile.content),--statistics.numberOfTilesWithContentReady)),++statistics.numberOfPendingRequests,tile.contentReadyToProcessPromise.then(addToProcessingQueue(tileset,tile)),tile.contentReadyPromise.then(handleTileSuccess(tileset,tile)).otherwise(handleTileFailure(tileset,tile))}}function requestContentByIndexedDB(tileset,tile){if(!tile.hasEmptyContent){tile.destroySubtreeFunction=destroySubtree;var statistics=tileset._statistics,expired=tile.contentExpired,requested=tile.requestContentByIndexedDB();if(!requested){++statistics.numberOfAttemptedRequests;return}expired&&(tile.hasTilesetContent?destroySubtree(tileset,tile):(statistics.decrementLoadCounts(tile.content),--statistics.numberOfTilesWithContentReady)),++statistics.numberOfPendingRequests,tile.contentReadyToProcessPromise.then(addToProcessingQueue(tileset,tile)),tile.contentReadyPromise.then(handleTileSuccess(tileset,tile)).otherwise(handleTileFailure(tileset,tile))}}function sortRequestByPriority(a,b){return a._priority-b._priority}Cesium3DTileset.prototype.postPassesUpdate=function(frameState){!this.ready||(cancelOutOfViewRequests(this,frameState),raiseLoadProgressEvent(this,frameState),this._cache.unloadTiles(this,unloadTile))};Cesium3DTileset.prototype.prePassesUpdate=function(frameState){if(!!this.ready){processTiles(this,frameState);var clippingPlanes=this._clippingPlanes;this._clippingPlanesOriginMatrixDirty=!0,Cesium.defined(clippingPlanes)&&clippingPlanes.enabled&&clippingPlanes.update(frameState),Cesium.defined(this._loadTimestamp)||(this._loadTimestamp=Cesium.JulianDate.clone(frameState.time)),this._timeSinceLoad=Math.max(Cesium.JulianDate.secondsDifference(frameState.time,this._loadTimestamp)*1e3,0),this._skipLevelOfDetail=this.skipLevelOfDetail&&!Cesium.defined(this._classificationType)&&!this._disableSkipLevelOfDetail&&!this._allTilesAdditive,this.dynamicScreenSpaceError&&updateDynamicScreenSpaceError(this,frameState),frameState.newFrame&&this._cache.reset()}};function cancelOutOfViewRequests(tileset,frameState){for(var requestedTilesInFlight=tileset._requestedTilesInFlight,removeCount=0,length3=requestedTilesInFlight.length,i=0;i<length3;++i){var tile=requestedTilesInFlight[i],outOfView=frameState.frameNumber-tile._touchedFrame>=1;if(tile._contentState!==Cesium.Cesium3DTileContentState.LOADING){++removeCount;continue}else if(outOfView){tile._request.cancel(),++removeCount;continue}removeCount>0&&(requestedTilesInFlight[i-removeCount]=tile)}requestedTilesInFlight.length-=removeCount}function requestTiles(tileset,isAsync){var requestedTiles=tileset._requestedTiles,length3=requestedTiles.length;requestedTiles.sort(sortRequestByPriority);for(var i=0;i<length3;++i)requestContent(tileset,requestedTiles[i])}function addToProcessingQueue(tileset,tile){return function(){tileset._processingQueue.push(tile),--tileset._statistics.numberOfPendingRequests,++tileset._statistics.numberOfTilesProcessing}}function handleTileFailure(tileset,tile){return function(error){var url=tile._contentResource.url,message=Cesium.defined(error.message)?error.message:error.toString();tileset.tileFailed.numberOfListeners>0?tileset.tileFailed.raiseEvent({url,message}):(console.log("A 3D tile failed to load: "+url),console.log("Error: "+message))}}function handleTileSuccess(tileset,tile){return function(){--tileset._statistics.numberOfTilesProcessing,tile.hasTilesetContent||(tileset._statistics.incrementLoadCounts(tile.content),++tileset._statistics.numberOfTilesWithContentReady,++tileset._statistics.numberOfLoadedTilesTotal,tileset._cache.add(tile)),tileset.tileLoad.raiseEvent(tile)}}function filterProcessingQueue(tileset){for(var tiles=tileset._processingQueue,length3=tiles.length,removeCount=0,i=0;i<length3;++i){var tile=tiles[i];if(tile._contentState!==Cesium.Cesium3DTileContentState.PROCESSING){++removeCount;continue}removeCount>0&&(tiles[i-removeCount]=tile)}tiles.length-=removeCount}function processTiles(tileset,frameState){filterProcessingQueue(tileset);for(var tiles=tileset._processingQueue,length3=tiles.length,i=0;i<length3;++i)tiles[i].process(tileset,frameState)}var scratchCartesian3=new Cesium.Cartesian3,stringOptions={maximumFractionDigits:3};function formatMemoryString(memorySizeInBytes){var memoryInMegabytes=memorySizeInBytes/1048576;return memoryInMegabytes<1?memoryInMegabytes.toLocaleString(void 0,stringOptions):Math.round(memoryInMegabytes).toLocaleString()}function computeTileLabelPosition(tile){var boundingVolume=tile.boundingVolume.boundingVolume,halfAxes=boundingVolume.halfAxes,radius=boundingVolume.radius,position=Cesium.Cartesian3.clone(boundingVolume.center,scratchCartesian3);if(Cesium.defined(halfAxes))position.x+=.75*(halfAxes[0]+halfAxes[3]+halfAxes[6]),position.y+=.75*(halfAxes[1]+halfAxes[4]+halfAxes[7]),position.z+=.75*(halfAxes[2]+halfAxes[5]+halfAxes[8]);else if(Cesium.defined(radius)){var normal=Cesium.Cartesian3.normalize(boundingVolume.center,scratchCartesian3);normal=Cesium.Cartesian3.multiplyByScalar(normal,.75*radius,scratchCartesian3),position=Cesium.Cartesian3.add(normal,boundingVolume.center,scratchCartesian3)}return position}function addTileDebugLabel(tile,tileset,position){var labelString="",attributes=0;if(tileset.debugShowGeometricError&&(labelString+=`
Geometric error: `+tile.geometricError,attributes++),tileset.debugShowRenderingStatistics){labelString+=`
Commands: `+tile.commandsLength,attributes++;var numberOfPoints=tile.content.pointsLength;numberOfPoints>0&&(labelString+=`
Points: `+tile.content.pointsLength,attributes++);var numberOfTriangles=tile.content.trianglesLength;numberOfTriangles>0&&(labelString+=`
Triangles: `+tile.content.trianglesLength,attributes++),labelString+=`
Features: `+tile.content.featuresLength,attributes++}if(tileset.debugShowMemoryUsage&&(labelString+=`
Texture Memory: `+formatMemoryString(tile.content.texturesByteLength),labelString+=`
Geometry Memory: `+formatMemoryString(tile.content.geometryByteLength),attributes+=2),tileset.debugShowUrl&&(labelString+=`
Url: `+tile._header.content.uri,attributes++),labelString.length!=0){var newLabel={text:labelString.substring(1),position,font:19-attributes+"px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY};return tileset._tileDebugLabels.add(newLabel)}}var annotationShowCount=0,labelRectangle=[],labelIndex=0,isoptimize=!0;function processAnnotationLabel(tile,tileset,frameState){if(Cesium.defined(tileset._airDataShowNameCount)&&tileset._airDataShowNameCount>0){Cesium.defined(tile._labels)||(tile._labels=new Cesium.LabelCollection);for(var i=0;i<tile._labels.length;i++)tile._labels.get(i).changed=!1,tile._labels.get(i).show=!1;annotationShowCount=0;var annotationPositons=[];labelIndex=0;for(var batchTable=tile._content._batchTable,len=batchTable.featuresLength,i=0;i<len;i++){var id=batchTable.getProperty(i,"id"),name=batchTable.getProperty(i,"name");if(!Cesium.defined(name)){tileset._airDataShowNameCount=0;return}var properties;Cesium.defined(id)&&(properties={id});var Positions=batchTable.getProperty(i,"Positions");if(!Cesium.defined(Positions))return;for(var Longitude=Positions.Longitude,Latitude=Positions.Latitude,Height=Positions.Height,visiblePositions=[],j=0;j<Longitude.length;j++){var lon2=Longitude[j],lat2=Latitude[j],hei=Height[j];hei<1e-7&&(hei=0);var pos=Cesium.Cartesian3.fromRadians(lon2,lat2,hei);pointIsVisible(pos,frameState.cullingVolume)&&visiblePositions.push(pos)}visiblePositions.length>0&&pareAirAnnotationLabel(tileset,tile,visiblePositions,name,annotationPositons,frameState,properties)}return}}function pareAirAnnotationLabel(tileset,tile,positions,name,annotationPositons,frameState,properties){var scene=frameState.camera._scene,num=positions.length,showCount=tileset._airDataShowNameCount,distance12=tile._distanceToCamera;if(distance12>2e4){var index=parseInt(num/2);complabelPos(index,positions,tileset,tile,name,scene,annotationPositons,properties)}else if(distance12<=2e4)if(num>=showCount*2)for(var step=parseInt(num/(showCount*2))+1,j=0;j<showCount;j++){var index=j+(j+1)*step;index=index>=num?index-num:index,complabelPos(index,positions,tileset,tile,name,scene,annotationPositons,properties)}else{var index=parseInt(num/2);complabelPos(index,positions,tileset,tile,name,scene,annotationPositons,properties)}}function isIntersect(rectangles,rectangle){for(var i=rectangles.length-1;i>=0;i--){var intersect2=Cesium.BoundingRectangle.intersect(rectangles[i],rectangle);if(intersect2===Cesium.Intersect.INTERSECTING)return!0}return!1}function isExist(annotationPositons,position){for(var i=0;i<annotationPositons.length;i++)if(annotationPositons[i].equals(position))return!0;return!1}function complabelPos(index,positions,tileset,tile,name,scene,annotationPositons,properties){var num=positions.length,position=positions[index],count2=1,rectangle;if(isoptimize){rectangle=computeLabelRectangle(tileset,name,position,scene);var step=parseInt(num/10);for(step=step===0?1:step;isIntersect(labelRectangle,rectangle)&&count2<=step;)index=index+step>=num?index+step-num:index+step,position=positions[index],rectangle=computeLabelRectangle(tileset,name,position,scene),count2++}else for(;isExist(annotationPositons,position)&&count2<=num;)index=index+1>=num?index+1-num:index+1,position=positions[index],count2++;isIntersect(labelRectangle,rectangle)||(addAirAnnotationLabel(tileset,tile,position,name,properties),annotationPositons.push(position),labelRectangle.push(rectangle))}var width=0,height=0;function computeLabelRectangle(tileset,name,position,scene){if(width===0){var font=tileset._annotationLabel.font,canvas=document.createElement("canvas");canvas.width=1,canvas.height=1,canvas.style.font=font;var context2D=canvas.getContext("2d",{willReadFrequently:!0});context2D.font=font,context2D.lineJoin="round",context2D.lineWidth=1;var imageSmoothingEnabledName="imageSmoothingEnabled";context2D[imageSmoothingEnabledName]=!1,context2D.textBaseline="bottom",canvas.style.visibility="hidden",document.body.appendChild(canvas);for(var i=0;i<name.length;i++){var text=name[i],dimensions=measureText_default(context2D,text,!1,!0);width+=dimensions.width,height=Math.max(height,dimensions.height)}document.body.removeChild(canvas),canvas.style.visibility=""}var result=new Cesium.BoundingRectangle,cart=new Cesium.Cartesian2;return Cesium.SceneTransforms.wgs84ToWindowCoordinates(scene,position,cart),result.x=cart.x,result.y=cart.y,result.width=width,result.height=height,result}function addAirAnnotationLabel(tileset,tile,position,name,properties){if(tile._labels.length>labelIndex)for(var needCreate=!0,i=0;i<tile._labels.length;i++){var label=tile._labels.get(i);if(label.text===name&&(needCreate=!1,label.show=!0,!Cesium.defined(label.changed)||!label.changed)){label.position=position,label.changed=!0;break}}else{var newLabel={text:name,position,properties};for(var item in tileset._annotationLabel)newLabel[item]=tileset._annotationLabel[item];tile._labels.add(newLabel)}if(needCreate){var newLabel={text:name,position,properties};for(var item in tileset._annotationLabel)newLabel[item]=tileset._annotationLabel[item];tile._labels.add(newLabel)}return labelIndex++,position}function pointIsVisible(position,cullingVolume){for(var planes=cullingVolume.planes,intersecting=!1,scratchPlane=new Cesium.Plane(new Cesium.Cartesian3(1,0,0),0),k=0,len=planes.length;k<len;++k){var plane=Cesium.Plane.fromCartesian4(planes[k],scratchPlane),center2=position,normal=plane.normal,distanceToPlane=Cesium.Cartesian3.dot(normal,center2)+plane.distance;if(distanceToPlane<=0)return!1;intersecting=!0}return intersecting}function updateTileDebugLabels(tileset,frameState){var i,tile,selectedTiles=tileset._selectedTiles,selectedLength=selectedTiles.length,emptyTiles=tileset._emptyTiles,emptyLength=emptyTiles.length;if(tileset._tileDebugLabels.removeAll(),tileset.debugPickedTileLabelOnly){if(Cesium.defined(tileset.debugPickedTile)){var position=Cesium.defined(tileset.debugPickPosition)?tileset.debugPickPosition:computeTileLabelPosition(tileset.debugPickedTile),label=addTileDebugLabel(tileset.debugPickedTile,tileset,position);label.pixelOffset=new Cesium.Cartesian2(15,-15)}}else{labelRectangle=[];var camera=frameState.camera;for(tileset._startListener===void 0&&(tileset._startListener=function(){var timer=function(){for(i=0;i<selectedTiles.length;++i)tile=selectedTiles[i],processAnnotationLabel(tile,tileset,frameState)};tileset.show&&(tileset._timer=setInterval(timer,800)),tileset._stopListener&&camera._moveEnd.removeEventListener(tileset._stopListener),tileset._stopListener=void 0},camera._moveStart.addEventListener(tileset._startListener)),tileset._stopListener===void 0&&(tileset._stopListener=function(){Cesium.defined(tileset._timer)&&(clearInterval(tileset._timer),tileset._timer=void 0,tileset._startListener&&camera._moveStart.removeEventListener(tileset._startListener),tileset._startListener=void 0)},camera._moveEnd.addEventListener(tileset._stopListener)),i=0;i<selectedLength;++i)tile=selectedTiles[i],addTileDebugLabel(tile,tileset,computeTileLabelPosition(tile)),Cesium.defined(tile._labels)&&tile._labels.update(frameState);for(i=0;i<emptyLength;++i)tile=emptyTiles[i],tile.hasTilesetContent&&addTileDebugLabel(tile,tileset,computeTileLabelPosition(tile))}tileset._tileDebugLabels.update(frameState)}function updateTiles(tileset,frameState,passOptions2){tileset._styleEngine.applyStyle(tileset,passOptions2);var isRender=passOptions2.isRender,statistics=tileset._statistics,commandList=frameState.commandList,numberOfInitialCommands=commandList.length,selectedTiles=tileset._selectedTiles,selectedTiles=tileset.selectedTiles;Cesium.defined(selectedTiles)||(selectedTiles=tileset._selectedTiles);var selectedLength=selectedTiles.length,emptyTiles=tileset._emptyTiles,emptyLength=emptyTiles.length,tileVisible=tileset.tileVisible,i,tile,bivariateVisibilityTest=tileset._skipLevelOfDetail&&tileset._hasMixedContent&&frameState.context.stencilBuffer&&selectedLength>0;tileset._backfaceCommands.length=0,bivariateVisibilityTest&&(Cesium.defined(tileset._stencilClearCommand)||(tileset._stencilClearCommand=new Cesium.ClearCommand({stencil:0,pass:Cesium.Pass.CESIUM_3D_TILE,renderState:Cesium.RenderState.fromCache({stencilMask:Cesium.StencilConstants.SKIP_LOD_MASK})})),commandList.push(tileset._stencilClearCommand));var lengthBeforeUpdate=commandList.length;for(i=0;i<selectedLength;++i)tile=selectedTiles[i],isRender&&tileVisible.raiseEvent(tile),tile.update(tileset,frameState,passOptions2),statistics.incrementSelectionCounts(tile.content),++statistics.selected;for(i=0;i<emptyLength;++i)tile=emptyTiles[i],tile.update(tileset,frameState,passOptions2);var addedCommandsLength=commandList.length-lengthBeforeUpdate;if(tileset._backfaceCommands.trim(),bivariateVisibilityTest){var backfaceCommands=tileset._backfaceCommands.values,backfaceCommandsLength=backfaceCommands.length;for(commandList.length+=backfaceCommandsLength,i=addedCommandsLength-1;i>=0;--i)commandList[lengthBeforeUpdate+backfaceCommandsLength+i]=commandList[lengthBeforeUpdate+i];for(i=0;i<backfaceCommandsLength;++i)commandList[lengthBeforeUpdate+i]=backfaceCommands[i]}addedCommandsLength=commandList.length-numberOfInitialCommands,statistics.numberOfCommands=addedCommandsLength,isRender&&tileset.pointCloudShading.attenuation&&tileset.pointCloudShading.eyeDomeLighting&&addedCommandsLength>0&&tileset._pointCloudEyeDomeLighting.update(frameState,numberOfInitialCommands,tileset.pointCloudShading,tileset.boundingSphere),isRender&&(tileset.debugShowGeometricError||tileset.debugShowRenderingStatistics||tileset.debugShowMemoryUsage||tileset.debugShowUrl||Cesium.defined(tileset._airDataShowNameCount)?(Cesium.defined(tileset._tileDebugLabels)||(tileset._tileDebugLabels=new Cesium.LabelCollection),updateTileDebugLabels(tileset,frameState)):tileset._tileDebugLabels=tileset._tileDebugLabels&&tileset._tileDebugLabels.destroy())}var scratchStack2=[];function destroySubtree(tileset,tile){var root=tile,stack=scratchStack2;for(stack.push(tile);stack.length>0;){tile=stack.pop();for(var children=tile.children,length3=children.length,i=0;i<length3;++i)stack.push(children[i]);tile!==root&&(destroyTile(tileset,tile),--tileset._statistics.numberOfTilesTotal)}root.children=[]}function unloadTile(tileset,tile){tileset.tileUnload.raiseEvent(tile),tileset._statistics.decrementLoadCounts(tile.content),--tileset._statistics.numberOfTilesWithContentReady,tile.unloadContent()}function destroyTile(tileset,tile){tileset._cache.unloadTile(tileset,tile,unloadTile),tile.destroy()}Cesium3DTileset.prototype.trimLoadedTiles=function(){this._cache.trim()};function raiseLoadProgressEvent(tileset,frameState){var statistics=tileset._statistics,statisticsLast=tileset._statisticsLast,numberOfPendingRequests=statistics.numberOfPendingRequests,numberOfTilesProcessing=statistics.numberOfTilesProcessing,lastNumberOfPendingRequest=statisticsLast.numberOfPendingRequests,lastNumberOfTilesProcessing=statisticsLast.numberOfTilesProcessing;Cesium.Cesium3DTilesetStatistics.clone(statistics,statisticsLast);var progressChanged=numberOfPendingRequests!==lastNumberOfPendingRequest||numberOfTilesProcessing!==lastNumberOfTilesProcessing;progressChanged&&frameState.afterRender.push(function(){tileset.loadProgress.raiseEvent(numberOfPendingRequests,numberOfTilesProcessing)}),tileset._tilesLoaded=statistics.numberOfPendingRequests===0&&statistics.numberOfTilesProcessing===0&&statistics.numberOfAttemptedRequests===0,progressChanged&&tileset._tilesLoaded&&(frameState.afterRender.push(function(){tileset.allTilesLoaded.raiseEvent()}),tileset._initialTilesLoaded||(tileset._initialTilesLoaded=!0,frameState.afterRender.push(function(){tileset.initialTilesLoaded.raiseEvent()})))}function resetMinimumMaximum(tileset){tileset._heatmap.resetMinimumMaximum(),tileset._minimumPriority.depth=Number.MAX_VALUE,tileset._maximumPriority.depth=-Number.MAX_VALUE,tileset._minimumPriority.foveatedFactor=Number.MAX_VALUE,tileset._maximumPriority.foveatedFactor=-Number.MAX_VALUE,tileset._minimumPriority.distance=Number.MAX_VALUE,tileset._maximumPriority.distance=-Number.MAX_VALUE,tileset._minimumPriority.reverseScreenSpaceError=Number.MAX_VALUE,tileset._maximumPriority.reverseScreenSpaceError=-Number.MAX_VALUE}function detectModelMatrixChanged(tileset,frameState){(frameState.frameNumber!==tileset._updatedModelMatrixFrame||!Cesium.defined(tileset._previousModelMatrix))&&(tileset._updatedModelMatrixFrame=frameState.frameNumber,tileset._modelMatrixChanged=!Cesium.Matrix4.equals(tileset.modelMatrix,tileset._previousModelMatrix),tileset._previousModelMatrix=Cesium.Matrix4.clone(tileset.modelMatrix,tileset._previousModelMatrix))}function update(tileset,frameState,passStatistics,passOptions2){if(frameState.mode===Cesium.SceneMode.MORPHING||!tileset.ready)return!1;var statistics=tileset._statistics;statistics.clear();var isRender=passOptions2.isRender;++tileset._updatedVisibilityFrame,resetMinimumMaximum(tileset),detectModelMatrixChanged(tileset,frameState),tileset._cullRequestsWhileMoving=tileset.cullRequestsWhileMoving&&!tileset._modelMatrixChanged;var ready=passOptions2.traversal.selectTiles(tileset,frameState);if(passOptions2.requestTiles&&requestTiles(tileset),frameState.passes.pick||(tileset.selectedTiles=tileset._selectedTiles.slice(0)),updateTiles(tileset,frameState,passOptions2),Cesium.Cesium3DTilesetStatistics.clone(statistics,passStatistics),isRender){var credits=tileset._credits;if(Cesium.defined(credits)&&statistics.selected!==0)for(var length3=credits.length,i=0;i<length3;++i)frameState.creditDisplay.addCredit(credits[i])}return ready}Cesium3DTileset.prototype.update=function(frameState){this._tilesetFlat&&this._tilesetFlat.update(frameState,this),this.updateForPass(frameState,frameState.tilesetPassState)};Cesium3DTileset.prototype.updateForPass=function(frameState,tilesetPassState){var pass=tilesetPassState.pass;if(!(pass===Cesium3DTilePass_default.PRELOAD&&(!this.preloadWhenHidden||this.show)||pass===Cesium3DTilePass_default.PRELOAD_FLIGHT&&(!this.preloadFlightDestinations||!this.show&&!this.preloadWhenHidden)||pass===Cesium3DTilePass_default.REQUEST_RENDER_MODE_DEFER_CHECK&&(!this._cullRequestsWhileMoving&&this.foveatedTimeDelay<=0||!this.show))){var originalCommandList=frameState.commandList,originalCamera=frameState.camera,originalCullingVolume=frameState.cullingVolume;tilesetPassState.ready=!1;var passOptions2=Cesium3DTilePass_default.getPassOptions(pass),ignoreCommands=passOptions2.ignoreCommands,commandList=Cesium.defaultValue(tilesetPassState.commandList,originalCommandList),commandStart=commandList.length;frameState.commandList=commandList,frameState.camera=Cesium.defaultValue(tilesetPassState.camera,originalCamera),frameState.cullingVolume=Cesium.defaultValue(tilesetPassState.cullingVolume,originalCullingVolume);var passStatistics=this._statisticsPerPass[pass];(this.show||ignoreCommands)&&(this._pass=pass,tilesetPassState.ready=update(this,frameState,passStatistics,passOptions2)),ignoreCommands&&(commandList.length=commandStart),frameState.commandList=originalCommandList,frameState.camera=originalCamera,frameState.cullingVolume=originalCullingVolume}};Cesium3DTileset.prototype.hasExtension=function(extensionName){return Cesium.defined(this._extensionsUsed)?this._extensionsUsed.indexOf(extensionName)>-1:!1};Cesium3DTileset.prototype.isDestroyed=function(){return!1};Cesium3DTileset.prototype.destroy=function(){if(this._tileDebugLabels=this._tileDebugLabels&&this._tileDebugLabels.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),Cesium.defined(this._root)){var stack=scratchStack2;for(stack.push(this._root);stack.length>0;){var tile=stack.pop();tile.destroy();for(var children=tile.children,length3=children.length,i=0;i<length3;++i)stack.push(children[i])}}return this._root=void 0,Cesium.destroyObject(this)};Cesium3DTileset.prototype.addNode_ev=function(parent,children){if(parent&&parent.children.length==0){var resource2=Cesium.Resource.createIfNeeded(this._url);if(Cesium.defined(children)&&children.length>0)for(var i=0;i<children.length;++i){var childHeader=children[i],lodVirtualMode=!1;Cesium.defined(childHeader.boundingVolume)||(childHeader.boundingVolume={},childHeader.boundingVolume.sphere=[0,0,0,0],lodVirtualMode=!0);var childTile=new Cesium3DTile_default(this,resource2,childHeader,parent);lodVirtualMode&&(childTile._boundingVolume=parent._boundingVolume),!Cesium.defined(childTile._header.EVID)&&Cesium.defined(parent._header.EVID)&&(childTile._header.EVID=parent._header.EVID),parent.children.push(childTile),childTile._depth=parent._depth+1,++this._statistics.numberOfTilesTotal}this._cullWithChildrenBounds&&Cesium.Cesium3DTileOptimizations.checkChildrenWithinParent(parent)}};Cesium3DTileset.prototype.tramsformTreeTableMap=function(treeTable){try{var allLoaded=!0;for(var name in this.sharedResources.treeTables)Cesium.defined(this.sharedResources.treeTables[name].elementName)||(allLoaded=!1);allLoaded&&this.loadedTreeTables.raiseEvent(this.sharedResources.treeTables);var treeTableMap=new Cesium.AssociativeArray,root=treeTable,stack=new Cesium.ManagedArray;for(stack.push(root);stack.length>0;){var element=stack.pop();if(treeTableMap.get(element.elementName)?treeTableMap.get(element.elementName).push(element.id):treeTableMap.set(element.elementName,[element.id]),Cesium.defined(element.children))for(var i=0;i<element.children.length;++i){var child=element.children[i];stack.push(child)}}this.treeTableMaps.push(treeTableMap)}catch(e){return e}};function getImagesSourceBuf(imageUrl){return Cesium.defined(imageUrl)?Cesium.Resource.createIfNeeded(imageUrl).fetchImage({flipY:!1,preferImageBitmap:!0,preferBlob:!0}).then(function(image){return new Promise((resolve2,reject2)=>{let reader=new FileReader;reader.onload=function(){resolve2(new Uint8Array(this.result))},reader.onerror=function(e){console.log(e),reject2(e)},reader.readAsArrayBuffer(image.blob)})}).then(function(imageBuffer){return imageBuffer}):void 0}var Cesium3DTileset_default=Cesium3DTileset;var import_jsep=__toESM(require_jsep(),1);function Expression(expression,defines){this._expression=expression,expression=replaceDefines(expression,defines),expression=replaceVariables(removeBackslashes(expression)),import_jsep.default.addBinaryOp("=~",0),import_jsep.default.addBinaryOp("!~",0);var ast;try{ast=(0,import_jsep.default)(expression)}catch(e){throw new Cesium.RuntimeError(e)}this._runtimeAst=createRuntimeAst(this,ast)}Object.defineProperties(Expression.prototype,{expression:{get:function(){return this._expression}}});var scratchStorage={arrayIndex:0,arrayArray:[[]],cartesian2Index:0,cartesian3Index:0,cartesian4Index:0,cartesian2Array:[new Cesium.Cartesian2],cartesian3Array:[new Cesium.Cartesian3],cartesian4Array:[new Cesium.Cartesian4],reset:function(){this.arrayIndex=0,this.cartesian2Index=0,this.cartesian3Index=0,this.cartesian4Index=0},getArray:function(){this.arrayIndex>=this.arrayArray.length&&this.arrayArray.push([]);var array=this.arrayArray[this.arrayIndex++];return array.length=0,array},getCartesian2:function(){return this.cartesian2Index>=this.cartesian2Array.length&&this.cartesian2Array.push(new Cesium.Cartesian2),this.cartesian2Array[this.cartesian2Index++]},getCartesian3:function(){return this.cartesian3Index>=this.cartesian3Array.length&&this.cartesian3Array.push(new Cesium.Cartesian3),this.cartesian3Array[this.cartesian3Index++]},getCartesian4:function(){return this.cartesian4Index>=this.cartesian4Array.length&&this.cartesian4Array.push(new Cesium.Cartesian4),this.cartesian4Array[this.cartesian4Index++]}};Expression.prototype.evaluate=function(feature2,result){scratchStorage.reset();var value=this._runtimeAst.evaluate(feature2);return result instanceof Cesium.Color&&value instanceof Cesium.Cartesian4?Cesium.Color.fromCartesian4(value,result):value instanceof Cesium.Cartesian2||value instanceof Cesium.Cartesian3||value instanceof Cesium.Cartesian4?value.clone(result):value};Expression.prototype.evaluateColor=function(feature2,result){scratchStorage.reset();var color=this._runtimeAst.evaluate(feature2);return Cesium.Color.fromCartesian4(color,result)};Expression.prototype.getShaderFunction=function(functionName,attributePrefix,shaderState,returnType){var shaderExpression=this.getShaderExpression(attributePrefix,shaderState);return functionName.includes("(")&&functionName.includes(")")?shaderExpression=returnType+" "+functionName+`{ 
    return `+shaderExpression+`; 
} 
`:shaderExpression=returnType+" "+functionName+`() 
{ 
    return `+shaderExpression+`; 
} 
`,shaderExpression};Expression.prototype.getShaderExpression=function(attributePrefix,shaderState){return this._runtimeAst.getShaderExpression(attributePrefix,shaderState)};var unaryOperators=["!","-","+"],binaryOperators=["+","-","*","/","%","===","!==",">",">=","<","<=","&&","||","!~","=~"],variableRegex=/\${(.*?)}/g,backslashRegex=/\\/g,backslashReplacement="@#%",replacementRegex=/@#%/g,scratchColor7=new Cesium.Color,unaryFunctions={abs:getEvaluateUnaryComponentwise(Math.abs),sqrt:getEvaluateUnaryComponentwise(Math.sqrt),cos:getEvaluateUnaryComponentwise(Math.cos),sin:getEvaluateUnaryComponentwise(Math.sin),tan:getEvaluateUnaryComponentwise(Math.tan),acos:getEvaluateUnaryComponentwise(Math.acos),asin:getEvaluateUnaryComponentwise(Math.asin),atan:getEvaluateUnaryComponentwise(Math.atan),radians:getEvaluateUnaryComponentwise(Cesium.Math.toRadians),degrees:getEvaluateUnaryComponentwise(Cesium.Math.toDegrees),sign:getEvaluateUnaryComponentwise(Cesium.Math.sign),floor:getEvaluateUnaryComponentwise(Math.floor),ceil:getEvaluateUnaryComponentwise(Math.ceil),round:getEvaluateUnaryComponentwise(Math.round),exp:getEvaluateUnaryComponentwise(Math.exp),exp2:getEvaluateUnaryComponentwise(exp2),log:getEvaluateUnaryComponentwise(Math.log),log2:getEvaluateUnaryComponentwise(log22),fract:getEvaluateUnaryComponentwise(fract),length,normalize},binaryFunctions={atan2:getEvaluateBinaryComponentwise(Math.atan2,!1),pow:getEvaluateBinaryComponentwise(Math.pow,!1),min:getEvaluateBinaryComponentwise(Math.min,!0),max:getEvaluateBinaryComponentwise(Math.max,!0),distance,dot,cross},ternaryFunctions={clamp:getEvaluateTernaryComponentwise(Cesium.Math.clamp,!0),mix:getEvaluateTernaryComponentwise(Cesium.Math.lerp,!0)};function fract(number){return number-Math.floor(number)}function exp2(exponent){return Math.pow(2,exponent)}function log22(number){return Cesium.Math.log2(number)}function getEvaluateUnaryComponentwise(operation){return function(call,left){if(typeof left=="number")return operation(left);if(left instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(operation(left.x),operation(left.y),scratchStorage.getCartesian2());if(left instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(operation(left.x),operation(left.y),operation(left.z),scratchStorage.getCartesian3());if(left instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(operation(left.x),operation(left.y),operation(left.z),operation(left.w),scratchStorage.getCartesian4());throw new Cesium.RuntimeError('Function "'+call+'" requires a vector or number argument. Argument is '+left+".")}}function getEvaluateBinaryComponentwise(operation,allowScalar){return function(call,left,right){if(allowScalar&&typeof right=="number"){if(typeof left=="number")return operation(left,right);if(left instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(operation(left.x,right),operation(left.y,right),scratchStorage.getCartesian2());if(left instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(operation(left.x,right),operation(left.y,right),operation(left.z,right),scratchStorage.getCartesian3());if(left instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(operation(left.x,right),operation(left.y,right),operation(left.z,right),operation(left.w,right),scratchStorage.getCartesian4())}if(typeof left=="number"&&typeof right=="number")return operation(left,right);if(left instanceof Cesium.Cartesian2&&right instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(operation(left.x,right.x),operation(left.y,right.y),scratchStorage.getCartesian2());if(left instanceof Cesium.Cartesian3&&right instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(operation(left.x,right.x),operation(left.y,right.y),operation(left.z,right.z),scratchStorage.getCartesian3());if(left instanceof Cesium.Cartesian4&&right instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(operation(left.x,right.x),operation(left.y,right.y),operation(left.z,right.z),operation(left.w,right.w),scratchStorage.getCartesian4());throw new Cesium.RuntimeError('Function "'+call+'" requires vector or number arguments of matching types. Arguments are '+left+" and "+right+".")}}function getEvaluateTernaryComponentwise(operation,allowScalar){return function(call,left,right,test){if(allowScalar&&typeof test=="number"){if(typeof left=="number"&&typeof right=="number")return operation(left,right,test);if(left instanceof Cesium.Cartesian2&&right instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(operation(left.x,right.x,test),operation(left.y,right.y,test),scratchStorage.getCartesian2());if(left instanceof Cesium.Cartesian3&&right instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(operation(left.x,right.x,test),operation(left.y,right.y,test),operation(left.z,right.z,test),scratchStorage.getCartesian3());if(left instanceof Cesium.Cartesian4&&right instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(operation(left.x,right.x,test),operation(left.y,right.y,test),operation(left.z,right.z,test),operation(left.w,right.w,test),scratchStorage.getCartesian4())}if(typeof left=="number"&&typeof right=="number"&&typeof test=="number")return operation(left,right,test);if(left instanceof Cesium.Cartesian2&&right instanceof Cesium.Cartesian2&&test instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(operation(left.x,right.x,test.x),operation(left.y,right.y,test.y),scratchStorage.getCartesian2());if(left instanceof Cesium.Cartesian3&&right instanceof Cesium.Cartesian3&&test instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(operation(left.x,right.x,test.x),operation(left.y,right.y,test.y),operation(left.z,right.z,test.z),scratchStorage.getCartesian3());if(left instanceof Cesium.Cartesian4&&right instanceof Cesium.Cartesian4&&test instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(operation(left.x,right.x,test.x),operation(left.y,right.y,test.y),operation(left.z,right.z,test.z),operation(left.w,right.w,test.w),scratchStorage.getCartesian4());throw new Cesium.RuntimeError('Function "'+call+'" requires vector or number arguments of matching types. Arguments are '+left+", "+right+", and "+test+".")}}function length(call,left){if(typeof left=="number")return Math.abs(left);if(left instanceof Cesium.Cartesian2)return Cesium.Cartesian2.magnitude(left);if(left instanceof Cesium.Cartesian3)return Cesium.Cartesian3.magnitude(left);if(left instanceof Cesium.Cartesian4)return Cesium.Cartesian4.magnitude(left);throw new Cesium.RuntimeError('Function "'+call+'" requires a vector or number argument. Argument is '+left+".")}function normalize(call,left){if(typeof left=="number")return 1;if(left instanceof Cesium.Cartesian2)return Cesium.Cartesian2.normalize(left,scratchStorage.getCartesian2());if(left instanceof Cesium.Cartesian3)return Cesium.Cartesian3.normalize(left,scratchStorage.getCartesian3());if(left instanceof Cesium.Cartesian4)return Cesium.Cartesian4.normalize(left,scratchStorage.getCartesian4());throw new Cesium.RuntimeError('Function "'+call+'" requires a vector or number argument. Argument is '+left+".")}function distance(call,left,right){if(typeof left=="number"&&typeof right=="number")return Math.abs(left-right);if(left instanceof Cesium.Cartesian2&&right instanceof Cesium.Cartesian2)return Cesium.Cartesian2.distance(left,right);if(left instanceof Cesium.Cartesian3&&right instanceof Cesium.Cartesian3)return Cesium.Cartesian3.distance(left,right);if(left instanceof Cesium.Cartesian4&&right instanceof Cesium.Cartesian4)return Cesium.Cartesian4.distance(left,right);throw new Cesium.RuntimeError('Function "'+call+'" requires vector or number arguments of matching types. Arguments are '+left+" and "+right+".")}function dot(call,left,right){if(typeof left=="number"&&typeof right=="number")return left*right;if(left instanceof Cesium.Cartesian2&&right instanceof Cesium.Cartesian2)return Cesium.Cartesian2.dot(left,right);if(left instanceof Cesium.Cartesian3&&right instanceof Cesium.Cartesian3)return Cesium.Cartesian3.dot(left,right);if(left instanceof Cesium.Cartesian4&&right instanceof Cesium.Cartesian4)return Cesium.Cartesian4.dot(left,right);throw new Cesium.RuntimeError('Function "'+call+'" requires vector or number arguments of matching types. Arguments are '+left+" and "+right+".")}function cross(call,left,right){if(left instanceof Cesium.Cartesian3&&right instanceof Cesium.Cartesian3)return Cesium.Cartesian3.cross(left,right,scratchStorage.getCartesian3());throw new Cesium.RuntimeError('Function "'+call+'" requires vec3 arguments. Arguments are '+left+" and "+right+".")}function Node(type,value,left,right,test){this._type=type,this._value=value,this._left=left,this._right=right,this._test=test,this.evaluate=void 0,setEvaluateFunction(this)}function replaceDefines(expression,defines){if(!Cesium.defined(defines))return expression;for(var key in defines)if(defines.hasOwnProperty(key)){var definePlaceholder=new RegExp("\\$\\{"+key+"\\}","g"),defineReplace="("+defines[key]+")";Cesium.defined(defineReplace)&&(expression=expression.replace(definePlaceholder,defineReplace))}return expression}function removeBackslashes(expression){return expression.replace(backslashRegex,backslashReplacement)}function replaceBackslashes(expression){return expression.replace(replacementRegex,"\\")}function replaceVariables(expression){for(var exp3=expression,result="",i=exp3.indexOf("${");i>=0;){var openSingleQuote=exp3.indexOf("'"),openDoubleQuote=exp3.indexOf('"'),closeQuote;if(openSingleQuote>=0&&openSingleQuote<i)closeQuote=exp3.indexOf("'",openSingleQuote+1),result+=exp3.substr(0,closeQuote+1),exp3=exp3.substr(closeQuote+1),i=exp3.indexOf("${");else if(openDoubleQuote>=0&&openDoubleQuote<i)closeQuote=exp3.indexOf('"',openDoubleQuote+1),result+=exp3.substr(0,closeQuote+1),exp3=exp3.substr(closeQuote+1),i=exp3.indexOf("${");else{result+=exp3.substr(0,i);var j=exp3.indexOf("}");if(j<0)throw new Cesium.RuntimeError("Unmatched {.");result+="czm_"+exp3.substr(i+2,j-(i+2)),exp3=exp3.substr(j+1),i=exp3.indexOf("${")}}return result+=exp3,result}function parseLiteral(ast){var type=typeof ast.value;if(ast.value===null)return new Node(Cesium.ExpressionNodeType.LITERAL_NULL,null);if(type==="boolean")return new Node(Cesium.ExpressionNodeType.LITERAL_BOOLEAN,ast.value);if(type==="number")return new Node(Cesium.ExpressionNodeType.LITERAL_NUMBER,ast.value);if(type==="string")return ast.value.indexOf("${")>=0?new Node(Cesium.ExpressionNodeType.VARIABLE_IN_STRING,ast.value):new Node(Cesium.ExpressionNodeType.LITERAL_STRING,replaceBackslashes(ast.value))}function parseCall(expression,ast){var args=ast.arguments,argsLength=args.length,call,val,left,right;if(ast.callee.type==="MemberExpression"){call=ast.callee.property.name;var object2=ast.callee.object;if(call==="test"||call==="exec"){if(object2.callee.name!=="regExp")throw new Cesium.RuntimeError(call+" is not a function.");return argsLength===0?call==="test"?new Node(Cesium.ExpressionNodeType.LITERAL_BOOLEAN,!1):new Node(Cesium.ExpressionNodeType.LITERAL_NULL,null):(left=createRuntimeAst(expression,object2),right=createRuntimeAst(expression,args[0]),new Node(Cesium.ExpressionNodeType.FUNCTION_CALL,call,left,right))}else if(call==="toString")return val=createRuntimeAst(expression,object2),new Node(Cesium.ExpressionNodeType.FUNCTION_CALL,call,val);throw new Cesium.RuntimeError('Unexpected function call "'+call+'".')}if(call=ast.callee.name,call==="color"){if(argsLength===0)return new Node(Cesium.ExpressionNodeType.LITERAL_COLOR,call);if(val=createRuntimeAst(expression,args[0]),Cesium.defined(args[1])){var alpha=createRuntimeAst(expression,args[1]);return new Node(Cesium.ExpressionNodeType.LITERAL_COLOR,call,[val,alpha])}return new Node(Cesium.ExpressionNodeType.LITERAL_COLOR,call,[val])}else if(call==="rgb"||call==="hsl"){if(argsLength<3)throw new Cesium.RuntimeError(call+" requires three arguments.");return val=[createRuntimeAst(expression,args[0]),createRuntimeAst(expression,args[1]),createRuntimeAst(expression,args[2])],new Node(Cesium.ExpressionNodeType.LITERAL_COLOR,call,val)}else if(call==="rgba"||call==="hsla"){if(argsLength<4)throw new Cesium.RuntimeError(call+" requires four arguments.");return val=[createRuntimeAst(expression,args[0]),createRuntimeAst(expression,args[1]),createRuntimeAst(expression,args[2]),createRuntimeAst(expression,args[3])],new Node(Cesium.ExpressionNodeType.LITERAL_COLOR,call,val)}else if(call==="vec2"||call==="vec3"||call==="vec4"){val=new Array(argsLength);for(var i=0;i<argsLength;++i)val[i]=createRuntimeAst(expression,args[i]);return new Node(Cesium.ExpressionNodeType.LITERAL_VECTOR,call,val)}else{if(call==="isNaN"||call==="isFinite")return argsLength===0?call==="isNaN"?new Node(Cesium.ExpressionNodeType.LITERAL_BOOLEAN,!0):new Node(Cesium.ExpressionNodeType.LITERAL_BOOLEAN,!1):(val=createRuntimeAst(expression,args[0]),new Node(Cesium.ExpressionNodeType.UNARY,call,val));if(call==="isExactClass"||call==="isClass"){if(argsLength<1||argsLength>1)throw new Cesium.RuntimeError(call+" requires exactly one argument.");return val=createRuntimeAst(expression,args[0]),new Node(Cesium.ExpressionNodeType.UNARY,call,val)}else if(call==="getExactClassName"){if(argsLength>0)throw new Cesium.RuntimeError(call+" does not take any argument.");return new Node(Cesium.ExpressionNodeType.UNARY,call)}else if(Cesium.defined(unaryFunctions[call])){if(argsLength!==1)throw new Cesium.RuntimeError(call+" requires exactly one argument.");return val=createRuntimeAst(expression,args[0]),new Node(Cesium.ExpressionNodeType.UNARY,call,val)}else if(Cesium.defined(binaryFunctions[call])){if(argsLength!==2)throw new Cesium.RuntimeError(call+" requires exactly two arguments.");return left=createRuntimeAst(expression,args[0]),right=createRuntimeAst(expression,args[1]),new Node(Cesium.ExpressionNodeType.BINARY,call,left,right)}else if(Cesium.defined(ternaryFunctions[call])){if(argsLength!==3)throw new Cesium.RuntimeError(call+" requires exactly three arguments.");left=createRuntimeAst(expression,args[0]),right=createRuntimeAst(expression,args[1]);var test=createRuntimeAst(expression,args[2]);return new Node(Cesium.ExpressionNodeType.TERNARY,call,left,right,test)}else{if(call==="Boolean")return argsLength===0?new Node(Cesium.ExpressionNodeType.LITERAL_BOOLEAN,!1):(val=createRuntimeAst(expression,args[0]),new Node(Cesium.ExpressionNodeType.UNARY,call,val));if(call==="Number")return argsLength===0?new Node(Cesium.ExpressionNodeType.LITERAL_NUMBER,0):(val=createRuntimeAst(expression,args[0]),new Node(Cesium.ExpressionNodeType.UNARY,call,val));if(call==="String")return argsLength===0?new Node(Cesium.ExpressionNodeType.LITERAL_STRING,""):(val=createRuntimeAst(expression,args[0]),new Node(Cesium.ExpressionNodeType.UNARY,call,val));if(call==="regExp")return parseRegex(expression,ast)}}throw new Cesium.RuntimeError('Unexpected function call "'+call+'".')}function parseRegex(expression,ast){var args=ast.arguments;if(args.length===0)return new Node(Cesium.ExpressionNodeType.LITERAL_REGEX,new RegExp);var pattern=createRuntimeAst(expression,args[0]),exp3;if(args.length>1){var flags=createRuntimeAst(expression,args[1]);if(isLiteralType(pattern)&&isLiteralType(flags)){try{exp3=new RegExp(replaceBackslashes(String(pattern._value)),flags._value)}catch(e){throw new Cesium.RuntimeError(e)}return new Node(Cesium.ExpressionNodeType.LITERAL_REGEX,exp3)}return new Node(Cesium.ExpressionNodeType.REGEX,pattern,flags)}if(isLiteralType(pattern)){try{exp3=new RegExp(replaceBackslashes(String(pattern._value)))}catch(e){throw new Cesium.RuntimeError(e)}return new Node(Cesium.ExpressionNodeType.LITERAL_REGEX,exp3)}return new Node(Cesium.ExpressionNodeType.REGEX,pattern)}function parseKeywordsAndVariables(ast){if(isVariable(ast.name)){var name=getPropertyName(ast.name);return name.substr(0,8)==="tiles3d_"?new Node(Cesium.ExpressionNodeType.BUILTIN_VARIABLE,name):new Node(Cesium.ExpressionNodeType.VARIABLE,name)}else{if(ast.name==="NaN")return new Node(Cesium.ExpressionNodeType.LITERAL_NUMBER,NaN);if(ast.name==="Infinity")return new Node(Cesium.ExpressionNodeType.LITERAL_NUMBER,1/0);if(ast.name==="undefined")return new Node(Cesium.ExpressionNodeType.LITERAL_UNDEFINED,void 0)}throw new Cesium.RuntimeError(ast.name+" is not defined.")}function parseMathConstant(ast){var name=ast.property.name;if(name==="PI")return new Node(Cesium.ExpressionNodeType.LITERAL_NUMBER,Math.PI);if(name==="E")return new Node(Cesium.ExpressionNodeType.LITERAL_NUMBER,Math.E)}function parseNumberConstant(ast){var name=ast.property.name;if(name==="POSITIVE_INFINITY")return new Node(Cesium.ExpressionNodeType.LITERAL_NUMBER,Number.POSITIVE_INFINITY)}function parseMemberExpression(expression,ast){if(ast.object.name==="Math")return parseMathConstant(ast);if(ast.object.name==="Number")return parseNumberConstant(ast);var val,obj=createRuntimeAst(expression,ast.object);return ast.computed?(val=createRuntimeAst(expression,ast.property),new Node(Cesium.ExpressionNodeType.MEMBER,"brackets",obj,val)):(val=new Node(Cesium.ExpressionNodeType.LITERAL_STRING,ast.property.name),new Node(Cesium.ExpressionNodeType.MEMBER,"dot",obj,val))}function isLiteralType(node){return node._type>=Cesium.ExpressionNodeType.LITERAL_NULL}function isVariable(name){return name.substr(0,4)==="czm_"}function getPropertyName(variable){return variable.substr(4)}function createRuntimeAst(expression,ast){var node,op,left,right;if(ast.type==="Literal")node=parseLiteral(ast);else if(ast.type==="CallExpression")node=parseCall(expression,ast);else if(ast.type==="Identifier")node=parseKeywordsAndVariables(ast);else if(ast.type==="UnaryExpression"){op=ast.operator;var child=createRuntimeAst(expression,ast.argument);if(unaryOperators.indexOf(op)>-1)node=new Node(Cesium.ExpressionNodeType.UNARY,op,child);else throw new Cesium.RuntimeError('Unexpected operator "'+op+'".')}else if(ast.type==="BinaryExpression")if(op=ast.operator,left=createRuntimeAst(expression,ast.left),right=createRuntimeAst(expression,ast.right),binaryOperators.indexOf(op)>-1)node=new Node(Cesium.ExpressionNodeType.BINARY,op,left,right);else throw new Cesium.RuntimeError('Unexpected operator "'+op+'".');else if(ast.type==="LogicalExpression")op=ast.operator,left=createRuntimeAst(expression,ast.left),right=createRuntimeAst(expression,ast.right),binaryOperators.indexOf(op)>-1&&(node=new Node(Cesium.ExpressionNodeType.BINARY,op,left,right));else if(ast.type==="ConditionalExpression"){var test=createRuntimeAst(expression,ast.test);left=createRuntimeAst(expression,ast.consequent),right=createRuntimeAst(expression,ast.alternate),node=new Node(Cesium.ExpressionNodeType.CONDITIONAL,"?",left,right,test)}else if(ast.type==="MemberExpression")node=parseMemberExpression(expression,ast);else if(ast.type==="ArrayExpression"){for(var val=[],i=0;i<ast.elements.length;i++)val[i]=createRuntimeAst(expression,ast.elements[i]);node=new Node(Cesium.ExpressionNodeType.ARRAY,val)}else throw ast.type==="Compound"?new Cesium.RuntimeError("Provide exactly one expression."):new Cesium.RuntimeError("Cannot parse expression.");return node}function setEvaluateFunction(node){node._type===Cesium.ExpressionNodeType.CONDITIONAL?node.evaluate=node._evaluateConditional:node._type===Cesium.ExpressionNodeType.FUNCTION_CALL?node._value==="test"?node.evaluate=node._evaluateRegExpTest:node._value==="exec"?node.evaluate=node._evaluateRegExpExec:node._value==="toString"&&(node.evaluate=node._evaluateToString):node._type===Cesium.ExpressionNodeType.UNARY?node._value==="!"?node.evaluate=node._evaluateNot:node._value==="-"?node.evaluate=node._evaluateNegative:node._value==="+"?node.evaluate=node._evaluatePositive:node._value==="isNaN"?node.evaluate=node._evaluateNaN:node._value==="isFinite"?node.evaluate=node._evaluateIsFinite:node._value==="isExactClass"?node.evaluate=node._evaluateIsExactClass:node._value==="isClass"?node.evaluate=node._evaluateIsClass:node._value==="getExactClassName"?node.evaluate=node._evaluateGetExactClassName:node._value==="Boolean"?node.evaluate=node._evaluateBooleanConversion:node._value==="Number"?node.evaluate=node._evaluateNumberConversion:node._value==="String"?node.evaluate=node._evaluateStringConversion:Cesium.defined(unaryFunctions[node._value])&&(node.evaluate=getEvaluateUnaryFunction(node._value)):node._type===Cesium.ExpressionNodeType.BINARY?node._value==="+"?node.evaluate=node._evaluatePlus:node._value==="-"?node.evaluate=node._evaluateMinus:node._value==="*"?node.evaluate=node._evaluateTimes:node._value==="/"?node.evaluate=node._evaluateDivide:node._value==="%"?node.evaluate=node._evaluateMod:node._value==="==="?node.evaluate=node._evaluateEqualsStrict:node._value==="!=="?node.evaluate=node._evaluateNotEqualsStrict:node._value==="<"?node.evaluate=node._evaluateLessThan:node._value==="<="?node.evaluate=node._evaluateLessThanOrEquals:node._value===">"?node.evaluate=node._evaluateGreaterThan:node._value===">="?node.evaluate=node._evaluateGreaterThanOrEquals:node._value==="&&"?node.evaluate=node._evaluateAnd:node._value==="||"?node.evaluate=node._evaluateOr:node._value==="=~"?node.evaluate=node._evaluateRegExpMatch:node._value==="!~"?node.evaluate=node._evaluateRegExpNotMatch:Cesium.defined(binaryFunctions[node._value])&&(node.evaluate=getEvaluateBinaryFunction(node._value)):node._type===Cesium.ExpressionNodeType.TERNARY?node.evaluate=getEvaluateTernaryFunction(node._value):node._type===Cesium.ExpressionNodeType.MEMBER?node._value==="brackets"?node.evaluate=node._evaluateMemberBrackets:node.evaluate=node._evaluateMemberDot:node._type===Cesium.ExpressionNodeType.ARRAY?node.evaluate=node._evaluateArray:node._type===Cesium.ExpressionNodeType.VARIABLE?node.evaluate=node._evaluateVariable:node._type===Cesium.ExpressionNodeType.VARIABLE_IN_STRING?node.evaluate=node._evaluateVariableString:node._type===Cesium.ExpressionNodeType.LITERAL_COLOR?node.evaluate=node._evaluateLiteralColor:node._type===Cesium.ExpressionNodeType.LITERAL_VECTOR?node.evaluate=node._evaluateLiteralVector:node._type===Cesium.ExpressionNodeType.LITERAL_STRING?node.evaluate=node._evaluateLiteralString:node._type===Cesium.ExpressionNodeType.REGEX?node.evaluate=node._evaluateRegExp:node._type===Cesium.ExpressionNodeType.BUILTIN_VARIABLE?node._value==="tiles3d_tileset_time"&&(node.evaluate=evaluateTilesetTime):node.evaluate=node._evaluateLiteral}function evaluateTilesetTime(feature2){return Cesium.defined(feature2)?feature2.content.tileset.timeSinceLoad:0}function getEvaluateUnaryFunction(call){var evaluate=unaryFunctions[call];return function(feature2){var left=this._left.evaluate(feature2);return evaluate(call,left)}}function getEvaluateBinaryFunction(call){var evaluate=binaryFunctions[call];return function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);return evaluate(call,left,right)}}function getEvaluateTernaryFunction(call){var evaluate=ternaryFunctions[call];return function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2),test=this._test.evaluate(feature2);return evaluate(call,left,right,test)}}function getFeatureProperty(feature2,name){if(Cesium.defined(feature2))return feature2.getProperty(name)}Node.prototype._evaluateLiteral=function(){return this._value};Node.prototype._evaluateLiteralColor=function(feature2){var color=scratchColor7,args=this._left;if(this._value==="color")Cesium.defined(args)?args.length>1?(Cesium.Color.fromCssColorString(args[0].evaluate(feature2),color),color.alpha=args[1].evaluate(feature2)):Cesium.Color.fromCssColorString(args[0].evaluate(feature2),color):Cesium.Color.fromBytes(255,255,255,255,color);else if(this._value==="rgb")Cesium.Color.fromBytes(args[0].evaluate(feature2),args[1].evaluate(feature2),args[2].evaluate(feature2),255,color);else if(this._value==="rgba"){var a=args[3].evaluate(feature2)*255;Cesium.Color.fromBytes(args[0].evaluate(feature2),args[1].evaluate(feature2),args[2].evaluate(feature2),a,color)}else this._value==="hsl"?Cesium.Color.fromHsl(args[0].evaluate(feature2),args[1].evaluate(feature2),args[2].evaluate(feature2),1,color):this._value==="hsla"&&Cesium.Color.fromHsl(args[0].evaluate(feature2),args[1].evaluate(feature2),args[2].evaluate(feature2),args[3].evaluate(feature2),color);return Cesium.Cartesian4.fromColor(color,scratchStorage.getCartesian4())};Node.prototype._evaluateLiteralVector=function(feature2){for(var components=scratchStorage.getArray(),call=this._value,args=this._left,argsLength=args.length,i=0;i<argsLength;++i){var value=args[i].evaluate(feature2);if(typeof value=="number")components.push(value);else if(value instanceof Cesium.Cartesian2)components.push(value.x,value.y);else if(value instanceof Cesium.Cartesian3)components.push(value.x,value.y,value.z);else if(value instanceof Cesium.Cartesian4)components.push(value.x,value.y,value.z,value.w);else throw new Cesium.RuntimeError(call+" argument must be a vector or number. Argument is "+value+".")}var componentsLength=components.length,vectorLength=parseInt(call.charAt(3));if(componentsLength===0)throw new Cesium.RuntimeError("Invalid "+call+" constructor. No valid arguments.");if(componentsLength<vectorLength&&componentsLength>1)throw new Cesium.RuntimeError("Invalid "+call+" constructor. Not enough arguments.");if(componentsLength>vectorLength&&argsLength>1)throw new Cesium.RuntimeError("Invalid "+call+" constructor. Too many arguments.");if(componentsLength===1){var component=components[0];components.push(component,component,component)}if(call==="vec2")return Cesium.Cartesian2.fromArray(components,0,scratchStorage.getCartesian2());if(call==="vec3")return Cesium.Cartesian3.fromArray(components,0,scratchStorage.getCartesian3());if(call==="vec4")return Cesium.Cartesian4.fromArray(components,0,scratchStorage.getCartesian4())};Node.prototype._evaluateLiteralString=function(){return this._value};Node.prototype._evaluateVariableString=function(feature2){for(var result=this._value,match=variableRegex.exec(result);match!==null;){var placeholder=match[0],variableName=match[1],property=getFeatureProperty(feature2,variableName);Cesium.defined(property)||(property=""),result=result.replace(placeholder,property),match=variableRegex.exec(result)}return result};Node.prototype._evaluateVariable=function(feature2){return getFeatureProperty(feature2,this._value)};function checkFeature(ast){return ast._value==="feature"}Node.prototype._evaluateMemberDot=function(feature2){if(checkFeature(this._left))return getFeatureProperty(feature2,this._right.evaluate(feature2));var property=this._left.evaluate(feature2);if(!!Cesium.defined(property)){var member=this._right.evaluate(feature2);if(property instanceof Cesium.Cartesian2||property instanceof Cesium.Cartesian3||property instanceof Cesium.Cartesian4){if(member==="r")return property.x;if(member==="g")return property.y;if(member==="b")return property.z;if(member==="a")return property.w}return property[member]}};Node.prototype._evaluateMemberBrackets=function(feature2){if(checkFeature(this._left))return getFeatureProperty(feature2,this._right.evaluate(feature2));var property=this._left.evaluate(feature2);if(!!Cesium.defined(property)){var member=this._right.evaluate(feature2);if(property instanceof Cesium.Cartesian2||property instanceof Cesium.Cartesian3||property instanceof Cesium.Cartesian4){if(member===0||member==="r")return property.x;if(member===1||member==="g")return property.y;if(member===2||member==="b")return property.z;if(member===3||member==="a")return property.w}return property[member]}};Node.prototype._evaluateArray=function(feature2){for(var array=[],i=0;i<this._value.length;i++)array[i]=this._value[i].evaluate(feature2);return array};Node.prototype._evaluateNot=function(feature2){var left=this._left.evaluate(feature2);if(typeof left!="boolean")throw new Cesium.RuntimeError('Operator "!" requires a boolean argument. Argument is '+left+".");return!left};Node.prototype._evaluateNegative=function(feature2){var left=this._left.evaluate(feature2);if(left instanceof Cesium.Cartesian2)return Cesium.Cartesian2.negate(left,scratchStorage.getCartesian2());if(left instanceof Cesium.Cartesian3)return Cesium.Cartesian3.negate(left,scratchStorage.getCartesian3());if(left instanceof Cesium.Cartesian4)return Cesium.Cartesian4.negate(left,scratchStorage.getCartesian4());if(typeof left=="number")return-left;throw new Cesium.RuntimeError('Operator "-" requires a vector or number argument. Argument is '+left+".")};Node.prototype._evaluatePositive=function(feature2){var left=this._left.evaluate(feature2);if(!(left instanceof Cesium.Cartesian2||left instanceof Cesium.Cartesian3||left instanceof Cesium.Cartesian4||typeof left=="number"))throw new Cesium.RuntimeError('Operator "+" requires a vector or number argument. Argument is '+left+".");return left};Node.prototype._evaluateLessThan=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(typeof left!="number"||typeof right!="number")throw new Cesium.RuntimeError('Operator "<" requires number arguments. Arguments are '+left+" and "+right+".");return left<right};Node.prototype._evaluateLessThanOrEquals=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(typeof left!="number"||typeof right!="number")throw new Cesium.RuntimeError('Operator "<=" requires number arguments. Arguments are '+left+" and "+right+".");return left<=right};Node.prototype._evaluateGreaterThan=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(typeof left!="number"||typeof right!="number")throw new Cesium.RuntimeError('Operator ">" requires number arguments. Arguments are '+left+" and "+right+".");return left>right};Node.prototype._evaluateGreaterThanOrEquals=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(typeof left!="number"&&typeof right!="number")throw new Cesium.RuntimeError('Operator ">=" requires number arguments. Arguments are '+left+" and "+right+".");return left>=right};Node.prototype._evaluateOr=function(feature2){var left=this._left.evaluate(feature2);if(typeof left!="boolean")throw new Cesium.RuntimeError('Operator "||" requires boolean arguments. First argument is '+left+".");if(left)return!0;var right=this._right.evaluate(feature2);if(typeof right!="boolean")throw new Cesium.RuntimeError('Operator "||" requires boolean arguments. Second argument is '+right+".");return left||right};Node.prototype._evaluateAnd=function(feature2){var left=this._left.evaluate(feature2);if(typeof left!="boolean")throw new Cesium.RuntimeError('Operator "&&" requires boolean arguments. First argument is '+left+".");if(!left)return!1;var right=this._right.evaluate(feature2);if(typeof right!="boolean")throw new Cesium.RuntimeError('Operator "&&" requires boolean arguments. Second argument is '+right+".");return left&&right};Node.prototype._evaluatePlus=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(right instanceof Cesium.Cartesian2&&left instanceof Cesium.Cartesian2)return Cesium.Cartesian2.add(left,right,scratchStorage.getCartesian2());if(right instanceof Cesium.Cartesian3&&left instanceof Cesium.Cartesian3)return Cesium.Cartesian3.add(left,right,scratchStorage.getCartesian3());if(right instanceof Cesium.Cartesian4&&left instanceof Cesium.Cartesian4)return Cesium.Cartesian4.add(left,right,scratchStorage.getCartesian4());if(typeof left=="string"||typeof right=="string")return left+right;if(typeof left=="number"&&typeof right=="number")return left+right;throw new Cesium.RuntimeError('Operator "+" requires vector or number arguments of matching types, or at least one string argument. Arguments are '+left+" and "+right+".")};Node.prototype._evaluateMinus=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(right instanceof Cesium.Cartesian2&&left instanceof Cesium.Cartesian2)return Cesium.Cartesian2.subtract(left,right,scratchStorage.getCartesian2());if(right instanceof Cesium.Cartesian3&&left instanceof Cesium.Cartesian3)return Cesium.Cartesian3.subtract(left,right,scratchStorage.getCartesian3());if(right instanceof Cesium.Cartesian4&&left instanceof Cesium.Cartesian4)return Cesium.Cartesian4.subtract(left,right,scratchStorage.getCartesian4());if(typeof left=="number"&&typeof right=="number")return left-right;throw new Cesium.RuntimeError('Operator "-" requires vector or number arguments of matching types. Arguments are '+left+" and "+right+".")};Node.prototype._evaluateTimes=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(right instanceof Cesium.Cartesian2&&left instanceof Cesium.Cartesian2)return Cesium.Cartesian2.multiplyComponents(left,right,scratchStorage.getCartesian2());if(right instanceof Cesium.Cartesian2&&typeof left=="number")return Cesium.Cartesian2.multiplyByScalar(right,left,scratchStorage.getCartesian2());if(left instanceof Cesium.Cartesian2&&typeof right=="number")return Cesium.Cartesian2.multiplyByScalar(left,right,scratchStorage.getCartesian2());if(right instanceof Cesium.Cartesian3&&left instanceof Cesium.Cartesian3)return Cesium.Cartesian3.multiplyComponents(left,right,scratchStorage.getCartesian3());if(right instanceof Cesium.Cartesian3&&typeof left=="number")return Cesium.Cartesian3.multiplyByScalar(right,left,scratchStorage.getCartesian3());if(left instanceof Cesium.Cartesian3&&typeof right=="number")return Cesium.Cartesian3.multiplyByScalar(left,right,scratchStorage.getCartesian3());if(right instanceof Cesium.Cartesian4&&left instanceof Cesium.Cartesian4)return Cesium.Cartesian4.multiplyComponents(left,right,scratchStorage.getCartesian4());if(right instanceof Cesium.Cartesian4&&typeof left=="number")return Cesium.Cartesian4.multiplyByScalar(right,left,scratchStorage.getCartesian4());if(left instanceof Cesium.Cartesian4&&typeof right=="number")return Cesium.Cartesian4.multiplyByScalar(left,right,scratchStorage.getCartesian4());if(typeof left=="number"&&typeof right=="number")return left*right;throw new Cesium.RuntimeError('Operator "*" requires vector or number arguments. If both arguments are vectors they must be matching types. Arguments are '+left+" and "+right+".")};Node.prototype._evaluateDivide=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(right instanceof Cesium.Cartesian2&&left instanceof Cesium.Cartesian2)return Cesium.Cartesian2.divideComponents(left,right,scratchStorage.getCartesian2());if(left instanceof Cesium.Cartesian2&&typeof right=="number")return Cesium.Cartesian2.divideByScalar(left,right,scratchStorage.getCartesian2());if(right instanceof Cesium.Cartesian3&&left instanceof Cesium.Cartesian3)return Cesium.Cartesian3.divideComponents(left,right,scratchStorage.getCartesian3());if(left instanceof Cesium.Cartesian3&&typeof right=="number")return Cesium.Cartesian3.divideByScalar(left,right,scratchStorage.getCartesian3());if(right instanceof Cesium.Cartesian4&&left instanceof Cesium.Cartesian4)return Cesium.Cartesian4.divideComponents(left,right,scratchStorage.getCartesian4());if(left instanceof Cesium.Cartesian4&&typeof right=="number")return Cesium.Cartesian4.divideByScalar(left,right,scratchStorage.getCartesian4());if(typeof left=="number"&&typeof right=="number")return left/right;throw new Cesium.RuntimeError('Operator "/" requires vector or number arguments of matching types, or a number as the second argument. Arguments are '+left+" and "+right+".")};Node.prototype._evaluateMod=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(right instanceof Cesium.Cartesian2&&left instanceof Cesium.Cartesian2)return Cesium.Cartesian2.fromElements(left.x%right.x,left.y%right.y,scratchStorage.getCartesian2());if(right instanceof Cesium.Cartesian3&&left instanceof Cesium.Cartesian3)return Cesium.Cartesian3.fromElements(left.x%right.x,left.y%right.y,left.z%right.z,scratchStorage.getCartesian3());if(right instanceof Cesium.Cartesian4&&left instanceof Cesium.Cartesian4)return Cesium.Cartesian4.fromElements(left.x%right.x,left.y%right.y,left.z%right.z,left.w%right.w,scratchStorage.getCartesian4());if(typeof left=="number"&&typeof right=="number")return left%right;throw new Cesium.RuntimeError('Operator "%" requires vector or number arguments of matching types. Arguments are '+left+" and "+right+".")};Node.prototype._evaluateEqualsStrict=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);return right instanceof Cesium.Cartesian2&&left instanceof Cesium.Cartesian2||right instanceof Cesium.Cartesian3&&left instanceof Cesium.Cartesian3||right instanceof Cesium.Cartesian4&&left instanceof Cesium.Cartesian4?left.equals(right):left===right};Node.prototype._evaluateNotEqualsStrict=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);return right instanceof Cesium.Cartesian2&&left instanceof Cesium.Cartesian2||right instanceof Cesium.Cartesian3&&left instanceof Cesium.Cartesian3||right instanceof Cesium.Cartesian4&&left instanceof Cesium.Cartesian4?!left.equals(right):left!==right};Node.prototype._evaluateConditional=function(feature2){var test=this._test.evaluate(feature2);if(typeof test!="boolean")throw new Cesium.RuntimeError("Conditional argument of conditional expression must be a boolean. Argument is "+test+".");return test?this._left.evaluate(feature2):this._right.evaluate(feature2)};Node.prototype._evaluateNaN=function(feature2){return isNaN(this._left.evaluate(feature2))};Node.prototype._evaluateIsFinite=function(feature2){return isFinite(this._left.evaluate(feature2))};Node.prototype._evaluateIsExactClass=function(feature2){return Cesium.defined(feature2)?feature2.isExactClass(this._left.evaluate(feature2)):!1};Node.prototype._evaluateIsClass=function(feature2){return Cesium.defined(feature2)?feature2.isClass(this._left.evaluate(feature2)):!1};Node.prototype._evaluateGetExactClassName=function(feature2){if(Cesium.defined(feature2))return feature2.getExactClassName()};Node.prototype._evaluateBooleanConversion=function(feature2){return Boolean(this._left.evaluate(feature2))};Node.prototype._evaluateNumberConversion=function(feature2){return Number(this._left.evaluate(feature2))};Node.prototype._evaluateStringConversion=function(feature2){return String(this._left.evaluate(feature2))};Node.prototype._evaluateRegExp=function(feature2){var pattern=this._value.evaluate(feature2),flags="";Cesium.defined(this._left)&&(flags=this._left.evaluate(feature2));var exp3;try{exp3=new RegExp(pattern,flags)}catch(e){throw new Cesium.RuntimeError(e)}return exp3};Node.prototype._evaluateRegExpTest=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(!(left instanceof RegExp&&typeof right=="string"))throw new Cesium.RuntimeError("RegExp.test requires the first argument to be a RegExp and the second argument to be a string. Arguments are "+left+" and "+right+".");return left.test(right)};Node.prototype._evaluateRegExpMatch=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(left instanceof RegExp&&typeof right=="string")return left.test(right);if(right instanceof RegExp&&typeof left=="string")return right.test(left);throw new Cesium.RuntimeError('Operator "=~" requires one RegExp argument and one string argument. Arguments are '+left+" and "+right+".")};Node.prototype._evaluateRegExpNotMatch=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(left instanceof RegExp&&typeof right=="string")return!left.test(right);if(right instanceof RegExp&&typeof left=="string")return!right.test(left);throw new Cesium.RuntimeError('Operator "!~" requires one RegExp argument and one string argument. Arguments are '+left+" and "+right+".")};Node.prototype._evaluateRegExpExec=function(feature2){var left=this._left.evaluate(feature2),right=this._right.evaluate(feature2);if(!(left instanceof RegExp&&typeof right=="string"))throw new Cesium.RuntimeError("RegExp.exec requires the first argument to be a RegExp and the second argument to be a string. Arguments are "+left+" and "+right+".");var exec=left.exec(right);return Cesium.defined(exec)?exec[1]:null};Node.prototype._evaluateToString=function(feature2){var left=this._left.evaluate(feature2);if(left instanceof RegExp||left instanceof Cesium.Cartesian2||left instanceof Cesium.Cartesian3||left instanceof Cesium.Cartesian4)return String(left);throw new Cesium.RuntimeError('Unexpected function call "'+this._value+'".')};function convertHSLToRGB(ast){for(var channels=ast._left,length3=channels.length,i=0;i<length3;++i)if(channels[i]._type!==Cesium.ExpressionNodeType.LITERAL_NUMBER)return;var h=channels[0]._value,s=channels[1]._value,l=channels[2]._value,a=length3===4?channels[3]._value:1;return Cesium.Color.fromHsl(h,s,l,a,scratchColor7)}function convertRGBToColor(ast){for(var channels=ast._left,length3=channels.length,i=0;i<length3;++i)if(channels[i]._type!==Cesium.ExpressionNodeType.LITERAL_NUMBER)return;var color=scratchColor7;return color.red=channels[0]._value/255,color.green=channels[1]._value/255,color.blue=channels[2]._value/255,color.alpha=length3===4?channels[3]._value:1,color}function numberToString(number){return number%1===0?number.toFixed(1):number.toString()}function colorToVec3(color){var r=numberToString(color.red),g=numberToString(color.green),b=numberToString(color.blue);return"vec3("+r+", "+g+", "+b+")"}function colorToVec4(color){var r=numberToString(color.red),g=numberToString(color.green),b=numberToString(color.blue),a=numberToString(color.alpha);return"vec4("+r+", "+g+", "+b+", "+a+")"}function getExpressionArray(array,attributePrefix,shaderState,parent){for(var length3=array.length,expressions=new Array(length3),i=0;i<length3;++i)expressions[i]=array[i].getShaderExpression(attributePrefix,shaderState,parent);return expressions}var nullSentinel="czm_infinity";Node.prototype.getShaderExpression=function(attributePrefix,shaderState,parent){var color,left,right,test,type=this._type,value=this._value;switch(Cesium.defined(this._left)&&(Array.isArray(this._left)?left=getExpressionArray(this._left,attributePrefix,shaderState,this):left=this._left.getShaderExpression(attributePrefix,shaderState,this)),Cesium.defined(this._right)&&(right=this._right.getShaderExpression(attributePrefix,shaderState,this)),Cesium.defined(this._test)&&(test=this._test.getShaderExpression(attributePrefix,shaderState,this)),Array.isArray(this._value)&&(value=getExpressionArray(this._value,attributePrefix,shaderState,this)),type){case Cesium.ExpressionNodeType.VARIABLE:return attributePrefix+value;case Cesium.ExpressionNodeType.UNARY:if(value==="Boolean")return"bool("+left+")";if(value==="Number")return"float("+left+")";if(value==="round")return"floor("+left+" + 0.5)";if(Cesium.defined(unaryFunctions[value]))return value+"("+left+")";if(value==="isNaN")return"("+left+" != "+left+")";if(value==="isFinite")return"(abs("+left+") < czm_infinity)";if(value==="String"||value==="isExactClass"||value==="isClass"||value==="getExactClassName")throw new Cesium.RuntimeError('Error generating style shader: "'+value+'" is not supported.');return Cesium.defined(unaryFunctions[value])?value+"("+left+")":value+left;case Cesium.ExpressionNodeType.BINARY:return value==="%"?"mod("+left+", "+right+")":value==="==="?"("+left+" == "+right+")":value==="!=="?"("+left+" != "+right+")":value==="atan2"?"atan("+left+", "+right+")":Cesium.defined(binaryFunctions[value])?value+"("+left+", "+right+")":"("+left+" "+value+" "+right+")";case Cesium.ExpressionNodeType.TERNARY:if(Cesium.defined(ternaryFunctions[value]))return value+"("+left+", "+right+", "+test+")";break;case Cesium.ExpressionNodeType.CONDITIONAL:return"("+test+" ? "+left+" : "+right+")";case Cesium.ExpressionNodeType.MEMBER:return right==="r"||right==="x"||right==="0.0"?left+"[0]":right==="g"||right==="y"||right==="1.0"?left+"[1]":right==="b"||right==="z"||right==="2.0"?left+"[2]":right==="a"||right==="w"||right==="3.0"?left+"[3]":left+"[int("+right+")]";case Cesium.ExpressionNodeType.FUNCTION_CALL:throw new Cesium.RuntimeError('Error generating style shader: "'+value+'" is not supported.');case Cesium.ExpressionNodeType.ARRAY:if(value.length===4)return"vec4("+value[0]+", "+value[1]+", "+value[2]+", "+value[3]+")";if(value.length===3)return"vec3("+value[0]+", "+value[1]+", "+value[2]+")";if(value.length===2)return"vec2("+value[0]+", "+value[1]+")";throw new Cesium.RuntimeError("Error generating style shader: Invalid array length. Array length should be 2, 3, or 4.");case Cesium.ExpressionNodeType.REGEX:throw new Cesium.RuntimeError("Error generating style shader: Regular expressions are not supported.");case Cesium.ExpressionNodeType.VARIABLE_IN_STRING:throw new Cesium.RuntimeError("Error generating style shader: Converting a variable to a string is not supported.");case Cesium.ExpressionNodeType.LITERAL_NULL:return nullSentinel;case Cesium.ExpressionNodeType.LITERAL_BOOLEAN:return value?"true":"false";case Cesium.ExpressionNodeType.LITERAL_NUMBER:return numberToString(value);case Cesium.ExpressionNodeType.LITERAL_STRING:if(Cesium.defined(parent)&&parent._type===Cesium.ExpressionNodeType.MEMBER&&(value==="r"||value==="g"||value==="b"||value==="a"||value==="x"||value==="y"||value==="z"||value==="w"))return value;if(color=Cesium.Color.fromCssColorString(value,scratchColor7),Cesium.defined(color))return colorToVec3(color);throw new Cesium.RuntimeError("Error generating style shader: String literals are not supported.");case Cesium.ExpressionNodeType.LITERAL_COLOR:var args=left;if(value==="color"){if(Cesium.defined(args)){if(args.length>1){var rgb=args[0],alpha=args[1];return alpha!=="1.0"&&(shaderState.translucent=!0),"vec4("+rgb+", "+alpha+")"}}else return"vec4(1.0)";return"vec4("+args[0]+", 1.0)"}else{if(value==="rgb")return color=convertRGBToColor(this),Cesium.defined(color)?colorToVec4(color):"vec4("+args[0]+" / 255.0, "+args[1]+" / 255.0, "+args[2]+" / 255.0, 1.0)";if(value==="rgba")return args[3]!=="1.0"&&(shaderState.translucent=!0),color=convertRGBToColor(this),Cesium.defined(color)?colorToVec4(color):"vec4("+args[0]+" / 255.0, "+args[1]+" / 255.0, "+args[2]+" / 255.0, "+args[3]+")";if(value==="hsl")return color=convertHSLToRGB(this),Cesium.defined(color)?colorToVec4(color):"vec4(czm_HSLToRGB(vec3("+args[0]+", "+args[1]+", "+args[2]+")), 1.0)";if(value==="hsla")return color=convertHSLToRGB(this),Cesium.defined(color)?(color.alpha!==1&&(shaderState.translucent=!0),colorToVec4(color)):(args[3]!=="1.0"&&(shaderState.translucent=!0),"vec4(czm_HSLToRGB(vec3("+args[0]+", "+args[1]+", "+args[2]+")), "+args[3]+")")}break;case Cesium.ExpressionNodeType.LITERAL_VECTOR:for(var length3=left.length,vectorExpression=value+"(",i=0;i<length3;++i)vectorExpression+=left[i],i<length3-1&&(vectorExpression+=", ");return vectorExpression+=")",vectorExpression;case Cesium.ExpressionNodeType.LITERAL_REGEX:throw new Cesium.RuntimeError("Error generating style shader: Regular expressions are not supported.");case Cesium.ExpressionNodeType.LITERAL_UNDEFINED:return nullSentinel;case Cesium.ExpressionNodeType.BUILTIN_VARIABLE:if(value==="tiles3d_tileset_time")return"u_time"}};var Expression_default=Expression;function ConditionsExpression(conditionsExpression,defines){this._conditionsExpression=Cesium.clone(conditionsExpression,!0),this._conditions=conditionsExpression.conditions,this._runtimeConditions=void 0,setRuntime(this,defines)}Object.defineProperties(ConditionsExpression.prototype,{conditionsExpression:{get:function(){return this._conditionsExpression}}});function Statement(condition,expression){this.condition=condition,this.expression=expression}function setRuntime(expression,defines){var runtimeConditions=[],conditions=expression._conditions;if(!!Cesium.defined(conditions)){for(var length3=conditions.length,i=0;i<length3;++i){var statement=conditions[i],cond=String(statement[0]),condExpression=String(statement[1]);runtimeConditions.push(new Statement(new Expression_default(cond,defines),new Expression_default(condExpression,defines)))}expression._runtimeConditions=runtimeConditions}}ConditionsExpression.prototype.evaluate=function(feature2,result){var conditions=this._runtimeConditions;if(!!Cesium.defined(conditions))for(var length3=conditions.length,i=0;i<length3;++i){var statement=conditions[i];if(statement.condition.evaluate(feature2))return statement.expression.evaluate(feature2,result)}};ConditionsExpression.prototype.evaluateColor=function(feature2,result){var conditions=this._runtimeConditions;if(!!Cesium.defined(conditions))for(var length3=conditions.length,i=0;i<length3;++i){var statement=conditions[i];if(statement.condition.evaluate(feature2))return statement.expression.evaluateColor(feature2,result)}};ConditionsExpression.prototype.getShaderFunction=function(functionName,attributePrefix,shaderState,returnType){var conditions=this._runtimeConditions;if(!(!Cesium.defined(conditions)||conditions.length===0)){for(var shaderFunction="",length3=conditions.length,i=0;i<length3;++i){var statement=conditions[i],condition=statement.condition.getShaderExpression(attributePrefix,shaderState),expression=statement.expression.getShaderExpression(attributePrefix,shaderState);shaderFunction+="    "+(i===0?"if":"else if")+" ("+condition+`) 
    { 
        return `+expression+`; 
    } 
`}return shaderFunction=returnType+" "+functionName+`() 
{ 
`+shaderFunction+"    return "+returnType+`(1.0); 
} 
`,shaderFunction}};var ConditionsExpression_default=ConditionsExpression;function Cesium3DTileStyle(style){this._style={},this._ready=!1,this._show=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._labelColor=void 0,this._labelOutlineColor=void 0,this._labelOutlineWidth=void 0,this._font=void 0,this._labelStyle=void 0,this._labelText=void 0,this._backgroundColor=void 0,this._backgroundPadding=void 0,this._backgroundEnabled=void 0,this._scaleByDistance=void 0,this._translucencyByDistance=void 0,this._distanceDisplayCondition=void 0,this._heightOffset=void 0,this._anchorLineEnabled=void 0,this._anchorLineColor=void 0,this._image=void 0,this._disableDepthTestDistance=void 0,this._horizontalOrigin=void 0,this._verticalOrigin=void 0,this._labelHorizontalOrigin=void 0,this._labelVerticalOrigin=void 0,this._meta=void 0,this._colorShaderFunction=void 0,this._showShaderFunction=void 0,this._pointSizeShaderFunction=void 0,this._colorShaderFunctionReady=!1,this._showShaderFunctionReady=!1,this._pointSizeShaderFunctionReady=!1,this._colorShaderTranslucent=!1,this._exOffset=void 0,this._translation=void 0,this._scale=void 0,this._rotation=void 0;var promise;if(typeof style=="string"||style instanceof Cesium.Resource){var resource2=Cesium.Resource.createIfNeeded(style);promise=resource2.fetchJson(style)}else promise=when_default.resolve(style);var that=this;this._readyPromise=promise.then(function(styleJson){return setup(that,styleJson),that})}function setup(that,styleJson){styleJson=Cesium.defaultValue(Cesium.clone(styleJson,!0),that._style),that._style=styleJson,that.show=styleJson.show,that.color=styleJson.color,that.pointSize=styleJson.pointSize,that.pointOutlineColor=styleJson.pointOutlineColor,that.pointOutlineWidth=styleJson.pointOutlineWidth,that.labelColor=styleJson.labelColor,that.labelOutlineColor=styleJson.labelOutlineColor,that.labelOutlineWidth=styleJson.labelOutlineWidth,that.labelStyle=styleJson.labelStyle,that.font=styleJson.font,that.labelText=styleJson.labelText,that.backgroundColor=styleJson.backgroundColor,that.backgroundPadding=styleJson.backgroundPadding,that.backgroundEnabled=styleJson.backgroundEnabled,that.scaleByDistance=styleJson.scaleByDistance,that.translucencyByDistance=styleJson.translucencyByDistance,that.distanceDisplayCondition=styleJson.distanceDisplayCondition,that.heightOffset=styleJson.heightOffset,that.anchorLineEnabled=styleJson.anchorLineEnabled,that.anchorLineColor=styleJson.anchorLineColor,that.image=styleJson.image,that.disableDepthTestDistance=styleJson.disableDepthTestDistance,that.horizontalOrigin=styleJson.horizontalOrigin,that.verticalOrigin=styleJson.verticalOrigin,that.labelHorizontalOrigin=styleJson.labelHorizontalOrigin,that.labelVerticalOrigin=styleJson.labelVerticalOrigin,that.exOffset=styleJson.exOffset,that.translation=styleJson.translation,that.scale=styleJson.scale,that.rotation=styleJson.rotation;var meta={};if(Cesium.defined(styleJson.meta)){var defines=styleJson.defines,metaJson=Cesium.defaultValue(styleJson.meta,Cesium.defaultValue.EMPTY_OBJECT);for(var property in metaJson)metaJson.hasOwnProperty(property)&&(meta[property]=new Expression_default(metaJson[property],defines))}that._meta=meta,that._ready=!0}function getExpression(tileStyle,value){var defines=Cesium.defaultValue(tileStyle._style,Cesium.defaultValue.EMPTY_OBJECT).defines;if(Cesium.defined(value)){if(typeof value=="boolean"||typeof value=="number")return new Expression_default(String(value));if(typeof value=="string")return new Expression_default(value,defines);if(Cesium.defined(value.conditions))return new ConditionsExpression_default(value,defines)}else return;return value}function getJsonFromExpression(expression){if(Cesium.defined(expression)){if(Cesium.defined(expression.expression))return expression.expression;if(Cesium.defined(expression.conditionsExpression))return Cesium.clone(expression.conditionsExpression,!0)}else return;return expression}Object.defineProperties(Cesium3DTileStyle.prototype,{style:{get:function(){return this._style}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},show:{get:function(){return this._show},set:function(value){this._show=getExpression(this,value),this._style.show=getJsonFromExpression(this._show),this._showShaderFunctionReady=!1}},color:{get:function(){return this._color},set:function(value){this._color=getExpression(this,value),this._style.color=getJsonFromExpression(this._color),this._colorShaderFunctionReady=!1}},pointSize:{get:function(){return this._pointSize},set:function(value){this._pointSize=getExpression(this,value),this._style.pointSize=getJsonFromExpression(this._pointSize),this._pointSizeShaderFunctionReady=!1}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(value){this._pointOutlineColor=getExpression(this,value),this._style.pointOutlineColor=getJsonFromExpression(this._pointOutlineColor)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(value){this._pointOutlineWidth=getExpression(this,value),this._style.pointOutlineWidth=getJsonFromExpression(this._pointOutlineWidth)}},labelColor:{get:function(){return this._labelColor},set:function(value){this._labelColor=getExpression(this,value),this._style.labelColor=getJsonFromExpression(this._labelColor)}},labelOutlineColor:{get:function(){return this._labelOutlineColor},set:function(value){this._labelOutlineColor=getExpression(this,value),this._style.labelOutlineColor=getJsonFromExpression(this._labelOutlineColor)}},labelOutlineWidth:{get:function(){return this._labelOutlineWidth},set:function(value){this._labelOutlineWidth=getExpression(this,value),this._style.labelOutlineWidth=getJsonFromExpression(this._labelOutlineWidth)}},font:{get:function(){return this._font},set:function(value){this._font=getExpression(this,value),this._style.font=getJsonFromExpression(this._font)}},labelStyle:{get:function(){return this._labelStyle},set:function(value){this._labelStyle=getExpression(this,value),this._style.labelStyle=getJsonFromExpression(this._labelStyle)}},labelText:{get:function(){return this._labelText},set:function(value){this._labelText=getExpression(this,value),this._style.labelText=getJsonFromExpression(this._labelText)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(value){this._backgroundColor=getExpression(this,value),this._style.backgroundColor=getJsonFromExpression(this._backgroundColor)}},backgroundPadding:{get:function(){return this._backgroundPadding},set:function(value){this._backgroundPadding=getExpression(this,value),this._style.backgroundPadding=getJsonFromExpression(this._backgroundPadding)}},backgroundEnabled:{get:function(){return this._backgroundEnabled},set:function(value){this._backgroundEnabled=getExpression(this,value),this._style.backgroundEnabled=getJsonFromExpression(this._backgroundEnabled)}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(value){this._scaleByDistance=getExpression(this,value),this._style.scaleByDistance=getJsonFromExpression(this._scaleByDistance)}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(value){this._translucencyByDistance=getExpression(this,value),this._style.translucencyByDistance=getJsonFromExpression(this._translucencyByDistance)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(value){this._distanceDisplayCondition=getExpression(this,value),this._style.distanceDisplayCondition=getJsonFromExpression(this._distanceDisplayCondition)}},heightOffset:{get:function(){return this._heightOffset},set:function(value){this._heightOffset=getExpression(this,value),this._style.heightOffset=getJsonFromExpression(this._heightOffset)}},exOffset:{get:function(){return this._exOffset},set:function(value){this._exOffset=getExpression(this,value),this._style.exOffset=getJsonFromExpression(this._exOffset)}},translation:{get:function(){return this._translation},set:function(value){this._translation=getExpression(this,value),this._style.translation=getJsonFromExpression(this._translation)}},scale:{get:function(){return this._scale},set:function(value){this._scale=getExpression(this,value),this._style.scale=getJsonFromExpression(this._scale)}},rotation:{get:function(){return this._rotation},set:function(value){this._rotation=getExpression(this,value),this._style.rotation=getJsonFromExpression(this._rotation)}},anchorLineEnabled:{get:function(){return this._anchorLineEnabled},set:function(value){this._anchorLineEnabled=getExpression(this,value),this._style.anchorLineEnabled=getJsonFromExpression(this._anchorLineEnabled)}},anchorLineColor:{get:function(){return this._anchorLineColor},set:function(value){this._anchorLineColor=getExpression(this,value),this._style.anchorLineColor=getJsonFromExpression(this._anchorLineColor)}},image:{get:function(){return this._image},set:function(value){this._image=getExpression(this,value),this._style.image=getJsonFromExpression(this._image)}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(value){this._disableDepthTestDistance=getExpression(this,value),this._style.disableDepthTestDistance=getJsonFromExpression(this._disableDepthTestDistance)}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(value){this._horizontalOrigin=getExpression(this,value),this._style.horizontalOrigin=getJsonFromExpression(this._horizontalOrigin)}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(value){this._verticalOrigin=getExpression(this,value),this._style.verticalOrigin=getJsonFromExpression(this._verticalOrigin)}},labelHorizontalOrigin:{get:function(){return this._labelHorizontalOrigin},set:function(value){this._labelHorizontalOrigin=getExpression(this,value),this._style.labelHorizontalOrigin=getJsonFromExpression(this._labelHorizontalOrigin)}},labelVerticalOrigin:{get:function(){return this._labelVerticalOrigin},set:function(value){this._labelVerticalOrigin=getExpression(this,value),this._style.labelVerticalOrigin=getJsonFromExpression(this._labelVerticalOrigin)}},meta:{get:function(){return this._meta},set:function(value){this._meta=value}}});Cesium3DTileStyle.prototype.getColorShaderFunction=function(functionName,attributePrefix,shaderState){return this._colorShaderFunctionReady?(shaderState.translucent=this._colorShaderTranslucent,this._colorShaderFunction):(this._colorShaderFunctionReady=!0,this._colorShaderFunction=Cesium.defined(this.color)?this.color.getShaderFunction(functionName,attributePrefix,shaderState,"vec4"):void 0,this._colorShaderTranslucent=shaderState.translucent,this._colorShaderFunction)};Cesium3DTileStyle.prototype.getShowShaderFunction=function(functionName,attributePrefix,shaderState){return this._showShaderFunctionReady?this._showShaderFunction:(this._showShaderFunctionReady=!0,this._showShaderFunction=Cesium.defined(this.show)?this.show.getShaderFunction(functionName,attributePrefix,shaderState,"bool"):void 0,this._showShaderFunction)};Cesium3DTileStyle.prototype.getPointSizeShaderFunction=function(functionName,attributePrefix,shaderState){return this._pointSizeShaderFunctionReady?this._pointSizeShaderFunction:(this._pointSizeShaderFunctionReady=!0,this._pointSizeShaderFunction=Cesium.defined(this.pointSize)?this.pointSize.getShaderFunction(functionName,attributePrefix,shaderState,"float"):void 0,this._pointSizeShaderFunction)};var Cesium3DTileStyle_default=Cesium3DTileStyle;var EV_LayerType={IMAGE:0,DEM:1,E3M:2,CROSS:3,E3M_OLD:4},EV_LayerType_default=Object.freeze(EV_LayerType);function EV_E3MLayer(options){var name=options.name;if(!Cesium.defined(name))throw new Cesium.DeveloperError("name is required");if(typeof name!="string")throw new Cesium.DeveloperError("name is required to be a string ");var url=options.url;if(!Cesium.defined(url))throw new Cesium.DeveloperError("url is required");this._name=name,this._type=EV_LayerType_default.E3M,this._customTag=options.customTag;var tilesetOption=Cesium.defaultValue(options.e3mOption,{});this._tilesetOption=tilesetOption,Cesium.defined(tilesetOption.customTag)||(tilesetOption.customTag=options.customTag),this._selectedColor=Cesium.defaultValue(options.selectedColor,Cesium.Color.LIME),this._selectedName=void 0,this._selectedFeature=void 0,this._timer=void 0,this.layerShownOrHidden=new Cesium.Event,this.selectionChanged=new Cesium.Event,this.featureVisibleArray=new Cesium.AssociativeArray,this.flowLineEntities=[],this.modeInfoMap=new Cesium.AssociativeArray;var that=this;this._tilesetPromise=when_default.defer(),this._readyPromise=when_default.defer(),this._serverVersion=Cesium.defaultValue(options.serverVersion,void 0);var patt=/\:\d+$/g,localRegex=/\.json$/,uri=new import_urijs.default(url);if(localRegex.test(url))resolveTileset(this,url,tilesetOption,options);else if(this._serverVersion==="EV-Server6")getServer6Resource(url,options,name,that,tilesetOption);else if(this._serverVersion==="EV-Server7"){uri=url+"/earthview/manager/config/getVersionInfo";var resource2=Cesium.Resource.createIfNeeded(uri);resource2.fetchJson().then(function(serverVersion){let serverVersionNum=serverVersion.data.match(/\d+/g),versionValue=0;serverVersion&&serverVersion.data==="7.0"?versionValue=7e3:versionValue=parseInt(serverVersionNum[0])*1e3+parseInt(serverVersionNum[1])*100+parseInt(serverVersionNum[2]),getServer7Resource(url,versionValue,options,that,tilesetOption,name)})}else{uri=url+"/earthview/manager/config/getVersionInfo";var resource2=Cesium.Resource.createIfNeeded(uri);resource2.fetchJson().then(function(serverVersion){let serverVersionNum=serverVersion.data.match(/\d+/g),versionValue=0;serverVersion&&serverVersion.data==="7.0"?versionValue=7e3:versionValue=parseInt(serverVersionNum[0])*1e3+parseInt(serverVersionNum[1])*100+parseInt(serverVersionNum[2]),serverVersion&&versionValue>=7e3?getServer7Resource(url,versionValue,options,that,tilesetOption,name):getServer6Resource(url,options,name,that,tilesetOption)}).catch(function(){getServer6Resource(url,options,name,that,tilesetOption)})}}function getServer6Resource(url,options,name,layer,tilesetOption){var path="/earthview/services/file/getFileData/";if(options.proxy=="nginx"){var reg=new RegExp(/(\w+):\/\/([^/:]+)(:\d*)?/),result=url.match(reg);result&&result[0]&&(url=result[0]+path+name+"/")}else url+=path+name+"/";if(typeof options.queryParam=="object"){var queryParam=Cesium.objectToQuery(options.queryParam);if(queryParam){var index=url.indexOf("?");index===-1?url+="?"+queryParam:index<url.length-1?url+="&"+queryParam:url+=queryParam}}resolveTileset(layer,url,tilesetOption,options)}function getServer7Resource(url,versionValue,options,layer,tilesetOption,name){let patt=/\:\d+$/g,path="/earthview/rest/services/fileserver/getFileData/";if(versionValue>7e3){path="/earthview/rest/services/fileserver/getIndexFile";let mongoPath="/earthview/rest/services/fileserver/getFileData/",mongoUrl=url;if(patt.test(url)){if(options.proxy==="nginx"){let reg=new RegExp(/(\w+):\/\/([^/:]+)(:\d*)?/),result=url.match(reg);result&&result[0]&&(url=result[0]+path)}else url+=path,mongoUrl+=`${mongoPath+name}/`;options.queryParam=Cesium.defaultValue(options.queryParam,{}),options.queryParam.serviceName=name}if(typeof options.queryParam=="object"){let queryParam=Cesium.objectToQuery(options.queryParam);if(queryParam){let index=mongoUrl.indexOf("?");index===-1?mongoUrl+=`?${queryParam}`:index<mongoUrl.length-1?mongoUrl+=`&${queryParam}`:mongoUrl+=queryParam}}tilesetOption.mongoUrl=mongoUrl,tilesetOption.versionValue=versionValue}else if(patt.test(url)){if(options.proxy==="nginx"){let reg=new RegExp(/(\w+):\/\/([^/:]+)(:\d*)?/),result=url.match(reg);result&&result[0]&&(url=result[0]+path)}else url+=`${path+name}/`;options.queryParam=Cesium.defaultValue(options.queryParam,{}),options.queryParam.serviceName=name,options.queryParam.fileName=`${name}.json`}if(typeof options.queryParam=="object"){let queryParam=Cesium.objectToQuery(options.queryParam);if(queryParam){let index=url.indexOf("?");index===-1?url+=`?${queryParam}`:index<url.length-1?url+=`&${queryParam}`:url+=queryParam}}resolveTileset(layer,url,tilesetOption,options)}function resolveTileset(ev_E3MLayer,url,tilesetOption,options){ev_E3MLayer._url=url,Cesium.defined(tilesetOption.url)||(tilesetOption.url=url);var tileset=new Cesium3DTileset_default(tilesetOption);ev_E3MLayer._cesiumLayer=tileset,Cesium.defined(options.e3mOption)&&Cesium.defined(options.e3mOption.meshLine)&&options.e3mOption.meshLine&&(tileset.style=new Cesium3DTileStyle_default({color:{conditions:[["String(${color}) === 'Y'","rgba(255,255,0,1)"],["String(${color}) === 'G'","rgba(0,255,0,1)"],["String(${color}) === 'R'","rgba(255,0,0,1)"],["String(${color}) === 'B'","rgba(0,0,255,1)"],["true",'color("white")']]}}),tileset.meshLine=options.e3mOption.meshLine,tileset.meshLineColor=tileset.style.color,tileset.colorBlendMode=Cesium.ColorBlendMode.REPLACE),Cesium.defined(options.e3mOption)&&Cesium.defined(options.e3mOption.highPrecision)&&(tileset.highPrecision=options.e3mOption.highPrecision),ev_E3MLayer._tilesetPromise.resolve(tileset),tileset.readyPromise.then(function(tileset2){ev_E3MLayer._readyPromise.resolve(tileset2)})}Object.defineProperties(EV_E3MLayer.prototype,{name:{get:function(){return this._name}},url:{get:function(){return this._url}},type:{get:function(){return this._type}},customTag:{get:function(){return this._customTag},set:function(customTag){this._customTag=customTag}},show:{get:function(){return this._cesiumLayer.show},set:function(visible){typeof visible!="boolean"?console.warn("visible is required to be a boolean"):this._cesiumLayer.show!==visible&&(this._cesiumLayer.show=visible,this.layerShownOrHidden.raiseEvent(this,0,this._cesiumLayer.show))}},selectedColor:{get:function(){return this._selectedColor},set:function(color){color instanceof Cesium.Color&&!Cesium.Color.equals(this._selectedColor,color)&&(this._selectedColor=color,update2(this))}},selectedFeature:{get:function(){return this._selectedFeature},set:function(feature2){this._selectedFeature&&this._selectedFeature!==feature2&&(this._selectedFeature,void 0),this._selectedFeature!==feature2&&(this._selectedFeature=feature2,update2(this)),this.selectionChanged.raiseEvent(this,this._selectedFeature)}},readyPromise:{get:function(){return this._readyPromise.promise}}});EV_E3MLayer.prototype.getCesiumLayer=function(){return this._cesiumLayer};EV_E3MLayer.prototype.setSelectedComponentName=function(componentName){typeof componentName=="string"&&this._selectedName!==componentName&&(this._selectedName=componentName,update2(this)),componentName||this.clearSelection()};EV_E3MLayer.prototype.getSelectedComponentName=function(){return this._selectedName};function isContainPoint(v){var str=v.toString(),ii=str.indexOf(".");return ii<0&&(str+="."),str}EV_E3MLayer.prototype.setBuildingEffect=function(options){var cesiumTileset=this.getCesiumLayer(),newStyle=new Cesium3DTileStyle_default({color:"color('white')"}),tempcolor=options.buildingOptions.color;Cesium.defined(cesiumTileset.style)&&(newStyle.show=cesiumTileset.style.show),newStyle.color=tempcolor,cesiumTileset.style=newStyle;var TILE_FS_BODY=`float _baseHeight = 0.0;
float _heightRange = `+isContainPoint(options.buildingOptions.lightStrength)+`;
float _glowRange =`+isContainPoint(options.buildingOptions.glowRange)+`;
float _glowStartHeight =`+isContainPoint(options.buildingOptions.glowStartHeight)+`;
float _glowInterval = `+isContainPoint(options.buildingOptions.glowInterval)+`;
float _glowLineWidth = `+isContainPoint(options.buildingOptions.glowLineWidth)+`;
float _glowLineRed = `+isContainPoint(options.buildingOptions.glowColor.red)+`;
float _glowLineGreen = `+isContainPoint(options.buildingOptions.glowColor.green)+`;
float _glowLineBlue = `+isContainPoint(options.buildingOptions.glowColor.blue)+`;
float _lightmin= `+isContainPoint(options.buildingOptions.lightMin)+`;
float _lightmax= `+isContainPoint(options.buildingOptions.lightMax)+`;
float _BulidingUp= `+isContainPoint(options.buildingOptions.buildingUp)+`;
bool _isglowshow = `+options.buildingOptions.isGlowShow+`;
bool _isDownToUp = `+options.buildingOptions.isDownToUp+`;
float vtxf_height = v_stcVertex.y - _baseHeight;
if(_BulidingUp == 0.0)
{
vtxf_height = v_stcVertex.z - _baseHeight;
}
else if(_BulidingUp == 1.0)
{
vtxf_height = v_stcVertex.y - _baseHeight;
}
else if(_BulidingUp == 2.0)
{
vtxf_height = v_stcVertex.x - _baseHeight;
}
float vtxf_a11 = fract(czm_frameNumber / 360.0) * 3.14159265 * 2.0;
float vtxf_a12 = vtxf_height / _heightRange + sin(vtxf_a11) * 0.1;
vtxf_a12 = clamp(vtxf_a12, _lightmin, _lightmax);
gl_FragColor *= vec4(vtxf_a12,vtxf_a12, vtxf_a12, 1.0);
float vtxf_a13 = fract(czm_frameNumber / _glowInterval);
float vtxf_h = clamp(vtxf_height / _glowRange, 0.1, 1.0);
float vtxf_a14 = vtxf_a13;
if(_isDownToUp)
{
if(vtxf_a13 < 0.5)
{
vtxf_a13 = vtxf_a13 + 0.5;
}
vtxf_a13 = (vtxf_a13 - 0.5) * 2.0;
}
else
{
if(vtxf_a13 > 0.5)
{
vtxf_a13 = vtxf_a13 - 0.5;
}
vtxf_a13 = (-vtxf_a13 + 0.5) * 2.0;
}
float vtxf_diff = step(0.001*_glowLineWidth, abs(vtxf_h-vtxf_a13));
if(_isglowshow&&vtxf_height>_glowStartHeight&&vtxf_a13>0.0)
{
gl_FragColor.rgb +=vec3(_glowLineRed,_glowLineGreen,_glowLineBlue) * (1.0-vtxf_diff);
}
`;ModelUtility_default.modifyFragmentShaderForLogDepth=function(shader){return shader=Cesium.ShaderSource.replaceMain(shader,"czm_depth_main"),shader+=`
varying vec3 v_stcVertex;
void main(){
czm_depth_main();
`+TILE_FS_BODY+`czm_writeLogDepth();
}
`,shader},ModelUtility_default.modifyVertexShaderForLogDepth=function(shader,toClipCoordinatesGLSL){return shader=Cesium.ShaderSource.replaceMain(shader,"czm_depth_main"),shader+=`
varying vec3 v_stcVertex;
void main() 
{ 
    czm_depth_main(); 
    v_stcVertex = a_position;
    czm_vertexLogDepth(`+toClipCoordinatesGLSL+`); 
} 
`,shader},cesiumTileset._update=!0};EV_E3MLayer.prototype.setAllFeaturesColors=function(name,featureIds,colors,othercolor){for(var conditions=[],i=0;i<featureIds.length;i++){var featureid=featureIds[i];typeof featureid=="string"&&(featureid='"'+featureid+'"');var con=[];con.push("${"+name+"} === "+featureid);var color=colors[i];Cesium.defined(color)||(color=Cesium.Color.WHITE);var cssColor=color.toCssColorString();con.push(cssColor),conditions.push(con)}var lastCon=[];lastCon.push("true");var lastColor=othercolor.toCssColorString();lastCon.push(lastColor),conditions.push(lastCon),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new Cesium3DTileStyle_default({color:{conditions}})};EV_E3MLayer.prototype.clearAllChanged=function(){var cesiumTileset=this.getCesiumLayer(),newStyle=new Cesium3DTileStyle_default({color:"color('white')"});Cesium.defined(cesiumTileset.style)&&(newStyle.show=cesiumTileset.style.show),cesiumTileset.style=newStyle,ModelUtility_default.modifyFragmentShaderForLogDepth=function(shader){return shader=Cesium.ShaderSource.replaceMain(shader,"czm_old_main"),shader+=`
varying vec3 v_stcVertex;
void main(){
czm_old_main();
czm_writeLogDepth();
}
`,shader},ModelUtility_default.modifyVertexShaderForLogDepth=function(shader,toClipCoordinatesGLSL){return shader=Cesium.ShaderSource.replaceMain(shader,"czm_old_main"),shader+=`
varying vec3 v_stcVertex;
void main() 
{ 
    czm_old_main(); 
    v_stcVertex = a_position;
    czm_vertexLogDepth(`+toClipCoordinatesGLSL+`); 
} 
`,shader},cesiumTileset._update=!0};EV_E3MLayer.prototype.clearSelection=function(){var cesiumTileset=this.getCesiumLayer(),newStyle=new Cesium3DTileStyle_default({color:"color('white')"});Cesium.defined(cesiumTileset.style)&&(newStyle.show=cesiumTileset.style.show),cesiumTileset.style=newStyle,this._selectedFeature,this._selectedName=void 0,this._selectedFeature=void 0,this.selectionChanged.raiseEvent(this,void 0)};EV_E3MLayer.prototype.raiseHeight=function(offsetHeight){this.readyPromise.then(function(cesiumTileset){var cartographic=Cesium.Cartographic.fromCartesian(cesiumTileset.boundingSphere.center),surface=Cesium.Cartesian3.fromRadians(cartographic.longitude,cartographic.latitude,0),offset=Cesium.Cartesian3.fromRadians(cartographic.longitude,cartographic.latitude,offsetHeight),translation=Cesium.Cartesian3.subtract(offset,surface,new Cesium.Cartesian3);Cesium.Matrix4.multiply(Cesium.Matrix4.fromTranslation(translation),cesiumTileset.modelMatrix,cesiumTileset.modelMatrix)})};EV_E3MLayer.prototype.setHeight=function(height2){var cesiumTileset=this._cesiumLayer,center2=cesiumTileset.boundingSphere.center,cartographic=Cesium.Cartographic.fromCartesian(center2);cartographic.height=height2;var position=Cesium.Cartographic.toCartesian(cartographic),translation=Cesium.Cartesian3.subtract(position,center2,position);Cesium.Matrix4.multiply(Cesium.Matrix4.fromTranslation(translation),cesiumTileset.modelMatrix,cesiumTileset.modelMatrix)};EV_E3MLayer.prototype.getCenter=function(){var cesiumTileset=this.getCesiumLayer(),cartographic=Cesium.Cartographic.fromCartesian(cesiumTileset.boundingSphere.center);return cartographic};EV_E3MLayer.prototype.setFeaturesVisible=function(name,featureIds,isShow,othersShowOrNot){Cesium.defined(othersShowOrNot)||(othersShowOrNot=!0);for(var conditions=[],featureArray,i=0;i<featureIds.length;i++){var featureid=featureIds[i];typeof featureid=="string"&&(featureid='"'+featureid+'"');var array=[];array.push(featureid),array.push(isShow),typeof featureid=="string"?(Cesium.defined(featureArray)||(featureArray=new Cesium.AssociativeArray),featureArray.set(i,array)):this.featureVisibleArray.set(featureid,array)}Cesium.defined(featureArray)||(featureArray=getFeatureArray(this.featureVisibleArray,isShow,othersShowOrNot));for(var i=0;i<featureArray.length;i++){var array=featureArray.values[i],con=[];if(!Array.isArray(array[0]))con.push("${"+name+"} === "+array[0]);else{var str="${"+name+"} >= "+array[0][0]+" && ${"+name+"} <= "+array[0][1];con.push(str)}con.push(array[1]),conditions.push(con)}var lastCon=[];lastCon.push("true"),lastCon.push(othersShowOrNot),conditions.push(lastCon),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.show={conditions},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new Cesium3DTileStyle_default({show:{conditions}})};function getFeatureArray(featureVisibleArray,isShow,othersShowOrNot){var featureArray=new Cesium.AssociativeArray,numArray=[];if(isShow&&!othersShowOrNot||!isShow&&!othersShowOrNot){for(var i=0;i<featureVisibleArray.length;i++){var array=featureVisibleArray.values[i];array[1]&&(typeof array[0]=="number"?numArray.push(array[0]):featureArray.set(array[0],array))}return numArray.length>0&&featureSort(featureArray,numArray,!0),featureArray}if(isShow&&othersShowOrNot||!isShow&&othersShowOrNot){for(var i=0;i<featureVisibleArray.length;i++){var array=featureVisibleArray.values[i];array[1]||(typeof array[0]=="number"?numArray.push(array[0]):featureArray.set(array[0],array))}return numArray.length>0&&featureSort(featureArray,numArray,!1),featureArray}}function featureSort(featureArray,numArray,isShow){numArray.sort(function(a,b){return a-b});var start2=numArray[0],tmp=[];tmp.push(start2),tmp.push(isShow),featureArray.set(start2,tmp);for(var i=1;i<numArray.length;i++){var index=numArray[i-1];if(numArray[i]-1===index){var array=[];array.push([start2,numArray[i]]),array.push(isShow),featureArray.set(start2,array)}else{if(!Cesium.defined(featureArray.get(start2))){var array=[];array.push(start2),array.push(isShow),featureArray.set(start2,array)}start2=numArray[i]}}if(!Cesium.defined(featureArray.get(start2))){var array=[];array.push(start2),array.push(isShow),featureArray.set(start2,array)}}EV_E3MLayer.prototype.setPartFeaturesVisible=function(featureArr,isShow,othersShowOrNot){Cesium.defined(othersShowOrNot)||(othersShowOrNot=!0);for(var constr="",con=[],conditions=[],i=0;i<featureArr.length;i++){constr="";var feature2=featureArr[i];for(var key in feature2){var featureName=feature2[key];if(typeof featureName=="number")constr+="${"+key+"} ==="+featureName+" && ";else if(typeof featureName=="string")constr+="${"+key+'} ==="'+featureName+'" && ';else{var length3=featureName.length;if(con=[],length3>2)for(var j=0;j<length3;j+=2){con=[];var featrueStr=constr;featrueStr+="${"+key+"} >="+featureName[j]+" && ${"+key+"} <= "+featureName[j+1],con.push(featrueStr),con.push(isShow),conditions.push(con)}else typeof featureName[0]=="number"&&(constr+="${"+key+"} >="+featureName[0]+" && "),length3==2&&typeof featureName[1]=="number"&&(constr+="${"+key+"} <="+featureName[1]+" && "),constr=constr.substr(0,constr.length-4),con.push(constr),con.push(isShow),conditions.push(con)}}}var lastCon=[];lastCon.push("true"),lastCon.push(othersShowOrNot),conditions.push(lastCon),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.show={conditions},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new Cesium3DTileStyle_default({show:{conditions}})};var arrayJsonContent=[],idArr=[];EV_E3MLayer.prototype.getIdScope=function(id){var treeTables=this._cesiumLayer.sharedResources.treeTables;arrayJsonContent=[],idArr2=[];var tableTree=buildTree(treeTables),parentId=tableTree.filter(function(ele){return ele.id===id});if(Cesium.defined(parentId)){!Cesium.defined(parentId[0].parentId)&&Cesium.defined(parentId[0].children[0])&&(parentId[0].parentId=parentId[0].children[0].parentId);for(var childArr=tableTree.filter(function(ele){if(Cesium.defined(ele.parentId))return ele.parentId===parentId[0].parentId}),idArr2=getchildArr(childArr),max3=idArr2[0],min4=idArr2[0],i=1;i<idArr2.length;i++)idArr2[i]>max3&&(max3=idArr2[i]),idArr2[i]<min4&&(min4=idArr2[i]);return idArr2=[],[min4,max3]}};function buildTree(treeTables){for(var key in treeTables){var child=treeTables[key];Cesium.defined(child.children)&&buildTree(child.children),arrayJsonContent.push(child)}return arrayJsonContent}function getchildArr(childArr){for(var i=0;i<childArr.length;i++)idArr.push(childArr[i].id),Cesium.defined(childArr[i].children)&&getchildArr(childArr[i].children);return idArr}EV_E3MLayer.prototype.clearFeaturesVisible=function(){this.featureVisibleArray.removeAll(),this.setFeaturesVisible("id",[],!0)};EV_E3MLayer.prototype.setFeaturesColor=function(name,featureIds,color){var conditions=[];if(!(color instanceof Cesium.Color))throw new Cesium.DeveloperError("\u5FC5\u987B\u8F93\u5165\u989C\u8272.");for(var cssColor=color.toCssColorString(),i=0;i<featureIds.length;i++){var featureid=featureIds[i];typeof featureid=="string"&&(featureid='"'+featureid+'"');var con=[];con.push("${"+name+"} === "+featureid),con.push(cssColor),conditions.push(con)}var lastCon=[];lastCon.push("true"),lastCon.push("color('white')"),conditions.push(lastCon),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new Cesium3DTileStyle_default({color:{conditions}})};EV_E3MLayer.prototype.setColorById=function(id,color,nodeLevel){arrayJsonContent=[],idArr=[];var conditions=[],con=[];if(con.push("${id} === "+id),!(color instanceof Cesium.Color))throw new Cesium.DeveloperError("\u5FC5\u987B\u8F93\u5165\u989C\u8272.");if(Cesium.defined(nodeLevel)){con=[];var treeTables=this._cesiumLayer.sharedResources.treeTables,treeArr=buildTree(treeTables),treeTable;for(var key in treeTables){var child=treeTables[key];Cesium.defined(child.id)&&(treeTable=child)}var partentArr=getAllParentId(treeTables,function(treeTable2){return treeTable2.id===id},[]);if(partentArr.pop(),nodeLevel<=partentArr.length){for(var parentList=treeArr.filter(function(ele){if(Cesium.defined(ele.id))return ele.id===partentArr[partentArr.length-nodeLevel]}),childList=getchildArr(parentList),max3=childList[0],min4=childList[0],i=1;i<childList.length;i++)childList[i]>max3&&(max3=childList[i]),childList[i]<min4&&(min4=childList[i]);con.push("${id} >= "+min4+" && ${id} <= "+max3)}else throw new Cesium.DeveloperError("\u7236\u8282\u70B9\u5C42\u7EA7\u6570\u8D85\u51FA\u8303\u56F4\uFF01")}var cssColor=color.toCssColorString();con.push(cssColor),conditions.push(con);var lastCon=[];lastCon.push("true"),lastCon.push("color('white')"),conditions.push(lastCon),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new Cesium3DTileStyle_default({color:{conditions}})};function getAllParentId(treeTable,func,path){if(treeTable==null)return[];for(var key in treeTable){if(path.push(treeTable[key].id),func(treeTable[key]))return path;if(treeTable[key].children){var findChild=getAllParentId(treeTable[key].children,func,path);if(findChild.length)return findChild}path.pop()}return[]}EV_E3MLayer.prototype.setFeaturesColors=function(name,featureIds,colors){for(var conditions=[],i=0;i<featureIds.length;i++){var featureid=featureIds[i];typeof featureid=="string"&&(featureid='"'+featureid+'"');var con=[];con.push("${"+name+"} === "+featureid);var color=colors[i];Cesium.defined(color)||(color=Cesium.Color.WHITE);var cssColor=color.toCssColorString();con.push(cssColor),conditions.push(con)}var lastCon=[];lastCon.push("true"),lastCon.push("color('white')"),conditions.push(lastCon),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new Cesium3DTileStyle_default({color:{conditions}})};EV_E3MLayer.prototype.getFeatureBoundingBoxInWC=function(name,featureId){var boundingBox=void 0,treeTables=this._cesiumLayer.treeTable;if(name==="name"){for(var keyName in treeTables)if(Object.prototype.hasOwnProperty.call(treeTables,keyName)){var treeTable=treeTables[keyName],stack=new Cesium.ManagedArray;for(stack.push(treeTable);stack.length>0;){var element=stack.pop();if(element.elementName==featureId){boundingBox={MAX:element.MAX,MIN:element.MIN};break}if(Cesium.defined(element.children))for(var i=0;i<element.children.length;++i){var child=element.children[i];stack.push(child)}}if(Cesium.defined(boundingBox))break}}else if(name==="id"){for(var keyName in treeTables)if(Object.prototype.hasOwnProperty.call(treeTables,keyName)){var treeTable=treeTables[keyName],stack=new Cesium.ManagedArray;for(stack.push(treeTable);stack.length>0;){var element=stack.pop();if(element.id==featureId){boundingBox={MAX:element.MAX,MIN:element.MIN};break}else if(element["id:"]==featureId){boundingBox={MAX:element.MAX,MIN:element.MIN};break}if(Cesium.defined(element.children))for(var i=0;i<element.children.length;++i){var child=element.children[i];stack.push(child)}}if(Cesium.defined(boundingBox))break}}else return console.log("\u5C5E\u6027\u540D\u4E0D\u7B26\u5408\u8981\u6C42"),boundingBox;var cesiumTransformMat4=void 0,stack2=new Cesium.ManagedArray;for(stack2.push(this._cesiumLayer.root);stack2.length>0;){var tile=stack2.pop();if(Cesium.defined(tile._header)&&Cesium.defined(tile._header.transform)){var transformMat4=Cesium.Matrix4.unpack(tile.computedTransform);cesiumTransformMat4=Cesium.Matrix4.multiplyTransformation(transformMat4,Cesium.Axis.Y_UP_TO_Z_UP,new Cesium.Matrix4);break}if(Cesium.defined(tile.children))for(var j=0;j<tile.children.length;++j){var child=tile.children[j];stack2.push(child)}}return Cesium.defined(boundingBox)&&Cesium.defined(cesiumTransformMat4)&&(boundingBox.MIN=Cesium.Matrix4.multiplyByPoint(cesiumTransformMat4,Cesium.Cartesian3.unpack(boundingBox.MIN),new Cesium.Cartesian3),boundingBox.MAX=Cesium.Matrix4.multiplyByPoint(cesiumTransformMat4,Cesium.Cartesian3.unpack(boundingBox.MAX),new Cesium.Cartesian3)),boundingBox};EV_E3MLayer.prototype.getAllChildNode=function(name,featureId){var treeTables=this._cesiumLayer.treeTable,childNode=[];if(name==="id"){for(var keyName in treeTables)if(Object.prototype.hasOwnProperty.call(treeTables,keyName)){var treeTable=treeTables[keyName],stack=new Cesium.ManagedArray,childStack=new Cesium.ManagedArray;for(stack.push(treeTable);stack.length>0;){var element=stack.pop();if(element.id==featureId){childStack=element.children;break}if(Cesium.defined(element.children))for(var i=0;i<element.children.length;++i){var child=element.children[i];stack.push(child)}}return Cesium.defined(childStack)?queryChildNode(childStack,childNode):childNode.push(element.id),childNode}}};function queryChildNode(childStack,arr){for(var j=0;j<childStack.length;j++){var sonList=childStack[j];Cesium.defined(sonList.children)?queryChildNode(sonList.children,arr):arr.push(sonList.id)}}EV_E3MLayer.prototype.getComponentsInCullingVolume=function(cullingVolume){var cesiumTransformMat4=void 0,stack2=new Cesium.ManagedArray;for(stack2.push(this._cesiumLayer.root);stack2.length>0;){var tile=stack2.pop();if(Cesium.defined(tile._header)&&Cesium.defined(tile._header.transform)){var transformMat4=Cesium.Matrix4.unpack(tile.computedTransform);cesiumTransformMat4=Cesium.Matrix4.multiplyTransformation(transformMat4,Cesium.Axis.Y_UP_TO_Z_UP,new Cesium.Matrix4);break}if(Cesium.defined(tile.children))for(var j=0;j<tile.children.length;++j){var child=tile.children[j];stack2.push(child)}}var resultComponents=[];if(!Cesium.defined(cesiumTransformMat4))return resultComponents;var treeTables=this._cesiumLayer.treeTable,boundingBox=void 0;for(var keyName in treeTables)if(Object.prototype.hasOwnProperty.call(treeTables,keyName)){var treeTable=treeTables[keyName],stack=new Cesium.ManagedArray;for(stack.push(treeTable);stack.length>0;){var element=stack.pop(),min4=Cesium.Matrix4.multiplyByPoint(cesiumTransformMat4,Cesium.Cartesian3.unpack(element.MIN),new Cesium.Cartesian3),max3=Cesium.Matrix4.multiplyByPoint(cesiumTransformMat4,Cesium.Cartesian3.unpack(element.MAX),new Cesium.Cartesian3),boundingSphere=Cesium.BoundingSphere.fromCornerPoints(min4,max3);if(cullingVolume.computeVisibility(boundingSphere)!==Cesium.Intersect.OUTSIDE&&!Cesium.defined(element.children)&&resultComponents.push(element),Cesium.defined(element.children))for(var i=0;i<element.children.length;++i){var child=element.children[i];stack.push(child)}}if(Cesium.defined(boundingBox))break}return resultComponents};EV_E3MLayer.prototype.setFeaturesColorsByTreeTableMap=function(name,featureIds,colors){var conditions=[];if(name=="name"){for(var idColors=[],treeTableMaps=this._cesiumLayer.treeTableMaps,j=0;j<treeTableMaps.length;j++)for(var treeTable=treeTableMaps[j],k=0;k<featureIds.length;k++)for(var ids=treeTable.get(featureIds[k]),n=0;n<ids.length;n++)idColors.push({id:ids[n],color:colors[k]});name="id",Cesium.ForEach.object(idColors,function(object2){var featureid2=object2.id,color2=object2.color;typeof featureid2=="string"&&(featureid2='"'+featureid2+'"');var con2=[];con2.push("${"+name+"} === "+featureid2),Cesium.defined(color2)||(color2=Cesium.Color.WHITE);var cssColor2=color2.toCssColorString();con2.push(cssColor2),conditions.push(con2)})}else for(var i=0;i<featureIds.length;i++){var featureid=featureIds[i];typeof featureid=="string"&&(featureid='"'+featureid+'"');var con=[];con.push("${"+name+"} === "+featureid);var color=colors[i];Cesium.defined(color)||(color=Cesium.Color.WHITE);var cssColor=color.toCssColorString();con.push(cssColor),conditions.push(con)}var lastCon=[];lastCon.push("true"),lastCon.push("color('white')"),conditions.push(lastCon),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new Cesium3DTileStyle_default({color:{conditions}})};EV_E3MLayer.prototype.setFeaturesAlpha=function(names,featureIds,alpha){alpha<0&&(alpha=0),alpha>1&&(alpha=1);var conditions=[],cssColor='color("white", '+alpha+")";if(Array.isArray(names)){if(names.length!=featureIds.length||names.length!=2)return;for(var con1=[],i=0;i<names.length;i++){for(var con=[],j=0;j<featureIds[i].length;j++){var featureid=featureIds[i][j];typeof featureid=="string"&&(featureid='"'+featureid+'"'),con.push("${"+names[i]+"} === "+featureid)}con1.push(con)}for(i=0;i<con1[0].length;i++){var str0=con1[0][i];for(j=0;j<con1[1].length;j++){var str1=con1[1][j],tmp=[];tmp.push(str0+"&&"+str1),tmp.push(cssColor),conditions.push(tmp)}}}else for(var i=0;i<featureIds.length;i++){var featureid=featureIds[i];typeof featureid=="string"&&(featureid='"'+featureid+'"');var con=[];con.push("${"+names+"} === "+featureid),con.push(cssColor),conditions.push(con)}var lastCon=[];lastCon.push("true"),lastCon.push("color('white')"),conditions.push(lastCon),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new Cesium3DTileStyle_default({color:{conditions}})};EV_E3MLayer.prototype.setLayerAlpha=function(alpha){alpha<0&&(alpha=0),alpha>1&&(alpha=1);var conditions=[],cssColor='color("white", '+alpha+")",lastCon=[];lastCon.push("true"),lastCon.push(cssColor),conditions.push(lastCon),Cesium.defined(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new Cesium3DTileStyle_default({color:{conditions}})};EV_E3MLayer.prototype.setFeaturesBlink=function(options,frequency){var times=0;Cesium.defined(this._timer)&&(clearInterval(this._timer),this._timer=void 0);var that=this;this._timer=setInterval(function(){times%2===0?setBlinkColor(that._cesiumLayer,options,0):setBlinkColor(that._cesiumLayer,options,1),times++},frequency*1e3)};function setBlinkColor(cesiumLayer,options,index){for(var conditions=[],i=0;i<options.length;i++){var opt=options[i],name=opt.property,color;index===0?color=opt.color0:color=opt.color1;for(var cssColor=color.toCssColorString(),featureIds=opt[name],j=0;j<featureIds.length;j++){var featureid=featureIds[j];typeof featureid=="string"&&(featureid='"'+featureid+'"');var con=[];con.push("${"+name+"} === "+featureid),con.push(cssColor),conditions.push(con)}}var lastCon=[];if(lastCon.push("true"),lastCon.push("color('white')"),conditions.push(lastCon),Cesium.defined(cesiumLayer.style)){var style=cesiumLayer.style,show=style.show,newStyle=new Cesium3DTileStyle_default({color:{conditions}});newStyle.show=show,cesiumLayer.style=newStyle}else cesiumLayer.style=new Cesium3DTileStyle_default({color:{conditions}})}EV_E3MLayer.prototype.clearFeaturesBlink=function(){Cesium.defined(this._timer)&&(clearInterval(this._timer),this._timer=void 0),Cesium.defined(this._cesiumLayer.style)&&Cesium.defined(this._cesiumLayer.style.color)&&(this._cesiumLayer.style.color=void 0,this._cesiumLayer._styleEngine._styleDirty=!0)};EV_E3MLayer.prototype.setFlowLine=function(options,entities){var tileset=this._cesiumLayer,currentTime=options.startTime,material=new Cesium.EV_FlowLineMaterialProperty({centreColor:options.centreColor,duration:options.duration,length:options.length,sideColor:options.sideColor,startTime:currentTime,interval:options.interval}),flowLineEntities=this.flowLineEntities;tileset.allTilesLoaded.addEventListener(function(){var flowLines=tileset.flowLines;if(!flowLines)throw new Cesium.DeveloperError("\u6570\u636E\u4E0D\u652F\u6301\u663E\u793A\u7535\u6D41\u6D41\u52A8!");for(var i=0;i<flowLines.length;i++)flowLineEntities.push(entities.add({polylineVolume:{positions:flowLines[i],shape:computeCircle(.023),material,isOffset:!0}}))})};function computeCircle(radius){for(var positions=[],i=0;i<360;i+=36){var radians2=Cesium.Math.toRadians(i);positions.push(new Cesium.Cartesian2(radius*Math.cos(radians2),radius*Math.sin(radians2)))}return positions}EV_E3MLayer.prototype.setFlowLineVisible=function(isShow){if(typeof isShow=="boolean")for(var flowLineEntities=this.flowLineEntities,i=0;i<flowLineEntities.length;i++)flowLineEntities[i].show=isShow};EV_E3MLayer.prototype.getModelInfoByEVID=function(evid,callback){if(!!Cesium.defined(evid)){var tileset=this._cesiumLayer;if(!!tileset.ready){var recordUrl=void 0,tempUrl=tileset._url;if(!Cesium.defined(recordUrl)){var datasetName=tileset.EVDataSetName,baseUrl=tileset._url;if(baseUrl.endsWith(".json")){var index=baseUrl.lastIndexOf("/");tempUrl=baseUrl.substr(0,index+1)}recordUrl=tempUrl+datasetName+"/DATA/0_0_0/record.json"}var resource2=Cesium.Resource.createIfNeeded(recordUrl),promise=resource2.fetchJson();when_default(promise,function(jsonData){if(!!Cesium.defined(jsonData)){for(var recordInfos=jsonData.recordInfos,header=void 0,i=0;i<recordInfos.length;i++){var record=recordInfos[i];if(record.EVID==evid){header={},header.content={},header.boundingVolume={},header.content.uri=record.modelPath,header.boundingVolume.sphere=record.sphere;var worldPos=Cesium.Cartesian3.fromDegrees(record.longitude,record.latitude,record.altitude),transform3=Cesium.Transforms.eastNorthUpToFixedFrame(worldPos);header.transform=Cesium.Matrix4.toArray(transform3);break}}if(Cesium.defined(header)){var baseResource=Cesium.Resource.createIfNeeded(recordUrl),tile=new Cesium3DTile_default(tileset,baseResource,header,void 0);tile.requestContent();var result=void 0;tile.contentReadyToProcessPromise.then(function(){var content=tile.content;if(content instanceof Composite3DTileContent_default)for(var contents=content._contents,i2=0;i2<contents.length;i2++){var innerContent=contents[i2];if(innerContent instanceof Batched3DModel3DTileContent_default){var model=innerContent._model,cloneModel=Cesium.clone(model,!1),boundingSphere=Cesium.clone(tile.boundingSphere,!0);result={},result.model=cloneModel,result.boundingSphere=boundingSphere;break}}tile.destroy(),Cesium.defined(callback)&&callback(result)})}}})}}};var scratchMatrix4=new Cesium.Matrix4;EV_E3MLayer.prototype.getModelBoundingSphereByEVID=function(evid,callback){if(!!Cesium.defined(evid)){var tileset=this._cesiumLayer;if(!!tileset.ready){var recordUrl=void 0,tempUrl=tileset._url;if(!Cesium.defined(recordUrl)){var datasetName=tileset.EVDataSetName,baseUrl=tileset._url;if(baseUrl.endsWith(".json")){var index=baseUrl.lastIndexOf("/");tempUrl=baseUrl.substr(0,index+1)}recordUrl=tempUrl+datasetName+"/DATA/0_0_0/record.json"}var resource2=Cesium.Resource.createIfNeeded(recordUrl),promise=resource2.fetchJson();when_default(promise,function(jsonData){if(!!Cesium.defined(jsonData))for(var recordInfos=jsonData.recordInfos,i=0;i<recordInfos.length;i++){var record=recordInfos[i];if(record.EVID==evid){var sphere=new Cesium.BoundingSphere(new Cesium.Cartesian3(record.sphere[0],record.sphere[1],record.sphere[2]),record.sphere[3]),transform3=Cesium.Matrix4.unpack(record.transform);return sphere=Cesium.BoundingSphere.transform(sphere,transform3),Cesium.defined(callback)&&callback(sphere),!0}}})}}};EV_E3MLayer.prototype.getModelVertexByEVID=function(name,value,callback){var that=this,promise=new Promise(async function(resolve2,reject2){for(var tileset=that.getCesiumLayer(),destModel,tile,batchid=void 0,batchidi3dm=void 0,selectedTiles=tileset.selectedTiles,i=0;i<selectedTiles.length;i++){if(tile=selectedTiles[i],Cesium.defined(tile._content)){if(Cesium.defined(tile._content._batchTable)){for(var batchTable=tile._content._batchTable,j=0;j<batchTable.featuresLength;j++)if(batchTable.getProperty(j,name)===value){Cesium.defined(tile._content._modelInstanceCollection)?destModel=tile._content._modelInstanceCollection:Cesium.defined(tile._content._model)&&(destModel=tile._content._model),batchidi3dm=batchid=j,batchTable.featuresLength===1&&(batchidi3dm=-1);break}}else if(Cesium.defined(tile._content._contents))for(var j=0;j<tile._content._contents.length;j++){for(var batchTable=tile._content._contents[j]._batchTable,k=0;k<batchTable.featuresLength;k++)if(batchTable.getProperty(k,name)===value){Cesium.defined(tile._content._contents[j]._modelInstanceCollection)?destModel=tile._content._contents[j]._modelInstanceCollection:Cesium.defined(tile._content._contents[j]._model)&&(destModel=tile._content._contents[j]._model);break}if(Cesium.defined(destModel))break}}if(Cesium.defined(destModel))break}if(!!Cesium.defined(destModel)){var gltf;Cesium.defined(destModel.gltf)?gltf=destModel.gltf:Cesium.defined(destModel._gltf)?gltf=destModel._gltf:gltf=await getGltf(destModel._resource._url);var isDraco;Cesium.defined(destModel._model)?isDraco=Cesium.DracoLoader.hasExtension(destModel._model):isDraco=Cesium.DracoLoader.hasExtension(destModel),parseGltfVertex(gltf,isDraco).then(function(attributes){if(attributes.length!==0){for(var faceInfo=new Map,i2=0;i2<attributes.length;i2++){var positionArray=attributes[i2].attributeData.POSITION,indexArray=attributes[i2].indexArray,batchIdArray=attributes[i2].attributeData._BATCHID,face=getFace(positionArray,indexArray,batchIdArray,batchidi3dm);faceInfo.set(attributes[i2].taskDataMesh,face)}var result=[];if(Cesium.defined(destModel._drawCommands)){if(typeof batchid!="number")return;for(var i2=0;i2<destModel._drawCommands.length;i2++){var key=destModel._drawCommands[i2].owner.meshId,face=faceInfo.get(Number(key)),matrix=destModel.modelMatrix,m4=Cesium.Matrix4.multiply(matrix,destModel._instances[batchid].modelMatrix,scratchMatrix4),m=Cesium.Matrix4.multiply(m4,destModel._drawCommands[i2]._modelMatrix,scratchMatrix4),faces=getWorldFace(m,face);result.push({meshId:key,instanceId:batchid,faces})}}else if(destModel._nodeCommands)for(var i2=0;i2<destModel._nodeCommands.length;i2++){var key=destModel._nodeCommands[i2].command.owner.meshId,face=faceInfo.get(Number(key));if(!!Cesium.defined(face))if(destModel._nodeCommands[i2].command._instanceCount!=0){var matrix=destModel.modelMatrix,m4=destModel._nodeCommands[i2].command._modelMatrix,instanceCount=destModel._nodeCommands[i2].command._instanceCount,instances=getInstance(destModel.ev_E3MInternalInstance.modelInstanceCollections,destModel._nodeCommands[i2].command._owner.meshId)._instances;if(instanceCount!=instances.length)continue;for(var j2=0;j2<instanceCount;j2++){var m=Cesium.Matrix4.multiply(instances[j2]._modelMatrix,m4,scratchMatrix4);m=Cesium.Matrix4.multiply(matrix,m,scratchMatrix4);var faces=getWorldFace(m,face);result.push({meshId:key,instanceId:instances[j2]._instanceId,faces})}}else{var matrix=destModel._nodeCommands[i2].command.modelMatrix,faces=getWorldFace(matrix,face);result.push({meshId:key,faces})}}resolve2(result)}})}});promise.then(function(value2){callback(value2)})};function parseGltfVertex(gltf,draco){var promise=new Promise(function(resolve2,reject2){var attributes=[];draco?Cesium.DracoLoader.parseGltf(gltf,!1,attributes).then(function(){attributes.length!==0&&resolve2(attributes)}):(Cesium.ForEach.mesh(gltf,function(mesh,meshId){Cesium.ForEach.meshPrimitive(mesh,function(primitive,primitiveId){var bufferView=gltf.accessors[primitive.attributes.POSITION].bufferView,byteOffset=gltf.accessors[primitive.attributes.POSITION].byteOffset,buffer3=gltf.bufferViews[bufferView].buffer,byteLength=gltf.bufferViews[bufferView].byteLength;byteOffset+=gltf.bufferViews[bufferView].byteOffset;var attributeData={},posArray=arraySlice_default(gltf.buffers[buffer3].extras._pipeline.source,byteOffset,byteOffset+byteLength);attributeData.POSITION={},attributeData.POSITION.array=new Float32Array(posArray.buffer),bufferView=gltf.accessors[primitive.attributes._BATCHID].bufferView,byteOffset=gltf.accessors[primitive.attributes._BATCHID].byteOffset,buffer3=gltf.bufferViews[bufferView].buffer,byteLength=gltf.bufferViews[bufferView].byteLength,byteOffset+=gltf.bufferViews[bufferView].byteOffset;var batArray=arraySlice_default(gltf.buffers[buffer3].extras._pipeline.source,byteOffset,byteOffset+byteLength);attributeData._BATCHID={},attributeData._BATCHID.array=new Float32Array(batArray.buffer),bufferView=gltf.accessors[primitive.indices].bufferView,byteOffset=gltf.accessors[primitive.indices].byteOffset,buffer3=gltf.bufferViews[bufferView].buffer,byteLength=gltf.bufferViews[bufferView].byteLength,byteOffset+=gltf.bufferViews[bufferView].byteOffset;var indArray=arraySlice_default(gltf.buffers[buffer3].extras._pipeline.source,byteOffset,byteOffset+byteLength),indexArray=new Uint32Array(indArray.buffer);attributes.push({attributeData,indexArray:{typedArray:indexArray,numberOfIndices:indexArray.length},taskDataMesh:meshId,taskDataPrimitive:primitiveId})})}),resolve2(attributes))});return promise}EV_E3MLayer.prototype.getDistance=function(vertexInfo,points2){var computeDistance3=new Cesium.TaskProcessor("computeDistance"),promise=computeDistance3.scheduleTask({vertexInfo,points:points2});return promise};function getFace(positionArray,indexArray,batchIdArray,destBatchid){for(var face=[],i=0;i<indexArray.numberOfIndices;i+=3){var a=indexArray.typedArray[i],b=indexArray.typedArray[i+1],c=indexArray.typedArray[i+2],batchId;if(Cesium.defined(batchIdArray)&&(batchId=batchIdArray.array[a]),!(Cesium.defined(batchId)&&Cesium.defined(destBatchid)&&destBatchid!==-1&&batchId!==destBatchid)){var offset=a*3,x2=positionArray.array[offset],y2=positionArray.array[offset+1],z=positionArray.array[offset+2],vertex1=new Cesium.Cartesian3(x2,y2,z);offset=b*3,x2=positionArray.array[offset],y2=positionArray.array[offset+1],z=positionArray.array[offset+2];var vertex2=new Cesium.Cartesian3(x2,y2,z);offset=c*3,x2=positionArray.array[offset],y2=positionArray.array[offset+1],z=positionArray.array[offset+2];var vertex3=new Cesium.Cartesian3(x2,y2,z);face.push({a:vertex1,b:vertex2,c:vertex3,batchId})}}return face}function getWorldFace(matrix,face){for(var result,f=[],sphere=new Cesium.BoundingSphere,i=0;i<face.length;i++){var a=Cesium.Matrix4.multiplyByPoint(matrix,face[i].a,new Cesium.Cartesian3),b=Cesium.Matrix4.multiplyByPoint(matrix,face[i].b,new Cesium.Cartesian3),c=Cesium.Matrix4.multiplyByPoint(matrix,face[i].c,new Cesium.Cartesian3);f.push({a,b,c,batchId:face[i].batchId}),i===0?(sphere.radius=0,sphere.center=a,sphere=Cesium.BoundingSphere.expand(sphere,b),sphere=Cesium.BoundingSphere.expand(sphere,c)):(sphere=Cesium.BoundingSphere.expand(sphere,a),sphere=Cesium.BoundingSphere.expand(sphere,b),sphere=Cesium.BoundingSphere.expand(sphere,c))}return result={f,radius:sphere.radius,center:sphere.center},result}function getInstance(modelInstanceCollections,meshId){for(var i=0;i<modelInstanceCollections.length;i++)if(modelInstanceCollections[i]._meshId===meshId)return modelInstanceCollections[i]}var sizeOfUint327=Uint32Array.BYTES_PER_ELEMENT;function getGltf(uri){var promise=new Promise(function(resolve2,reject2){Cesium.Resource.fetchArrayBuffer({url:uri}).then(function(arrayBuffer){var byteOffset=0,uint8Array=new Uint8Array(arrayBuffer),view=new DataView(arrayBuffer),magic=Cesium.getStringFromTypedArray(uint8Array,byteOffset,4);if(magic==="b3dm"){byteOffset+=sizeOfUint327;var version=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327;var byteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327;var featureTableJsonByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327;var featureTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327;var batchTableJsonByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327;var batchTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327,byteOffset+=featureTableJsonByteLength,byteOffset+=featureTableBinaryByteLength,byteOffset+=batchTableJsonByteLength,byteOffset+=batchTableBinaryByteLength;var gltfByteLength=byteLength-byteOffset;if(gltfByteLength===0)throw new Cesium.RuntimeError("glTF byte length must be greater than 0.");var gltfView=new Uint8Array(arrayBuffer,byteOffset,gltfByteLength),parsedGltf=Cesium.parseGlb(gltfView);resolve2(parsedGltf)}else if(magic==="cmpt"){byteOffset+=sizeOfUint327,byteOffset+=sizeOfUint327,byteOffset+=sizeOfUint327;var tilesLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327;for(var i=0;i<1;++i){var tileType=Cesium.getStringFromTypedArray(uint8Array,byteOffset,4),tileByteLength=view.getUint32(byteOffset+sizeOfUint327*2,!0),offset=byteOffset;if(tileType==="b3dm"){byteOffset+=sizeOfUint327,byteOffset+=sizeOfUint327;var byteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327;var featureTableJsonByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327;var featureTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327;var batchTableJsonByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327;var batchTableBinaryByteLength=view.getUint32(byteOffset,!0);byteOffset+=sizeOfUint327,byteOffset+=featureTableJsonByteLength,byteOffset+=featureTableBinaryByteLength,byteOffset+=batchTableJsonByteLength,byteOffset+=batchTableBinaryByteLength;var gltfByteLength=byteLength-byteOffset+offset;if(gltfByteLength===0)throw new Cesium.RuntimeError("glTF byte length must be greater than 0.");var gltfView=new Uint8Array(arrayBuffer,byteOffset,gltfByteLength),parsedGltf=Cesium.parseGlb(gltfView);resolve2(parsedGltf)}byteOffset+=tileByteLength}}})});return promise}EV_E3MLayer.prototype.getJsonInfo=function(callback){var result={},url=this.url,mongoUrl=void 0;Cesium.defined(this._tilesetOption.versionValue)&&this._tilesetOption.versionValue>7e3&&(mongoUrl=this._tilesetOption.mongoUrl),Cesium.Resource.fetchJson({url}).then(function(jsonData){result.gltfUpAxis=jsonData.asset.gltfUpAxis,result.boundingVolume=jsonData.root.boundingVolume;var index=url.lastIndexOf("/"),newUrl=url.slice(0,index+1)+jsonData.root.content.uri;Cesium.defined(mongoUrl)&&(index=mongoUrl.lastIndexOf("/"),newUrl=mongoUrl.slice(0,index+1)+jsonData.root.content.uri),Cesium.Resource.fetchJson({url:newUrl}).then(function(json){if(!json.root.children[0].modeltree){callback(result);return}var treeurl=json.root.children[0].modeltree.uri;result.transform=json.root.children[0].transform;var n=treeurl.lastIndexOf("../"),tree=url.slice(0,index)+treeurl.slice(n+2,treeurl.length);Cesium.defined(mongoUrl)&&(tree=mongoUrl.slice(0,index)+treeurl.slice(n+2,treeurl.length)),Cesium.Resource.fetchJson({url:tree}).then(function(modeltree){result.modeltree=modeltree,callback(result)})})})};EV_E3MLayer.prototype.showTowerByPercent=function(EVIDs,percents){if(this.modeInfoMap.length===0||this.modeInfoMap.length!==EVIDs.length){var that=this;getModelInfo(this,EVIDs).then(function(){showTowerByPercent(that,that.modeInfoMap,EVIDs,percents)})}else showTowerByPercent(this,this.modeInfoMap,EVIDs,percents)};function showTowerByPercent(layer,modeInfoMap,EVIDs,percents){if(EVIDs.length===percents.length){for(var featureArr=[],i=0;i<EVIDs.length;i++)if(modeInfoMap.contains(EVIDs[i])){for(var modelInfo=modeInfoMap.get(EVIDs[i]),ids=[],heightInfo=modelInfo.heightInfo,showHeight=modelInfo.startH+(modelInfo.endH-modelInfo.startH)*percents[i],j=0;j<heightInfo.length;j++)heightInfo[j].height>showHeight&&ids.push(heightInfo[j].id);if(ids.length>0){var featureArray=new Cesium.AssociativeArray;featureSort(featureArray,ids,!1);for(var arr=[],j=0;j<featureArray.length;j++)arr=arr.concat(featureArray._array[j][0]);featureArr.push({EVID:EVIDs[i],id:arr})}}layer.setPartFeaturesVisible(featureArr,!1,!0)}}function getModelInfo(layer,EVIDs){var promise=new Promise(function(resolve2,reject2){for(var evids=[],i=0;i<EVIDs.length;i++)layer.modeInfoMap.contains(EVIDs[i])||evids.push(EVIDs[i]);for(var tileset=layer.getCesiumLayer(),promises=[],selectedTiles=tileset.selectedTiles,i=0;i<selectedTiles.length;i++){var tile=selectedTiles[i];if(Cesium.defined(tile._header)&&Cesium.defined(tile._header.EVID)&&evids.indexOf(tile._header.EVID)!=-1){var destModel,batchId,EVID=tile._header.EVID;Cesium.defined(tile._content._batchTable)?(batchId=tile._content._batchTable._properties.id,Cesium.defined(tile._content._modelInstanceCollection)?destModel=tile._content._modelInstanceCollection:Cesium.defined(tile._content._model)&&(destModel=tile._content._model)):Cesium.defined(tile._content._contents)&&(batchId=tile._content._contents[0]._batchTable._properties.id,Cesium.defined(tile._content._contents[0]._modelInstanceCollection)?destModel=tile._content._contents[0]._modelInstanceCollection:Cesium.defined(tile._content._contents[0]._model)&&(destModel=tile._content._contents[0]._model));var matrixIdMap=new Cesium.AssociativeArray;if(!Cesium.defined(destModel._drawCommands)){if(destModel._nodeCommands)for(var k=0;k<destModel._nodeCommands.length;k++)if(destModel._nodeCommands[k].command._instanceCount!=0){var matrix=destModel.modelMatrix,m4=destModel._nodeCommands[k].command._modelMatrix,instanceCount=destModel._nodeCommands[k].command._instanceCount,instancesCollection=getInstance(destModel.ev_E3MInternalInstance.modelInstanceCollections,destModel._nodeCommands[k].command._owner.meshId),instances=instancesCollection._instances,batch_id=instancesCollection._batchTable._properties.id;if(instanceCount!=instances.length)continue;for(var m=Cesium.Matrix4.multiply(matrix,m4,scratchMatrix4),j=0;j<instanceCount;j++)matrixIdMap.set(batch_id[j],{id:batch_id[j],matrix:m})}else for(var matrix=destModel._nodeCommands[k].command.modelMatrix,j=0;j<batchId.length;j++)matrixIdMap.set(batchId[j],{id:batchId[j],matrix})}var url=tile._content._resource._url,worldMatrix=Cesium.Matrix4.unpack(tile.computedTransform);Cesium.Matrix4.multiplyTransformation(worldMatrix,Cesium.Axis.Y_UP_TO_Z_UP,worldMatrix);var index=url.lastIndexOf("/"),newUrl=url.slice(0,index+1)+"ModelNodeTree.json";promises.push(getModelTree(newUrl,worldMatrix,matrixIdMap,EVID))}}when_default.all(promises).then(function(result){for(var i2=0;i2<result.length;i2++){var key=result[i2].EVID;layer.modeInfoMap.set(key,result[i2])}resolve2(!0)})});return promise}function getModelTree(url,worldMatrix,matrixIdMap,EVID){var promise=new Promise(function(resolve2,reject2){Cesium.Resource.fetchJson({url}).then(function(json){var min4=Cesium.Matrix4.multiplyByPoint(worldMatrix,Cesium.Cartesian3.unpack(json.MIN),new Cesium.Cartesian3),max3=Cesium.Matrix4.multiplyByPoint(worldMatrix,Cesium.Cartesian3.unpack(json.MAX),new Cesium.Cartesian3),center2=Cesium.Cartesian3.midpoint(min4,max3,new Cesium.Cartesian3),radius=Cesium.Cartesian3.distance(min4,max3)/2,height2=Cesium.Cartographic.fromCartesian(center2).height,startH=height2-radius,endH=height2+radius,heightInfo=[];traverseChildNode(json,heightInfo,matrixIdMap),heightInfo.sort(function(a,b){return a.height-b.height}),resolve2({heightInfo,EVID,startH,endH})})});return promise}function traverseChildNode(childStack,arr,matrixIdMap){for(var j=0;j<childStack.children.length;j++){var sonList=childStack.children[j];if(Cesium.defined(sonList.children))traverseChildNode(sonList,arr,matrixIdMap);else{var worldMatrix=matrixIdMap.get(sonList.id).matrix;if(Cesium.defined(worldMatrix)){var min4=Cesium.Matrix4.multiplyByPoint(worldMatrix,Cesium.Cartesian3.unpack(sonList.MIN),new Cesium.Cartesian3),max3=Cesium.Matrix4.multiplyByPoint(worldMatrix,Cesium.Cartesian3.unpack(sonList.MAX),new Cesium.Cartesian3),center2=Cesium.Cartesian3.midpoint(min4,max3,new Cesium.Cartesian3),height2=Cesium.Cartographic.fromCartesian(center2).height;arr.push({id:sonList.id,height:height2})}}}}EV_E3MLayer.prototype.changeTilePosition=function(lon2,lat2,alt,heading,pitch,roll,evid){var tileset=this._cesiumLayer;if(!!tileset.ready){if(!Cesium.defined(lon2)||!Cesium.defined(lat2))throw new Cesium.DeveloperError("\u7ECF\u5EA6\u548C\u7EAC\u5EA6\u9700\u8981\u4F20\u5165\uFF01");if(Cesium.defined(heading)&&(!Cesium.defined(pitch)||!Cesium.defined(roll)))throw new Cesium.DeveloperError("\u4FEF\u4EF0\u3001\u504F\u822A\u3001\u7FFB\u6EDA\u89D2\u90FD\u9700\u8981\u4F20\u5165\uFF01");if(Cesium.defined(pitch)&&(!Cesium.defined(heading)||!Cesium.defined(roll)))throw new Cesium.DeveloperError("\u4FEF\u4EF0\u3001\u504F\u822A\u3001\u7FFB\u6EDA\u89D2\u90FD\u9700\u8981\u4F20\u5165\uFF01");if(Cesium.defined(roll)&&(!Cesium.defined(pitch)||!Cesium.defined(heading)))throw new Cesium.DeveloperError("\u4FEF\u4EF0\u3001\u504F\u822A\u3001\u7FFB\u6EDA\u89D2\u90FD\u9700\u8981\u4F20\u5165\uFF01");var height2=Cesium.defined(alt)?alt:0,headingValue=Cesium.defined(heading)?heading:0,pitchValue=Cesium.defined(pitch)?pitch:0,rollValue=Cesium.defined(roll)?roll:0,newWorldPos=Cesium.Cartesian3.fromRadians(lon2,lat2,height2),hpr=new Cesium.HeadingPitchRoll(headingValue,pitchValue,rollValue),newWorldMatrix=Cesium.Transforms.headingPitchRollToFixedFrame(newWorldPos,hpr);if(Cesium.defined(evid)){if(Cesium.defined(tileset.root)){var stack=[];for(stack.push(tileset.root);stack.length>0;){var tile=stack.pop();if(Cesium.defined(tile._header)&&Cesium.defined(tile._header.EVID)&&tile._header.EVID==evid){tile.transform=newWorldMatrix;break}for(var children=tile.children,length3=children.length,i=0;i<length3;++i)stack.push(children[i])}}}else if(Cesium.defined(tileset.root)){var stack=[];stack.push(tileset.root);for(var oldWorldMatrix=void 0;stack.length>0;){var tile=stack.pop();if(Cesium.defined(tile._header)&&Cesium.defined(tile._header.transform)){oldWorldMatrix=tile._header.transform;break}for(var children=tile.children,length3=children.length,i=0;i<length3;++i)stack.push(children[i])}if(Cesium.defined(oldWorldMatrix)){var iMatrix=void 0,trMatrix=void 0;if(!Cesium.defined(heading)&&!Cesium.defined(pitch)&&!Cesium.defined(roll)){var oldPos=new Cesium.Cartesian3;Cesium.Matrix4.getTranslation(oldWorldMatrix,oldPos);var mFix=Cesium.Transforms.headingPitchRollToFixedFrame(oldPos,new Cesium.HeadingPitchRoll(0,0,0)),resultM=new Cesium.Matrix4;iMatrix=Cesium.Matrix4.inverse(mFix,resultM),trMatrix=Cesium.Matrix4.multiply(iMatrix,oldWorldMatrix,resultM);var rotationM=new Cesium.Matrix3;Cesium.Matrix4.getMatrix3(trMatrix,rotationM);var q=Cesium.Quaternion.fromRotationMatrix(rotationM),hpr=Cesium.HeadingPitchRoll.fromQuaternion(q);newWorldMatrix=Cesium.Transforms.headingPitchRollToFixedFrame(newWorldPos,hpr)}var result=new Cesium.Matrix4;iMatrix=Cesium.Matrix4.inverse(oldWorldMatrix,result),trMatrix=Cesium.Matrix4.multiply(newWorldMatrix,iMatrix,result),tileset.modelMatrix=trMatrix}}}};function update2(tileset){var selectedName=tileset.getSelectedComponentName(),selectedColor=tileset.selectedColor;if(tileset.show&&selectedName){var names=[];names.push(selectedName),tileset.setFeaturesColor("name",names,selectedColor)}}EV_E3MLayer.prototype.setClippingByCartographic=function(cartoPosArray){if(!(cartoPosArray.length<3)&&this._cesiumLayer){for(var center2=this._cesiumLayer.boundingSphere.center,transformMatrix4=Cesium.Transforms.eastNorthUpToFixedFrame(center2),invTransformMatrix4=Cesium.Matrix4.inverse(transformMatrix4,new Cesium.Matrix4),cPlanes=[],i=0;i<cartoPosArray.length-1;i++){var lnglatA=cartoPosArray[i],lnglatB=cartoPosArray[i+1],lnglatC;i+2>=cartoPosArray.length?Cesium.Cartesian3.equals(cartoPosArray[0],lnglatB)?lnglatC=cartoPosArray[1]:lnglatC=cartoPosArray[0]:lnglatC=cartoPosArray[i+2];var v1=Cesium.Cartographic.toCartesian(lnglatA),v2=Cesium.Cartographic.toCartesian(lnglatB),v4=Cesium.Cartographic.toCartesian(lnglatC),v1Ref=Cesium.Matrix4.multiplyByPoint(invTransformMatrix4,v1,new Cesium.Cartesian3),v2Ref=Cesium.Matrix4.multiplyByPoint(invTransformMatrix4,v2,new Cesium.Cartesian3),v3Ref=new Cesium.Cartesian3(v2Ref.x,v2Ref.y,v2Ref.z+100),v4Ref=Cesium.Matrix4.multiplyByPoint(invTransformMatrix4,v4,new Cesium.Cartesian3),v3=Cesium.Matrix4.multiplyByPoint(transformMatrix4,v3Ref,new Cesium.Cartesian3),na1=(v1Ref.y-v2Ref.y)*(v3Ref.z-v2Ref.z)-(v1Ref.z-v2Ref.z)*(v3Ref.y-v2Ref.y),nb1=(v1Ref.z-v2Ref.z)*(v3Ref.x-v2Ref.x)-(v1Ref.x-v2Ref.x)*(v3Ref.z-v2Ref.z),nc1=(v1Ref.x-v2Ref.x)*(v3Ref.y-v2Ref.y)-(v1Ref.y-v2Ref.y)*(v3Ref.x-v2Ref.x),clipNormalize=Cesium.Cartesian3.normalize(new Cesium.Cartesian3(na1,nb1,nc1),new Cesium.Cartesian3),dirVec3=Cesium.Cartesian3.dot(Cesium.Cartesian3.subtract(v4Ref,v2Ref,new Cesium.Cartesian3),clipNormalize),resultClipNormalize=dirVec3<0?new Cesium.Cartesian3(-clipNormalize.x,-clipNormalize.y,-clipNormalize.z):clipNormalize,dotValue=Cesium.Cartesian3.dot(new Cesium.Cartesian3(-v2Ref.x,-v2Ref.y,-v2Ref.z),resultClipNormalize);cPlanes.push({normalize:resultClipNormalize.clone(),distance:dotValue})}this._cesiumLayer.clippingPlanes||(this._cesiumLayer.clippingPlanes=new Cesium.ClippingPlaneCollection({unionClippingRegions:!0})),this._cesiumLayer.clippingPlanes.unionClippingRegions=!0;for(var i=0;i<cPlanes.length;i++)this._cesiumLayer.clippingPlanes.add(new Cesium.ClippingPlane(cPlanes[i].normalize,cPlanes[i].distance))}};EV_E3MLayer.prototype.closeClipping=function(){this._cesiumLayer&&this._cesiumLayer.clippingPlanes&&this._cesiumLayer.clippingPlanes.removeAll()};EV_E3MLayer.prototype.getFeatureCenter=function(feature2,minPoint,maxPoint){if(feature2){var worldMatrix=Cesium.Matrix4.unpack(feature2.content.tile.computedTransform);Cesium.Matrix4.multiplyTransformation(worldMatrix,Cesium.Axis.Y_UP_TO_Z_UP,worldMatrix);var min4=Cesium.Matrix4.multiplyByPoint(worldMatrix,minPoint,new Cesium.Cartesian3),max3=Cesium.Matrix4.multiplyByPoint(worldMatrix,maxPoint,new Cesium.Cartesian3);return Cesium.Cartesian3.midpoint(min4,max3,new Cesium.Cartesian3)}};var EV_E3MLayer_default=EV_E3MLayer;function LayerManager(scene){this._scene=scene,this._primitives=scene._primitives,this._e3ms=new Cesium.AssociativeArray,this.layerAddedEvent=new Cesium.Event,this.layerRemovedEvent=new Cesium.Event,this.layerMovedEvent=new Cesium.Event,this.layerShownOrHiddenEvent=new Cesium.Event,this.selectionChanged=new Cesium.Event,this.featureSelectionChanged=new Cesium.Event,this._selectedFeature=void 0,this._scene.logarithmicDepthBuffer=!0,this._scene.postProcessStages._fxaa.enabled=!0,this._scene._context._gl.getExtension("EXT_shader_texture_lod"),this._scene._context._gl.getExtension("OES_texture_float")?window.NO_support_OES_float=!1:window.NO_support_OES_float=!0}Object.defineProperties(LayerManager.prototype,{scene:{get:function(){return this._scene}},selectedFeature:{get:function(){return this._selectedFeature},set:function(feature2){this._selectedFeature!==feature2&&(this._selectedFeature=feature2,this.featureSelectionChanged.raiseEvent(this._selectedFeature))}}});LayerManager.prototype.getLayerCollection=function(){return getArray(this)};LayerManager.prototype.getE3mLayer=function(layer){return getEVLayer(this,layer)};LayerManager.prototype.add=function(options){return addLayer(this,options)};function getEVLayer(manager,layer){let values3=getArray(manager).values;for(let i=0;i<values3.length;i++){let evLayer=values3[i];if(evLayer.getCesiumLayer()===layer)return evLayer}return layer}function addLayer(manager,options){let name=options.name,type=options.type,url=options.url;if(!Cesium.defined(name))throw new Cesium.DeveloperError("name is required");if(!Cesium.defined(type))throw new Cesium.DeveloperError("type is required");if(!Cesium.defined(url))throw new Cesium.DeveloperError("url is required");if(options.type===LayerType_default.IMAGE){let url2=options.url,name2=options.name,imageryProvider=new Cesium.WebMapTileServiceImageryProvider({url:`${url2}/earthview/services/${name2}/RasterService/WMTS`,layer:name2,style:"default",format:"image/png",tileMatrixSetID:"OGC_WebMercator",tileMatrixLabels:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],contextOptions:{requestWebgl2:!0}});return manager.scene.imageryLayers.addImageryProvider(imageryProvider),imageryProvider}else if(options.type===LayerType_default.DEM){let terrainprovider=new createTerrainProvider_default({name:options.name,url:options.url});return manager.scene.terrainProvider=terrainprovider,terrainprovider}else if(options.type===LayerType_default.E3M){let layer=new EV_E3MLayer_default(options);layer.readyPromise.then(function(tileset){manager._primitives.add(tileset)});let listeners=layer.layerShownOrHidden._listeners;return listeners.length===0&&layer.layerShownOrHidden.addEventListener(function(layer2,index,show){layerShownOrHidden(manager,layer2,index,show)}),listeners=layer.selectionChanged._listeners,listeners.length===0&&layer.selectionChanged.addEventListener(function(layer2,selectedFeatureName){layerSelectioned(manager,layer2,selectedFeatureName)}),getArray(manager).set(name,layer),manager.layerAddedEvent.raiseEvent(layer),layer}}function layerShownOrHidden(manager,layer,index,show){let evLayer=layer;manager.layerShownOrHiddenEvent.raiseEvent(evLayer,show)}function layerSelectioned(manager,layer,selectedFeatureName){manager.selectionChanged.raiseEvent(layer,selectedFeatureName)}function getArray(manager){return manager._e3ms}var LayerManager_default=LayerManager;function Cesium3DTileStyleEngine(){this._style=void 0,this._styleDirty=!1,this._lastStyleTime=0,this.airlineUpdate=!1}Object.defineProperties(Cesium3DTileStyleEngine.prototype,{style:{get:function(){return this._style},set:function(value){this._style=value,this._styleDirty=!0,this.airlineUpdate=!0}}});Cesium3DTileStyleEngine.prototype.makeDirty=function(){this._styleDirty=!0};Cesium3DTileStyleEngine.prototype.applyStyle=function(tileset,passOptions2){if(!!tileset.ready&&!(Cesium.defined(this._style)&&!this._style.ready)){var styleDirty=this._styleDirty;passOptions2.isRender&&(this._styleDirty=!1),styleDirty&&(++this._lastStyleTime,this.airlineUpdate=!0);for(var lastStyleTime=this._lastStyleTime,statistics=tileset._statistics,tiles=styleDirty?tileset._selectedTiles:tileset._selectedTilesToStyle,length3=tiles.length,i=0;i<length3;++i){var tile=tiles[i];if(tile.lastStyleTime!==lastStyleTime){var content=tile.content;tile.lastStyleTime=lastStyleTime,content.applyStyle(this._style),statistics.numberOfFeaturesStyled+=content.featuresLength,++statistics.numberOfTilesStyled}}}};var Cesium3DTileStyleEngine_default=Cesium3DTileStyleEngine;var earthRadius=63710088e-1,factors={meters:earthRadius,metres:earthRadius,millimeters:earthRadius*1e3,millimetres:earthRadius*1e3,centimeters:earthRadius*100,centimetres:earthRadius*100,kilometers:earthRadius/1e3,kilometres:earthRadius/1e3,miles:earthRadius/1609.344,nauticalmiles:earthRadius/1852,inches:earthRadius*39.37,yards:earthRadius/1.0936,feet:earthRadius*3.28084,radians:1,degrees:earthRadius/111325},unitsFactors={meters:1,metres:1,millimeters:1e3,millimetres:1e3,centimeters:100,centimetres:100,kilometers:1/1e3,kilometres:1/1e3,miles:1/1609.344,nauticalmiles:1/1852,inches:39.37,yards:1/1.0936,feet:3.28084,radians:1/earthRadius,degrees:1/111325},areaFactors={meters:1,metres:1,millimeters:1e6,millimetres:1e6,centimeters:1e4,centimetres:1e4,kilometers:1e-6,kilometres:1e-6,acres:247105e-9,miles:386e-9,yards:1.195990046,feet:10.763910417,inches:1550.003100006};function feature(geometry2,properties,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var bbox2=options.bbox,id=options.id;if(geometry2===void 0)throw new Error("geometry is required");if(properties&&properties.constructor!==Object)throw new Error("properties must be an Object");bbox2&&validateBBox(bbox2),id&&validateId(id);var feat={type:"Feature"};return id&&(feat.id=id),bbox2&&(feat.bbox=bbox2),feat.properties=properties||{},feat.geometry=geometry2,feat}function geometry(type,coordinates,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var bbox2=options.bbox;if(!type)throw new Error("type is required");if(!coordinates)throw new Error("coordinates is required");if(!Array.isArray(coordinates))throw new Error("coordinates must be an Array");bbox2&&validateBBox(bbox2);var geom;switch(type){case"Point":geom=point(coordinates).geometry;break;case"LineString":geom=lineString(coordinates).geometry;break;case"Polygon":geom=polygon(coordinates).geometry;break;case"MultiPoint":geom=multiPoint(coordinates).geometry;break;case"MultiLineString":geom=multiLineString(coordinates).geometry;break;case"MultiPolygon":geom=multiPolygon(coordinates).geometry;break;default:throw new Error(type+" is invalid")}return bbox2&&(geom.bbox=bbox2),geom}function point(coordinates,properties,options){if(!coordinates)throw new Error("coordinates is required");if(!Array.isArray(coordinates))throw new Error("coordinates must be an Array");if(coordinates.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber(coordinates[0])||!isNumber(coordinates[1]))throw new Error("coordinates must contain numbers");return feature({type:"Point",coordinates},properties,options)}function points(coordinates,properties,options){if(!coordinates)throw new Error("coordinates is required");if(!Array.isArray(coordinates))throw new Error("coordinates must be an Array");return featureCollection(coordinates.map(function(coords){return point(coords,properties)}),options)}function polygon(coordinates,properties,options){if(!coordinates)throw new Error("coordinates is required");for(var i=0;i<coordinates.length;i++){var ring=coordinates[i];if(ring.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var j=0;j<ring[ring.length-1].length;j++){if(i===0&&j===0&&!isNumber(ring[0][0])||!isNumber(ring[0][1]))throw new Error("coordinates must contain numbers");if(ring[ring.length-1][j]!==ring[0][j])throw new Error("First and last Position are not equivalent.")}}return feature({type:"Polygon",coordinates},properties,options)}function polygons(coordinates,properties,options){if(!coordinates)throw new Error("coordinates is required");if(!Array.isArray(coordinates))throw new Error("coordinates must be an Array");return featureCollection(coordinates.map(function(coords){return polygon(coords,properties)}),options)}function lineString(coordinates,properties,options){if(!coordinates)throw new Error("coordinates is required");if(coordinates.length<2)throw new Error("coordinates must be an array of two or more positions");if(!isNumber(coordinates[0][1])||!isNumber(coordinates[0][1]))throw new Error("coordinates must contain numbers");return feature({type:"LineString",coordinates},properties,options)}function lineStrings(coordinates,properties,options){if(!coordinates)throw new Error("coordinates is required");if(!Array.isArray(coordinates))throw new Error("coordinates must be an Array");return featureCollection(coordinates.map(function(coords){return lineString(coords,properties)}),options)}function featureCollection(features,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var bbox2=options.bbox,id=options.id;if(!features)throw new Error("No features passed");if(!Array.isArray(features))throw new Error("features must be an Array");bbox2&&validateBBox(bbox2),id&&validateId(id);var fc={type:"FeatureCollection"};return id&&(fc.id=id),bbox2&&(fc.bbox=bbox2),fc.features=features,fc}function multiLineString(coordinates,properties,options){if(!coordinates)throw new Error("coordinates is required");return feature({type:"MultiLineString",coordinates},properties,options)}function multiPoint(coordinates,properties,options){if(!coordinates)throw new Error("coordinates is required");return feature({type:"MultiPoint",coordinates},properties,options)}function multiPolygon(coordinates,properties,options){if(!coordinates)throw new Error("coordinates is required");return feature({type:"MultiPolygon",coordinates},properties,options)}function geometryCollection(geometries,properties,options){if(!geometries)throw new Error("geometries is required");if(!Array.isArray(geometries))throw new Error("geometries must be an Array");return feature({type:"GeometryCollection",geometries},properties,options)}function round(num,precision){if(num==null||isNaN(num))throw new Error("num is required");if(precision&&!(precision>=0))throw new Error("precision must be a positive number");var multiplier=Math.pow(10,precision||0);return Math.round(num*multiplier)/multiplier}function radiansToLength(radians2,units){if(radians2==null)throw new Error("radians is required");if(units&&typeof units!="string")throw new Error("units must be a string");var factor=factors[units||"kilometers"];if(!factor)throw new Error(units+" units is invalid");return radians2*factor}function lengthToRadians(distance12,units){if(distance12==null)throw new Error("distance is required");if(units&&typeof units!="string")throw new Error("units must be a string");var factor=factors[units||"kilometers"];if(!factor)throw new Error(units+" units is invalid");return distance12/factor}function lengthToDegrees(distance12,units){return radiansToDegrees(lengthToRadians(distance12,units))}function bearingToAzimuth(bearing2){if(bearing2==null)throw new Error("bearing is required");var angle3=bearing2%360;return angle3<0&&(angle3+=360),angle3}function radiansToDegrees(radians2){if(radians2==null)throw new Error("radians is required");var degrees2=radians2%(2*Math.PI);return degrees2*180/Math.PI}function degreesToRadians(degrees2){if(degrees2==null)throw new Error("degrees is required");var radians2=degrees2%360;return radians2*Math.PI/180}function convertLength(length3,originalUnit,finalUnit){if(length3==null)throw new Error("length is required");if(!(length3>=0))throw new Error("length must be a positive number");return radiansToLength(lengthToRadians(length3,originalUnit),finalUnit||"kilometers")}function convertArea(area5,originalUnit,finalUnit){if(area5==null)throw new Error("area is required");if(!(area5>=0))throw new Error("area must be a positive number");var startFactor=areaFactors[originalUnit||"meters"];if(!startFactor)throw new Error("invalid original units");var finalFactor=areaFactors[finalUnit||"kilometers"];if(!finalFactor)throw new Error("invalid final units");return area5/startFactor*finalFactor}function isNumber(num){return!isNaN(num)&&num!==null&&!Array.isArray(num)}function isObject(input){return!!input&&input.constructor===Object}function validateBBox(bbox2){if(!bbox2)throw new Error("bbox is required");if(!Array.isArray(bbox2))throw new Error("bbox must be an Array");if(bbox2.length!==4&&bbox2.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");bbox2.forEach(function(num){if(!isNumber(num))throw new Error("bbox must only contain numbers")})}function validateId(id){if(!id)throw new Error("id is required");if(["string","number"].indexOf(typeof id)===-1)throw new Error("id must be a number or a string")}function radians2degrees(){throw new Error("method has been renamed to `radiansToDegrees`")}function degrees2radians(){throw new Error("method has been renamed to `degreesToRadians`")}function distanceToDegrees(){throw new Error("method has been renamed to `lengthToDegrees`")}function distanceToRadians(){throw new Error("method has been renamed to `lengthToRadians`")}function radiansToDistance(){throw new Error("method has been renamed to `radiansToLength`")}function bearingToAngle(){throw new Error("method has been renamed to `bearingToAzimuth`")}function convertDistance(){throw new Error("method has been renamed to `convertLength`")}var main_es$1=Object.freeze({earthRadius,factors,unitsFactors,areaFactors,feature,geometry,point,points,polygon,polygons,lineString,lineStrings,featureCollection,multiLineString,multiPoint,multiPolygon,geometryCollection,round,radiansToLength,lengthToRadians,lengthToDegrees,bearingToAzimuth,radiansToDegrees,degreesToRadians,convertLength,convertArea,isNumber,isObject,validateBBox,validateId,radians2degrees,degrees2radians,distanceToDegrees,distanceToRadians,radiansToDistance,bearingToAngle,convertDistance});function coordEach(geojson,callback,excludeWrapCoord){if(geojson!==null)for(var j,k,l,geometry$$1,stopG,coords,geometryMaybeCollection,wrapShrink=0,coordIndex=0,isGeometryCollection2,type=geojson.type,isFeatureCollection=type==="FeatureCollection",isFeature=type==="Feature",stop2=isFeatureCollection?geojson.features.length:1,featureIndex=0;featureIndex<stop2;featureIndex++){geometryMaybeCollection=isFeatureCollection?geojson.features[featureIndex].geometry:isFeature?geojson.geometry:geojson,isGeometryCollection2=geometryMaybeCollection?geometryMaybeCollection.type==="GeometryCollection":!1,stopG=isGeometryCollection2?geometryMaybeCollection.geometries.length:1;for(var geomIndex=0;geomIndex<stopG;geomIndex++){var multiFeatureIndex=0,geometryIndex=0;if(geometry$$1=isGeometryCollection2?geometryMaybeCollection.geometries[geomIndex]:geometryMaybeCollection,geometry$$1!==null){coords=geometry$$1.coordinates;var geomType=geometry$$1.type;switch(wrapShrink=excludeWrapCoord&&(geomType==="Polygon"||geomType==="MultiPolygon")?1:0,geomType){case null:break;case"Point":callback(coords,coordIndex,featureIndex,multiFeatureIndex,geometryIndex),coordIndex++,multiFeatureIndex++;break;case"LineString":case"MultiPoint":for(j=0;j<coords.length;j++)callback(coords[j],coordIndex,featureIndex,multiFeatureIndex,geometryIndex),coordIndex++,geomType==="MultiPoint"&&multiFeatureIndex++;geomType==="LineString"&&multiFeatureIndex++;break;case"Polygon":case"MultiLineString":for(j=0;j<coords.length;j++){for(k=0;k<coords[j].length-wrapShrink;k++)callback(coords[j][k],coordIndex,featureIndex,multiFeatureIndex,geometryIndex),coordIndex++;geomType==="MultiLineString"&&multiFeatureIndex++,geomType==="Polygon"&&geometryIndex++}geomType==="Polygon"&&multiFeatureIndex++;break;case"MultiPolygon":for(j=0;j<coords.length;j++){for(geomType==="MultiPolygon"&&(geometryIndex=0),k=0;k<coords[j].length;k++){for(l=0;l<coords[j][k].length-wrapShrink;l++)callback(coords[j][k][l],coordIndex,featureIndex,multiFeatureIndex,geometryIndex),coordIndex++;geometryIndex++}multiFeatureIndex++}break;case"GeometryCollection":for(j=0;j<geometry$$1.geometries.length;j++)coordEach(geometry$$1.geometries[j],callback,excludeWrapCoord);break;default:throw new Error("Unknown Geometry Type")}}}}}function coordReduce(geojson,callback,initialValue,excludeWrapCoord){var previousValue=initialValue;return coordEach(geojson,function(currentCoord,coordIndex,featureIndex,multiFeatureIndex,geometryIndex){coordIndex===0&&initialValue===void 0?previousValue=currentCoord:previousValue=callback(previousValue,currentCoord,coordIndex,featureIndex,multiFeatureIndex,geometryIndex)},excludeWrapCoord),previousValue}function propEach(geojson,callback){var i;switch(geojson.type){case"FeatureCollection":for(i=0;i<geojson.features.length;i++)callback(geojson.features[i].properties,i);break;case"Feature":callback(geojson.properties,0);break}}function propReduce(geojson,callback,initialValue){var previousValue=initialValue;return propEach(geojson,function(currentProperties,featureIndex){featureIndex===0&&initialValue===void 0?previousValue=currentProperties:previousValue=callback(previousValue,currentProperties,featureIndex)}),previousValue}function featureEach(geojson,callback){if(geojson.type==="Feature")callback(geojson,0);else if(geojson.type==="FeatureCollection")for(var i=0;i<geojson.features.length;i++)callback(geojson.features[i],i)}function featureReduce(geojson,callback,initialValue){var previousValue=initialValue;return featureEach(geojson,function(currentFeature,featureIndex){featureIndex===0&&initialValue===void 0?previousValue=currentFeature:previousValue=callback(previousValue,currentFeature,featureIndex)}),previousValue}function coordAll(geojson){var coords=[];return coordEach(geojson,function(coord){coords.push(coord)}),coords}function geomEach(geojson,callback){var i,j,g,geometry$$1,stopG,geometryMaybeCollection,isGeometryCollection2,featureProperties,featureBBox,featureId,featureIndex=0,isFeatureCollection=geojson.type==="FeatureCollection",isFeature=geojson.type==="Feature",stop2=isFeatureCollection?geojson.features.length:1;for(i=0;i<stop2;i++){for(geometryMaybeCollection=isFeatureCollection?geojson.features[i].geometry:isFeature?geojson.geometry:geojson,featureProperties=isFeatureCollection?geojson.features[i].properties:isFeature?geojson.properties:{},featureBBox=isFeatureCollection?geojson.features[i].bbox:isFeature?geojson.bbox:void 0,featureId=isFeatureCollection?geojson.features[i].id:isFeature?geojson.id:void 0,isGeometryCollection2=geometryMaybeCollection?geometryMaybeCollection.type==="GeometryCollection":!1,stopG=isGeometryCollection2?geometryMaybeCollection.geometries.length:1,g=0;g<stopG;g++){if(geometry$$1=isGeometryCollection2?geometryMaybeCollection.geometries[g]:geometryMaybeCollection,geometry$$1===null){callback(null,featureIndex,featureProperties,featureBBox,featureId);continue}switch(geometry$$1.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{callback(geometry$$1,featureIndex,featureProperties,featureBBox,featureId);break}case"GeometryCollection":{for(j=0;j<geometry$$1.geometries.length;j++)callback(geometry$$1.geometries[j],featureIndex,featureProperties,featureBBox,featureId);break}default:throw new Error("Unknown Geometry Type")}}featureIndex++}}function geomReduce(geojson,callback,initialValue){var previousValue=initialValue;return geomEach(geojson,function(currentGeometry,featureIndex,featureProperties,featureBBox,featureId){featureIndex===0&&initialValue===void 0?previousValue=currentGeometry:previousValue=callback(previousValue,currentGeometry,featureIndex,featureProperties,featureBBox,featureId)}),previousValue}function flattenEach(geojson,callback){geomEach(geojson,function(geometry$$1,featureIndex,properties,bbox2,id){var type=geometry$$1===null?null:geometry$$1.type;switch(type){case null:case"Point":case"LineString":case"Polygon":callback(feature(geometry$$1,properties,{bbox:bbox2,id}),featureIndex,0);return}var geomType;switch(type){case"MultiPoint":geomType="Point";break;case"MultiLineString":geomType="LineString";break;case"MultiPolygon":geomType="Polygon";break}geometry$$1.coordinates.forEach(function(coordinate2,multiFeatureIndex){var geom={type:geomType,coordinates:coordinate2};callback(feature(geom,properties),featureIndex,multiFeatureIndex)})})}function flattenReduce(geojson,callback,initialValue){var previousValue=initialValue;return flattenEach(geojson,function(currentFeature,featureIndex,multiFeatureIndex){featureIndex===0&&multiFeatureIndex===0&&initialValue===void 0?previousValue=currentFeature:previousValue=callback(previousValue,currentFeature,featureIndex,multiFeatureIndex)}),previousValue}function segmentEach(geojson,callback){flattenEach(geojson,function(feature$$1,featureIndex,multiFeatureIndex){var segmentIndex=0;if(!!feature$$1.geometry){var type=feature$$1.geometry.type;type==="Point"||type==="MultiPoint"||coordReduce(feature$$1,function(previousCoords,currentCoord,coordIndex,featureIndexCoord,mutliPartIndexCoord,geometryIndex){var currentSegment=lineString([previousCoords,currentCoord],feature$$1.properties);return callback(currentSegment,featureIndex,multiFeatureIndex,geometryIndex,segmentIndex),segmentIndex++,currentCoord})}})}function segmentReduce(geojson,callback,initialValue){var previousValue=initialValue,started=!1;return segmentEach(geojson,function(currentSegment,featureIndex,multiFeatureIndex,geometryIndex,segmentIndex){started===!1&&initialValue===void 0?previousValue=currentSegment:previousValue=callback(previousValue,currentSegment,featureIndex,multiFeatureIndex,geometryIndex,segmentIndex),started=!0}),previousValue}function lineEach(geojson,callback){if(!geojson)throw new Error("geojson is required");flattenEach(geojson,function(feature$$1,featureIndex,multiFeatureIndex){if(feature$$1.geometry!==null){var type=feature$$1.geometry.type,coords=feature$$1.geometry.coordinates;switch(type){case"LineString":callback(feature$$1,featureIndex,multiFeatureIndex,0,0);break;case"Polygon":for(var geometryIndex=0;geometryIndex<coords.length;geometryIndex++)callback(lineString(coords[geometryIndex],feature$$1.properties),featureIndex,multiFeatureIndex,geometryIndex);break}}})}function lineReduce(geojson,callback,initialValue){var previousValue=initialValue;return lineEach(geojson,function(currentLine,featureIndex,multiFeatureIndex,geometryIndex){featureIndex===0&&initialValue===void 0?previousValue=currentLine:previousValue=callback(previousValue,currentLine,featureIndex,multiFeatureIndex,geometryIndex)}),previousValue}var main_es=Object.freeze({coordEach,coordReduce,propEach,propReduce,featureEach,featureReduce,coordAll,geomEach,geomReduce,flattenEach,flattenReduce,segmentEach,segmentReduce,lineEach,lineReduce});function bbox(geojson){var BBox=[1/0,1/0,-1/0,-1/0];return coordEach(geojson,function(coord){BBox[0]>coord[0]&&(BBox[0]=coord[0]),BBox[1]>coord[1]&&(BBox[1]=coord[1]),BBox[2]<coord[0]&&(BBox[2]=coord[0]),BBox[3]<coord[1]&&(BBox[3]=coord[1])}),BBox}function getCoord(obj){if(!obj)throw new Error("obj is required");var coordinates=getCoords(obj);if(coordinates.length>1&&isNumber(coordinates[0])&&isNumber(coordinates[1]))return coordinates;throw new Error("Coordinate is not a valid Point")}function getCoords(obj){if(!obj)throw new Error("obj is required");var coordinates;if(obj.length?coordinates=obj:obj.coordinates?coordinates=obj.coordinates:obj.geometry&&obj.geometry.coordinates&&(coordinates=obj.geometry.coordinates),coordinates)return containsNumber(coordinates),coordinates;throw new Error("No valid coordinates")}function containsNumber(coordinates){if(coordinates.length>1&&isNumber(coordinates[0])&&isNumber(coordinates[1]))return!0;if(Array.isArray(coordinates[0])&&coordinates[0].length)return containsNumber(coordinates[0]);throw new Error("coordinates must only contain numbers")}function geojsonType(value,type,name){if(!type||!name)throw new Error("type and name required");if(!value||value.type!==type)throw new Error("Invalid input to "+name+": must be a "+type+", given "+value.type)}function featureOf(feature$$1,type,name){if(!feature$$1)throw new Error("No feature passed");if(!name)throw new Error(".featureOf() requires a name");if(!feature$$1||feature$$1.type!=="Feature"||!feature$$1.geometry)throw new Error("Invalid input to "+name+", Feature with geometry required");if(!feature$$1.geometry||feature$$1.geometry.type!==type)throw new Error("Invalid input to "+name+": must be a "+type+", given "+feature$$1.geometry.type)}function collectionOf(featureCollection$$1,type,name){if(!featureCollection$$1)throw new Error("No featureCollection passed");if(!name)throw new Error(".collectionOf() requires a name");if(!featureCollection$$1||featureCollection$$1.type!=="FeatureCollection")throw new Error("Invalid input to "+name+", FeatureCollection required");for(var i=0;i<featureCollection$$1.features.length;i++){var feature$$1=featureCollection$$1.features[i];if(!feature$$1||feature$$1.type!=="Feature"||!feature$$1.geometry)throw new Error("Invalid input to "+name+", Feature with geometry required");if(!feature$$1.geometry||feature$$1.geometry.type!==type)throw new Error("Invalid input to "+name+": must be a "+type+", given "+feature$$1.geometry.type)}}function getGeom(geojson){if(!geojson)throw new Error("geojson is required");if(geojson.geometry!==void 0)return geojson.geometry;if(geojson.coordinates||geojson.geometries)return geojson;throw new Error("geojson must be a valid Feature or Geometry Object")}function getGeomType(){throw new Error("invariant.getGeomType has been deprecated in v5.0 in favor of invariant.getType")}function getType(geojson,name){if(!geojson)throw new Error((name||"geojson")+" is required");if(geojson.geometry&&geojson.geometry.type)return geojson.geometry.type;if(geojson.type)return geojson.type;throw new Error((name||"geojson")+" is invalid")}var main_es$2=Object.freeze({getCoord,getCoords,containsNumber,geojsonType,featureOf,collectionOf,getGeom,getGeomType,getType});/**
 * @license GNU Affero General Public License.
 * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 * v. 1.2.0
 * https://github.com/RaumZeit/MarchingSquares.js
 */var defaultSettings={successCallback:null,verbose:!1},settings={};function isoContours(data,threshold,options){options=options||{};for(var optionKeys=Object.keys(defaultSettings),i=0;i<optionKeys.length;i++){var key=optionKeys[i],val=options[key];val=typeof val<"u"&&val!==null?val:defaultSettings[key],settings[key]=val}settings.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+threshold);var ret=contourGrid2Paths(computeContourGrid(data,threshold));return typeof settings.successCallback=="function"&&settings.successCallback(ret),ret}function interpolateX(y2,y0,y12){return(y2-y0)/(y12-y0)}function computeContourGrid(data,threshold){for(var rows=data.length-1,cols=data[0].length-1,ContourGrid={rows,cols,cells:[]},j=0;j<rows;++j){ContourGrid.cells[j]=[];for(var i=0;i<cols;++i){var cval=0,tl=data[j+1][i],tr=data[j+1][i+1],br=data[j][i+1],bl=data[j][i];if(!(isNaN(tl)||isNaN(tr)||isNaN(br)||isNaN(bl))){cval|=tl>=threshold?8:0,cval|=tr>=threshold?4:0,cval|=br>=threshold?2:0,cval|=bl>=threshold?1:0;var flipped=!1;if(cval===5||cval===10){var average2=(tl+tr+br+bl)/4;cval===5&&average2<threshold?(cval=10,flipped=!0):cval===10&&average2<threshold&&(cval=5,flipped=!0)}if(cval!==0&&cval!==15){var top,bottom,left,right;top=bottom=left=right=.5,cval===1?(left=1-interpolateX(threshold,tl,bl),bottom=1-interpolateX(threshold,br,bl)):cval===2?(bottom=interpolateX(threshold,bl,br),right=1-interpolateX(threshold,tr,br)):cval===3?(left=1-interpolateX(threshold,tl,bl),right=1-interpolateX(threshold,tr,br)):cval===4?(top=interpolateX(threshold,tl,tr),right=interpolateX(threshold,br,tr)):cval===5?(top=interpolateX(threshold,tl,tr),right=interpolateX(threshold,br,tr),bottom=1-interpolateX(threshold,br,bl),left=1-interpolateX(threshold,tl,bl)):cval===6?(bottom=interpolateX(threshold,bl,br),top=interpolateX(threshold,tl,tr)):cval===7?(left=1-interpolateX(threshold,tl,bl),top=interpolateX(threshold,tl,tr)):cval===8?(left=interpolateX(threshold,bl,tl),top=1-interpolateX(threshold,tr,tl)):cval===9?(bottom=1-interpolateX(threshold,br,bl),top=1-interpolateX(threshold,tr,tl)):cval===10?(top=1-interpolateX(threshold,tr,tl),right=1-interpolateX(threshold,tr,br),bottom=interpolateX(threshold,bl,br),left=interpolateX(threshold,bl,tl)):cval===11?(top=1-interpolateX(threshold,tr,tl),right=1-interpolateX(threshold,tr,br)):cval===12?(left=interpolateX(threshold,bl,tl),right=interpolateX(threshold,br,tr)):cval===13?(bottom=1-interpolateX(threshold,br,bl),right=interpolateX(threshold,br,tr)):cval===14?(left=interpolateX(threshold,bl,tl),bottom=interpolateX(threshold,bl,br)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+cval),ContourGrid.cells[j][i]={cval,flipped,top,right,bottom,left}}}}}return ContourGrid}function isSaddle(cell){return cell.cval===5||cell.cval===10}function isTrivial(cell){return cell.cval===0||cell.cval===15}function clearCell(cell){!isTrivial(cell)&&cell.cval!==5&&cell.cval!==10&&(cell.cval=15)}function getXY(cell,edge){if(edge==="top")return[cell.top,1];if(edge==="bottom")return[cell.bottom,0];if(edge==="right")return[1,cell.right];if(edge==="left")return[0,cell.left]}function contourGrid2Paths(grid){var paths=[],path_idx=0,rows=grid.rows,cols=grid.cols,epsilon3=1e-7;return grid.cells.forEach(function(g,j){g.forEach(function(gg,i){if(typeof gg<"u"&&!isSaddle(gg)&&!isTrivial(gg)){var p=tracePath(grid.cells,j,i),merged=!1;if(p.info==="mergeable"){for(var x2=p.path[p.path.length-1][0],y2=p.path[p.path.length-1][1],k=path_idx-1;k>=0;k--)if(Math.abs(paths[k][0][0]-x2)<=epsilon3&&Math.abs(paths[k][0][1]-y2)<=epsilon3){for(var l=p.path.length-2;l>=0;--l)paths[k].unshift(p.path[l]);merged=!0;break}}merged||(paths[path_idx++]=p.path)}})}),paths}function tracePath(grid,j,i){var maxj=grid.length,p=[],dxContour=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],dyContour=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],dx,dy,startEdge=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"],nextEdge=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],edge,startCell=grid[j][i],currentCell=grid[j][i],cval=currentCell.cval,edge=startEdge[cval],pt=getXY(currentCell,edge);p.push([i+pt[0],j+pt[1]]),edge=nextEdge[cval],pt=getXY(currentCell,edge),p.push([i+pt[0],j+pt[1]]),clearCell(currentCell);for(var k=i+dxContour[cval],l=j+dyContour[cval],prev_cval=cval;k>=0&&l>=0&&l<maxj&&(k!=i||l!=j)&&(currentCell=grid[l][k],!(typeof currentCell>"u"));){if(cval=currentCell.cval,cval===0||cval===15)return{path:p,info:"mergeable"};edge=nextEdge[cval],dx=dxContour[cval],dy=dyContour[cval],(cval===5||cval===10)&&(cval===5?currentCell.flipped?dyContour[prev_cval]===-1?(edge="left",dx=-1,dy=0):(edge="right",dx=1,dy=0):dxContour[prev_cval]===-1&&(edge="bottom",dx=0,dy=-1):cval===10&&(currentCell.flipped?dxContour[prev_cval]===-1?(edge="top",dx=0,dy=1):(edge="bottom",dx=0,dy=-1):dyContour[prev_cval]===1&&(edge="left",dx=-1,dy=0))),pt=getXY(currentCell,edge),p.push([k+pt[0],l+pt[1]]),clearCell(currentCell),k+=dx,l+=dy,prev_cval=cval}return{path:p,info:"closed"}}function gridToMatrix(grid,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var zProperty=options.zProperty||"elevation",flip4=options.flip,flags=options.flags;collectionOf(grid,"Point","input must contain Points");for(var pointsMatrix=sortPointsByLatLng(grid,flip4),matrix=[],r=0;r<pointsMatrix.length;r++){for(var pointRow=pointsMatrix[r],row=[],c=0;c<pointRow.length;c++){var point$$1=pointRow[c];point$$1.properties[zProperty]?row.push(point$$1.properties[zProperty]):row.push(0),flags===!0&&(point$$1.properties.matrixPosition=[r,c])}matrix.push(row)}return matrix}function sortPointsByLatLng(points$$1,flip4){var pointsByLatitude={};featureEach(points$$1,function(point$$1){var lat2=getCoords(point$$1)[1];pointsByLatitude[lat2]||(pointsByLatitude[lat2]=[]),pointsByLatitude[lat2].push(point$$1)});var orderedRowsByLatitude=Object.keys(pointsByLatitude).map(function(lat2){var row=pointsByLatitude[lat2],rowOrderedByLongitude=row.sort(function(a,b){return getCoords(a)[0]-getCoords(b)[0]});return rowOrderedByLongitude}),pointMatrix=orderedRowsByLatitude.sort(function(a,b){return flip4?getCoords(a[0])[1]-getCoords(b[0])[1]:getCoords(b[0])[1]-getCoords(a[0])[1]});return pointMatrix}function isolines(pointGrid2,breaks,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var zProperty=options.zProperty||"elevation",commonProperties=options.commonProperties||{},breaksProperties=options.breaksProperties||[];if(collectionOf(pointGrid2,"Point","Input must contain Points"),!breaks)throw new Error("breaks is required");if(!Array.isArray(breaks))throw new Error("breaks must be an Array");if(!isObject(commonProperties))throw new Error("commonProperties must be an Object");if(!Array.isArray(breaksProperties))throw new Error("breaksProperties must be an Array");var matrix=gridToMatrix(pointGrid2,{zProperty,flip:!0}),createdIsoLines=createIsoLines(matrix,breaks,zProperty,commonProperties,breaksProperties),scaledIsolines=rescaleIsolines(createdIsoLines,matrix,pointGrid2);return featureCollection(scaledIsolines)}function createIsoLines(matrix,breaks,zProperty,commonProperties,breaksProperties){for(var results=[],i=1;i<breaks.length;i++){var threshold=+breaks[i],properties=Object.assign({},commonProperties,breaksProperties[i]);properties[zProperty]=threshold;var isoline=multiLineString(isoContours(matrix,threshold),properties);results.push(isoline)}return results}function rescaleIsolines(createdIsoLines,matrix,points$$1){var gridBbox=bbox(points$$1),originalWidth=gridBbox[2]-gridBbox[0],originalHeigth=gridBbox[3]-gridBbox[1],x0=gridBbox[0],y0=gridBbox[1],matrixWidth=matrix[0].length-1,matrixHeight=matrix.length-1,scaleX=originalWidth/matrixWidth,scaleY=originalHeigth/matrixHeight,resize=function(point$$1){point$$1[0]=point$$1[0]*scaleX+x0,point$$1[1]=point$$1[1]*scaleY+y0};return createdIsoLines.forEach(function(isoline){coordEach(isoline,resize)}),createdIsoLines}var quickselect=partialSort;function partialSort(arr,k,left,right,compare10){for(left=left||0,right=right||arr.length-1,compare10=compare10||defaultCompare;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1),newLeft=Math.max(left,Math.floor(k-m*s/n+sd)),newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));partialSort(arr,k,newLeft,newRight,compare10)}var t=arr[k],i=left,j=right;for(swap(arr,left,k),compare10(arr[right],t)>0&&swap(arr,left,right);i<j;){for(swap(arr,i,j),i++,j--;compare10(arr[i],t)<0;)i++;for(;compare10(arr[j],t)>0;)j--}compare10(arr[left],t)===0?swap(arr,left,j):(j++,swap(arr,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}var rbush_1=rbush;function rbush(maxEntries,format){if(!(this instanceof rbush))return new rbush(maxEntries,format);this._maxEntries=Math.max(4,maxEntries||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),format&&this._initFormat(format),this.clear()}rbush.prototype={all:function(){return this._all(this.data,[])},search:function(bbox2){var node=this.data,result=[],toBBox=this.toBBox;if(!intersects$1(bbox2,node))return result;for(var nodesToSearch=[],i,len,child,childBBox;node;){for(i=0,len=node.children.length;i<len;i++)child=node.children[i],childBBox=node.leaf?toBBox(child):child,intersects$1(bbox2,childBBox)&&(node.leaf?result.push(child):contains(bbox2,childBBox)?this._all(child,result):nodesToSearch.push(child));node=nodesToSearch.pop()}return result},collides:function(bbox2){var node=this.data,toBBox=this.toBBox;if(!intersects$1(bbox2,node))return!1;for(var nodesToSearch=[],i,len,child,childBBox;node;){for(i=0,len=node.children.length;i<len;i++)if(child=node.children[i],childBBox=node.leaf?toBBox(child):child,intersects$1(bbox2,childBBox)){if(node.leaf||contains(bbox2,childBBox))return!0;nodesToSearch.push(child)}node=nodesToSearch.pop()}return!1},load:function(data){if(!(data&&data.length))return this;if(data.length<this._minEntries){for(var i=0,len=data.length;i<len;i++)this.insert(data[i]);return this}var node=this._build(data.slice(),0,data.length-1,0);if(!this.data.children.length)this.data=node;else if(this.data.height===node.height)this._splitRoot(this.data,node);else{if(this.data.height<node.height){var tmpNode=this.data;this.data=node,node=tmpNode}this._insert(node,this.data.height-node.height-1,!0)}return this},insert:function(item){return item&&this._insert(item,this.data.height-1),this},clear:function(){return this.data=createNode([]),this},remove:function(item,equalsFn){if(!item)return this;for(var node=this.data,bbox2=this.toBBox(item),path=[],indexes=[],i,parent,index,goingUp;node||path.length;){if(node||(node=path.pop(),parent=path[path.length-1],i=indexes.pop(),goingUp=!0),node.leaf&&(index=findItem(item,node.children,equalsFn),index!==-1))return node.children.splice(index,1),path.push(node),this._condense(path),this;!goingUp&&!node.leaf&&contains(node,bbox2)?(path.push(node),indexes.push(i),i=0,parent=node,node=node.children[0]):parent?(i++,node=parent.children[i],goingUp=!1):node=null}return this},toBBox:function(item){return item},compareMinX:compareNodeMinX,compareMinY:compareNodeMinY,toJSON:function(){return this.data},fromJSON:function(data){return this.data=data,this},_all:function(node,result){for(var nodesToSearch=[];node;)node.leaf?result.push.apply(result,node.children):nodesToSearch.push.apply(nodesToSearch,node.children),node=nodesToSearch.pop();return result},_build:function(items,left,right,height2){var N=right-left+1,M=this._maxEntries,node;if(N<=M)return node=createNode(items.slice(left,right+1)),calcBBox(node,this.toBBox),node;height2||(height2=Math.ceil(Math.log(N)/Math.log(M)),M=Math.ceil(N/Math.pow(M,height2-1))),node=createNode([]),node.leaf=!1,node.height=height2;var N2=Math.ceil(N/M),N1=N2*Math.ceil(Math.sqrt(M)),i,j,right2,right3;for(multiSelect(items,left,right,N1,this.compareMinX),i=left;i<=right;i+=N1)for(right2=Math.min(i+N1-1,right),multiSelect(items,i,right2,N2,this.compareMinY),j=i;j<=right2;j+=N2)right3=Math.min(j+N2-1,right2),node.children.push(this._build(items,j,right3,height2-1));return calcBBox(node,this.toBBox),node},_chooseSubtree:function(bbox2,node,level,path){for(var i,len,child,targetNode,area5,enlargement,minArea,minEnlargement;path.push(node),!(node.leaf||path.length-1===level);){for(minArea=minEnlargement=1/0,i=0,len=node.children.length;i<len;i++)child=node.children[i],area5=bboxArea(child),enlargement=enlargedArea(bbox2,child)-area5,enlargement<minEnlargement?(minEnlargement=enlargement,minArea=area5<minArea?area5:minArea,targetNode=child):enlargement===minEnlargement&&area5<minArea&&(minArea=area5,targetNode=child);node=targetNode||node.children[0]}return node},_insert:function(item,level,isNode){var toBBox=this.toBBox,bbox2=isNode?item:toBBox(item),insertPath=[],node=this._chooseSubtree(bbox2,this.data,level,insertPath);for(node.children.push(item),extend(node,bbox2);level>=0&&insertPath[level].children.length>this._maxEntries;)this._split(insertPath,level),level--;this._adjustParentBBoxes(bbox2,insertPath,level)},_split:function(insertPath,level){var node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);var splitIndex=this._chooseSplitIndex(node,m,M),newNode=createNode(node.children.splice(splitIndex,node.children.length-splitIndex));newNode.height=node.height,newNode.leaf=node.leaf,calcBBox(node,this.toBBox),calcBBox(newNode,this.toBBox),level?insertPath[level-1].children.push(newNode):this._splitRoot(node,newNode)},_splitRoot:function(node,newNode){this.data=createNode([node,newNode]),this.data.height=node.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)},_chooseSplitIndex:function(node,m,M){var i,bbox1,bbox2,overlap2,area5,minOverlap,minArea,index;for(minOverlap=minArea=1/0,i=m;i<=M-m;i++)bbox1=distBBox(node,0,i,this.toBBox),bbox2=distBBox(node,i,M,this.toBBox),overlap2=intersectionArea(bbox1,bbox2),area5=bboxArea(bbox1)+bboxArea(bbox2),overlap2<minOverlap?(minOverlap=overlap2,index=i,minArea=area5<minArea?area5:minArea):overlap2===minOverlap&&area5<minArea&&(minArea=area5,index=i);return index},_chooseSplitAxis:function(node,m,M){var compareMinX=node.leaf?this.compareMinX:compareNodeMinX,compareMinY=node.leaf?this.compareMinY:compareNodeMinY,xMargin=this._allDistMargin(node,m,M,compareMinX),yMargin=this._allDistMargin(node,m,M,compareMinY);xMargin<yMargin&&node.children.sort(compareMinX)},_allDistMargin:function(node,m,M,compare10){node.children.sort(compare10);var toBBox=this.toBBox,leftBBox=distBBox(node,0,m,toBBox),rightBBox=distBBox(node,M-m,M,toBBox),margin=bboxMargin(leftBBox)+bboxMargin(rightBBox),i,child;for(i=m;i<M-m;i++)child=node.children[i],extend(leftBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(leftBBox);for(i=M-m-1;i>=m;i--)child=node.children[i],extend(rightBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(rightBBox);return margin},_adjustParentBBoxes:function(bbox2,path,level){for(var i=level;i>=0;i--)extend(path[i],bbox2)},_condense:function(path){for(var i=path.length-1,siblings;i>=0;i--)path[i].children.length===0?i>0?(siblings=path[i-1].children,siblings.splice(siblings.indexOf(path[i]),1)):this.clear():calcBBox(path[i],this.toBBox)},_initFormat:function(format){var compareArr=["return a"," - b",";"];this.compareMinX=new Function("a","b",compareArr.join(format[0])),this.compareMinY=new Function("a","b",compareArr.join(format[1])),this.toBBox=new Function("a","return {minX: a"+format[0]+", minY: a"+format[1]+", maxX: a"+format[2]+", maxY: a"+format[3]+"};")}};function findItem(item,items,equalsFn){if(!equalsFn)return items.indexOf(item);for(var i=0;i<items.length;i++)if(equalsFn(item,items[i]))return i;return-1}function calcBBox(node,toBBox){distBBox(node,0,node.children.length,toBBox,node)}function distBBox(node,k,p,toBBox,destNode){destNode||(destNode=createNode(null)),destNode.minX=1/0,destNode.minY=1/0,destNode.maxX=-1/0,destNode.maxY=-1/0;for(var i=k,child;i<p;i++)child=node.children[i],extend(destNode,node.leaf?toBBox(child):child);return destNode}function extend(a,b){return a.minX=Math.min(a.minX,b.minX),a.minY=Math.min(a.minY,b.minY),a.maxX=Math.max(a.maxX,b.maxX),a.maxY=Math.max(a.maxY,b.maxY),a}function compareNodeMinX(a,b){return a.minX-b.minX}function compareNodeMinY(a,b){return a.minY-b.minY}function bboxArea(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function bboxMargin(a){return a.maxX-a.minX+(a.maxY-a.minY)}function enlargedArea(a,b){return(Math.max(b.maxX,a.maxX)-Math.min(b.minX,a.minX))*(Math.max(b.maxY,a.maxY)-Math.min(b.minY,a.minY))}function intersectionArea(a,b){var minX2=Math.max(a.minX,b.minX),minY2=Math.max(a.minY,b.minY),maxX2=Math.min(a.maxX,b.maxX),maxY2=Math.min(a.maxY,b.maxY);return Math.max(0,maxX2-minX2)*Math.max(0,maxY2-minY2)}function contains(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function intersects$1(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function createNode(children){return{children,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(arr,left,right,n,compare10){for(var stack=[left,right],mid;stack.length;)right=stack.pop(),left=stack.pop(),!(right-left<=n)&&(mid=left+Math.ceil((right-left)/n/2)*n,quickselect(arr,mid,left,right,compare10),stack.push(left,mid,mid,right))}function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}var twoProduct_1=twoProduct,SPLITTER=+(Math.pow(2,27)+1);function twoProduct(a,b,result){var x2=a*b,c=SPLITTER*a,abig=c-a,ahi=c-abig,alo=a-ahi,d=SPLITTER*b,bbig=d-b,bhi=d-bbig,blo=b-bhi,err1=x2-ahi*bhi,err2=err1-alo*bhi,err3=err2-ahi*blo,y2=alo*blo-err3;return result?(result[0]=y2,result[1]=x2,result):[y2,x2]}var robustSum=linearExpansionSum;function scalarScalar(a,b){var x2=a+b,bv=x2-a,av=x2-bv,br=b-bv,ar=a-av,y2=ar+br;return y2?[y2,x2]:[x2]}function linearExpansionSum(e,f){var ne=e.length|0,nf=f.length|0;if(ne===1&&nf===1)return scalarScalar(e[0],f[0]);var n=ne+nf,g=new Array(n),count2=0,eptr=0,fptr=0,abs3=Math.abs,ei=e[eptr],ea=abs3(ei),fi=f[fptr],fa=abs3(fi),a,b;ea<fa?(b=ei,eptr+=1,eptr<ne&&(ei=e[eptr],ea=abs3(ei))):(b=fi,fptr+=1,fptr<nf&&(fi=f[fptr],fa=abs3(fi))),eptr<ne&&ea<fa||fptr>=nf?(a=ei,eptr+=1,eptr<ne&&(ei=e[eptr],ea=abs3(ei))):(a=fi,fptr+=1,fptr<nf&&(fi=f[fptr],fa=abs3(fi)));for(var x2=a+b,bv=x2-a,y2=b-bv,q0=y2,q1=x2,_x,_bv,_av,_br,_ar;eptr<ne&&fptr<nf;)ea<fa?(a=ei,eptr+=1,eptr<ne&&(ei=e[eptr],ea=abs3(ei))):(a=fi,fptr+=1,fptr<nf&&(fi=f[fptr],fa=abs3(fi))),b=q0,x2=a+b,bv=x2-a,y2=b-bv,y2&&(g[count2++]=y2),_x=q1+x2,_bv=_x-q1,_av=_x-_bv,_br=x2-_bv,_ar=q1-_av,q0=_ar+_br,q1=_x;for(;eptr<ne;)a=ei,b=q0,x2=a+b,bv=x2-a,y2=b-bv,y2&&(g[count2++]=y2),_x=q1+x2,_bv=_x-q1,_av=_x-_bv,_br=x2-_bv,_ar=q1-_av,q0=_ar+_br,q1=_x,eptr+=1,eptr<ne&&(ei=e[eptr]);for(;fptr<nf;)a=fi,b=q0,x2=a+b,bv=x2-a,y2=b-bv,y2&&(g[count2++]=y2),_x=q1+x2,_bv=_x-q1,_av=_x-_bv,_br=x2-_bv,_ar=q1-_av,q0=_ar+_br,q1=_x,fptr+=1,fptr<nf&&(fi=f[fptr]);return q0&&(g[count2++]=q0),q1&&(g[count2++]=q1),count2||(g[count2++]=0),g.length=count2,g}var twoSum=fastTwoSum;function fastTwoSum(a,b,result){var x2=a+b,bv=x2-a,av=x2-bv,br=b-bv,ar=a-av;return result?(result[0]=ar+br,result[1]=x2,result):[ar+br,x2]}var robustScale=scaleLinearExpansion;function scaleLinearExpansion(e,scale4){var n=e.length;if(n===1){var ts=twoProduct_1(e[0],scale4);return ts[0]?ts:[ts[1]]}var g=new Array(2*n),q=[.1,.1],t=[.1,.1],count2=0;twoProduct_1(e[0],scale4,q),q[0]&&(g[count2++]=q[0]);for(var i=1;i<n;++i){twoProduct_1(e[i],scale4,t);var pq=q[1];twoSum(pq,t[0],q),q[0]&&(g[count2++]=q[0]);var a=t[1],b=q[1],x2=a+b,bv=x2-a,y2=b-bv;q[1]=x2,y2&&(g[count2++]=y2)}return q[1]&&(g[count2++]=q[1]),count2===0&&(g[count2++]=0),g.length=count2,g}var robustDiff=robustSubtract;function scalarScalar$1(a,b){var x2=a+b,bv=x2-a,av=x2-bv,br=b-bv,ar=a-av,y2=ar+br;return y2?[y2,x2]:[x2]}function robustSubtract(e,f){var ne=e.length|0,nf=f.length|0;if(ne===1&&nf===1)return scalarScalar$1(e[0],-f[0]);var n=ne+nf,g=new Array(n),count2=0,eptr=0,fptr=0,abs3=Math.abs,ei=e[eptr],ea=abs3(ei),fi=-f[fptr],fa=abs3(fi),a,b;ea<fa?(b=ei,eptr+=1,eptr<ne&&(ei=e[eptr],ea=abs3(ei))):(b=fi,fptr+=1,fptr<nf&&(fi=-f[fptr],fa=abs3(fi))),eptr<ne&&ea<fa||fptr>=nf?(a=ei,eptr+=1,eptr<ne&&(ei=e[eptr],ea=abs3(ei))):(a=fi,fptr+=1,fptr<nf&&(fi=-f[fptr],fa=abs3(fi)));for(var x2=a+b,bv=x2-a,y2=b-bv,q0=y2,q1=x2,_x,_bv,_av,_br,_ar;eptr<ne&&fptr<nf;)ea<fa?(a=ei,eptr+=1,eptr<ne&&(ei=e[eptr],ea=abs3(ei))):(a=fi,fptr+=1,fptr<nf&&(fi=-f[fptr],fa=abs3(fi))),b=q0,x2=a+b,bv=x2-a,y2=b-bv,y2&&(g[count2++]=y2),_x=q1+x2,_bv=_x-q1,_av=_x-_bv,_br=x2-_bv,_ar=q1-_av,q0=_ar+_br,q1=_x;for(;eptr<ne;)a=ei,b=q0,x2=a+b,bv=x2-a,y2=b-bv,y2&&(g[count2++]=y2),_x=q1+x2,_bv=_x-q1,_av=_x-_bv,_br=x2-_bv,_ar=q1-_av,q0=_ar+_br,q1=_x,eptr+=1,eptr<ne&&(ei=e[eptr]);for(;fptr<nf;)a=fi,b=q0,x2=a+b,bv=x2-a,y2=b-bv,y2&&(g[count2++]=y2),_x=q1+x2,_bv=_x-q1,_av=_x-_bv,_br=x2-_bv,_ar=q1-_av,q0=_ar+_br,q1=_x,fptr+=1,fptr<nf&&(fi=-f[fptr]);return q0&&(g[count2++]=q0),q1&&(g[count2++]=q1),count2||(g[count2++]=0),g.length=count2,g}var orientation_1=createCommonjsModule(function(module){var NUM_EXPAND=5,EPSILON=11102230246251565e-32,ERRBOUND3=(3+16*EPSILON)*EPSILON,ERRBOUND4=(7+56*EPSILON)*EPSILON;function cofactor(m,c){for(var result=new Array(m.length-1),i=1;i<m.length;++i)for(var r=result[i-1]=new Array(m.length-1),j=0,k=0;j<m.length;++j)j!==c&&(r[k++]=m[i][j]);return result}function matrix(n){for(var result=new Array(n),i=0;i<n;++i){result[i]=new Array(n);for(var j=0;j<n;++j)result[i][j]=["m",j,"[",n-i-1,"]"].join("")}return result}function sign3(n){return n&1?"-":""}function generateSum(expr){if(expr.length===1)return expr[0];if(expr.length===2)return["sum(",expr[0],",",expr[1],")"].join("");var m=expr.length>>1;return["sum(",generateSum(expr.slice(0,m)),",",generateSum(expr.slice(m)),")"].join("")}function determinant(m){if(m.length===2)return[["sum(prod(",m[0][0],",",m[1][1],"),prod(-",m[0][1],",",m[1][0],"))"].join("")];for(var expr=[],i=0;i<m.length;++i)expr.push(["scale(",generateSum(determinant(cofactor(m,i))),",",sign3(i),m[0][i],")"].join(""));return expr}function orientation2(n){for(var pos=[],neg=[],m=matrix(n),args=[],i=0;i<n;++i)(i&1)===0?pos.push.apply(pos,determinant(cofactor(m,i))):neg.push.apply(neg,determinant(cofactor(m,i))),args.push("m"+i);var posExpr=generateSum(pos),negExpr=generateSum(neg),funcName="orientation"+n+"Exact",code=["function ",funcName,"(",args.join(),"){var p=",posExpr,",n=",negExpr,",d=sub(p,n);return d[d.length-1];};return ",funcName].join(""),proc=new Function("sum","prod","scale","sub",code);return proc(robustSum,twoProduct_1,robustScale,robustDiff)}var orientation3Exact=orientation2(3),orientation4Exact=orientation2(4),CACHED=[function(){return 0},function(){return 0},function(a,b){return b[0]-a[0]},function(a,b,c){var l=(a[1]-c[1])*(b[0]-c[0]),r=(a[0]-c[0])*(b[1]-c[1]),det2=l-r,s;if(l>0){if(r<=0)return det2;s=l+r}else if(l<0){if(r>=0)return det2;s=-(l+r)}else return det2;var tol=ERRBOUND3*s;return det2>=tol||det2<=-tol?det2:orientation3Exact(a,b,c)},function(a,b,c,d){var adx=a[0]-d[0],bdx=b[0]-d[0],cdx=c[0]-d[0],ady=a[1]-d[1],bdy=b[1]-d[1],cdy=c[1]-d[1],adz=a[2]-d[2],bdz=b[2]-d[2],cdz=c[2]-d[2],bdxcdy=bdx*cdy,cdxbdy=cdx*bdy,cdxady=cdx*ady,adxcdy=adx*cdy,adxbdy=adx*bdy,bdxady=bdx*ady,det2=adz*(bdxcdy-cdxbdy)+bdz*(cdxady-adxcdy)+cdz*(adxbdy-bdxady),permanent=(Math.abs(bdxcdy)+Math.abs(cdxbdy))*Math.abs(adz)+(Math.abs(cdxady)+Math.abs(adxcdy))*Math.abs(bdz)+(Math.abs(adxbdy)+Math.abs(bdxady))*Math.abs(cdz),tol=ERRBOUND4*permanent;return det2>tol||-det2>tol?det2:orientation4Exact(a,b,c,d)}];function slowOrient(args){var proc=CACHED[args.length];return proc||(proc=CACHED[args.length]=orientation2(args.length)),proc.apply(void 0,args)}function generateOrientationProc(){for(;CACHED.length<=NUM_EXPAND;)CACHED.push(orientation2(CACHED.length));for(var args=[],procArgs=["slow"],i=0;i<=NUM_EXPAND;++i)args.push("a"+i),procArgs.push("o"+i);for(var code=["function getOrientation(",args.join(),"){switch(arguments.length){case 0:case 1:return 0;"],i=2;i<=NUM_EXPAND;++i)code.push("case ",i,":return o",i,"(",args.slice(0,i).join(),");");code.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),procArgs.push(code.join(""));var proc=Function.apply(void 0,procArgs);module.exports=proc.apply(void 0,[slowOrient].concat(CACHED));for(var i=0;i<=NUM_EXPAND;++i)module.exports[i]=CACHED[i]}generateOrientationProc()}),monotoneConvexHull2d=monotoneConvexHull2D,orient$1=orientation_1[3];function monotoneConvexHull2D(points2){var n=points2.length;if(n<3){for(var result=new Array(n),i=0;i<n;++i)result[i]=i;return n===2&&points2[0][0]===points2[1][0]&&points2[0][1]===points2[1][1]?[0]:result}for(var sorted=new Array(n),i=0;i<n;++i)sorted[i]=i;sorted.sort(function(a,b){var d=points2[a][0]-points2[b][0];return d||points2[a][1]-points2[b][1]});for(var lower=[sorted[0],sorted[1]],upper=[sorted[0],sorted[1]],i=2;i<n;++i){for(var idx=sorted[i],p=points2[idx],m=lower.length;m>1&&orient$1(points2[lower[m-2]],points2[lower[m-1]],p)<=0;)m-=1,lower.pop();for(lower.push(idx),m=upper.length;m>1&&orient$1(points2[upper[m-2]],points2[upper[m-1]],p)>=0;)m-=1,upper.pop();upper.push(idx)}for(var result=new Array(upper.length+lower.length-2),ptr=0,i=0,nl=lower.length;i<nl;++i)result[ptr++]=lower[i];for(var j=upper.length-2;j>0;--j)result[ptr++]=upper[j];return result}var tinyqueue=TinyQueue,default_1$1=TinyQueue;function TinyQueue(data,compare10){if(!(this instanceof TinyQueue))return new TinyQueue(data,compare10);if(this.data=data||[],this.length=this.data.length,this.compare=compare10||defaultCompare$1,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function defaultCompare$1(a,b){return a<b?-1:a>b?1:0}TinyQueue.prototype={push:function(item){this.data.push(item),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var top=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),top}},peek:function(){return this.data[0]},_up:function(pos){for(var data=this.data,compare10=this.compare,item=data[pos];pos>0;){var parent=pos-1>>1,current=data[parent];if(compare10(item,current)>=0)break;data[pos]=current,pos=parent}data[pos]=item},_down:function(pos){for(var data=this.data,compare10=this.compare,halfLength=this.length>>1,item=data[pos];pos<halfLength;){var left=(pos<<1)+1,right=left+1,best=data[left];if(right<this.length&&compare10(data[right],best)<0&&(left=right,best=data[right]),compare10(best,item)>=0)break;data[pos]=best,pos=left}data[pos]=item}};tinyqueue.default=default_1$1;var pointInPolygon=function(point4,vs){for(var x2=point4[0],y2=point4[1],inside3=!1,i=0,j=vs.length-1;i<vs.length;j=i++){var xi=vs[i][0],yi=vs[i][1],xj=vs[j][0],yj=vs[j][1],intersect2=yi>y2!=yj>y2&&x2<(xj-xi)*(y2-yi)/(yj-yi)+xi;intersect2&&(inside3=!inside3)}return inside3},orient=orientation_1[3],concaveman_1=concaveman,default_1=concaveman;function concaveman(points2,concavity,lengthThreshold){concavity=Math.max(0,concavity===void 0?2:concavity),lengthThreshold=lengthThreshold||0;for(var hull=fastConvexHull(points2),tree=rbush_1(16,["[0]","[1]","[0]","[1]"]).load(points2),queue=[],i=0,last;i<hull.length;i++){var p=hull[i];tree.remove(p),last=insertNode(p,last),queue.push(last)}var segTree=rbush_1(16);for(i=0;i<queue.length;i++)segTree.insert(updateBBox(queue[i]));for(var sqConcavity=concavity*concavity,sqLenThreshold=lengthThreshold*lengthThreshold;queue.length;){var node=queue.shift(),a=node.p,b=node.next.p,sqLen=getSqDist(a,b);if(!(sqLen<sqLenThreshold)){var maxSqLen=sqLen/sqConcavity;p=findCandidate(tree,node.prev.p,a,b,node.next.next.p,maxSqLen,segTree),p&&Math.min(getSqDist(p,a),getSqDist(p,b))<=maxSqLen&&(queue.push(node),queue.push(insertNode(p,node)),tree.remove(p),segTree.remove(node),segTree.insert(updateBBox(node)),segTree.insert(updateBBox(node.next)))}}node=last;var concave2=[];do concave2.push(node.p),node=node.next;while(node!==last);return concave2.push(node.p),concave2}function findCandidate(tree,a,b,c,d,maxDist,segTree){for(var queue=new tinyqueue(null,compareDist),node=tree.data;node;){for(var i=0;i<node.children.length;i++){var child=node.children[i],dist2=node.leaf?sqSegDist(child,b,c):sqSegBoxDist(b,c,child);dist2>maxDist||queue.push({node:child,dist:dist2})}for(;queue.length&&!queue.peek().node.children;){var item=queue.pop(),p=item.node,d0=sqSegDist(p,a,b),d1=sqSegDist(p,c,d);if(item.dist<d0&&item.dist<d1&&noIntersections(b,p,segTree)&&noIntersections(c,p,segTree))return p}node=queue.pop(),node&&(node=node.node)}return null}function compareDist(a,b){return a.dist-b.dist}function sqSegBoxDist(a,b,bbox2){if(inside(a,bbox2)||inside(b,bbox2))return 0;var d1=sqSegSegDist(a[0],a[1],b[0],b[1],bbox2.minX,bbox2.minY,bbox2.maxX,bbox2.minY);if(d1===0)return 0;var d2=sqSegSegDist(a[0],a[1],b[0],b[1],bbox2.minX,bbox2.minY,bbox2.minX,bbox2.maxY);if(d2===0)return 0;var d3=sqSegSegDist(a[0],a[1],b[0],b[1],bbox2.maxX,bbox2.minY,bbox2.maxX,bbox2.maxY);if(d3===0)return 0;var d4=sqSegSegDist(a[0],a[1],b[0],b[1],bbox2.minX,bbox2.maxY,bbox2.maxX,bbox2.maxY);return d4===0?0:Math.min(d1,d2,d3,d4)}function inside(a,bbox2){return a[0]>=bbox2.minX&&a[0]<=bbox2.maxX&&a[1]>=bbox2.minY&&a[1]<=bbox2.maxY}function noIntersections(a,b,segTree){for(var minX2=Math.min(a[0],b[0]),minY2=Math.min(a[1],b[1]),maxX2=Math.max(a[0],b[0]),maxY2=Math.max(a[1],b[1]),edges2=segTree.search({minX:minX2,minY:minY2,maxX:maxX2,maxY:maxY2}),i=0;i<edges2.length;i++)if(intersects(edges2[i].p,edges2[i].next.p,a,b))return!1;return!0}function intersects(p1,q1,p2,q2){return p1!==q2&&q1!==p2&&orient(p1,q1,p2)>0!=orient(p1,q1,q2)>0&&orient(p2,q2,p1)>0!=orient(p2,q2,q1)>0}function updateBBox(node){var p1=node.p,p2=node.next.p;return node.minX=Math.min(p1[0],p2[0]),node.minY=Math.min(p1[1],p2[1]),node.maxX=Math.max(p1[0],p2[0]),node.maxY=Math.max(p1[1],p2[1]),node}function fastConvexHull(points2){for(var left=points2[0],top=points2[0],right=points2[0],bottom=points2[0],i=0;i<points2.length;i++){var p=points2[i];p[0]<left[0]&&(left=p),p[0]>right[0]&&(right=p),p[1]<top[1]&&(top=p),p[1]>bottom[1]&&(bottom=p)}var cull=[left,top,right,bottom],filtered=cull.slice();for(i=0;i<points2.length;i++)pointInPolygon(points2[i],cull)||filtered.push(points2[i]);var indices=monotoneConvexHull2d(filtered),hull=[];for(i=0;i<indices.length;i++)hull.push(filtered[indices[i]]);return hull}function insertNode(p,prev){var node={p,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return prev?(node.next=prev.next,node.prev=prev,prev.next.prev=node,prev.next=node):(node.prev=node,node.next=node),node}function getSqDist(p1,p2){var dx=p1[0]-p2[0],dy=p1[1]-p2[1];return dx*dx+dy*dy}function sqSegDist(p,p1,p2){var x2=p1[0],y2=p1[1],dx=p2[0]-x2,dy=p2[1]-y2;if(dx!==0||dy!==0){var t=((p[0]-x2)*dx+(p[1]-y2)*dy)/(dx*dx+dy*dy);t>1?(x2=p2[0],y2=p2[1]):t>0&&(x2+=dx*t,y2+=dy*t)}return dx=p[0]-x2,dy=p[1]-y2,dx*dx+dy*dy}function sqSegSegDist(x0,y0,x12,y12,x2,y2,x3,y3){var ux=x12-x0,uy=y12-y0,vx=x3-x2,vy=y3-y2,wx=x0-x2,wy=y0-y2,a=ux*ux+uy*uy,b=ux*vx+uy*vy,c=vx*vx+vy*vy,d=ux*wx+uy*wy,e=vx*wx+vy*wy,D=a*c-b*b,sc,sN,tc,tN,sD=D,tD=D;D===0?(sN=0,sD=1,tN=e,tD=c):(sN=b*e-c*d,tN=a*e-b*d,sN<0?(sN=0,tN=e,tD=c):sN>sD&&(sN=sD,tN=e+b,tD=c)),tN<0?(tN=0,-d<0?sN=0:-d>a?sN=sD:(sN=-d,sD=a)):tN>tD&&(tN=tD,-d+b<0?sN=0:-d+b>a?sN=sD:(sN=-d+b,sD=a)),sc=sN===0?0:sN/sD,tc=tN===0?0:tN/tD;var cx=(1-sc)*x0+sc*x12,cy=(1-sc)*y0+sc*y12,cx2=(1-tc)*x2+tc*x3,cy2=(1-tc)*y2+tc*y3,dx=cx2-cx,dy=cy2-cy;return dx*dx+dy*dy}concaveman_1.default=default_1;function convex(geojson,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var concavity=options.concavity||1/0,points$$1=[];if(coordEach(geojson,function(coord){points$$1.push([coord[0],coord[1]])}),!points$$1.length)return null;var convexHull=concaveman_1(points$$1,concavity);return convexHull.length>3?polygon([convexHull]):null}function booleanPointInPolygon(point4,polygon4,options){if(options=options||{},typeof options!="object")throw new Error("options is invalid");var ignoreBoundary=options.ignoreBoundary;if(!point4)throw new Error("point is required");if(!polygon4)throw new Error("polygon is required");var pt=getCoord(point4),polys=getCoords(polygon4),type=polygon4.geometry?polygon4.geometry.type:polygon4.type,bbox2=polygon4.bbox;if(bbox2&&inBBox(pt,bbox2)===!1)return!1;type==="Polygon"&&(polys=[polys]);for(var i=0,insidePoly=!1;i<polys.length&&!insidePoly;i++)if(inRing(pt,polys[i][0],ignoreBoundary)){for(var inHole=!1,k=1;k<polys[i].length&&!inHole;)inRing(pt,polys[i][k],!ignoreBoundary)&&(inHole=!0),k++;inHole||(insidePoly=!0)}return insidePoly}function inRing(pt,ring,ignoreBoundary){var isInside2=!1;ring[0][0]===ring[ring.length-1][0]&&ring[0][1]===ring[ring.length-1][1]&&(ring=ring.slice(0,ring.length-1));for(var i=0,j=ring.length-1;i<ring.length;j=i++){var xi=ring[i][0],yi=ring[i][1],xj=ring[j][0],yj=ring[j][1],onBoundary=pt[1]*(xi-xj)+yi*(xj-pt[0])+yj*(pt[0]-xi)===0&&(xi-pt[0])*(xj-pt[0])<=0&&(yi-pt[1])*(yj-pt[1])<=0;if(onBoundary)return!ignoreBoundary;var intersect2=yi>pt[1]!=yj>pt[1]&&pt[0]<(xj-xi)*(pt[1]-yi)/(yj-yi)+xi;intersect2&&(isInside2=!isInside2)}return isInside2}function inBBox(pt,bbox2){return bbox2[0]<=pt[0]&&bbox2[1]<=pt[1]&&bbox2[2]>=pt[0]&&bbox2[3]>=pt[1]}function pointsWithinPolygon(points$$1,polygons$$1){var results=[];return geomEach(polygons$$1,function(polygon$$1){featureEach(points$$1,function(point$$1){booleanPointInPolygon(point$$1,polygon$$1)&&results.push(point$$1)})}),featureCollection(results)}function tin(points$$1,z){if(points$$1.type!=="FeatureCollection")throw new Error("points must be a FeatureCollection");var isPointZ=!1;return featureCollection(triangulate(points$$1.features.map(function(p){var point$$1={x:p.geometry.coordinates[0],y:p.geometry.coordinates[1]};return z?point$$1.z=p.properties[z]:p.geometry.coordinates.length===3&&(isPointZ=!0,point$$1.z=p.geometry.coordinates[2]),point$$1})).map(function(triangle){var a=[triangle.a.x,triangle.a.y],b=[triangle.b.x,triangle.b.y],c=[triangle.c.x,triangle.c.y],properties={};return isPointZ?(a.push(triangle.a.z),b.push(triangle.b.z),c.push(triangle.c.z)):properties={a:triangle.a.z,b:triangle.b.z,c:triangle.c.z},polygon([[a,b,c,a]],properties)}))}function Triangle(a,b,c){this.a=a,this.b=b,this.c=c;var A=b.x-a.x,B=b.y-a.y,C=c.x-a.x,D=c.y-a.y,E=A*(a.x+b.x)+B*(a.y+b.y),F=C*(a.x+c.x)+D*(a.y+c.y),G=2*(A*(c.y-b.y)-B*(c.x-b.x)),dx,dy;this.x=(D*E-B*F)/G,this.y=(A*F-C*E)/G,dx=this.x-a.x,dy=this.y-a.y,this.r=dx*dx+dy*dy}function byX(a,b){return b.x-a.x}function dedup(edges2){var j=edges2.length,a,b,i,m,n;outer:for(;j;)for(b=edges2[--j],a=edges2[--j],i=j;i;)if(n=edges2[--i],m=edges2[--i],a===m&&b===n||a===n&&b===m){edges2.splice(j,2),edges2.splice(i,2),j-=2;continue outer}}function triangulate(vertices){if(vertices.length<3)return[];vertices.sort(byX);for(var i=vertices.length-1,xmin=vertices[i].x,xmax=vertices[0].x,ymin=vertices[i].y,ymax=ymin,epsilon3=1e-12,a,b,c,A,B,G;i--;)vertices[i].y<ymin&&(ymin=vertices[i].y),vertices[i].y>ymax&&(ymax=vertices[i].y);var dx=xmax-xmin,dy=ymax-ymin,dmax=dx>dy?dx:dy,xmid=(xmax+xmin)*.5,ymid=(ymax+ymin)*.5,open=[new Triangle({x:xmid-20*dmax,y:ymid-dmax,__sentinel:!0},{x:xmid,y:ymid+20*dmax,__sentinel:!0},{x:xmid+20*dmax,y:ymid-dmax,__sentinel:!0})],closed=[],edges2=[],j;for(i=vertices.length;i--;){for(edges2.length=0,j=open.length;j--;){if(dx=vertices[i].x-open[j].x,dx>0&&dx*dx>open[j].r){closed.push(open[j]),open.splice(j,1);continue}dy=vertices[i].y-open[j].y,!(dx*dx+dy*dy>open[j].r)&&(edges2.push(open[j].a,open[j].b,open[j].b,open[j].c,open[j].c,open[j].a),open.splice(j,1))}for(dedup(edges2),j=edges2.length;j;)b=edges2[--j],a=edges2[--j],c=vertices[i],A=b.x-a.x,B=b.y-a.y,G=2*(A*(c.y-b.y)-B*(c.x-b.x)),Math.abs(G)>epsilon3&&open.push(new Triangle(a,b,c))}for(Array.prototype.push.apply(closed,open),i=closed.length;i--;)(closed[i].a.__sentinel||closed[i].b.__sentinel||closed[i].c.__sentinel)&&closed.splice(i,1);return closed}function distance2(from,to,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var units=options.units,coordinates1=getCoord(from),coordinates2=getCoord(to),dLat=degreesToRadians(coordinates2[1]-coordinates1[1]),dLon=degreesToRadians(coordinates2[0]-coordinates1[0]),lat1=degreesToRadians(coordinates1[1]),lat2=degreesToRadians(coordinates2[1]),a=Math.pow(Math.sin(dLat/2),2)+Math.pow(Math.sin(dLon/2),2)*Math.cos(lat1)*Math.cos(lat2);return radiansToLength(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),units)}function clone2(geojson){if(!geojson)throw new Error("geojson is required");switch(geojson.type){case"Feature":return cloneFeature(geojson);case"FeatureCollection":return cloneFeatureCollection(geojson);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return cloneGeometry(geojson);default:throw new Error("unknown GeoJSON type")}}function cloneFeature(geojson){var cloned={type:"Feature"};return Object.keys(geojson).forEach(function(key){switch(key){case"type":case"properties":case"geometry":return;default:cloned[key]=geojson[key]}}),cloned.properties=cloneProperties(geojson.properties),cloned.geometry=cloneGeometry(geojson.geometry),cloned}function cloneProperties(properties){var cloned={};return properties&&Object.keys(properties).forEach(function(key){var value=properties[key];typeof value=="object"?value===null?cloned[key]=null:value.length?cloned[key]=value.map(function(item){return item}):cloned[key]=cloneProperties(value):cloned[key]=value}),cloned}function cloneFeatureCollection(geojson){var cloned={type:"FeatureCollection"};return Object.keys(geojson).forEach(function(key){switch(key){case"type":case"features":return;default:cloned[key]=geojson[key]}}),cloned.features=geojson.features.map(function(feature2){return cloneFeature(feature2)}),cloned}function cloneGeometry(geometry2){var geom={type:geometry2.type};return geometry2.bbox&&(geom.bbox=geometry2.bbox),geometry2.type==="GeometryCollection"?(geom.geometries=geometry2.geometries.map(function(geom2){return cloneGeometry(geom2)}),geom):(geom.coordinates=deepSlice(geometry2.coordinates),geom)}function deepSlice(coords){return typeof coords[0]!="object"?coords.slice():coords.map(function(coord){return deepSlice(coord)})}var identity2=function(x2){return x2},transform=function(transform3){if(transform3==null)return identity2;var x0,y0,kx=transform3.scale[0],ky=transform3.scale[1],dx=transform3.translate[0],dy=transform3.translate[1];return function(input,i){i||(x0=y0=0);var j=2,n=input.length,output=new Array(n);for(output[0]=(x0+=input[0])*kx+dx,output[1]=(y0+=input[1])*ky+dy;j<n;)output[j]=input[j],++j;return output}},reverse=function(array,n){for(var t,j=array.length,i=j-n;i<--j;)t=array[i],array[i++]=array[j],array[j]=t};function object(topology2,o){var transformPoint2=transform(topology2.transform),arcs=topology2.arcs;function arc(i,points2){points2.length&&points2.pop();for(var a=arcs[i<0?~i:i],k=0,n=a.length;k<n;++k)points2.push(transformPoint2(a[k],k));i<0&&reverse(points2,n)}function point4(p){return transformPoint2(p)}function line(arcs2){for(var points2=[],i=0,n=arcs2.length;i<n;++i)arc(arcs2[i],points2);return points2.length<2&&points2.push(points2[0]),points2}function ring(arcs2){for(var points2=line(arcs2);points2.length<4;)points2.push(points2[0]);return points2}function polygon4(arcs2){return arcs2.map(ring)}function geometry2(o2){var type=o2.type,coordinates;switch(type){case"GeometryCollection":return{type,geometries:o2.geometries.map(geometry2)};case"Point":coordinates=point4(o2.coordinates);break;case"MultiPoint":coordinates=o2.coordinates.map(point4);break;case"LineString":coordinates=line(o2.arcs);break;case"MultiLineString":coordinates=o2.arcs.map(line);break;case"Polygon":coordinates=polygon4(o2.arcs);break;case"MultiPolygon":coordinates=o2.arcs.map(polygon4);break;default:return null}return{type,coordinates}}return geometry2(o)}var stitch=function(topology2,arcs){var stitchedArcs={},fragmentByStart={},fragmentByEnd={},fragments=[],emptyIndex=-1;arcs.forEach(function(i,j){var arc=topology2.arcs[i<0?~i:i],t;arc.length<3&&!arc[1][0]&&!arc[1][1]&&(t=arcs[++emptyIndex],arcs[emptyIndex]=i,arcs[j]=t)}),arcs.forEach(function(i){var e=ends(i),start2=e[0],end=e[1],f,g;if(f=fragmentByEnd[start2])if(delete fragmentByEnd[f.end],f.push(i),f.end=end,g=fragmentByStart[end]){delete fragmentByStart[g.start];var fg=g===f?f:f.concat(g);fragmentByStart[fg.start=f.start]=fragmentByEnd[fg.end=g.end]=fg}else fragmentByStart[f.start]=fragmentByEnd[f.end]=f;else if(f=fragmentByStart[end])if(delete fragmentByStart[f.start],f.unshift(i),f.start=start2,g=fragmentByEnd[start2]){delete fragmentByEnd[g.end];var gf=g===f?f:g.concat(f);fragmentByStart[gf.start=g.start]=fragmentByEnd[gf.end=f.end]=gf}else fragmentByStart[f.start]=fragmentByEnd[f.end]=f;else f=[i],fragmentByStart[f.start=start2]=fragmentByEnd[f.end=end]=f});function ends(i){var arc=topology2.arcs[i<0?~i:i],p0=arc[0],p1;return topology2.transform?(p1=[0,0],arc.forEach(function(dp){p1[0]+=dp[0],p1[1]+=dp[1]})):p1=arc[arc.length-1],i<0?[p1,p0]:[p0,p1]}function flush(fragmentByEnd2,fragmentByStart2){for(var k in fragmentByEnd2){var f=fragmentByEnd2[k];delete fragmentByStart2[f.start],delete f.start,delete f.end,f.forEach(function(i){stitchedArcs[i<0?~i:i]=1}),fragments.push(f)}}return flush(fragmentByEnd,fragmentByStart),flush(fragmentByStart,fragmentByEnd),arcs.forEach(function(i){stitchedArcs[i<0?~i:i]||fragments.push([i])}),fragments};function planarRingArea(ring){for(var i=-1,n=ring.length,a,b=ring[n-1],area5=0;++i<n;)a=b,b=ring[i],area5+=a[0]*b[1]-a[1]*b[0];return Math.abs(area5)}var merge=function(topology2){return object(topology2,mergeArcs.apply(this,arguments))};function mergeArcs(topology2,objects){var polygonsByArc={},polygons2=[],groups=[];objects.forEach(geometry2);function geometry2(o){switch(o.type){case"GeometryCollection":o.geometries.forEach(geometry2);break;case"Polygon":extract3(o.arcs);break;case"MultiPolygon":o.arcs.forEach(extract3);break}}function extract3(polygon4){polygon4.forEach(function(ring){ring.forEach(function(arc){(polygonsByArc[arc=arc<0?~arc:arc]||(polygonsByArc[arc]=[])).push(polygon4)})}),polygons2.push(polygon4)}function area5(ring){return planarRingArea(object(topology2,{type:"Polygon",arcs:[ring]}).coordinates[0])}return polygons2.forEach(function(polygon4){if(!polygon4._){var group=[],neighbors=[polygon4];for(polygon4._=1,groups.push(group);polygon4=neighbors.pop();)group.push(polygon4),polygon4.forEach(function(ring){ring.forEach(function(arc){polygonsByArc[arc<0?~arc:arc].forEach(function(polygon5){polygon5._||(polygon5._=1,neighbors.push(polygon5))})})})}}),polygons2.forEach(function(polygon4){delete polygon4._}),{type:"MultiPolygon",arcs:groups.map(function(polygons3){var arcs=[],n;if(polygons3.forEach(function(polygon4){polygon4.forEach(function(ring){ring.forEach(function(arc){polygonsByArc[arc<0?~arc:arc].length<2&&arcs.push(arc)})})}),arcs=stitch(topology2,arcs),(n=arcs.length)>1)for(var i=1,k=area5(arcs[0]),ki,t;i<n;++i)(ki=area5(arcs[i]))>k&&(t=arcs[0],arcs[0]=arcs[i],arcs[i]=t,k=ki);return arcs})}}var bounds=function(objects){var x0=1/0,y0=1/0,x12=-1/0,y12=-1/0;function boundGeometry(geometry2){geometry2!=null&&boundGeometryType.hasOwnProperty(geometry2.type)&&boundGeometryType[geometry2.type](geometry2)}var boundGeometryType={GeometryCollection:function(o){o.geometries.forEach(boundGeometry)},Point:function(o){boundPoint(o.coordinates)},MultiPoint:function(o){o.coordinates.forEach(boundPoint)},LineString:function(o){boundLine(o.arcs)},MultiLineString:function(o){o.arcs.forEach(boundLine)},Polygon:function(o){o.arcs.forEach(boundLine)},MultiPolygon:function(o){o.arcs.forEach(boundMultiLine)}};function boundPoint(coordinates){var x2=coordinates[0],y2=coordinates[1];x2<x0&&(x0=x2),x2>x12&&(x12=x2),y2<y0&&(y0=y2),y2>y12&&(y12=y2)}function boundLine(coordinates){coordinates.forEach(boundPoint)}function boundMultiLine(coordinates){coordinates.forEach(boundLine)}for(var key in objects)boundGeometry(objects[key]);return x12>=x0&&y12>=y0?[x0,y0,x12,y12]:void 0},hashset=function(size11,hash,equal2,type,empty){arguments.length===3&&(type=Array,empty=null);for(var store=new type(size11=1<<Math.max(4,Math.ceil(Math.log(size11)/Math.LN2))),mask2=size11-1,i=0;i<size11;++i)store[i]=empty;function add16(value){for(var index=hash(value)&mask2,match=store[index],collisions=0;match!=empty;){if(equal2(match,value))return!0;if(++collisions>=size11)throw new Error("full hashset");match=store[index=index+1&mask2]}return store[index]=value,!0}function has(value){for(var index=hash(value)&mask2,match=store[index],collisions=0;match!=empty;){if(equal2(match,value))return!0;if(++collisions>=size11)break;match=store[index=index+1&mask2]}return!1}function values3(){for(var values4=[],i2=0,n=store.length;i2<n;++i2){var match=store[i2];match!=empty&&values4.push(match)}return values4}return{add:add16,has,values:values3}},hashmap=function(size11,hash,equal2,keyType,keyEmpty,valueType){arguments.length===3&&(keyType=valueType=Array,keyEmpty=null);for(var keystore=new keyType(size11=1<<Math.max(4,Math.ceil(Math.log(size11)/Math.LN2))),valstore=new valueType(size11),mask2=size11-1,i=0;i<size11;++i)keystore[i]=keyEmpty;function set(key,value){for(var index=hash(key)&mask2,matchKey=keystore[index],collisions=0;matchKey!=keyEmpty;){if(equal2(matchKey,key))return valstore[index]=value;if(++collisions>=size11)throw new Error("full hashmap");matchKey=keystore[index=index+1&mask2]}return keystore[index]=key,valstore[index]=value,value}function maybeSet(key,value){for(var index=hash(key)&mask2,matchKey=keystore[index],collisions=0;matchKey!=keyEmpty;){if(equal2(matchKey,key))return valstore[index];if(++collisions>=size11)throw new Error("full hashmap");matchKey=keystore[index=index+1&mask2]}return keystore[index]=key,valstore[index]=value,value}function get5(key,missingValue){for(var index=hash(key)&mask2,matchKey=keystore[index],collisions=0;matchKey!=keyEmpty;){if(equal2(matchKey,key))return valstore[index];if(++collisions>=size11)break;matchKey=keystore[index=index+1&mask2]}return missingValue}function keys2(){for(var keys3=[],i2=0,n=keystore.length;i2<n;++i2){var matchKey=keystore[i2];matchKey!=keyEmpty&&keys3.push(matchKey)}return keys3}return{set,maybeSet,get:get5,keys:keys2}},equalPoint=function(pointA,pointB){return pointA[0]===pointB[0]&&pointA[1]===pointB[1]},buffer=new ArrayBuffer(16),floats=new Float64Array(buffer),uints=new Uint32Array(buffer),hashPoint=function(point4){floats[0]=point4[0],floats[1]=point4[1];var hash=uints[0]^uints[1];return hash=hash<<5^hash>>7^uints[2]^uints[3],hash&2147483647},join2=function(topology2){var coordinates=topology2.coordinates,lines=topology2.lines,rings=topology2.rings,indexes=index(),visitedByIndex=new Int32Array(coordinates.length),leftByIndex=new Int32Array(coordinates.length),rightByIndex=new Int32Array(coordinates.length),junctionByIndex=new Int8Array(coordinates.length),junctionCount=0,i,n,previousIndex,currentIndex,nextIndex;for(i=0,n=coordinates.length;i<n;++i)visitedByIndex[i]=leftByIndex[i]=rightByIndex[i]=-1;for(i=0,n=lines.length;i<n;++i){var line=lines[i],lineStart=line[0],lineEnd=line[1];for(currentIndex=indexes[lineStart],nextIndex=indexes[++lineStart],++junctionCount,junctionByIndex[currentIndex]=1;++lineStart<=lineEnd;)sequence(i,previousIndex=currentIndex,currentIndex=nextIndex,nextIndex=indexes[lineStart]);++junctionCount,junctionByIndex[nextIndex]=1}for(i=0,n=coordinates.length;i<n;++i)visitedByIndex[i]=-1;for(i=0,n=rings.length;i<n;++i){var ring=rings[i],ringStart=ring[0]+1,ringEnd=ring[1];for(previousIndex=indexes[ringEnd-1],currentIndex=indexes[ringStart-1],nextIndex=indexes[ringStart],sequence(i,previousIndex,currentIndex,nextIndex);++ringStart<=ringEnd;)sequence(i,previousIndex=currentIndex,currentIndex=nextIndex,nextIndex=indexes[ringStart])}function sequence(i2,previousIndex2,currentIndex2,nextIndex2){if(visitedByIndex[currentIndex2]!==i2){visitedByIndex[currentIndex2]=i2;var leftIndex=leftByIndex[currentIndex2];if(leftIndex>=0){var rightIndex=rightByIndex[currentIndex2];(leftIndex!==previousIndex2||rightIndex!==nextIndex2)&&(leftIndex!==nextIndex2||rightIndex!==previousIndex2)&&(++junctionCount,junctionByIndex[currentIndex2]=1)}else leftByIndex[currentIndex2]=previousIndex2,rightByIndex[currentIndex2]=nextIndex2}}function index(){for(var indexByPoint=hashmap(coordinates.length*1.4,hashIndex,equalIndex,Int32Array,-1,Int32Array),indexes2=new Int32Array(coordinates.length),i2=0,n2=coordinates.length;i2<n2;++i2)indexes2[i2]=indexByPoint.maybeSet(i2,i2);return indexes2}function hashIndex(i2){return hashPoint(coordinates[i2])}function equalIndex(i2,j2){return equalPoint(coordinates[i2],coordinates[j2])}visitedByIndex=leftByIndex=rightByIndex=null;var junctionByPoint=hashset(junctionCount*1.4,hashPoint,equalPoint),j;for(i=0,n=coordinates.length;i<n;++i)junctionByIndex[j=indexes[i]]&&junctionByPoint.add(coordinates[j]);return junctionByPoint},cut=function(topology2){var junctions=join2(topology2),coordinates=topology2.coordinates,lines=topology2.lines,rings=topology2.rings,next3,i,n;for(i=0,n=lines.length;i<n;++i)for(var line=lines[i],lineMid=line[0],lineEnd=line[1];++lineMid<lineEnd;)junctions.has(coordinates[lineMid])&&(next3={0:lineMid,1:line[1]},line[1]=lineMid,line=line.next=next3);for(i=0,n=rings.length;i<n;++i)for(var ring=rings[i],ringStart=ring[0],ringMid=ringStart,ringEnd=ring[1],ringFixed=junctions.has(coordinates[ringStart]);++ringMid<ringEnd;)junctions.has(coordinates[ringMid])&&(ringFixed?(next3={0:ringMid,1:ring[1]},ring[1]=ringMid,ring=ring.next=next3):(rotateArray(coordinates,ringStart,ringEnd,ringEnd-ringMid),coordinates[ringEnd]=coordinates[ringStart],ringFixed=!0,ringMid=ringStart));return topology2};function rotateArray(array,start2,end,offset){reverse$1(array,start2,end),reverse$1(array,start2,start2+offset),reverse$1(array,start2+offset,end)}function reverse$1(array,start2,end){for(var mid=start2+(end---start2>>1),t;start2<mid;++start2,--end)t=array[start2],array[start2]=array[end],array[end]=t}var dedup$1=function(topology2){var coordinates=topology2.coordinates,lines=topology2.lines,line,rings=topology2.rings,ring,arcCount=lines.length+rings.length,i,n;for(delete topology2.lines,delete topology2.rings,i=0,n=lines.length;i<n;++i)for(line=lines[i];line=line.next;)++arcCount;for(i=0,n=rings.length;i<n;++i)for(ring=rings[i];ring=ring.next;)++arcCount;var arcsByEnd=hashmap(arcCount*2*1.4,hashPoint,equalPoint),arcs=topology2.arcs=[];for(i=0,n=lines.length;i<n;++i){line=lines[i];do dedupLine(line);while(line=line.next)}for(i=0,n=rings.length;i<n;++i)if(ring=rings[i],ring.next)do dedupLine(ring);while(ring=ring.next);else dedupRing(ring);function dedupLine(arc){var startPoint,endPoint,startArcs,startArc,endArcs,endArc,i2,n2;if(startArcs=arcsByEnd.get(startPoint=coordinates[arc[0]])){for(i2=0,n2=startArcs.length;i2<n2;++i2)if(startArc=startArcs[i2],equalLine(startArc,arc)){arc[0]=startArc[0],arc[1]=startArc[1];return}}if(endArcs=arcsByEnd.get(endPoint=coordinates[arc[1]])){for(i2=0,n2=endArcs.length;i2<n2;++i2)if(endArc=endArcs[i2],reverseEqualLine(endArc,arc)){arc[1]=endArc[0],arc[0]=endArc[1];return}}startArcs?startArcs.push(arc):arcsByEnd.set(startPoint,[arc]),endArcs?endArcs.push(arc):arcsByEnd.set(endPoint,[arc]),arcs.push(arc)}function dedupRing(arc){var endPoint,endArcs,endArc,i2,n2;if(endArcs=arcsByEnd.get(endPoint=coordinates[arc[0]]))for(i2=0,n2=endArcs.length;i2<n2;++i2){if(endArc=endArcs[i2],equalRing(endArc,arc)){arc[0]=endArc[0],arc[1]=endArc[1];return}if(reverseEqualRing(endArc,arc)){arc[0]=endArc[1],arc[1]=endArc[0];return}}if(endArcs=arcsByEnd.get(endPoint=coordinates[arc[0]+findMinimumOffset(arc)]))for(i2=0,n2=endArcs.length;i2<n2;++i2){if(endArc=endArcs[i2],equalRing(endArc,arc)){arc[0]=endArc[0],arc[1]=endArc[1];return}if(reverseEqualRing(endArc,arc)){arc[0]=endArc[1],arc[1]=endArc[0];return}}endArcs?endArcs.push(arc):arcsByEnd.set(endPoint,[arc]),arcs.push(arc)}function equalLine(arcA,arcB){var ia=arcA[0],ib=arcB[0],ja=arcA[1],jb=arcB[1];if(ia-ja!==ib-jb)return!1;for(;ia<=ja;++ia,++ib)if(!equalPoint(coordinates[ia],coordinates[ib]))return!1;return!0}function reverseEqualLine(arcA,arcB){var ia=arcA[0],ib=arcB[0],ja=arcA[1],jb=arcB[1];if(ia-ja!==ib-jb)return!1;for(;ia<=ja;++ia,--jb)if(!equalPoint(coordinates[ia],coordinates[jb]))return!1;return!0}function equalRing(arcA,arcB){var ia=arcA[0],ib=arcB[0],ja=arcA[1],jb=arcB[1],n2=ja-ia;if(n2!==jb-ib)return!1;for(var ka=findMinimumOffset(arcA),kb=findMinimumOffset(arcB),i2=0;i2<n2;++i2)if(!equalPoint(coordinates[ia+(i2+ka)%n2],coordinates[ib+(i2+kb)%n2]))return!1;return!0}function reverseEqualRing(arcA,arcB){var ia=arcA[0],ib=arcB[0],ja=arcA[1],jb=arcB[1],n2=ja-ia;if(n2!==jb-ib)return!1;for(var ka=findMinimumOffset(arcA),kb=n2-findMinimumOffset(arcB),i2=0;i2<n2;++i2)if(!equalPoint(coordinates[ia+(i2+ka)%n2],coordinates[jb-(i2+kb)%n2]))return!1;return!0}function findMinimumOffset(arc){for(var start2=arc[0],end=arc[1],mid=start2,minimum=mid,minimumPoint=coordinates[mid];++mid<end;){var point4=coordinates[mid];(point4[0]<minimumPoint[0]||point4[0]===minimumPoint[0]&&point4[1]<minimumPoint[1])&&(minimum=mid,minimumPoint=point4)}return minimum-start2}return topology2},delta=function(arcs){for(var i=-1,n=arcs.length;++i<n;){for(var arc=arcs[i],j=0,k=1,m=arc.length,point4=arc[0],x0=point4[0],y0=point4[1],x12,y12;++j<m;)point4=arc[j],x12=point4[0],y12=point4[1],(x12!==x0||y12!==y0)&&(arc[k++]=[x12-x0,y12-y0],x0=x12,y0=y12);k===1&&(arc[k++]=[0,0]),arc.length=k}return arcs},extract=function(objects){var index=-1,lines=[],rings=[],coordinates=[];function extractGeometry2(geometry2){geometry2&&extractGeometryType.hasOwnProperty(geometry2.type)&&extractGeometryType[geometry2.type](geometry2)}var extractGeometryType={GeometryCollection:function(o){o.geometries.forEach(extractGeometry2)},LineString:function(o){o.arcs=extractLine(o.arcs)},MultiLineString:function(o){o.arcs=o.arcs.map(extractLine)},Polygon:function(o){o.arcs=o.arcs.map(extractRing)},MultiPolygon:function(o){o.arcs=o.arcs.map(extractMultiRing)}};function extractLine(line){for(var i=0,n=line.length;i<n;++i)coordinates[++index]=line[i];var arc={0:index-n+1,1:index};return lines.push(arc),arc}function extractRing(ring){for(var i=0,n=ring.length;i<n;++i)coordinates[++index]=ring[i];var arc={0:index-n+1,1:index};return rings.push(arc),arc}function extractMultiRing(rings2){return rings2.map(extractRing)}for(var key in objects)extractGeometry2(objects[key]);return{type:"Topology",coordinates,lines,rings,objects}},geometry$1=function(inputs){var outputs={},key;for(key in inputs)outputs[key]=geomifyObject(inputs[key]);return outputs};function geomifyObject(input){return input==null?{type:null}:(input.type==="FeatureCollection"?geomifyFeatureCollection:input.type==="Feature"?geomifyFeature:geomifyGeometry)(input)}function geomifyFeatureCollection(input){var output={type:"GeometryCollection",geometries:input.features.map(geomifyFeature)};return input.bbox!=null&&(output.bbox=input.bbox),output}function geomifyFeature(input){var output=geomifyGeometry(input.geometry),key;input.id!=null&&(output.id=input.id),input.bbox!=null&&(output.bbox=input.bbox);for(key in input.properties){output.properties=input.properties;break}return output}function geomifyGeometry(input){if(input==null)return{type:null};var output=input.type==="GeometryCollection"?{type:"GeometryCollection",geometries:input.geometries.map(geomifyGeometry)}:input.type==="Point"||input.type==="MultiPoint"?{type:input.type,coordinates:input.coordinates}:{type:input.type,arcs:input.coordinates};return input.bbox!=null&&(output.bbox=input.bbox),output}var prequantize=function(objects,bbox2,n){var x0=bbox2[0],y0=bbox2[1],x12=bbox2[2],y12=bbox2[3],kx=x12-x0?(n-1)/(x12-x0):1,ky=y12-y0?(n-1)/(y12-y0):1;function quantizePoint(input){return[Math.round((input[0]-x0)*kx),Math.round((input[1]-y0)*ky)]}function quantizePoints(input,m){for(var i=-1,j=0,n2=input.length,output=new Array(n2),pi2,px,py,x2,y2;++i<n2;)pi2=input[i],x2=Math.round((pi2[0]-x0)*kx),y2=Math.round((pi2[1]-y0)*ky),(x2!==px||y2!==py)&&(output[j++]=[px=x2,py=y2]);for(output.length=j;j<m;)j=output.push([output[0][0],output[0][1]]);return output}function quantizeLine(input){return quantizePoints(input,2)}function quantizeRing(input){return quantizePoints(input,4)}function quantizePolygon(input){return input.map(quantizeRing)}function quantizeGeometry(o){o!=null&&quantizeGeometryType.hasOwnProperty(o.type)&&quantizeGeometryType[o.type](o)}var quantizeGeometryType={GeometryCollection:function(o){o.geometries.forEach(quantizeGeometry)},Point:function(o){o.coordinates=quantizePoint(o.coordinates)},MultiPoint:function(o){o.coordinates=o.coordinates.map(quantizePoint)},LineString:function(o){o.arcs=quantizeLine(o.arcs)},MultiLineString:function(o){o.arcs=o.arcs.map(quantizeLine)},Polygon:function(o){o.arcs=quantizePolygon(o.arcs)},MultiPolygon:function(o){o.arcs=o.arcs.map(quantizePolygon)}};for(var key in objects)quantizeGeometry(objects[key]);return{scale:[1/kx,1/ky],translate:[x0,y0]}},topology=function(objects,quantization){var bbox2=bounds(objects=geometry$1(objects)),transform3=quantization>0&&bbox2&&prequantize(objects,bbox2,quantization),topology2=dedup$1(cut(extract(objects))),coordinates=topology2.coordinates,indexByArc=hashmap(topology2.arcs.length*1.4,hashArc,equalArc);objects=topology2.objects,topology2.bbox=bbox2,topology2.arcs=topology2.arcs.map(function(arc,i){return indexByArc.set(arc,i),coordinates.slice(arc[0],arc[1]+1)}),delete topology2.coordinates,coordinates=null;function indexGeometry(geometry2){geometry2&&indexGeometryType.hasOwnProperty(geometry2.type)&&indexGeometryType[geometry2.type](geometry2)}var indexGeometryType={GeometryCollection:function(o){o.geometries.forEach(indexGeometry)},LineString:function(o){o.arcs=indexArcs(o.arcs)},MultiLineString:function(o){o.arcs=o.arcs.map(indexArcs)},Polygon:function(o){o.arcs=o.arcs.map(indexArcs)},MultiPolygon:function(o){o.arcs=o.arcs.map(indexMultiArcs)}};function indexArcs(arc){var indexes=[];do{var index=indexByArc.get(arc);indexes.push(arc[0]<arc[1]?index:~index)}while(arc=arc.next);return indexes}function indexMultiArcs(arcs){return arcs.map(indexArcs)}for(var key in objects)indexGeometry(objects[key]);return transform3&&(topology2.transform=transform3,topology2.arcs=delta(topology2.arcs)),topology2};function hashArc(arc){var i=arc[0],j=arc[1],t;return j<i&&(t=i,i=j,j=t),i+31*j}function equalArc(arcA,arcB){var ia=arcA[0],ja=arcA[1],ib=arcB[0],jb=arcB[1],t;return ja<ia&&(t=ia,ia=ja,ja=t),jb<ib&&(t=ib,ib=jb,jb=t),ia===ib&&ja===jb}function lineDissolve(geojson,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var mutate=options.mutate;if(getType(geojson)!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(!geojson.features.length)throw new Error("geojson is empty");(mutate===!1||mutate===void 0)&&(geojson=clone2(geojson));var result=[],lastLine=lineReduce(geojson,function(previousLine,currentLine){var merged=mergeLineStrings(previousLine,currentLine);return merged||(result.push(previousLine),currentLine)});return lastLine&&result.push(lastLine),result.length?result.length===1?result[0]:multiLineString(result.map(function(line){return line.coordinates})):null}function coordId(coord){return coord[0].toString()+","+coord[1].toString()}function mergeLineStrings(a,b){var coords1=a.geometry.coordinates,coords2=b.geometry.coordinates,s1=coordId(coords1[0]),e1=coordId(coords1[coords1.length-1]),s2=coordId(coords2[0]),e2=coordId(coords2[coords2.length-1]),coords;if(s1===e2)coords=coords2.concat(coords1.slice(1));else if(s2===e1)coords=coords1.concat(coords2.slice(1));else if(s1===s2)coords=coords1.slice(1).reverse().concat(coords2);else if(e1===e2)coords=coords1.concat(coords2.reverse().slice(1));else return null;return lineString(coords)}function polygonDissolve(geojson,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var mutate=options.mutate;if(getType(geojson)!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(!geojson.features.length)throw new Error("geojson is empty");(mutate===!1||mutate===void 0)&&(geojson=clone2(geojson));var geoms=[];flattenEach(geojson,function(feature$$1){geoms.push(feature$$1.geometry)});var topo=topology({geoms:geometryCollection(geoms).geometry});return merge(topo,topo.objects.geoms.geometries)}function dissolve(geojson,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var mutate=options.mutate;if(getType(geojson)!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(!geojson.features.length)throw new Error("geojson is empty");(mutate===!1||mutate===void 0)&&(geojson=clone2(geojson));var type=getHomogenousType(geojson);if(!type)throw new Error("geojson must be homogenous");switch(type){case"LineString":return lineDissolve(geojson,options);case"Polygon":return polygonDissolve(geojson,options);default:throw new Error(type+" is not supported")}}function getHomogenousType(geojson){var types={};flattenEach(geojson,function(feature$$1){types[feature$$1.geometry.type]=!0});var keys2=Object.keys(types);return keys2.length===1?keys2[0]:null}function concave(points$$1,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");if(!points$$1)throw new Error("points is required");var maxEdge=options.maxEdge||1/0;if(!isNumber(maxEdge))throw new Error("maxEdge is invalid");var cleaned=removeDuplicates(points$$1),tinPolys=tin(cleaned);if(tinPolys.features=tinPolys.features.filter(function(triangle){var pt1=triangle.geometry.coordinates[0][0],pt2=triangle.geometry.coordinates[0][1],pt3=triangle.geometry.coordinates[0][2],dist1=distance2(pt1,pt2,options),dist2=distance2(pt2,pt3,options),dist3=distance2(pt1,pt3,options);return dist1<=maxEdge&&dist2<=maxEdge&&dist3<=maxEdge}),tinPolys.features.length<1)return null;var dissolved=dissolve(tinPolys,options);return dissolved.coordinates.length===1&&(dissolved.coordinates=dissolved.coordinates[0],dissolved.type="Polygon"),feature(dissolved)}function removeDuplicates(points$$1){var cleaned=[],existing={};return featureEach(points$$1,function(pt){if(!!pt.geometry){var key=pt.geometry.coordinates.join("-");existing.hasOwnProperty(key)||(cleaned.push(pt),existing[key]=!0)}}),featureCollection(cleaned)}function collect(polygons2,points2,inProperty,outProperty){var rtree=rbush_1(6),treeItems=points2.features.map(function(item){return{minX:item.geometry.coordinates[0],minY:item.geometry.coordinates[1],maxX:item.geometry.coordinates[0],maxY:item.geometry.coordinates[1],property:item.properties[inProperty]}});return rtree.load(treeItems),polygons2.features.forEach(function(poly){poly.properties||(poly.properties={});var bbox$$1=bbox(poly),potentialPoints=rtree.search({minX:bbox$$1[0],minY:bbox$$1[1],maxX:bbox$$1[2],maxY:bbox$$1[3]}),values3=[];potentialPoints.forEach(function(pt){booleanPointInPolygon([pt.minX,pt.minY],poly)&&values3.push(pt.property)}),poly.properties[outProperty]=values3}),polygons2}function flip(geojson,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var mutate=options.mutate;if(!geojson)throw new Error("geojson is required");return(mutate===!1||mutate===void 0)&&(geojson=clone2(geojson)),coordEach(geojson,function(coord){var x2=coord[0],y2=coord[1];coord[0]=y2,coord[1]=x2}),geojson}function cleanCoords(geojson,options){var mutate=typeof options=="object"?options.mutate:options;if(!geojson)throw new Error("geojson is required");var type=getType(geojson),newCoords=[];switch(type){case"LineString":newCoords=cleanLine(geojson);break;case"MultiLineString":case"Polygon":getCoords(geojson).forEach(function(line){newCoords.push(cleanLine(line))});break;case"MultiPolygon":getCoords(geojson).forEach(function(polygons$$1){var polyPoints=[];polygons$$1.forEach(function(ring){polyPoints.push(cleanLine(ring))}),newCoords.push(polyPoints)});break;case"Point":return geojson;case"MultiPoint":var existing={};getCoords(geojson).forEach(function(coord){var key=coord.join("-");existing.hasOwnProperty(key)||(newCoords.push(coord),existing[key]=!0)});break;default:throw new Error(type+" geometry not supported")}return geojson.coordinates?mutate===!0?(geojson.coordinates=newCoords,geojson):{type,coordinates:newCoords}:mutate===!0?(geojson.geometry.coordinates=newCoords,geojson):feature({type,coordinates:newCoords},geojson.properties,geojson.bbox,geojson.id)}function cleanLine(line){var points$$1=getCoords(line);if(points$$1.length===2&&!equals(points$$1[0],points$$1[1]))return points$$1;var prevPoint,point$$1,nextPoint,newPoints=[],secondToLast=points$$1.length-1;newPoints.push(points$$1[0]);for(var i=1;i<secondToLast;i++)prevPoint=points$$1[i-1],point$$1=points$$1[i],nextPoint=points$$1[i+1],isPointOnLineSegment(prevPoint,nextPoint,point$$1)||newPoints.push(point$$1);return newPoints.push(nextPoint),newPoints}function equals(pt1,pt2){return pt1[0]===pt2[0]&&pt1[1]===pt2[1]}function isPointOnLineSegment(start2,end,point$$1){var x2=point$$1[0],y2=point$$1[1],startX=start2[0],startY=start2[1],endX=end[0],endY=end[1],dxc=x2-startX,dyc=y2-startY,dxl=endX-startX,dyl=endY-startY,cross2=dxc*dyl-dyc*dxl;return cross2!==0?!1:Math.abs(dxl)>=Math.abs(dyl)?dxl>0?startX<=x2&&x2<=endX:endX<=x2&&x2<=startX:dyl>0?startY<=y2&&y2<=endY:endY<=y2&&y2<=startY}function getSqDist$1(p1,p2){var dx=p1.x-p2.x,dy=p1.y-p2.y;return dx*dx+dy*dy}function getSqSegDist(p,p1,p2){var x2=p1.x,y2=p1.y,dx=p2.x-x2,dy=p2.y-y2;if(dx!==0||dy!==0){var t=((p.x-x2)*dx+(p.y-y2)*dy)/(dx*dx+dy*dy);t>1?(x2=p2.x,y2=p2.y):t>0&&(x2+=dx*t,y2+=dy*t)}return dx=p.x-x2,dy=p.y-y2,dx*dx+dy*dy}function simplifyRadialDist(points$$1,sqTolerance){for(var prevPoint=points$$1[0],newPoints=[prevPoint],point$$1,i=1,len=points$$1.length;i<len;i++)point$$1=points$$1[i],getSqDist$1(point$$1,prevPoint)>sqTolerance&&(newPoints.push(point$$1),prevPoint=point$$1);return prevPoint!==point$$1&&newPoints.push(point$$1),newPoints}function simplifyDPStep(points$$1,first,last,sqTolerance,simplified){for(var maxSqDist=sqTolerance,index,i=first+1;i<last;i++){var sqDist=getSqSegDist(points$$1[i],points$$1[first],points$$1[last]);sqDist>maxSqDist&&(index=i,maxSqDist=sqDist)}maxSqDist>sqTolerance&&(index-first>1&&simplifyDPStep(points$$1,first,index,sqTolerance,simplified),simplified.push(points$$1[index]),last-index>1&&simplifyDPStep(points$$1,index,last,sqTolerance,simplified))}function simplifyDouglasPeucker(points$$1,sqTolerance){var last=points$$1.length-1,simplified=[points$$1[0]];return simplifyDPStep(points$$1,0,last,sqTolerance,simplified),simplified.push(points$$1[last]),simplified}function simplify$2(points$$1,tolerance,highestQuality){if(points$$1.length<=2)return points$$1;var sqTolerance=tolerance!==void 0?tolerance*tolerance:1;return points$$1=highestQuality?points$$1:simplifyRadialDist(points$$1,sqTolerance),points$$1=simplifyDouglasPeucker(points$$1,sqTolerance),points$$1}function simplify(geojson,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var tolerance=options.tolerance!==void 0?options.tolerance:1,highQuality=options.highQuality||!1,mutate=options.mutate||!1;if(!geojson)throw new Error("geojson is required");if(tolerance&&tolerance<0)throw new Error("invalid tolerance");return mutate!==!0&&(geojson=clone2(geojson)),geomEach(geojson,function(geom){simplifyGeom(geom,tolerance,highQuality)}),geojson}function simplifyGeom(geometry$$1,tolerance,highQuality){var type=geometry$$1.type;if(type==="Point"||type==="MultiPoint")return geometry$$1;cleanCoords(geometry$$1,!0);var coordinates=geometry$$1.coordinates;switch(type){case"LineString":geometry$$1.coordinates=simplifyLine(coordinates,tolerance,highQuality);break;case"MultiLineString":geometry$$1.coordinates=coordinates.map(function(lines){return simplifyLine(lines,tolerance,highQuality)});break;case"Polygon":geometry$$1.coordinates=simplifyPolygon(coordinates,tolerance,highQuality);break;case"MultiPolygon":geometry$$1.coordinates=coordinates.map(function(rings){return simplifyPolygon(rings,tolerance,highQuality)})}return geometry$$1}function simplifyLine(coordinates,tolerance,highQuality){return simplify$2(coordinates.map(function(coord){return{x:coord[0],y:coord[1],z:coord[2]}}),tolerance,highQuality).map(function(coords){return coords.z?[coords.x,coords.y,coords.z]:[coords.x,coords.y]})}function simplifyPolygon(coordinates,tolerance,highQuality){return coordinates.map(function(ring){var pts=ring.map(function(coord){return{x:coord[0],y:coord[1]}});if(pts.length<4)throw new Error("invalid polygon");for(var simpleRing=simplify$2(pts,tolerance,highQuality).map(function(coords){return[coords.x,coords.y]});!checkValidity(simpleRing);)tolerance-=tolerance*.01,simpleRing=simplify$2(pts,tolerance,highQuality).map(function(coords){return[coords.x,coords.y]});return(simpleRing[simpleRing.length-1][0]!==simpleRing[0][0]||simpleRing[simpleRing.length-1][1]!==simpleRing[0][1])&&simpleRing.push(simpleRing[0]),simpleRing})}function checkValidity(ring){return ring.length<3?!1:!(ring.length===3&&ring[2][0]===ring[0][0]&&ring[2][1]===ring[0][1])}var Spline=function(options){this.points=options.points||[],this.duration=options.duration||1e4,this.sharpness=options.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=options.stepLength||60,this.length=this.points.length,this.delay=0;for(var i=0;i<this.length;i++)this.points[i].z=this.points[i].z||0;for(var i=0;i<this.length-1;i++){var p1=this.points[i],p2=this.points[i+1];this.centers.push({x:(p1.x+p2.x)/2,y:(p1.y+p2.y)/2,z:(p1.z+p2.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(var i=0;i<this.centers.length-1;i++){var p1=this.centers[i],p2=this.centers[i+1],dx=this.points[i+1].x-(this.centers[i].x+this.centers[i+1].x)/2,dy=this.points[i+1].y-(this.centers[i].y+this.centers[i+1].y)/2,dz=this.points[i+1].z-(this.centers[i].y+this.centers[i+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[i+1].x+this.sharpness*(this.centers[i].x+dx),y:(1-this.sharpness)*this.points[i+1].y+this.sharpness*(this.centers[i].y+dy),z:(1-this.sharpness)*this.points[i+1].z+this.sharpness*(this.centers[i].z+dz)},{x:(1-this.sharpness)*this.points[i+1].x+this.sharpness*(this.centers[i+1].x+dx),y:(1-this.sharpness)*this.points[i+1].y+this.sharpness*(this.centers[i+1].y+dy),z:(1-this.sharpness)*this.points[i+1].z+this.sharpness*(this.centers[i+1].z+dz)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this};Spline.prototype.cacheSteps=function(mindist){var steps=[],laststep=this.pos(0);steps.push(0);for(var t=0;t<this.duration;t+=10){var step=this.pos(t),dist2=Math.sqrt((step.x-laststep.x)*(step.x-laststep.x)+(step.y-laststep.y)*(step.y-laststep.y)+(step.z-laststep.z)*(step.z-laststep.z));dist2>mindist&&(steps.push(t),laststep=step)}return steps};Spline.prototype.vector=function(t){var p1=this.pos(t+10),p2=this.pos(t-10);return{angle:180*Math.atan2(p1.y-p2.y,p1.x-p2.x)/3.14,speed:Math.sqrt((p2.x-p1.x)*(p2.x-p1.x)+(p2.y-p1.y)*(p2.y-p1.y)+(p2.z-p1.z)*(p2.z-p1.z))}};Spline.prototype.pos=function(time){function bezier2(t3,p1,c1,c2,p2){var B=function(t4){var t22=t4*t4,t32=t22*t4;return[t32,3*t22*(1-t4),3*t4*(1-t4)*(1-t4),(1-t4)*(1-t4)*(1-t4)]},b=B(t3),pos={x:p2.x*b[0]+c2.x*b[1]+c1.x*b[2]+p1.x*b[3],y:p2.y*b[0]+c2.y*b[1]+c1.y*b[2]+p1.y*b[3],z:p2.z*b[0]+c2.z*b[1]+c1.z*b[2]+p1.z*b[3]};return pos}var t=time-this.delay;t<0&&(t=0),t>this.duration&&(t=this.duration-1);var t2=t/this.duration;if(t2>=1)return this.points[this.length-1];var n=Math.floor((this.points.length-1)*t2),t1=(this.length-1)*t2-n;return bezier2(t1,this.points[n],this.controls[n][1],this.controls[n+1][0],this.points[n+1])};function bezier(line,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var resolution=options.resolution||1e4,sharpness=options.sharpness||.85;if(!line)throw new Error("line is required");if(!isNumber(resolution))throw new Error("resolution must be an number");if(!isNumber(sharpness))throw new Error("sharpness must be an number");for(var coords=[],spline=new Spline({points:getGeom(line).coordinates.map(function(pt){return{x:pt[0],y:pt[1]}}),duration:resolution,sharpness}),i=0;i<spline.duration;i+=10){var pos=spline.pos(i);Math.floor(i/100)%2===0&&coords.push([pos.x,pos.y])}return lineString(coords,line.properties)}function tag(points2,polygons2,field,outField){return points2=clone2(points2),polygons2=clone2(polygons2),featureEach(points2,function(pt){pt.properties||(pt.properties={}),featureEach(polygons2,function(poly){pt.properties[outField]===void 0&&booleanPointInPolygon(pt,poly)&&(pt.properties[outField]=poly.properties[field])})}),points2}function sample(featurecollection,num){if(!featurecollection)throw new Error("featurecollection is required");if(num==null)throw new Error("num is required");if(typeof num!="number")throw new Error("num must be a number");var outFC=featureCollection(getRandomSubarray(featurecollection.features,num));return outFC}function getRandomSubarray(arr,size11){for(var shuffled=arr.slice(0),i=arr.length,min4=i-size11,temp2,index;i-- >min4;)index=Math.floor((i+1)*Math.random()),temp2=shuffled[index],shuffled[index]=shuffled[i],shuffled[i]=temp2;return shuffled.slice(min4)}function bboxPolygon(bbox2){validateBBox(bbox2);var west=Number(bbox2[0]),south=Number(bbox2[1]),east=Number(bbox2[2]),north=Number(bbox2[3]);if(bbox2.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var lowLeft=[west,south],topLeft=[west,north],topRight=[east,north],lowRight=[east,south];return polygon([[lowLeft,lowRight,topRight,topLeft,lowLeft]])}function envelope(geojson){return bboxPolygon(bbox(geojson))}function square(bbox2){var west=bbox2[0],south=bbox2[1],east=bbox2[2],north=bbox2[3],horizontalDistance=distance2(bbox2.slice(0,2),[east,south]),verticalDistance=distance2(bbox2.slice(0,2),[west,north]);if(horizontalDistance>=verticalDistance){var verticalMidpoint=(south+north)/2;return[west,verticalMidpoint-(east-west)/2,east,verticalMidpoint+(east-west)/2]}else{var horizontalMidpoint=(west+east)/2;return[horizontalMidpoint-(north-south)/2,south,horizontalMidpoint+(north-south)/2,north]}}function destination(origin,distance12,bearing2,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var units=options.units,properties=options.properties,coordinates1=getCoord(origin),longitude1=degreesToRadians(coordinates1[0]),latitude1=degreesToRadians(coordinates1[1]),bearing_rad=degreesToRadians(bearing2),radians2=lengthToRadians(distance12,units),latitude2=Math.asin(Math.sin(latitude1)*Math.cos(radians2)+Math.cos(latitude1)*Math.sin(radians2)*Math.cos(bearing_rad)),longitude2=longitude1+Math.atan2(Math.sin(bearing_rad)*Math.sin(radians2)*Math.cos(latitude1),Math.cos(radians2)-Math.sin(latitude1)*Math.sin(latitude2)),lng=radiansToDegrees(longitude2),lat2=radiansToDegrees(latitude2);return point([lng,lat2],properties)}function circle(center2,radius,options){options=options||{};var steps=options.steps||64,properties=options.properties;if(!center2)throw new Error("center is required");if(!radius)throw new Error("radius is required");if(typeof options!="object")throw new Error("options must be an object");if(typeof steps!="number")throw new Error("steps must be a number");steps=steps||64,properties=properties||center2.properties||{};for(var coordinates=[],i=0;i<steps;i++)coordinates.push(destination(center2,radius,i*-360/steps,options).geometry.coordinates);return coordinates.push(coordinates[0]),polygon([coordinates],properties)}function bearing(start2,end,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var final=options.final;if(final===!0)return calculateFinalBearing(start2,end);var coordinates1=getCoord(start2),coordinates2=getCoord(end),lon1=degreesToRadians(coordinates1[0]),lon2=degreesToRadians(coordinates2[0]),lat1=degreesToRadians(coordinates1[1]),lat2=degreesToRadians(coordinates2[1]),a=Math.sin(lon2-lon1)*Math.cos(lat2),b=Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1);return radiansToDegrees(Math.atan2(a,b))}function calculateFinalBearing(start2,end){var bear=bearing(end,start2);return bear=(bear+180)%360,bear}function midpoint(point1,point22){var dist2=distance2(point1,point22),heading=bearing(point1,point22),midpoint2=destination(point1,dist2/2,heading);return midpoint2}function center(geojson,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var properties=options.properties;if(!geojson)throw new Error("geojson is required");var ext=bbox(geojson),x2=(ext[0]+ext[2])/2,y2=(ext[1]+ext[3])/2;return point([x2,y2],properties)}function centroid(geojson,properties){var xSum=0,ySum=0,len=0;return coordEach(geojson,function(coord){xSum+=coord[0],ySum+=coord[1],len++},!0),point([xSum/len,ySum/len],properties)}function centerOfMass(geojson,properties){switch(getType(geojson)){case"Point":return geojson;case"Polygon":var coords=[];coordEach(geojson,function(coord){coords.push(coord)});var centre2=centroid(geojson,properties),translation=centre2.geometry.coordinates,sx=0,sy=0,sArea=0,i,pi2,pj,xi,xj,yi,yj,a,neutralizedPoints=coords.map(function(point$$1){return[point$$1[0]-translation[0],point$$1[1]-translation[1]]});for(i=0;i<coords.length-1;i++)pi2=neutralizedPoints[i],xi=pi2[0],yi=pi2[1],pj=neutralizedPoints[i+1],xj=pj[0],yj=pj[1],a=xi*yj-xj*yi,sArea+=a,sx+=(xi+xj)*a,sy+=(yi+yj)*a;if(sArea===0)return centre2;var area5=sArea*.5,areaFactor=1/(6*area5);return point([translation[0]+areaFactor*sx,translation[1]+areaFactor*sy],properties);default:var hull=convex(geojson);return hull?centerOfMass(hull,properties):centroid(geojson,properties)}}function combine(fc){var groups={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},multiMapping=Object.keys(groups).reduce(function(memo,item){return memo[item.replace("Multi","")]=item,memo},{});function addToGroup(feature$$1,key,multi){multi?groups[key].coordinates=groups[key].coordinates.concat(feature$$1.geometry.coordinates):groups[key].coordinates.push(feature$$1.geometry.coordinates),groups[key].properties.push(feature$$1.properties)}return featureEach(fc,function(feature$$1){!feature$$1.geometry||(groups[feature$$1.geometry.type]?addToGroup(feature$$1,feature$$1.geometry.type,!0):multiMapping[feature$$1.geometry.type]&&addToGroup(feature$$1,multiMapping[feature$$1.geometry.type],!1))}),featureCollection(Object.keys(groups).filter(function(key){return groups[key].coordinates.length}).sort().map(function(key){var geometry$$1={type:key,coordinates:groups[key].coordinates},properties={collectedProperties:groups[key].properties};return feature(geometry$$1,properties)}))}function explode(geojson){var points$$1=[];return geojson.type==="FeatureCollection"?featureEach(geojson,function(feature$$1){coordEach(feature$$1,function(coord){points$$1.push(point(coord,feature$$1.properties))})}):coordEach(geojson,function(coord){points$$1.push(point(coord,geojson.properties))}),featureCollection(points$$1)}var earcut_1=earcut,default_1$2=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode)return triangles;var minX2,minY2,maxX2,maxY2,x2,y2,invSize;if(hasHoles&&(outerNode=eliminateHoles(data,holeIndices,outerNode,dim)),data.length>80*dim){minX2=maxX2=data[0],minY2=maxY2=data[1];for(var i=dim;i<outerLen;i+=dim)x2=data[i],y2=data[i+1],x2<minX2&&(minX2=x2),y2<minY2&&(minY2=y2),x2>maxX2&&(maxX2=x2),y2>maxY2&&(maxY2=y2);invSize=Math.max(maxX2-minX2,maxY2-minY2),invSize=invSize!==0?1/invSize:0}return earcutLinked(outerNode,triangles,dim,minX2,minY2,invSize),triangles}function linkedList(data,start2,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start2,end,dim)>0)for(i=start2;i<end;i+=dim)last=insertNode$1(i,data[i],data[i+1],last);else for(i=end-dim;i>=start2;i-=dim)last=insertNode$1(i,data[i],data[i+1],last);return last&&equals$1(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start2,end){if(!start2)return start2;end||(end=start2);var p=start2,again;do if(again=!1,!p.steiner&&(equals$1(p,p.next)||area(p.prev,p,p.next)===0)){if(removeNode(p),p=end=p.prev,p===p.next)break;again=!0}else p=p.next;while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX2,minY2,invSize,pass){if(!!ear){!pass&&invSize&&indexCurve(ear,minX2,minY2,invSize);for(var stop2=ear,prev,next3;ear.prev!==ear.next;){if(prev=ear.prev,next3=ear.next,invSize?isEarHashed(ear,minX2,minY2,invSize):isEar(ear)){triangles.push(prev.i/dim),triangles.push(ear.i/dim),triangles.push(next3.i/dim),removeNode(ear),ear=next3.next,stop2=next3.next;continue}if(ear=next3,ear===stop2){pass?pass===1?(ear=cureLocalIntersections(ear,triangles,dim),earcutLinked(ear,triangles,dim,minX2,minY2,invSize,2)):pass===2&&splitEarcut(ear,triangles,dim,minX2,minY2,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX2,minY2,invSize,1);break}}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var p=ear.next.next;p!==ear.prev;){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX2,minY2,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y,minZ=zOrder(minTX,minTY,minX2,minY2,invSize),maxZ=zOrder(maxTX,maxTY,minX2,minY2,invSize),p=ear.nextZ;p&&p.z<=maxZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=ear.prevZ;p&&p.z>=minZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function cureLocalIntersections(start2,triangles,dim){var p=start2;do{var a=p.prev,b=p.next.next;!equals$1(a,b)&&intersects$2(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim),triangles.push(p.i/dim),triangles.push(b.i/dim),removeNode(p),removeNode(p.next),p=start2=b),p=p.next}while(p!==start2);return p}function splitEarcut(start2,triangles,dim,minX2,minY2,invSize){var a=start2;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX2,minY2,invSize),earcutLinked(c,triangles,dim,minX2,minY2,invSize);return}b=b.next}a=a.next}while(a!==start2)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start2,end,list;for(i=0,len=holeIndices.length;i<len;i++)start2=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length,list=linkedList(data,start2,end,dim,!1),list===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)eliminateHole(queue[i],outerNode),outerNode=filterPoints(outerNode,outerNode.next);return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){if(outerNode=findHoleBridge(hole,outerNode),outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0,m;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x2=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x2<=hx&&x2>qx){if(qx=x2,x2===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var stop2=m,mx=m.x,my=m.y,tanMin=1/0,tan2;for(p=m.next;p!==stop2;)hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&(tan2=Math.abs(hy-p.y)/(hx-p.x),(tan2<tanMin||tan2===tanMin&&p.x>m.x)&&locallyInside(p,hole)&&(m=p,tanMin=tan2)),p=p.next;return m}function indexCurve(start2,minX2,minY2,invSize){var p=start2;do p.z===null&&(p.z=zOrder(p.x,p.y,minX2,minY2,invSize)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==start2);p.prevZ.nextZ=null,p.prevZ=null,sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ,!!q);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)pSize!==0&&(qSize===0||!q||p.z<=q.z)?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1);return list}function zOrder(x2,y2,minX2,minY2,invSize){return x2=32767*(x2-minX2)*invSize,y2=32767*(y2-minY2)*invSize,x2=(x2|x2<<8)&16711935,x2=(x2|x2<<4)&252645135,x2=(x2|x2<<2)&858993459,x2=(x2|x2<<1)&1431655765,y2=(y2|y2<<8)&16711935,y2=(y2|y2<<4)&252645135,y2=(y2|y2<<2)&858993459,y2=(y2|y2<<1)&1431655765,x2|y2<<1}function getLeftmost(start2){var p=start2,leftmost=start2;do p.x<leftmost.x&&(leftmost=p),p=p.next;while(p!==start2);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals$1(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects$2(p1,q1,p2,q2){return equals$1(p1,q1)&&equals$1(p2,q2)||equals$1(p1,q2)&&equals$1(p2,q1)?!0:area(p1,q1,p2)>0!=area(p1,q1,q2)>0&&area(p2,q2,p1)>0!=area(p2,q2,q1)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects$2(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside3=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside3=!inside3),p=p.next;while(p!==a);return inside3}function splitPolygon(a,b){var a2=new Node2(a.i,a.x,a.y),b2=new Node2(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode$1(i,x2,y2,last){var p=new Node2(i,x2,y2);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node2(i,x2,y2){this.i=i,this.x=x2,this.y=y2,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,polygonArea2=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles)for(var i=0,len=holeIndices.length;i<len;i++){var start2=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea2-=Math.abs(signedArea(data,start2,end,dim))}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return polygonArea2===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea2)/polygonArea2)};function signedArea(data,start2,end,dim){for(var sum=0,i=start2,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&(holeIndex+=data[i-1].length,result.holes.push(holeIndex))}return result};earcut_1.default=default_1$2;function tesselate(poly){if(!poly.geometry||poly.geometry.type!=="Polygon"&&poly.geometry.type!=="MultiPolygon")throw new Error("input must be a Polygon or MultiPolygon");var fc={type:"FeatureCollection",features:[]};return poly.geometry.type==="Polygon"?fc.features=processPolygon(poly.geometry.coordinates):poly.geometry.coordinates.forEach(function(coordinates){fc.features=fc.features.concat(processPolygon(coordinates))}),fc}function processPolygon(coordinates){var data=flattenCoords(coordinates),dim=2,result=earcut_1(data.vertices,data.holes,dim),features=[],vertices=[];result.forEach(function(vert,i2){var index=result[i2];vertices.push([data.vertices[index*dim],data.vertices[index*dim+1]])});for(var i=0;i<vertices.length;i+=3){var coords=vertices.slice(i,i+3);coords.push(vertices[i]),features.push(polygon([coords]))}return features}function flattenCoords(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&(holeIndex+=data[i-1].length,result.holes.push(holeIndex))}return result}function nearestPoint(targetPoint,points2){if(!targetPoint)throw new Error("targetPoint is required");if(!points2)throw new Error("points is required");var nearest,minDist=1/0;return featureEach(points2,function(pt,featureIndex){var distanceToPoint=distance2(targetPoint,pt);distanceToPoint<minDist&&(nearest=clone2(pt),nearest.properties.featureIndex=featureIndex,nearest.properties.distanceToPoint=distanceToPoint,minDist=distanceToPoint)}),nearest}function quickselect$3(arr,k,left,right,compare10){quickselectStep(arr,k,left||0,right||arr.length-1,compare10||defaultCompare$2)}function quickselectStep(arr,k,left,right,compare10){for(;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1),newLeft=Math.max(left,Math.floor(k-m*s/n+sd)),newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));quickselectStep(arr,k,newLeft,newRight,compare10)}var t=arr[k],i=left,j=right;for(swap$1(arr,left,k),compare10(arr[right],t)>0&&swap$1(arr,left,right);i<j;){for(swap$1(arr,i,j),i++,j--;compare10(arr[i],t)<0;)i++;for(;compare10(arr[j],t)>0;)j--}compare10(arr[left],t)===0?swap$1(arr,left,j):(j++,swap$1(arr,j,right)),j<=k&&(left=j+1),k<=j&&(right=j-1)}}function swap$1(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare$2(a,b){return a<b?-1:a>b?1:0}function rbush$4(maxEntries,format){if(!(this instanceof rbush$4))return new rbush$4(maxEntries,format);this._maxEntries=Math.max(4,maxEntries||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),format&&this._initFormat(format),this.clear()}rbush$4.prototype={all:function(){return this._all(this.data,[])},search:function(bbox2){var node=this.data,result=[],toBBox=this.toBBox;if(!intersects$4(bbox2,node))return result;for(var nodesToSearch=[],i,len,child,childBBox;node;){for(i=0,len=node.children.length;i<len;i++)child=node.children[i],childBBox=node.leaf?toBBox(child):child,intersects$4(bbox2,childBBox)&&(node.leaf?result.push(child):contains$1(bbox2,childBBox)?this._all(child,result):nodesToSearch.push(child));node=nodesToSearch.pop()}return result},collides:function(bbox2){var node=this.data,toBBox=this.toBBox;if(!intersects$4(bbox2,node))return!1;for(var nodesToSearch=[],i,len,child,childBBox;node;){for(i=0,len=node.children.length;i<len;i++)if(child=node.children[i],childBBox=node.leaf?toBBox(child):child,intersects$4(bbox2,childBBox)){if(node.leaf||contains$1(bbox2,childBBox))return!0;nodesToSearch.push(child)}node=nodesToSearch.pop()}return!1},load:function(data){if(!(data&&data.length))return this;if(data.length<this._minEntries){for(var i=0,len=data.length;i<len;i++)this.insert(data[i]);return this}var node=this._build(data.slice(),0,data.length-1,0);if(!this.data.children.length)this.data=node;else if(this.data.height===node.height)this._splitRoot(this.data,node);else{if(this.data.height<node.height){var tmpNode=this.data;this.data=node,node=tmpNode}this._insert(node,this.data.height-node.height-1,!0)}return this},insert:function(item){return item&&this._insert(item,this.data.height-1),this},clear:function(){return this.data=createNode$1([]),this},remove:function(item,equalsFn){if(!item)return this;for(var node=this.data,bbox2=this.toBBox(item),path=[],indexes=[],i,parent,index,goingUp;node||path.length;){if(node||(node=path.pop(),parent=path[path.length-1],i=indexes.pop(),goingUp=!0),node.leaf&&(index=findItem$1(item,node.children,equalsFn),index!==-1))return node.children.splice(index,1),path.push(node),this._condense(path),this;!goingUp&&!node.leaf&&contains$1(node,bbox2)?(path.push(node),indexes.push(i),i=0,parent=node,node=node.children[0]):parent?(i++,node=parent.children[i],goingUp=!1):node=null}return this},toBBox:function(item){return item},compareMinX:compareNodeMinX$1,compareMinY:compareNodeMinY$1,toJSON:function(){return this.data},fromJSON:function(data){return this.data=data,this},_all:function(node,result){for(var nodesToSearch=[];node;)node.leaf?result.push.apply(result,node.children):nodesToSearch.push.apply(nodesToSearch,node.children),node=nodesToSearch.pop();return result},_build:function(items,left,right,height2){var N=right-left+1,M=this._maxEntries,node;if(N<=M)return node=createNode$1(items.slice(left,right+1)),calcBBox$1(node,this.toBBox),node;height2||(height2=Math.ceil(Math.log(N)/Math.log(M)),M=Math.ceil(N/Math.pow(M,height2-1))),node=createNode$1([]),node.leaf=!1,node.height=height2;var N2=Math.ceil(N/M),N1=N2*Math.ceil(Math.sqrt(M)),i,j,right2,right3;for(multiSelect$1(items,left,right,N1,this.compareMinX),i=left;i<=right;i+=N1)for(right2=Math.min(i+N1-1,right),multiSelect$1(items,i,right2,N2,this.compareMinY),j=i;j<=right2;j+=N2)right3=Math.min(j+N2-1,right2),node.children.push(this._build(items,j,right3,height2-1));return calcBBox$1(node,this.toBBox),node},_chooseSubtree:function(bbox2,node,level,path){for(var i,len,child,targetNode,area5,enlargement,minArea,minEnlargement;path.push(node),!(node.leaf||path.length-1===level);){for(minArea=minEnlargement=1/0,i=0,len=node.children.length;i<len;i++)child=node.children[i],area5=bboxArea$1(child),enlargement=enlargedArea$1(bbox2,child)-area5,enlargement<minEnlargement?(minEnlargement=enlargement,minArea=area5<minArea?area5:minArea,targetNode=child):enlargement===minEnlargement&&area5<minArea&&(minArea=area5,targetNode=child);node=targetNode||node.children[0]}return node},_insert:function(item,level,isNode){var toBBox=this.toBBox,bbox2=isNode?item:toBBox(item),insertPath=[],node=this._chooseSubtree(bbox2,this.data,level,insertPath);for(node.children.push(item),extend$1(node,bbox2);level>=0&&insertPath[level].children.length>this._maxEntries;)this._split(insertPath,level),level--;this._adjustParentBBoxes(bbox2,insertPath,level)},_split:function(insertPath,level){var node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);var splitIndex=this._chooseSplitIndex(node,m,M),newNode=createNode$1(node.children.splice(splitIndex,node.children.length-splitIndex));newNode.height=node.height,newNode.leaf=node.leaf,calcBBox$1(node,this.toBBox),calcBBox$1(newNode,this.toBBox),level?insertPath[level-1].children.push(newNode):this._splitRoot(node,newNode)},_splitRoot:function(node,newNode){this.data=createNode$1([node,newNode]),this.data.height=node.height+1,this.data.leaf=!1,calcBBox$1(this.data,this.toBBox)},_chooseSplitIndex:function(node,m,M){var i,bbox1,bbox2,overlap2,area5,minOverlap,minArea,index;for(minOverlap=minArea=1/0,i=m;i<=M-m;i++)bbox1=distBBox$1(node,0,i,this.toBBox),bbox2=distBBox$1(node,i,M,this.toBBox),overlap2=intersectionArea$1(bbox1,bbox2),area5=bboxArea$1(bbox1)+bboxArea$1(bbox2),overlap2<minOverlap?(minOverlap=overlap2,index=i,minArea=area5<minArea?area5:minArea):overlap2===minOverlap&&area5<minArea&&(minArea=area5,index=i);return index},_chooseSplitAxis:function(node,m,M){var compareMinX=node.leaf?this.compareMinX:compareNodeMinX$1,compareMinY=node.leaf?this.compareMinY:compareNodeMinY$1,xMargin=this._allDistMargin(node,m,M,compareMinX),yMargin=this._allDistMargin(node,m,M,compareMinY);xMargin<yMargin&&node.children.sort(compareMinX)},_allDistMargin:function(node,m,M,compare10){node.children.sort(compare10);var toBBox=this.toBBox,leftBBox=distBBox$1(node,0,m,toBBox),rightBBox=distBBox$1(node,M-m,M,toBBox),margin=bboxMargin$1(leftBBox)+bboxMargin$1(rightBBox),i,child;for(i=m;i<M-m;i++)child=node.children[i],extend$1(leftBBox,node.leaf?toBBox(child):child),margin+=bboxMargin$1(leftBBox);for(i=M-m-1;i>=m;i--)child=node.children[i],extend$1(rightBBox,node.leaf?toBBox(child):child),margin+=bboxMargin$1(rightBBox);return margin},_adjustParentBBoxes:function(bbox2,path,level){for(var i=level;i>=0;i--)extend$1(path[i],bbox2)},_condense:function(path){for(var i=path.length-1,siblings;i>=0;i--)path[i].children.length===0?i>0?(siblings=path[i-1].children,siblings.splice(siblings.indexOf(path[i]),1)):this.clear():calcBBox$1(path[i],this.toBBox)},_initFormat:function(format){var compareArr=["return a"," - b",";"];this.compareMinX=new Function("a","b",compareArr.join(format[0])),this.compareMinY=new Function("a","b",compareArr.join(format[1])),this.toBBox=new Function("a","return {minX: a"+format[0]+", minY: a"+format[1]+", maxX: a"+format[2]+", maxY: a"+format[3]+"};")}};function findItem$1(item,items,equalsFn){if(!equalsFn)return items.indexOf(item);for(var i=0;i<items.length;i++)if(equalsFn(item,items[i]))return i;return-1}function calcBBox$1(node,toBBox){distBBox$1(node,0,node.children.length,toBBox,node)}function distBBox$1(node,k,p,toBBox,destNode){destNode||(destNode=createNode$1(null)),destNode.minX=1/0,destNode.minY=1/0,destNode.maxX=-1/0,destNode.maxY=-1/0;for(var i=k,child;i<p;i++)child=node.children[i],extend$1(destNode,node.leaf?toBBox(child):child);return destNode}function extend$1(a,b){return a.minX=Math.min(a.minX,b.minX),a.minY=Math.min(a.minY,b.minY),a.maxX=Math.max(a.maxX,b.maxX),a.maxY=Math.max(a.maxY,b.maxY),a}function compareNodeMinX$1(a,b){return a.minX-b.minX}function compareNodeMinY$1(a,b){return a.minY-b.minY}function bboxArea$1(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function bboxMargin$1(a){return a.maxX-a.minX+(a.maxY-a.minY)}function enlargedArea$1(a,b){return(Math.max(b.maxX,a.maxX)-Math.min(b.minX,a.minX))*(Math.max(b.maxY,a.maxY)-Math.min(b.minY,a.minY))}function intersectionArea$1(a,b){var minX2=Math.max(a.minX,b.minX),minY2=Math.max(a.minY,b.minY),maxX2=Math.min(a.maxX,b.maxX),maxY2=Math.min(a.maxY,b.maxY);return Math.max(0,maxX2-minX2)*Math.max(0,maxY2-minY2)}function contains$1(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function intersects$4(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function createNode$1(children){return{children,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect$1(arr,left,right,n,compare10){for(var stack=[left,right],mid;stack.length;)right=stack.pop(),left=stack.pop(),!(right-left<=n)&&(mid=left+Math.ceil((right-left)/n/2)*n,quickselect$3(arr,mid,left,right,compare10),stack.push(left,mid,mid,right))}function geojsonRbush(maxEntries){var tree=rbush$4(maxEntries);return tree.insert=function(feature2){if(Array.isArray(feature2)){var bbox2=feature2;feature2=bboxPolygon$2(bbox2),feature2.bbox=bbox2}else feature2.bbox=feature2.bbox?feature2.bbox:turfBBox(feature2);return rbush$4.prototype.insert.call(this,feature2)},tree.load=function(features){var load=[];return Array.isArray(features)?features.forEach(function(bbox2){var feature2=bboxPolygon$2(bbox2);feature2.bbox=bbox2,load.push(feature2)}):featureEach(features,function(feature2){feature2.bbox=feature2.bbox?feature2.bbox:turfBBox(feature2),load.push(feature2)}),rbush$4.prototype.load.call(this,load)},tree.remove=function(feature2){if(Array.isArray(feature2)){var bbox2=feature2;feature2=bboxPolygon$2(bbox2),feature2.bbox=bbox2}return rbush$4.prototype.remove.call(this,feature2)},tree.clear=function(){return rbush$4.prototype.clear.call(this)},tree.search=function(geojson){var features=rbush$4.prototype.search.call(this,this.toBBox(geojson));return{type:"FeatureCollection",features}},tree.collides=function(geojson){return rbush$4.prototype.collides.call(this,this.toBBox(geojson))},tree.all=function(){var features=rbush$4.prototype.all.call(this);return{type:"FeatureCollection",features}},tree.toJSON=function(){return rbush$4.prototype.toJSON.call(this)},tree.fromJSON=function(json){return rbush$4.prototype.fromJSON.call(this,json)},tree.toBBox=function(geojson){var bbox2;return geojson.bbox?bbox2=geojson.bbox:Array.isArray(geojson)&&geojson.length===4?bbox2=geojson:bbox2=turfBBox(geojson),{minX:bbox2[0],minY:bbox2[1],maxX:bbox2[2],maxY:bbox2[3]}},tree}function bboxPolygon$2(bbox2){var lowLeft=[bbox2[0],bbox2[1]],topLeft=[bbox2[0],bbox2[3]],topRight=[bbox2[2],bbox2[3]],lowRight=[bbox2[2],bbox2[1]],coordinates=[[lowLeft,lowRight,topRight,topLeft,lowLeft]];return{type:"Feature",bbox:bbox2,properties:{},geometry:{type:"Polygon",coordinates}}}function turfBBox(geojson){var bbox2=[1/0,1/0,-1/0,-1/0];return coordEach(geojson,function(coord){bbox2[0]>coord[0]&&(bbox2[0]=coord[0]),bbox2[1]>coord[1]&&(bbox2[1]=coord[1]),bbox2[2]<coord[0]&&(bbox2[2]=coord[0]),bbox2[3]<coord[1]&&(bbox2[3]=coord[1])}),bbox2}function lineSegment(geojson){if(!geojson)throw new Error("geojson is required");var results=[];return flattenEach(geojson,function(feature$$1){lineSegmentFeature(feature$$1,results)}),featureCollection(results)}function lineSegmentFeature(geojson,results){var coords=[],geometry$$1=geojson.geometry;switch(geometry$$1.type){case"Polygon":coords=getCoords(geometry$$1);break;case"LineString":coords=[getCoords(geometry$$1)]}coords.forEach(function(coord){var segments=createSegments(coord,geojson.properties);segments.forEach(function(segment){segment.id=results.length,results.push(segment)})})}function createSegments(coords,properties){var segments=[];return coords.reduce(function(previousCoords,currentCoords){var segment=lineString([previousCoords,currentCoords],properties);return segment.bbox=bbox$3(previousCoords,currentCoords),segments.push(segment),currentCoords}),segments}function bbox$3(coords1,coords2){var x12=coords1[0],y12=coords1[1],x2=coords2[0],y2=coords2[1],west=x12<x2?x12:x2,south=y12<y2?y12:y2,east=x12>x2?x12:x2,north=y12>y2?y12:y2;return[west,south,east,north]}function lineIntersect(line1,line2){var unique={},results=[];if(line1.type==="LineString"&&(line1=feature(line1)),line2.type==="LineString"&&(line2=feature(line2)),line1.type==="Feature"&&line2.type==="Feature"&&line1.geometry.type==="LineString"&&line2.geometry.type==="LineString"&&line1.geometry.coordinates.length===2&&line2.geometry.coordinates.length===2){var intersect2=intersects$3(line1,line2);return intersect2&&results.push(intersect2),featureCollection(results)}var tree=geojsonRbush();return tree.load(lineSegment(line2)),featureEach(lineSegment(line1),function(segment){featureEach(tree.search(segment),function(match){var intersect3=intersects$3(segment,match);if(intersect3){var key=getCoords(intersect3).join(",");unique[key]||(unique[key]=!0,results.push(intersect3))}})}),featureCollection(results)}function intersects$3(line1,line2){var coords1=getCoords(line1),coords2=getCoords(line2);if(coords1.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(coords2.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var x12=coords1[0][0],y12=coords1[0][1],x2=coords1[1][0],y2=coords1[1][1],x3=coords2[0][0],y3=coords2[0][1],x4=coords2[1][0],y4=coords2[1][1],denom=(y4-y3)*(x2-x12)-(x4-x3)*(y2-y12),numeA=(x4-x3)*(y12-y3)-(y4-y3)*(x12-x3),numeB=(x2-x12)*(y12-y3)-(y2-y12)*(x12-x3);if(denom===0)return numeA===0&&numeB===0,null;var uA=numeA/denom,uB=numeB/denom;if(uA>=0&&uA<=1&&uB>=0&&uB<=1){var x5=x12+uA*(x2-x12),y5=y12+uA*(y2-y12);return point([x5,y5])}return null}function nearestPointOnLine(lines,pt,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var type=lines.geometry?lines.geometry.type:lines.type;if(type!=="LineString"&&type!=="MultiLineString")throw new Error("lines must be LineString or MultiLineString");var closestPt=point([1/0,1/0],{dist:1/0}),length3=0;return flattenEach(lines,function(line){for(var coords=getCoords(line),i=0;i<coords.length-1;i++){var start2=point(coords[i]);start2.properties.dist=distance2(pt,start2,options);var stop2=point(coords[i+1]);stop2.properties.dist=distance2(pt,stop2,options);var sectionLength=distance2(start2,stop2,options),heightDistance=Math.max(start2.properties.dist,stop2.properties.dist),direction=bearing(start2,stop2),perpendicularPt1=destination(pt,heightDistance,direction+90,options),perpendicularPt2=destination(pt,heightDistance,direction-90,options),intersect2=lineIntersect(lineString([perpendicularPt1.geometry.coordinates,perpendicularPt2.geometry.coordinates]),lineString([start2.geometry.coordinates,stop2.geometry.coordinates])),intersectPt=null;intersect2.features.length>0&&(intersectPt=intersect2.features[0],intersectPt.properties.dist=distance2(pt,intersectPt,options),intersectPt.properties.location=length3+distance2(start2,intersectPt,options)),start2.properties.dist<closestPt.properties.dist&&(closestPt=start2,closestPt.properties.index=i,closestPt.properties.location=length3),stop2.properties.dist<closestPt.properties.dist&&(closestPt=stop2,closestPt.properties.index=i+1,closestPt.properties.location=length3+sectionLength),intersectPt&&intersectPt.properties.dist<closestPt.properties.dist&&(closestPt=intersectPt,closestPt.properties.index=i),length3+=sectionLength}}),closestPt}function rhumbBearing(start2,end,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var final=options.final;if(!start2)throw new Error("start point is required");if(!end)throw new Error("end point is required");var bear360;final?bear360=calculateRhumbBearing(getCoord(end),getCoord(start2)):bear360=calculateRhumbBearing(getCoord(start2),getCoord(end));var bear180=bear360>180?-(360-bear360):bear360;return bear180}function calculateRhumbBearing(from,to){var phi1=degreesToRadians(from[1]),phi2=degreesToRadians(to[1]),deltaLambda=degreesToRadians(to[0]-from[0]);deltaLambda>Math.PI&&(deltaLambda-=2*Math.PI),deltaLambda<-Math.PI&&(deltaLambda+=2*Math.PI);var deltaPsi=Math.log(Math.tan(phi2/2+Math.PI/4)/Math.tan(phi1/2+Math.PI/4)),theta=Math.atan2(deltaLambda,deltaPsi);return(radiansToDegrees(theta)+360)%360}function rhumbDistance(from,to,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var units=options.units;if(!from)throw new Error("from point is required");if(!to)throw new Error("to point is required");var origin=getCoord(from),destination2=getCoord(to);destination2[0]+=destination2[0]-origin[0]>180?-360:origin[0]-destination2[0]>180?360:0;var distanceInMeters=calculateRhumbDistance(origin,destination2),distance12=convertLength(distanceInMeters,"meters",units);return distance12}function calculateRhumbDistance(origin,destination2,radius){radius=radius===void 0?earthRadius:Number(radius);var R=radius,phi1=origin[1]*Math.PI/180,phi2=destination2[1]*Math.PI/180,DeltaPhi=phi2-phi1,DeltaLambda=Math.abs(destination2[0]-origin[0])*Math.PI/180;DeltaLambda>Math.PI&&(DeltaLambda-=2*Math.PI);var DeltaPsi=Math.log(Math.tan(phi2/2+Math.PI/4)/Math.tan(phi1/2+Math.PI/4)),q=Math.abs(DeltaPsi)>1e-11?DeltaPhi/DeltaPsi:Math.cos(phi1),delta2=Math.sqrt(DeltaPhi*DeltaPhi+q*q*DeltaLambda*DeltaLambda),dist2=delta2*R;return dist2}function toMercator(geojson,options){return convert(geojson,"mercator",options)}function toWgs84(geojson,options){return convert(geojson,"wgs84",options)}function convert(geojson,projection2,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var mutate=options.mutate;if(!geojson)throw new Error("geojson is required");return Array.isArray(geojson)&&isNumber(geojson[0])?geojson=projection2==="mercator"?convertToMercator(geojson):convertToWgs84(geojson):(mutate!==!0&&(geojson=clone2(geojson)),coordEach(geojson,function(coord){var newCoord=projection2==="mercator"?convertToMercator(coord):convertToWgs84(coord);coord[0]=newCoord[0],coord[1]=newCoord[1]})),geojson}function convertToMercator(lonLat){var D2R2=Math.PI/180,A=6378137,MAXEXTENT=20037508342789244e-9,adjusted=Math.abs(lonLat[0])<=180?lonLat[0]:lonLat[0]-sign2(lonLat[0])*360,xy=[A*adjusted*D2R2,A*Math.log(Math.tan(Math.PI*.25+.5*lonLat[1]*D2R2))];return xy[0]>MAXEXTENT&&(xy[0]=MAXEXTENT),xy[0]<-MAXEXTENT&&(xy[0]=-MAXEXTENT),xy[1]>MAXEXTENT&&(xy[1]=MAXEXTENT),xy[1]<-MAXEXTENT&&(xy[1]=-MAXEXTENT),xy}function convertToWgs84(xy){var R2D2=180/Math.PI,A=6378137;return[xy[0]*R2D2/A,(Math.PI*.5-2*Math.atan(Math.exp(-xy[1]/A)))*R2D2]}function sign2(x2){return x2<0?-1:x2>0?1:0}var main_es$3=Object.freeze({toMercator,toWgs84});function pointToLineDistance(pt,line,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");if(!pt)throw new Error("pt is required");if(Array.isArray(pt)?pt=point(pt):pt.type==="Point"?pt=feature(pt):featureOf(pt,"Point","point"),!line)throw new Error("line is required");Array.isArray(line)?line=lineString(line):line.type==="LineString"?line=feature(line):featureOf(line,"LineString","line");var distance$$1=1/0,p=pt.geometry.coordinates;return segmentEach(line,function(segment){var a=segment.geometry.coordinates[0],b=segment.geometry.coordinates[1],d=distanceToSegment(p,a,b,options);distance$$1>d&&(distance$$1=d)}),distance$$1}function distanceToSegment(p,a,b,options){var mercator=options.mercator,distanceAP=mercator!==!0?distance2(a,p,options):euclideanDistance(a,p,options),azimuthAP=bearingToAzimuth(mercator!==!0?bearing(a,p):rhumbBearing(a,p)),azimuthAB=bearingToAzimuth(mercator!==!0?bearing(a,b):rhumbBearing(a,b)),angleA=Math.abs(azimuthAP-azimuthAB);if(angleA>90)return distanceAP;var azimuthBA=(azimuthAB+180)%360,azimuthBP=bearingToAzimuth(mercator!==!0?bearing(b,p):rhumbBearing(b,p)),angleB=Math.abs(azimuthBP-azimuthBA);return angleB>180&&(angleB=Math.abs(angleB-360)),angleB>90?mercator!==!0?distance2(p,b,options):euclideanDistance(p,b,options):mercator!==!0?distanceAP*Math.sin(degreesToRadians(angleA)):mercatorPH(a,b,p,options)}function mercatorPH(a,b,p,options){var delta2=0;(Math.abs(a[0])>=180||Math.abs(b[0])>=180||Math.abs(p[0])>=180)&&(delta2=a[0]>0||b[0]>0||p[0]>0?-180:180);var origin=point(p),A=toMercator([a[0]+delta2,a[1]]),B=toMercator([b[0]+delta2,b[1]]),P=toMercator([p[0]+delta2,p[1]]),h=toWgs84(euclideanIntersection(A,B,P));delta2!==0&&(h[0]-=delta2);var distancePH=rhumbDistance(origin,h,options);return distancePH}function euclideanIntersection(a,b,p){var x12=a[0],y12=a[1],x2=b[0],y2=b[1],x3=p[0],y3=p[1],px=x2-x12,py=y2-y12,dab=px*px+py*py,u=((x3-x12)*px+(y3-y12)*py)/dab,x4=x12+u*px,y4=y12+u*py;return[x4,y4]}function euclideanDistance(from,to,options){var units=options.units,delta2=0;Math.abs(from[0])>=180&&(delta2=from[0]>0?-180:180),Math.abs(to[0])>=180&&(delta2=to[0]>0?-180:180);var p1=toMercator([from[0]+delta2,from[1]]),p2=toMercator([to[0]+delta2,to[1]]),sqr3=function(n){return n*n},squareD=sqr3(p1[0]-p2[0])+sqr3(p1[1]-p2[1]),d=Math.sqrt(squareD);return convertLength(d,"meters",units)}function nearestPointToLine(points$$1,line,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var units=options.units,properties=options.properties||{};if(!points$$1)throw new Error("points is required");if(points$$1=normalize2(points$$1),!points$$1.features.length)throw new Error("points must contain features");if(!line)throw new Error("line is required");if(getType(line)!=="LineString")throw new Error("line must be a LineString");var dist2=1/0,pt=null;return featureEach(points$$1,function(point$$1){var d=pointToLineDistance(point$$1,line,{units});d<dist2&&(dist2=d,pt=point$$1)}),pt&&(pt.properties=Object.assign({dist:dist2},pt.properties,properties)),pt}function normalize2(points$$1){var features=[],type=points$$1.geometry?points$$1.geometry.type:points$$1.type;switch(type){case"GeometryCollection":return geomEach(points$$1,function(geom){geom.type==="Point"&&features.push({type:"Feature",properties:{},geometry:geom})}),{type:"FeatureCollection",features};case"FeatureCollection":return points$$1.features=points$$1.features.filter(function(feature$$1){return feature$$1.geometry.type==="Point"}),points$$1;default:throw new Error("points must be a Point Collection")}}function planepoint(point4,triangle){var coord=getCoord(point4),geom=getGeom(triangle),coords=geom.coordinates,outer=coords[0];if(outer.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var properties=triangle.properties||{},a=properties.a,b=properties.b,c=properties.c,x2=coord[0],y2=coord[1],x12=outer[0][0],y12=outer[0][1],z1=a!==void 0?a:outer[0][2],x22=outer[1][0],y22=outer[1][1],z2=b!==void 0?b:outer[1][2],x3=outer[2][0],y3=outer[2][1],z3=c!==void 0?c:outer[2][2],z=(z3*(x2-x12)*(y2-y22)+z1*(x2-x22)*(y2-y3)+z2*(x2-x3)*(y2-y12)-z2*(x2-x12)*(y2-y3)-z3*(x2-x22)*(y2-y12)-z1*(x2-x3)*(y2-y22))/((x2-x12)*(y2-y22)+(x2-x22)*(y2-y3)+(x2-x3)*(y2-y12)-(x2-x12)*(y2-y3)-(x2-x22)*(y2-y12)-(x2-x3)*(y2-y22));return z}function kinks(featureIn){var coordinates,feature$$1,results={type:"FeatureCollection",features:[]};if(featureIn.type==="Feature"?feature$$1=featureIn.geometry:feature$$1=featureIn,feature$$1.type==="LineString")coordinates=[feature$$1.coordinates];else if(feature$$1.type==="MultiLineString")coordinates=feature$$1.coordinates;else if(feature$$1.type==="MultiPolygon")coordinates=[].concat.apply([],feature$$1.coordinates);else if(feature$$1.type==="Polygon")coordinates=feature$$1.coordinates;else throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");return coordinates.forEach(function(line1){coordinates.forEach(function(line2){for(var i=0;i<line1.length-1;i++)for(var k=i;k<line2.length-1;k++)if(!(line1===line2&&(Math.abs(i-k)===1||i===0&&k===line1.length-2&&line1[i][0]===line1[line1.length-1][0]&&line1[i][1]===line1[line1.length-1][1]))){var intersection9=lineIntersects(line1[i][0],line1[i][1],line1[i+1][0],line1[i+1][1],line2[k][0],line2[k][1],line2[k+1][0],line2[k+1][1]);intersection9&&results.features.push(point([intersection9[0],intersection9[1]]))}})}),results}function lineIntersects(line1StartX,line1StartY,line1EndX,line1EndY,line2StartX,line2StartY,line2EndX,line2EndY){var denominator,a,b,numerator1,numerator2,result={x:null,y:null,onLine1:!1,onLine2:!1};return denominator=(line2EndY-line2StartY)*(line1EndX-line1StartX)-(line2EndX-line2StartX)*(line1EndY-line1StartY),denominator===0?result.x!==null&&result.y!==null?result:!1:(a=line1StartY-line2StartY,b=line1StartX-line2StartX,numerator1=(line2EndX-line2StartX)*a-(line2EndY-line2StartY)*b,numerator2=(line1EndX-line1StartX)*a-(line1EndY-line1StartY)*b,a=numerator1/denominator,b=numerator2/denominator,result.x=line1StartX+a*(line1EndX-line1StartX),result.y=line1StartY+a*(line1EndY-line1StartY),a>=0&&a<=1&&(result.onLine1=!0),b>=0&&b<=1&&(result.onLine2=!0),result.onLine1&&result.onLine2?[result.x,result.y]:!1)}function pointOnFeature(geojson){for(var fc=normalize$1(geojson),cent=center(fc),onSurface=!1,i=0;!onSurface&&i<fc.features.length;){var geom=fc.features[i].geometry,x2,y2,x12,y12,x22,y22,k,onLine=!1;if(geom.type==="Point")cent.geometry.coordinates[0]===geom.coordinates[0]&&cent.geometry.coordinates[1]===geom.coordinates[1]&&(onSurface=!0);else if(geom.type==="MultiPoint"){var onMultiPoint=!1;for(k=0;!onMultiPoint&&k<geom.coordinates.length;)cent.geometry.coordinates[0]===geom.coordinates[k][0]&&cent.geometry.coordinates[1]===geom.coordinates[k][1]&&(onSurface=!0,onMultiPoint=!0),k++}else if(geom.type==="LineString")for(k=0;!onLine&&k<geom.coordinates.length-1;)x2=cent.geometry.coordinates[0],y2=cent.geometry.coordinates[1],x12=geom.coordinates[k][0],y12=geom.coordinates[k][1],x22=geom.coordinates[k+1][0],y22=geom.coordinates[k+1][1],pointOnSegment(x2,y2,x12,y12,x22,y22)&&(onLine=!0,onSurface=!0),k++;else if(geom.type==="MultiLineString")for(var j=0;j<geom.coordinates.length;){onLine=!1,k=0;for(var line=geom.coordinates[j];!onLine&&k<line.length-1;)x2=cent.geometry.coordinates[0],y2=cent.geometry.coordinates[1],x12=line[k][0],y12=line[k][1],x22=line[k+1][0],y22=line[k+1][1],pointOnSegment(x2,y2,x12,y12,x22,y22)&&(onLine=!0,onSurface=!0),k++;j++}else(geom.type==="Polygon"||geom.type==="MultiPolygon")&&booleanPointInPolygon(cent,geom)&&(onSurface=!0);i++}if(onSurface)return cent;var vertices=featureCollection([]);for(i=0;i<fc.features.length;i++)vertices.features=vertices.features.concat(explode(fc.features[i]).features);return point(nearestPoint(cent,vertices).geometry.coordinates)}function normalize$1(geojson){return geojson.type!=="FeatureCollection"?geojson.type!=="Feature"?featureCollection([feature(geojson)]):featureCollection([geojson]):geojson}function pointOnSegment(x2,y2,x12,y12,x22,y22){var ab2=Math.sqrt((x22-x12)*(x22-x12)+(y22-y12)*(y22-y12)),ap=Math.sqrt((x2-x12)*(x2-x12)+(y2-y12)*(y2-y12)),pb=Math.sqrt((x22-x2)*(x22-x2)+(y22-y2)*(y22-y2));return ab2===ap+pb}function area$1(geojson){return geomReduce(geojson,function(value,geom){return value+calculateArea(geom)},0)}var RADIUS=6378137;function calculateArea(geojson){var area5=0,i;switch(geojson.type){case"Polygon":return polygonArea(geojson.coordinates);case"MultiPolygon":for(i=0;i<geojson.coordinates.length;i++)area5+=polygonArea(geojson.coordinates[i]);return area5;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(i=0;i<geojson.geometries.length;i++)area5+=calculateArea(geojson.geometries[i]);return area5}}function polygonArea(coords){var area5=0;if(coords&&coords.length>0){area5+=Math.abs(ringArea(coords[0]));for(var i=1;i<coords.length;i++)area5-=Math.abs(ringArea(coords[i]))}return area5}function ringArea(coords){var p1,p2,p3,lowerIndex,middleIndex,upperIndex,i,area5=0,coordsLength=coords.length;if(coordsLength>2){for(i=0;i<coordsLength;i++)i===coordsLength-2?(lowerIndex=coordsLength-2,middleIndex=coordsLength-1,upperIndex=0):i===coordsLength-1?(lowerIndex=coordsLength-1,middleIndex=0,upperIndex=1):(lowerIndex=i,middleIndex=i+1,upperIndex=i+2),p1=coords[lowerIndex],p2=coords[middleIndex],p3=coords[upperIndex],area5+=(rad(p3[0])-rad(p1[0]))*Math.sin(rad(p2[1]));area5=area5*RADIUS*RADIUS/2}return area5}function rad(_){return _*Math.PI/180}function along(line,distance$$1,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var coords;if(line.type==="Feature")coords=line.geometry.coordinates;else if(line.type==="LineString")coords=line.coordinates;else throw new Error("input must be a LineString Feature or Geometry");if(!isNumber(distance$$1))throw new Error("distance must be a number");for(var travelled=0,i=0;i<coords.length&&!(distance$$1>=travelled&&i===coords.length-1);i++)if(travelled>=distance$$1){var overshot=distance$$1-travelled;if(overshot){var direction=bearing(coords[i],coords[i-1])-180,interpolated=destination(coords[i],overshot,direction,options);return interpolated}else return point(coords[i])}else travelled+=distance2(coords[i],coords[i+1],options);return point(coords[coords.length-1])}function length2(geojson,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");if(!geojson)throw new Error("geojson is required");return segmentReduce(geojson,function(previousValue,segment){var coords=segment.geometry.coordinates;return previousValue+distance2(coords[0],coords[1],options)},0)}function lineSlice(startPt,stopPt,line){var coords=getCoords(line);if(getType(line)!=="LineString")throw new Error("line must be a LineString");var startVertex=nearestPointOnLine(line,startPt),stopVertex=nearestPointOnLine(line,stopPt),ends;startVertex.properties.index<=stopVertex.properties.index?ends=[startVertex,stopVertex]:ends=[stopVertex,startVertex];for(var clipCoords=[ends[0].geometry.coordinates],i=ends[0].properties.index+1;i<ends[1].properties.index+1;i++)clipCoords.push(coords[i]);return clipCoords.push(ends[1].geometry.coordinates),lineString(clipCoords,line.properties)}function lineSliceAlong(line,startDist,stopDist,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var coords,slice2=[];if(line.type==="Feature")coords=line.geometry.coordinates;else if(line.type==="LineString")coords=line.coordinates;else throw new Error("input must be a LineString Feature or Geometry");for(var travelled=0,overshot,direction,interpolated,i=0;i<coords.length&&!(startDist>=travelled&&i===coords.length-1);i++){if(travelled>startDist&&slice2.length===0){if(overshot=startDist-travelled,!overshot)return slice2.push(coords[i]),lineString(slice2);direction=bearing(coords[i],coords[i-1])-180,interpolated=destination(coords[i],overshot,direction,options),slice2.push(interpolated.geometry.coordinates)}if(travelled>=stopDist)return overshot=stopDist-travelled,overshot?(direction=bearing(coords[i],coords[i-1])-180,interpolated=destination(coords[i],overshot,direction,options),slice2.push(interpolated.geometry.coordinates),lineString(slice2)):(slice2.push(coords[i]),lineString(slice2));if(travelled>=startDist&&slice2.push(coords[i]),i===coords.length-1)return lineString(slice2);travelled+=distance2(coords[i],coords[i+1],options)}return lineString(coords[coords.length-1])}function booleanPointOnLine(pt,line,options){options=options||{};var ignoreEndVertices=options.ignoreEndVertices;if(!isObject(options))throw new Error("invalid options");if(!pt)throw new Error("pt is required");if(!line)throw new Error("line is required");for(var ptCoords=getCoord(pt),lineCoords=getCoords(line),i=0;i<lineCoords.length-1;i++){var ignoreBoundary=!1;if(ignoreEndVertices&&(i===0&&(ignoreBoundary="start"),i===lineCoords.length-2&&(ignoreBoundary="end"),i===0&&i+1===lineCoords.length-1&&(ignoreBoundary="both")),isPointOnLineSegment$1(lineCoords[i],lineCoords[i+1],ptCoords,ignoreBoundary))return!0}return!1}function isPointOnLineSegment$1(lineSegmentStart,lineSegmentEnd,pt,excludeBoundary){var x2=pt[0],y2=pt[1],x12=lineSegmentStart[0],y12=lineSegmentStart[1],x22=lineSegmentEnd[0],y22=lineSegmentEnd[1],dxc=pt[0]-x12,dyc=pt[1]-y12,dxl=x22-x12,dyl=y22-y12,cross2=dxc*dyl-dyc*dxl;if(cross2!==0)return!1;if(excludeBoundary){if(excludeBoundary==="start")return Math.abs(dxl)>=Math.abs(dyl)?dxl>0?x12<x2&&x2<=x22:x22<=x2&&x2<x12:dyl>0?y12<y2&&y2<=y22:y22<=y2&&y2<y12;if(excludeBoundary==="end")return Math.abs(dxl)>=Math.abs(dyl)?dxl>0?x12<=x2&&x2<x22:x22<x2&&x2<=x12:dyl>0?y12<=y2&&y2<y22:y22<y2&&y2<=y12;if(excludeBoundary==="both")return Math.abs(dxl)>=Math.abs(dyl)?dxl>0?x12<x2&&x2<x22:x22<x2&&x2<x12:dyl>0?y12<y2&&y2<y22:y22<y2&&y2<y12}else return Math.abs(dxl)>=Math.abs(dyl)?dxl>0?x12<=x2&&x2<=x22:x22<=x2&&x2<=x12:dyl>0?y12<=y2&&y2<=y22:y22<=y2&&y2<=y12}function booleanWithin(feature1,feature2){var type1=getType(feature1),type2=getType(feature2),geom1=getGeom(feature1),geom2=getGeom(feature2);switch(type1){case"Point":switch(type2){case"MultiPoint":return isPointInMultiPoint(geom1,geom2);case"LineString":return booleanPointOnLine(geom1,geom2,{ignoreEndVertices:!0});case"Polygon":return booleanPointInPolygon(geom1,geom2,{ignoreBoundary:!0});default:throw new Error("feature2 "+type2+" geometry not supported")}case"MultiPoint":switch(type2){case"MultiPoint":return isMultiPointInMultiPoint(geom1,geom2);case"LineString":return isMultiPointOnLine(geom1,geom2);case"Polygon":return isMultiPointInPoly(geom1,geom2);default:throw new Error("feature2 "+type2+" geometry not supported")}case"LineString":switch(type2){case"LineString":return isLineOnLine(geom1,geom2);case"Polygon":return isLineInPoly(geom1,geom2);default:throw new Error("feature2 "+type2+" geometry not supported")}case"Polygon":switch(type2){case"Polygon":return isPolyInPoly(geom1,geom2);default:throw new Error("feature2 "+type2+" geometry not supported")}default:throw new Error("feature1 "+type1+" geometry not supported")}}function isPointInMultiPoint(point4,multiPoint2){var i,output=!1;for(i=0;i<multiPoint2.coordinates.length;i++)if(compareCoords(multiPoint2.coordinates[i],point4.coordinates)){output=!0;break}return output}function isMultiPointInMultiPoint(multiPoint1,multiPoint2){for(var i=0;i<multiPoint1.coordinates.length;i++){for(var anyMatch=!1,i2=0;i2<multiPoint2.coordinates.length;i2++)compareCoords(multiPoint1.coordinates[i],multiPoint2.coordinates[i2])&&(anyMatch=!0);if(!anyMatch)return!1}return!0}function isMultiPointOnLine(multiPoint2,lineString2){for(var foundInsidePoint=!1,i=0;i<multiPoint2.coordinates.length;i++){if(!booleanPointOnLine(multiPoint2.coordinates[i],lineString2))return!1;foundInsidePoint||(foundInsidePoint=booleanPointOnLine(multiPoint2.coordinates[i],lineString2,{ignoreEndVertices:!0}))}return foundInsidePoint}function isMultiPointInPoly(multiPoint2,polygon4){for(var output=!0,oneInside=!1,i=0;i<multiPoint2.coordinates.length;i++){var isInside2=booleanPointInPolygon(multiPoint2.coordinates[1],polygon4);if(!isInside2){output=!1;break}oneInside||(isInside2=booleanPointInPolygon(multiPoint2.coordinates[1],polygon4,{ignoreBoundary:!0}))}return output&&isInside2}function isLineOnLine(lineString1,lineString2){for(var i=0;i<lineString1.coordinates.length;i++)if(!booleanPointOnLine(lineString1.coordinates[i],lineString2))return!1;return!0}function isLineInPoly(linestring3,polygon4){var polyBbox=bbox(polygon4),lineBbox=bbox(linestring3);if(!doBBoxOverlap(polyBbox,lineBbox))return!1;for(var foundInsidePoint=!1,i=0;i<linestring3.coordinates.length-1;i++){if(!booleanPointInPolygon(linestring3.coordinates[i],polygon4))return!1;if(foundInsidePoint||(foundInsidePoint=booleanPointInPolygon(linestring3.coordinates[i],polygon4,{ignoreBoundary:!0})),!foundInsidePoint){var midpoint2=getMidpoint(linestring3.coordinates[i],linestring3.coordinates[i+1]);foundInsidePoint=booleanPointInPolygon(midpoint2,polygon4,{ignoreBoundary:!0})}}return foundInsidePoint}function isPolyInPoly(feature1,feature2){var poly1Bbox=bbox(feature1),poly2Bbox=bbox(feature2);if(!doBBoxOverlap(poly2Bbox,poly1Bbox))return!1;for(var i=0;i<feature1.coordinates[0].length;i++)if(!booleanPointInPolygon(feature1.coordinates[0][i],feature2))return!1;return!0}function doBBoxOverlap(bbox1,bbox2){return!(bbox1[0]>bbox2[0]||bbox1[2]<bbox2[2]||bbox1[1]>bbox2[1]||bbox1[3]<bbox2[3])}function compareCoords(pair1,pair2){return pair1[0]===pair2[0]&&pair1[1]===pair2[1]}function getMidpoint(pair1,pair2){return[(pair1[0]+pair2[0])/2,(pair1[1]+pair2[1])/2]}function pointGrid(bbox2,cellSide,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var mask2=options.mask,properties=options.properties,results=[];if(cellSide==null)throw new Error("cellSide is required");if(!isNumber(cellSide))throw new Error("cellSide is invalid");if(!bbox2)throw new Error("bbox is required");if(!Array.isArray(bbox2))throw new Error("bbox must be array");if(bbox2.length!==4)throw new Error("bbox must contain 4 numbers");if(mask2&&["Polygon","MultiPolygon"].indexOf(getType(mask2))===-1)throw new Error("options.mask must be a (Multi)Polygon");for(var west=bbox2[0],south=bbox2[1],east=bbox2[2],north=bbox2[3],xFraction=cellSide/distance2([west,south],[east,south],options),cellWidth=xFraction*(east-west),yFraction=cellSide/distance2([west,south],[west,north],options),cellHeight=yFraction*(north-south),bboxWidth=east-west,bboxHeight=north-south,columns=Math.floor(bboxWidth/cellWidth),rows=Math.floor(bboxHeight/cellHeight),deltaX=(bboxWidth-columns*cellWidth)/2,deltaY=(bboxHeight-rows*cellHeight)/2,currentX=west+deltaX;currentX<=east;){for(var currentY=south+deltaY;currentY<=north;){var cellPt=point([currentX,currentY],properties);mask2?booleanWithin(cellPt,mask2)&&results.push(cellPt):results.push(cellPt),currentY+=cellHeight}currentX+=cellWidth}return featureCollection(results)}function truncate(geojson,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var precision=options.precision,coordinates=options.coordinates,mutate=options.mutate;if(precision=precision==null||isNaN(precision)?6:precision,coordinates=coordinates==null||isNaN(coordinates)?3:coordinates,!geojson)throw new Error("<geojson> is required");if(typeof precision!="number")throw new Error("<precision> must be a number");if(typeof coordinates!="number")throw new Error("<coordinates> must be a number");(mutate===!1||mutate===void 0)&&(geojson=JSON.parse(JSON.stringify(geojson)));var factor=Math.pow(10,precision);return coordEach(geojson,function(coords){truncateCoords(coords,factor,coordinates)}),geojson}function truncateCoords(coords,factor,coordinates){coords.length>coordinates&&coords.splice(coordinates,coords.length);for(var i=0;i<coords.length;i++)coords[i]=Math.round(coords[i]*factor)/factor;return coords}function flatten(geojson){if(!geojson)throw new Error("geojson is required");var results=[];return flattenEach(geojson,function(feature$$1){results.push(feature$$1)}),featureCollection(results)}function lineChunk(geojson,segmentLength,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var units=options.units,reverse5=options.reverse;if(!geojson)throw new Error("geojson is required");if(segmentLength<=0)throw new Error("segmentLength must be greater than 0");var results=[];return flattenEach(geojson,function(feature$$1){reverse5&&(feature$$1.geometry.coordinates=feature$$1.geometry.coordinates.reverse()),sliceLineSegments(feature$$1,segmentLength,units,function(segment){results.push(segment)})}),featureCollection(results)}function sliceLineSegments(line,segmentLength,units,callback){var lineLength=length2(line,{units});if(lineLength<=segmentLength)return callback(line);var numberOfSegments=lineLength/segmentLength;Number.isInteger(numberOfSegments)||(numberOfSegments=Math.floor(numberOfSegments)+1);for(var i=0;i<numberOfSegments;i++){var outline=lineSliceAlong(line,segmentLength*i,segmentLength*(i+1),{units});callback(outline,i)}}var isects=function(feature$$1,filterFn,useSpatialIndex){if(feature$$1.geometry.type!=="Polygon")throw new Error("The input feature must be a Polygon");useSpatialIndex===void 0&&(useSpatialIndex=1);var coord=feature$$1.geometry.coordinates,output=[],seen={};if(useSpatialIndex){for(var allEdgesAsRbushTreeItems=[],ring0=0;ring0<coord.length;ring0++)for(var edge0=0;edge0<coord[ring0].length-1;edge0++)allEdgesAsRbushTreeItems.push(rbushTreeItem(ring0,edge0));var tree=rbush_1();tree.load(allEdgesAsRbushTreeItems)}for(var ringA=0;ringA<coord.length;ringA++)for(var edgeA=0;edgeA<coord[ringA].length-1;edgeA++)if(useSpatialIndex){var bboxOverlaps=tree.search(rbushTreeItem(ringA,edgeA));bboxOverlaps.forEach(function(bboxIsect){var ring12=bboxIsect.ring,edge12=bboxIsect.edge;ifIsectAddToOutput(ringA,edgeA,ring12,edge12)})}else for(var ring1=0;ring1<coord.length;ring1++)for(var edge1=0;edge1<coord[ring1].length-1;edge1++)ifIsectAddToOutput(ringA,edgeA,ring1,edge1);return filterFn||(output={type:"Feature",geometry:{type:"MultiPoint",coordinates:output}}),output;function ifIsectAddToOutput(ring02,edge02,ring12,edge12){var start0=coord[ring02][edge02],end0=coord[ring02][edge02+1],start1=coord[ring12][edge12],end1=coord[ring12][edge12+1],isect=intersect(start0,end0,start1,end1);if(isect!==null){var frac0,frac1;if(end0[0]!==start0[0]?frac0=(isect[0]-start0[0])/(end0[0]-start0[0]):frac0=(isect[1]-start0[1])/(end0[1]-start0[1]),end1[0]!==start1[0]?frac1=(isect[0]-start1[0])/(end1[0]-start1[0]):frac1=(isect[1]-start1[1])/(end1[1]-start1[1]),!(frac0>=1||frac0<=0||frac1>=1||frac1<=0)){var key=isect,unique=!seen[key];unique&&(seen[key]=!0),filterFn?output.push(filterFn(isect,ring02,edge02,start0,end0,frac0,ring12,edge12,start1,end1,frac1,unique)):output.push(isect)}}}function rbushTreeItem(ring,edge){var start2=coord[ring][edge],end=coord[ring][edge+1],minX2,maxX2,minY2,maxY2;return start2[0]<end[0]?(minX2=start2[0],maxX2=end[0]):(minX2=end[0],maxX2=start2[0]),start2[1]<end[1]?(minY2=start2[1],maxY2=end[1]):(minY2=end[1],maxY2=start2[1]),{minX:minX2,minY:minY2,maxX:maxX2,maxY:maxY2,ring,edge}}};function intersect(start0,end0,start1,end1){if(equalArrays$1(start0,start1)||equalArrays$1(start0,end1)||equalArrays$1(end0,start1)||equalArrays$1(end1,start1))return null;var x0=start0[0],y0=start0[1],x12=end0[0],y12=end0[1],x2=start1[0],y2=start1[1],x3=end1[0],y3=end1[1],denom=(x0-x12)*(y2-y3)-(y0-y12)*(x2-x3);if(denom===0)return null;var x4=((x0*y12-y0*x12)*(x2-x3)-(x0-x12)*(x2*y3-y2*x3))/denom,y4=((x0*y12-y0*x12)*(y2-y3)-(y0-y12)*(x2*y3-y2*x3))/denom;return[x4,y4]}function equalArrays$1(array1,array2){if(!array1||!array2||array1.length!==array2.length)return!1;for(var i=0,l=array1.length;i<l;i++)if(array1[i]instanceof Array&&array2[i]instanceof Array){if(!equalArrays$1(array1[i],array2[i]))return!1}else if(array1[i]!==array2[i])return!1;return!0}var simplepolygon=function(feature$$1){if(feature$$1.type!="Feature")throw new Error("The input must a geojson object of type Feature");if(feature$$1.geometry===void 0||feature$$1.geometry==null)throw new Error("The input must a geojson object with a non-empty geometry");if(feature$$1.geometry.type!="Polygon")throw new Error("The input must be a geojson Polygon");for(var numRings=feature$$1.geometry.coordinates.length,vertices=[],i=0;i<numRings;i++){var ring=feature$$1.geometry.coordinates[i];equalArrays(ring[0],ring[ring.length-1])||ring.push(ring[0]),vertices.push.apply(vertices,ring.slice(0,ring.length-1))}if(!isUnique(vertices))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var numvertices=vertices.length,selfIsectsData=isects(feature$$1,function(isect,ring0,edge0,start0,end0,frac0,ring1,edge1,start1,end1,frac1,unique){return[isect,ring0,edge0,start0,end0,frac0,ring1,edge1,start1,end1,frac1,unique]}),numSelfIsect=selfIsectsData.length;if(numSelfIsect==0){for(var outputFeatureArray=[],i=0;i<numRings;i++)outputFeatureArray.push(polygon([feature$$1.geometry.coordinates[i]],{parent:-1,winding:windingOfRing(feature$$1.geometry.coordinates[i])}));var output=featureCollection(outputFeatureArray);return determineParents(),setNetWinding(),output}for(var pseudoVtxListByRingAndEdge=[],isectList=[],i=0;i<numRings;i++){pseudoVtxListByRingAndEdge.push([]);for(var j=0;j<feature$$1.geometry.coordinates[i].length-1;j++)pseudoVtxListByRingAndEdge[i].push([new PseudoVtx(feature$$1.geometry.coordinates[i][(j+1).modulo(feature$$1.geometry.coordinates[i].length-1)],1,[i,j],[i,(j+1).modulo(feature$$1.geometry.coordinates[i].length-1)],void 0)]),isectList.push(new Isect(feature$$1.geometry.coordinates[i][j],[i,(j-1).modulo(feature$$1.geometry.coordinates[i].length-1)],[i,j],void 0,void 0,!1,!0))}for(var i=0;i<numSelfIsect;i++)pseudoVtxListByRingAndEdge[selfIsectsData[i][1]][selfIsectsData[i][2]].push(new PseudoVtx(selfIsectsData[i][0],selfIsectsData[i][5],[selfIsectsData[i][1],selfIsectsData[i][2]],[selfIsectsData[i][6],selfIsectsData[i][7]],void 0)),selfIsectsData[i][11]&&isectList.push(new Isect(selfIsectsData[i][0],[selfIsectsData[i][1],selfIsectsData[i][2]],[selfIsectsData[i][6],selfIsectsData[i][7]],void 0,void 0,!0,!0));for(var numIsect=isectList.length,i=0;i<pseudoVtxListByRingAndEdge.length;i++)for(var j=0;j<pseudoVtxListByRingAndEdge[i].length;j++)pseudoVtxListByRingAndEdge[i][j].sort(function(a,b){return a.param<b.param?-1:1});for(var allIsectsAsIsectRbushTreeItem=[],i=0;i<numIsect;i++)allIsectsAsIsectRbushTreeItem.push({minX:isectList[i].coord[0],minY:isectList[i].coord[1],maxX:isectList[i].coord[0],maxY:isectList[i].coord[1],index:i});var isectRbushTree=rbush_1();isectRbushTree.load(allIsectsAsIsectRbushTreeItem);for(var i=0;i<pseudoVtxListByRingAndEdge.length;i++)for(var j=0;j<pseudoVtxListByRingAndEdge[i].length;j++)for(var k=0;k<pseudoVtxListByRingAndEdge[i][j].length;k++){var coordToFind;k==pseudoVtxListByRingAndEdge[i][j].length-1?coordToFind=pseudoVtxListByRingAndEdge[i][(j+1).modulo(feature$$1.geometry.coordinates[i].length-1)][0].coord:coordToFind=pseudoVtxListByRingAndEdge[i][j][k+1].coord;var IsectRbushTreeItemFound=isectRbushTree.search({minX:coordToFind[0],minY:coordToFind[1],maxX:coordToFind[0],maxY:coordToFind[1]})[0];pseudoVtxListByRingAndEdge[i][j][k].nxtIsectAlongEdgeIn=IsectRbushTreeItemFound.index}for(var i=0;i<pseudoVtxListByRingAndEdge.length;i++)for(var j=0;j<pseudoVtxListByRingAndEdge[i].length;j++)for(var k=0;k<pseudoVtxListByRingAndEdge[i][j].length;k++){var coordToFind=pseudoVtxListByRingAndEdge[i][j][k].coord,IsectRbushTreeItemFound=isectRbushTree.search({minX:coordToFind[0],minY:coordToFind[1],maxX:coordToFind[0],maxY:coordToFind[1]})[0],l=IsectRbushTreeItemFound.index;l<numvertices?isectList[l].nxtIsectAlongRingAndEdge2=pseudoVtxListByRingAndEdge[i][j][k].nxtIsectAlongEdgeIn:equalArrays(isectList[l].ringAndEdge1,pseudoVtxListByRingAndEdge[i][j][k].ringAndEdgeIn)?isectList[l].nxtIsectAlongRingAndEdge1=pseudoVtxListByRingAndEdge[i][j][k].nxtIsectAlongEdgeIn:isectList[l].nxtIsectAlongRingAndEdge2=pseudoVtxListByRingAndEdge[i][j][k].nxtIsectAlongEdgeIn}for(var queue=[],i=0,j=0;j<numRings;j++){for(var leftIsect=i,k=0;k<feature$$1.geometry.coordinates[j].length-1;k++)isectList[i].coord[0]<isectList[leftIsect].coord[0]&&(leftIsect=i),i++;for(var isectAfterLeftIsect=isectList[leftIsect].nxtIsectAlongRingAndEdge2,k=0;k<isectList.length;k++)if(isectList[k].nxtIsectAlongRingAndEdge1==leftIsect||isectList[k].nxtIsectAlongRingAndEdge2==leftIsect){var isectBeforeLeftIsect=k;break}var windingAtIsect=isConvex([isectList[isectBeforeLeftIsect].coord,isectList[leftIsect].coord,isectList[isectAfterLeftIsect].coord],!0)?1:-1;queue.push({isect:leftIsect,parent:-1,winding:windingAtIsect})}queue.sort(function(a,b){return isectList[a.isect].coord>isectList[b.isect].coord?-1:1});for(var outputFeatureArray=[];queue.length>0;){var popped=queue.pop(),startIsect=popped.isect,currentOutputRingParent=popped.parent,currentOutputRingWinding=popped.winding,currentOutputRing=outputFeatureArray.length,currentOutputRingCoords=[isectList[startIsect].coord],currentIsect=startIsect;if(isectList[startIsect].ringAndEdge1Walkable)var walkingRingAndEdge=isectList[startIsect].ringAndEdge1,nxtIsect=isectList[startIsect].nxtIsectAlongRingAndEdge1;else var walkingRingAndEdge=isectList[startIsect].ringAndEdge2,nxtIsect=isectList[startIsect].nxtIsectAlongRingAndEdge2;for(;!equalArrays(isectList[startIsect].coord,isectList[nxtIsect].coord);){currentOutputRingCoords.push(isectList[nxtIsect].coord);for(var nxtIsectInQueue=void 0,i=0;i<queue.length;i++)if(queue[i].isect==nxtIsect){nxtIsectInQueue=i;break}if(nxtIsectInQueue!=null&&queue.splice(nxtIsectInQueue,1),equalArrays(walkingRingAndEdge,isectList[nxtIsect].ringAndEdge1)){if(walkingRingAndEdge=isectList[nxtIsect].ringAndEdge2,isectList[nxtIsect].ringAndEdge2Walkable=!1,isectList[nxtIsect].ringAndEdge1Walkable){var pushing={isect:nxtIsect};isConvex([isectList[currentIsect].coord,isectList[nxtIsect].coord,isectList[isectList[nxtIsect].nxtIsectAlongRingAndEdge2].coord],currentOutputRingWinding==1)?(pushing.parent=currentOutputRingParent,pushing.winding=-currentOutputRingWinding):(pushing.parent=currentOutputRing,pushing.winding=currentOutputRingWinding),queue.push(pushing)}currentIsect=nxtIsect,nxtIsect=isectList[nxtIsect].nxtIsectAlongRingAndEdge2}else{if(walkingRingAndEdge=isectList[nxtIsect].ringAndEdge1,isectList[nxtIsect].ringAndEdge1Walkable=!1,isectList[nxtIsect].ringAndEdge2Walkable){var pushing={isect:nxtIsect};isConvex([isectList[currentIsect].coord,isectList[nxtIsect].coord,isectList[isectList[nxtIsect].nxtIsectAlongRingAndEdge1].coord],currentOutputRingWinding==1)?(pushing.parent=currentOutputRingParent,pushing.winding=-currentOutputRingWinding):(pushing.parent=currentOutputRing,pushing.winding=currentOutputRingWinding),queue.push(pushing)}currentIsect=nxtIsect,nxtIsect=isectList[nxtIsect].nxtIsectAlongRingAndEdge1}}currentOutputRingCoords.push(isectList[nxtIsect].coord),outputFeatureArray.push(polygon([currentOutputRingCoords],{index:currentOutputRing,parent:currentOutputRingParent,winding:currentOutputRingWinding,netWinding:void 0}))}var output=featureCollection(outputFeatureArray);determineParents(),setNetWinding();function determineParents(){for(var featuresWithoutParent=[],i2=0;i2<output.features.length;i2++)output.features[i2].properties.parent==-1&&featuresWithoutParent.push(i2);if(featuresWithoutParent.length>1)for(var i2=0;i2<featuresWithoutParent.length;i2++){for(var parent=-1,parentArea=1/0,j2=0;j2<output.features.length;j2++)featuresWithoutParent[i2]!=j2&&booleanPointInPolygon(output.features[featuresWithoutParent[i2]].geometry.coordinates[0][0],output.features[j2],{ignoreBoundary:!0})&&area$1(output.features[j2])<parentArea&&(parent=j2);output.features[featuresWithoutParent[i2]].properties.parent=parent}}function setNetWinding(){for(var i2=0;i2<output.features.length;i2++)if(output.features[i2].properties.parent==-1){var netWinding=output.features[i2].properties.winding;output.features[i2].properties.netWinding=netWinding,setNetWindingOfChildren(i2,netWinding)}}function setNetWindingOfChildren(parent,ParentNetWinding){for(var i2=0;i2<output.features.length;i2++)if(output.features[i2].properties.parent==parent){var netWinding=ParentNetWinding+output.features[i2].properties.winding;output.features[i2].properties.netWinding=netWinding,setNetWindingOfChildren(i2,netWinding)}}return output},PseudoVtx=function(coord,param,ringAndEdgeIn,ringAndEdgeOut,nxtIsectAlongEdgeIn){this.coord=coord,this.param=param,this.ringAndEdgeIn=ringAndEdgeIn,this.ringAndEdgeOut=ringAndEdgeOut,this.nxtIsectAlongEdgeIn=nxtIsectAlongEdgeIn},Isect=function(coord,ringAndEdge1,ringAndEdge2,nxtIsectAlongRingAndEdge1,nxtIsectAlongRingAndEdge2,ringAndEdge1Walkable,ringAndEdge2Walkable){this.coord=coord,this.ringAndEdge1=ringAndEdge1,this.ringAndEdge2=ringAndEdge2,this.nxtIsectAlongRingAndEdge1=nxtIsectAlongRingAndEdge1,this.nxtIsectAlongRingAndEdge2=nxtIsectAlongRingAndEdge2,this.ringAndEdge1Walkable=ringAndEdge1Walkable,this.ringAndEdge2Walkable=ringAndEdge2Walkable};function isConvex(pts,righthanded){if(typeof righthanded>"u"&&(righthanded=!0),pts.length!=3)throw new Error("This function requires an array of three points [x,y]");var d=(pts[1][0]-pts[0][0])*(pts[2][1]-pts[0][1])-(pts[1][1]-pts[0][1])*(pts[2][0]-pts[0][0]);return d>=0==righthanded}function windingOfRing(ring){for(var leftVtx=0,i=0;i<ring.length-1;i++)ring[i][0]<ring[leftVtx][0]&&(leftVtx=i);if(isConvex([ring[(leftVtx-1).modulo(ring.length-1)],ring[leftVtx],ring[(leftVtx+1).modulo(ring.length-1)]],!0))var winding=1;else var winding=-1;return winding}function equalArrays(array1,array2){if(!array1||!array2||array1.length!=array2.length)return!1;for(var i=0,l=array1.length;i<l;i++)if(array1[i]instanceof Array&&array2[i]instanceof Array){if(!equalArrays(array1[i],array2[i]))return!1}else if(array1[i]!=array2[i])return!1;return!0}Number.prototype.modulo=function(n){return(this%n+n)%n};function isUnique(array){for(var u={},isUnique2=1,i=0,l=array.length;i<l;++i){if(u.hasOwnProperty(array[i])){isUnique2=0;break}u[array[i]]=1}return isUnique2}function unkinkPolygon(geojson){var features=[];return flattenEach(geojson,function(feature$$1){feature$$1.geometry.type==="Polygon"&&featureEach(simplepolygon(feature$$1),function(poly){features.push(polygon(poly.geometry.coordinates,feature$$1.properties))})}),featureCollection(features)}var D2R=Math.PI/180,R2D=180/Math.PI,Coord=function(lon2,lat2){this.lon=lon2,this.lat=lat2,this.x=D2R*lon2,this.y=D2R*lat2};Coord.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)};Coord.prototype.antipode=function(){var anti_lat=-1*this.lat,anti_lon=this.lon<0?180+this.lon:(180-this.lon)*-1;return new Coord(anti_lon,anti_lat)};var LineString=function(){this.coords=[],this.length=0};LineString.prototype.move_to=function(coord){this.length++,this.coords.push(coord)};var Arc=function(properties){this.properties=properties||{},this.geometries=[]};Arc.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(this.geometries.length===1)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var multiline=[],i=0;i<this.geometries.length;i++)multiline.push(this.geometries[i].coords);return{geometry:{type:"MultiLineString",coordinates:multiline},type:"Feature",properties:this.properties}};Arc.prototype.wkt=function(){for(var wkt_string="",wkt="LINESTRING(",collect2=function(c){wkt+=c[0]+" "+c[1]+","},i=0;i<this.geometries.length;i++){if(this.geometries[i].coords.length===0)return"LINESTRING(empty)";var coords=this.geometries[i].coords;coords.forEach(collect2),wkt_string+=wkt.substring(0,wkt.length-1)+")"}return wkt_string};var GreatCircle=function(start2,end,properties){if(!start2||start2.x===void 0||start2.y===void 0)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!end||end.x===void 0||end.y===void 0)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Coord(start2.x,start2.y),this.end=new Coord(end.x,end.y),this.properties=properties||{};var w=this.start.x-this.end.x,h=this.start.y-this.end.y,z=Math.pow(Math.sin(h/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(w/2),2);if(this.g=2*Math.asin(Math.sqrt(z)),this.g===Math.PI)throw new Error("it appears "+start2.view()+" and "+end.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+start2+" and "+end)};GreatCircle.prototype.interpolate=function(f){var A=Math.sin((1-f)*this.g)/Math.sin(this.g),B=Math.sin(f*this.g)/Math.sin(this.g),x2=A*Math.cos(this.start.y)*Math.cos(this.start.x)+B*Math.cos(this.end.y)*Math.cos(this.end.x),y2=A*Math.cos(this.start.y)*Math.sin(this.start.x)+B*Math.cos(this.end.y)*Math.sin(this.end.x),z=A*Math.sin(this.start.y)+B*Math.sin(this.end.y),lat2=R2D*Math.atan2(z,Math.sqrt(Math.pow(x2,2)+Math.pow(y2,2))),lon2=R2D*Math.atan2(y2,x2);return[lon2,lat2]};GreatCircle.prototype.Arc=function(npoints,options){var first_pass=[];if(!npoints||npoints<=2)first_pass.push([this.start.lon,this.start.lat]),first_pass.push([this.end.lon,this.end.lat]);else for(var delta2=1/(npoints-1),i=0;i<npoints;++i){var step=delta2*i,pair=this.interpolate(step);first_pass.push(pair)}for(var bHasBigDiff=!1,dfMaxSmallDiffLong=0,dfDateLineOffset=options&&options.offset?options.offset:10,dfLeftBorderX=180-dfDateLineOffset,dfRightBorderX=-180+dfDateLineOffset,dfDiffSpace=360-dfDateLineOffset,j=1;j<first_pass.length;++j){var dfPrevX=first_pass[j-1][0],dfX=first_pass[j][0],dfDiffLong=Math.abs(dfX-dfPrevX);dfDiffLong>dfDiffSpace&&(dfX>dfLeftBorderX&&dfPrevX<dfRightBorderX||dfPrevX>dfLeftBorderX&&dfX<dfRightBorderX)?bHasBigDiff=!0:dfDiffLong>dfMaxSmallDiffLong&&(dfMaxSmallDiffLong=dfDiffLong)}var poMulti=[];if(bHasBigDiff&&dfMaxSmallDiffLong<dfDateLineOffset){var poNewLS=[];poMulti.push(poNewLS);for(var k=0;k<first_pass.length;++k){var dfX0=parseFloat(first_pass[k][0]);if(k>0&&Math.abs(dfX0-first_pass[k-1][0])>dfDiffSpace){var dfX1=parseFloat(first_pass[k-1][0]),dfY1=parseFloat(first_pass[k-1][1]),dfX2=parseFloat(first_pass[k][0]),dfY2=parseFloat(first_pass[k][1]);if(dfX1>-180&&dfX1<dfRightBorderX&&dfX2===180&&k+1<first_pass.length&&first_pass[k-1][0]>-180&&first_pass[k-1][0]<dfRightBorderX){poNewLS.push([-180,first_pass[k][1]]),k++,poNewLS.push([first_pass[k][0],first_pass[k][1]]);continue}else if(dfX1>dfLeftBorderX&&dfX1<180&&dfX2===-180&&k+1<first_pass.length&&first_pass[k-1][0]>dfLeftBorderX&&first_pass[k-1][0]<180){poNewLS.push([180,first_pass[k][1]]),k++,poNewLS.push([first_pass[k][0],first_pass[k][1]]);continue}if(dfX1<dfRightBorderX&&dfX2>dfLeftBorderX){var tmpX=dfX1;dfX1=dfX2,dfX2=tmpX;var tmpY=dfY1;dfY1=dfY2,dfY2=tmpY}if(dfX1>dfLeftBorderX&&dfX2<dfRightBorderX&&(dfX2+=360),dfX1<=180&&dfX2>=180&&dfX1<dfX2){var dfRatio=(180-dfX1)/(dfX2-dfX1),dfY=dfRatio*dfY2+(1-dfRatio)*dfY1;poNewLS.push([first_pass[k-1][0]>dfLeftBorderX?180:-180,dfY]),poNewLS=[],poNewLS.push([first_pass[k-1][0]>dfLeftBorderX?-180:180,dfY]),poMulti.push(poNewLS)}else poNewLS=[],poMulti.push(poNewLS);poNewLS.push([dfX0,first_pass[k][1]])}else poNewLS.push([first_pass[k][0],first_pass[k][1]])}}else{var poNewLS0=[];poMulti.push(poNewLS0);for(var l=0;l<first_pass.length;++l)poNewLS0.push([first_pass[l][0],first_pass[l][1]])}for(var arc=new Arc(this.properties),m=0;m<poMulti.length;++m){var line=new LineString;arc.geometries.push(line);for(var points2=poMulti[m],j0=0;j0<points2.length;++j0)line.move_to(points2[j0])}return arc};function greatCircle(start2,end,options){if(options=options||{},typeof options!="object")throw new Error("options is invalid");var properties=options.properties,npoints=options.npoints,offset=options.offset;start2=getCoord(start2),end=getCoord(end),properties=properties||{},npoints=npoints||100,offset=offset||10;var generator=new GreatCircle({x:start2[0],y:start2[1]},{x:end[0],y:end[1]},properties),line=generator.Arc(npoints,{offset});return line.json()}function lineSplit(line,splitter){if(!line)throw new Error("line is required");if(!splitter)throw new Error("splitter is required");var lineType=getType(line),splitterType=getType(splitter);if(lineType!=="LineString")throw new Error("line must be LineString");if(splitterType==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(splitterType==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var truncatedSplitter=truncate(splitter,{precision:7});switch(splitterType){case"Point":return splitLineWithPoint(line,truncatedSplitter);case"MultiPoint":return splitLineWithPoints(line,truncatedSplitter);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return splitLineWithPoints(line,lineIntersect(line,truncatedSplitter))}}function splitLineWithPoints(line,splitter){var results=[],tree=geojsonRbush();return flattenEach(splitter,function(point$$1){if(results.forEach(function(feature$$1,index){feature$$1.id=index}),!results.length)results=splitLineWithPoint(line,point$$1).features,results.forEach(function(feature$$1){feature$$1.bbox||(feature$$1.bbox=square(bbox(feature$$1)))}),tree.load(featureCollection(results));else{var search=tree.search(point$$1);if(search.features.length){var closestLine=findClosestFeature(point$$1,search);results=results.filter(function(feature$$1){return feature$$1.id!==closestLine.id}),tree.remove(closestLine),featureEach(splitLineWithPoint(closestLine,point$$1),function(line2){results.push(line2),tree.insert(line2)})}}}),featureCollection(results)}function splitLineWithPoint(line,splitter){var results=[],startPoint=getCoords(line)[0],endPoint=getCoords(line)[line.geometry.coordinates.length-1];if(pointsEquals(startPoint,getCoord(splitter))||pointsEquals(endPoint,getCoord(splitter)))return featureCollection([line]);var tree=geojsonRbush(),segments=lineSegment(line);tree.load(segments);var search=tree.search(splitter);if(!search.features.length)return featureCollection([line]);var closestSegment=findClosestFeature(splitter,search),initialValue=[startPoint],lastCoords=featureReduce(segments,function(previous,current,index){var currentCoords=getCoords(current)[1],splitterCoords=getCoord(splitter);return index===closestSegment.id?(previous.push(splitterCoords),results.push(lineString(previous)),pointsEquals(splitterCoords,currentCoords)?[splitterCoords]:[splitterCoords,currentCoords]):(previous.push(currentCoords),previous)},initialValue);return lastCoords.length>1&&results.push(lineString(lastCoords)),featureCollection(results)}function findClosestFeature(point$$1,lines){if(!lines.features.length)throw new Error("lines must contain features");if(lines.features.length===1)return lines.features[0];var closestFeature,closestDistance=1/0;return featureEach(lines,function(segment){var pt=nearestPointOnLine(segment,point$$1),dist2=pt.properties.dist;dist2<closestDistance&&(closestFeature=segment,closestDistance=dist2)}),closestFeature}function pointsEquals(pt1,pt2){return pt1[0]===pt2[0]&&pt1[1]===pt2[1]}function lineArc(center2,radius,bearing1,bearing2,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var steps=options.steps,units=options.units;if(!center2)throw new Error("center is required");if(!radius)throw new Error("radius is required");if(bearing1==null)throw new Error("bearing1 is required");if(bearing2==null)throw new Error("bearing2 is required");if(typeof options!="object")throw new Error("options must be an object");steps=steps||64;var angle1=convertAngleTo360(bearing1),angle22=convertAngleTo360(bearing2),properties=center2.properties;if(angle1===angle22)return lineString(circle(center2,radius,options).geometry.coordinates[0],properties);for(var arcStartDegree=angle1,arcEndDegree=angle1<angle22?angle22:angle22+360,alfa=arcStartDegree,coordinates=[],i=0;alfa<arcEndDegree;)coordinates.push(destination(center2,radius,alfa,units).geometry.coordinates),i++,alfa=arcStartDegree+i*360/steps;return alfa>arcEndDegree&&coordinates.push(destination(center2,radius,arcEndDegree,units).geometry.coordinates),lineString(coordinates,properties)}function convertAngleTo360(alfa){var beta=alfa%360;return beta<0&&(beta+=360),beta}function polygonToLine(polygon$$1,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var properties=options.properties,geom=getType(polygon$$1),coords=getCoords(polygon$$1);if(properties=properties||polygon$$1.properties||{},!coords.length)throw new Error("polygon must contain coordinates");switch(geom){case"Polygon":return coordsToLine(coords,properties);case"MultiPolygon":var lines=[];return coords.forEach(function(coord){lines.push(coordsToLine(coord,properties))}),featureCollection(lines);default:throw new Error("geom "+geom+" not supported")}}function coordsToLine(coords,properties){return coords.length>1?multiLineString(coords,properties):lineString(coords[0],properties)}function lineToPolygon(lines,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var properties=options.properties,autoComplete=options.autoComplete,orderCoords=options.orderCoords;if(!lines)throw new Error("lines is required");autoComplete=autoComplete!==void 0?autoComplete:!0,orderCoords=orderCoords!==void 0?orderCoords:!0;var type=getType(lines);switch(type){case"FeatureCollection":case"GeometryCollection":var coords=[],features=lines.features?lines.features:lines.geometries;return features.forEach(function(line){coords.push(getCoords(lineStringToPolygon(line,{},autoComplete,orderCoords)))}),multiPolygon(coords,properties)}return lineStringToPolygon(lines,properties,autoComplete,orderCoords)}function lineStringToPolygon(line,properties,autoComplete,orderCoords){properties=properties||line.properties||{};var coords=getCoords(line),type=getType(line);if(!coords.length)throw new Error("line must contain coordinates");switch(type){case"LineString":return autoComplete&&(coords=autoCompleteCoords(coords)),polygon([coords],properties);case"MultiLineString":var multiCoords=[],largestArea=0;return coords.forEach(function(coord){if(autoComplete&&(coord=autoCompleteCoords(coord)),orderCoords){var area5=calculateArea$1(bbox(lineString(coord)));area5>largestArea?(multiCoords.unshift(coord),largestArea=area5):multiCoords.push(coord)}else multiCoords.push(coord)}),polygon(multiCoords,properties);default:throw new Error("geometry type "+type+" is not supported")}}function autoCompleteCoords(coords){var first=coords[0],x12=first[0],y12=first[1],last=coords[coords.length-1],x2=last[0],y2=last[1];return(x12!==x2||y12!==y2)&&coords.push(first),coords}function calculateArea$1(bbox$$1){var west=bbox$$1[0],south=bbox$$1[1],east=bbox$$1[2],north=bbox$$1[3];return Math.abs(west-east)*Math.abs(south-north)}var lineclip_1=lineclip;lineclip.polyline=lineclip;lineclip.polygon=polygonclip;function lineclip(points2,bbox2,result){var len=points2.length,codeA=bitCode(points2[0],bbox2),part=[],i,a,b,codeB,lastCode;for(result||(result=[]),i=1;i<len;i++){for(a=points2[i-1],b=points2[i],codeB=lastCode=bitCode(b,bbox2);;)if(codeA|codeB){if(codeA&codeB)break;codeA?(a=intersect$1(a,b,codeA,bbox2),codeA=bitCode(a,bbox2)):(b=intersect$1(a,b,codeB,bbox2),codeB=bitCode(b,bbox2))}else{part.push(a),codeB!==lastCode?(part.push(b),i<len-1&&(result.push(part),part=[])):i===len-1&&part.push(b);break}codeA=lastCode}return part.length&&result.push(part),result}function polygonclip(points2,bbox2){var result,edge,prev,prevInside,i,p,inside3;for(edge=1;edge<=8;edge*=2){for(result=[],prev=points2[points2.length-1],prevInside=!(bitCode(prev,bbox2)&edge),i=0;i<points2.length;i++)p=points2[i],inside3=!(bitCode(p,bbox2)&edge),inside3!==prevInside&&result.push(intersect$1(prev,p,edge,bbox2)),inside3&&result.push(p),prev=p,prevInside=inside3;if(points2=result,!points2.length)break}return result}function intersect$1(a,b,edge,bbox2){return edge&8?[a[0]+(b[0]-a[0])*(bbox2[3]-a[1])/(b[1]-a[1]),bbox2[3]]:edge&4?[a[0]+(b[0]-a[0])*(bbox2[1]-a[1])/(b[1]-a[1]),bbox2[1]]:edge&2?[bbox2[2],a[1]+(b[1]-a[1])*(bbox2[2]-a[0])/(b[0]-a[0])]:edge&1?[bbox2[0],a[1]+(b[1]-a[1])*(bbox2[0]-a[0])/(b[0]-a[0])]:null}function bitCode(p,bbox2){var code=0;return p[0]<bbox2[0]?code|=1:p[0]>bbox2[2]&&(code|=2),p[1]<bbox2[1]?code|=4:p[1]>bbox2[3]&&(code|=8),code}function bboxClip(feature$$1,bbox2){var geom=getGeom$1(feature$$1),coords=getCoords(feature$$1),properties=feature$$1.properties;switch(geom){case"LineString":case"MultiLineString":var lines=[];return geom==="LineString"&&(coords=[coords]),coords.forEach(function(line){lineclip_1(line,bbox2,lines)}),lines.length===1?lineString(lines[0],properties):multiLineString(lines,properties);case"Polygon":return polygon(clipPolygon(coords,bbox2),properties);case"MultiPolygon":return multiPolygon(coords.map(function(polygon$$1){return clipPolygon(polygon$$1,bbox2)}),properties);default:throw new Error("geometry "+geom+" not supported")}}function clipPolygon(rings,bbox2){for(var outRings=[],i=0;i<rings.length;i++){var clipped=lineclip_1.polygon(rings[i],bbox2);clipped.length>0&&((clipped[0][0]!==clipped[clipped.length-1][0]||clipped[0][1]!==clipped[clipped.length-1][1])&&clipped.push(clipped[0]),clipped.length>=4&&outRings.push(clipped))}return outRings}function getGeom$1(feature$$1){return feature$$1.geometry?feature$$1.geometry.type:feature$$1.type}var pSlice=Array.prototype.slice;function isArguments(object2){return Object.prototype.toString.call(object2)==="[object Arguments]"}function deepEqual(actual,expected,opts){return opts||(opts={}),actual===expected?!0:actual instanceof Date&&expected instanceof Date?actual.getTime()===expected.getTime():!actual||!expected||typeof actual!="object"&&typeof expected!="object"?(opts.strict,actual===expected):objEquiv(actual,expected,opts)}function isUndefinedOrNull(value){return value==null}function isBuffer(x2){return!(!x2||typeof x2!="object"||typeof x2.length!="number"||typeof x2.copy!="function"||typeof x2.slice!="function"||x2.length>0&&typeof x2[0]!="number")}function objEquiv(a,b,opts){var i,key;if(isUndefinedOrNull(a)||isUndefinedOrNull(b)||a.prototype!==b.prototype)return!1;if(isArguments(a))return isArguments(b)?(a=pSlice.call(a),b=pSlice.call(b),deepEqual(a,b,opts)):!1;if(isBuffer(a)){if(!isBuffer(b)||a.length!==b.length)return!1;for(i=0;i<a.length;i++)if(a[i]!==b[i])return!1;return!0}try{var ka=Object.keys(a),kb=Object.keys(b)}catch{return!1}if(ka.length!==kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!==kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!deepEqual(a[key],b[key],opts))return!1;return typeof a==typeof b}function lineOverlap(line1,line2,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var tolerance=options.tolerance||0,features=[],tree=geojsonRbush();tree.load(lineSegment(line1));var overlapSegment;return segmentEach(line2,function(segment){var doesOverlaps=!1;featureEach(tree.search(segment),function(match){if(doesOverlaps===!1){var coordsSegment=getCoords(segment).sort(),coordsMatch=getCoords(match).sort();deepEqual(coordsSegment,coordsMatch)||(tolerance===0?booleanPointOnLine(coordsSegment[0],match)&&booleanPointOnLine(coordsSegment[1],match):nearestPointOnLine(match,coordsSegment[0]).properties.dist<=tolerance&&nearestPointOnLine(match,coordsSegment[1]).properties.dist<=tolerance)?(doesOverlaps=!0,overlapSegment?overlapSegment=concatSegment(overlapSegment,segment):overlapSegment=segment):(tolerance===0?booleanPointOnLine(coordsMatch[0],segment)&&booleanPointOnLine(coordsMatch[1],segment):nearestPointOnLine(segment,coordsMatch[0]).properties.dist<=tolerance&&nearestPointOnLine(segment,coordsMatch[1]).properties.dist<=tolerance)&&(overlapSegment?overlapSegment=concatSegment(overlapSegment,match):overlapSegment=match)}}),doesOverlaps===!1&&overlapSegment&&(features.push(overlapSegment),overlapSegment=void 0)}),overlapSegment&&features.push(overlapSegment),featureCollection(features)}function concatSegment(line,segment){var coords=getCoords(segment),lineCoords=getCoords(line),start2=lineCoords[0],end=lineCoords[lineCoords.length-1],geom=line.geometry.coordinates;return deepEqual(coords[0],start2)?geom.unshift(coords[1]):deepEqual(coords[0],end)?geom.push(coords[1]):deepEqual(coords[1],start2)?geom.unshift(coords[0]):deepEqual(coords[1],end)&&geom.push(coords[0]),line}function sector(center2,radius,bearing1,bearing2,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");if(!center2)throw new Error("center is required");if(bearing1==null)throw new Error("bearing1 is required");if(bearing2==null)throw new Error("bearing2 is required");if(!radius)throw new Error("radius is required");if(typeof options!="object")throw new Error("options must be an object");if(convertAngleTo360$1(bearing1)===convertAngleTo360$1(bearing2))return circle(center2,radius,options);var coords=getCoords(center2),arc=lineArc(center2,radius,bearing1,bearing2,options),sliceCoords=[[coords]];return coordEach(arc,function(currentCoords){sliceCoords[0].push(currentCoords)}),sliceCoords[0].push(coords),polygon(sliceCoords)}function convertAngleTo360$1(alfa){var beta=alfa%360;return beta<0&&(beta+=360),beta}function rhumbDestination(origin,distance12,bearing2,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var units=options.units,properties=options.properties;if(!origin)throw new Error("origin is required");if(distance12==null)throw new Error("distance is required");if(bearing2==null)throw new Error("bearing is required");if(!(distance12>=0))throw new Error("distance must be greater than 0");var distanceInMeters=convertLength(distance12,units,"meters"),coords=getCoord(origin),destination2=calculateRhumbDestination(coords,distanceInMeters,bearing2);return destination2[0]+=destination2[0]-coords[0]>180?-360:coords[0]-destination2[0]>180?360:0,point(destination2,properties)}function calculateRhumbDestination(origin,distance12,bearing2,radius){radius=radius===void 0?earthRadius:Number(radius);var delta2=distance12/radius,lambda1=origin[0]*Math.PI/180,phi1=degreesToRadians(origin[1]),theta=degreesToRadians(bearing2),DeltaPhi=delta2*Math.cos(theta),phi2=phi1+DeltaPhi;Math.abs(phi2)>Math.PI/2&&(phi2=phi2>0?Math.PI-phi2:-Math.PI-phi2);var DeltaPsi=Math.log(Math.tan(phi2/2+Math.PI/4)/Math.tan(phi1/2+Math.PI/4)),q=Math.abs(DeltaPsi)>1e-11?DeltaPhi/DeltaPsi:Math.cos(phi1),DeltaLambda=delta2*Math.sin(theta)/q,lambda2=lambda1+DeltaLambda;return[(lambda2*180/Math.PI+540)%360-180,phi2*180/Math.PI]}function polygonTangents(pt,polygon$$1){var pointCoords=getCoords(pt),polyCoords=getCoords(polygon$$1),rtan,ltan,enext,eprev,type=getType(polygon$$1);switch(type){case"Polygon":rtan=polyCoords[0][0],ltan=polyCoords[0][0],eprev=isLeft(polyCoords[0][0],polyCoords[0][polyCoords[0].length-1],pointCoords);var out=processPolygon$1(polyCoords[0],pointCoords,eprev,enext,rtan,ltan);rtan=out[0],ltan=out[1];break;case"MultiPolygon":rtan=polyCoords[0][0][0],ltan=polyCoords[0][0][0],eprev=isLeft(polyCoords[0][0][0],polyCoords[0][0][polyCoords[0][0].length-1],pointCoords),polyCoords.forEach(function(ring){var out2=processPolygon$1(ring[0],pointCoords,eprev,enext,rtan,ltan);rtan=out2[0],ltan=out2[1]});break}return featureCollection([point(rtan),point(ltan)])}function processPolygon$1(polygonCoords,ptCoords,eprev,enext,rtan,ltan){for(var i=0;i<polygonCoords.length;i++){var currentCoords=polygonCoords[i],nextCoordPair=polygonCoords[i+1];i===polygonCoords.length-1&&(nextCoordPair=polygonCoords[0]),enext=isLeft(currentCoords,nextCoordPair,ptCoords),eprev<=0&&enext>0?isBelow(ptCoords,currentCoords,rtan)||(rtan=currentCoords):eprev>0&&enext<=0&&(isAbove(ptCoords,currentCoords,ltan)||(ltan=currentCoords)),eprev=enext}return[rtan,ltan]}function isAbove(point1,point22,point32){return isLeft(point1,point22,point32)>0}function isBelow(point1,point22,point32){return isLeft(point1,point22,point32)<0}function isLeft(point1,point22,point32){return(point22[0]-point1[0])*(point32[1]-point1[1])-(point32[0]-point1[0])*(point22[1]-point1[1])}function booleanClockwise(line){if(!line)throw new Error("line is required");var type=line.geometry?line.geometry.type:line.type;if(!Array.isArray(line)&&type!=="LineString")throw new Error("geometry must be a LineString");for(var ring=getCoords(line),sum=0,i=1,prev,cur;i<ring.length;)prev=cur||ring[0],cur=ring[i],sum+=(cur[0]-prev[0])*(cur[1]+prev[1]),i++;return sum>0}function rewind(geojson,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var reverse5=options.reverse||!1,mutate=options.mutate||!1;if(!geojson)throw new Error("<geojson> is required");if(typeof reverse5!="boolean")throw new Error("<reverse> must be a boolean");if(typeof mutate!="boolean")throw new Error("<mutate> must be a boolean");mutate===!1&&(geojson=clone2(geojson));var results=[];switch(geojson.type){case"GeometryCollection":return geomEach(geojson,function(geometry$$1){rewindFeature(geometry$$1,reverse5)}),geojson;case"FeatureCollection":return featureEach(geojson,function(feature$$1){featureEach(rewindFeature(feature$$1,reverse5),function(result){results.push(result)})}),featureCollection(results)}return rewindFeature(geojson,reverse5)}function rewindFeature(geojson,reverse5){var type=geojson.type==="Feature"?geojson.geometry.type:geojson.type;switch(type){case"GeometryCollection":return geomEach(geojson,function(geometry$$1){rewindFeature(geometry$$1,reverse5)}),geojson;case"LineString":return rewindLineString(getCoords(geojson),reverse5),geojson;case"Polygon":return rewindPolygon(getCoords(geojson),reverse5),geojson;case"MultiLineString":return getCoords(geojson).forEach(function(lineCoords){rewindLineString(lineCoords,reverse5)}),geojson;case"MultiPolygon":return getCoords(geojson).forEach(function(lineCoords){rewindPolygon(lineCoords,reverse5)}),geojson;case"Point":case"MultiPoint":return geojson}}function rewindLineString(coords,reverse5){booleanClockwise(coords)===reverse5&&coords.reverse()}function rewindPolygon(coords,reverse5){booleanClockwise(coords[0])!==reverse5&&coords[0].reverse();for(var i=1;i<coords.length;i++)booleanClockwise(coords[i])===reverse5&&coords[i].reverse()}function gridToMatrix$1(grid,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var zProperty=options.zProperty||"elevation",flip4=options.flip,flags=options.flags;collectionOf(grid,"Point","input must contain Points");for(var pointsMatrix=sortPointsByLatLng$1(grid,flip4),matrix=[],r=0;r<pointsMatrix.length;r++){for(var pointRow=pointsMatrix[r],row=[],c=0;c<pointRow.length;c++){var point$$1=pointRow[c];point$$1.properties[zProperty]?row.push(point$$1.properties[zProperty]):row.push(0),flags===!0&&(point$$1.properties.matrixPosition=[r,c])}matrix.push(row)}return matrix}function sortPointsByLatLng$1(points$$1,flip4){var pointsByLatitude={};featureEach(points$$1,function(point$$1){var lat2=getCoords(point$$1)[1];pointsByLatitude[lat2]||(pointsByLatitude[lat2]=[]),pointsByLatitude[lat2].push(point$$1)});var orderedRowsByLatitude=Object.keys(pointsByLatitude).map(function(lat2){var row=pointsByLatitude[lat2],rowOrderedByLongitude=row.sort(function(a,b){return getCoords(a)[0]-getCoords(b)[0]});return rowOrderedByLongitude}),pointMatrix=orderedRowsByLatitude.sort(function(a,b){return flip4?getCoords(a[0])[1]-getCoords(b[0])[1]:getCoords(b[0])[1]-getCoords(a[0])[1]});return pointMatrix}/*!
 * @license GNU Affero General Public License.
 * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 * v. 1.2.0
 * https://github.com/RaumZeit/MarchingSquares.js
 */var defaultSettings$1={successCallback:null,verbose:!1,polygons:!1},settings$1={};function isoBands(data,minV,bandwidth,options){options=options||{};for(var optionKeys=Object.keys(defaultSettings$1),i=0;i<optionKeys.length;i++){var key=optionKeys[i],val=options[key];val=typeof val<"u"&&val!==null?val:defaultSettings$1[key],settings$1[key]=val}settings$1.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+minV+":"+(minV+bandwidth)+"]");var grid=computeBandGrid(data,minV,bandwidth),ret;return settings$1.polygons?(settings$1.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),ret=BandGrid2Areas(grid)):(settings$1.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),ret=BandGrid2AreaPaths(grid)),typeof settings$1.successCallback=="function"&&settings$1.successCallback(ret),ret}var Node0=64,Node1=16,Node22=4,Node3=1,isoBandNextXTL=[],isoBandNextYTL=[],isoBandNextOTL=[],isoBandNextXTR=[],isoBandNextYTR=[],isoBandNextOTR=[],isoBandNextXRT=[],isoBandNextYRT=[],isoBandNextORT=[],isoBandNextXRB=[],isoBandNextYRB=[],isoBandNextORB=[],isoBandNextXBL=[],isoBandNextYBL=[],isoBandNextOBL=[],isoBandNextXBR=[],isoBandNextYBR=[],isoBandNextOBR=[],isoBandNextXLT=[],isoBandNextYLT=[],isoBandNextOLT=[],isoBandNextXLB=[],isoBandNextYLB=[],isoBandNextOLB=[];isoBandNextXRT[85]=isoBandNextXRB[85]=-1;isoBandNextYRT[85]=isoBandNextYRB[85]=0;isoBandNextORT[85]=isoBandNextORB[85]=1;isoBandNextXLT[85]=isoBandNextXLB[85]=1;isoBandNextYLT[85]=isoBandNextYLB[85]=0;isoBandNextOLT[85]=isoBandNextOLB[85]=1;isoBandNextXTL[85]=isoBandNextXTR[85]=0;isoBandNextYTL[85]=isoBandNextYTR[85]=-1;isoBandNextOTL[85]=isoBandNextOBL[85]=0;isoBandNextXBR[85]=isoBandNextXBL[85]=0;isoBandNextYBR[85]=isoBandNextYBL[85]=1;isoBandNextOTR[85]=isoBandNextOBR[85]=1;isoBandNextXLB[1]=isoBandNextXLB[169]=0;isoBandNextYLB[1]=isoBandNextYLB[169]=-1;isoBandNextOLB[1]=isoBandNextOLB[169]=0;isoBandNextXBL[1]=isoBandNextXBL[169]=-1;isoBandNextYBL[1]=isoBandNextYBL[169]=0;isoBandNextOBL[1]=isoBandNextOBL[169]=0;isoBandNextXRB[4]=isoBandNextXRB[166]=0;isoBandNextYRB[4]=isoBandNextYRB[166]=-1;isoBandNextORB[4]=isoBandNextORB[166]=1;isoBandNextXBR[4]=isoBandNextXBR[166]=1;isoBandNextYBR[4]=isoBandNextYBR[166]=0;isoBandNextOBR[4]=isoBandNextOBR[166]=0;isoBandNextXRT[16]=isoBandNextXRT[154]=0;isoBandNextYRT[16]=isoBandNextYRT[154]=1;isoBandNextORT[16]=isoBandNextORT[154]=1;isoBandNextXTR[16]=isoBandNextXTR[154]=1;isoBandNextYTR[16]=isoBandNextYTR[154]=0;isoBandNextOTR[16]=isoBandNextOTR[154]=1;isoBandNextXLT[64]=isoBandNextXLT[106]=0;isoBandNextYLT[64]=isoBandNextYLT[106]=1;isoBandNextOLT[64]=isoBandNextOLT[106]=0;isoBandNextXTL[64]=isoBandNextXTL[106]=-1;isoBandNextYTL[64]=isoBandNextYTL[106]=0;isoBandNextOTL[64]=isoBandNextOTL[106]=1;isoBandNextXLT[2]=isoBandNextXLT[168]=0;isoBandNextYLT[2]=isoBandNextYLT[168]=-1;isoBandNextOLT[2]=isoBandNextOLT[168]=1;isoBandNextXLB[2]=isoBandNextXLB[168]=0;isoBandNextYLB[2]=isoBandNextYLB[168]=-1;isoBandNextOLB[2]=isoBandNextOLB[168]=0;isoBandNextXBL[2]=isoBandNextXBL[168]=-1;isoBandNextYBL[2]=isoBandNextYBL[168]=0;isoBandNextOBL[2]=isoBandNextOBL[168]=0;isoBandNextXBR[2]=isoBandNextXBR[168]=-1;isoBandNextYBR[2]=isoBandNextYBR[168]=0;isoBandNextOBR[2]=isoBandNextOBR[168]=1;isoBandNextXRT[8]=isoBandNextXRT[162]=0;isoBandNextYRT[8]=isoBandNextYRT[162]=-1;isoBandNextORT[8]=isoBandNextORT[162]=0;isoBandNextXRB[8]=isoBandNextXRB[162]=0;isoBandNextYRB[8]=isoBandNextYRB[162]=-1;isoBandNextORB[8]=isoBandNextORB[162]=1;isoBandNextXBL[8]=isoBandNextXBL[162]=1;isoBandNextYBL[8]=isoBandNextYBL[162]=0;isoBandNextOBL[8]=isoBandNextOBL[162]=1;isoBandNextXBR[8]=isoBandNextXBR[162]=1;isoBandNextYBR[8]=isoBandNextYBR[162]=0;isoBandNextOBR[8]=isoBandNextOBR[162]=0;isoBandNextXRT[32]=isoBandNextXRT[138]=0;isoBandNextYRT[32]=isoBandNextYRT[138]=1;isoBandNextORT[32]=isoBandNextORT[138]=1;isoBandNextXRB[32]=isoBandNextXRB[138]=0;isoBandNextYRB[32]=isoBandNextYRB[138]=1;isoBandNextORB[32]=isoBandNextORB[138]=0;isoBandNextXTL[32]=isoBandNextXTL[138]=1;isoBandNextYTL[32]=isoBandNextYTL[138]=0;isoBandNextOTL[32]=isoBandNextOTL[138]=0;isoBandNextXTR[32]=isoBandNextXTR[138]=1;isoBandNextYTR[32]=isoBandNextYTR[138]=0;isoBandNextOTR[32]=isoBandNextOTR[138]=1;isoBandNextXLB[128]=isoBandNextXLB[42]=0;isoBandNextYLB[128]=isoBandNextYLB[42]=1;isoBandNextOLB[128]=isoBandNextOLB[42]=1;isoBandNextXLT[128]=isoBandNextXLT[42]=0;isoBandNextYLT[128]=isoBandNextYLT[42]=1;isoBandNextOLT[128]=isoBandNextOLT[42]=0;isoBandNextXTL[128]=isoBandNextXTL[42]=-1;isoBandNextYTL[128]=isoBandNextYTL[42]=0;isoBandNextOTL[128]=isoBandNextOTL[42]=1;isoBandNextXTR[128]=isoBandNextXTR[42]=-1;isoBandNextYTR[128]=isoBandNextYTR[42]=0;isoBandNextOTR[128]=isoBandNextOTR[42]=0;isoBandNextXRB[5]=isoBandNextXRB[165]=-1;isoBandNextYRB[5]=isoBandNextYRB[165]=0;isoBandNextORB[5]=isoBandNextORB[165]=0;isoBandNextXLB[5]=isoBandNextXLB[165]=1;isoBandNextYLB[5]=isoBandNextYLB[165]=0;isoBandNextOLB[5]=isoBandNextOLB[165]=0;isoBandNextXBR[20]=isoBandNextXBR[150]=0;isoBandNextYBR[20]=isoBandNextYBR[150]=1;isoBandNextOBR[20]=isoBandNextOBR[150]=1;isoBandNextXTR[20]=isoBandNextXTR[150]=0;isoBandNextYTR[20]=isoBandNextYTR[150]=-1;isoBandNextOTR[20]=isoBandNextOTR[150]=1;isoBandNextXRT[80]=isoBandNextXRT[90]=-1;isoBandNextYRT[80]=isoBandNextYRT[90]=0;isoBandNextORT[80]=isoBandNextORT[90]=1;isoBandNextXLT[80]=isoBandNextXLT[90]=1;isoBandNextYLT[80]=isoBandNextYLT[90]=0;isoBandNextOLT[80]=isoBandNextOLT[90]=1;isoBandNextXBL[65]=isoBandNextXBL[105]=0;isoBandNextYBL[65]=isoBandNextYBL[105]=1;isoBandNextOBL[65]=isoBandNextOBL[105]=0;isoBandNextXTL[65]=isoBandNextXTL[105]=0;isoBandNextYTL[65]=isoBandNextYTL[105]=-1;isoBandNextOTL[65]=isoBandNextOTL[105]=0;isoBandNextXRT[160]=isoBandNextXRT[10]=-1;isoBandNextYRT[160]=isoBandNextYRT[10]=0;isoBandNextORT[160]=isoBandNextORT[10]=1;isoBandNextXRB[160]=isoBandNextXRB[10]=-1;isoBandNextYRB[160]=isoBandNextYRB[10]=0;isoBandNextORB[160]=isoBandNextORB[10]=0;isoBandNextXLB[160]=isoBandNextXLB[10]=1;isoBandNextYLB[160]=isoBandNextYLB[10]=0;isoBandNextOLB[160]=isoBandNextOLB[10]=0;isoBandNextXLT[160]=isoBandNextXLT[10]=1;isoBandNextYLT[160]=isoBandNextYLT[10]=0;isoBandNextOLT[160]=isoBandNextOLT[10]=1;isoBandNextXBR[130]=isoBandNextXBR[40]=0;isoBandNextYBR[130]=isoBandNextYBR[40]=1;isoBandNextOBR[130]=isoBandNextOBR[40]=1;isoBandNextXBL[130]=isoBandNextXBL[40]=0;isoBandNextYBL[130]=isoBandNextYBL[40]=1;isoBandNextOBL[130]=isoBandNextOBL[40]=0;isoBandNextXTL[130]=isoBandNextXTL[40]=0;isoBandNextYTL[130]=isoBandNextYTL[40]=-1;isoBandNextOTL[130]=isoBandNextOTL[40]=0;isoBandNextXTR[130]=isoBandNextXTR[40]=0;isoBandNextYTR[130]=isoBandNextYTR[40]=-1;isoBandNextOTR[130]=isoBandNextOTR[40]=1;isoBandNextXRB[37]=isoBandNextXRB[133]=0;isoBandNextYRB[37]=isoBandNextYRB[133]=1;isoBandNextORB[37]=isoBandNextORB[133]=1;isoBandNextXLB[37]=isoBandNextXLB[133]=0;isoBandNextYLB[37]=isoBandNextYLB[133]=1;isoBandNextOLB[37]=isoBandNextOLB[133]=0;isoBandNextXTL[37]=isoBandNextXTL[133]=-1;isoBandNextYTL[37]=isoBandNextYTL[133]=0;isoBandNextOTL[37]=isoBandNextOTL[133]=0;isoBandNextXTR[37]=isoBandNextXTR[133]=1;isoBandNextYTR[37]=isoBandNextYTR[133]=0;isoBandNextOTR[37]=isoBandNextOTR[133]=0;isoBandNextXBR[148]=isoBandNextXBR[22]=-1;isoBandNextYBR[148]=isoBandNextYBR[22]=0;isoBandNextOBR[148]=isoBandNextOBR[22]=0;isoBandNextXLB[148]=isoBandNextXLB[22]=0;isoBandNextYLB[148]=isoBandNextYLB[22]=-1;isoBandNextOLB[148]=isoBandNextOLB[22]=1;isoBandNextXLT[148]=isoBandNextXLT[22]=0;isoBandNextYLT[148]=isoBandNextYLT[22]=1;isoBandNextOLT[148]=isoBandNextOLT[22]=1;isoBandNextXTR[148]=isoBandNextXTR[22]=-1;isoBandNextYTR[148]=isoBandNextYTR[22]=0;isoBandNextOTR[148]=isoBandNextOTR[22]=1;isoBandNextXRT[82]=isoBandNextXRT[88]=0;isoBandNextYRT[82]=isoBandNextYRT[88]=-1;isoBandNextORT[82]=isoBandNextORT[88]=1;isoBandNextXBR[82]=isoBandNextXBR[88]=1;isoBandNextYBR[82]=isoBandNextYBR[88]=0;isoBandNextOBR[82]=isoBandNextOBR[88]=1;isoBandNextXBL[82]=isoBandNextXBL[88]=-1;isoBandNextYBL[82]=isoBandNextYBL[88]=0;isoBandNextOBL[82]=isoBandNextOBL[88]=1;isoBandNextXLT[82]=isoBandNextXLT[88]=0;isoBandNextYLT[82]=isoBandNextYLT[88]=-1;isoBandNextOLT[82]=isoBandNextOLT[88]=0;isoBandNextXRT[73]=isoBandNextXRT[97]=0;isoBandNextYRT[73]=isoBandNextYRT[97]=1;isoBandNextORT[73]=isoBandNextORT[97]=0;isoBandNextXRB[73]=isoBandNextXRB[97]=0;isoBandNextYRB[73]=isoBandNextYRB[97]=-1;isoBandNextORB[73]=isoBandNextORB[97]=0;isoBandNextXBL[73]=isoBandNextXBL[97]=1;isoBandNextYBL[73]=isoBandNextYBL[97]=0;isoBandNextOBL[73]=isoBandNextOBL[97]=0;isoBandNextXTL[73]=isoBandNextXTL[97]=1;isoBandNextYTL[73]=isoBandNextYTL[97]=0;isoBandNextOTL[73]=isoBandNextOTL[97]=1;isoBandNextXRT[145]=isoBandNextXRT[25]=0;isoBandNextYRT[145]=isoBandNextYRT[25]=-1;isoBandNextORT[145]=isoBandNextORT[25]=0;isoBandNextXBL[145]=isoBandNextXBL[25]=1;isoBandNextYBL[145]=isoBandNextYBL[25]=0;isoBandNextOBL[145]=isoBandNextOBL[25]=1;isoBandNextXLB[145]=isoBandNextXLB[25]=0;isoBandNextYLB[145]=isoBandNextYLB[25]=1;isoBandNextOLB[145]=isoBandNextOLB[25]=1;isoBandNextXTR[145]=isoBandNextXTR[25]=-1;isoBandNextYTR[145]=isoBandNextYTR[25]=0;isoBandNextOTR[145]=isoBandNextOTR[25]=0;isoBandNextXRB[70]=isoBandNextXRB[100]=0;isoBandNextYRB[70]=isoBandNextYRB[100]=1;isoBandNextORB[70]=isoBandNextORB[100]=0;isoBandNextXBR[70]=isoBandNextXBR[100]=-1;isoBandNextYBR[70]=isoBandNextYBR[100]=0;isoBandNextOBR[70]=isoBandNextOBR[100]=1;isoBandNextXLT[70]=isoBandNextXLT[100]=0;isoBandNextYLT[70]=isoBandNextYLT[100]=-1;isoBandNextOLT[70]=isoBandNextOLT[100]=1;isoBandNextXTL[70]=isoBandNextXTL[100]=1;isoBandNextYTL[70]=isoBandNextYTL[100]=0;isoBandNextOTL[70]=isoBandNextOTL[100]=0;isoBandNextXRB[101]=isoBandNextXRB[69]=0;isoBandNextYRB[101]=isoBandNextYRB[69]=1;isoBandNextORB[101]=isoBandNextORB[69]=0;isoBandNextXTL[101]=isoBandNextXTL[69]=1;isoBandNextYTL[101]=isoBandNextYTL[69]=0;isoBandNextOTL[101]=isoBandNextOTL[69]=0;isoBandNextXLB[149]=isoBandNextXLB[21]=0;isoBandNextYLB[149]=isoBandNextYLB[21]=1;isoBandNextOLB[149]=isoBandNextOLB[21]=1;isoBandNextXTR[149]=isoBandNextXTR[21]=-1;isoBandNextYTR[149]=isoBandNextYTR[21]=0;isoBandNextOTR[149]=isoBandNextOTR[21]=0;isoBandNextXBR[86]=isoBandNextXBR[84]=-1;isoBandNextYBR[86]=isoBandNextYBR[84]=0;isoBandNextOBR[86]=isoBandNextOBR[84]=1;isoBandNextXLT[86]=isoBandNextXLT[84]=0;isoBandNextYLT[86]=isoBandNextYLT[84]=-1;isoBandNextOLT[86]=isoBandNextOLT[84]=1;isoBandNextXRT[89]=isoBandNextXRT[81]=0;isoBandNextYRT[89]=isoBandNextYRT[81]=-1;isoBandNextORT[89]=isoBandNextORT[81]=0;isoBandNextXBL[89]=isoBandNextXBL[81]=1;isoBandNextYBL[89]=isoBandNextYBL[81]=0;isoBandNextOBL[89]=isoBandNextOBL[81]=1;isoBandNextXRT[96]=isoBandNextXRT[74]=0;isoBandNextYRT[96]=isoBandNextYRT[74]=1;isoBandNextORT[96]=isoBandNextORT[74]=0;isoBandNextXRB[96]=isoBandNextXRB[74]=-1;isoBandNextYRB[96]=isoBandNextYRB[74]=0;isoBandNextORB[96]=isoBandNextORB[74]=1;isoBandNextXLT[96]=isoBandNextXLT[74]=1;isoBandNextYLT[96]=isoBandNextYLT[74]=0;isoBandNextOLT[96]=isoBandNextOLT[74]=0;isoBandNextXTL[96]=isoBandNextXTL[74]=1;isoBandNextYTL[96]=isoBandNextYTL[74]=0;isoBandNextOTL[96]=isoBandNextOTL[74]=1;isoBandNextXRT[24]=isoBandNextXRT[146]=0;isoBandNextYRT[24]=isoBandNextYRT[146]=-1;isoBandNextORT[24]=isoBandNextORT[146]=1;isoBandNextXBR[24]=isoBandNextXBR[146]=1;isoBandNextYBR[24]=isoBandNextYBR[146]=0;isoBandNextOBR[24]=isoBandNextOBR[146]=1;isoBandNextXBL[24]=isoBandNextXBL[146]=0;isoBandNextYBL[24]=isoBandNextYBL[146]=1;isoBandNextOBL[24]=isoBandNextOBL[146]=1;isoBandNextXTR[24]=isoBandNextXTR[146]=0;isoBandNextYTR[24]=isoBandNextYTR[146]=-1;isoBandNextOTR[24]=isoBandNextOTR[146]=0;isoBandNextXRB[6]=isoBandNextXRB[164]=-1;isoBandNextYRB[6]=isoBandNextYRB[164]=0;isoBandNextORB[6]=isoBandNextORB[164]=1;isoBandNextXBR[6]=isoBandNextXBR[164]=-1;isoBandNextYBR[6]=isoBandNextYBR[164]=0;isoBandNextOBR[6]=isoBandNextOBR[164]=0;isoBandNextXLB[6]=isoBandNextXLB[164]=0;isoBandNextYLB[6]=isoBandNextYLB[164]=-1;isoBandNextOLB[6]=isoBandNextOLB[164]=1;isoBandNextXLT[6]=isoBandNextXLT[164]=1;isoBandNextYLT[6]=isoBandNextYLT[164]=0;isoBandNextOLT[6]=isoBandNextOLT[164]=0;isoBandNextXBL[129]=isoBandNextXBL[41]=0;isoBandNextYBL[129]=isoBandNextYBL[41]=1;isoBandNextOBL[129]=isoBandNextOBL[41]=1;isoBandNextXLB[129]=isoBandNextXLB[41]=0;isoBandNextYLB[129]=isoBandNextYLB[41]=1;isoBandNextOLB[129]=isoBandNextOLB[41]=0;isoBandNextXTL[129]=isoBandNextXTL[41]=-1;isoBandNextYTL[129]=isoBandNextYTL[41]=0;isoBandNextOTL[129]=isoBandNextOTL[41]=0;isoBandNextXTR[129]=isoBandNextXTR[41]=0;isoBandNextYTR[129]=isoBandNextYTR[41]=-1;isoBandNextOTR[129]=isoBandNextOTR[41]=0;isoBandNextXBR[66]=isoBandNextXBR[104]=0;isoBandNextYBR[66]=isoBandNextYBR[104]=1;isoBandNextOBR[66]=isoBandNextOBR[104]=0;isoBandNextXBL[66]=isoBandNextXBL[104]=-1;isoBandNextYBL[66]=isoBandNextYBL[104]=0;isoBandNextOBL[66]=isoBandNextOBL[104]=1;isoBandNextXLT[66]=isoBandNextXLT[104]=0;isoBandNextYLT[66]=isoBandNextYLT[104]=-1;isoBandNextOLT[66]=isoBandNextOLT[104]=0;isoBandNextXTL[66]=isoBandNextXTL[104]=0;isoBandNextYTL[66]=isoBandNextYTL[104]=-1;isoBandNextOTL[66]=isoBandNextOTL[104]=1;isoBandNextXRT[144]=isoBandNextXRT[26]=-1;isoBandNextYRT[144]=isoBandNextYRT[26]=0;isoBandNextORT[144]=isoBandNextORT[26]=0;isoBandNextXLB[144]=isoBandNextXLB[26]=1;isoBandNextYLB[144]=isoBandNextYLB[26]=0;isoBandNextOLB[144]=isoBandNextOLB[26]=1;isoBandNextXLT[144]=isoBandNextXLT[26]=0;isoBandNextYLT[144]=isoBandNextYLT[26]=1;isoBandNextOLT[144]=isoBandNextOLT[26]=1;isoBandNextXTR[144]=isoBandNextXTR[26]=-1;isoBandNextYTR[144]=isoBandNextYTR[26]=0;isoBandNextOTR[144]=isoBandNextOTR[26]=1;isoBandNextXRB[36]=isoBandNextXRB[134]=0;isoBandNextYRB[36]=isoBandNextYRB[134]=1;isoBandNextORB[36]=isoBandNextORB[134]=1;isoBandNextXBR[36]=isoBandNextXBR[134]=0;isoBandNextYBR[36]=isoBandNextYBR[134]=1;isoBandNextOBR[36]=isoBandNextOBR[134]=0;isoBandNextXTL[36]=isoBandNextXTL[134]=0;isoBandNextYTL[36]=isoBandNextYTL[134]=-1;isoBandNextOTL[36]=isoBandNextOTL[134]=1;isoBandNextXTR[36]=isoBandNextXTR[134]=1;isoBandNextYTR[36]=isoBandNextYTR[134]=0;isoBandNextOTR[36]=isoBandNextOTR[134]=0;isoBandNextXRT[9]=isoBandNextXRT[161]=-1;isoBandNextYRT[9]=isoBandNextYRT[161]=0;isoBandNextORT[9]=isoBandNextORT[161]=0;isoBandNextXRB[9]=isoBandNextXRB[161]=0;isoBandNextYRB[9]=isoBandNextYRB[161]=-1;isoBandNextORB[9]=isoBandNextORB[161]=0;isoBandNextXBL[9]=isoBandNextXBL[161]=1;isoBandNextYBL[9]=isoBandNextYBL[161]=0;isoBandNextOBL[9]=isoBandNextOBL[161]=0;isoBandNextXLB[9]=isoBandNextXLB[161]=1;isoBandNextYLB[9]=isoBandNextYLB[161]=0;isoBandNextOLB[9]=isoBandNextOLB[161]=1;isoBandNextXRT[136]=0;isoBandNextYRT[136]=1;isoBandNextORT[136]=1;isoBandNextXRB[136]=0;isoBandNextYRB[136]=1;isoBandNextORB[136]=0;isoBandNextXBR[136]=-1;isoBandNextYBR[136]=0;isoBandNextOBR[136]=1;isoBandNextXBL[136]=-1;isoBandNextYBL[136]=0;isoBandNextOBL[136]=0;isoBandNextXLB[136]=0;isoBandNextYLB[136]=-1;isoBandNextOLB[136]=0;isoBandNextXLT[136]=0;isoBandNextYLT[136]=-1;isoBandNextOLT[136]=1;isoBandNextXTL[136]=1;isoBandNextYTL[136]=0;isoBandNextOTL[136]=0;isoBandNextXTR[136]=1;isoBandNextYTR[136]=0;isoBandNextOTR[136]=1;isoBandNextXRT[34]=0;isoBandNextYRT[34]=-1;isoBandNextORT[34]=0;isoBandNextXRB[34]=0;isoBandNextYRB[34]=-1;isoBandNextORB[34]=1;isoBandNextXBR[34]=1;isoBandNextYBR[34]=0;isoBandNextOBR[34]=0;isoBandNextXBL[34]=1;isoBandNextYBL[34]=0;isoBandNextOBL[34]=1;isoBandNextXLB[34]=0;isoBandNextYLB[34]=1;isoBandNextOLB[34]=1;isoBandNextXLT[34]=0;isoBandNextYLT[34]=1;isoBandNextOLT[34]=0;isoBandNextXTL[34]=-1;isoBandNextYTL[34]=0;isoBandNextOTL[34]=1;isoBandNextXTR[34]=-1;isoBandNextYTR[34]=0;isoBandNextOTR[34]=0;isoBandNextXRT[35]=0;isoBandNextYRT[35]=1;isoBandNextORT[35]=1;isoBandNextXRB[35]=0;isoBandNextYRB[35]=-1;isoBandNextORB[35]=1;isoBandNextXBR[35]=1;isoBandNextYBR[35]=0;isoBandNextOBR[35]=0;isoBandNextXBL[35]=-1;isoBandNextYBL[35]=0;isoBandNextOBL[35]=0;isoBandNextXLB[35]=0;isoBandNextYLB[35]=-1;isoBandNextOLB[35]=0;isoBandNextXLT[35]=0;isoBandNextYLT[35]=1;isoBandNextOLT[35]=0;isoBandNextXTL[35]=-1;isoBandNextYTL[35]=0;isoBandNextOTL[35]=1;isoBandNextXTR[35]=1;isoBandNextYTR[35]=0;isoBandNextOTR[35]=1;isoBandNextXRT[153]=0;isoBandNextYRT[153]=1;isoBandNextORT[153]=1;isoBandNextXBL[153]=-1;isoBandNextYBL[153]=0;isoBandNextOBL[153]=0;isoBandNextXLB[153]=0;isoBandNextYLB[153]=-1;isoBandNextOLB[153]=0;isoBandNextXTR[153]=1;isoBandNextYTR[153]=0;isoBandNextOTR[153]=1;isoBandNextXRB[102]=0;isoBandNextYRB[102]=-1;isoBandNextORB[102]=1;isoBandNextXBR[102]=1;isoBandNextYBR[102]=0;isoBandNextOBR[102]=0;isoBandNextXLT[102]=0;isoBandNextYLT[102]=1;isoBandNextOLT[102]=0;isoBandNextXTL[102]=-1;isoBandNextYTL[102]=0;isoBandNextOTL[102]=1;isoBandNextXRT[155]=0;isoBandNextYRT[155]=-1;isoBandNextORT[155]=0;isoBandNextXBL[155]=1;isoBandNextYBL[155]=0;isoBandNextOBL[155]=1;isoBandNextXLB[155]=0;isoBandNextYLB[155]=1;isoBandNextOLB[155]=1;isoBandNextXTR[155]=-1;isoBandNextYTR[155]=0;isoBandNextOTR[155]=0;isoBandNextXRB[103]=0;isoBandNextYRB[103]=1;isoBandNextORB[103]=0;isoBandNextXBR[103]=-1;isoBandNextYBR[103]=0;isoBandNextOBR[103]=1;isoBandNextXLT[103]=0;isoBandNextYLT[103]=-1;isoBandNextOLT[103]=1;isoBandNextXTL[103]=1;isoBandNextYTL[103]=0;isoBandNextOTL[103]=0;isoBandNextXRT[152]=0;isoBandNextYRT[152]=1;isoBandNextORT[152]=1;isoBandNextXBR[152]=-1;isoBandNextYBR[152]=0;isoBandNextOBR[152]=1;isoBandNextXBL[152]=-1;isoBandNextYBL[152]=0;isoBandNextOBL[152]=0;isoBandNextXLB[152]=0;isoBandNextYLB[152]=-1;isoBandNextOLB[152]=0;isoBandNextXLT[152]=0;isoBandNextYLT[152]=-1;isoBandNextOLT[152]=1;isoBandNextXTR[152]=1;isoBandNextYTR[152]=0;isoBandNextOTR[152]=1;isoBandNextXRT[156]=0;isoBandNextYRT[156]=-1;isoBandNextORT[156]=1;isoBandNextXBR[156]=1;isoBandNextYBR[156]=0;isoBandNextOBR[156]=1;isoBandNextXBL[156]=-1;isoBandNextYBL[156]=0;isoBandNextOBL[156]=0;isoBandNextXLB[156]=0;isoBandNextYLB[156]=-1;isoBandNextOLB[156]=0;isoBandNextXLT[156]=0;isoBandNextYLT[156]=1;isoBandNextOLT[156]=1;isoBandNextXTR[156]=-1;isoBandNextYTR[156]=0;isoBandNextOTR[156]=1;isoBandNextXRT[137]=0;isoBandNextYRT[137]=1;isoBandNextORT[137]=1;isoBandNextXRB[137]=0;isoBandNextYRB[137]=1;isoBandNextORB[137]=0;isoBandNextXBL[137]=-1;isoBandNextYBL[137]=0;isoBandNextOBL[137]=0;isoBandNextXLB[137]=0;isoBandNextYLB[137]=-1;isoBandNextOLB[137]=0;isoBandNextXTL[137]=1;isoBandNextYTL[137]=0;isoBandNextOTL[137]=0;isoBandNextXTR[137]=1;isoBandNextYTR[137]=0;isoBandNextOTR[137]=1;isoBandNextXRT[139]=0;isoBandNextYRT[139]=1;isoBandNextORT[139]=1;isoBandNextXRB[139]=0;isoBandNextYRB[139]=-1;isoBandNextORB[139]=0;isoBandNextXBL[139]=1;isoBandNextYBL[139]=0;isoBandNextOBL[139]=0;isoBandNextXLB[139]=0;isoBandNextYLB[139]=1;isoBandNextOLB[139]=0;isoBandNextXTL[139]=-1;isoBandNextYTL[139]=0;isoBandNextOTL[139]=0;isoBandNextXTR[139]=1;isoBandNextYTR[139]=0;isoBandNextOTR[139]=1;isoBandNextXRT[98]=0;isoBandNextYRT[98]=-1;isoBandNextORT[98]=0;isoBandNextXRB[98]=0;isoBandNextYRB[98]=-1;isoBandNextORB[98]=1;isoBandNextXBR[98]=1;isoBandNextYBR[98]=0;isoBandNextOBR[98]=0;isoBandNextXBL[98]=1;isoBandNextYBL[98]=0;isoBandNextOBL[98]=1;isoBandNextXLT[98]=0;isoBandNextYLT[98]=1;isoBandNextOLT[98]=0;isoBandNextXTL[98]=-1;isoBandNextYTL[98]=0;isoBandNextOTL[98]=1;isoBandNextXRT[99]=0;isoBandNextYRT[99]=1;isoBandNextORT[99]=0;isoBandNextXRB[99]=0;isoBandNextYRB[99]=-1;isoBandNextORB[99]=1;isoBandNextXBR[99]=1;isoBandNextYBR[99]=0;isoBandNextOBR[99]=0;isoBandNextXBL[99]=-1;isoBandNextYBL[99]=0;isoBandNextOBL[99]=1;isoBandNextXLT[99]=0;isoBandNextYLT[99]=-1;isoBandNextOLT[99]=0;isoBandNextXTL[99]=1;isoBandNextYTL[99]=0;isoBandNextOTL[99]=1;isoBandNextXRB[38]=0;isoBandNextYRB[38]=-1;isoBandNextORB[38]=1;isoBandNextXBR[38]=1;isoBandNextYBR[38]=0;isoBandNextOBR[38]=0;isoBandNextXLB[38]=0;isoBandNextYLB[38]=1;isoBandNextOLB[38]=1;isoBandNextXLT[38]=0;isoBandNextYLT[38]=1;isoBandNextOLT[38]=0;isoBandNextXTL[38]=-1;isoBandNextYTL[38]=0;isoBandNextOTL[38]=1;isoBandNextXTR[38]=-1;isoBandNextYTR[38]=0;isoBandNextOTR[38]=0;isoBandNextXRB[39]=0;isoBandNextYRB[39]=1;isoBandNextORB[39]=1;isoBandNextXBR[39]=-1;isoBandNextYBR[39]=0;isoBandNextOBR[39]=0;isoBandNextXLB[39]=0;isoBandNextYLB[39]=-1;isoBandNextOLB[39]=1;isoBandNextXLT[39]=0;isoBandNextYLT[39]=1;isoBandNextOLT[39]=0;isoBandNextXTL[39]=-1;isoBandNextYTL[39]=0;isoBandNextOTL[39]=1;isoBandNextXTR[39]=1;isoBandNextYTR[39]=0;isoBandNextOTR[39]=0;var p00=function(cell){return[[cell.bottomleft,0],[0,0],[0,cell.leftbottom]]},p01=function(cell){return[[1,cell.rightbottom],[1,0],[cell.bottomright,0]]},p02=function(cell){return[[cell.topright,1],[1,1],[1,cell.righttop]]},p03=function(cell){return[[0,cell.lefttop],[0,1],[cell.topleft,1]]},p04=function(cell){return[[cell.bottomright,0],[cell.bottomleft,0],[0,cell.leftbottom],[0,cell.lefttop]]},p05=function(cell){return[[cell.bottomright,0],[cell.bottomleft,0],[1,cell.righttop],[1,cell.rightbottom]]},p06=function(cell){return[[1,cell.righttop],[1,cell.rightbottom],[cell.topleft,1],[cell.topright,1]]},p07=function(cell){return[[0,cell.leftbottom],[0,cell.lefttop],[cell.topleft,1],[cell.topright,1]]},p08=function(cell){return[[0,0],[0,cell.leftbottom],[1,cell.rightbottom],[1,0]]},p09=function(cell){return[[1,0],[cell.bottomright,0],[cell.topright,1],[1,1]]},p10=function(cell){return[[1,1],[1,cell.righttop],[0,cell.lefttop],[0,1]]},p11=function(cell){return[[cell.bottomleft,0],[0,0],[0,1],[cell.topleft,1]]},p12=function(cell){return[[1,cell.righttop],[1,cell.rightbottom],[0,cell.leftbottom],[0,cell.lefttop]]},p13=function(cell){return[[cell.topleft,1],[cell.topright,1],[cell.bottomright,0],[cell.bottomleft,0]]},p14=function(){return[[0,0],[0,1],[1,1],[1,0]]},p15=function(cell){return[[1,cell.rightbottom],[1,0],[0,0],[0,1],[cell.topleft,1]]},p16=function(cell){return[[cell.topright,1],[1,1],[1,0],[0,0],[0,cell.leftbottom]]},p17=function(cell){return[[1,0],[cell.bottomright,0],[0,cell.lefttop],[0,1],[1,1]]},p18=function(cell){return[[1,1],[1,cell.righttop],[cell.bottomleft,0],[0,0],[0,1]]},p19=function(cell){return[[1,cell.righttop],[1,cell.rightbottom],[0,cell.lefttop],[0,1],[cell.topleft,1]]},p20=function(cell){return[[1,1],[1,cell.righttop],[cell.bottomright,0],[cell.bottomleft,0],[cell.topright,1]]},p21=function(cell){return[[1,cell.rightbottom],[1,0],[cell.bottomright,0],[0,cell.leftbottom],[0,cell.lefttop]]},p22=function(cell){return[[cell.topright,1],[cell.bottomleft,0],[0,0],[0,cell.leftbottom],[cell.topleft,1]]},p23=function(cell){return[[cell.bottomright,0],[cell.bottomleft,0],[0,cell.lefttop],[0,1],[cell.topleft,1]]},p24=function(cell){return[[1,1],[1,cell.righttop],[0,cell.leftbottom],[0,cell.lefttop],[cell.topright,1]]},p25=function(cell){return[[1,cell.rightbottom],[1,0],[cell.bottomright,0],[cell.topleft,1],[cell.topright,1]]},p26=function(cell){return[[1,cell.righttop],[1,cell.rightbottom],[cell.bottomleft,0],[0,0],[0,cell.leftbottom]]},p27=function(cell){return[[1,cell.rightbottom],[1,0],[0,0],[0,cell.leftbottom],[cell.topleft,1],[cell.topright,1]]},p28=function(cell){return[[1,1],[1,0],[cell.bottomright,0],[0,cell.leftbottom],[0,cell.lefttop],[cell.topright,1]]},p29=function(cell){return[[1,1],[1,cell.righttop],[cell.bottomright,0],[cell.bottomleft,0],[0,cell.lefttop],[0,1]]},p30=function(cell){return[[1,cell.righttop],[1,cell.rightbottom],[cell.bottomleft,0],[0,0],[0,1],[cell.topleft,1]]},p31=function(cell){return[[1,1],[1,cell.righttop],[cell.bottomleft,0],[0,0],[0,cell.leftbottom],[cell.topright,1]]},p32=function(cell){return[[1,cell.rightbottom],[1,0],[cell.bottomright,0],[0,cell.lefttop],[0,1],[cell.topleft,1]]},p33=function(cell){return[[1,cell.righttop],[1,cell.rightbottom],[cell.bottomright,0],[cell.bottomleft,0],[0,cell.leftbottom],[0,cell.lefttop],[cell.topleft,1],[cell.topright,1]]},p34=function(cell){return[[1,1],[1,cell.righttop],[cell.bottomleft,0],[0,0],[0,cell.leftbottom],[cell.topright,1]]},p35=function(cell){return[[1,cell.rightbottom],[1,0],[cell.bottomright,0],[0,cell.lefttop],[0,1],[cell.topleft,1]]},p36=function(cell){return[[1,1],[1,cell.righttop],[cell.bottomright,0],[cell.bottomleft,0],[0,cell.leftbottom],[0,cell.lefttop],[cell.topright,1]]},p37=function(cell){return[[1,cell.righttop],[1,cell.rightbottom],[cell.bottomleft,0],[0,0],[0,cell.leftbottom],[cell.topleft,1],[cell.topright,1]]},p38=function(cell){return[[1,cell.righttop],[1,cell.rightbottom],[cell.bottomright,0],[cell.bottomleft,0],[0,cell.lefttop],[0,1],[cell.topleft,1]]},p39=function(cell){return[[1,cell.rightbottom],[1,0],[cell.bottomright,0],[0,cell.leftbottom],[0,cell.lefttop],[cell.topleft,1],[cell.topright,1]]},isoBandEdgeRT=[],isoBandEdgeRB=[],isoBandEdgeBR=[],isoBandEdgeBL=[],isoBandEdgeLB=[],isoBandEdgeLT=[],isoBandEdgeTL=[],isoBandEdgeTR=[];isoBandEdgeBL[1]=isoBandEdgeLB[1]=18;isoBandEdgeBL[169]=isoBandEdgeLB[169]=18;isoBandEdgeBR[4]=isoBandEdgeRB[4]=12;isoBandEdgeBR[166]=isoBandEdgeRB[166]=12;isoBandEdgeRT[16]=isoBandEdgeTR[16]=4;isoBandEdgeRT[154]=isoBandEdgeTR[154]=4;isoBandEdgeLT[64]=isoBandEdgeTL[64]=22;isoBandEdgeLT[106]=isoBandEdgeTL[106]=22;isoBandEdgeBR[2]=isoBandEdgeLT[2]=17;isoBandEdgeBL[2]=isoBandEdgeLB[2]=18;isoBandEdgeBR[168]=isoBandEdgeLT[168]=17;isoBandEdgeBL[168]=isoBandEdgeLB[168]=18;isoBandEdgeRT[8]=isoBandEdgeBL[8]=9;isoBandEdgeRB[8]=isoBandEdgeBR[8]=12;isoBandEdgeRT[162]=isoBandEdgeBL[162]=9;isoBandEdgeRB[162]=isoBandEdgeBR[162]=12;isoBandEdgeRT[32]=isoBandEdgeTR[32]=4;isoBandEdgeRB[32]=isoBandEdgeTL[32]=1;isoBandEdgeRT[138]=isoBandEdgeTR[138]=4;isoBandEdgeRB[138]=isoBandEdgeTL[138]=1;isoBandEdgeLB[128]=isoBandEdgeTR[128]=21;isoBandEdgeLT[128]=isoBandEdgeTL[128]=22;isoBandEdgeLB[42]=isoBandEdgeTR[42]=21;isoBandEdgeLT[42]=isoBandEdgeTL[42]=22;isoBandEdgeRB[5]=isoBandEdgeLB[5]=14;isoBandEdgeRB[165]=isoBandEdgeLB[165]=14;isoBandEdgeBR[20]=isoBandEdgeTR[20]=6;isoBandEdgeBR[150]=isoBandEdgeTR[150]=6;isoBandEdgeRT[80]=isoBandEdgeLT[80]=11;isoBandEdgeRT[90]=isoBandEdgeLT[90]=11;isoBandEdgeBL[65]=isoBandEdgeTL[65]=3;isoBandEdgeBL[105]=isoBandEdgeTL[105]=3;isoBandEdgeRT[160]=isoBandEdgeLT[160]=11;isoBandEdgeRB[160]=isoBandEdgeLB[160]=14;isoBandEdgeRT[10]=isoBandEdgeLT[10]=11;isoBandEdgeRB[10]=isoBandEdgeLB[10]=14;isoBandEdgeBR[130]=isoBandEdgeTR[130]=6;isoBandEdgeBL[130]=isoBandEdgeTL[130]=3;isoBandEdgeBR[40]=isoBandEdgeTR[40]=6;isoBandEdgeBL[40]=isoBandEdgeTL[40]=3;isoBandEdgeRB[101]=isoBandEdgeTL[101]=1;isoBandEdgeRB[69]=isoBandEdgeTL[69]=1;isoBandEdgeLB[149]=isoBandEdgeTR[149]=21;isoBandEdgeLB[21]=isoBandEdgeTR[21]=21;isoBandEdgeBR[86]=isoBandEdgeLT[86]=17;isoBandEdgeBR[84]=isoBandEdgeLT[84]=17;isoBandEdgeRT[89]=isoBandEdgeBL[89]=9;isoBandEdgeRT[81]=isoBandEdgeBL[81]=9;isoBandEdgeRT[96]=isoBandEdgeTL[96]=0;isoBandEdgeRB[96]=isoBandEdgeLT[96]=15;isoBandEdgeRT[74]=isoBandEdgeTL[74]=0;isoBandEdgeRB[74]=isoBandEdgeLT[74]=15;isoBandEdgeRT[24]=isoBandEdgeBR[24]=8;isoBandEdgeBL[24]=isoBandEdgeTR[24]=7;isoBandEdgeRT[146]=isoBandEdgeBR[146]=8;isoBandEdgeBL[146]=isoBandEdgeTR[146]=7;isoBandEdgeRB[6]=isoBandEdgeLT[6]=15;isoBandEdgeBR[6]=isoBandEdgeLB[6]=16;isoBandEdgeRB[164]=isoBandEdgeLT[164]=15;isoBandEdgeBR[164]=isoBandEdgeLB[164]=16;isoBandEdgeBL[129]=isoBandEdgeTR[129]=7;isoBandEdgeLB[129]=isoBandEdgeTL[129]=20;isoBandEdgeBL[41]=isoBandEdgeTR[41]=7;isoBandEdgeLB[41]=isoBandEdgeTL[41]=20;isoBandEdgeBR[66]=isoBandEdgeTL[66]=2;isoBandEdgeBL[66]=isoBandEdgeLT[66]=19;isoBandEdgeBR[104]=isoBandEdgeTL[104]=2;isoBandEdgeBL[104]=isoBandEdgeLT[104]=19;isoBandEdgeRT[144]=isoBandEdgeLB[144]=10;isoBandEdgeLT[144]=isoBandEdgeTR[144]=23;isoBandEdgeRT[26]=isoBandEdgeLB[26]=10;isoBandEdgeLT[26]=isoBandEdgeTR[26]=23;isoBandEdgeRB[36]=isoBandEdgeTR[36]=5;isoBandEdgeBR[36]=isoBandEdgeTL[36]=2;isoBandEdgeRB[134]=isoBandEdgeTR[134]=5;isoBandEdgeBR[134]=isoBandEdgeTL[134]=2;isoBandEdgeRT[9]=isoBandEdgeLB[9]=10;isoBandEdgeRB[9]=isoBandEdgeBL[9]=13;isoBandEdgeRT[161]=isoBandEdgeLB[161]=10;isoBandEdgeRB[161]=isoBandEdgeBL[161]=13;isoBandEdgeRB[37]=isoBandEdgeTR[37]=5;isoBandEdgeLB[37]=isoBandEdgeTL[37]=20;isoBandEdgeRB[133]=isoBandEdgeTR[133]=5;isoBandEdgeLB[133]=isoBandEdgeTL[133]=20;isoBandEdgeBR[148]=isoBandEdgeLB[148]=16;isoBandEdgeLT[148]=isoBandEdgeTR[148]=23;isoBandEdgeBR[22]=isoBandEdgeLB[22]=16;isoBandEdgeLT[22]=isoBandEdgeTR[22]=23;isoBandEdgeRT[82]=isoBandEdgeBR[82]=8;isoBandEdgeBL[82]=isoBandEdgeLT[82]=19;isoBandEdgeRT[88]=isoBandEdgeBR[88]=8;isoBandEdgeBL[88]=isoBandEdgeLT[88]=19;isoBandEdgeRT[73]=isoBandEdgeTL[73]=0;isoBandEdgeRB[73]=isoBandEdgeBL[73]=13;isoBandEdgeRT[97]=isoBandEdgeTL[97]=0;isoBandEdgeRB[97]=isoBandEdgeBL[97]=13;isoBandEdgeRT[145]=isoBandEdgeBL[145]=9;isoBandEdgeLB[145]=isoBandEdgeTR[145]=21;isoBandEdgeRT[25]=isoBandEdgeBL[25]=9;isoBandEdgeLB[25]=isoBandEdgeTR[25]=21;isoBandEdgeRB[70]=isoBandEdgeTL[70]=1;isoBandEdgeBR[70]=isoBandEdgeLT[70]=17;isoBandEdgeRB[100]=isoBandEdgeTL[100]=1;isoBandEdgeBR[100]=isoBandEdgeLT[100]=17;isoBandEdgeRT[34]=isoBandEdgeBL[34]=9;isoBandEdgeRB[34]=isoBandEdgeBR[34]=12;isoBandEdgeLB[34]=isoBandEdgeTR[34]=21;isoBandEdgeLT[34]=isoBandEdgeTL[34]=22;isoBandEdgeRT[136]=isoBandEdgeTR[136]=4;isoBandEdgeRB[136]=isoBandEdgeTL[136]=1;isoBandEdgeBR[136]=isoBandEdgeLT[136]=17;isoBandEdgeBL[136]=isoBandEdgeLB[136]=18;isoBandEdgeRT[35]=isoBandEdgeTR[35]=4;isoBandEdgeRB[35]=isoBandEdgeBR[35]=12;isoBandEdgeBL[35]=isoBandEdgeLB[35]=18;isoBandEdgeLT[35]=isoBandEdgeTL[35]=22;isoBandEdgeRT[153]=isoBandEdgeTR[153]=4;isoBandEdgeBL[153]=isoBandEdgeLB[153]=18;isoBandEdgeRB[102]=isoBandEdgeBR[102]=12;isoBandEdgeLT[102]=isoBandEdgeTL[102]=22;isoBandEdgeRT[155]=isoBandEdgeBL[155]=9;isoBandEdgeLB[155]=isoBandEdgeTR[155]=23;isoBandEdgeRB[103]=isoBandEdgeTL[103]=1;isoBandEdgeBR[103]=isoBandEdgeLT[103]=17;isoBandEdgeRT[152]=isoBandEdgeTR[152]=4;isoBandEdgeBR[152]=isoBandEdgeLT[152]=17;isoBandEdgeBL[152]=isoBandEdgeLB[152]=18;isoBandEdgeRT[156]=isoBandEdgeBR[156]=8;isoBandEdgeBL[156]=isoBandEdgeLB[156]=18;isoBandEdgeLT[156]=isoBandEdgeTR[156]=23;isoBandEdgeRT[137]=isoBandEdgeTR[137]=4;isoBandEdgeRB[137]=isoBandEdgeTL[137]=1;isoBandEdgeBL[137]=isoBandEdgeLB[137]=18;isoBandEdgeRT[139]=isoBandEdgeTR[139]=4;isoBandEdgeRB[139]=isoBandEdgeBL[139]=13;isoBandEdgeLB[139]=isoBandEdgeTL[139]=20;isoBandEdgeRT[98]=isoBandEdgeBL[98]=9;isoBandEdgeRB[98]=isoBandEdgeBR[98]=12;isoBandEdgeLT[98]=isoBandEdgeTL[98]=22;isoBandEdgeRT[99]=isoBandEdgeTL[99]=0;isoBandEdgeRB[99]=isoBandEdgeBR[99]=12;isoBandEdgeBL[99]=isoBandEdgeLT[99]=19;isoBandEdgeRB[38]=isoBandEdgeBR[38]=12;isoBandEdgeLB[38]=isoBandEdgeTR[38]=21;isoBandEdgeLT[38]=isoBandEdgeTL[38]=22;isoBandEdgeRB[39]=isoBandEdgeTR[39]=5;isoBandEdgeBR[39]=isoBandEdgeLB[39]=16;isoBandEdgeLT[39]=isoBandEdgeTL[39]=22;var polygon_table=[];polygon_table[1]=polygon_table[169]=p00;polygon_table[4]=polygon_table[166]=p01;polygon_table[16]=polygon_table[154]=p02;polygon_table[64]=polygon_table[106]=p03;polygon_table[168]=polygon_table[2]=p04;polygon_table[162]=polygon_table[8]=p05;polygon_table[138]=polygon_table[32]=p06;polygon_table[42]=polygon_table[128]=p07;polygon_table[5]=polygon_table[165]=p08;polygon_table[20]=polygon_table[150]=p09;polygon_table[80]=polygon_table[90]=p10;polygon_table[65]=polygon_table[105]=p11;polygon_table[160]=polygon_table[10]=p12;polygon_table[130]=polygon_table[40]=p13;polygon_table[85]=p14;polygon_table[101]=polygon_table[69]=p15;polygon_table[149]=polygon_table[21]=p16;polygon_table[86]=polygon_table[84]=p17;polygon_table[89]=polygon_table[81]=p18;polygon_table[96]=polygon_table[74]=p19;polygon_table[24]=polygon_table[146]=p20;polygon_table[6]=polygon_table[164]=p21;polygon_table[129]=polygon_table[41]=p22;polygon_table[66]=polygon_table[104]=p23;polygon_table[144]=polygon_table[26]=p24;polygon_table[36]=polygon_table[134]=p25;polygon_table[9]=polygon_table[161]=p26;polygon_table[37]=polygon_table[133]=p27;polygon_table[148]=polygon_table[22]=p28;polygon_table[82]=polygon_table[88]=p29;polygon_table[73]=polygon_table[97]=p30;polygon_table[145]=polygon_table[25]=p31;polygon_table[70]=polygon_table[100]=p32;polygon_table[34]=function(c){return[p07(c),p05(c)]};polygon_table[35]=p33;polygon_table[136]=function(c){return[p06(c),p04(c)]};polygon_table[153]=function(c){return[p02(c),p00(c)]};polygon_table[102]=function(c){return[p01(c),p03(c)]};polygon_table[155]=p34;polygon_table[103]=p35;polygon_table[152]=function(c){return[p02(c),p04(c)]};polygon_table[156]=p36;polygon_table[137]=function(c){return[p06(c),p00(c)]};polygon_table[139]=p37;polygon_table[98]=function(c){return[p05(c),p03(c)]};polygon_table[99]=p38;polygon_table[38]=function(c){return[p01(c),p07(c)]};polygon_table[39]=p39;function interpolateX$1(y2,y0,y12){return(y2-y0)/(y12-y0)}function isArray(myArray){return myArray.constructor.toString().indexOf("Array")>-1}function computeBandGrid(data,minV,bandwidth){for(var rows=data.length-1,cols=data[0].length-1,BandGrid={rows,cols,cells:[]},maxV=minV+Math.abs(bandwidth),j=0;j<rows;++j){BandGrid.cells[j]=[];for(var i=0;i<cols;++i){var cval=0,tl=data[j+1][i],tr=data[j+1][i+1],br=data[j][i+1],bl=data[j][i];if(!(isNaN(tl)||isNaN(tr)||isNaN(br)||isNaN(bl))){cval|=tl<minV?0:tl>maxV?128:64,cval|=tr<minV?0:tr>maxV?32:16,cval|=br<minV?0:br>maxV?8:4,cval|=bl<minV?0:bl>maxV?2:1;var cval_real=+cval,flipped=0;if(cval===17||cval===18||cval===33||cval===34||cval===38||cval===68||cval===72||cval===98||cval===102||cval===132||cval===136||cval===137||cval===152||cval===153){var average2=(tl+tr+br+bl)/4;flipped=average2>maxV?2:average2<minV?0:1,cval===34?flipped===1?cval=35:flipped===0&&(cval=136):cval===136?flipped===1?(cval=35,flipped=4):flipped===0&&(cval=34):cval===17?flipped===1?(cval=155,flipped=4):flipped===0&&(cval=153):cval===68?flipped===1?(cval=103,flipped=4):flipped===0&&(cval=102):cval===153?flipped===1&&(cval=155):cval===102?flipped===1&&(cval=103):cval===152?flipped<2&&(cval=156,flipped=1):cval===137?flipped<2&&(cval=139,flipped=1):cval===98?flipped<2&&(cval=99,flipped=1):cval===38?flipped<2&&(cval=39,flipped=1):cval===18?flipped>0?(cval=156,flipped=4):cval=152:cval===33?flipped>0?(cval=139,flipped=4):cval=137:cval===72?flipped>0?(cval=99,flipped=4):cval=98:cval===132&&(flipped>0?(cval=39,flipped=4):cval=38)}if(cval!=0&&cval!=170){var topleft,topright,bottomleft,bottomright,righttop,rightbottom,lefttop,leftbottom;topleft=topright=bottomleft=bottomright=righttop=rightbottom=lefttop=leftbottom=.5;var edges2=[];cval===1?(bottomleft=1-interpolateX$1(minV,br,bl),leftbottom=1-interpolateX$1(minV,tl,bl),edges2.push(isoBandEdgeBL[cval])):cval===169?(bottomleft=interpolateX$1(maxV,bl,br),leftbottom=interpolateX$1(maxV,bl,tl),edges2.push(isoBandEdgeBL[cval])):cval===4?(rightbottom=1-interpolateX$1(minV,tr,br),bottomright=interpolateX$1(minV,bl,br),edges2.push(isoBandEdgeRB[cval])):cval===166?(rightbottom=interpolateX$1(maxV,br,tr),bottomright=1-interpolateX$1(maxV,br,bl),edges2.push(isoBandEdgeRB[cval])):cval===16?(righttop=interpolateX$1(minV,br,tr),topright=interpolateX$1(minV,tl,tr),edges2.push(isoBandEdgeRT[cval])):cval===154?(righttop=1-interpolateX$1(maxV,tr,br),topright=1-interpolateX$1(maxV,tr,tl),edges2.push(isoBandEdgeRT[cval])):cval===64?(lefttop=interpolateX$1(minV,bl,tl),topleft=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeLT[cval])):cval===106?(lefttop=1-interpolateX$1(maxV,tl,bl),topleft=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeLT[cval])):cval===168?(bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),edges2.push(isoBandEdgeBR[cval]),edges2.push(isoBandEdgeBL[cval])):cval===2?(bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),edges2.push(isoBandEdgeBR[cval]),edges2.push(isoBandEdgeBL[cval])):cval===162?(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),edges2.push(isoBandEdgeBR[cval]),edges2.push(isoBandEdgeBL[cval])):cval===8?(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval])):cval===138?(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval])):cval===32?(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval])):cval===42?(leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeLB[cval]),edges2.push(isoBandEdgeLT[cval])):cval===128&&(leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeLB[cval]),edges2.push(isoBandEdgeLT[cval])),cval===5?(rightbottom=1-interpolateX$1(minV,tr,br),leftbottom=1-interpolateX$1(minV,tl,bl),edges2.push(isoBandEdgeRB[cval])):cval===165?(rightbottom=interpolateX$1(maxV,br,tr),leftbottom=interpolateX$1(maxV,bl,tl),edges2.push(isoBandEdgeRB[cval])):cval===20?(bottomright=interpolateX$1(minV,bl,br),topright=interpolateX$1(minV,tl,tr),edges2.push(isoBandEdgeBR[cval])):cval===150?(bottomright=1-interpolateX$1(maxV,br,bl),topright=1-interpolateX$1(maxV,tr,tl),edges2.push(isoBandEdgeBR[cval])):cval===80?(righttop=interpolateX$1(minV,br,tr),lefttop=interpolateX$1(minV,bl,tl),edges2.push(isoBandEdgeRT[cval])):cval===90?(righttop=1-interpolateX$1(maxV,tr,br),lefttop=1-interpolateX$1(maxV,tl,bl),edges2.push(isoBandEdgeRT[cval])):cval===65?(bottomleft=1-interpolateX$1(minV,br,bl),topleft=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeBL[cval])):cval===105?(bottomleft=interpolateX$1(maxV,bl,br),topleft=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeBL[cval])):cval===160?(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval])):cval===10?(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval])):cval===130?(bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeBR[cval]),edges2.push(isoBandEdgeBL[cval])):cval===40?(bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeBR[cval]),edges2.push(isoBandEdgeBL[cval])):cval===101?(rightbottom=interpolateX$1(maxV,br,tr),topleft=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeRB[cval])):cval===69?(rightbottom=1-interpolateX$1(minV,tr,br),topleft=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeRB[cval])):cval===149?(leftbottom=interpolateX$1(maxV,bl,tl),topright=1-interpolateX$1(maxV,tr,tl),edges2.push(isoBandEdgeLB[cval])):cval===21?(leftbottom=1-interpolateX$1(minV,tl,bl),topright=interpolateX$1(minV,tl,tr),edges2.push(isoBandEdgeLB[cval])):cval===86?(bottomright=1-interpolateX$1(maxV,br,bl),lefttop=1-interpolateX$1(maxV,tl,bl),edges2.push(isoBandEdgeBR[cval])):cval===84?(bottomright=interpolateX$1(minV,bl,br),lefttop=interpolateX$1(minV,bl,tl),edges2.push(isoBandEdgeBR[cval])):cval===89?(righttop=1-interpolateX$1(maxV,tr,br),bottomleft=interpolateX$1(maxV,bl,br),edges2.push(isoBandEdgeBL[cval])):cval===81?(righttop=interpolateX$1(minV,br,tr),bottomleft=1-interpolateX$1(minV,br,bl),edges2.push(isoBandEdgeBL[cval])):cval===96?(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),lefttop=interpolateX$1(minV,bl,tl),topleft=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval])):cval===74?(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),lefttop=1-interpolateX$1(maxV,tl,bl),topleft=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval])):cval===24?(righttop=1-interpolateX$1(maxV,tr,br),bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),topright=interpolateX$1(minV,tl,tr),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeBL[cval])):cval===146?(righttop=interpolateX$1(minV,br,tr),bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),topright=1-interpolateX$1(maxV,tr,tl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeBL[cval])):cval===6?(rightbottom=1-interpolateX$1(minV,tr,br),bottomright=1-interpolateX$1(maxV,br,bl),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeBR[cval])):cval===164?(rightbottom=interpolateX$1(maxV,br,tr),bottomright=interpolateX$1(minV,bl,br),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeBR[cval])):cval===129?(bottomleft=1-interpolateX$1(minV,br,bl),leftbottom=interpolateX$1(maxV,bl,tl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeBL[cval]),edges2.push(isoBandEdgeLB[cval])):cval===41?(bottomleft=interpolateX$1(maxV,bl,br),leftbottom=1-interpolateX$1(minV,tl,bl),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeBL[cval]),edges2.push(isoBandEdgeLB[cval])):cval===66?(bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),lefttop=1-interpolateX$1(maxV,tl,bl),topleft=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeBR[cval]),edges2.push(isoBandEdgeBL[cval])):cval===104?(bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),lefttop=interpolateX$1(minV,bl,tl),topleft=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeBL[cval]),edges2.push(isoBandEdgeTL[cval])):cval===144?(righttop=interpolateX$1(minV,br,tr),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),topright=1-interpolateX$1(maxV,tr,tl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeLT[cval])):cval===26?(righttop=1-interpolateX$1(maxV,tr,br),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),topright=interpolateX$1(minV,tl,tr),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeLT[cval])):cval===36?(rightbottom=interpolateX$1(maxV,br,tr),bottomright=interpolateX$1(minV,bl,br),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeBR[cval])):cval===134?(rightbottom=1-interpolateX$1(minV,tr,br),bottomright=1-interpolateX$1(maxV,br,bl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeBR[cval])):cval===9?(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),bottomleft=interpolateX$1(maxV,bl,br),leftbottom=1-interpolateX$1(minV,tl,bl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval])):cval===161?(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),bottomleft=1-interpolateX$1(minV,br,bl),leftbottom=interpolateX$1(maxV,bl,tl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval])):cval===37?(rightbottom=interpolateX$1(maxV,br,tr),leftbottom=1-interpolateX$1(minV,tl,bl),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeLB[cval])):cval===133?(rightbottom=1-interpolateX$1(minV,tr,br),leftbottom=interpolateX$1(maxV,bl,tl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeLB[cval])):cval===148?(bottomright=interpolateX$1(minV,bl,br),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),topright=1-interpolateX$1(maxV,tr,tl),edges2.push(isoBandEdgeBR[cval]),edges2.push(isoBandEdgeLT[cval])):cval===22?(bottomright=1-interpolateX$1(maxV,br,bl),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),topright=interpolateX$1(minV,tl,tr),edges2.push(isoBandEdgeBR[cval]),edges2.push(isoBandEdgeLT[cval])):cval===82?(righttop=interpolateX$1(minV,br,tr),bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),lefttop=1-interpolateX$1(maxV,tl,bl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeBL[cval])):cval===88?(righttop=1-interpolateX$1(maxV,tr,br),bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),lefttop=interpolateX$1(minV,bl,tl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeBL[cval])):cval===73?(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),bottomleft=interpolateX$1(maxV,bl,br),topleft=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval])):cval===97?(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),bottomleft=1-interpolateX$1(minV,br,bl),topleft=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval])):cval===145?(righttop=interpolateX$1(minV,br,tr),bottomleft=1-interpolateX$1(minV,br,bl),leftbottom=interpolateX$1(maxV,bl,tl),topright=1-interpolateX$1(maxV,tr,tl),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeLB[cval])):cval===25?(righttop=1-interpolateX$1(maxV,tr,br),bottomleft=interpolateX$1(maxV,bl,br),leftbottom=1-interpolateX$1(minV,tl,bl),topright=interpolateX$1(minV,tl,tr),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeLB[cval])):cval===70?(rightbottom=1-interpolateX$1(minV,tr,br),bottomright=1-interpolateX$1(maxV,br,bl),lefttop=1-interpolateX$1(maxV,tl,bl),topleft=1-interpolateX$1(minV,tr,tl),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeBR[cval])):cval===100?(rightbottom=interpolateX$1(maxV,br,tr),bottomright=interpolateX$1(minV,bl,br),lefttop=interpolateX$1(minV,bl,tl),topleft=interpolateX$1(maxV,tl,tr),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeBR[cval])):cval===34?(flipped===0?(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl)):(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr)),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeLB[cval]),edges2.push(isoBandEdgeLT[cval])):cval===35?(flipped===4?(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl)):(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr)),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeBL[cval]),edges2.push(isoBandEdgeLT[cval])):cval===136?(flipped===0?(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr)):(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl)),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeLB[cval]),edges2.push(isoBandEdgeLT[cval])):cval===153?(flipped===0?(righttop=interpolateX$1(minV,br,tr),bottomleft=1-interpolateX$1(minV,br,bl),leftbottom=1-interpolateX$1(minV,tl,bl),topright=interpolateX$1(minV,tl,tr)):(righttop=1-interpolateX$1(maxV,tr,br),bottomleft=interpolateX$1(maxV,bl,br),leftbottom=interpolateX$1(maxV,bl,tl),topright=1-interpolateX$1(maxV,tr,tl)),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeBL[cval])):cval===102?(flipped===0?(rightbottom=1-interpolateX$1(minV,tr,br),bottomright=interpolateX$1(minV,bl,br),lefttop=interpolateX$1(minV,bl,tl),topleft=1-interpolateX$1(minV,tr,tl)):(rightbottom=interpolateX$1(maxV,br,tr),bottomright=1-interpolateX$1(maxV,br,bl),lefttop=1-interpolateX$1(maxV,tl,bl),topleft=interpolateX$1(maxV,tl,tr)),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeLT[cval])):cval===155?(flipped===4?(righttop=interpolateX$1(minV,br,tr),bottomleft=1-interpolateX$1(minV,br,bl),leftbottom=1-interpolateX$1(minV,tl,bl),topright=interpolateX$1(minV,tl,tr)):(righttop=1-interpolateX$1(maxV,tr,br),bottomleft=interpolateX$1(maxV,bl,br),leftbottom=interpolateX$1(maxV,bl,tl),topright=1-interpolateX$1(maxV,tr,tl)),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeLB[cval])):cval===103?(flipped===4?(rightbottom=1-interpolateX$1(minV,tr,br),bottomright=interpolateX$1(minV,bl,br),lefttop=interpolateX$1(minV,bl,tl),topleft=1-interpolateX$1(minV,tr,tl)):(rightbottom=interpolateX$1(maxV,br,tr),bottomright=1-interpolateX$1(maxV,br,bl),lefttop=1-interpolateX$1(maxV,tl,bl),topleft=interpolateX$1(maxV,tl,tr)),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeBR[cval])):cval===152?(flipped===0?(righttop=interpolateX$1(minV,br,tr),bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),topright=interpolateX$1(minV,tl,tr)):(righttop=1-interpolateX$1(maxV,tr,br),bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),topright=1-interpolateX$1(maxV,tr,tl)),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeBR[cval]),edges2.push(isoBandEdgeBL[cval])):cval===156?(flipped===4?(righttop=interpolateX$1(minV,br,tr),bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),topright=interpolateX$1(minV,tl,tr)):(righttop=1-interpolateX$1(maxV,tr,br),bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),topright=1-interpolateX$1(maxV,tr,tl)),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeBL[cval]),edges2.push(isoBandEdgeLT[cval])):cval===137?(flipped===0?(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),bottomleft=1-interpolateX$1(minV,br,bl),leftbottom=1-interpolateX$1(minV,tl,bl),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr)):(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),bottomleft=interpolateX$1(maxV,bl,br),leftbottom=interpolateX$1(maxV,bl,tl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl)),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeBL[cval])):cval===139?(flipped===4?(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),bottomleft=1-interpolateX$1(minV,br,bl),leftbottom=1-interpolateX$1(minV,tl,bl),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr)):(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),bottomleft=interpolateX$1(maxV,bl,br),leftbottom=interpolateX$1(maxV,bl,tl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl)),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeLB[cval])):cval===98?(flipped===0?(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),lefttop=interpolateX$1(minV,bl,tl),topleft=1-interpolateX$1(minV,tr,tl)):(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),lefttop=1-interpolateX$1(maxV,tl,bl),topleft=interpolateX$1(maxV,tl,tr)),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeLT[cval])):cval===99?(flipped===4?(righttop=1-interpolateX$1(minV,tr,br),rightbottom=1-interpolateX$1(maxV,tr,br),bottomright=interpolateX$1(maxV,bl,br),bottomleft=interpolateX$1(minV,bl,br),lefttop=interpolateX$1(minV,bl,tl),topleft=1-interpolateX$1(minV,tr,tl)):(righttop=interpolateX$1(maxV,br,tr),rightbottom=interpolateX$1(minV,br,tr),bottomright=1-interpolateX$1(minV,br,bl),bottomleft=1-interpolateX$1(maxV,br,bl),lefttop=1-interpolateX$1(maxV,tl,bl),topleft=interpolateX$1(maxV,tl,tr)),edges2.push(isoBandEdgeRT[cval]),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeBL[cval])):cval===38?(flipped===0?(rightbottom=1-interpolateX$1(minV,tr,br),bottomright=interpolateX$1(minV,bl,br),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl)):(rightbottom=interpolateX$1(maxV,br,tr),bottomright=1-interpolateX$1(maxV,br,bl),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr)),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeLB[cval]),edges2.push(isoBandEdgeLT[cval])):cval===39?(flipped===4?(rightbottom=1-interpolateX$1(minV,tr,br),bottomright=interpolateX$1(minV,bl,br),leftbottom=interpolateX$1(minV,bl,tl),lefttop=interpolateX$1(maxV,bl,tl),topleft=1-interpolateX$1(maxV,tr,tl),topright=1-interpolateX$1(minV,tr,tl)):(rightbottom=interpolateX$1(maxV,br,tr),bottomright=1-interpolateX$1(maxV,br,bl),leftbottom=1-interpolateX$1(maxV,tl,bl),lefttop=1-interpolateX$1(minV,tl,bl),topleft=interpolateX$1(minV,tl,tr),topright=interpolateX$1(maxV,tl,tr)),edges2.push(isoBandEdgeRB[cval]),edges2.push(isoBandEdgeBR[cval]),edges2.push(isoBandEdgeLT[cval])):cval===85&&(righttop=1,rightbottom=0,bottomright=1,bottomleft=0,leftbottom=0,lefttop=1,topleft=0,topright=1),(topleft<0||topleft>1||topright<0||topright>1||righttop<0||righttop>1||bottomright<0||bottomright>1||leftbottom<0||leftbottom>1||lefttop<0||lefttop>1)&&console.log("MarchingSquaresJS-isoBands: "+cval+" "+cval_real+" "+tl+","+tr+","+br+","+bl+" "+flipped+" "+topleft+" "+topright+" "+righttop+" "+rightbottom+" "+bottomright+" "+bottomleft+" "+leftbottom+" "+lefttop),BandGrid.cells[j][i]={cval,cval_real,flipped,topleft,topright,righttop,rightbottom,bottomright,bottomleft,leftbottom,lefttop,edges:edges2}}}}}return BandGrid}function BandGrid2AreaPaths(grid){for(var areas=[],rows=grid.rows,cols=grid.cols,currentPolygon=[],j=0;j<rows;j++)for(var i=0;i<cols;i++)if(typeof grid.cells[j][i]<"u"&&grid.cells[j][i].edges.length>0){var cell=grid.cells[j][i],prev=getStartXY(cell),next3=null,p=i,q=j;prev!==null&&currentPolygon.push([prev.p[0]+p,prev.p[1]+q]);do{if(next3=getExitXY(grid.cells[q][p],prev.x,prev.y,prev.o),next3!==null)currentPolygon.push([next3.p[0]+p,next3.p[1]+q]),p+=next3.x,q+=next3.y,prev=next3;else break;if(q<0||q>=rows||p<0||p>=cols||typeof grid.cells[q][p]>"u"){p-=next3.x,q-=next3.y;var missing=traceOutOfGridPath(grid,p,q,next3.x,next3.y,next3.o);if(missing!==null)missing.path.forEach(function(pp){currentPolygon.push(pp)}),p=missing.i,q=missing.j,prev=missing;else break}}while(typeof grid.cells[q][p]<"u"&&grid.cells[q][p].edges.length>0);areas.push(currentPolygon),currentPolygon=[],grid.cells[j][i].edges.length>0&&i--}return areas}function traceOutOfGridPath(grid,i,j,d_x,d_y,d_o){for(var cell=grid.cells[j][i],cval=cell.cval_real,p=i+d_x,q=j+d_y,path=[],closed=!1;!closed;){if(typeof grid.cells[q]>"u"||typeof grid.cells[q][p]>"u")if(q-=d_y,p-=d_x,cell=grid.cells[q][p],cval=cell.cval_real,d_y===-1)if(d_o===0)if(cval&Node3)path.push([p,q]),d_x=-1,d_y=0,d_o=0;else if(cval&Node22)path.push([p+1,q]),d_x=1,d_y=0,d_o=0;else{path.push([p+cell.bottomright,q]),d_x=0,d_y=1,d_o=1,closed=!0;break}else if(cval&Node3)path.push([p,q]),d_x=-1,d_y=0,d_o=0;else if(cval&Node22){path.push([p+cell.bottomright,q]),d_x=0,d_y=1,d_o=1,closed=!0;break}else{path.push([p+cell.bottomleft,q]),d_x=0,d_y=1,d_o=0,closed=!0;break}else if(d_y===1)if(d_o===0)if(cval&Node1)path.push([p+1,q+1]),d_x=1,d_y=0,d_o=1;else if(cval&Node0){path.push([p+cell.topleft,q+1]),d_x=0,d_y=-1,d_o=0,closed=!0;break}else{path.push([p+cell.topright,q+1]),d_x=0,d_y=-1,d_o=1,closed=!0;break}else cval&Node1?(path.push([p+1,q+1]),d_x=1,d_y=0,d_o=1):(path.push([p+1,q+1]),d_x=1,d_y=0,d_o=1);else if(d_x===-1)if(d_o===0)if(cval&Node0)path.push([p,q+1]),d_x=0,d_y=1,d_o=0;else if(cval&Node3){path.push([p,q+cell.leftbottom]),d_x=1,d_y=0,d_o=0,closed=!0;break}else{path.push([p,q+cell.lefttop]),d_x=1,d_y=0,d_o=1,closed=!0;break}else if(cval&Node0)path.push([p,q+1]),d_x=0,d_y=1,d_o=0;else{console.log("MarchingSquaresJS-isoBands: wtf");break}else if(d_x===1)if(d_o===0)if(cval&Node22)path.push([p+1,q]),d_x=0,d_y=-1,d_o=1;else{path.push([p+1,q+cell.rightbottom]),d_x=-1,d_y=0,d_o=0,closed=!0;break}else if(cval&Node22)path.push([p+1,q]),d_x=0,d_y=-1,d_o=1;else if(cval&Node1){path.push([p+1,q+cell.righttop]),d_x=-1,d_y=0,d_o=1;break}else{path.push([p+1,q+cell.rightbottom]),d_x=-1,d_y=0,d_o=0,closed=!0;break}else{console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}else if(cell=grid.cells[q][p],cval=cell.cval_real,d_x===-1)if(d_o===0)if(typeof grid.cells[q-1]<"u"&&typeof grid.cells[q-1][p]<"u")d_x=0,d_y=-1,d_o=1;else if(cval&Node3)path.push([p,q]);else{path.push([p+cell.bottomright,q]),d_x=0,d_y=1,d_o=1,closed=!0;break}else if(cval&Node0)console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!");else{console.log("MarchingSquaresJS-isoBands: found entry from top at "+p+","+q);break}else if(d_x===1)if(d_o===0){console.log("MarchingSquaresJS-isoBands: wtf");break}else if(typeof grid.cells[q+1]<"u"&&typeof grid.cells[q+1][p]<"u")d_x=0,d_y=1,d_o=0;else if(cval&Node1)path.push([p+1,q+1]),d_x=1,d_y=0,d_o=1;else{path.push([p+cell.topleft,q+1]),d_x=0,d_y=-1,d_o=0,closed=!0;break}else if(d_y===-1)if(d_o===1)if(typeof grid.cells[q][p+1]<"u")d_x=1,d_y=0,d_o=1;else if(cval&Node22)path.push([p+1,q]),d_x=0,d_y=-1,d_o=1;else{path.push([p+1,q+cell.righttop]),d_x=-1,d_y=0,d_o=1,closed=!0;break}else{console.log("MarchingSquaresJS-isoBands: wtf");break}else if(d_y===1)if(d_o===0)if(typeof grid.cells[q][p-1]<"u")d_x=-1,d_y=0,d_o=0;else if(cval&Node0)path.push([p,q+1]),d_x=0,d_y=1,d_o=0;else{path.push([p,q+cell.leftbottom]),d_x=1,d_y=0,d_o=0,closed=!0;break}else{console.log("MarchingSquaresJS-isoBands: wtf");break}else{console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(p+=d_x,q+=d_y,p===i&&q===j)break}return{path,i:p,j:q,x:d_x,y:d_y,o:d_o}}function deleteEdge(cell,edgeIdx){delete cell.edges[edgeIdx];for(var k=edgeIdx+1;k<cell.edges.length;k++)cell.edges[k-1]=cell.edges[k];cell.edges.pop()}function getStartXY(cell){if(cell.edges.length>0){var e=cell.edges[cell.edges.length-1],cval=cell.cval_real;switch(e){case 0:return cval&Node1?{p:[1,cell.righttop],x:-1,y:0,o:1}:{p:[cell.topleft,1],x:0,y:-1,o:0};case 1:return cval&Node22?{p:[cell.topleft,1],x:0,y:-1,o:0}:{p:[1,cell.rightbottom],x:-1,y:0,o:0};case 2:return cval&Node22?{p:[cell.bottomright,0],x:0,y:1,o:1}:{p:[cell.topleft,1],x:0,y:-1,o:0};case 3:return cval&Node3?{p:[cell.topleft,1],x:0,y:-1,o:0}:{p:[cell.bottomleft,0],x:0,y:1,o:0};case 4:return cval&Node1?{p:[1,cell.righttop],x:-1,y:0,o:1}:{p:[cell.topright,1],x:0,y:-1,o:1};case 5:return cval&Node22?{p:[cell.topright,1],x:0,y:-1,o:1}:{p:[1,cell.rightbottom],x:-1,y:0,o:0};case 6:return cval&Node22?{p:[cell.bottomright,0],x:0,y:1,o:1}:{p:[cell.topright,1],x:0,y:-1,o:1};case 7:return cval&Node3?{p:[cell.topright,1],x:0,y:-1,o:1}:{p:[cell.bottomleft,0],x:0,y:1,o:0};case 8:return cval&Node22?{p:[cell.bottomright,0],x:0,y:1,o:1}:{p:[1,cell.righttop],x:-1,y:0,o:1};case 9:return cval&Node3?{p:[1,cell.righttop],x:-1,y:0,o:1}:{p:[cell.bottomleft,0],x:0,y:1,o:0};case 10:return cval&Node3?{p:[0,cell.leftbottom],x:1,y:0,o:0}:{p:[1,cell.righttop],x:-1,y:0,o:1};case 11:return cval&Node0?{p:[1,cell.righttop],x:-1,y:0,o:1}:{p:[0,cell.lefttop],x:1,y:0,o:1};case 12:return cval&Node22?{p:[cell.bottomright,0],x:0,y:1,o:1}:{p:[1,cell.rightbottom],x:-1,y:0,o:0};case 13:return cval&Node3?{p:[1,cell.rightbottom],x:-1,y:0,o:0}:{p:[cell.bottomleft,0],x:0,y:1,o:0};case 14:return cval&Node3?{p:[0,cell.leftbottom],x:1,y:0,o:0}:{p:[1,cell.rightbottom],x:-1,y:0,o:0};case 15:return cval&Node0?{p:[1,cell.rightbottom],x:-1,y:0,o:0}:{p:[0,cell.lefttop],x:1,y:0,o:1};case 16:return cval&Node22?{p:[cell.bottomright,0],x:0,y:1,o:1}:{p:[0,cell.leftbottom],x:1,y:0,o:0};case 17:return cval&Node0?{p:[cell.bottomright,0],x:0,y:1,o:1}:{p:[0,cell.lefttop],x:1,y:0,o:1};case 18:return cval&Node3?{p:[0,cell.leftbottom],x:1,y:0,o:0}:{p:[cell.bottomleft,0],x:0,y:1,o:0};case 19:return cval&Node0?{p:[cell.bottomleft,0],x:0,y:1,o:0}:{p:[0,cell.lefttop],x:1,y:0,o:1};case 20:return cval&Node0?{p:[cell.topleft,1],x:0,y:-1,o:0}:{p:[0,cell.leftbottom],x:1,y:0,o:0};case 21:return cval&Node1?{p:[0,cell.leftbottom],x:1,y:0,o:0}:{p:[cell.topright,1],x:0,y:-1,o:1};case 22:return cval&Node0?{p:[cell.topleft,1],x:0,y:-1,o:0}:{p:[0,cell.lefttop],x:1,y:0,o:1};case 23:return cval&Node1?{p:[0,cell.lefttop],x:1,y:0,o:1}:{p:[cell.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(cell);break}}return null}function getExitXY(cell,x2,y2,o){var e,id_x,d_x,d_y,cval=cell.cval,d_o;switch(x2){case-1:switch(o){case 0:e=isoBandEdgeRB[cval],d_x=isoBandNextXRB[cval],d_y=isoBandNextYRB[cval],d_o=isoBandNextORB[cval];break;default:e=isoBandEdgeRT[cval],d_x=isoBandNextXRT[cval],d_y=isoBandNextYRT[cval],d_o=isoBandNextORT[cval];break}break;case 1:switch(o){case 0:e=isoBandEdgeLB[cval],d_x=isoBandNextXLB[cval],d_y=isoBandNextYLB[cval],d_o=isoBandNextOLB[cval];break;default:e=isoBandEdgeLT[cval],d_x=isoBandNextXLT[cval],d_y=isoBandNextYLT[cval],d_o=isoBandNextOLT[cval];break}break;default:switch(y2){case-1:switch(o){case 0:e=isoBandEdgeTL[cval],d_x=isoBandNextXTL[cval],d_y=isoBandNextYTL[cval],d_o=isoBandNextOTL[cval];break;default:e=isoBandEdgeTR[cval],d_x=isoBandNextXTR[cval],d_y=isoBandNextYTR[cval],d_o=isoBandNextOTR[cval];break}break;case 1:switch(o){case 0:e=isoBandEdgeBL[cval],d_x=isoBandNextXBL[cval],d_y=isoBandNextYBL[cval],d_o=isoBandNextOBL[cval];break;default:e=isoBandEdgeBR[cval],d_x=isoBandNextXBR[cval],d_y=isoBandNextYBR[cval],d_o=isoBandNextOBR[cval];break}break;default:break}break}if(id_x=cell.edges.indexOf(e),typeof cell.edges[id_x]<"u")deleteEdge(cell,id_x);else return null;switch(cval=cell.cval_real,e){case 0:cval&Node1?(x2=cell.topleft,y2=1):(x2=1,y2=cell.righttop);break;case 1:cval&Node22?(x2=1,y2=cell.rightbottom):(x2=cell.topleft,y2=1);break;case 2:cval&Node22?(x2=cell.topleft,y2=1):(x2=cell.bottomright,y2=0);break;case 3:cval&Node3?(x2=cell.bottomleft,y2=0):(x2=cell.topleft,y2=1);break;case 4:cval&Node1?(x2=cell.topright,y2=1):(x2=1,y2=cell.righttop);break;case 5:cval&Node22?(x2=1,y2=cell.rightbottom):(x2=cell.topright,y2=1);break;case 6:cval&Node22?(x2=cell.topright,y2=1):(x2=cell.bottomright,y2=0);break;case 7:cval&Node3?(x2=cell.bottomleft,y2=0):(x2=cell.topright,y2=1);break;case 8:cval&Node22?(x2=1,y2=cell.righttop):(x2=cell.bottomright,y2=0);break;case 9:cval&Node3?(x2=cell.bottomleft,y2=0):(x2=1,y2=cell.righttop);break;case 10:cval&Node3?(x2=1,y2=cell.righttop):(x2=0,y2=cell.leftbottom);break;case 11:cval&Node0?(x2=0,y2=cell.lefttop):(x2=1,y2=cell.righttop);break;case 12:cval&Node22?(x2=1,y2=cell.rightbottom):(x2=cell.bottomright,y2=0);break;case 13:cval&Node3?(x2=cell.bottomleft,y2=0):(x2=1,y2=cell.rightbottom);break;case 14:cval&Node3?(x2=1,y2=cell.rightbottom):(x2=0,y2=cell.leftbottom);break;case 15:cval&Node0?(x2=0,y2=cell.lefttop):(x2=1,y2=cell.rightbottom);break;case 16:cval&Node22?(x2=0,y2=cell.leftbottom):(x2=cell.bottomright,y2=0);break;case 17:cval&Node0?(x2=0,y2=cell.lefttop):(x2=cell.bottomright,y2=0);break;case 18:cval&Node3?(x2=cell.bottomleft,y2=0):(x2=0,y2=cell.leftbottom);break;case 19:cval&Node0?(x2=0,y2=cell.lefttop):(x2=cell.bottomleft,y2=0);break;case 20:cval&Node0?(x2=0,y2=cell.leftbottom):(x2=cell.topleft,y2=1);break;case 21:cval&Node1?(x2=cell.topright,y2=1):(x2=0,y2=cell.leftbottom);break;case 22:cval&Node0?(x2=0,y2=cell.lefttop):(x2=cell.topleft,y2=1);break;case 23:cval&Node1?(x2=cell.topright,y2=1):(x2=0,y2=cell.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(cell),null}return(typeof x2>"u"||typeof y2>"u"||typeof d_x>"u"||typeof d_y>"u"||typeof d_o>"u")&&(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(cell),console.log(x2+" "+y2+" "+d_x+" "+d_y+" "+d_o)),{p:[x2,y2],x:d_x,y:d_y,o:d_o}}function BandGrid2Areas(grid){var areas=[],area_idx=0;return grid.cells.forEach(function(g,j){g.forEach(function(gg,i){if(typeof gg<"u"){var a=polygon_table[gg.cval](gg);typeof a=="object"&&isArray(a)?typeof a[0]=="object"&&isArray(a[0])?typeof a[0][0]=="object"&&isArray(a[0][0])?a.forEach(function(aa){aa.forEach(function(aaa){aaa[0]+=i,aaa[1]+=j}),areas[area_idx++]=aa}):(a.forEach(function(aa){aa[0]+=i,aa[1]+=j}),areas[area_idx++]=a):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}})}),areas}function isobands(pointGrid2,breaks,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var zProperty=options.zProperty||"elevation",commonProperties=options.commonProperties||{},breaksProperties=options.breaksProperties||[];if(collectionOf(pointGrid2,"Point","Input must contain Points"),!breaks)throw new Error("breaks is required");if(!Array.isArray(breaks))throw new Error("breaks is not an Array");if(!isObject(commonProperties))throw new Error("commonProperties is not an Object");if(!Array.isArray(breaksProperties))throw new Error("breaksProperties is not an Array");var matrix=gridToMatrix$1(pointGrid2,{zProperty,flip:!0}),contours=createContourLines(matrix,breaks,zProperty);contours=rescaleContours(contours,matrix,pointGrid2);var multipolygons=contours.map(function(contour,index){if(breaksProperties[index]&&!isObject(breaksProperties[index]))throw new Error("Each mappedProperty is required to be an Object");var contourProperties=Object.assign({},commonProperties,breaksProperties[index]);contourProperties[zProperty]=contour[zProperty];var multiP=multiPolygon(contour.groupedRings,contourProperties);return multiP});return featureCollection(multipolygons)}function createContourLines(matrix,breaks,property){for(var contours=[],i=1;i<breaks.length;i++){var lowerBand=+breaks[i-1],upperBand=+breaks[i],isobandsCoords=isoBands(matrix,lowerBand,upperBand-lowerBand),nestedRings=orderByArea(isobandsCoords),groupedRings=groupNestedRings(nestedRings),obj={};obj.groupedRings=groupedRings,obj[property]=lowerBand+"-"+upperBand,contours.push(obj)}return contours}function rescaleContours(contours,matrix,points$$1){var gridBbox=bbox(points$$1),originalWidth=gridBbox[2]-gridBbox[0],originalHeigth=gridBbox[3]-gridBbox[1],x0=gridBbox[0],y0=gridBbox[1],matrixWidth=matrix[0].length-1,matrixHeight=matrix.length-1,scaleX=originalWidth/matrixWidth,scaleY=originalHeigth/matrixHeight,resize=function(point$$1){point$$1[0]=point$$1[0]*scaleX+x0,point$$1[1]=point$$1[1]*scaleY+y0};return contours.forEach(function(contour){contour.groupedRings.forEach(function(lineRingSet){lineRingSet.forEach(function(lineRing){lineRing.forEach(resize)})})}),contours}function orderByArea(ringsCoords){var ringsWithArea=[],areas=[];ringsCoords.forEach(function(coords){var ringArea2=area$1(polygon([coords]));areas.push(ringArea2),ringsWithArea.push({ring:coords,area:ringArea2})}),areas.sort(function(a,b){return b-a});var orderedByArea=[];return areas.forEach(function(area$$1){for(var lr=0;lr<ringsWithArea.length;lr++)if(ringsWithArea[lr].area===area$$1){orderedByArea.push(ringsWithArea[lr].ring),ringsWithArea.splice(lr,1);break}}),orderedByArea}function groupNestedRings(orderedLinearRings){for(var lrList=orderedLinearRings.map(function(lr){return{lrCoordinates:lr,grouped:!1}}),groupedLinearRingsCoords=[];!allGrouped(lrList);)for(var i=0;i<lrList.length;i++)if(!lrList[i].grouped){var group=[];group.push(lrList[i].lrCoordinates),lrList[i].grouped=!0;for(var outerMostPoly=polygon([lrList[i].lrCoordinates]),j=i+1;j<lrList.length;j++)if(!lrList[j].grouped){var lrPoly=polygon([lrList[j].lrCoordinates]);isInside(lrPoly,outerMostPoly)&&(group.push(lrList[j].lrCoordinates),lrList[j].grouped=!0)}groupedLinearRingsCoords.push(group)}return groupedLinearRingsCoords}function isInside(testPolygon,targetPolygon){for(var points$$1=explode(testPolygon),i=0;i<points$$1.features.length;i++)if(!booleanPointInPolygon(points$$1.features[i],targetPolygon))return!1;return!0}function allGrouped(list){for(var i=0;i<list.length;i++)if(list[i].grouped===!1)return!1;return!0}function transformRotate(geojson,angle3,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var pivot=options.pivot,mutate=options.mutate;if(!geojson)throw new Error("geojson is required");if(angle3==null||isNaN(angle3))throw new Error("angle is required");return angle3===0||(pivot||(pivot=centroid(geojson)),(mutate===!1||mutate===void 0)&&(geojson=clone2(geojson)),coordEach(geojson,function(pointCoords){var initialAngle=rhumbBearing(pivot,pointCoords),finalAngle=initialAngle+angle3,distance12=rhumbDistance(pivot,pointCoords),newCoords=getCoords(rhumbDestination(pivot,distance12,finalAngle));pointCoords[0]=newCoords[0],pointCoords[1]=newCoords[1]})),geojson}function transformScale(geojson,factor,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var origin=options.origin,mutate=options.mutate;if(!geojson)throw new Error("geojson required");if(typeof factor!="number"||factor===0)throw new Error("invalid factor");var originIsPoint=Array.isArray(origin)||typeof origin=="object";return mutate!==!0&&(geojson=clone2(geojson)),geojson.type==="FeatureCollection"&&!originIsPoint?(featureEach(geojson,function(feature$$1,index){geojson.features[index]=scale(feature$$1,factor,origin)}),geojson):scale(geojson,factor,origin)}function scale(feature$$1,factor,origin){var isPoint=getType(feature$$1)==="Point";return origin=defineOrigin(feature$$1,origin),factor===1||isPoint||coordEach(feature$$1,function(coord){var originalDistance=rhumbDistance(origin,coord),bearing2=rhumbBearing(origin,coord),newDistance=originalDistance*factor,newCoord=getCoords(rhumbDestination(origin,newDistance,bearing2));coord[0]=newCoord[0],coord[1]=newCoord[1],coord.length===3&&(coord[2]*=factor)}),feature$$1}function defineOrigin(geojson,origin){if(origin==null&&(origin="centroid"),Array.isArray(origin)||typeof origin=="object")return getCoord(origin);var bbox$$1=geojson.bbox?geojson.bbox:bbox(geojson),west=bbox$$1[0],south=bbox$$1[1],east=bbox$$1[2],north=bbox$$1[3];switch(origin){case"sw":case"southwest":case"westsouth":case"bottomleft":return point([west,south]);case"se":case"southeast":case"eastsouth":case"bottomright":return point([east,south]);case"nw":case"northwest":case"westnorth":case"topleft":return point([west,north]);case"ne":case"northeast":case"eastnorth":case"topright":return point([east,north]);case"center":return center(geojson);case void 0:case null:case"centroid":return centroid(geojson);default:throw new Error("invalid origin")}}function transformTranslate(geojson,distance12,direction,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var units=options.units,zTranslation=options.zTranslation,mutate=options.mutate;if(!geojson)throw new Error("geojson is required");if(distance12==null||isNaN(distance12))throw new Error("distance is required");if(zTranslation&&typeof zTranslation!="number"&&isNaN(zTranslation))throw new Error("zTranslation is not a number");if(zTranslation=zTranslation!==void 0?zTranslation:0,distance12===0&&zTranslation===0)return geojson;if(direction==null||isNaN(direction))throw new Error("direction is required");return distance12<0&&(distance12=-distance12,direction=-direction),(mutate===!1||mutate===void 0)&&(geojson=clone2(geojson)),coordEach(geojson,function(pointCoords){var newCoords=getCoords(rhumbDestination(pointCoords,distance12,direction,{units}));pointCoords[0]=newCoords[0],pointCoords[1]=newCoords[1],zTranslation&&pointCoords.length===3&&(pointCoords[2]+=zTranslation)}),geojson}function ab(segment){var start2=segment[0],end=segment[1];return[end[0]-start2[0],end[1]-start2[1]]}function crossProduct(v1,v2){return v1[0]*v2[1]-v2[0]*v1[1]}function add(v1,v2){return[v1[0]+v2[0],v1[1]+v2[1]]}function sub(v1,v2){return[v1[0]-v2[0],v1[1]-v2[1]]}function scalarMult(s,v){return[s*v[0],s*v[1]]}function intersectSegments(a,b){var p=a[0],r=ab(a),q=b[0],s=ab(b),cross2=crossProduct(r,s),qmp=sub(q,p),numerator=crossProduct(qmp,s),t=numerator/cross2,intersection9=add(p,scalarMult(t,r));return intersection9}function isParallel(a,b){var r=ab(a),s=ab(b);return crossProduct(r,s)===0}function intersection(a,b){return isParallel(a,b)?!1:intersectSegments(a,b)}function lineOffset(geojson,distance12,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var units=options.units;if(!geojson)throw new Error("geojson is required");if(distance12==null||isNaN(distance12))throw new Error("distance is required");var type=getType(geojson),properties=geojson.properties;switch(type){case"LineString":return lineOffsetFeature(geojson,distance12,units);case"MultiLineString":var coords=[];return flattenEach(geojson,function(feature$$1){coords.push(lineOffsetFeature(feature$$1,distance12,units).geometry.coordinates)}),multiLineString(coords,properties);default:throw new Error("geometry "+type+" is not supported")}}function lineOffsetFeature(line,distance12,units){var segments=[],offsetDegrees=lengthToDegrees(distance12,units),coords=getCoords(line),finalCoords=[];return coords.forEach(function(currentCoords,index){if(index!==coords.length-1){var segment=processSegment(currentCoords,coords[index+1],offsetDegrees);if(segments.push(segment),index>0){var seg2Coords=segments[index-1],intersects7=intersection(segment,seg2Coords);intersects7!==!1&&(seg2Coords[1]=intersects7,segment[0]=intersects7),finalCoords.push(seg2Coords[0]),index===coords.length-2&&(finalCoords.push(segment[0]),finalCoords.push(segment[1]))}coords.length===2&&(finalCoords.push(segment[0]),finalCoords.push(segment[1]))}}),lineString(finalCoords,line.properties)}function processSegment(point1,point22,offset){var L=Math.sqrt((point1[0]-point22[0])*(point1[0]-point22[0])+(point1[1]-point22[1])*(point1[1]-point22[1])),out1x=point1[0]+offset*(point22[1]-point1[1])/L,out2x=point22[0]+offset*(point22[1]-point1[1])/L,out1y=point1[1]+offset*(point1[0]-point22[0])/L,out2y=point22[1]+offset*(point1[0]-point22[0])/L;return[[out1x,out1y],[out2x,out2y]]}function orientationIndex(p1,p2,q){var dx1=p2[0]-p1[0],dy1=p2[1]-p1[1],dx2=q[0]-p2[0],dy2=q[1]-p2[1];return Math.sign(dx1*dy2-dx2*dy1)}function envelopeIsEqual(env1,env2){var envX1=env1.geometry.coordinates.map(function(c){return c[0]}),envY1=env1.geometry.coordinates.map(function(c){return c[1]}),envX2=env2.geometry.coordinates.map(function(c){return c[0]}),envY2=env2.geometry.coordinates.map(function(c){return c[1]});return Math.max(null,envX1)===Math.max(null,envX2)&&Math.max(null,envY1)===Math.max(null,envY2)&&Math.min(null,envX1)===Math.min(null,envX2)&&Math.min(null,envY1)===Math.min(null,envY2)}function envelopeContains(self,env){return env.geometry.coordinates[0].every(function(c){return booleanPointInPolygon(point(c),self)})}function coordinatesEqual(coord1,coord2){return coord1[0]===coord2[0]&&coord1[1]===coord2[1]}var Node$1=function Node4(coordinates){this.id=Node4.buildId(coordinates),this.coordinates=coordinates,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1};Node$1.buildId=function(coordinates){return coordinates.join(",")};Node$1.prototype.removeInnerEdge=function(edge){this.innerEdges=this.innerEdges.filter(function(e){return e.from.id!==edge.from.id})};Node$1.prototype.removeOuterEdge=function(edge){this.outerEdges=this.outerEdges.filter(function(e){return e.to.id!==edge.to.id})};Node$1.prototype.addOuterEdge=function(edge){this.outerEdges.push(edge),this.outerEdgesSorted=!1};Node$1.prototype.sortOuterEdges=function(){var this$1=this;this.outerEdgesSorted||(this.outerEdges.sort(function(a,b){var aNode=a.to,bNode=b.to;if(aNode.coordinates[0]-this$1.coordinates[0]>=0&&bNode.coordinates[0]-this$1.coordinates[0]<0)return 1;if(aNode.coordinates[0]-this$1.coordinates[0]<0&&bNode.coordinates[0]-this$1.coordinates[0]>=0)return-1;if(aNode.coordinates[0]-this$1.coordinates[0]===0&&bNode.coordinates[0]-this$1.coordinates[0]===0)return aNode.coordinates[1]-this$1.coordinates[1]>=0||bNode.coordinates[1]-this$1.coordinates[1]>=0?aNode.coordinates[1]-bNode.coordinates[1]:bNode.coordinates[1]-aNode.coordinates[1];var det2=orientationIndex(this$1.coordinates,aNode.coordinates,bNode.coordinates);if(det2<0)return 1;if(det2>0)return-1;var d1=Math.pow(aNode.coordinates[0]-this$1.coordinates[0],2)+Math.pow(aNode.coordinates[1]-this$1.coordinates[1],2),d2=Math.pow(bNode.coordinates[0]-this$1.coordinates[0],2)+Math.pow(bNode.coordinates[1]-this$1.coordinates[1],2);return d1-d2}),this.outerEdgesSorted=!0)};Node$1.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges};Node$1.prototype.getOuterEdge=function(i){return this.sortOuterEdges(),this.outerEdges[i]};Node$1.prototype.addInnerEdge=function(edge){this.innerEdges.push(edge)};var Edge=function(from,to){this.from=from,this.to=to,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)};Edge.prototype.getSymetric=function(){return this.symetric||(this.symetric=new Edge(this.to,this.from),this.symetric.symetric=this),this.symetric};Edge.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)};Edge.prototype.isEqual=function(edge){return this.from.id===edge.from.id&&this.to.id===edge.to.id};Edge.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"};Edge.prototype.toLineString=function(){return lineString([this.from.coordinates,this.to.coordinates])};Edge.prototype.compareTo=function(edge){return orientationIndex(edge.from.coordinates,edge.to.coordinates,this.to.coordinates)};var EdgeRing=function(){this.edges=[],this.polygon=void 0,this.envelope=void 0},prototypeAccessors={length:{configurable:!0}};EdgeRing.prototype.push=function(edge){this[this.edges.length]=edge,this.edges.push(edge),this.polygon=this.envelope=void 0};EdgeRing.prototype.get=function(i){return this.edges[i]};prototypeAccessors.length.get=function(){return this.edges.length};EdgeRing.prototype.forEach=function(f){this.edges.forEach(f)};EdgeRing.prototype.map=function(f){return this.edges.map(f)};EdgeRing.prototype.some=function(f){return this.edges.some(f)};EdgeRing.prototype.isValid=function(){return!0};EdgeRing.prototype.isHole=function(){var this$1=this,hiIndex=this.edges.reduce(function(high,edge,i){return edge.from.coordinates[1]>this$1.edges[high].from.coordinates[1]&&(high=i),high},0),iPrev=(hiIndex===0?this.length:hiIndex)-1,iNext=(hiIndex+1)%this.length,disc=orientationIndex(this.edges[iPrev].from.coordinates,this.edges[hiIndex].from.coordinates,this.edges[iNext].from.coordinates);return disc===0?this.edges[iPrev].from.coordinates[0]>this.edges[iNext].from.coordinates[0]:disc>0};EdgeRing.prototype.toMultiPoint=function(){return multiPoint(this.edges.map(function(edge){return edge.from.coordinates}))};EdgeRing.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var coordinates=this.edges.map(function(edge){return edge.from.coordinates});return coordinates.push(this.edges[0].from.coordinates),this.polygon=polygon([coordinates])};EdgeRing.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=envelope(this.toPolygon())};EdgeRing.findEdgeRingContaining=function(testEdgeRing,shellList){var testEnvelope=testEdgeRing.getEnvelope(),minEnvelope,minShell;return shellList.forEach(function(shell){var tryEnvelope=shell.getEnvelope();if(minShell&&(minEnvelope=minShell.getEnvelope()),!envelopeIsEqual(tryEnvelope,testEnvelope)&&envelopeContains(tryEnvelope,testEnvelope)){var testPoint=testEdgeRing.map(function(edge){return edge.from.coordinates}).find(function(pt){return!shell.some(function(edge){return coordinatesEqual(pt,edge.from.coordinates)})});testPoint&&shell.inside(point(testPoint))&&(!minShell||envelopeContains(minEnvelope,tryEnvelope))&&(minShell=shell)}}),minShell};EdgeRing.prototype.inside=function(pt){return booleanPointInPolygon(pt,this.toPolygon())};Object.defineProperties(EdgeRing.prototype,prototypeAccessors);function validateGeoJson(geoJson){if(!geoJson)throw new Error("No geojson passed");if(geoJson.type!=="FeatureCollection"&&geoJson.type!=="GeometryCollection"&&geoJson.type!=="MultiLineString"&&geoJson.type!=="LineString"&&geoJson.type!=="Feature")throw new Error("Invalid input type '"+geoJson.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}var Graph=function(){this.edges=[],this.nodes={}};Graph.fromGeoJson=function(geoJson){validateGeoJson(geoJson);var graph=new Graph;return flattenEach(geoJson,function(feature$$1){featureOf(feature$$1,"LineString","Graph::fromGeoJson"),coordReduce(feature$$1,function(prev,cur){if(prev){var start2=graph.getNode(prev),end=graph.getNode(cur);graph.addEdge(start2,end)}return cur})}),graph};Graph.prototype.getNode=function(coordinates){var id=Node$1.buildId(coordinates),node=this.nodes[id];return node||(node=this.nodes[id]=new Node$1(coordinates)),node};Graph.prototype.addEdge=function(from,to){var edge=new Edge(from,to),symetricEdge=edge.getSymetric();this.edges.push(edge),this.edges.push(symetricEdge)};Graph.prototype.deleteDangles=function(){var this$1=this;Object.keys(this.nodes).map(function(id){return this$1.nodes[id]}).forEach(function(node){return this$1._removeIfDangle(node)})};Graph.prototype._removeIfDangle=function(node){var this$1=this;if(node.innerEdges.length<=1){var outerNodes=node.getOuterEdges().map(function(e){return e.to});this.removeNode(node),outerNodes.forEach(function(n){return this$1._removeIfDangle(n)})}};Graph.prototype.deleteCutEdges=function(){var this$1=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(edge){edge.label===edge.symetric.label&&(this$1.removeEdge(edge.symetric),this$1.removeEdge(edge))})};Graph.prototype._computeNextCWEdges=function(node){var this$1=this;typeof node>"u"?Object.keys(this.nodes).forEach(function(id){return this$1._computeNextCWEdges(this$1.nodes[id])}):node.getOuterEdges().forEach(function(edge,i){node.getOuterEdge((i===0?node.getOuterEdges().length:i)-1).symetric.next=edge})};Graph.prototype._computeNextCCWEdges=function(node,label){for(var edges2=node.getOuterEdges(),firstOutDE,prevInDE,i=edges2.length-1;i>=0;--i){var de=edges2[i],sym=de.symetric,outDE=void 0,inDE=void 0;de.label===label&&(outDE=de),sym.label===label&&(inDE=sym),!(!outDE||!inDE)&&(inDE&&(prevInDE=inDE),outDE&&(prevInDE&&(prevInDE.next=outDE,prevInDE=void 0),firstOutDE||(firstOutDE=outDE)))}prevInDE&&(prevInDE.next=firstOutDE)};Graph.prototype._findLabeledEdgeRings=function(){var edgeRingStarts=[],label=0;return this.edges.forEach(function(edge){if(!(edge.label>=0)){edgeRingStarts.push(edge);var e=edge;do e.label=label,e=e.next;while(!edge.isEqual(e));label++}}),edgeRingStarts};Graph.prototype.getEdgeRings=function(){var this$1=this;this._computeNextCWEdges(),this.edges.forEach(function(edge){edge.label=void 0}),this._findLabeledEdgeRings().forEach(function(edge){this$1._findIntersectionNodes(edge).forEach(function(node){this$1._computeNextCCWEdges(node,edge.label)})});var edgeRingList=[];return this.edges.forEach(function(edge){edge.ring||edgeRingList.push(this$1._findEdgeRing(edge))}),edgeRingList};Graph.prototype._findIntersectionNodes=function(startEdge){var intersectionNodes=[],edge=startEdge,loop=function(){var degree=0;edge.from.getOuterEdges().forEach(function(e){e.label===startEdge.label&&++degree}),degree>1&&intersectionNodes.push(edge.from),edge=edge.next};do loop();while(!startEdge.isEqual(edge));return intersectionNodes};Graph.prototype._findEdgeRing=function(startEdge){var edge=startEdge,edgeRing=new EdgeRing;do edgeRing.push(edge),edge.ring=edgeRing,edge=edge.next;while(!startEdge.isEqual(edge));return edgeRing};Graph.prototype.removeNode=function(node){var this$1=this;node.getOuterEdges().forEach(function(edge){return this$1.removeEdge(edge)}),node.innerEdges.forEach(function(edge){return this$1.removeEdge(edge)}),delete this.nodes[node.id]};Graph.prototype.removeEdge=function(edge){this.edges=this.edges.filter(function(e){return!e.isEqual(edge)}),edge.deleteEdge()};function polygonize$1(geoJson){var graph=Graph.fromGeoJson(geoJson);graph.deleteDangles(),graph.deleteCutEdges();var holes=[],shells=[];return graph.getEdgeRings().filter(function(edgeRing){return edgeRing.isValid()}).forEach(function(edgeRing){edgeRing.isHole()?holes.push(edgeRing):shells.push(edgeRing)}),holes.forEach(function(hole){EdgeRing.findEdgeRingContaining(hole,shells)&&shells.push(hole)}),featureCollection(shells.map(function(shell){return shell.toPolygon()}))}function booleanDisjoint(feature1,feature2){var boolean;return flattenEach(feature1,function(flatten1){flattenEach(feature2,function(flatten2){if(boolean===!1)return!1;boolean=disjoint(flatten1.geometry,flatten2.geometry)})}),boolean}function disjoint(geom1,geom2){switch(geom1.type){case"Point":switch(geom2.type){case"Point":return!compareCoords$1(geom1.coordinates,geom2.coordinates);case"LineString":return!isPointOnLine$1(geom2,geom1);case"Polygon":return!booleanPointInPolygon(geom1,geom2)}break;case"LineString":switch(geom2.type){case"Point":return!isPointOnLine$1(geom1,geom2);case"LineString":return!isLineOnLine$1(geom1,geom2);case"Polygon":return!isLineInPoly$1(geom2,geom1)}break;case"Polygon":switch(geom2.type){case"Point":return!booleanPointInPolygon(geom2,geom1);case"LineString":return!isLineInPoly$1(geom1,geom2);case"Polygon":return!isPolyInPoly$1(geom2,geom1)}}}function isPointOnLine$1(lineString2,point4){for(var i=0;i<lineString2.coordinates.length-1;i++)if(isPointOnLineSegment$2(lineString2.coordinates[i],lineString2.coordinates[i+1],point4.coordinates))return!0;return!1}function isLineOnLine$1(lineString1,lineString2){var doLinesIntersect=lineIntersect(lineString1,lineString2);return doLinesIntersect.features.length>0}function isLineInPoly$1(polygon4,lineString2){var doLinesIntersect=lineIntersect(lineString2,polygonToLine(polygon4));return doLinesIntersect.features.length>0}function isPolyInPoly$1(feature1,feature2){for(var i=0;i<feature1.coordinates[0].length;i++)if(booleanPointInPolygon(feature1.coordinates[0][i],feature2))return!0;for(var i2=0;i2<feature2.coordinates[0].length;i2++)if(booleanPointInPolygon(feature2.coordinates[0][i2],feature1))return!0;return!1}function isPointOnLineSegment$2(LineSegmentStart,LineSegmentEnd,Point2){var dxc=Point2[0]-LineSegmentStart[0],dyc=Point2[1]-LineSegmentStart[1],dxl=LineSegmentEnd[0]-LineSegmentStart[0],dyl=LineSegmentEnd[1]-LineSegmentStart[1],cross2=dxc*dyl-dyc*dxl;return cross2!==0?!1:Math.abs(dxl)>=Math.abs(dyl)?dxl>0?LineSegmentStart[0]<=Point2[0]&&Point2[0]<=LineSegmentEnd[0]:LineSegmentEnd[0]<=Point2[0]&&Point2[0]<=LineSegmentStart[0]:dyl>0?LineSegmentStart[1]<=Point2[1]&&Point2[1]<=LineSegmentEnd[1]:LineSegmentEnd[1]<=Point2[1]&&Point2[1]<=LineSegmentStart[1]}function compareCoords$1(pair1,pair2){return pair1[0]===pair2[0]&&pair1[1]===pair2[1]}function booleanContains(feature1,feature2){var type1=getType(feature1),type2=getType(feature2),geom1=getGeom(feature1),geom2=getGeom(feature2),coords1=getCoords(feature1),coords2=getCoords(feature2);switch(type1){case"Point":switch(type2){case"Point":return compareCoords$2(coords1,coords2);default:throw new Error("feature2 "+type2+" geometry not supported")}case"MultiPoint":switch(type2){case"Point":return isPointInMultiPoint$1(geom1,geom2);case"MultiPoint":return isMultiPointInMultiPoint$1(geom1,geom2);default:throw new Error("feature2 "+type2+" geometry not supported")}case"LineString":switch(type2){case"Point":return booleanPointOnLine(geom2,geom1,{ignoreEndVertices:!0});case"LineString":return isLineOnLine$2(geom1,geom2);case"MultiPoint":return isMultiPointOnLine$1(geom1,geom2);default:throw new Error("feature2 "+type2+" geometry not supported")}case"Polygon":switch(type2){case"Point":return booleanPointInPolygon(geom2,geom1,{ignoreBoundary:!0});case"LineString":return isLineInPoly$2(geom1,geom2);case"Polygon":return isPolyInPoly$2(geom1,geom2);case"MultiPoint":return isMultiPointInPoly$1(geom1,geom2);default:throw new Error("feature2 "+type2+" geometry not supported")}default:throw new Error("feature1 "+type1+" geometry not supported")}}function isPointInMultiPoint$1(multiPoint2,point4){var i,output=!1;for(i=0;i<multiPoint2.coordinates.length;i++)if(compareCoords$2(multiPoint2.coordinates[i],point4.coordinates)){output=!0;break}return output}function isMultiPointInMultiPoint$1(multiPoint1,multiPoint2){for(var i=0;i<multiPoint2.coordinates.length;i++){for(var matchFound=!1,i2=0;i2<multiPoint1.coordinates.length;i2++)if(compareCoords$2(multiPoint2.coordinates[i],multiPoint1.coordinates[i2])){matchFound=!0;break}if(!matchFound)return!1}return!0}function isMultiPointOnLine$1(lineString2,multiPoint2){for(var haveFoundInteriorPoint=!1,i=0;i<multiPoint2.coordinates.length;i++)if(booleanPointOnLine(multiPoint2.coordinates[i],lineString2,{ignoreEndVertices:!0})&&(haveFoundInteriorPoint=!0),!booleanPointOnLine(multiPoint2.coordinates[i],lineString2))return!1;return!!haveFoundInteriorPoint}function isMultiPointInPoly$1(polygon4,multiPoint2){for(var i=0;i<multiPoint2.coordinates.length;i++)if(!booleanPointInPolygon(multiPoint2.coordinates[i],polygon4,{ignoreBoundary:!0}))return!1;return!0}function isLineOnLine$2(lineString1,lineString2){for(var haveFoundInteriorPoint=!1,i=0;i<lineString2.coordinates.length;i++)if(booleanPointOnLine({type:"Point",coordinates:lineString2.coordinates[i]},lineString1,{ignoreEndVertices:!0})&&(haveFoundInteriorPoint=!0),!booleanPointOnLine({type:"Point",coordinates:lineString2.coordinates[i]},lineString1,{ignoreEndVertices:!1}))return!1;return haveFoundInteriorPoint}function isLineInPoly$2(polygon4,linestring3){var output=!1,i=0,polyBbox=bbox(polygon4),lineBbox=bbox(linestring3);if(!doBBoxOverlap$1(polyBbox,lineBbox))return!1;for(i;i<linestring3.coordinates.length-1;i++){var midPoint3=getMidpoint$1(linestring3.coordinates[i],linestring3.coordinates[i+1]);if(booleanPointInPolygon({type:"Point",coordinates:midPoint3},polygon4,{ignoreBoundary:!0})){output=!0;break}}return output}function isPolyInPoly$2(feature1,feature2){var poly1Bbox=bbox(feature1),poly2Bbox=bbox(feature2);if(!doBBoxOverlap$1(poly1Bbox,poly2Bbox))return!1;for(var i=0;i<feature2.coordinates[0].length;i++)if(!booleanPointInPolygon(feature2.coordinates[0][i],feature1))return!1;return!0}function doBBoxOverlap$1(bbox1,bbox2){return!(bbox1[0]>bbox2[0]||bbox1[2]<bbox2[2]||bbox1[1]>bbox2[1]||bbox1[3]<bbox2[3])}function compareCoords$2(pair1,pair2){return pair1[0]===pair2[0]&&pair1[1]===pair2[1]}function getMidpoint$1(pair1,pair2){return[(pair1[0]+pair2[0])/2,(pair1[1]+pair2[1])/2]}function booleanCrosses(feature1,feature2){var type1=getType(feature1),type2=getType(feature2),geom1=getGeom(feature1),geom2=getGeom(feature2);switch(type1){case"MultiPoint":switch(type2){case"LineString":return doMultiPointAndLineStringCross(geom1,geom2);case"Polygon":return doesMultiPointCrossPoly(geom1,geom2);default:throw new Error("feature2 "+type2+" geometry not supported")}case"LineString":switch(type2){case"MultiPoint":return doMultiPointAndLineStringCross(geom2,geom1);case"LineString":return doLineStringsCross(geom1,geom2);case"Polygon":return doLineStringAndPolygonCross(geom1,geom2);default:throw new Error("feature2 "+type2+" geometry not supported")}case"Polygon":switch(type2){case"MultiPoint":return doesMultiPointCrossPoly(geom2,geom1);case"LineString":return doLineStringAndPolygonCross(geom2,geom1);default:throw new Error("feature2 "+type2+" geometry not supported")}default:throw new Error("feature1 "+type1+" geometry not supported")}}function doMultiPointAndLineStringCross(multiPoint$$1,lineString$$1){for(var foundIntPoint=!1,foundExtPoint=!1,pointLength=multiPoint$$1.coordinates.length,i=0;i<pointLength&&!foundIntPoint&&!foundExtPoint;){for(var i2=0;i2<lineString$$1.coordinates.length-1;i2++){var incEndVertices=!0;(i2===0||i2===lineString$$1.coordinates.length-2)&&(incEndVertices=!1),isPointOnLineSegment$3(lineString$$1.coordinates[i2],lineString$$1.coordinates[i2+1],multiPoint$$1.coordinates[i],incEndVertices)?foundIntPoint=!0:foundExtPoint=!0}i++}return foundIntPoint&&foundExtPoint}function doLineStringsCross(lineString1,lineString2){var doLinesIntersect=lineIntersect(lineString1,lineString2);if(doLinesIntersect.features.length>0)for(var i=0;i<lineString1.coordinates.length-1;i++)for(var i2=0;i2<lineString2.coordinates.length-1;i2++){var incEndVertices=!0;if((i2===0||i2===lineString2.coordinates.length-2)&&(incEndVertices=!1),isPointOnLineSegment$3(lineString1.coordinates[i],lineString1.coordinates[i+1],lineString2.coordinates[i2],incEndVertices))return!0}return!1}function doLineStringAndPolygonCross(lineString$$1,polygon$$1){var doLinesIntersect=lineIntersect(lineString$$1,polygonToLine(polygon$$1));return doLinesIntersect.features.length>0}function doesMultiPointCrossPoly(multiPoint$$1,polygon$$1){for(var foundIntPoint=!1,foundExtPoint=!1,pointLength=multiPoint$$1.coordinates[0].length,i=0;i<pointLength&&foundIntPoint&&foundExtPoint;)booleanPointInPolygon(point(multiPoint$$1.coordinates[0][i]),polygon$$1)?foundIntPoint=!0:foundExtPoint=!0,i++;return foundExtPoint&&foundExtPoint}function isPointOnLineSegment$3(lineSegmentStart,lineSegmentEnd,pt,incEnd){var dxc=pt[0]-lineSegmentStart[0],dyc=pt[1]-lineSegmentStart[1],dxl=lineSegmentEnd[0]-lineSegmentStart[0],dyl=lineSegmentEnd[1]-lineSegmentStart[1],cross2=dxc*dyl-dyc*dxl;return cross2!==0?!1:incEnd?Math.abs(dxl)>=Math.abs(dyl)?dxl>0?lineSegmentStart[0]<=pt[0]&&pt[0]<=lineSegmentEnd[0]:lineSegmentEnd[0]<=pt[0]&&pt[0]<=lineSegmentStart[0]:dyl>0?lineSegmentStart[1]<=pt[1]&&pt[1]<=lineSegmentEnd[1]:lineSegmentEnd[1]<=pt[1]&&pt[1]<=lineSegmentStart[1]:Math.abs(dxl)>=Math.abs(dyl)?dxl>0?lineSegmentStart[0]<pt[0]&&pt[0]<lineSegmentEnd[0]:lineSegmentEnd[0]<pt[0]&&pt[0]<lineSegmentStart[0]:dyl>0?lineSegmentStart[1]<pt[1]&&pt[1]<lineSegmentEnd[1]:lineSegmentEnd[1]<pt[1]&&pt[1]<lineSegmentStart[1]}var keys=createCommonjsModule(function(module,exports){exports=module.exports=typeof Object.keys=="function"?Object.keys:shim,exports.shim=shim;function shim(obj){var keys2=[];for(var key in obj)keys2.push(key);return keys2}}),keys_1=keys.shim,is_arguments=createCommonjsModule(function(module,exports){var supportsArgumentsClass=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";exports=module.exports=supportsArgumentsClass?supported:unsupported,exports.supported=supported;function supported(object2){return Object.prototype.toString.call(object2)=="[object Arguments]"}exports.unsupported=unsupported;function unsupported(object2){return object2&&typeof object2=="object"&&typeof object2.length=="number"&&Object.prototype.hasOwnProperty.call(object2,"callee")&&!Object.prototype.propertyIsEnumerable.call(object2,"callee")||!1}}),is_arguments_1=is_arguments.supported,is_arguments_2=is_arguments.unsupported,deepEqual_1=createCommonjsModule(function(module){var pSlice2=Array.prototype.slice,deepEqual2=module.exports=function(actual,expected,opts){return opts||(opts={}),actual===expected?!0:actual instanceof Date&&expected instanceof Date?actual.getTime()===expected.getTime():!actual||!expected||typeof actual!="object"&&typeof expected!="object"?opts.strict?actual===expected:actual==expected:objEquiv2(actual,expected,opts)};function isUndefinedOrNull2(value){return value==null}function isBuffer2(x2){return!(!x2||typeof x2!="object"||typeof x2.length!="number"||typeof x2.copy!="function"||typeof x2.slice!="function"||x2.length>0&&typeof x2[0]!="number")}function objEquiv2(a,b,opts){var i,key;if(isUndefinedOrNull2(a)||isUndefinedOrNull2(b)||a.prototype!==b.prototype)return!1;if(is_arguments(a))return is_arguments(b)?(a=pSlice2.call(a),b=pSlice2.call(b),deepEqual2(a,b,opts)):!1;if(isBuffer2(a)){if(!isBuffer2(b)||a.length!==b.length)return!1;for(i=0;i<a.length;i++)if(a[i]!==b[i])return!1;return!0}try{var ka=keys(a),kb=keys(b)}catch{return!1}if(ka.length!=kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!=kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!deepEqual2(a[key],b[key],opts))return!1;return typeof a==typeof b}}),Equality=function(opt){this.precision=opt&&opt.precision?opt.precision:17,this.direction=opt&&opt.direction?opt.direction:!1,this.pseudoNode=opt&&opt.pseudoNode?opt.pseudoNode:!1,this.objectComparator=opt&&opt.objectComparator?opt.objectComparator:objectComparator};Equality.prototype.compare=function(g1,g2){if(g1.type!==g2.type||!sameLength(g1,g2))return!1;switch(g1.type){case"Point":return this.compareCoord(g1.coordinates,g2.coordinates);case"LineString":return this.compareLine(g1.coordinates,g2.coordinates,0,!1);case"Polygon":return this.comparePolygon(g1,g2);case"Feature":return this.compareFeature(g1,g2);default:if(g1.type.indexOf("Multi")===0){var context=this,g1s=explode$2(g1),g2s=explode$2(g2);return g1s.every(function(g1part){return this.some(function(g2part){return context.compare(g1part,g2part)})},g2s)}}return!1};function explode$2(g){return g.coordinates.map(function(part){return{type:g.type.replace("Multi",""),coordinates:part}})}function sameLength(g1,g2){return g1.hasOwnProperty("coordinates")?g1.coordinates.length===g2.coordinates.length:g1.length===g2.length}Equality.prototype.compareCoord=function(c1,c2){if(c1.length!==c2.length)return!1;for(var i=0;i<c1.length;i++)if(c1[i].toFixed(this.precision)!==c2[i].toFixed(this.precision))return!1;return!0};Equality.prototype.compareLine=function(path1,path2,ind,isPoly){if(!sameLength(path1,path2))return!1;var p1=this.pseudoNode?path1:this.removePseudo(path1),p2=this.pseudoNode?path2:this.removePseudo(path2);if(!(isPoly&&!this.compareCoord(p1[0],p2[0])&&(p2=this.fixStartIndex(p2,p1),!p2))){var sameDirection=this.compareCoord(p1[ind],p2[ind]);return this.direction||sameDirection?this.comparePath(p1,p2):this.compareCoord(p1[ind],p2[p2.length-(1+ind)])?this.comparePath(p1.slice().reverse(),p2):!1}};Equality.prototype.fixStartIndex=function(sourcePath,targetPath){for(var correctPath,ind=-1,i=0;i<sourcePath.length;i++)if(this.compareCoord(sourcePath[i],targetPath[0])){ind=i;break}return ind>=0&&(correctPath=[].concat(sourcePath.slice(ind,sourcePath.length),sourcePath.slice(1,ind+1))),correctPath};Equality.prototype.comparePath=function(p1,p2){var cont=this;return p1.every(function(c,i){return cont.compareCoord(c,this[i])},p2)};Equality.prototype.comparePolygon=function(g1,g2){if(this.compareLine(g1.coordinates[0],g2.coordinates[0],1,!0)){var holes1=g1.coordinates.slice(1,g1.coordinates.length),holes2=g2.coordinates.slice(1,g2.coordinates.length),cont=this;return holes1.every(function(h1){return this.some(function(h2){return cont.compareLine(h1,h2,1,!0)})},holes2)}else return!1};Equality.prototype.compareFeature=function(g1,g2){return g1.id!==g2.id||!this.objectComparator(g1.properties,g2.properties)||!this.compareBBox(g1,g2)?!1:this.compare(g1.geometry,g2.geometry)};Equality.prototype.compareBBox=function(g1,g2){return!!(!g1.bbox&&!g2.bbox||g1.bbox&&g2.bbox&&this.compareCoord(g1.bbox,g2.bbox))};Equality.prototype.removePseudo=function(path){return path};function objectComparator(obj1,obj2){return deepEqual_1(obj1,obj2,{strict:!0})}var geojsonEquality=Equality;function booleanOverlap(feature1,feature2){if(!feature1)throw new Error("feature1 is required");if(!feature2)throw new Error("feature2 is required");var type1=getType(feature1),type2=getType(feature2);if(type1!==type2)throw new Error("features must be of the same type");if(type1==="Point")throw new Error("Point geometry not supported");var equality=new geojsonEquality({precision:6});if(equality.compare(feature1,feature2))return!1;var overlap2=0;switch(type1){case"MultiPoint":var coords1=coordAll(feature1),coords2=coordAll(feature2);coords1.forEach(function(coord1){coords2.forEach(function(coord2){coord1[0]===coord2[0]&&coord1[1]===coord2[1]&&overlap2++})});break;case"LineString":case"MultiLineString":segmentEach(feature1,function(segment1){segmentEach(feature2,function(segment2){lineOverlap(segment1,segment2).features.length&&overlap2++})});break;case"Polygon":case"MultiPolygon":segmentEach(feature1,function(segment1){segmentEach(feature2,function(segment2){lineIntersect(segment1,segment2).features.length&&overlap2++})});break}return overlap2>0}function booleanEqual(feature1,feature2){if(!feature1)throw new Error("feature1 is required");if(!feature2)throw new Error("feature2 is required");var type1=getType(feature1),type2=getType(feature2);if(type1!==type2)return!1;var equality=new geojsonEquality({precision:6});return equality.compare(cleanCoords(feature1),cleanCoords(feature2))}var DBSCAN_1=createCommonjsModule(function(module){function DBSCAN(dataset,epsilon3,minPts,distanceFunction){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(dataset,epsilon3,minPts,distanceFunction)}DBSCAN.prototype.run=function(dataset,epsilon3,minPts,distanceFunction){this._init(dataset,epsilon3,minPts,distanceFunction);for(var pointId=0;pointId<this._datasetLength;pointId++)if(this._visited[pointId]!==1){this._visited[pointId]=1;var neighbors=this._regionQuery(pointId);if(neighbors.length<this.minPts)this.noise.push(pointId);else{var clusterId=this.clusters.length;this.clusters.push([]),this._addToCluster(pointId,clusterId),this._expandCluster(clusterId,neighbors)}}return this.clusters},DBSCAN.prototype._init=function(dataset,epsilon3,minPts,distance12){if(dataset){if(!(dataset instanceof Array))throw Error("Dataset must be of type array, "+typeof dataset+" given");this.dataset=dataset,this.clusters=[],this.noise=[],this._datasetLength=dataset.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}epsilon3&&(this.epsilon=epsilon3),minPts&&(this.minPts=minPts),distance12&&(this.distance=distance12)},DBSCAN.prototype._expandCluster=function(clusterId,neighbors){for(var i=0;i<neighbors.length;i++){var pointId2=neighbors[i];if(this._visited[pointId2]!==1){this._visited[pointId2]=1;var neighbors2=this._regionQuery(pointId2);neighbors2.length>=this.minPts&&(neighbors=this._mergeArrays(neighbors,neighbors2))}this._assigned[pointId2]!==1&&this._addToCluster(pointId2,clusterId)}},DBSCAN.prototype._addToCluster=function(pointId,clusterId){this.clusters[clusterId].push(pointId),this._assigned[pointId]=1},DBSCAN.prototype._regionQuery=function(pointId){for(var neighbors=[],id=0;id<this._datasetLength;id++){var dist2=this.distance(this.dataset[pointId],this.dataset[id]);dist2<this.epsilon&&neighbors.push(id)}return neighbors},DBSCAN.prototype._mergeArrays=function(a,b){for(var len=b.length,i=0;i<len;i++){var P=b[i];a.indexOf(P)<0&&a.push(P)}return a},DBSCAN.prototype._euclideanDistance=function(p,q){for(var sum=0,i=Math.min(p.length,q.length);i--;)sum+=(p[i]-q[i])*(p[i]-q[i]);return Math.sqrt(sum)},module.exports&&(module.exports=DBSCAN)}),KMEANS_1=createCommonjsModule(function(module){function KMEANS(dataset,k,distance12){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(dataset,k,distance12)}KMEANS.prototype.init=function(dataset,k,distance12){this.assignments=[],this.centroids=[],typeof dataset<"u"&&(this.dataset=dataset),typeof k<"u"&&(this.k=k),typeof distance12<"u"&&(this.distance=distance12)},KMEANS.prototype.run=function(dataset,k){this.init(dataset,k);for(var len=this.dataset.length,i=0;i<this.k;i++)this.centroids[i]=this.randomCentroid();for(var change=!0;change;){change=this.assign();for(var centroidId=0;centroidId<this.k;centroidId++){for(var mean=new Array(maxDim),count2=0,dim=0;dim<maxDim;dim++)mean[dim]=0;for(var j=0;j<len;j++){var maxDim=this.dataset[j].length;if(centroidId===this.assignments[j]){for(var dim=0;dim<maxDim;dim++)mean[dim]+=this.dataset[j][dim];count2++}}if(count2>0){for(var dim=0;dim<maxDim;dim++)mean[dim]/=count2;this.centroids[centroidId]=mean}else this.centroids[centroidId]=this.randomCentroid(),change=!0}}return this.getClusters()},KMEANS.prototype.randomCentroid=function(){var maxId=this.dataset.length-1,centroid4,id;do id=Math.round(Math.random()*maxId),centroid4=this.dataset[id];while(this.centroids.indexOf(centroid4)>=0);return centroid4},KMEANS.prototype.assign=function(){for(var change=!1,len=this.dataset.length,closestCentroid,i=0;i<len;i++)closestCentroid=this.argmin(this.dataset[i],this.centroids,this.distance),closestCentroid!=this.assignments[i]&&(this.assignments[i]=closestCentroid,change=!0);return change},KMEANS.prototype.getClusters=function(){for(var clusters=new Array(this.k),centroidId,pointId=0;pointId<this.assignments.length;pointId++)centroidId=this.assignments[pointId],typeof clusters[centroidId]>"u"&&(clusters[centroidId]=[]),clusters[centroidId].push(pointId);return clusters},KMEANS.prototype.argmin=function(point4,set,f){for(var min4=Number.MAX_VALUE,arg=0,len=set.length,d,i=0;i<len;i++)d=f(point4,set[i]),d<min4&&(min4=d,arg=i);return arg},KMEANS.prototype.distance=function(p,q){for(var sum=0,i=Math.min(p.length,q.length);i--;){var diff2=p[i]-q[i];sum+=diff2*diff2}return Math.sqrt(sum)},module.exports&&(module.exports=KMEANS)}),PriorityQueue_1=createCommonjsModule(function(module){function PriorityQueue3(elements,priorities,sorting){this._queue=[],this._priorities=[],this._sorting="desc",this._init(elements,priorities,sorting)}PriorityQueue3.prototype.insert=function(ele,priority){for(var indexToInsert=this._queue.length,index=indexToInsert;index--;){var priority2=this._priorities[index];this._sorting==="desc"?priority>priority2&&(indexToInsert=index):priority<priority2&&(indexToInsert=index)}this._insertAt(ele,priority,indexToInsert)},PriorityQueue3.prototype.remove=function(ele){for(var index=this._queue.length;index--;){var ele2=this._queue[index];if(ele===ele2){this._queue.splice(index,1),this._priorities.splice(index,1);break}}},PriorityQueue3.prototype.forEach=function(func){this._queue.forEach(func)},PriorityQueue3.prototype.getElements=function(){return this._queue},PriorityQueue3.prototype.getElementPriority=function(index){return this._priorities[index]},PriorityQueue3.prototype.getPriorities=function(){return this._priorities},PriorityQueue3.prototype.getElementsWithPriorities=function(){for(var result=[],i=0,l=this._queue.length;i<l;i++)result.push([this._queue[i],this._priorities[i]]);return result},PriorityQueue3.prototype._init=function(elements,priorities,sorting){if(elements&&priorities){if(this._queue=[],this._priorities=[],elements.length!==priorities.length)throw new Error("Arrays must have the same length");for(var i=0;i<elements.length;i++)this.insert(elements[i],priorities[i])}sorting&&(this._sorting=sorting)},PriorityQueue3.prototype._insertAt=function(ele,priority,index){this._queue.length===index?(this._queue.push(ele),this._priorities.push(priority)):(this._queue.splice(index,0,ele),this._priorities.splice(index,0,priority))},module.exports&&(module.exports=PriorityQueue3)}),OPTICS_1=createCommonjsModule(function(module){if(module.exports)var PriorityQueue3=PriorityQueue_1;function OPTICS(dataset,epsilon3,minPts,distanceFunction){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(dataset,epsilon3,minPts,distanceFunction)}OPTICS.prototype.run=function(dataset,epsilon3,minPts,distanceFunction){this._init(dataset,epsilon3,minPts,distanceFunction);for(var pointId=0,l=this.dataset.length;pointId<l;pointId++)if(this._processed[pointId]!==1){this._processed[pointId]=1,this.clusters.push([pointId]);var clusterId=this.clusters.length-1;this._orderedList.push(pointId);var priorityQueue=new PriorityQueue3(null,null,"asc"),neighbors=this._regionQuery(pointId);this._distanceToCore(pointId)!==void 0&&(this._updateQueue(pointId,neighbors,priorityQueue),this._expandCluster(clusterId,priorityQueue))}return this.clusters},OPTICS.prototype.getReachabilityPlot=function(){for(var reachabilityPlot=[],i=0,l=this._orderedList.length;i<l;i++){var pointId=this._orderedList[i],distance12=this._reachability[pointId];reachabilityPlot.push([pointId,distance12])}return reachabilityPlot},OPTICS.prototype._init=function(dataset,epsilon3,minPts,distance12){if(dataset){if(!(dataset instanceof Array))throw Error("Dataset must be of type array, "+typeof dataset+" given");this.dataset=dataset,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}epsilon3&&(this.epsilon=epsilon3),minPts&&(this.minPts=minPts),distance12&&(this.distance=distance12)},OPTICS.prototype._updateQueue=function(pointId,neighbors,queue){var self=this;this._coreDistance=this._distanceToCore(pointId),neighbors.forEach(function(pointId2){if(self._processed[pointId2]===void 0){var dist2=self.distance(self.dataset[pointId],self.dataset[pointId2]),newReachableDistance=Math.max(self._coreDistance,dist2);self._reachability[pointId2]===void 0?(self._reachability[pointId2]=newReachableDistance,queue.insert(pointId2,newReachableDistance)):newReachableDistance<self._reachability[pointId2]&&(self._reachability[pointId2]=newReachableDistance,queue.remove(pointId2),queue.insert(pointId2,newReachableDistance))}})},OPTICS.prototype._expandCluster=function(clusterId,queue){for(var queueElements=queue.getElements(),p=0,l=queueElements.length;p<l;p++){var pointId=queueElements[p];if(this._processed[pointId]===void 0){var neighbors=this._regionQuery(pointId);this._processed[pointId]=1,this.clusters[clusterId].push(pointId),this._orderedList.push(pointId),this._distanceToCore(pointId)!==void 0&&(this._updateQueue(pointId,neighbors,queue),this._expandCluster(clusterId,queue))}}},OPTICS.prototype._distanceToCore=function(pointId){for(var l=this.epsilon,coreDistCand=0;coreDistCand<l;coreDistCand++){var neighbors=this._regionQuery(pointId,coreDistCand);if(neighbors.length>=this.minPts)return coreDistCand}},OPTICS.prototype._regionQuery=function(pointId,epsilon3){epsilon3=epsilon3||this.epsilon;for(var neighbors=[],id=0,l=this.dataset.length;id<l;id++)this.distance(this.dataset[pointId],this.dataset[id])<epsilon3&&neighbors.push(id);return neighbors},OPTICS.prototype._euclideanDistance=function(p,q){for(var sum=0,i=Math.min(p.length,q.length);i--;)sum+=(p[i]-q[i])*(p[i]-q[i]);return Math.sqrt(sum)},module.exports&&(module.exports=OPTICS)}),lib=createCommonjsModule(function(module){module.exports&&(module.exports={DBSCAN:DBSCAN_1,KMEANS:KMEANS_1,OPTICS:OPTICS_1,PriorityQueue:PriorityQueue_1})}),lib_1=lib.DBSCAN,lib_2=lib.KMEANS,lib_3=lib.OPTICS,lib_4=lib.PriorityQueue;function clustersDbscan(points$$1,maxDistance,options){if(options=options||{},typeof options!="object")throw new Error("options is invalid");var minPoints=options.minPoints,units=options.units;if(collectionOf(points$$1,"Point","Input must contain Points"),maxDistance==null)throw new Error("maxDistance is required");if(!(Math.sign(maxDistance)>0))throw new Error("Invalid maxDistance");if(!(minPoints==null||Math.sign(minPoints)>0))throw new Error("Invalid minPoints");points$$1=clone2(points$$1,!0),minPoints=minPoints||3;var dbscan=new lib.DBSCAN,clusteredIds=dbscan.run(coordAll(points$$1),convertLength(maxDistance,units),minPoints,distance2),clusterId=-1;return clusteredIds.forEach(function(clusterIds){clusterId++,clusterIds.forEach(function(idx){var clusterPoint=points$$1.features[idx];clusterPoint.properties||(clusterPoint.properties={}),clusterPoint.properties.cluster=clusterId,clusterPoint.properties.dbscan="core"})}),dbscan.noise.forEach(function(noiseId){var noisePoint=points$$1.features[noiseId];noisePoint.properties||(noisePoint.properties={}),noisePoint.properties.cluster?noisePoint.properties.dbscan="edge":noisePoint.properties.dbscan="noise"}),points$$1}var distance$2={eudist:function(v1,v2,sqrt4){for(var len=v1.length,sum=0,i=0;i<len;i++){var d=(v1[i]||0)-(v2[i]||0);sum+=d*d}return sqrt4?Math.sqrt(sum):sum},mandist:function(v1,v2,sqrt4){for(var len=v1.length,sum=0,i=0;i<len;i++)sum+=Math.abs((v1[i]||0)-(v2[i]||0));return sqrt4?Math.sqrt(sum):sum},dist:function(v1,v2,sqrt4){var d=Math.abs(v1-v2);return sqrt4?d:d*d}},eudist$1=distance$2.eudist,dist$1=distance$2.dist,kinit={kmrand:function(data,k){for(var map6={},ks=[],t=k<<2,len=data.length,multi=data[0].length>0;ks.length<k&&t-- >0;){var d=data[Math.floor(Math.random()*len)],key=multi?d.join("_"):""+d;map6[key]||(map6[key]=!0,ks.push(d))}if(ks.length<k)throw new Error("Error initializating clusters");return ks},kmpp:function(data,k){var distance12=data[0].length?eudist$1:dist$1,ks=[],len=data.length,multi=data[0].length>0,c=data[Math.floor(Math.random()*len)],key=multi?c.join("_"):""+c;for(ks.push(c);ks.length<k;){for(var dists=[],lk=ks.length,dsum=0,prs=[],i=0;i<len;i++){for(var min4=1/0,j=0;j<lk;j++){var _dist=distance12(data[i],ks[j]);_dist<=min4&&(min4=_dist)}dists[i]=min4}for(var _i=0;_i<len;_i++)dsum+=dists[_i];for(var _i2=0;_i2<len;_i2++)prs[_i2]={i:_i2,v:data[_i2],pr:dists[_i2]/dsum,cs:0};prs.sort(function(a,b){return a.pr-b.pr}),prs[0].cs=prs[0].pr;for(var _i3=1;_i3<len;_i3++)prs[_i3].cs=prs[_i3-1].cs+prs[_i3].pr;for(var rnd2=Math.random(),idx=0;idx<len-1&&prs[idx++].cs<rnd2;);ks.push(prs[idx-1].v)}return ks}},eudist2=distance$2.eudist,kmrand2=kinit.kmrand,kmpp2=kinit.kmpp,MAX=1e4;function init(len,val,v){v=v||[];for(var i=0;i<len;i++)v[i]=val;return v}function skmeans(data,k,initial,maxit){var ks=[],old=[],idxs=[],dist2=[],conv=!1,it=maxit||MAX,len=data.length,vlen=data[0].length,multi=vlen>0,count2=[];if(initial)initial=="kmrand"?ks=kmrand2(data,k):initial=="kmpp"?ks=kmpp2(data,k):ks=initial;else for(var _idxs={};ks.length<k;){var idx=Math.floor(Math.random()*len);_idxs[idx]||(_idxs[idx]=!0,ks.push(data[idx]))}do{init(k,0,count2);for(var i=0;i<len;i++){for(var min4=1/0,_idx=0,j=0;j<k;j++){var dist2=multi?eudist2(data[i],ks[j]):Math.abs(data[i]-ks[j]);dist2<=min4&&(min4=dist2,_idx=j)}idxs[i]=_idx,count2[_idx]++}for(var sum=[],old=[],_j=0;_j<k;_j++)sum[_j]=multi?init(vlen,0,sum[_j]):0,old[_j]=ks[_j];if(multi){for(var _j2=0;_j2<k;_j2++)ks[_j2]=[];for(var _i=0;_i<len;_i++)for(var _idx2=idxs[_i],vsum=sum[_idx2],vect=data[_i],h=0;h<vlen;h++)vsum[h]+=vect[h];conv=!0;for(var _j3=0;_j3<k;_j3++){for(var ksj=ks[_j3],sumj=sum[_j3],oldj=old[_j3],cj=count2[_j3],_h=0;_h<vlen;_h++)ksj[_h]=sumj[_h]/cj||0;if(conv){for(var _h2=0;_h2<vlen;_h2++)if(oldj[_h2]!=ksj[_h2]){conv=!1;break}}}}else{for(var _i2=0;_i2<len;_i2++){var _idx3=idxs[_i2];sum[_idx3]+=data[_i2]}for(var _j4=0;_j4<k;_j4++)ks[_j4]=sum[_j4]/count2[_j4]||0;conv=!0;for(var _j5=0;_j5<k;_j5++)if(old[_j5]!=ks[_j5]){conv=!1;break}}conv=conv||--it<=0}while(!conv);return{it:MAX-it,k,idxs,centroids:ks}}var main=skmeans;function clustersKmeans(points2,options){if(options=options||{},typeof options!="object")throw new Error("options is invalid");var numberOfClusters=options.numberOfClusters,mutate=options.mutate;collectionOf(points2,"Point","Input must contain Points");var count2=points2.features.length;numberOfClusters=numberOfClusters||Math.round(Math.sqrt(count2/2)),numberOfClusters>count2&&(numberOfClusters=count2),(mutate===!1||mutate===void 0)&&(points2=clone2(points2,!0));var data=coordAll(points2),initialCentroids=data.slice(0,numberOfClusters),skmeansResult=main(data,numberOfClusters,initialCentroids),centroids={};return skmeansResult.centroids.forEach(function(coord,idx){centroids[idx]=coord}),featureEach(points2,function(point4,index){var clusterId=skmeansResult.idxs[index];point4.properties.cluster=clusterId,point4.properties.centroid=centroids[clusterId]}),points2}function booleanParallel(line1,line2){if(!line1)throw new Error("line1 is required");if(!line2)throw new Error("line2 is required");var type1=getType$1(line1,"line1");if(type1!=="LineString")throw new Error("line1 must be a LineString");var type2=getType$1(line2,"line2");if(type2!=="LineString")throw new Error("line2 must be a LineString");for(var segments1=lineSegment(cleanCoords(line1)).features,segments2=lineSegment(cleanCoords(line2)).features,i=0;i<segments1.length;i++){var segment1=segments1[i].geometry.coordinates;if(!segments2[i])break;var segment2=segments2[i].geometry.coordinates;if(!isParallel$1(segment1,segment2))return!1}return!0}function booleanIntersects(feature1,feature2){var bool=!1;return flattenEach(feature1,function(flatten1){flattenEach(feature2,function(flatten2){if(bool===!0)return!0;bool=!booleanDisjoint(flatten1.geometry,flatten2.geometry)})}),bool}function isParallel$1(segment1,segment2){var slope1=bearingToAzimuth(rhumbBearing(segment1[0],segment1[1])),slope2=bearingToAzimuth(rhumbBearing(segment2[0],segment2[1]));return slope1===slope2}function getType$1(geojson,name){if(geojson.geometry&&geojson.geometry.type)return geojson.geometry.type;if(geojson.type)return geojson.type;throw new Error("Invalid GeoJSON object for "+name)}function pathTo(node){for(var curr=node,path=[];curr.parent;)path.unshift(curr),curr=curr.parent;return path}function getHeap(){return new BinaryHeap(function(node){return node.f})}var astar={search:function(graph,start2,end,options){graph.cleanDirty(),options=options||{};var heuristic=options.heuristic||astar.heuristics.manhattan,closest=options.closest||!1,openHeap=getHeap(),closestNode=start2;for(start2.h=heuristic(start2,end),openHeap.push(start2);openHeap.size()>0;){var currentNode=openHeap.pop();if(currentNode===end)return pathTo(currentNode);currentNode.closed=!0;for(var neighbors=graph.neighbors(currentNode),i=0,il=neighbors.length;i<il;++i){var neighbor=neighbors[i];if(!(neighbor.closed||neighbor.isWall())){var gScore=currentNode.g+neighbor.getCost(currentNode),beenVisited=neighbor.visited;(!beenVisited||gScore<neighbor.g)&&(neighbor.visited=!0,neighbor.parent=currentNode,neighbor.h=neighbor.h||heuristic(neighbor,end),neighbor.g=gScore,neighbor.f=neighbor.g+neighbor.h,graph.markDirty(neighbor),closest&&(neighbor.h<closestNode.h||neighbor.h===closestNode.h&&neighbor.g<closestNode.g)&&(closestNode=neighbor),beenVisited?openHeap.rescoreElement(neighbor):openHeap.push(neighbor))}}}return closest?pathTo(closestNode):[]},heuristics:{manhattan:function(pos0,pos1){var d1=Math.abs(pos1.x-pos0.x),d2=Math.abs(pos1.y-pos0.y);return d1+d2},diagonal:function(pos0,pos1){var D=1,D2=Math.sqrt(2),d1=Math.abs(pos1.x-pos0.x),d2=Math.abs(pos1.y-pos0.y);return D*(d1+d2)+(D2-2*D)*Math.min(d1,d2)}},cleanNode:function(node){node.f=0,node.g=0,node.h=0,node.visited=!1,node.closed=!1,node.parent=null}};function Graph$1(gridIn,options){options=options||{},this.nodes=[],this.diagonal=!!options.diagonal,this.grid=[];for(var x2=0;x2<gridIn.length;x2++){this.grid[x2]=[];for(var y2=0,row=gridIn[x2];y2<row.length;y2++){var node=new GridNode(x2,y2,row[y2]);this.grid[x2][y2]=node,this.nodes.push(node)}}this.init()}Graph$1.prototype.init=function(){this.dirtyNodes=[];for(var i=0;i<this.nodes.length;i++)astar.cleanNode(this.nodes[i])};Graph$1.prototype.cleanDirty=function(){for(var i=0;i<this.dirtyNodes.length;i++)astar.cleanNode(this.dirtyNodes[i]);this.dirtyNodes=[]};Graph$1.prototype.markDirty=function(node){this.dirtyNodes.push(node)};Graph$1.prototype.neighbors=function(node){var ret=[],x2=node.x,y2=node.y,grid=this.grid;return grid[x2-1]&&grid[x2-1][y2]&&ret.push(grid[x2-1][y2]),grid[x2+1]&&grid[x2+1][y2]&&ret.push(grid[x2+1][y2]),grid[x2]&&grid[x2][y2-1]&&ret.push(grid[x2][y2-1]),grid[x2]&&grid[x2][y2+1]&&ret.push(grid[x2][y2+1]),this.diagonal&&(grid[x2-1]&&grid[x2-1][y2-1]&&ret.push(grid[x2-1][y2-1]),grid[x2+1]&&grid[x2+1][y2-1]&&ret.push(grid[x2+1][y2-1]),grid[x2-1]&&grid[x2-1][y2+1]&&ret.push(grid[x2-1][y2+1]),grid[x2+1]&&grid[x2+1][y2+1]&&ret.push(grid[x2+1][y2+1])),ret};Graph$1.prototype.toString=function(){for(var graphString=[],nodes=this.grid,rowDebug,row,y2,l,x2=0,len=nodes.length;x2<len;x2++){for(rowDebug=[],row=nodes[x2],y2=0,l=row.length;y2<l;y2++)rowDebug.push(row[y2].weight);graphString.push(rowDebug.join(" "))}return graphString.join(`
`)};function GridNode(x2,y2,weight){this.x=x2,this.y=y2,this.weight=weight}GridNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};GridNode.prototype.getCost=function(fromNeighbor){return fromNeighbor&&fromNeighbor.x!==this.x&&fromNeighbor.y!==this.y?this.weight*1.41421:this.weight};GridNode.prototype.isWall=function(){return this.weight===0};function BinaryHeap(scoreFunction){this.content=[],this.scoreFunction=scoreFunction}BinaryHeap.prototype={push:function(element){this.content.push(element),this.sinkDown(this.content.length-1)},pop:function(){var result=this.content[0],end=this.content.pop();return this.content.length>0&&(this.content[0]=end,this.bubbleUp(0)),result},remove:function(node){var i=this.content.indexOf(node),end=this.content.pop();i!==this.content.length-1&&(this.content[i]=end,this.scoreFunction(end)<this.scoreFunction(node)?this.sinkDown(i):this.bubbleUp(i))},size:function(){return this.content.length},rescoreElement:function(node){this.sinkDown(this.content.indexOf(node))},sinkDown:function(n){for(var element=this.content[n];n>0;){var parentN=(n+1>>1)-1,parent=this.content[parentN];if(this.scoreFunction(element)<this.scoreFunction(parent))this.content[parentN]=element,this.content[n]=parent,n=parentN;else break}},bubbleUp:function(n){for(var length3=this.content.length,element=this.content[n],elemScore=this.scoreFunction(element);;){var child2N=n+1<<1,child1N=child2N-1,swap3=null,child1Score;if(child1N<length3){var child1=this.content[child1N];child1Score=this.scoreFunction(child1),child1Score<elemScore&&(swap3=child1N)}if(child2N<length3){var child2=this.content[child2N],child2Score=this.scoreFunction(child2);child2Score<(swap3===null?elemScore:child1Score)&&(swap3=child2N)}if(swap3!==null)this.content[n]=this.content[swap3],this.content[swap3]=element,n=swap3;else break}}};function shortestPath(start2,end,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var resolution=options.resolution,minDistance=options.minDistance,obstacles=options.obstacles||featureCollection([]);if(!start2)throw new Error("start is required");if(!end)throw new Error("end is required");if(resolution&&!isNumber(resolution)||resolution<=0)throw new Error("options.resolution must be a number, greater than 0");if(minDistance)throw new Error("options.minDistance is not yet implemented");var startCoord=getCoord(start2),endCoord=getCoord(end);switch(start2=point(startCoord),end=point(endCoord),getType(obstacles)){case"FeatureCollection":if(obstacles.features.length===0)return lineString([startCoord,endCoord]);break;case"Polygon":obstacles=featureCollection([feature(getGeom(obstacles))]);break;default:throw new Error("invalid obstacles")}var collection=obstacles;collection.features.push(start2),collection.features.push(end);var box=bbox(transformScale(bboxPolygon(bbox(collection)),1.15));if(!resolution){var width2=distance2([box[0],box[1]],[box[2],box[1]],options);resolution=width2/100}collection.features.pop(),collection.features.pop();for(var west=box[0],south=box[1],east=box[2],north=box[3],xFraction=resolution/distance2([west,south],[east,south],options),cellWidth=xFraction*(east-west),yFraction=resolution/distance2([west,south],[west,north],options),cellHeight=yFraction*(north-south),bboxHorizontalSide=east-west,bboxVerticalSide=north-south,columns=Math.floor(bboxHorizontalSide/cellWidth),rows=Math.floor(bboxVerticalSide/cellHeight),deltaX=(bboxHorizontalSide-columns*cellWidth)/2,deltaY=(bboxVerticalSide-rows*cellHeight)/2,pointMatrix=[],matrix=[],closestToStart=[],closestToEnd=[],minDistStart=1/0,minDistEnd=1/0,currentY=north-deltaY,r=0;currentY>=south;){for(var matrixRow=[],pointMatrixRow=[],currentX=west+deltaX,c=0;currentX<=east;){var pt=point([currentX,currentY]),isInsideObstacle=isInside$1(pt,obstacles);matrixRow.push(isInsideObstacle?0:1),pointMatrixRow.push(currentX+"|"+currentY);var distStart=distance2(pt,start2);!isInsideObstacle&&distStart<minDistStart&&(minDistStart=distStart,closestToStart={x:c,y:r});var distEnd=distance2(pt,end);!isInsideObstacle&&distEnd<minDistEnd&&(minDistEnd=distEnd,closestToEnd={x:c,y:r}),currentX+=cellWidth,c++}matrix.push(matrixRow),pointMatrix.push(pointMatrixRow),currentY-=cellHeight,r++}var graph=new Graph$1(matrix,{diagonal:!0}),startOnMatrix=graph.grid[closestToStart.y][closestToStart.x],endOnMatrix=graph.grid[closestToEnd.y][closestToEnd.x],result=astar.search(graph,startOnMatrix,endOnMatrix),path=[startCoord];return result.forEach(function(coord){var coords=pointMatrix[coord.x][coord.y].split("|");path.push([+coords[0],+coords[1]])}),path.push(endCoord),cleanCoords(lineString(path))}function isInside$1(pt,polygons$$1){for(var i=0;i<polygons$$1.features.length;i++)if(booleanPointInPolygon(pt,polygons$$1.features[i]))return!0;return!1}var constant=function(x2){return function(){return x2}};function x(d){return d[0]}function y(d){return d[1]}function RedBlackTree(){this._=null}function RedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}RedBlackTree.prototype={constructor:RedBlackTree,insert:function(after,node){var parent,grandpa,uncle;if(after){if(node.P=after,node.N=after.N,after.N&&(after.N.P=node),after.N=node,after.R){for(after=after.R;after.L;)after=after.L;after.L=node}else after.R=node;parent=after}else this._?(after=RedBlackFirst(this._),node.P=null,node.N=after,after.P=after.L=node,parent=after):(node.P=node.N=null,this._=node,parent=null);for(node.L=node.R=null,node.U=parent,node.C=!0,after=node;parent&&parent.C;)grandpa=parent.U,parent===grandpa.L?(uncle=grandpa.R,uncle&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.R&&(RedBlackRotateLeft(this,parent),after=parent,parent=after.U),parent.C=!1,grandpa.C=!0,RedBlackRotateRight(this,grandpa))):(uncle=grandpa.L,uncle&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.L&&(RedBlackRotateRight(this,parent),after=parent,parent=after.U),parent.C=!1,grandpa.C=!0,RedBlackRotateLeft(this,grandpa))),parent=after.U;this._.C=!1},remove:function(node){node.N&&(node.N.P=node.P),node.P&&(node.P.N=node.N),node.N=node.P=null;var parent=node.U,sibling,left=node.L,right=node.R,next3,red;if(left?right?next3=RedBlackFirst(right):next3=left:next3=right,parent?parent.L===node?parent.L=next3:parent.R=next3:this._=next3,left&&right?(red=next3.C,next3.C=node.C,next3.L=left,left.U=next3,next3!==right?(parent=next3.U,next3.U=node.U,node=next3.R,parent.L=node,next3.R=right,right.U=next3):(next3.U=parent,parent=next3,node=next3.R)):(red=node.C,node=next3),node&&(node.U=parent),!red){if(node&&node.C){node.C=!1;return}do{if(node===this._)break;if(node===parent.L){if(sibling=parent.R,sibling.C&&(sibling.C=!1,parent.C=!0,RedBlackRotateLeft(this,parent),sibling=parent.R),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){(!sibling.R||!sibling.R.C)&&(sibling.L.C=!1,sibling.C=!0,RedBlackRotateRight(this,sibling),sibling=parent.R),sibling.C=parent.C,parent.C=sibling.R.C=!1,RedBlackRotateLeft(this,parent),node=this._;break}}else if(sibling=parent.L,sibling.C&&(sibling.C=!1,parent.C=!0,RedBlackRotateRight(this,parent),sibling=parent.L),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){(!sibling.L||!sibling.L.C)&&(sibling.R.C=!1,sibling.C=!0,RedBlackRotateLeft(this,sibling),sibling=parent.L),sibling.C=parent.C,parent.C=sibling.L.C=!1,RedBlackRotateRight(this,parent),node=this._;break}sibling.C=!0,node=parent,parent=parent.U}while(!node.C);node&&(node.C=!1)}}};function RedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.R=q.L,p.R&&(p.R.U=p),q.L=p}function RedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.L=q.R,p.L&&(p.L.U=p),q.R=p}function RedBlackFirst(node){for(;node.L;)node=node.L;return node}function createEdge(left,right,v0,v1){var edge=[null,null],index=edges.push(edge)-1;return edge.left=left,edge.right=right,v0&&setEdgeEnd(edge,left,right,v0),v1&&setEdgeEnd(edge,right,left,v1),cells[left.index].halfedges.push(index),cells[right.index].halfedges.push(index),edge}function createBorderEdge(left,v0,v1){var edge=[v0,v1];return edge.left=left,edge}function setEdgeEnd(edge,left,right,vertex){!edge[0]&&!edge[1]?(edge[0]=vertex,edge.left=left,edge.right=right):edge.left===right?edge[1]=vertex:edge[0]=vertex}function clipEdge(edge,x0,y0,x12,y12){var a=edge[0],b=edge[1],ax=a[0],ay=a[1],bx=b[0],by=b[1],t0=0,t1=1,dx=bx-ax,dy=by-ay,r;if(r=x0-ax,!(!dx&&r>0)){if(r/=dx,dx<0){if(r<t0)return;r<t1&&(t1=r)}else if(dx>0){if(r>t1)return;r>t0&&(t0=r)}if(r=x12-ax,!(!dx&&r<0)){if(r/=dx,dx<0){if(r>t1)return;r>t0&&(t0=r)}else if(dx>0){if(r<t0)return;r<t1&&(t1=r)}if(r=y0-ay,!(!dy&&r>0)){if(r/=dy,dy<0){if(r<t0)return;r<t1&&(t1=r)}else if(dy>0){if(r>t1)return;r>t0&&(t0=r)}if(r=y12-ay,!(!dy&&r<0)){if(r/=dy,dy<0){if(r>t1)return;r>t0&&(t0=r)}else if(dy>0){if(r<t0)return;r<t1&&(t1=r)}return!(t0>0)&&!(t1<1)||(t0>0&&(edge[0]=[ax+t0*dx,ay+t0*dy]),t1<1&&(edge[1]=[ax+t1*dx,ay+t1*dy])),!0}}}}}function connectEdge(edge,x0,y0,x12,y12){var v1=edge[1];if(v1)return!0;var v0=edge[0],left=edge.left,right=edge.right,lx=left[0],ly=left[1],rx=right[0],ry=right[1],fx=(lx+rx)/2,fy=(ly+ry)/2,fm,fb;if(ry===ly){if(fx<x0||fx>=x12)return;if(lx>rx){if(!v0)v0=[fx,y0];else if(v0[1]>=y12)return;v1=[fx,y12]}else{if(!v0)v0=[fx,y12];else if(v0[1]<y0)return;v1=[fx,y0]}}else if(fm=(lx-rx)/(ry-ly),fb=fy-fm*fx,fm<-1||fm>1)if(lx>rx){if(!v0)v0=[(y0-fb)/fm,y0];else if(v0[1]>=y12)return;v1=[(y12-fb)/fm,y12]}else{if(!v0)v0=[(y12-fb)/fm,y12];else if(v0[1]<y0)return;v1=[(y0-fb)/fm,y0]}else if(ly<ry){if(!v0)v0=[x0,fm*x0+fb];else if(v0[0]>=x12)return;v1=[x12,fm*x12+fb]}else{if(!v0)v0=[x12,fm*x12+fb];else if(v0[0]<x0)return;v1=[x0,fm*x0+fb]}return edge[0]=v0,edge[1]=v1,!0}function clipEdges(x0,y0,x12,y12){for(var i=edges.length,edge;i--;)(!connectEdge(edge=edges[i],x0,y0,x12,y12)||!clipEdge(edge,x0,y0,x12,y12)||!(Math.abs(edge[0][0]-edge[1][0])>epsilon||Math.abs(edge[0][1]-edge[1][1])>epsilon))&&delete edges[i]}function createCell(site){return cells[site.index]={site,halfedges:[]}}function cellHalfedgeAngle(cell,edge){var site=cell.site,va=edge.left,vb=edge.right;return site===vb&&(vb=va,va=site),vb?Math.atan2(vb[1]-va[1],vb[0]-va[0]):(site===va?(va=edge[1],vb=edge[0]):(va=edge[0],vb=edge[1]),Math.atan2(va[0]-vb[0],vb[1]-va[1]))}function cellHalfedgeStart(cell,edge){return edge[+(edge.left!==cell.site)]}function cellHalfedgeEnd(cell,edge){return edge[+(edge.left===cell.site)]}function sortCellHalfedges(){for(var i=0,n=cells.length,cell,halfedges,j,m;i<n;++i)if((cell=cells[i])&&(m=(halfedges=cell.halfedges).length)){var index=new Array(m),array=new Array(m);for(j=0;j<m;++j)index[j]=j,array[j]=cellHalfedgeAngle(cell,edges[halfedges[j]]);for(index.sort(function(i2,j2){return array[j2]-array[i2]}),j=0;j<m;++j)array[j]=halfedges[index[j]];for(j=0;j<m;++j)halfedges[j]=array[j]}}function clipCells(x0,y0,x12,y12){var nCells=cells.length,iCell,cell,site,iHalfedge,halfedges,nHalfedges,start2,startX,startY,end,endX,endY,cover=!0;for(iCell=0;iCell<nCells;++iCell)if(cell=cells[iCell]){for(site=cell.site,halfedges=cell.halfedges,iHalfedge=halfedges.length;iHalfedge--;)edges[halfedges[iHalfedge]]||halfedges.splice(iHalfedge,1);for(iHalfedge=0,nHalfedges=halfedges.length;iHalfedge<nHalfedges;)end=cellHalfedgeEnd(cell,edges[halfedges[iHalfedge]]),endX=end[0],endY=end[1],start2=cellHalfedgeStart(cell,edges[halfedges[++iHalfedge%nHalfedges]]),startX=start2[0],startY=start2[1],(Math.abs(endX-startX)>epsilon||Math.abs(endY-startY)>epsilon)&&(halfedges.splice(iHalfedge,0,edges.push(createBorderEdge(site,end,Math.abs(endX-x0)<epsilon&&y12-endY>epsilon?[x0,Math.abs(startX-x0)<epsilon?startY:y12]:Math.abs(endY-y12)<epsilon&&x12-endX>epsilon?[Math.abs(startY-y12)<epsilon?startX:x12,y12]:Math.abs(endX-x12)<epsilon&&endY-y0>epsilon?[x12,Math.abs(startX-x12)<epsilon?startY:y0]:Math.abs(endY-y0)<epsilon&&endX-x0>epsilon?[Math.abs(startY-y0)<epsilon?startX:x0,y0]:null))-1),++nHalfedges);nHalfedges&&(cover=!1)}if(cover){var dx,dy,d2,dc=1/0;for(iCell=0,cover=null;iCell<nCells;++iCell)(cell=cells[iCell])&&(site=cell.site,dx=site[0]-x0,dy=site[1]-y0,d2=dx*dx+dy*dy,d2<dc&&(dc=d2,cover=cell));if(cover){var v00=[x0,y0],v01=[x0,y12],v11=[x12,y12],v10=[x12,y0];cover.halfedges.push(edges.push(createBorderEdge(site=cover.site,v00,v01))-1,edges.push(createBorderEdge(site,v01,v11))-1,edges.push(createBorderEdge(site,v11,v10))-1,edges.push(createBorderEdge(site,v10,v00))-1)}}for(iCell=0;iCell<nCells;++iCell)(cell=cells[iCell])&&(cell.halfedges.length||delete cells[iCell])}var circlePool=[],firstCircle;function Circle(){RedBlackNode(this),this.x=this.y=this.arc=this.site=this.cy=null}function attachCircle(arc){var lArc=arc.P,rArc=arc.N;if(!(!lArc||!rArc)){var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite!==rSite){var bx=cSite[0],by=cSite[1],ax=lSite[0]-bx,ay=lSite[1]-by,cx=rSite[0]-bx,cy=rSite[1]-by,d=2*(ax*cy-ay*cx);if(!(d>=-epsilon2)){var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x2=(cy*ha-ay*hc)/d,y2=(ax*hc-cx*ha)/d,circle2=circlePool.pop()||new Circle;circle2.arc=arc,circle2.site=cSite,circle2.x=x2+bx,circle2.y=(circle2.cy=y2+by)+Math.sqrt(x2*x2+y2*y2),arc.circle=circle2;for(var before=null,node=circles._;node;)if(circle2.y<node.y||circle2.y===node.y&&circle2.x<=node.x)if(node.L)node=node.L;else{before=node.P;break}else if(node.R)node=node.R;else{before=node;break}circles.insert(before,circle2),before||(firstCircle=circle2)}}}}function detachCircle(arc){var circle2=arc.circle;circle2&&(circle2.P||(firstCircle=circle2.N),circles.remove(circle2),circlePool.push(circle2),RedBlackNode(circle2),arc.circle=null)}var beachPool=[];function Beach(){RedBlackNode(this),this.edge=this.site=this.circle=null}function createBeach(site){var beach=beachPool.pop()||new Beach;return beach.site=site,beach}function detachBeach(beach){detachCircle(beach),beaches.remove(beach),beachPool.push(beach),RedBlackNode(beach)}function removeBeach(beach){var circle2=beach.circle,x2=circle2.x,y2=circle2.cy,vertex=[x2,y2],previous=beach.P,next3=beach.N,disappearing=[beach];detachBeach(beach);for(var lArc=previous;lArc.circle&&Math.abs(x2-lArc.circle.x)<epsilon&&Math.abs(y2-lArc.circle.cy)<epsilon;)previous=lArc.P,disappearing.unshift(lArc),detachBeach(lArc),lArc=previous;disappearing.unshift(lArc),detachCircle(lArc);for(var rArc=next3;rArc.circle&&Math.abs(x2-rArc.circle.x)<epsilon&&Math.abs(y2-rArc.circle.cy)<epsilon;)next3=rArc.N,disappearing.push(rArc),detachBeach(rArc),rArc=next3;disappearing.push(rArc),detachCircle(rArc);var nArcs=disappearing.length,iArc;for(iArc=1;iArc<nArcs;++iArc)rArc=disappearing[iArc],lArc=disappearing[iArc-1],setEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex);lArc=disappearing[0],rArc=disappearing[nArcs-1],rArc.edge=createEdge(lArc.site,rArc.site,null,vertex),attachCircle(lArc),attachCircle(rArc)}function addBeach(site){for(var x2=site[0],directrix=site[1],lArc,rArc,dxl,dxr,node=beaches._;node;)if(dxl=leftBreakPoint(node,directrix)-x2,dxl>epsilon)node=node.L;else if(dxr=x2-rightBreakPoint(node,directrix),dxr>epsilon){if(!node.R){lArc=node;break}node=node.R}else{dxl>-epsilon?(lArc=node.P,rArc=node):dxr>-epsilon?(lArc=node,rArc=node.N):lArc=rArc=node;break}createCell(site);var newArc=createBeach(site);if(beaches.insert(lArc,newArc),!(!lArc&&!rArc)){if(lArc===rArc){detachCircle(lArc),rArc=createBeach(lArc.site),beaches.insert(newArc,rArc),newArc.edge=rArc.edge=createEdge(lArc.site,newArc.site),attachCircle(lArc),attachCircle(rArc);return}if(!rArc){newArc.edge=createEdge(lArc.site,newArc.site);return}detachCircle(lArc),detachCircle(rArc);var lSite=lArc.site,ax=lSite[0],ay=lSite[1],bx=site[0]-ax,by=site[1]-ay,rSite=rArc.site,cx=rSite[0]-ax,cy=rSite[1]-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex=[(cy*hb-by*hc)/d+ax,(bx*hc-cx*hb)/d+ay];setEdgeEnd(rArc.edge,lSite,rSite,vertex),newArc.edge=createEdge(lSite,site,null,vertex),rArc.edge=createEdge(site,rSite,null,vertex),attachCircle(lArc),attachCircle(rArc)}}function leftBreakPoint(arc,directrix){var site=arc.site,rfocx=site[0],rfocy=site[1],pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-1/0;site=lArc.site;var lfocx=site[0],lfocy=site[1],plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;return aby2?(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx:(rfocx+lfocx)/2}function rightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return leftBreakPoint(rArc,directrix);var site=arc.site;return site[1]===directrix?site[0]:1/0}var epsilon=1e-6,epsilon2=1e-12,beaches,cells,circles,edges;function triangleArea(a,b,c){return(a[0]-c[0])*(b[1]-a[1])-(a[0]-b[0])*(c[1]-a[1])}function lexicographic(a,b){return b[1]-a[1]||b[0]-a[0]}function Diagram(sites,extent){var site=sites.sort(lexicographic).pop(),x2,y2,circle2;for(edges=[],cells=new Array(sites.length),beaches=new RedBlackTree,circles=new RedBlackTree;;)if(circle2=firstCircle,site&&(!circle2||site[1]<circle2.y||site[1]===circle2.y&&site[0]<circle2.x))(site[0]!==x2||site[1]!==y2)&&(addBeach(site),x2=site[0],y2=site[1]),site=sites.pop();else if(circle2)removeBeach(circle2.arc);else break;if(sortCellHalfedges(),extent){var x0=+extent[0][0],y0=+extent[0][1],x12=+extent[1][0],y12=+extent[1][1];clipEdges(x0,y0,x12,y12),clipCells(x0,y0,x12,y12)}this.edges=edges,this.cells=cells,beaches=circles=edges=cells=null}Diagram.prototype={constructor:Diagram,polygons:function(){var edges2=this.edges;return this.cells.map(function(cell){var polygon4=cell.halfedges.map(function(i){return cellHalfedgeStart(cell,edges2[i])});return polygon4.data=cell.site.data,polygon4})},triangles:function(){var triangles=[],edges2=this.edges;return this.cells.forEach(function(cell,i){if(!!(m=(halfedges=cell.halfedges).length))for(var site=cell.site,halfedges,j=-1,m,s0,e1=edges2[halfedges[m-1]],s1=e1.left===site?e1.right:e1.left;++j<m;)s0=s1,e1=edges2[halfedges[j]],s1=e1.left===site?e1.right:e1.left,s0&&s1&&i<s0.index&&i<s1.index&&triangleArea(site,s0,s1)<0&&triangles.push([site.data,s0.data,s1.data])}),triangles},links:function(){return this.edges.filter(function(edge){return edge.right}).map(function(edge){return{source:edge.left.data,target:edge.right.data}})},find:function(x2,y2,radius){for(var that=this,i0,i1=that._found||0,n=that.cells.length,cell;!(cell=that.cells[i1]);)if(++i1>=n)return null;var dx=x2-cell.site[0],dy=y2-cell.site[1],d2=dx*dx+dy*dy;do cell=that.cells[i0=i1],i1=null,cell.halfedges.forEach(function(e){var edge=that.edges[e],v=edge.left;if(!((v===cell.site||!v)&&!(v=edge.right))){var vx=x2-v[0],vy=y2-v[1],v2=vx*vx+vy*vy;v2<d2&&(d2=v2,i1=v.index)}});while(i1!==null);return that._found=i0,radius==null||d2<=radius*radius?cell.site:null}};var voronoi=function(){var x$$1=x,y$$1=y,extent=null;function voronoi2(data){return new Diagram(data.map(function(d,i){var s=[Math.round(x$$1(d,i,data)/epsilon)*epsilon,Math.round(y$$1(d,i,data)/epsilon)*epsilon];return s.index=i,s.data=d,s}),extent)}return voronoi2.polygons=function(data){return voronoi2(data).polygons()},voronoi2.links=function(data){return voronoi2(data).links()},voronoi2.triangles=function(data){return voronoi2(data).triangles()},voronoi2.x=function(_){return arguments.length?(x$$1=typeof _=="function"?_:constant(+_),voronoi2):x$$1},voronoi2.y=function(_){return arguments.length?(y$$1=typeof _=="function"?_:constant(+_),voronoi2):y$$1},voronoi2.extent=function(_){return arguments.length?(extent=_==null?null:[[+_[0][0],+_[0][1]],[+_[1][0],+_[1][1]]],voronoi2):extent&&[[extent[0][0],extent[0][1]],[extent[1][0],extent[1][1]]]},voronoi2.size=function(_){return arguments.length?(extent=_==null?null:[[0,0],[+_[0],+_[1]]],voronoi2):extent&&[extent[1][0]-extent[0][0],extent[1][1]-extent[0][1]]},voronoi2};function coordsToPolygon(coords){return coords=coords.slice(),coords.push(coords[0]),polygon([coords])}function voronoi$1(points$$1,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var bbox2=options.bbox||[-180,-85,180,85];if(!points$$1)throw new Error("points is required");if(!Array.isArray(bbox2))throw new Error("bbox is invalid");return collectionOf(points$$1,"Point","points"),featureCollection(voronoi().x(function(feature$$1){return feature$$1.geometry.coordinates[0]}).y(function(feature$$1){return feature$$1.geometry.coordinates[1]}).extent([[bbox2[0],bbox2[1]],[bbox2[2],bbox2[3]]]).polygons(points$$1.features).map(coordsToPolygon))}function ellipse(center2,xSemiAxis,ySemiAxis,options){options=options||{};var steps=options.steps||64,units=options.units||"kilometers",angle3=options.angle||0,pivot=options.pivot||center2,properties=options.properties||center2.properties||{};if(!center2)throw new Error("center is required");if(!xSemiAxis)throw new Error("xSemiAxis is required");if(!ySemiAxis)throw new Error("ySemiAxis is required");if(!isObject(options))throw new Error("options must be an object");if(!isNumber(steps))throw new Error("steps must be a number");if(!isNumber(angle3))throw new Error("angle must be a number");var centerCoords=getCoord(center2);if(units==="degrees")var angleRad=degreesToRadians(angle3);else xSemiAxis=rhumbDestination(center2,xSemiAxis,90,{units}),ySemiAxis=rhumbDestination(center2,ySemiAxis,0,{units}),xSemiAxis=getCoord(xSemiAxis)[0]-centerCoords[0],ySemiAxis=getCoord(ySemiAxis)[1]-centerCoords[1];for(var coordinates=[],i=0;i<steps;i+=1){var stepAngle=i*-360/steps,x2=xSemiAxis*ySemiAxis/Math.sqrt(Math.pow(ySemiAxis,2)+Math.pow(xSemiAxis,2)*Math.pow(getTanDeg(stepAngle),2)),y2=xSemiAxis*ySemiAxis/Math.sqrt(Math.pow(xSemiAxis,2)+Math.pow(ySemiAxis,2)/Math.pow(getTanDeg(stepAngle),2));if(stepAngle<-90&&stepAngle>=-270&&(x2=-x2),stepAngle<-180&&stepAngle>=-360&&(y2=-y2),units==="degrees"){var newx=x2*Math.cos(angleRad)+y2*Math.sin(angleRad),newy=y2*Math.cos(angleRad)-x2*Math.sin(angleRad);x2=newx,y2=newy}coordinates.push([x2+centerCoords[0],y2+centerCoords[1]])}return coordinates.push(coordinates[0]),units==="degrees"?polygon([coordinates],properties):transformRotate(polygon([coordinates],properties),angle3,{pivot})}function getTanDeg(deg){var rad2=deg*Math.PI/180;return Math.tan(rad2)}function centerMean(geojson,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var properties=options.properties,weightTerm=options.weight;if(!geojson)throw new Error("geojson is required");var sumXs=0,sumYs=0,sumNs=0;return geomEach(geojson,function(geom,featureIndex,properties2){var weight=properties2[weightTerm];if(weight=weight??1,!isNumber(weight))throw new Error("weight value must be a number for feature index "+featureIndex);weight=Number(weight),weight>0&&coordEach(geom,function(coord){sumXs+=coord[0]*weight,sumYs+=coord[1]*weight,sumNs+=weight})}),point([sumXs/sumNs,sumYs/sumNs],properties)}function centerMedian(features,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var counter=options.counter||10;if(!isNumber(counter))throw new Error("counter must be a number");var weightTerm=options.weight,meanCenter=centerMean(features,{weight:options.weight}),centroids=featureCollection([]);return featureEach(features,function(feature$$1){centroids.features.push(centroid(feature$$1,{weight:feature$$1.properties[weightTerm]}))}),centroids.properties={tolerance:options.tolerance,medianCandidates:[]},findMedian(meanCenter.geometry.coordinates,[0,0],centroids,counter)}function findMedian(candidateMedian,previousCandidate,centroids,counter){var tolerance=centroids.properties.tolerance||.001,candidateXsum=0,candidateYsum=0,kSum=0,centroidCount=0;if(featureEach(centroids,function(theCentroid){var weightValue=theCentroid.properties.weight,weight=weightValue??1;if(weight=Number(weight),!isNumber(weight))throw new Error("weight value must be a number");if(weight>0){centroidCount+=1;var distanceFromCandidate=weight*distance2(theCentroid,candidateMedian);distanceFromCandidate===0&&(distanceFromCandidate=1);var k=weight/distanceFromCandidate;candidateXsum+=theCentroid.geometry.coordinates[0]*k,candidateYsum+=theCentroid.geometry.coordinates[1]*k,kSum+=k}}),centroidCount<1)throw new Error("no features to measure");var candidateX=candidateXsum/kSum,candidateY=candidateYsum/kSum;return centroidCount===1||counter===0||Math.abs(candidateX-previousCandidate[0])<tolerance&&Math.abs(candidateY-previousCandidate[1])<tolerance?point([candidateX,candidateY],{medianCandidates:centroids.properties.medianCandidates}):(centroids.properties.medianCandidates.push([candidateX,candidateY]),findMedian([candidateX,candidateY],candidateMedian,centroids,counter-1))}function standardDeviationalEllipse(points$$1,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var steps=options.steps||64,weightTerm=options.weight,properties=options.properties||{};if(!isNumber(steps))throw new Error("steps must be a number");if(!isObject(properties))throw new Error("properties must be a number");var numberOfFeatures=coordAll(points$$1).length,meanCenter=centerMean(points$$1,{weight:weightTerm}),xDeviationSquaredSum=0,yDeviationSquaredSum=0,xyDeviationSum=0;featureEach(points$$1,function(point$$1){var weight=point$$1.properties[weightTerm]||1,deviation=getDeviations(getCoords(point$$1),getCoords(meanCenter));xDeviationSquaredSum+=Math.pow(deviation.x,2)*weight,yDeviationSquaredSum+=Math.pow(deviation.y,2)*weight,xyDeviationSum+=deviation.x*deviation.y*weight});var bigA=xDeviationSquaredSum-yDeviationSquaredSum,bigB=Math.sqrt(Math.pow(bigA,2)+4*Math.pow(xyDeviationSum,2)),bigC=2*xyDeviationSum,theta=Math.atan((bigA+bigB)/bigC),thetaDeg=theta*180/Math.PI,sigmaXsum=0,sigmaYsum=0,weightsum=0;featureEach(points$$1,function(point$$1){var weight=point$$1.properties[weightTerm]||1,deviation=getDeviations(getCoords(point$$1),getCoords(meanCenter));sigmaXsum+=Math.pow(deviation.x*Math.cos(theta)-deviation.y*Math.sin(theta),2)*weight,sigmaYsum+=Math.pow(deviation.x*Math.sin(theta)+deviation.y*Math.cos(theta),2)*weight,weightsum+=weight});var sigmaX=Math.sqrt(2*sigmaXsum/weightsum),sigmaY=Math.sqrt(2*sigmaYsum/weightsum),theEllipse=ellipse(meanCenter,sigmaX,sigmaY,{units:"degrees",angle:thetaDeg,steps,properties}),pointsWithinEllipse=pointsWithinPolygon(points$$1,featureCollection([theEllipse])),standardDeviationalEllipseProperties={meanCenterCoordinates:getCoords(meanCenter),semiMajorAxis:sigmaX,semiMinorAxis:sigmaY,numberOfFeatures,angle:thetaDeg,percentageWithinEllipse:100*coordAll(pointsWithinEllipse).length/numberOfFeatures};return theEllipse.properties.standardDeviationalEllipse=standardDeviationalEllipseProperties,theEllipse}function getDeviations(coordinates,center2){return{x:coordinates[0]-center2[0],y:coordinates[1]-center2[1]}}function randomPosition(bbox2){if(isObject(bbox2)&&(bbox2=bbox2.bbox),bbox2&&!Array.isArray(bbox2))throw new Error("bbox is invalid");return bbox2?coordInBBox(bbox2):[lon(),lat()]}function randomPoint(count2,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var bbox2=options.bbox;count2==null&&(count2=1);for(var features=[],i=0;i<count2;i++)features.push(point(randomPosition(bbox2)));return featureCollection(features)}function randomPolygon(count2,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var bbox2=options.bbox,num_vertices=options.num_vertices,max_radial_length=options.max_radial_length;count2==null&&(count2=1),isNumber(num_vertices)||(num_vertices=10),isNumber(max_radial_length)||(max_radial_length=10);for(var features=[],i=0;i<count2;i++){var vertices=[],circle_offsets=Array.apply(null,new Array(num_vertices+1)).map(Math.random);circle_offsets.forEach(sumOffsets),circle_offsets.forEach(scaleOffsets),vertices[vertices.length-1]=vertices[0],vertices=vertices.map(vertexToCoordinate(randomPosition(bbox2))),features.push(polygon([vertices]))}function sumOffsets(cur,index,arr){arr[index]=index>0?cur+arr[index-1]:cur}function scaleOffsets(cur){cur=cur*2*Math.PI/circle_offsets[circle_offsets.length-1];var radial_scaler=Math.random();vertices.push([radial_scaler*max_radial_length*Math.sin(cur),radial_scaler*max_radial_length*Math.cos(cur)])}return featureCollection(features)}function randomLineString(count2,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var bbox2=options.bbox,num_vertices=options.num_vertices,max_length=options.max_length,max_rotation=options.max_rotation;count2==null&&(count2=1),(!isNumber(num_vertices)||num_vertices<2)&&(num_vertices=10),isNumber(max_length)||(max_length=1e-4),isNumber(max_rotation)||(max_rotation=Math.PI/8);for(var features=[],i=0;i<count2;i++){for(var startingPoint=randomPosition(bbox2),vertices=[startingPoint],j=0;j<num_vertices-1;j++){var priorAngle=j===0?Math.random()*2*Math.PI:Math.tan((vertices[j][1]-vertices[j-1][1])/(vertices[j][0]-vertices[j-1][0])),angle3=priorAngle+(Math.random()-.5)*max_rotation*2,distance12=Math.random()*max_length;vertices.push([vertices[j][0]+distance12*Math.cos(angle3),vertices[j][1]+distance12*Math.sin(angle3)])}features.push(lineString(vertices))}return featureCollection(features)}function vertexToCoordinate(hub){return function(cur){return[cur[0]+hub[0],cur[1]+hub[1]]}}function rnd(){return Math.random()-.5}function lon(){return rnd()*360}function lat(){return rnd()*180}function coordInBBox(bbox2){return[Math.random()*(bbox2[2]-bbox2[0])+bbox2[0],Math.random()*(bbox2[3]-bbox2[1])+bbox2[1]]}var main_es$4=Object.freeze({randomPosition,randomPoint,randomPolygon,randomLineString});function getCluster(geojson,filter17){if(!geojson)throw new Error("geojson is required");if(geojson.type!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(filter17==null)throw new Error("filter is required");var features=[];return featureEach(geojson,function(feature$$1){applyFilter(feature$$1.properties,filter17)&&features.push(feature$$1)}),featureCollection(features)}function clusterEach(geojson,property,callback){if(!geojson)throw new Error("geojson is required");if(geojson.type!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(property==null)throw new Error("property is required");for(var bins=createBins(geojson,property),values3=Object.keys(bins),index=0;index<values3.length;index++){for(var value=values3[index],bin=bins[value],features=[],i=0;i<bin.length;i++)features.push(geojson.features[bin[i]]);callback(featureCollection(features),value,index)}}function clusterReduce(geojson,property,callback,initialValue){var previousValue=initialValue;return clusterEach(geojson,property,function(cluster,clusterValue,currentIndex){currentIndex===0&&initialValue===void 0?previousValue=cluster:previousValue=callback(previousValue,cluster,clusterValue,currentIndex)}),previousValue}function createBins(geojson,property){var bins={};return featureEach(geojson,function(feature$$1,i){var properties=feature$$1.properties||{};if(properties.hasOwnProperty(property)){var value=properties[property];bins.hasOwnProperty(value)?bins[value].push(i):bins[value]=[i]}}),bins}function applyFilter(properties,filter17){if(properties===void 0)return!1;var filterType=typeof filter17;if(filterType==="number"||filterType==="string")return properties.hasOwnProperty(filter17);if(Array.isArray(filter17)){for(var i=0;i<filter17.length;i++)if(!applyFilter(properties,filter17[i]))return!1;return!0}else return propertiesContainsFilter(properties,filter17)}function propertiesContainsFilter(properties,filter17){for(var keys2=Object.keys(filter17),i=0;i<keys2.length;i++){var key=keys2[i];if(properties[key]!==filter17[key])return!1}return!0}function filterProperties(properties,keys2){if(!keys2)return{};if(!keys2.length)return{};for(var newProperties={},i=0;i<keys2.length;i++){var key=keys2[i];properties.hasOwnProperty(key)&&(newProperties[key]=properties[key])}return newProperties}var main_es$5=Object.freeze({getCluster,clusterEach,clusterReduce,createBins,applyFilter,propertiesContainsFilter,filterProperties});"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(value){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var arrayLike=Object(this),length3=Math.max(Math.min(arrayLike.length,9007199254740991),0)||0,relativeStart=1 in arguments&&parseInt(Number(arguments[1]),10)||0;relativeStart=relativeStart<0?Math.max(length3+relativeStart,0):Math.min(relativeStart,length3);var relativeEnd=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:length3;for(relativeEnd=relativeEnd<0?Math.max(length3+arguments[2],0):Math.min(relativeEnd,length3);relativeStart<relativeEnd;)arrayLike[relativeStart]=value,++relativeStart;return arrayLike},writable:!0});Number.isFinite=Number.isFinite||function(value){return typeof value=="number"&&isFinite(value)};Number.isInteger=Number.isInteger||function(val){return typeof val=="number"&&isFinite(val)&&Math.floor(val)===val};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(value){return value!==value};Math.trunc=Math.trunc||function(x2){return x2<0?Math.ceil(x2):Math.floor(x2)};var NumberUtil=function(){};NumberUtil.prototype.interfaces_=function(){return[]};NumberUtil.prototype.getClass=function(){return NumberUtil};NumberUtil.prototype.equalsWithTolerance=function(x12,x2,tolerance){return Math.abs(x12-x2)<=tolerance};var IllegalArgumentException=function(){},Double=function(){},staticAccessors$1={MAX_VALUE:{configurable:!0}};Double.isNaN=function(n){return Number.isNaN(n)};Double.doubleToLongBits=function(n){return n};Double.longBitsToDouble=function(n){return n};Double.isInfinite=function(n){return!Number.isFinite(n)};staticAccessors$1.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(Double,staticAccessors$1);var Comparable=function(){},Clonable=function(){},Comparator=function(){};function Serializable(){}var Coordinate=function Coordinate2(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=Coordinate2.NULL_ORDINATE;else if(arguments.length===1){var c=arguments[0];this.x=c.x,this.y=c.y,this.z=c.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=Coordinate2.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},staticAccessors={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Coordinate.prototype.setOrdinate=function(ordinateIndex,value){switch(ordinateIndex){case Coordinate.X:this.x=value;break;case Coordinate.Y:this.y=value;break;case Coordinate.Z:this.z=value;break;default:throw new IllegalArgumentException("Invalid ordinate index: "+ordinateIndex)}};Coordinate.prototype.equals2D=function(){if(arguments.length===1){var other=arguments[0];return!(this.x!==other.x||this.y!==other.y)}else if(arguments.length===2){var c=arguments[0],tolerance=arguments[1];return!(!NumberUtil.equalsWithTolerance(this.x,c.x,tolerance)||!NumberUtil.equalsWithTolerance(this.y,c.y,tolerance))}};Coordinate.prototype.getOrdinate=function(ordinateIndex){switch(ordinateIndex){case Coordinate.X:return this.x;case Coordinate.Y:return this.y;case Coordinate.Z:return this.z;default:}throw new IllegalArgumentException("Invalid ordinate index: "+ordinateIndex)};Coordinate.prototype.equals3D=function(other){return this.x===other.x&&this.y===other.y&&(this.z===other.z||Double.isNaN(this.z))&&Double.isNaN(other.z)};Coordinate.prototype.equals=function(other){return other instanceof Coordinate?this.equals2D(other):!1};Coordinate.prototype.equalInZ=function(c,tolerance){return NumberUtil.equalsWithTolerance(this.z,c.z,tolerance)};Coordinate.prototype.compareTo=function(o){var other=o;return this.x<other.x?-1:this.x>other.x?1:this.y<other.y?-1:this.y>other.y?1:0};Coordinate.prototype.clone=function(){};Coordinate.prototype.copy=function(){return new Coordinate(this)};Coordinate.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Coordinate.prototype.distance3D=function(c){var dx=this.x-c.x,dy=this.y-c.y,dz=this.z-c.z;return Math.sqrt(dx*dx+dy*dy+dz*dz)};Coordinate.prototype.distance=function(c){var dx=this.x-c.x,dy=this.y-c.y;return Math.sqrt(dx*dx+dy*dy)};Coordinate.prototype.hashCode=function(){var result=17;return result=37*result+Coordinate.hashCode(this.x),result=37*result+Coordinate.hashCode(this.y),result};Coordinate.prototype.setCoordinate=function(other){this.x=other.x,this.y=other.y,this.z=other.z};Coordinate.prototype.interfaces_=function(){return[Comparable,Clonable,Serializable]};Coordinate.prototype.getClass=function(){return Coordinate};Coordinate.hashCode=function(){if(arguments.length===1){var x2=arguments[0],f=Double.doubleToLongBits(x2);return Math.trunc((f^f)>>>32)}};staticAccessors.DimensionalComparator.get=function(){return DimensionalComparator};staticAccessors.serialVersionUID.get=function(){return 6683108902428367e3};staticAccessors.NULL_ORDINATE.get=function(){return Double.NaN};staticAccessors.X.get=function(){return 0};staticAccessors.Y.get=function(){return 1};staticAccessors.Z.get=function(){return 2};Object.defineProperties(Coordinate,staticAccessors);var DimensionalComparator=function(dimensionsToTest){if(this._dimensionsToTest=2,arguments.length!==0){if(arguments.length===1){var dimensionsToTest$1=arguments[0];if(dimensionsToTest$1!==2&&dimensionsToTest$1!==3)throw new IllegalArgumentException("only 2 or 3 dimensions may be specified");this._dimensionsToTest=dimensionsToTest$1}}};DimensionalComparator.prototype.compare=function(o1,o2){var c1=o1,c2=o2,compX=DimensionalComparator.compare(c1.x,c2.x);if(compX!==0)return compX;var compY=DimensionalComparator.compare(c1.y,c2.y);if(compY!==0)return compY;if(this._dimensionsToTest<=2)return 0;var compZ=DimensionalComparator.compare(c1.z,c2.z);return compZ};DimensionalComparator.prototype.interfaces_=function(){return[Comparator]};DimensionalComparator.prototype.getClass=function(){return DimensionalComparator};DimensionalComparator.compare=function(a,b){return a<b?-1:a>b?1:Double.isNaN(a)?Double.isNaN(b)?0:-1:Double.isNaN(b)?1:0};var CoordinateSequenceFactory=function(){};CoordinateSequenceFactory.prototype.create=function(){};CoordinateSequenceFactory.prototype.interfaces_=function(){return[]};CoordinateSequenceFactory.prototype.getClass=function(){return CoordinateSequenceFactory};var Location=function(){},staticAccessors$4={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Location.prototype.interfaces_=function(){return[]};Location.prototype.getClass=function(){return Location};Location.toLocationSymbol=function(locationValue){switch(locationValue){case Location.EXTERIOR:return"e";case Location.BOUNDARY:return"b";case Location.INTERIOR:return"i";case Location.NONE:return"-";default:}throw new IllegalArgumentException("Unknown location value: "+locationValue)};staticAccessors$4.INTERIOR.get=function(){return 0};staticAccessors$4.BOUNDARY.get=function(){return 1};staticAccessors$4.EXTERIOR.get=function(){return 2};staticAccessors$4.NONE.get=function(){return-1};Object.defineProperties(Location,staticAccessors$4);var hasInterface=function(o,i){return o.interfaces_&&o.interfaces_().indexOf(i)>-1},MathUtil=function(){},staticAccessors$5={LOG_10:{configurable:!0}};MathUtil.prototype.interfaces_=function(){return[]};MathUtil.prototype.getClass=function(){return MathUtil};MathUtil.log10=function(x2){var ln=Math.log(x2);return Double.isInfinite(ln)||Double.isNaN(ln)?ln:ln/MathUtil.LOG_10};MathUtil.min=function(v1,v2,v3,v4){var min4=v1;return v2<min4&&(min4=v2),v3<min4&&(min4=v3),v4<min4&&(min4=v4),min4};MathUtil.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var x2=arguments[0],min4=arguments[1],max3=arguments[2];return x2<min4?min4:x2>max3?max3:x2}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var x$1=arguments[0],min$1=arguments[1],max$1=arguments[2];return x$1<min$1?min$1:x$1>max$1?max$1:x$1}};MathUtil.wrap=function(index,max3){return index<0?max3- -index%max3:index%max3};MathUtil.max=function(){if(arguments.length===3){var v1=arguments[0],v2=arguments[1],v3=arguments[2],max3=v1;return v2>max3&&(max3=v2),v3>max3&&(max3=v3),max3}else if(arguments.length===4){var v1$1=arguments[0],v2$1=arguments[1],v3$1=arguments[2],v4=arguments[3],max$1=v1$1;return v2$1>max$1&&(max$1=v2$1),v3$1>max$1&&(max$1=v3$1),v4>max$1&&(max$1=v4),max$1}};MathUtil.average=function(x12,x2){return(x12+x2)/2};staticAccessors$5.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(MathUtil,staticAccessors$5);var StringBuffer=function(str){this.str=str};StringBuffer.prototype.append=function(e){this.str+=e};StringBuffer.prototype.setCharAt=function(i,c){this.str=this.str.substr(0,i)+c+this.str.substr(i+1)};StringBuffer.prototype.toString=function(e){return this.str};var Integer=function(value){this.value=value};Integer.prototype.intValue=function(){return this.value};Integer.prototype.compareTo=function(o){return this.value<o?-1:this.value>o?1:0};Integer.isNaN=function(n){return Number.isNaN(n)};var Character=function(){};Character.isWhitespace=function(c){return c<=32&&c>=0||c===127};Character.toUpperCase=function(c){return c.toUpperCase()};var DD=function DD2(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var x2=arguments[0];this.init(x2)}else if(arguments[0]instanceof DD2){var dd=arguments[0];this.init(dd)}else if(typeof arguments[0]=="string"){var str=arguments[0];DD2.call(this,DD2.parse(str))}}else if(arguments.length===2){var hi=arguments[0],lo=arguments[1];this.init(hi,lo)}},staticAccessors$7={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};DD.prototype.le=function(y2){return(this._hi<y2._hi||this._hi===y2._hi)&&this._lo<=y2._lo};DD.prototype.extractSignificantDigits=function(insertDecimalPoint,magnitude2){var y2=this.abs(),mag=DD.magnitude(y2._hi),scale4=DD.TEN.pow(mag);y2=y2.divide(scale4),y2.gt(DD.TEN)?(y2=y2.divide(DD.TEN),mag+=1):y2.lt(DD.ONE)&&(y2=y2.multiply(DD.TEN),mag-=1);for(var decimalPointPos=mag+1,buf=new StringBuffer,numDigits=DD.MAX_PRINT_DIGITS-1,i=0;i<=numDigits;i++){insertDecimalPoint&&i===decimalPointPos&&buf.append(".");var digit=Math.trunc(y2._hi);if(digit<0)break;var rebiasBy10=!1,digitChar=0;digit>9?(rebiasBy10=!0,digitChar="9"):digitChar="0"+digit,buf.append(digitChar),y2=y2.subtract(DD.valueOf(digit)).multiply(DD.TEN),rebiasBy10&&y2.selfAdd(DD.TEN);var continueExtractingDigits=!0,remMag=DD.magnitude(y2._hi);if(remMag<0&&Math.abs(remMag)>=numDigits-i&&(continueExtractingDigits=!1),!continueExtractingDigits)break}return magnitude2[0]=mag,buf.toString()};DD.prototype.sqr=function(){return this.multiply(this)};DD.prototype.doubleValue=function(){return this._hi+this._lo};DD.prototype.subtract=function(){if(arguments[0]instanceof DD){var y2=arguments[0];return this.add(y2.negate())}else if(typeof arguments[0]=="number"){var y$1=arguments[0];return this.add(-y$1)}};DD.prototype.equals=function(){if(arguments.length===1){var y2=arguments[0];return this._hi===y2._hi&&this._lo===y2._lo}};DD.prototype.isZero=function(){return this._hi===0&&this._lo===0};DD.prototype.selfSubtract=function(){if(arguments[0]instanceof DD){var y2=arguments[0];return this.isNaN()?this:this.selfAdd(-y2._hi,-y2._lo)}else if(typeof arguments[0]=="number"){var y$1=arguments[0];return this.isNaN()?this:this.selfAdd(-y$1,0)}};DD.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};DD.prototype.min=function(x2){return this.le(x2)?this:x2};DD.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof DD){var y2=arguments[0];return this.selfDivide(y2._hi,y2._lo)}else if(typeof arguments[0]=="number"){var y$1=arguments[0];return this.selfDivide(y$1,0)}}else if(arguments.length===2){var yhi=arguments[0],ylo=arguments[1],hc=null,tc=null,hy=null,ty=null,C=null,c=null,U=null,u=null;return C=this._hi/yhi,c=DD.SPLIT*C,hc=c-C,u=DD.SPLIT*yhi,hc=c-hc,tc=C-hc,hy=u-yhi,U=C*yhi,hy=u-hy,ty=yhi-hy,u=hc*hy-U+hc*ty+tc*hy+tc*ty,c=(this._hi-U-u+this._lo-C*ylo)/yhi,u=C+c,this._hi=u,this._lo=C-u+c,this}};DD.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};DD.prototype.divide=function(){if(arguments[0]instanceof DD){var y2=arguments[0],hc=null,tc=null,hy=null,ty=null,C=null,c=null,U=null,u=null;C=this._hi/y2._hi,c=DD.SPLIT*C,hc=c-C,u=DD.SPLIT*y2._hi,hc=c-hc,tc=C-hc,hy=u-y2._hi,U=C*y2._hi,hy=u-hy,ty=y2._hi-hy,u=hc*hy-U+hc*ty+tc*hy+tc*ty,c=(this._hi-U-u+this._lo-C*y2._lo)/y2._hi,u=C+c;var zhi=u,zlo=C-u+c;return new DD(zhi,zlo)}else if(typeof arguments[0]=="number"){var y$1=arguments[0];return Double.isNaN(y$1)?DD.createNaN():DD.copy(this).selfDivide(y$1,0)}};DD.prototype.ge=function(y2){return(this._hi>y2._hi||this._hi===y2._hi)&&this._lo>=y2._lo};DD.prototype.pow=function(exp3){if(exp3===0)return DD.valueOf(1);var r=new DD(this),s=DD.valueOf(1),n=Math.abs(exp3);if(n>1)for(;n>0;)n%2===1&&s.selfMultiply(r),n/=2,n>0&&(r=r.sqr());else s=r;return exp3<0?s.reciprocal():s};DD.prototype.ceil=function(){if(this.isNaN())return DD.NaN;var fhi=Math.ceil(this._hi),flo=0;return fhi===this._hi&&(flo=Math.ceil(this._lo)),new DD(fhi,flo)};DD.prototype.compareTo=function(o){var other=o;return this._hi<other._hi?-1:this._hi>other._hi?1:this._lo<other._lo?-1:this._lo>other._lo?1:0};DD.prototype.rint=function(){if(this.isNaN())return this;var plus5=this.add(.5);return plus5.floor()};DD.prototype.setValue=function(){if(arguments[0]instanceof DD){var value=arguments[0];return this.init(value),this}else if(typeof arguments[0]=="number"){var value$1=arguments[0];return this.init(value$1),this}};DD.prototype.max=function(x2){return this.ge(x2)?this:x2};DD.prototype.sqrt=function(){if(this.isZero())return DD.valueOf(0);if(this.isNegative())return DD.NaN;var x2=1/Math.sqrt(this._hi),ax=this._hi*x2,axdd=DD.valueOf(ax),diffSq=this.subtract(axdd.sqr()),d2=diffSq._hi*(x2*.5);return axdd.add(d2)};DD.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof DD){var y2=arguments[0];return this.selfAdd(y2._hi,y2._lo)}else if(typeof arguments[0]=="number"){var y$1=arguments[0],H=null,h=null,S=null,s=null,e=null,f=null;return S=this._hi+y$1,e=S-this._hi,s=S-e,s=y$1-e+(this._hi-s),f=s+this._lo,H=S+f,h=f+(S-H),this._hi=H+h,this._lo=h+(H-this._hi),this}}else if(arguments.length===2){var yhi=arguments[0],ylo=arguments[1],H$1=null,h$1=null,T=null,t=null,S$1=null,s$1=null,e$1=null,f$1=null;S$1=this._hi+yhi,T=this._lo+ylo,e$1=S$1-this._hi,f$1=T-this._lo,s$1=S$1-e$1,t=T-f$1,s$1=yhi-e$1+(this._hi-s$1),t=ylo-f$1+(this._lo-t),e$1=s$1+T,H$1=S$1+e$1,h$1=e$1+(S$1-H$1),e$1=t+h$1;var zhi=H$1+e$1,zlo=e$1+(H$1-zhi);return this._hi=zhi,this._lo=zlo,this}};DD.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof DD){var y2=arguments[0];return this.selfMultiply(y2._hi,y2._lo)}else if(typeof arguments[0]=="number"){var y$1=arguments[0];return this.selfMultiply(y$1,0)}}else if(arguments.length===2){var yhi=arguments[0],ylo=arguments[1],hx=null,tx=null,hy=null,ty=null,C=null,c=null;C=DD.SPLIT*this._hi,hx=C-this._hi,c=DD.SPLIT*yhi,hx=C-hx,tx=this._hi-hx,hy=c-yhi,C=this._hi*yhi,hy=c-hy,ty=yhi-hy,c=hx*hy-C+hx*ty+tx*hy+tx*ty+(this._hi*ylo+this._lo*yhi);var zhi=C+c;hx=C-zhi;var zlo=c+hx;return this._hi=zhi,this._lo=zlo,this}};DD.prototype.selfSqr=function(){return this.selfMultiply(this)};DD.prototype.floor=function(){if(this.isNaN())return DD.NaN;var fhi=Math.floor(this._hi),flo=0;return fhi===this._hi&&(flo=Math.floor(this._lo)),new DD(fhi,flo)};DD.prototype.negate=function(){return this.isNaN()?this:new DD(-this._hi,-this._lo)};DD.prototype.clone=function(){};DD.prototype.multiply=function(){if(arguments[0]instanceof DD){var y2=arguments[0];return y2.isNaN()?DD.createNaN():DD.copy(this).selfMultiply(y2)}else if(typeof arguments[0]=="number"){var y$1=arguments[0];return Double.isNaN(y$1)?DD.createNaN():DD.copy(this).selfMultiply(y$1,0)}};DD.prototype.isNaN=function(){return Double.isNaN(this._hi)};DD.prototype.intValue=function(){return Math.trunc(this._hi)};DD.prototype.toString=function(){var mag=DD.magnitude(this._hi);return mag>=-3&&mag<=20?this.toStandardNotation():this.toSciNotation()};DD.prototype.toStandardNotation=function(){var specialStr=this.getSpecialNumberString();if(specialStr!==null)return specialStr;var magnitude2=new Array(1).fill(null),sigDigits=this.extractSignificantDigits(!0,magnitude2),decimalPointPos=magnitude2[0]+1,num=sigDigits;if(sigDigits.charAt(0)===".")num="0"+sigDigits;else if(decimalPointPos<0)num="0."+DD.stringOfChar("0",-decimalPointPos)+sigDigits;else if(sigDigits.indexOf(".")===-1){var numZeroes=decimalPointPos-sigDigits.length,zeroes=DD.stringOfChar("0",numZeroes);num=sigDigits+zeroes+".0"}return this.isNegative()?"-"+num:num};DD.prototype.reciprocal=function(){var hc=null,tc=null,hy=null,ty=null,C=null,c=null,U=null,u=null;C=1/this._hi,c=DD.SPLIT*C,hc=c-C,u=DD.SPLIT*this._hi,hc=c-hc,tc=C-hc,hy=u-this._hi,U=C*this._hi,hy=u-hy,ty=this._hi-hy,u=hc*hy-U+hc*ty+tc*hy+tc*ty,c=(1-U-u-C*this._lo)/this._hi;var zhi=C+c,zlo=C-zhi+c;return new DD(zhi,zlo)};DD.prototype.toSciNotation=function(){if(this.isZero())return DD.SCI_NOT_ZERO;var specialStr=this.getSpecialNumberString();if(specialStr!==null)return specialStr;var magnitude2=new Array(1).fill(null),digits=this.extractSignificantDigits(!1,magnitude2),expStr=DD.SCI_NOT_EXPONENT_CHAR+magnitude2[0];if(digits.charAt(0)==="0")throw new Error("Found leading zero: "+digits);var trailingDigits="";digits.length>1&&(trailingDigits=digits.substring(1));var digitsWithDecimal=digits.charAt(0)+"."+trailingDigits;return this.isNegative()?"-"+digitsWithDecimal+expStr:digitsWithDecimal+expStr};DD.prototype.abs=function(){return this.isNaN()?DD.NaN:this.isNegative()?this.negate():new DD(this)};DD.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};DD.prototype.lt=function(y2){return(this._hi<y2._hi||this._hi===y2._hi)&&this._lo<y2._lo};DD.prototype.add=function(){if(arguments[0]instanceof DD){var y2=arguments[0];return DD.copy(this).selfAdd(y2)}else if(typeof arguments[0]=="number"){var y$1=arguments[0];return DD.copy(this).selfAdd(y$1)}};DD.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var x2=arguments[0];this._hi=x2,this._lo=0}else if(arguments[0]instanceof DD){var dd=arguments[0];this._hi=dd._hi,this._lo=dd._lo}}else if(arguments.length===2){var hi=arguments[0],lo=arguments[1];this._hi=hi,this._lo=lo}};DD.prototype.gt=function(y2){return(this._hi>y2._hi||this._hi===y2._hi)&&this._lo>y2._lo};DD.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};DD.prototype.trunc=function(){return this.isNaN()?DD.NaN:this.isPositive()?this.floor():this.ceil()};DD.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};DD.prototype.interfaces_=function(){return[Serializable,Comparable,Clonable]};DD.prototype.getClass=function(){return DD};DD.sqr=function(x2){return DD.valueOf(x2).selfMultiply(x2)};DD.valueOf=function(){if(typeof arguments[0]=="string"){var str=arguments[0];return DD.parse(str)}else if(typeof arguments[0]=="number"){var x2=arguments[0];return new DD(x2)}};DD.sqrt=function(x2){return DD.valueOf(x2).sqrt()};DD.parse=function(str){for(var i=0,strlen=str.length;Character.isWhitespace(str.charAt(i));)i++;var isNegative2=!1;if(i<strlen){var signCh=str.charAt(i);(signCh==="-"||signCh==="+")&&(i++,signCh==="-"&&(isNegative2=!0))}for(var val=new DD,numDigits=0,numBeforeDec=0,exp3=0;!(i>=strlen);){var ch=str.charAt(i);if(i++,Character.isDigit(ch)){var d=ch-"0";val.selfMultiply(DD.TEN),val.selfAdd(d),numDigits++;continue}if(ch==="."){numBeforeDec=numDigits;continue}if(ch==="e"||ch==="E"){var expStr=str.substring(i);try{exp3=Integer.parseInt(expStr)}catch(ex){throw ex instanceof Error?new Error("Invalid exponent "+expStr+" in string "+str):ex}finally{}break}throw new Error("Unexpected character '"+ch+"' at position "+i+" in string "+str)}var val2=val,numDecPlaces=numDigits-numBeforeDec-exp3;if(numDecPlaces===0)val2=val;else if(numDecPlaces>0){var scale4=DD.TEN.pow(numDecPlaces);val2=val.divide(scale4)}else if(numDecPlaces<0){var scale$1=DD.TEN.pow(-numDecPlaces);val2=val.multiply(scale$1)}return isNegative2?val2.negate():val2};DD.createNaN=function(){return new DD(Double.NaN,Double.NaN)};DD.copy=function(dd){return new DD(dd)};DD.magnitude=function(x2){var xAbs=Math.abs(x2),xLog10=Math.log(xAbs)/Math.log(10),xMag=Math.trunc(Math.floor(xLog10)),xApprox=Math.pow(10,xMag);return xApprox*10<=xAbs&&(xMag+=1),xMag};DD.stringOfChar=function(ch,len){for(var buf=new StringBuffer,i=0;i<len;i++)buf.append(ch);return buf.toString()};staticAccessors$7.PI.get=function(){return new DD(3.141592653589793,12246467991473532e-32)};staticAccessors$7.TWO_PI.get=function(){return new DD(6.283185307179586,24492935982947064e-32)};staticAccessors$7.PI_2.get=function(){return new DD(1.5707963267948966,6123233995736766e-32)};staticAccessors$7.E.get=function(){return new DD(2.718281828459045,14456468917292502e-32)};staticAccessors$7.NaN.get=function(){return new DD(Double.NaN,Double.NaN)};staticAccessors$7.EPS.get=function(){return 123259516440783e-46};staticAccessors$7.SPLIT.get=function(){return 134217729};staticAccessors$7.MAX_PRINT_DIGITS.get=function(){return 32};staticAccessors$7.TEN.get=function(){return DD.valueOf(10)};staticAccessors$7.ONE.get=function(){return DD.valueOf(1)};staticAccessors$7.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};staticAccessors$7.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(DD,staticAccessors$7);var CGAlgorithmsDD=function(){},staticAccessors$6={DP_SAFE_EPSILON:{configurable:!0}};CGAlgorithmsDD.prototype.interfaces_=function(){return[]};CGAlgorithmsDD.prototype.getClass=function(){return CGAlgorithmsDD};CGAlgorithmsDD.orientationIndex=function(p1,p2,q){var index=CGAlgorithmsDD.orientationIndexFilter(p1,p2,q);if(index<=1)return index;var dx1=DD.valueOf(p2.x).selfAdd(-p1.x),dy1=DD.valueOf(p2.y).selfAdd(-p1.y),dx2=DD.valueOf(q.x).selfAdd(-p2.x),dy2=DD.valueOf(q.y).selfAdd(-p2.y);return dx1.selfMultiply(dy2).selfSubtract(dy1.selfMultiply(dx2)).signum()};CGAlgorithmsDD.signOfDet2x2=function(x12,y12,x2,y2){var det2=x12.multiply(y2).selfSubtract(y12.multiply(x2));return det2.signum()};CGAlgorithmsDD.intersection=function(p1,p2,q1,q2){var denom1=DD.valueOf(q2.y).selfSubtract(q1.y).selfMultiply(DD.valueOf(p2.x).selfSubtract(p1.x)),denom2=DD.valueOf(q2.x).selfSubtract(q1.x).selfMultiply(DD.valueOf(p2.y).selfSubtract(p1.y)),denom=denom1.subtract(denom2),numx1=DD.valueOf(q2.x).selfSubtract(q1.x).selfMultiply(DD.valueOf(p1.y).selfSubtract(q1.y)),numx2=DD.valueOf(q2.y).selfSubtract(q1.y).selfMultiply(DD.valueOf(p1.x).selfSubtract(q1.x)),numx=numx1.subtract(numx2),fracP=numx.selfDivide(denom).doubleValue(),x2=DD.valueOf(p1.x).selfAdd(DD.valueOf(p2.x).selfSubtract(p1.x).selfMultiply(fracP)).doubleValue(),numy1=DD.valueOf(p2.x).selfSubtract(p1.x).selfMultiply(DD.valueOf(p1.y).selfSubtract(q1.y)),numy2=DD.valueOf(p2.y).selfSubtract(p1.y).selfMultiply(DD.valueOf(p1.x).selfSubtract(q1.x)),numy=numy1.subtract(numy2),fracQ=numy.selfDivide(denom).doubleValue(),y2=DD.valueOf(q1.y).selfAdd(DD.valueOf(q2.y).selfSubtract(q1.y).selfMultiply(fracQ)).doubleValue();return new Coordinate(x2,y2)};CGAlgorithmsDD.orientationIndexFilter=function(pa,pb,pc){var detsum=null,detleft=(pa.x-pc.x)*(pb.y-pc.y),detright=(pa.y-pc.y)*(pb.x-pc.x),det2=detleft-detright;if(detleft>0){if(detright<=0)return CGAlgorithmsDD.signum(det2);detsum=detleft+detright}else if(detleft<0){if(detright>=0)return CGAlgorithmsDD.signum(det2);detsum=-detleft-detright}else return CGAlgorithmsDD.signum(det2);var errbound=CGAlgorithmsDD.DP_SAFE_EPSILON*detsum;return det2>=errbound||-det2>=errbound?CGAlgorithmsDD.signum(det2):2};CGAlgorithmsDD.signum=function(x2){return x2>0?1:x2<0?-1:0};staticAccessors$6.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(CGAlgorithmsDD,staticAccessors$6);var CoordinateSequence=function(){},staticAccessors$8={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};staticAccessors$8.X.get=function(){return 0};staticAccessors$8.Y.get=function(){return 1};staticAccessors$8.Z.get=function(){return 2};staticAccessors$8.M.get=function(){return 3};CoordinateSequence.prototype.setOrdinate=function(index,ordinateIndex,value){};CoordinateSequence.prototype.size=function(){};CoordinateSequence.prototype.getOrdinate=function(index,ordinateIndex){};CoordinateSequence.prototype.getCoordinate=function(){};CoordinateSequence.prototype.getCoordinateCopy=function(i){};CoordinateSequence.prototype.getDimension=function(){};CoordinateSequence.prototype.getX=function(index){};CoordinateSequence.prototype.clone=function(){};CoordinateSequence.prototype.expandEnvelope=function(env){};CoordinateSequence.prototype.copy=function(){};CoordinateSequence.prototype.getY=function(index){};CoordinateSequence.prototype.toCoordinateArray=function(){};CoordinateSequence.prototype.interfaces_=function(){return[Clonable]};CoordinateSequence.prototype.getClass=function(){return CoordinateSequence};Object.defineProperties(CoordinateSequence,staticAccessors$8);var Exception=function(){},NotRepresentableException=function(Exception$$1){function NotRepresentableException2(){Exception$$1.call(this,"Projective point not representable on the Cartesian plane.")}return Exception$$1&&(NotRepresentableException2.__proto__=Exception$$1),NotRepresentableException2.prototype=Object.create(Exception$$1&&Exception$$1.prototype),NotRepresentableException2.prototype.constructor=NotRepresentableException2,NotRepresentableException2.prototype.interfaces_=function(){return[]},NotRepresentableException2.prototype.getClass=function(){return NotRepresentableException2},NotRepresentableException2}(Exception),System=function(){};System.arraycopy=function(src,srcPos,dest,destPos,len){for(var c=0,i=srcPos;i<srcPos+len;i++)dest[destPos+c]=src[i],c++};System.getProperty=function(name){return{"line.separator":`
`}[name]};var HCoordinate=function HCoordinate2(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var p=arguments[0];this.x=p.x,this.y=p.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var _x=arguments[0],_y=arguments[1];this.x=_x,this.y=_y,this.w=1}else if(arguments[0]instanceof HCoordinate2&&arguments[1]instanceof HCoordinate2){var p1=arguments[0],p2=arguments[1];this.x=p1.y*p2.w-p2.y*p1.w,this.y=p2.x*p1.w-p1.x*p2.w,this.w=p1.x*p2.y-p2.x*p1.y}else if(arguments[0]instanceof Coordinate&&arguments[1]instanceof Coordinate){var p1$1=arguments[0],p2$1=arguments[1];this.x=p1$1.y-p2$1.y,this.y=p2$1.x-p1$1.x,this.w=p1$1.x*p2$1.y-p2$1.x*p1$1.y}}else if(arguments.length===3){var _x$1=arguments[0],_y$1=arguments[1],_w=arguments[2];this.x=_x$1,this.y=_y$1,this.w=_w}else if(arguments.length===4){var p1$2=arguments[0],p2$2=arguments[1],q1=arguments[2],q2=arguments[3],px=p1$2.y-p2$2.y,py=p2$2.x-p1$2.x,pw=p1$2.x*p2$2.y-p2$2.x*p1$2.y,qx=q1.y-q2.y,qy=q2.x-q1.x,qw=q1.x*q2.y-q2.x*q1.y;this.x=py*qw-qy*pw,this.y=qx*pw-px*qw,this.w=px*qy-qx*py}};HCoordinate.prototype.getY=function(){var a=this.y/this.w;if(Double.isNaN(a)||Double.isInfinite(a))throw new NotRepresentableException;return a};HCoordinate.prototype.getX=function(){var a=this.x/this.w;if(Double.isNaN(a)||Double.isInfinite(a))throw new NotRepresentableException;return a};HCoordinate.prototype.getCoordinate=function(){var p=new Coordinate;return p.x=this.getX(),p.y=this.getY(),p};HCoordinate.prototype.interfaces_=function(){return[]};HCoordinate.prototype.getClass=function(){return HCoordinate};HCoordinate.intersection=function(p1,p2,q1,q2){var px=p1.y-p2.y,py=p2.x-p1.x,pw=p1.x*p2.y-p2.x*p1.y,qx=q1.y-q2.y,qy=q2.x-q1.x,qw=q1.x*q2.y-q2.x*q1.y,x2=py*qw-qy*pw,y2=qx*pw-px*qw,w=px*qy-qx*py,xInt=x2/w,yInt=y2/w;if(Double.isNaN(xInt)||Double.isInfinite(xInt)||Double.isNaN(yInt)||Double.isInfinite(yInt))throw new NotRepresentableException;return new Coordinate(xInt,yInt)};var Envelope=function Envelope2(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Coordinate){var p=arguments[0];this.init(p.x,p.x,p.y,p.y)}else if(arguments[0]instanceof Envelope2){var env=arguments[0];this.init(env)}}else if(arguments.length===2){var p1=arguments[0],p2=arguments[1];this.init(p1.x,p2.x,p1.y,p2.y)}else if(arguments.length===4){var x12=arguments[0],x2=arguments[1],y12=arguments[2],y2=arguments[3];this.init(x12,x2,y12,y2)}},staticAccessors$9={serialVersionUID:{configurable:!0}};Envelope.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Envelope.prototype.equals=function(other){if(!(other instanceof Envelope))return!1;var otherEnvelope=other;return this.isNull()?otherEnvelope.isNull():this._maxx===otherEnvelope.getMaxX()&&this._maxy===otherEnvelope.getMaxY()&&this._minx===otherEnvelope.getMinX()&&this._miny===otherEnvelope.getMinY()};Envelope.prototype.intersection=function(env){if(this.isNull()||env.isNull()||!this.intersects(env))return new Envelope;var intMinX=this._minx>env._minx?this._minx:env._minx,intMinY=this._miny>env._miny?this._miny:env._miny,intMaxX=this._maxx<env._maxx?this._maxx:env._maxx,intMaxY=this._maxy<env._maxy?this._maxy:env._maxy;return new Envelope(intMinX,intMaxX,intMinY,intMaxY)};Envelope.prototype.isNull=function(){return this._maxx<this._minx};Envelope.prototype.getMaxX=function(){return this._maxx};Envelope.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Coordinate){var p=arguments[0];return this.covers(p.x,p.y)}else if(arguments[0]instanceof Envelope){var other=arguments[0];return this.isNull()||other.isNull()?!1:other.getMinX()>=this._minx&&other.getMaxX()<=this._maxx&&other.getMinY()>=this._miny&&other.getMaxY()<=this._maxy}}else if(arguments.length===2){var x2=arguments[0],y2=arguments[1];return this.isNull()?!1:x2>=this._minx&&x2<=this._maxx&&y2>=this._miny&&y2<=this._maxy}};Envelope.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Envelope){var other=arguments[0];return this.isNull()||other.isNull()?!1:!(other._minx>this._maxx||other._maxx<this._minx||other._miny>this._maxy||other._maxy<this._miny)}else if(arguments[0]instanceof Coordinate){var p=arguments[0];return this.intersects(p.x,p.y)}}else if(arguments.length===2){var x2=arguments[0],y2=arguments[1];return this.isNull()?!1:!(x2>this._maxx||x2<this._minx||y2>this._maxy||y2<this._miny)}};Envelope.prototype.getMinY=function(){return this._miny};Envelope.prototype.getMinX=function(){return this._minx};Envelope.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Coordinate){var p=arguments[0];this.expandToInclude(p.x,p.y)}else if(arguments[0]instanceof Envelope){var other=arguments[0];if(other.isNull())return null;this.isNull()?(this._minx=other.getMinX(),this._maxx=other.getMaxX(),this._miny=other.getMinY(),this._maxy=other.getMaxY()):(other._minx<this._minx&&(this._minx=other._minx),other._maxx>this._maxx&&(this._maxx=other._maxx),other._miny<this._miny&&(this._miny=other._miny),other._maxy>this._maxy&&(this._maxy=other._maxy))}}else if(arguments.length===2){var x2=arguments[0],y2=arguments[1];this.isNull()?(this._minx=x2,this._maxx=x2,this._miny=y2,this._maxy=y2):(x2<this._minx&&(this._minx=x2),x2>this._maxx&&(this._maxx=x2),y2<this._miny&&(this._miny=y2),y2>this._maxy&&(this._maxy=y2))}};Envelope.prototype.minExtent=function(){if(this.isNull())return 0;var w=this.getWidth(),h=this.getHeight();return w<h?w:h};Envelope.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Envelope.prototype.compareTo=function(o){var env=o;return this.isNull()?env.isNull()?0:-1:env.isNull()?1:this._minx<env._minx?-1:this._minx>env._minx?1:this._miny<env._miny?-1:this._miny>env._miny?1:this._maxx<env._maxx?-1:this._maxx>env._maxx?1:this._maxy<env._maxy?-1:this._maxy>env._maxy?1:0};Envelope.prototype.translate=function(transX,transY){if(this.isNull())return null;this.init(this.getMinX()+transX,this.getMaxX()+transX,this.getMinY()+transY,this.getMaxY()+transY)};Envelope.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Envelope.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Envelope.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Envelope.prototype.maxExtent=function(){if(this.isNull())return 0;var w=this.getWidth(),h=this.getHeight();return w>h?w:h};Envelope.prototype.expandBy=function(){if(arguments.length===1){var distance12=arguments[0];this.expandBy(distance12,distance12)}else if(arguments.length===2){var deltaX=arguments[0],deltaY=arguments[1];if(this.isNull())return null;this._minx-=deltaX,this._maxx+=deltaX,this._miny-=deltaY,this._maxy+=deltaY,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Envelope.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Envelope){var other=arguments[0];return this.covers(other)}else if(arguments[0]instanceof Coordinate){var p=arguments[0];return this.covers(p)}}else if(arguments.length===2){var x2=arguments[0],y2=arguments[1];return this.covers(x2,y2)}};Envelope.prototype.centre=function(){return this.isNull()?null:new Coordinate((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Envelope.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Coordinate){var p=arguments[0];this.init(p.x,p.x,p.y,p.y)}else if(arguments[0]instanceof Envelope){var env=arguments[0];this._minx=env._minx,this._maxx=env._maxx,this._miny=env._miny,this._maxy=env._maxy}}else if(arguments.length===2){var p1=arguments[0],p2=arguments[1];this.init(p1.x,p2.x,p1.y,p2.y)}else if(arguments.length===4){var x12=arguments[0],x2=arguments[1],y12=arguments[2],y2=arguments[3];x12<x2?(this._minx=x12,this._maxx=x2):(this._minx=x2,this._maxx=x12),y12<y2?(this._miny=y12,this._maxy=y2):(this._miny=y2,this._maxy=y12)}};Envelope.prototype.getMaxY=function(){return this._maxy};Envelope.prototype.distance=function(env){if(this.intersects(env))return 0;var dx=0;this._maxx<env._minx?dx=env._minx-this._maxx:this._minx>env._maxx&&(dx=this._minx-env._maxx);var dy=0;return this._maxy<env._miny?dy=env._miny-this._maxy:this._miny>env._maxy&&(dy=this._miny-env._maxy),dx===0?dy:dy===0?dx:Math.sqrt(dx*dx+dy*dy)};Envelope.prototype.hashCode=function(){var result=17;return result=37*result+Coordinate.hashCode(this._minx),result=37*result+Coordinate.hashCode(this._maxx),result=37*result+Coordinate.hashCode(this._miny),result=37*result+Coordinate.hashCode(this._maxy),result};Envelope.prototype.interfaces_=function(){return[Comparable,Serializable]};Envelope.prototype.getClass=function(){return Envelope};Envelope.intersects=function(){if(arguments.length===3){var p1=arguments[0],p2=arguments[1],q=arguments[2];return q.x>=(p1.x<p2.x?p1.x:p2.x)&&q.x<=(p1.x>p2.x?p1.x:p2.x)&&q.y>=(p1.y<p2.y?p1.y:p2.y)&&q.y<=(p1.y>p2.y?p1.y:p2.y)}else if(arguments.length===4){var p1$1=arguments[0],p2$1=arguments[1],q1=arguments[2],q2=arguments[3],minq=Math.min(q1.x,q2.x),maxq=Math.max(q1.x,q2.x),minp=Math.min(p1$1.x,p2$1.x),maxp=Math.max(p1$1.x,p2$1.x);return!(minp>maxq||maxp<minq||(minq=Math.min(q1.y,q2.y),maxq=Math.max(q1.y,q2.y),minp=Math.min(p1$1.y,p2$1.y),maxp=Math.max(p1$1.y,p2$1.y),minp>maxq)||maxp<minq)}};staticAccessors$9.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Envelope,staticAccessors$9);var regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},WKTParser=function(geometryFactory){this.geometryFactory=geometryFactory||new GeometryFactory};WKTParser.prototype.read=function(wkt){var geometry2,type,str;wkt=wkt.replace(/[\n\r]/g," ");var matches=regExes.typeStr.exec(wkt);if(wkt.search("EMPTY")!==-1&&(matches=regExes.emptyTypeStr.exec(wkt),matches[2]=void 0),matches&&(type=matches[1].toLowerCase(),str=matches[2],parse$1[type]&&(geometry2=parse$1[type].apply(this,[str]))),geometry2===void 0)throw new Error("Could not parse WKT "+wkt);return geometry2};WKTParser.prototype.write=function(geometry2){return this.extractGeometry(geometry2)};WKTParser.prototype.extractGeometry=function(geometry2){var type=geometry2.getGeometryType().toLowerCase();if(!extract$1[type])return null;var wktType=type.toUpperCase(),data;return geometry2.isEmpty()?data=wktType+" EMPTY":data=wktType+"("+extract$1[type].apply(this,[geometry2])+")",data};var extract$1={coordinate:function(coordinate$1){return coordinate$1.x+" "+coordinate$1.y},point:function(point$1){return extract$1.coordinate.call(this,point$1._coordinates._coordinates[0])},multipoint:function(multipoint$1){for(var this$1=this,array=[],i=0,len=multipoint$1._geometries.length;i<len;++i)array.push("("+extract$1.point.apply(this$1,[multipoint$1._geometries[i]])+")");return array.join(",")},linestring:function(linestring$1){for(var this$1=this,array=[],i=0,len=linestring$1._points._coordinates.length;i<len;++i)array.push(extract$1.coordinate.apply(this$1,[linestring$1._points._coordinates[i]]));return array.join(",")},linearring:function(linearring$1){for(var this$1=this,array=[],i=0,len=linearring$1._points._coordinates.length;i<len;++i)array.push(extract$1.coordinate.apply(this$1,[linearring$1._points._coordinates[i]]));return array.join(",")},multilinestring:function(multilinestring$1){for(var this$1=this,array=[],i=0,len=multilinestring$1._geometries.length;i<len;++i)array.push("("+extract$1.linestring.apply(this$1,[multilinestring$1._geometries[i]])+")");return array.join(",")},polygon:function(polygon$1){var this$1=this,array=[];array.push("("+extract$1.linestring.apply(this,[polygon$1._shell])+")");for(var i=0,len=polygon$1._holes.length;i<len;++i)array.push("("+extract$1.linestring.apply(this$1,[polygon$1._holes[i]])+")");return array.join(",")},multipolygon:function(multipolygon$1){for(var this$1=this,array=[],i=0,len=multipolygon$1._geometries.length;i<len;++i)array.push("("+extract$1.polygon.apply(this$1,[multipolygon$1._geometries[i]])+")");return array.join(",")},geometrycollection:function(collection){for(var this$1=this,array=[],i=0,len=collection._geometries.length;i<len;++i)array.push(this$1.extractGeometry(collection._geometries[i]));return array.join(",")}},parse$1={point:function(str){if(str===void 0)return this.geometryFactory.createPoint();var coords=str.trim().split(regExes.spaces);return this.geometryFactory.createPoint(new Coordinate(Number.parseFloat(coords[0]),Number.parseFloat(coords[1])))},multipoint:function(str){var this$1=this;if(str===void 0)return this.geometryFactory.createMultiPoint();for(var point4,points2=str.trim().split(","),components=[],i=0,len=points2.length;i<len;++i)point4=points2[i].replace(regExes.trimParens,"$1"),components.push(parse$1.point.apply(this$1,[point4]));return this.geometryFactory.createMultiPoint(components)},linestring:function(str){if(str===void 0)return this.geometryFactory.createLineString();for(var points2=str.trim().split(","),components=[],coords,i=0,len=points2.length;i<len;++i)coords=points2[i].trim().split(regExes.spaces),components.push(new Coordinate(Number.parseFloat(coords[0]),Number.parseFloat(coords[1])));return this.geometryFactory.createLineString(components)},linearring:function(str){if(str===void 0)return this.geometryFactory.createLinearRing();for(var points2=str.trim().split(","),components=[],coords,i=0,len=points2.length;i<len;++i)coords=points2[i].trim().split(regExes.spaces),components.push(new Coordinate(Number.parseFloat(coords[0]),Number.parseFloat(coords[1])));return this.geometryFactory.createLinearRing(components)},multilinestring:function(str){var this$1=this;if(str===void 0)return this.geometryFactory.createMultiLineString();for(var line,lines=str.trim().split(regExes.parenComma),components=[],i=0,len=lines.length;i<len;++i)line=lines[i].replace(regExes.trimParens,"$1"),components.push(parse$1.linestring.apply(this$1,[line]));return this.geometryFactory.createMultiLineString(components)},polygon:function(str){var this$1=this;if(str===void 0)return this.geometryFactory.createPolygon();for(var ring,linestring3,linearring3,rings=str.trim().split(regExes.parenComma),shell,holes=[],i=0,len=rings.length;i<len;++i)ring=rings[i].replace(regExes.trimParens,"$1"),linestring3=parse$1.linestring.apply(this$1,[ring]),linearring3=this$1.geometryFactory.createLinearRing(linestring3._points),i===0?shell=linearring3:holes.push(linearring3);return this.geometryFactory.createPolygon(shell,holes)},multipolygon:function(str){var this$1=this;if(str===void 0)return this.geometryFactory.createMultiPolygon();for(var polygon4,polygons2=str.trim().split(regExes.doubleParenComma),components=[],i=0,len=polygons2.length;i<len;++i)polygon4=polygons2[i].replace(regExes.trimParens,"$1"),components.push(parse$1.polygon.apply(this$1,[polygon4]));return this.geometryFactory.createMultiPolygon(components)},geometrycollection:function(str){var this$1=this;if(str===void 0)return this.geometryFactory.createGeometryCollection();str=str.replace(/,\s*([A-Za-z])/g,"|$1");for(var wktArray=str.trim().split("|"),components=[],i=0,len=wktArray.length;i<len;++i)components.push(this$1.read(wktArray[i]));return this.geometryFactory.createGeometryCollection(components)}},WKTWriter=function(geometryFactory){this.parser=new WKTParser(geometryFactory)};WKTWriter.prototype.write=function(geometry2){return this.parser.write(geometry2)};WKTWriter.toLineString=function(p0,p1){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+p0.x+" "+p0.y+", "+p1.x+" "+p1.y+" )"};var RuntimeException=function(Error2){function RuntimeException2(message){Error2.call(this,message),this.name="RuntimeException",this.message=message,this.stack=new Error2().stack}return Error2&&(RuntimeException2.__proto__=Error2),RuntimeException2.prototype=Object.create(Error2&&Error2.prototype),RuntimeException2.prototype.constructor=RuntimeException2,RuntimeException2}(Error),AssertionFailedException=function(RuntimeException$$1){function AssertionFailedException2(){if(RuntimeException$$1.call(this),arguments.length===0)RuntimeException$$1.call(this);else if(arguments.length===1){var message=arguments[0];RuntimeException$$1.call(this,message)}}return RuntimeException$$1&&(AssertionFailedException2.__proto__=RuntimeException$$1),AssertionFailedException2.prototype=Object.create(RuntimeException$$1&&RuntimeException$$1.prototype),AssertionFailedException2.prototype.constructor=AssertionFailedException2,AssertionFailedException2.prototype.interfaces_=function(){return[]},AssertionFailedException2.prototype.getClass=function(){return AssertionFailedException2},AssertionFailedException2}(RuntimeException),Assert=function(){};Assert.prototype.interfaces_=function(){return[]};Assert.prototype.getClass=function(){return Assert};Assert.shouldNeverReachHere=function(){if(arguments.length===0)Assert.shouldNeverReachHere(null);else if(arguments.length===1){var message=arguments[0];throw new AssertionFailedException("Should never reach here"+(message!==null?": "+message:""))}};Assert.isTrue=function(){var assertion,message;if(arguments.length===1)assertion=arguments[0],Assert.isTrue(assertion,null);else if(arguments.length===2&&(assertion=arguments[0],message=arguments[1],!assertion))throw message===null?new AssertionFailedException:new AssertionFailedException(message)};Assert.equals=function(){var expectedValue,actualValue,message;if(arguments.length===2)expectedValue=arguments[0],actualValue=arguments[1],Assert.equals(expectedValue,actualValue,null);else if(arguments.length===3&&(expectedValue=arguments[0],actualValue=arguments[1],message=arguments[2],!actualValue.equals(expectedValue)))throw new AssertionFailedException("Expected "+expectedValue+" but encountered "+actualValue+(message!==null?": "+message:""))};var LineIntersector=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Coordinate,this._intPt[1]=new Coordinate,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},staticAccessors$10={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};LineIntersector.prototype.getIndexAlongSegment=function(segmentIndex,intIndex){return this.computeIntLineIndex(),this._intLineIndex[segmentIndex][intIndex]};LineIntersector.prototype.getTopologySummary=function(){var catBuf=new StringBuffer;return this.isEndPoint()&&catBuf.append(" endpoint"),this._isProper&&catBuf.append(" proper"),this.isCollinear()&&catBuf.append(" collinear"),catBuf.toString()};LineIntersector.prototype.computeIntersection=function(p1,p2,p3,p4){this._inputLines[0][0]=p1,this._inputLines[0][1]=p2,this._inputLines[1][0]=p3,this._inputLines[1][1]=p4,this._result=this.computeIntersect(p1,p2,p3,p4)};LineIntersector.prototype.getIntersectionNum=function(){return this._result};LineIntersector.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var segmentIndex=arguments[0],dist0=this.getEdgeDistance(segmentIndex,0),dist1=this.getEdgeDistance(segmentIndex,1);dist0>dist1?(this._intLineIndex[segmentIndex][0]=0,this._intLineIndex[segmentIndex][1]=1):(this._intLineIndex[segmentIndex][0]=1,this._intLineIndex[segmentIndex][1]=0)}};LineIntersector.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};LineIntersector.prototype.setPrecisionModel=function(precisionModel){this._precisionModel=precisionModel};LineIntersector.prototype.isInteriorIntersection=function(){var this$1=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var inputLineIndex=arguments[0],i=0;i<this._result;i++)if(!(this$1._intPt[i].equals2D(this$1._inputLines[inputLineIndex][0])||this$1._intPt[i].equals2D(this$1._inputLines[inputLineIndex][1])))return!0;return!1}};LineIntersector.prototype.getIntersection=function(intIndex){return this._intPt[intIndex]};LineIntersector.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};LineIntersector.prototype.hasIntersection=function(){return this._result!==LineIntersector.NO_INTERSECTION};LineIntersector.prototype.getEdgeDistance=function(segmentIndex,intIndex){var dist2=LineIntersector.computeEdgeDistance(this._intPt[intIndex],this._inputLines[segmentIndex][0],this._inputLines[segmentIndex][1]);return dist2};LineIntersector.prototype.isCollinear=function(){return this._result===LineIntersector.COLLINEAR_INTERSECTION};LineIntersector.prototype.toString=function(){return WKTWriter.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+WKTWriter.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};LineIntersector.prototype.getEndpoint=function(segmentIndex,ptIndex){return this._inputLines[segmentIndex][ptIndex]};LineIntersector.prototype.isIntersection=function(pt){for(var this$1=this,i=0;i<this._result;i++)if(this$1._intPt[i].equals2D(pt))return!0;return!1};LineIntersector.prototype.getIntersectionAlongSegment=function(segmentIndex,intIndex){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[segmentIndex][intIndex]]};LineIntersector.prototype.interfaces_=function(){return[]};LineIntersector.prototype.getClass=function(){return LineIntersector};LineIntersector.computeEdgeDistance=function(p,p0,p1){var dx=Math.abs(p1.x-p0.x),dy=Math.abs(p1.y-p0.y),dist2=-1;if(p.equals(p0))dist2=0;else if(p.equals(p1))dx>dy?dist2=dx:dist2=dy;else{var pdx=Math.abs(p.x-p0.x),pdy=Math.abs(p.y-p0.y);dx>dy?dist2=pdx:dist2=pdy,dist2===0&&!p.equals(p0)&&(dist2=Math.max(pdx,pdy))}return Assert.isTrue(!(dist2===0&&!p.equals(p0)),"Bad distance calculation"),dist2};LineIntersector.nonRobustComputeEdgeDistance=function(p,p1,p2){var dx=p.x-p1.x,dy=p.y-p1.y,dist2=Math.sqrt(dx*dx+dy*dy);return Assert.isTrue(!(dist2===0&&!p.equals(p1)),"Invalid distance calculation"),dist2};staticAccessors$10.DONT_INTERSECT.get=function(){return 0};staticAccessors$10.DO_INTERSECT.get=function(){return 1};staticAccessors$10.COLLINEAR.get=function(){return 2};staticAccessors$10.NO_INTERSECTION.get=function(){return 0};staticAccessors$10.POINT_INTERSECTION.get=function(){return 1};staticAccessors$10.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(LineIntersector,staticAccessors$10);var RobustLineIntersector=function(LineIntersector$$1){function RobustLineIntersector2(){LineIntersector$$1.apply(this,arguments)}return LineIntersector$$1&&(RobustLineIntersector2.__proto__=LineIntersector$$1),RobustLineIntersector2.prototype=Object.create(LineIntersector$$1&&LineIntersector$$1.prototype),RobustLineIntersector2.prototype.constructor=RobustLineIntersector2,RobustLineIntersector2.prototype.isInSegmentEnvelopes=function(intPt){var env0=new Envelope(this._inputLines[0][0],this._inputLines[0][1]),env1=new Envelope(this._inputLines[1][0],this._inputLines[1][1]);return env0.contains(intPt)&&env1.contains(intPt)},RobustLineIntersector2.prototype.computeIntersection=function(){if(arguments.length===3){var p=arguments[0],p1=arguments[1],p2=arguments[2];if(this._isProper=!1,Envelope.intersects(p1,p2,p)&&CGAlgorithms.orientationIndex(p1,p2,p)===0&&CGAlgorithms.orientationIndex(p2,p1,p)===0)return this._isProper=!0,(p.equals(p1)||p.equals(p2))&&(this._isProper=!1),this._result=LineIntersector$$1.POINT_INTERSECTION,null;this._result=LineIntersector$$1.NO_INTERSECTION}else return LineIntersector$$1.prototype.computeIntersection.apply(this,arguments)},RobustLineIntersector2.prototype.normalizeToMinimum=function(n1,n2,n3,n4,normPt){normPt.x=this.smallestInAbsValue(n1.x,n2.x,n3.x,n4.x),normPt.y=this.smallestInAbsValue(n1.y,n2.y,n3.y,n4.y),n1.x-=normPt.x,n1.y-=normPt.y,n2.x-=normPt.x,n2.y-=normPt.y,n3.x-=normPt.x,n3.y-=normPt.y,n4.x-=normPt.x,n4.y-=normPt.y},RobustLineIntersector2.prototype.safeHCoordinateIntersection=function(p1,p2,q1,q2){var intPt=null;try{intPt=HCoordinate.intersection(p1,p2,q1,q2)}catch(e){if(e instanceof NotRepresentableException)intPt=RobustLineIntersector2.nearestEndpoint(p1,p2,q1,q2);else throw e}finally{}return intPt},RobustLineIntersector2.prototype.intersection=function(p1,p2,q1,q2){var intPt=this.intersectionWithNormalization(p1,p2,q1,q2);return this.isInSegmentEnvelopes(intPt)||(intPt=new Coordinate(RobustLineIntersector2.nearestEndpoint(p1,p2,q1,q2))),this._precisionModel!==null&&this._precisionModel.makePrecise(intPt),intPt},RobustLineIntersector2.prototype.smallestInAbsValue=function(x12,x2,x3,x4){var x5=x12,xabs=Math.abs(x5);return Math.abs(x2)<xabs&&(x5=x2,xabs=Math.abs(x2)),Math.abs(x3)<xabs&&(x5=x3,xabs=Math.abs(x3)),Math.abs(x4)<xabs&&(x5=x4),x5},RobustLineIntersector2.prototype.checkDD=function(p1,p2,q1,q2,intPt){var intPtDD=CGAlgorithmsDD.intersection(p1,p2,q1,q2),isIn=this.isInSegmentEnvelopes(intPtDD);System.out.println("DD in env = "+isIn+"  --------------------- "+intPtDD),intPt.distance(intPtDD)>1e-4&&System.out.println("Distance = "+intPt.distance(intPtDD))},RobustLineIntersector2.prototype.intersectionWithNormalization=function(p1,p2,q1,q2){var n1=new Coordinate(p1),n2=new Coordinate(p2),n3=new Coordinate(q1),n4=new Coordinate(q2),normPt=new Coordinate;this.normalizeToEnvCentre(n1,n2,n3,n4,normPt);var intPt=this.safeHCoordinateIntersection(n1,n2,n3,n4);return intPt.x+=normPt.x,intPt.y+=normPt.y,intPt},RobustLineIntersector2.prototype.computeCollinearIntersection=function(p1,p2,q1,q2){var p1q1p2=Envelope.intersects(p1,p2,q1),p1q2p2=Envelope.intersects(p1,p2,q2),q1p1q2=Envelope.intersects(q1,q2,p1),q1p2q2=Envelope.intersects(q1,q2,p2);return p1q1p2&&p1q2p2?(this._intPt[0]=q1,this._intPt[1]=q2,LineIntersector$$1.COLLINEAR_INTERSECTION):q1p1q2&&q1p2q2?(this._intPt[0]=p1,this._intPt[1]=p2,LineIntersector$$1.COLLINEAR_INTERSECTION):p1q1p2&&q1p1q2?(this._intPt[0]=q1,this._intPt[1]=p1,q1.equals(p1)&&!p1q2p2&&!q1p2q2?LineIntersector$$1.POINT_INTERSECTION:LineIntersector$$1.COLLINEAR_INTERSECTION):p1q1p2&&q1p2q2?(this._intPt[0]=q1,this._intPt[1]=p2,q1.equals(p2)&&!p1q2p2&&!q1p1q2?LineIntersector$$1.POINT_INTERSECTION:LineIntersector$$1.COLLINEAR_INTERSECTION):p1q2p2&&q1p1q2?(this._intPt[0]=q2,this._intPt[1]=p1,q2.equals(p1)&&!p1q1p2&&!q1p2q2?LineIntersector$$1.POINT_INTERSECTION:LineIntersector$$1.COLLINEAR_INTERSECTION):p1q2p2&&q1p2q2?(this._intPt[0]=q2,this._intPt[1]=p2,q2.equals(p2)&&!p1q1p2&&!q1p1q2?LineIntersector$$1.POINT_INTERSECTION:LineIntersector$$1.COLLINEAR_INTERSECTION):LineIntersector$$1.NO_INTERSECTION},RobustLineIntersector2.prototype.normalizeToEnvCentre=function(n00,n01,n10,n11,normPt){var minX0=n00.x<n01.x?n00.x:n01.x,minY0=n00.y<n01.y?n00.y:n01.y,maxX0=n00.x>n01.x?n00.x:n01.x,maxY0=n00.y>n01.y?n00.y:n01.y,minX1=n10.x<n11.x?n10.x:n11.x,minY1=n10.y<n11.y?n10.y:n11.y,maxX1=n10.x>n11.x?n10.x:n11.x,maxY1=n10.y>n11.y?n10.y:n11.y,intMinX=minX0>minX1?minX0:minX1,intMaxX=maxX0<maxX1?maxX0:maxX1,intMinY=minY0>minY1?minY0:minY1,intMaxY=maxY0<maxY1?maxY0:maxY1,intMidX=(intMinX+intMaxX)/2,intMidY=(intMinY+intMaxY)/2;normPt.x=intMidX,normPt.y=intMidY,n00.x-=normPt.x,n00.y-=normPt.y,n01.x-=normPt.x,n01.y-=normPt.y,n10.x-=normPt.x,n10.y-=normPt.y,n11.x-=normPt.x,n11.y-=normPt.y},RobustLineIntersector2.prototype.computeIntersect=function(p1,p2,q1,q2){if(this._isProper=!1,!Envelope.intersects(p1,p2,q1,q2))return LineIntersector$$1.NO_INTERSECTION;var Pq1=CGAlgorithms.orientationIndex(p1,p2,q1),Pq2=CGAlgorithms.orientationIndex(p1,p2,q2);if(Pq1>0&&Pq2>0||Pq1<0&&Pq2<0)return LineIntersector$$1.NO_INTERSECTION;var Qp1=CGAlgorithms.orientationIndex(q1,q2,p1),Qp2=CGAlgorithms.orientationIndex(q1,q2,p2);if(Qp1>0&&Qp2>0||Qp1<0&&Qp2<0)return LineIntersector$$1.NO_INTERSECTION;var collinear=Pq1===0&&Pq2===0&&Qp1===0&&Qp2===0;return collinear?this.computeCollinearIntersection(p1,p2,q1,q2):(Pq1===0||Pq2===0||Qp1===0||Qp2===0?(this._isProper=!1,p1.equals2D(q1)||p1.equals2D(q2)?this._intPt[0]=p1:p2.equals2D(q1)||p2.equals2D(q2)?this._intPt[0]=p2:Pq1===0?this._intPt[0]=new Coordinate(q1):Pq2===0?this._intPt[0]=new Coordinate(q2):Qp1===0?this._intPt[0]=new Coordinate(p1):Qp2===0&&(this._intPt[0]=new Coordinate(p2))):(this._isProper=!0,this._intPt[0]=this.intersection(p1,p2,q1,q2)),LineIntersector$$1.POINT_INTERSECTION)},RobustLineIntersector2.prototype.interfaces_=function(){return[]},RobustLineIntersector2.prototype.getClass=function(){return RobustLineIntersector2},RobustLineIntersector2.nearestEndpoint=function(p1,p2,q1,q2){var nearestPt=p1,minDist=CGAlgorithms.distancePointLine(p1,q1,q2),dist2=CGAlgorithms.distancePointLine(p2,q1,q2);return dist2<minDist&&(minDist=dist2,nearestPt=p2),dist2=CGAlgorithms.distancePointLine(q1,p1,p2),dist2<minDist&&(minDist=dist2,nearestPt=q1),dist2=CGAlgorithms.distancePointLine(q2,p1,p2),dist2<minDist&&(minDist=dist2,nearestPt=q2),nearestPt},RobustLineIntersector2}(LineIntersector),RobustDeterminant=function(){};RobustDeterminant.prototype.interfaces_=function(){return[]};RobustDeterminant.prototype.getClass=function(){return RobustDeterminant};RobustDeterminant.orientationIndex=function(p1,p2,q){var dx1=p2.x-p1.x,dy1=p2.y-p1.y,dx2=q.x-p2.x,dy2=q.y-p2.y;return RobustDeterminant.signOfDet2x2(dx1,dy1,dx2,dy2)};RobustDeterminant.signOfDet2x2=function(x12,y12,x2,y2){var sign3=null,swap3=null,k=null;if(sign3=1,x12===0||y2===0)return y12===0||x2===0?0:y12>0?x2>0?-sign3:sign3:x2>0?sign3:-sign3;if(y12===0||x2===0)return y2>0?x12>0?sign3:-sign3:x12>0?-sign3:sign3;if(y12>0?y2>0?y12<=y2||(sign3=-sign3,swap3=x12,x12=x2,x2=swap3,swap3=y12,y12=y2,y2=swap3):y12<=-y2?(sign3=-sign3,x2=-x2,y2=-y2):(swap3=x12,x12=-x2,x2=swap3,swap3=y12,y12=-y2,y2=swap3):y2>0?-y12<=y2?(sign3=-sign3,x12=-x12,y12=-y12):(swap3=-x12,x12=x2,x2=swap3,swap3=-y12,y12=y2,y2=swap3):y12>=y2?(x12=-x12,y12=-y12,x2=-x2,y2=-y2):(sign3=-sign3,swap3=-x12,x12=-x2,x2=swap3,swap3=-y12,y12=-y2,y2=swap3),x12>0)if(x2>0){if(!(x12<=x2))return sign3}else return sign3;else{if(x2>0)return-sign3;if(x12>=x2)sign3=-sign3,x12=-x12,x2=-x2;else return-sign3}for(;;){if(k=Math.floor(x2/x12),x2=x2-k*x12,y2=y2-k*y12,y2<0)return-sign3;if(y2>y12)return sign3;if(x12>x2+x2){if(y12<y2+y2)return sign3}else{if(y12>y2+y2)return-sign3;x2=x12-x2,y2=y12-y2,sign3=-sign3}if(y2===0)return x2===0?0:-sign3;if(x2===0||(k=Math.floor(x12/x2),x12=x12-k*x2,y12=y12-k*y2,y12<0))return sign3;if(y12>y2)return-sign3;if(x2>x12+x12){if(y2<y12+y12)return-sign3}else{if(y2>y12+y12)return sign3;x12=x2-x12,y12=y2-y12,sign3=-sign3}if(y12===0)return x12===0?0:sign3;if(x12===0)return-sign3}};var RayCrossingCounter=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var p=arguments[0];this._p=p};RayCrossingCounter.prototype.countSegment=function(p1,p2){if(p1.x<this._p.x&&p2.x<this._p.x)return null;if(this._p.x===p2.x&&this._p.y===p2.y)return this._isPointOnSegment=!0,null;if(p1.y===this._p.y&&p2.y===this._p.y){var minx=p1.x,maxx=p2.x;return minx>maxx&&(minx=p2.x,maxx=p1.x),this._p.x>=minx&&this._p.x<=maxx&&(this._isPointOnSegment=!0),null}if(p1.y>this._p.y&&p2.y<=this._p.y||p2.y>this._p.y&&p1.y<=this._p.y){var x12=p1.x-this._p.x,y12=p1.y-this._p.y,x2=p2.x-this._p.x,y2=p2.y-this._p.y,xIntSign=RobustDeterminant.signOfDet2x2(x12,y12,x2,y2);if(xIntSign===0)return this._isPointOnSegment=!0,null;y2<y12&&(xIntSign=-xIntSign),xIntSign>0&&this._crossingCount++}};RayCrossingCounter.prototype.isPointInPolygon=function(){return this.getLocation()!==Location.EXTERIOR};RayCrossingCounter.prototype.getLocation=function(){return this._isPointOnSegment?Location.BOUNDARY:this._crossingCount%2===1?Location.INTERIOR:Location.EXTERIOR};RayCrossingCounter.prototype.isOnSegment=function(){return this._isPointOnSegment};RayCrossingCounter.prototype.interfaces_=function(){return[]};RayCrossingCounter.prototype.getClass=function(){return RayCrossingCounter};RayCrossingCounter.locatePointInRing=function(){if(arguments[0]instanceof Coordinate&&hasInterface(arguments[1],CoordinateSequence)){for(var p=arguments[0],ring=arguments[1],counter=new RayCrossingCounter(p),p1=new Coordinate,p2=new Coordinate,i=1;i<ring.size();i++)if(ring.getCoordinate(i,p1),ring.getCoordinate(i-1,p2),counter.countSegment(p1,p2),counter.isOnSegment())return counter.getLocation();return counter.getLocation()}else if(arguments[0]instanceof Coordinate&&arguments[1]instanceof Array){for(var p$1=arguments[0],ring$1=arguments[1],counter$1=new RayCrossingCounter(p$1),i$1=1;i$1<ring$1.length;i$1++){var p1$1=ring$1[i$1],p2$1=ring$1[i$1-1];if(counter$1.countSegment(p1$1,p2$1),counter$1.isOnSegment())return counter$1.getLocation()}return counter$1.getLocation()}};var CGAlgorithms=function(){},staticAccessors$3={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};CGAlgorithms.prototype.interfaces_=function(){return[]};CGAlgorithms.prototype.getClass=function(){return CGAlgorithms};CGAlgorithms.orientationIndex=function(p1,p2,q){return CGAlgorithmsDD.orientationIndex(p1,p2,q)};CGAlgorithms.signedArea=function(){if(arguments[0]instanceof Array){var ring=arguments[0];if(ring.length<3)return 0;for(var sum=0,x0=ring[0].x,i=1;i<ring.length-1;i++){var x2=ring[i].x-x0,y12=ring[i+1].y,y2=ring[i-1].y;sum+=x2*(y2-y12)}return sum/2}else if(hasInterface(arguments[0],CoordinateSequence)){var ring$1=arguments[0],n=ring$1.size();if(n<3)return 0;var p0=new Coordinate,p1=new Coordinate,p2=new Coordinate;ring$1.getCoordinate(0,p1),ring$1.getCoordinate(1,p2);var x0$1=p1.x;p2.x-=x0$1;for(var sum$12=0,i$1=1;i$1<n-1;i$1++)p0.y=p1.y,p1.x=p2.x,p1.y=p2.y,ring$1.getCoordinate(i$1+1,p2),p2.x-=x0$1,sum$12+=p1.x*(p0.y-p2.y);return sum$12/2}};CGAlgorithms.distanceLineLine=function(A,B,C,D){if(A.equals(B))return CGAlgorithms.distancePointLine(A,C,D);if(C.equals(D))return CGAlgorithms.distancePointLine(D,A,B);var noIntersection=!1;if(!Envelope.intersects(A,B,C,D))noIntersection=!0;else{var denom=(B.x-A.x)*(D.y-C.y)-(B.y-A.y)*(D.x-C.x);if(denom===0)noIntersection=!0;else{var rNumb=(A.y-C.y)*(D.x-C.x)-(A.x-C.x)*(D.y-C.y),sNum=(A.y-C.y)*(B.x-A.x)-(A.x-C.x)*(B.y-A.y),s=sNum/denom,r=rNumb/denom;(r<0||r>1||s<0||s>1)&&(noIntersection=!0)}}return noIntersection?MathUtil.min(CGAlgorithms.distancePointLine(A,C,D),CGAlgorithms.distancePointLine(B,C,D),CGAlgorithms.distancePointLine(C,A,B),CGAlgorithms.distancePointLine(D,A,B)):0};CGAlgorithms.isPointInRing=function(p,ring){return CGAlgorithms.locatePointInRing(p,ring)!==Location.EXTERIOR};CGAlgorithms.computeLength=function(pts){var n=pts.size();if(n<=1)return 0;var len=0,p=new Coordinate;pts.getCoordinate(0,p);for(var x0=p.x,y0=p.y,i=1;i<n;i++){pts.getCoordinate(i,p);var x12=p.x,y12=p.y,dx=x12-x0,dy=y12-y0;len+=Math.sqrt(dx*dx+dy*dy),x0=x12,y0=y12}return len};CGAlgorithms.isCCW=function(ring){var nPts=ring.length-1;if(nPts<3)throw new IllegalArgumentException("Ring has fewer than 4 points, so orientation cannot be determined");for(var hiPt=ring[0],hiIndex=0,i=1;i<=nPts;i++){var p=ring[i];p.y>hiPt.y&&(hiPt=p,hiIndex=i)}var iPrev=hiIndex;do iPrev=iPrev-1,iPrev<0&&(iPrev=nPts);while(ring[iPrev].equals2D(hiPt)&&iPrev!==hiIndex);var iNext=hiIndex;do iNext=(iNext+1)%nPts;while(ring[iNext].equals2D(hiPt)&&iNext!==hiIndex);var prev=ring[iPrev],next3=ring[iNext];if(prev.equals2D(hiPt)||next3.equals2D(hiPt)||prev.equals2D(next3))return!1;var disc=CGAlgorithms.computeOrientation(prev,hiPt,next3),isCCW2=!1;return disc===0?isCCW2=prev.x>next3.x:isCCW2=disc>0,isCCW2};CGAlgorithms.locatePointInRing=function(p,ring){return RayCrossingCounter.locatePointInRing(p,ring)};CGAlgorithms.distancePointLinePerpendicular=function(p,A,B){var len2=(B.x-A.x)*(B.x-A.x)+(B.y-A.y)*(B.y-A.y),s=((A.y-p.y)*(B.x-A.x)-(A.x-p.x)*(B.y-A.y))/len2;return Math.abs(s)*Math.sqrt(len2)};CGAlgorithms.computeOrientation=function(p1,p2,q){return CGAlgorithms.orientationIndex(p1,p2,q)};CGAlgorithms.distancePointLine=function(){if(arguments.length===2){var p=arguments[0],line=arguments[1];if(line.length===0)throw new IllegalArgumentException("Line array must contain at least one vertex");for(var minDistance=p.distance(line[0]),i=0;i<line.length-1;i++){var dist2=CGAlgorithms.distancePointLine(p,line[i],line[i+1]);dist2<minDistance&&(minDistance=dist2)}return minDistance}else if(arguments.length===3){var p$1=arguments[0],A=arguments[1],B=arguments[2];if(A.x===B.x&&A.y===B.y)return p$1.distance(A);var len2=(B.x-A.x)*(B.x-A.x)+(B.y-A.y)*(B.y-A.y),r=((p$1.x-A.x)*(B.x-A.x)+(p$1.y-A.y)*(B.y-A.y))/len2;if(r<=0)return p$1.distance(A);if(r>=1)return p$1.distance(B);var s=((A.y-p$1.y)*(B.x-A.x)-(A.x-p$1.x)*(B.y-A.y))/len2;return Math.abs(s)*Math.sqrt(len2)}};CGAlgorithms.isOnLine=function(p,pt){for(var lineIntersector=new RobustLineIntersector,i=1;i<pt.length;i++){var p0=pt[i-1],p1=pt[i];if(lineIntersector.computeIntersection(p,p0,p1),lineIntersector.hasIntersection())return!0}return!1};staticAccessors$3.CLOCKWISE.get=function(){return-1};staticAccessors$3.RIGHT.get=function(){return CGAlgorithms.CLOCKWISE};staticAccessors$3.COUNTERCLOCKWISE.get=function(){return 1};staticAccessors$3.LEFT.get=function(){return CGAlgorithms.COUNTERCLOCKWISE};staticAccessors$3.COLLINEAR.get=function(){return 0};staticAccessors$3.STRAIGHT.get=function(){return CGAlgorithms.COLLINEAR};Object.defineProperties(CGAlgorithms,staticAccessors$3);var GeometryComponentFilter=function(){};GeometryComponentFilter.prototype.filter=function(geom){};GeometryComponentFilter.prototype.interfaces_=function(){return[]};GeometryComponentFilter.prototype.getClass=function(){return GeometryComponentFilter};var Geometry=function(){var factory=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=factory,this._SRID=factory.getSRID()},staticAccessors$11={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Geometry.prototype.isGeometryCollection=function(){return this.getSortIndex()===Geometry.SORTINDEX_GEOMETRYCOLLECTION};Geometry.prototype.getFactory=function(){return this._factory};Geometry.prototype.getGeometryN=function(n){return this};Geometry.prototype.getArea=function(){return 0};Geometry.prototype.isRectangle=function(){return!1};Geometry.prototype.equals=function(){if(arguments[0]instanceof Geometry){var g$1=arguments[0];return g$1===null?!1:this.equalsTopo(g$1)}else if(arguments[0]instanceof Object){var o=arguments[0];if(!(o instanceof Geometry))return!1;var g=o;return this.equalsExact(g)}};Geometry.prototype.equalsExact=function(other){return this===other||this.equalsExact(other,0)};Geometry.prototype.geometryChanged=function(){this.apply(Geometry.geometryChangedFilter)};Geometry.prototype.geometryChangedAction=function(){this._envelope=null};Geometry.prototype.equalsNorm=function(g){return g===null?!1:this.norm().equalsExact(g.norm())};Geometry.prototype.getLength=function(){return 0};Geometry.prototype.getNumGeometries=function(){return 1};Geometry.prototype.compareTo=function(){if(arguments.length===1){var o=arguments[0],other=o;return this.getSortIndex()!==other.getSortIndex()?this.getSortIndex()-other.getSortIndex():this.isEmpty()&&other.isEmpty()?0:this.isEmpty()?-1:other.isEmpty()?1:this.compareToSameClass(o)}else if(arguments.length===2){var other$1=arguments[0],comp=arguments[1];return this.getSortIndex()!==other$1.getSortIndex()?this.getSortIndex()-other$1.getSortIndex():this.isEmpty()&&other$1.isEmpty()?0:this.isEmpty()?-1:other$1.isEmpty()?1:this.compareToSameClass(other$1,comp)}};Geometry.prototype.getUserData=function(){return this._userData};Geometry.prototype.getSRID=function(){return this._SRID};Geometry.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};Geometry.prototype.checkNotGeometryCollection=function(g){if(g.getSortIndex()===Geometry.SORTINDEX_GEOMETRYCOLLECTION)throw new IllegalArgumentException("This method does not support GeometryCollection arguments")};Geometry.prototype.equal=function(a,b,tolerance){return tolerance===0?a.equals(b):a.distance(b)<=tolerance};Geometry.prototype.norm=function(){var copy7=this.copy();return copy7.normalize(),copy7};Geometry.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};Geometry.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Envelope(this._envelope)};Geometry.prototype.setSRID=function(SRID){this._SRID=SRID};Geometry.prototype.setUserData=function(userData){this._userData=userData};Geometry.prototype.compare=function(a,b){for(var i=a.iterator(),j=b.iterator();i.hasNext()&&j.hasNext();){var aElement=i.next(),bElement=j.next(),comparison=aElement.compareTo(bElement);if(comparison!==0)return comparison}return i.hasNext()?1:j.hasNext()?-1:0};Geometry.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};Geometry.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Geometry.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Geometry.SORTINDEX_MULTIPOINT||this.getSortIndex()===Geometry.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Geometry.SORTINDEX_MULTIPOLYGON};Geometry.prototype.interfaces_=function(){return[Clonable,Comparable,Serializable]};Geometry.prototype.getClass=function(){return Geometry};Geometry.hasNonEmptyElements=function(geometries){for(var i=0;i<geometries.length;i++)if(!geometries[i].isEmpty())return!0;return!1};Geometry.hasNullElements=function(array){for(var i=0;i<array.length;i++)if(array[i]===null)return!0;return!1};staticAccessors$11.serialVersionUID.get=function(){return 8763622679187377e3};staticAccessors$11.SORTINDEX_POINT.get=function(){return 0};staticAccessors$11.SORTINDEX_MULTIPOINT.get=function(){return 1};staticAccessors$11.SORTINDEX_LINESTRING.get=function(){return 2};staticAccessors$11.SORTINDEX_LINEARRING.get=function(){return 3};staticAccessors$11.SORTINDEX_MULTILINESTRING.get=function(){return 4};staticAccessors$11.SORTINDEX_POLYGON.get=function(){return 5};staticAccessors$11.SORTINDEX_MULTIPOLYGON.get=function(){return 6};staticAccessors$11.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};staticAccessors$11.geometryChangedFilter.get=function(){return geometryChangedFilter};Object.defineProperties(Geometry,staticAccessors$11);var geometryChangedFilter=function(){};geometryChangedFilter.interfaces_=function(){return[GeometryComponentFilter]};geometryChangedFilter.filter=function(geom){geom.geometryChangedAction()};var CoordinateFilter=function(){};CoordinateFilter.prototype.filter=function(coord){};CoordinateFilter.prototype.interfaces_=function(){return[]};CoordinateFilter.prototype.getClass=function(){return CoordinateFilter};var BoundaryNodeRule=function(){},staticAccessors$12={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};BoundaryNodeRule.prototype.isInBoundary=function(boundaryCount){};BoundaryNodeRule.prototype.interfaces_=function(){return[]};BoundaryNodeRule.prototype.getClass=function(){return BoundaryNodeRule};staticAccessors$12.Mod2BoundaryNodeRule.get=function(){return Mod2BoundaryNodeRule};staticAccessors$12.EndPointBoundaryNodeRule.get=function(){return EndPointBoundaryNodeRule};staticAccessors$12.MultiValentEndPointBoundaryNodeRule.get=function(){return MultiValentEndPointBoundaryNodeRule};staticAccessors$12.MonoValentEndPointBoundaryNodeRule.get=function(){return MonoValentEndPointBoundaryNodeRule};staticAccessors$12.MOD2_BOUNDARY_RULE.get=function(){return new Mod2BoundaryNodeRule};staticAccessors$12.ENDPOINT_BOUNDARY_RULE.get=function(){return new EndPointBoundaryNodeRule};staticAccessors$12.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new MultiValentEndPointBoundaryNodeRule};staticAccessors$12.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new MonoValentEndPointBoundaryNodeRule};staticAccessors$12.OGC_SFS_BOUNDARY_RULE.get=function(){return BoundaryNodeRule.MOD2_BOUNDARY_RULE};Object.defineProperties(BoundaryNodeRule,staticAccessors$12);var Mod2BoundaryNodeRule=function(){};Mod2BoundaryNodeRule.prototype.isInBoundary=function(boundaryCount){return boundaryCount%2===1};Mod2BoundaryNodeRule.prototype.interfaces_=function(){return[BoundaryNodeRule]};Mod2BoundaryNodeRule.prototype.getClass=function(){return Mod2BoundaryNodeRule};var EndPointBoundaryNodeRule=function(){};EndPointBoundaryNodeRule.prototype.isInBoundary=function(boundaryCount){return boundaryCount>0};EndPointBoundaryNodeRule.prototype.interfaces_=function(){return[BoundaryNodeRule]};EndPointBoundaryNodeRule.prototype.getClass=function(){return EndPointBoundaryNodeRule};var MultiValentEndPointBoundaryNodeRule=function(){};MultiValentEndPointBoundaryNodeRule.prototype.isInBoundary=function(boundaryCount){return boundaryCount>1};MultiValentEndPointBoundaryNodeRule.prototype.interfaces_=function(){return[BoundaryNodeRule]};MultiValentEndPointBoundaryNodeRule.prototype.getClass=function(){return MultiValentEndPointBoundaryNodeRule};var MonoValentEndPointBoundaryNodeRule=function(){};MonoValentEndPointBoundaryNodeRule.prototype.isInBoundary=function(boundaryCount){return boundaryCount===1};MonoValentEndPointBoundaryNodeRule.prototype.interfaces_=function(){return[BoundaryNodeRule]};MonoValentEndPointBoundaryNodeRule.prototype.getClass=function(){return MonoValentEndPointBoundaryNodeRule};var Collection=function(){};Collection.prototype.add=function(){};Collection.prototype.addAll=function(){};Collection.prototype.isEmpty=function(){};Collection.prototype.iterator=function(){};Collection.prototype.size=function(){};Collection.prototype.toArray=function(){};Collection.prototype.remove=function(){};var IndexOutOfBoundsException=function(Error2){function IndexOutOfBoundsException2(message){Error2.call(this),this.message=message||""}Error2&&(IndexOutOfBoundsException2.__proto__=Error2),IndexOutOfBoundsException2.prototype=Object.create(Error2&&Error2.prototype),IndexOutOfBoundsException2.prototype.constructor=IndexOutOfBoundsException2;var staticAccessors2={name:{configurable:!0}};return staticAccessors2.name.get=function(){return"IndexOutOfBoundsException"},Object.defineProperties(IndexOutOfBoundsException2,staticAccessors2),IndexOutOfBoundsException2}(Error),Iterator=function(){};Iterator.prototype.hasNext=function(){};Iterator.prototype.next=function(){};Iterator.prototype.remove=function(){};var List=function(Collection$$1){function List2(){Collection$$1.apply(this,arguments)}return Collection$$1&&(List2.__proto__=Collection$$1),List2.prototype=Object.create(Collection$$1&&Collection$$1.prototype),List2.prototype.constructor=List2,List2.prototype.get=function(){},List2.prototype.set=function(){},List2.prototype.isEmpty=function(){},List2}(Collection);function NoSuchElementException(message){this.message=message||""}NoSuchElementException.prototype=new Error;NoSuchElementException.prototype.name="NoSuchElementException";var ArrayList=function(List$$1){function ArrayList2(){List$$1.call(this),this.array_=[],arguments[0]instanceof Collection&&this.addAll(arguments[0])}return List$$1&&(ArrayList2.__proto__=List$$1),ArrayList2.prototype=Object.create(List$$1&&List$$1.prototype),ArrayList2.prototype.constructor=ArrayList2,ArrayList2.prototype.ensureCapacity=function(){},ArrayList2.prototype.interfaces_=function(){return[List$$1,Collection]},ArrayList2.prototype.add=function(e){return arguments.length===1?this.array_.push(e):this.array_.splice(arguments[0],arguments[1]),!0},ArrayList2.prototype.clear=function(){this.array_=[]},ArrayList2.prototype.addAll=function(c){for(var this$1=this,i=c.iterator();i.hasNext();)this$1.add(i.next());return!0},ArrayList2.prototype.set=function(index,element){var oldElement=this.array_[index];return this.array_[index]=element,oldElement},ArrayList2.prototype.iterator=function(){return new Iterator_(this)},ArrayList2.prototype.get=function(index){if(index<0||index>=this.size())throw new IndexOutOfBoundsException;return this.array_[index]},ArrayList2.prototype.isEmpty=function(){return this.array_.length===0},ArrayList2.prototype.size=function(){return this.array_.length},ArrayList2.prototype.toArray=function(){for(var this$1=this,array=[],i=0,len=this.array_.length;i<len;i++)array.push(this$1.array_[i]);return array},ArrayList2.prototype.remove=function(o){for(var this$1=this,found=!1,i=0,len=this.array_.length;i<len;i++)if(this$1.array_[i]===o){this$1.array_.splice(i,1),found=!0;break}return found},ArrayList2}(List),Iterator_=function(Iterator$$1){function Iterator_2(arrayList){Iterator$$1.call(this),this.arrayList_=arrayList,this.position_=0}return Iterator$$1&&(Iterator_2.__proto__=Iterator$$1),Iterator_2.prototype=Object.create(Iterator$$1&&Iterator$$1.prototype),Iterator_2.prototype.constructor=Iterator_2,Iterator_2.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new NoSuchElementException;return this.arrayList_.get(this.position_++)},Iterator_2.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},Iterator_2.prototype.set=function(element){return this.arrayList_.set(this.position_-1,element)},Iterator_2.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},Iterator_2}(Iterator),CoordinateList=function(ArrayList$$1){function CoordinateList2(){if(ArrayList$$1.call(this),arguments.length!==0){if(arguments.length===1){var coord=arguments[0];this.ensureCapacity(coord.length),this.add(coord,!0)}else if(arguments.length===2){var coord$1=arguments[0],allowRepeated=arguments[1];this.ensureCapacity(coord$1.length),this.add(coord$1,allowRepeated)}}}ArrayList$$1&&(CoordinateList2.__proto__=ArrayList$$1),CoordinateList2.prototype=Object.create(ArrayList$$1&&ArrayList$$1.prototype),CoordinateList2.prototype.constructor=CoordinateList2;var staticAccessors2={coordArrayType:{configurable:!0}};return staticAccessors2.coordArrayType.get=function(){return new Array(0).fill(null)},CoordinateList2.prototype.getCoordinate=function(i){return this.get(i)},CoordinateList2.prototype.addAll=function(){var this$1=this;if(arguments.length===2){for(var coll=arguments[0],allowRepeated=arguments[1],isChanged=!1,i=coll.iterator();i.hasNext();)this$1.add(i.next(),allowRepeated),isChanged=!0;return isChanged}else return ArrayList$$1.prototype.addAll.apply(this,arguments)},CoordinateList2.prototype.clone=function(){for(var this$1=this,clone8=ArrayList$$1.prototype.clone.call(this),i=0;i<this.size();i++)clone8.add(i,this$1.get(i).copy());return clone8},CoordinateList2.prototype.toCoordinateArray=function(){return this.toArray(CoordinateList2.coordArrayType)},CoordinateList2.prototype.add=function(){var this$1=this;if(arguments.length===1){var coord=arguments[0];ArrayList$$1.prototype.add.call(this,coord)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var coord$1=arguments[0],allowRepeated=arguments[1];return this.add(coord$1,allowRepeated,!0),!0}else if(arguments[0]instanceof Coordinate&&typeof arguments[1]=="boolean"){var coord$2=arguments[0],allowRepeated$1=arguments[1];if(!allowRepeated$1&&this.size()>=1){var last=this.get(this.size()-1);if(last.equals2D(coord$2))return null}ArrayList$$1.prototype.add.call(this,coord$2)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var obj=arguments[0],allowRepeated$2=arguments[1];return this.add(obj,allowRepeated$2),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var coord$3=arguments[0],allowRepeated$3=arguments[1],direction=arguments[2];if(direction)for(var i$1=0;i$1<coord$3.length;i$1++)this$1.add(coord$3[i$1],allowRepeated$3);else for(var i$2=coord$3.length-1;i$2>=0;i$2--)this$1.add(coord$3[i$2],allowRepeated$3);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Coordinate){var i$3=arguments[0],coord$4=arguments[1],allowRepeated$4=arguments[2];if(!allowRepeated$4){var size11=this.size();if(size11>0){if(i$3>0){var prev=this.get(i$3-1);if(prev.equals2D(coord$4))return null}if(i$3<size11){var next3=this.get(i$3);if(next3.equals2D(coord$4))return null}}}ArrayList$$1.prototype.add.call(this,i$3,coord$4)}}else if(arguments.length===4){var coord$5=arguments[0],allowRepeated$5=arguments[1],start2=arguments[2],end=arguments[3],inc=1;start2>end&&(inc=-1);for(var i=start2;i!==end;i+=inc)this$1.add(coord$5[i],allowRepeated$5);return!0}},CoordinateList2.prototype.closeRing=function(){this.size()>0&&this.add(new Coordinate(this.get(0)),!1)},CoordinateList2.prototype.interfaces_=function(){return[]},CoordinateList2.prototype.getClass=function(){return CoordinateList2},Object.defineProperties(CoordinateList2,staticAccessors2),CoordinateList2}(ArrayList),CoordinateArrays=function(){},staticAccessors$13={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};staticAccessors$13.ForwardComparator.get=function(){return ForwardComparator};staticAccessors$13.BidirectionalComparator.get=function(){return BidirectionalComparator};staticAccessors$13.coordArrayType.get=function(){return new Array(0).fill(null)};CoordinateArrays.prototype.interfaces_=function(){return[]};CoordinateArrays.prototype.getClass=function(){return CoordinateArrays};CoordinateArrays.isRing=function(pts){return!(pts.length<4||!pts[0].equals2D(pts[pts.length-1]))};CoordinateArrays.ptNotInList=function(testPts,pts){for(var i=0;i<testPts.length;i++){var testPt=testPts[i];if(CoordinateArrays.indexOf(testPt,pts)<0)return testPt}return null};CoordinateArrays.scroll=function(coordinates,firstCoordinate){var i=CoordinateArrays.indexOf(firstCoordinate,coordinates);if(i<0)return null;var newCoordinates=new Array(coordinates.length).fill(null);System.arraycopy(coordinates,i,newCoordinates,0,coordinates.length-i),System.arraycopy(coordinates,0,newCoordinates,coordinates.length-i,i),System.arraycopy(newCoordinates,0,coordinates,0,coordinates.length)};CoordinateArrays.equals=function(){if(arguments.length===2){var coord1=arguments[0],coord2=arguments[1];if(coord1===coord2)return!0;if(coord1===null||coord2===null||coord1.length!==coord2.length)return!1;for(var i=0;i<coord1.length;i++)if(!coord1[i].equals(coord2[i]))return!1;return!0}else if(arguments.length===3){var coord1$1=arguments[0],coord2$1=arguments[1],coordinateComparator=arguments[2];if(coord1$1===coord2$1)return!0;if(coord1$1===null||coord2$1===null||coord1$1.length!==coord2$1.length)return!1;for(var i$1=0;i$1<coord1$1.length;i$1++)if(coordinateComparator.compare(coord1$1[i$1],coord2$1[i$1])!==0)return!1;return!0}};CoordinateArrays.intersection=function(coordinates,env){for(var coordList=new CoordinateList,i=0;i<coordinates.length;i++)env.intersects(coordinates[i])&&coordList.add(coordinates[i],!0);return coordList.toCoordinateArray()};CoordinateArrays.hasRepeatedPoints=function(coord){for(var i=1;i<coord.length;i++)if(coord[i-1].equals(coord[i]))return!0;return!1};CoordinateArrays.removeRepeatedPoints=function(coord){if(!CoordinateArrays.hasRepeatedPoints(coord))return coord;var coordList=new CoordinateList(coord,!1);return coordList.toCoordinateArray()};CoordinateArrays.reverse=function(coord){for(var last=coord.length-1,mid=Math.trunc(last/2),i=0;i<=mid;i++){var tmp=coord[i];coord[i]=coord[last-i],coord[last-i]=tmp}};CoordinateArrays.removeNull=function(coord){for(var nonNull=0,i=0;i<coord.length;i++)coord[i]!==null&&nonNull++;var newCoord=new Array(nonNull).fill(null);if(nonNull===0)return newCoord;for(var j=0,i$1=0;i$1<coord.length;i$1++)coord[i$1]!==null&&(newCoord[j++]=coord[i$1]);return newCoord};CoordinateArrays.copyDeep=function(){if(arguments.length===1){for(var coordinates=arguments[0],copy7=new Array(coordinates.length).fill(null),i=0;i<coordinates.length;i++)copy7[i]=new Coordinate(coordinates[i]);return copy7}else if(arguments.length===5)for(var src=arguments[0],srcStart=arguments[1],dest=arguments[2],destStart=arguments[3],length3=arguments[4],i$1=0;i$1<length3;i$1++)dest[destStart+i$1]=new Coordinate(src[srcStart+i$1])};CoordinateArrays.isEqualReversed=function(pts1,pts2){for(var i=0;i<pts1.length;i++){var p1=pts1[i],p2=pts2[pts1.length-i-1];if(p1.compareTo(p2)!==0)return!1}return!0};CoordinateArrays.envelope=function(coordinates){for(var env=new Envelope,i=0;i<coordinates.length;i++)env.expandToInclude(coordinates[i]);return env};CoordinateArrays.toCoordinateArray=function(coordList){return coordList.toArray(CoordinateArrays.coordArrayType)};CoordinateArrays.atLeastNCoordinatesOrNothing=function(n,c){return c.length>=n?c:[]};CoordinateArrays.indexOf=function(coordinate2,coordinates){for(var i=0;i<coordinates.length;i++)if(coordinate2.equals(coordinates[i]))return i;return-1};CoordinateArrays.increasingDirection=function(pts){for(var i=0;i<Math.trunc(pts.length/2);i++){var j=pts.length-1-i,comp=pts[i].compareTo(pts[j]);if(comp!==0)return comp}return 1};CoordinateArrays.compare=function(pts1,pts2){for(var i=0;i<pts1.length&&i<pts2.length;){var compare10=pts1[i].compareTo(pts2[i]);if(compare10!==0)return compare10;i++}return i<pts2.length?-1:i<pts1.length?1:0};CoordinateArrays.minCoordinate=function(coordinates){for(var minCoord=null,i=0;i<coordinates.length;i++)(minCoord===null||minCoord.compareTo(coordinates[i])>0)&&(minCoord=coordinates[i]);return minCoord};CoordinateArrays.extract=function(pts,start2,end){start2=MathUtil.clamp(start2,0,pts.length),end=MathUtil.clamp(end,-1,pts.length);var npts=end-start2+1;end<0&&(npts=0),start2>=pts.length&&(npts=0),end<start2&&(npts=0);var extractPts=new Array(npts).fill(null);if(npts===0)return extractPts;for(var iPts=0,i=start2;i<=end;i++)extractPts[iPts++]=pts[i];return extractPts};Object.defineProperties(CoordinateArrays,staticAccessors$13);var ForwardComparator=function(){};ForwardComparator.prototype.compare=function(o1,o2){var pts1=o1,pts2=o2;return CoordinateArrays.compare(pts1,pts2)};ForwardComparator.prototype.interfaces_=function(){return[Comparator]};ForwardComparator.prototype.getClass=function(){return ForwardComparator};var BidirectionalComparator=function(){};BidirectionalComparator.prototype.compare=function(o1,o2){var pts1=o1,pts2=o2;if(pts1.length<pts2.length)return-1;if(pts1.length>pts2.length)return 1;if(pts1.length===0)return 0;var forwardComp=CoordinateArrays.compare(pts1,pts2),isEqualRev=CoordinateArrays.isEqualReversed(pts1,pts2);return isEqualRev?0:forwardComp};BidirectionalComparator.prototype.OLDcompare=function(o1,o2){var pts1=o1,pts2=o2;if(pts1.length<pts2.length)return-1;if(pts1.length>pts2.length)return 1;if(pts1.length===0)return 0;for(var dir1=CoordinateArrays.increasingDirection(pts1),dir2=CoordinateArrays.increasingDirection(pts2),i1=dir1>0?0:pts1.length-1,i2=dir2>0?0:pts1.length-1,i=0;i<pts1.length;i++){var comparePt=pts1[i1].compareTo(pts2[i2]);if(comparePt!==0)return comparePt;i1+=dir1,i2+=dir2}return 0};BidirectionalComparator.prototype.interfaces_=function(){return[Comparator]};BidirectionalComparator.prototype.getClass=function(){return BidirectionalComparator};var Map$1=function(){};Map$1.prototype.get=function(){};Map$1.prototype.put=function(){};Map$1.prototype.size=function(){};Map$1.prototype.values=function(){};Map$1.prototype.entrySet=function(){};var SortedMap=function(Map3){function SortedMap2(){Map3.apply(this,arguments)}return Map3&&(SortedMap2.__proto__=Map3),SortedMap2.prototype=Object.create(Map3&&Map3.prototype),SortedMap2.prototype.constructor=SortedMap2,SortedMap2}(Map$1);function OperationNotSupported(message){this.message=message||""}OperationNotSupported.prototype=new Error;OperationNotSupported.prototype.name="OperationNotSupported";function Set(){}Set.prototype=new Collection;Set.prototype.contains=function(){};var HashSet=function(Set$$1){function HashSet2(){Set$$1.call(this),this.array_=[],arguments[0]instanceof Collection&&this.addAll(arguments[0])}return Set$$1&&(HashSet2.__proto__=Set$$1),HashSet2.prototype=Object.create(Set$$1&&Set$$1.prototype),HashSet2.prototype.constructor=HashSet2,HashSet2.prototype.contains=function(o){for(var this$1=this,i=0,len=this.array_.length;i<len;i++){var e=this$1.array_[i];if(e===o)return!0}return!1},HashSet2.prototype.add=function(o){return this.contains(o)?!1:(this.array_.push(o),!0)},HashSet2.prototype.addAll=function(c){for(var this$1=this,i=c.iterator();i.hasNext();)this$1.add(i.next());return!0},HashSet2.prototype.remove=function(o){throw new Error},HashSet2.prototype.size=function(){return this.array_.length},HashSet2.prototype.isEmpty=function(){return this.array_.length===0},HashSet2.prototype.toArray=function(){for(var this$1=this,array=[],i=0,len=this.array_.length;i<len;i++)array.push(this$1.array_[i]);return array},HashSet2.prototype.iterator=function(){return new Iterator_$1(this)},HashSet2}(Set),Iterator_$1=function(Iterator$$1){function Iterator_2(hashSet){Iterator$$1.call(this),this.hashSet_=hashSet,this.position_=0}return Iterator$$1&&(Iterator_2.__proto__=Iterator$$1),Iterator_2.prototype=Object.create(Iterator$$1&&Iterator$$1.prototype),Iterator_2.prototype.constructor=Iterator_2,Iterator_2.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new NoSuchElementException;return this.hashSet_.array_[this.position_++]},Iterator_2.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},Iterator_2.prototype.remove=function(){throw new OperationNotSupported},Iterator_2}(Iterator),BLACK=0,RED=1;function colorOf(p){return p===null?BLACK:p.color}function parentOf(p){return p===null?null:p.parent}function setColor(p,c){p!==null&&(p.color=c)}function leftOf(p){return p===null?null:p.left}function rightOf(p){return p===null?null:p.right}function TreeMap(){this.root_=null,this.size_=0}TreeMap.prototype=new SortedMap;TreeMap.prototype.get=function(key){for(var p=this.root_;p!==null;){var cmp=key.compareTo(p.key);if(cmp<0)p=p.left;else if(cmp>0)p=p.right;else return p.value}return null};TreeMap.prototype.put=function(key,value){if(this.root_===null)return this.root_={key,value,left:null,right:null,parent:null,color:BLACK,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var t=this.root_,parent,cmp;do if(parent=t,cmp=key.compareTo(t.key),cmp<0)t=t.left;else if(cmp>0)t=t.right;else{var oldValue=t.value;return t.value=value,oldValue}while(t!==null);var e={key,left:null,right:null,value,parent,color:BLACK,getValue:function(){return this.value},getKey:function(){return this.key}};return cmp<0?parent.left=e:parent.right=e,this.fixAfterInsertion(e),this.size_++,null};TreeMap.prototype.fixAfterInsertion=function(x2){var this$1=this;for(x2.color=RED;x2!=null&&x2!==this.root_&&x2.parent.color===RED;)if(parentOf(x2)===leftOf(parentOf(parentOf(x2)))){var y2=rightOf(parentOf(parentOf(x2)));colorOf(y2)===RED?(setColor(parentOf(x2),BLACK),setColor(y2,BLACK),setColor(parentOf(parentOf(x2)),RED),x2=parentOf(parentOf(x2))):(x2===rightOf(parentOf(x2))&&(x2=parentOf(x2),this$1.rotateLeft(x2)),setColor(parentOf(x2),BLACK),setColor(parentOf(parentOf(x2)),RED),this$1.rotateRight(parentOf(parentOf(x2))))}else{var y$1=leftOf(parentOf(parentOf(x2)));colorOf(y$1)===RED?(setColor(parentOf(x2),BLACK),setColor(y$1,BLACK),setColor(parentOf(parentOf(x2)),RED),x2=parentOf(parentOf(x2))):(x2===leftOf(parentOf(x2))&&(x2=parentOf(x2),this$1.rotateRight(x2)),setColor(parentOf(x2),BLACK),setColor(parentOf(parentOf(x2)),RED),this$1.rotateLeft(parentOf(parentOf(x2))))}this.root_.color=BLACK};TreeMap.prototype.values=function(){var arrayList=new ArrayList,p=this.getFirstEntry();if(p!==null)for(arrayList.add(p.value);(p=TreeMap.successor(p))!==null;)arrayList.add(p.value);return arrayList};TreeMap.prototype.entrySet=function(){var hashSet=new HashSet,p=this.getFirstEntry();if(p!==null)for(hashSet.add(p);(p=TreeMap.successor(p))!==null;)hashSet.add(p);return hashSet};TreeMap.prototype.rotateLeft=function(p){if(p!=null){var r=p.right;p.right=r.left,r.left!=null&&(r.left.parent=p),r.parent=p.parent,p.parent===null?this.root_=r:p.parent.left===p?p.parent.left=r:p.parent.right=r,r.left=p,p.parent=r}};TreeMap.prototype.rotateRight=function(p){if(p!=null){var l=p.left;p.left=l.right,l.right!=null&&(l.right.parent=p),l.parent=p.parent,p.parent===null?this.root_=l:p.parent.right===p?p.parent.right=l:p.parent.left=l,l.right=p,p.parent=l}};TreeMap.prototype.getFirstEntry=function(){var p=this.root_;if(p!=null)for(;p.left!=null;)p=p.left;return p};TreeMap.successor=function(t){if(t===null)return null;if(t.right!==null){for(var p=t.right;p.left!==null;)p=p.left;return p}else{for(var p$1=t.parent,ch=t;p$1!==null&&ch===p$1.right;)ch=p$1,p$1=p$1.parent;return p$1}};TreeMap.prototype.size=function(){return this.size_};var Lineal=function(){};Lineal.prototype.interfaces_=function(){return[]};Lineal.prototype.getClass=function(){return Lineal};function SortedSet(){}SortedSet.prototype=new Set;function TreeSet(){this.array_=[],arguments[0]instanceof Collection&&this.addAll(arguments[0])}TreeSet.prototype=new SortedSet;TreeSet.prototype.contains=function(o){for(var this$1=this,i=0,len=this.array_.length;i<len;i++){var e=this$1.array_[i];if(e.compareTo(o)===0)return!0}return!1};TreeSet.prototype.add=function(o){var this$1=this;if(this.contains(o))return!1;for(var i=0,len=this.array_.length;i<len;i++){var e=this$1.array_[i];if(e.compareTo(o)===1)return this$1.array_.splice(i,0,o),!0}return this.array_.push(o),!0};TreeSet.prototype.addAll=function(c){for(var this$1=this,i=c.iterator();i.hasNext();)this$1.add(i.next());return!0};TreeSet.prototype.remove=function(e){throw new OperationNotSupported};TreeSet.prototype.size=function(){return this.array_.length};TreeSet.prototype.isEmpty=function(){return this.array_.length===0};TreeSet.prototype.toArray=function(){for(var this$1=this,array=[],i=0,len=this.array_.length;i<len;i++)array.push(this$1.array_[i]);return array};TreeSet.prototype.iterator=function(){return new Iterator_$2(this)};var Iterator_$2=function(treeSet){this.treeSet_=treeSet,this.position_=0};Iterator_$2.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new NoSuchElementException;return this.treeSet_.array_[this.position_++]};Iterator_$2.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};Iterator_$2.prototype.remove=function(){throw new OperationNotSupported};var Arrays=function(){};Arrays.sort=function(){var a=arguments[0],i,t,comparator,compare10;if(arguments.length===1)compare10=function(a2,b){return a2.compareTo(b)},a.sort(compare10);else if(arguments.length===2)comparator=arguments[1],compare10=function(a2,b){return comparator.compare(a2,b)},a.sort(compare10);else if(arguments.length===3){t=a.slice(arguments[1],arguments[2]),t.sort();var r=a.slice(0,arguments[1]).concat(t,a.slice(arguments[2],a.length));for(a.splice(0,a.length),i=0;i<r.length;i++)a.push(r[i])}else if(arguments.length===4)for(t=a.slice(arguments[1],arguments[2]),comparator=arguments[3],compare10=function(a2,b){return comparator.compare(a2,b)},t.sort(compare10),r=a.slice(0,arguments[1]).concat(t,a.slice(arguments[2],a.length)),a.splice(0,a.length),i=0;i<r.length;i++)a.push(r[i])};Arrays.asList=function(array){for(var arrayList=new ArrayList,i=0,len=array.length;i<len;i++)arrayList.add(array[i]);return arrayList};var Dimension=function(){},staticAccessors$14={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};staticAccessors$14.P.get=function(){return 0};staticAccessors$14.L.get=function(){return 1};staticAccessors$14.A.get=function(){return 2};staticAccessors$14.FALSE.get=function(){return-1};staticAccessors$14.TRUE.get=function(){return-2};staticAccessors$14.DONTCARE.get=function(){return-3};staticAccessors$14.SYM_FALSE.get=function(){return"F"};staticAccessors$14.SYM_TRUE.get=function(){return"T"};staticAccessors$14.SYM_DONTCARE.get=function(){return"*"};staticAccessors$14.SYM_P.get=function(){return"0"};staticAccessors$14.SYM_L.get=function(){return"1"};staticAccessors$14.SYM_A.get=function(){return"2"};Dimension.prototype.interfaces_=function(){return[]};Dimension.prototype.getClass=function(){return Dimension};Dimension.toDimensionSymbol=function(dimensionValue){switch(dimensionValue){case Dimension.FALSE:return Dimension.SYM_FALSE;case Dimension.TRUE:return Dimension.SYM_TRUE;case Dimension.DONTCARE:return Dimension.SYM_DONTCARE;case Dimension.P:return Dimension.SYM_P;case Dimension.L:return Dimension.SYM_L;case Dimension.A:return Dimension.SYM_A;default:}throw new IllegalArgumentException("Unknown dimension value: "+dimensionValue)};Dimension.toDimensionValue=function(dimensionSymbol){switch(Character.toUpperCase(dimensionSymbol)){case Dimension.SYM_FALSE:return Dimension.FALSE;case Dimension.SYM_TRUE:return Dimension.TRUE;case Dimension.SYM_DONTCARE:return Dimension.DONTCARE;case Dimension.SYM_P:return Dimension.P;case Dimension.SYM_L:return Dimension.L;case Dimension.SYM_A:return Dimension.A;default:}throw new IllegalArgumentException("Unknown dimension symbol: "+dimensionSymbol)};Object.defineProperties(Dimension,staticAccessors$14);var GeometryFilter=function(){};GeometryFilter.prototype.filter=function(geom){};GeometryFilter.prototype.interfaces_=function(){return[]};GeometryFilter.prototype.getClass=function(){return GeometryFilter};var CoordinateSequenceFilter=function(){};CoordinateSequenceFilter.prototype.filter=function(seq,i){};CoordinateSequenceFilter.prototype.isDone=function(){};CoordinateSequenceFilter.prototype.isGeometryChanged=function(){};CoordinateSequenceFilter.prototype.interfaces_=function(){return[]};CoordinateSequenceFilter.prototype.getClass=function(){return CoordinateSequenceFilter};var GeometryCollection=function(Geometry$$1){function GeometryCollection2(geometries,factory){if(Geometry$$1.call(this,factory),this._geometries=geometries||[],Geometry$$1.hasNullElements(this._geometries))throw new IllegalArgumentException("geometries must not contain null elements")}Geometry$$1&&(GeometryCollection2.__proto__=Geometry$$1),GeometryCollection2.prototype=Object.create(Geometry$$1&&Geometry$$1.prototype),GeometryCollection2.prototype.constructor=GeometryCollection2;var staticAccessors2={serialVersionUID:{configurable:!0}};return GeometryCollection2.prototype.computeEnvelopeInternal=function(){for(var this$1=this,envelope3=new Envelope,i=0;i<this._geometries.length;i++)envelope3.expandToInclude(this$1._geometries[i].getEnvelopeInternal());return envelope3},GeometryCollection2.prototype.getGeometryN=function(n){return this._geometries[n]},GeometryCollection2.prototype.getSortIndex=function(){return Geometry$$1.SORTINDEX_GEOMETRYCOLLECTION},GeometryCollection2.prototype.getCoordinates=function(){for(var this$1=this,coordinates=new Array(this.getNumPoints()).fill(null),k=-1,i=0;i<this._geometries.length;i++)for(var childCoordinates=this$1._geometries[i].getCoordinates(),j=0;j<childCoordinates.length;j++)k++,coordinates[k]=childCoordinates[j];return coordinates},GeometryCollection2.prototype.getArea=function(){for(var this$1=this,area5=0,i=0;i<this._geometries.length;i++)area5+=this$1._geometries[i].getArea();return area5},GeometryCollection2.prototype.equalsExact=function(){var this$1=this;if(arguments.length===2){var other=arguments[0],tolerance=arguments[1];if(!this.isEquivalentClass(other))return!1;var otherCollection=other;if(this._geometries.length!==otherCollection._geometries.length)return!1;for(var i=0;i<this._geometries.length;i++)if(!this$1._geometries[i].equalsExact(otherCollection._geometries[i],tolerance))return!1;return!0}else return Geometry$$1.prototype.equalsExact.apply(this,arguments)},GeometryCollection2.prototype.normalize=function(){for(var this$1=this,i=0;i<this._geometries.length;i++)this$1._geometries[i].normalize();Arrays.sort(this._geometries)},GeometryCollection2.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},GeometryCollection2.prototype.getBoundaryDimension=function(){for(var this$1=this,dimension=Dimension.FALSE,i=0;i<this._geometries.length;i++)dimension=Math.max(dimension,this$1._geometries[i].getBoundaryDimension());return dimension},GeometryCollection2.prototype.getDimension=function(){for(var this$1=this,dimension=Dimension.FALSE,i=0;i<this._geometries.length;i++)dimension=Math.max(dimension,this$1._geometries[i].getDimension());return dimension},GeometryCollection2.prototype.getLength=function(){for(var this$1=this,sum=0,i=0;i<this._geometries.length;i++)sum+=this$1._geometries[i].getLength();return sum},GeometryCollection2.prototype.getNumPoints=function(){for(var this$1=this,numPoints=0,i=0;i<this._geometries.length;i++)numPoints+=this$1._geometries[i].getNumPoints();return numPoints},GeometryCollection2.prototype.getNumGeometries=function(){return this._geometries.length},GeometryCollection2.prototype.reverse=function(){for(var this$1=this,n=this._geometries.length,revGeoms=new Array(n).fill(null),i=0;i<this._geometries.length;i++)revGeoms[i]=this$1._geometries[i].reverse();return this.getFactory().createGeometryCollection(revGeoms)},GeometryCollection2.prototype.compareToSameClass=function(){var this$1=this;if(arguments.length===1){var o=arguments[0],theseElements=new TreeSet(Arrays.asList(this._geometries)),otherElements=new TreeSet(Arrays.asList(o._geometries));return this.compare(theseElements,otherElements)}else if(arguments.length===2){for(var o$1=arguments[0],comp=arguments[1],gc=o$1,n1=this.getNumGeometries(),n2=gc.getNumGeometries(),i=0;i<n1&&i<n2;){var thisGeom=this$1.getGeometryN(i),otherGeom=gc.getGeometryN(i),holeComp=thisGeom.compareToSameClass(otherGeom,comp);if(holeComp!==0)return holeComp;i++}return i<n1?1:i<n2?-1:0}},GeometryCollection2.prototype.apply=function(){var this$1=this;if(hasInterface(arguments[0],CoordinateFilter))for(var filter17=arguments[0],i=0;i<this._geometries.length;i++)this$1._geometries[i].apply(filter17);else if(hasInterface(arguments[0],CoordinateSequenceFilter)){var filter$1=arguments[0];if(this._geometries.length===0)return null;for(var i$1=0;i$1<this._geometries.length&&(this$1._geometries[i$1].apply(filter$1),!filter$1.isDone());i$1++);filter$1.isGeometryChanged()&&this.geometryChanged()}else if(hasInterface(arguments[0],GeometryFilter)){var filter$2=arguments[0];filter$2.filter(this);for(var i$2=0;i$2<this._geometries.length;i$2++)this$1._geometries[i$2].apply(filter$2)}else if(hasInterface(arguments[0],GeometryComponentFilter)){var filter$3=arguments[0];filter$3.filter(this);for(var i$3=0;i$3<this._geometries.length;i$3++)this$1._geometries[i$3].apply(filter$3)}},GeometryCollection2.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Assert.shouldNeverReachHere(),null},GeometryCollection2.prototype.clone=function(){var this$1=this,gc=Geometry$$1.prototype.clone.call(this);gc._geometries=new Array(this._geometries.length).fill(null);for(var i=0;i<this._geometries.length;i++)gc._geometries[i]=this$1._geometries[i].clone();return gc},GeometryCollection2.prototype.getGeometryType=function(){return"GeometryCollection"},GeometryCollection2.prototype.copy=function(){for(var this$1=this,geometries=new Array(this._geometries.length).fill(null),i=0;i<geometries.length;i++)geometries[i]=this$1._geometries[i].copy();return new GeometryCollection2(geometries,this._factory)},GeometryCollection2.prototype.isEmpty=function(){for(var this$1=this,i=0;i<this._geometries.length;i++)if(!this$1._geometries[i].isEmpty())return!1;return!0},GeometryCollection2.prototype.interfaces_=function(){return[]},GeometryCollection2.prototype.getClass=function(){return GeometryCollection2},staticAccessors2.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(GeometryCollection2,staticAccessors2),GeometryCollection2}(Geometry),MultiLineString=function(GeometryCollection$$1){function MultiLineString2(){GeometryCollection$$1.apply(this,arguments)}GeometryCollection$$1&&(MultiLineString2.__proto__=GeometryCollection$$1),MultiLineString2.prototype=Object.create(GeometryCollection$$1&&GeometryCollection$$1.prototype),MultiLineString2.prototype.constructor=MultiLineString2;var staticAccessors2={serialVersionUID:{configurable:!0}};return MultiLineString2.prototype.getSortIndex=function(){return Geometry.SORTINDEX_MULTILINESTRING},MultiLineString2.prototype.equalsExact=function(){if(arguments.length===2){var other=arguments[0],tolerance=arguments[1];return this.isEquivalentClass(other)?GeometryCollection$$1.prototype.equalsExact.call(this,other,tolerance):!1}else return GeometryCollection$$1.prototype.equalsExact.apply(this,arguments)},MultiLineString2.prototype.getBoundaryDimension=function(){return this.isClosed()?Dimension.FALSE:0},MultiLineString2.prototype.isClosed=function(){var this$1=this;if(this.isEmpty())return!1;for(var i=0;i<this._geometries.length;i++)if(!this$1._geometries[i].isClosed())return!1;return!0},MultiLineString2.prototype.getDimension=function(){return 1},MultiLineString2.prototype.reverse=function(){for(var this$1=this,nLines=this._geometries.length,revLines=new Array(nLines).fill(null),i=0;i<this._geometries.length;i++)revLines[nLines-1-i]=this$1._geometries[i].reverse();return this.getFactory().createMultiLineString(revLines)},MultiLineString2.prototype.getBoundary=function(){return new BoundaryOp(this).getBoundary()},MultiLineString2.prototype.getGeometryType=function(){return"MultiLineString"},MultiLineString2.prototype.copy=function(){for(var this$1=this,lineStrings2=new Array(this._geometries.length).fill(null),i=0;i<lineStrings2.length;i++)lineStrings2[i]=this$1._geometries[i].copy();return new MultiLineString2(lineStrings2,this._factory)},MultiLineString2.prototype.interfaces_=function(){return[Lineal]},MultiLineString2.prototype.getClass=function(){return MultiLineString2},staticAccessors2.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(MultiLineString2,staticAccessors2),MultiLineString2}(GeometryCollection),BoundaryOp=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var geom=arguments[0],bnRule=BoundaryNodeRule.MOD2_BOUNDARY_RULE;this._geom=geom,this._geomFact=geom.getFactory(),this._bnRule=bnRule}else if(arguments.length===2){var geom$1=arguments[0],bnRule$1=arguments[1];this._geom=geom$1,this._geomFact=geom$1.getFactory(),this._bnRule=bnRule$1}};BoundaryOp.prototype.boundaryMultiLineString=function(mLine){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var bdyPts=this.computeBoundaryCoordinates(mLine);return bdyPts.length===1?this._geomFact.createPoint(bdyPts[0]):this._geomFact.createMultiPointFromCoords(bdyPts)};BoundaryOp.prototype.getBoundary=function(){return this._geom instanceof LineString$1?this.boundaryLineString(this._geom):this._geom instanceof MultiLineString?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};BoundaryOp.prototype.boundaryLineString=function(line){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(line.isClosed()){var closedEndpointOnBoundary=this._bnRule.isInBoundary(2);return closedEndpointOnBoundary?line.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([line.getStartPoint(),line.getEndPoint()])};BoundaryOp.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};BoundaryOp.prototype.computeBoundaryCoordinates=function(mLine){var this$1=this,bdyPts=new ArrayList;this._endpointMap=new TreeMap;for(var i=0;i<mLine.getNumGeometries();i++){var line=mLine.getGeometryN(i);line.getNumPoints()!==0&&(this$1.addEndpoint(line.getCoordinateN(0)),this$1.addEndpoint(line.getCoordinateN(line.getNumPoints()-1)))}for(var it=this._endpointMap.entrySet().iterator();it.hasNext();){var entry=it.next(),counter=entry.getValue(),valence=counter.count;this$1._bnRule.isInBoundary(valence)&&bdyPts.add(entry.getKey())}return CoordinateArrays.toCoordinateArray(bdyPts)};BoundaryOp.prototype.addEndpoint=function(pt){var counter=this._endpointMap.get(pt);counter===null&&(counter=new Counter,this._endpointMap.put(pt,counter)),counter.count++};BoundaryOp.prototype.interfaces_=function(){return[]};BoundaryOp.prototype.getClass=function(){return BoundaryOp};BoundaryOp.getBoundary=function(){if(arguments.length===1){var g=arguments[0],bop=new BoundaryOp(g);return bop.getBoundary()}else if(arguments.length===2){var g$1=arguments[0],bnRule=arguments[1],bop$1=new BoundaryOp(g$1,bnRule);return bop$1.getBoundary()}};var Counter=function(){this.count=null};Counter.prototype.interfaces_=function(){return[]};Counter.prototype.getClass=function(){return Counter};function PrintStream(){}function StringReader(){}var DecimalFormat=function(){};function ByteArrayOutputStream(){}function IOException(){}function LineNumberReader(){}var StringUtil=function(){},staticAccessors$15={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};StringUtil.prototype.interfaces_=function(){return[]};StringUtil.prototype.getClass=function(){return StringUtil};StringUtil.chars=function(c,n){for(var ch=new Array(n).fill(null),i=0;i<n;i++)ch[i]=c;return String(ch)};StringUtil.getStackTrace=function(){if(arguments.length===1){var t=arguments[0],os=new ByteArrayOutputStream,ps=new PrintStream(os);return t.printStackTrace(ps),os.toString()}else if(arguments.length===2){for(var t$1=arguments[0],depth2=arguments[1],stackTrace="",stringReader=new StringReader(StringUtil.getStackTrace(t$1)),lineNumberReader=new LineNumberReader(stringReader),i=0;i<depth2;i++)try{stackTrace+=lineNumberReader.readLine()+StringUtil.NEWLINE}catch(e){if(e instanceof IOException)Assert.shouldNeverReachHere();else throw e}finally{}return stackTrace}};StringUtil.split=function(s,separator){for(var separatorlen=separator.length,tokenList=new ArrayList,tmpString=""+s,pos=tmpString.indexOf(separator);pos>=0;){var token=tmpString.substring(0,pos);tokenList.add(token),tmpString=tmpString.substring(pos+separatorlen),pos=tmpString.indexOf(separator)}tmpString.length>0&&tokenList.add(tmpString);for(var res=new Array(tokenList.size()).fill(null),i=0;i<res.length;i++)res[i]=tokenList.get(i);return res};StringUtil.toString=function(){if(arguments.length===1){var d=arguments[0];return StringUtil.SIMPLE_ORDINATE_FORMAT.format(d)}};StringUtil.spaces=function(n){return StringUtil.chars(" ",n)};staticAccessors$15.NEWLINE.get=function(){return System.getProperty("line.separator")};staticAccessors$15.SIMPLE_ORDINATE_FORMAT.get=function(){return new DecimalFormat("0.#")};Object.defineProperties(StringUtil,staticAccessors$15);var CoordinateSequences=function(){};CoordinateSequences.prototype.interfaces_=function(){return[]};CoordinateSequences.prototype.getClass=function(){return CoordinateSequences};CoordinateSequences.copyCoord=function(src,srcPos,dest,destPos){for(var minDim=Math.min(src.getDimension(),dest.getDimension()),dim=0;dim<minDim;dim++)dest.setOrdinate(destPos,dim,src.getOrdinate(srcPos,dim))};CoordinateSequences.isRing=function(seq){var n=seq.size();return n===0?!0:n<=3?!1:seq.getOrdinate(0,CoordinateSequence.X)===seq.getOrdinate(n-1,CoordinateSequence.X)&&seq.getOrdinate(0,CoordinateSequence.Y)===seq.getOrdinate(n-1,CoordinateSequence.Y)};CoordinateSequences.isEqual=function(cs1,cs2){var cs1Size=cs1.size(),cs2Size=cs2.size();if(cs1Size!==cs2Size)return!1;for(var dim=Math.min(cs1.getDimension(),cs2.getDimension()),i=0;i<cs1Size;i++)for(var d=0;d<dim;d++){var v1=cs1.getOrdinate(i,d),v2=cs2.getOrdinate(i,d);if(cs1.getOrdinate(i,d)!==cs2.getOrdinate(i,d)&&!(Double.isNaN(v1)&&Double.isNaN(v2)))return!1}return!0};CoordinateSequences.extend=function(fact,seq,size11){var newseq=fact.create(size11,seq.getDimension()),n=seq.size();if(CoordinateSequences.copy(seq,0,newseq,0,n),n>0)for(var i=n;i<size11;i++)CoordinateSequences.copy(seq,n-1,newseq,i,1);return newseq};CoordinateSequences.reverse=function(seq){for(var last=seq.size()-1,mid=Math.trunc(last/2),i=0;i<=mid;i++)CoordinateSequences.swap(seq,i,last-i)};CoordinateSequences.swap=function(seq,i,j){if(i===j)return null;for(var dim=0;dim<seq.getDimension();dim++){var tmp=seq.getOrdinate(i,dim);seq.setOrdinate(i,dim,seq.getOrdinate(j,dim)),seq.setOrdinate(j,dim,tmp)}};CoordinateSequences.copy=function(src,srcPos,dest,destPos,length3){for(var i=0;i<length3;i++)CoordinateSequences.copyCoord(src,srcPos+i,dest,destPos+i)};CoordinateSequences.toString=function(){if(arguments.length===1){var cs=arguments[0],size11=cs.size();if(size11===0)return"()";var dim=cs.getDimension(),buf=new StringBuffer;buf.append("(");for(var i=0;i<size11;i++){i>0&&buf.append(" ");for(var d=0;d<dim;d++)d>0&&buf.append(","),buf.append(StringUtil.toString(cs.getOrdinate(i,d)))}return buf.append(")"),buf.toString()}};CoordinateSequences.ensureValidRing=function(fact,seq){var n=seq.size();if(n===0)return seq;if(n<=3)return CoordinateSequences.createClosedRing(fact,seq,4);var isClosed5=seq.getOrdinate(0,CoordinateSequence.X)===seq.getOrdinate(n-1,CoordinateSequence.X)&&seq.getOrdinate(0,CoordinateSequence.Y)===seq.getOrdinate(n-1,CoordinateSequence.Y);return isClosed5?seq:CoordinateSequences.createClosedRing(fact,seq,n+1)};CoordinateSequences.createClosedRing=function(fact,seq,size11){var newseq=fact.create(size11,seq.getDimension()),n=seq.size();CoordinateSequences.copy(seq,0,newseq,0,n);for(var i=n;i<size11;i++)CoordinateSequences.copy(seq,0,newseq,i,1);return newseq};var LineString$1=function(Geometry$$1){function LineString2(points2,factory){Geometry$$1.call(this,factory),this._points=null,this.init(points2)}Geometry$$1&&(LineString2.__proto__=Geometry$$1),LineString2.prototype=Object.create(Geometry$$1&&Geometry$$1.prototype),LineString2.prototype.constructor=LineString2;var staticAccessors2={serialVersionUID:{configurable:!0}};return LineString2.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Envelope:this._points.expandEnvelope(new Envelope)},LineString2.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},LineString2.prototype.getSortIndex=function(){return Geometry$$1.SORTINDEX_LINESTRING},LineString2.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},LineString2.prototype.equalsExact=function(){var this$1=this;if(arguments.length===2){var other=arguments[0],tolerance=arguments[1];if(!this.isEquivalentClass(other))return!1;var otherLineString=other;if(this._points.size()!==otherLineString._points.size())return!1;for(var i=0;i<this._points.size();i++)if(!this$1.equal(this$1._points.getCoordinate(i),otherLineString._points.getCoordinate(i),tolerance))return!1;return!0}else return Geometry$$1.prototype.equalsExact.apply(this,arguments)},LineString2.prototype.normalize=function(){for(var this$1=this,i=0;i<Math.trunc(this._points.size()/2);i++){var j=this$1._points.size()-1-i;if(!this$1._points.getCoordinate(i).equals(this$1._points.getCoordinate(j)))return this$1._points.getCoordinate(i).compareTo(this$1._points.getCoordinate(j))>0&&CoordinateSequences.reverse(this$1._points),null}},LineString2.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},LineString2.prototype.getBoundaryDimension=function(){return this.isClosed()?Dimension.FALSE:0},LineString2.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},LineString2.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},LineString2.prototype.getDimension=function(){return 1},LineString2.prototype.getLength=function(){return CGAlgorithms.computeLength(this._points)},LineString2.prototype.getNumPoints=function(){return this._points.size()},LineString2.prototype.reverse=function(){var seq=this._points.copy();CoordinateSequences.reverse(seq);var revLine=this.getFactory().createLineString(seq);return revLine},LineString2.prototype.compareToSameClass=function(){var this$1=this;if(arguments.length===1){for(var o=arguments[0],line=o,i=0,j=0;i<this._points.size()&&j<line._points.size();){var comparison=this$1._points.getCoordinate(i).compareTo(line._points.getCoordinate(j));if(comparison!==0)return comparison;i++,j++}return i<this._points.size()?1:j<line._points.size()?-1:0}else if(arguments.length===2){var o$1=arguments[0],comp=arguments[1],line$1=o$1;return comp.compare(this._points,line$1._points)}},LineString2.prototype.apply=function(){var this$1=this;if(hasInterface(arguments[0],CoordinateFilter))for(var filter17=arguments[0],i=0;i<this._points.size();i++)filter17.filter(this$1._points.getCoordinate(i));else if(hasInterface(arguments[0],CoordinateSequenceFilter)){var filter$1=arguments[0];if(this._points.size()===0)return null;for(var i$1=0;i$1<this._points.size()&&(filter$1.filter(this$1._points,i$1),!filter$1.isDone());i$1++);filter$1.isGeometryChanged()&&this.geometryChanged()}else if(hasInterface(arguments[0],GeometryFilter)){var filter$2=arguments[0];filter$2.filter(this)}else if(hasInterface(arguments[0],GeometryComponentFilter)){var filter$3=arguments[0];filter$3.filter(this)}},LineString2.prototype.getBoundary=function(){return new BoundaryOp(this).getBoundary()},LineString2.prototype.isEquivalentClass=function(other){return other instanceof LineString2},LineString2.prototype.clone=function(){var ls=Geometry$$1.prototype.clone.call(this);return ls._points=this._points.clone(),ls},LineString2.prototype.getCoordinateN=function(n){return this._points.getCoordinate(n)},LineString2.prototype.getGeometryType=function(){return"LineString"},LineString2.prototype.copy=function(){return new LineString2(this._points.copy(),this._factory)},LineString2.prototype.getCoordinateSequence=function(){return this._points},LineString2.prototype.isEmpty=function(){return this._points.size()===0},LineString2.prototype.init=function(points2){if(points2===null&&(points2=this.getFactory().getCoordinateSequenceFactory().create([])),points2.size()===1)throw new IllegalArgumentException("Invalid number of points in LineString (found "+points2.size()+" - must be 0 or >= 2)");this._points=points2},LineString2.prototype.isCoordinate=function(pt){for(var this$1=this,i=0;i<this._points.size();i++)if(this$1._points.getCoordinate(i).equals(pt))return!0;return!1},LineString2.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},LineString2.prototype.getPointN=function(n){return this.getFactory().createPoint(this._points.getCoordinate(n))},LineString2.prototype.interfaces_=function(){return[Lineal]},LineString2.prototype.getClass=function(){return LineString2},staticAccessors2.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(LineString2,staticAccessors2),LineString2}(Geometry),Puntal=function(){};Puntal.prototype.interfaces_=function(){return[]};Puntal.prototype.getClass=function(){return Puntal};var Point=function(Geometry$$1){function Point2(coordinates,factory){Geometry$$1.call(this,factory),this._coordinates=coordinates||null,this.init(this._coordinates)}Geometry$$1&&(Point2.__proto__=Geometry$$1),Point2.prototype=Object.create(Geometry$$1&&Geometry$$1.prototype),Point2.prototype.constructor=Point2;var staticAccessors2={serialVersionUID:{configurable:!0}};return Point2.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Envelope;var env=new Envelope;return env.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),env},Point2.prototype.getSortIndex=function(){return Geometry$$1.SORTINDEX_POINT},Point2.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},Point2.prototype.equalsExact=function(){if(arguments.length===2){var other=arguments[0],tolerance=arguments[1];return this.isEquivalentClass(other)?this.isEmpty()&&other.isEmpty()?!0:this.isEmpty()!==other.isEmpty()?!1:this.equal(other.getCoordinate(),this.getCoordinate(),tolerance):!1}else return Geometry$$1.prototype.equalsExact.apply(this,arguments)},Point2.prototype.normalize=function(){},Point2.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},Point2.prototype.getBoundaryDimension=function(){return Dimension.FALSE},Point2.prototype.getDimension=function(){return 0},Point2.prototype.getNumPoints=function(){return this.isEmpty()?0:1},Point2.prototype.reverse=function(){return this.copy()},Point2.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},Point2.prototype.compareToSameClass=function(){if(arguments.length===1){var other=arguments[0],point$1=other;return this.getCoordinate().compareTo(point$1.getCoordinate())}else if(arguments.length===2){var other$1=arguments[0],comp=arguments[1],point4=other$1;return comp.compare(this._coordinates,point4._coordinates)}},Point2.prototype.apply=function(){if(hasInterface(arguments[0],CoordinateFilter)){var filter17=arguments[0];if(this.isEmpty())return null;filter17.filter(this.getCoordinate())}else if(hasInterface(arguments[0],CoordinateSequenceFilter)){var filter$1=arguments[0];if(this.isEmpty())return null;filter$1.filter(this._coordinates,0),filter$1.isGeometryChanged()&&this.geometryChanged()}else if(hasInterface(arguments[0],GeometryFilter)){var filter$2=arguments[0];filter$2.filter(this)}else if(hasInterface(arguments[0],GeometryComponentFilter)){var filter$3=arguments[0];filter$3.filter(this)}},Point2.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},Point2.prototype.clone=function(){var p=Geometry$$1.prototype.clone.call(this);return p._coordinates=this._coordinates.clone(),p},Point2.prototype.getGeometryType=function(){return"Point"},Point2.prototype.copy=function(){return new Point2(this._coordinates.copy(),this._factory)},Point2.prototype.getCoordinateSequence=function(){return this._coordinates},Point2.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},Point2.prototype.isEmpty=function(){return this._coordinates.size()===0},Point2.prototype.init=function(coordinates){coordinates===null&&(coordinates=this.getFactory().getCoordinateSequenceFactory().create([])),Assert.isTrue(coordinates.size()<=1),this._coordinates=coordinates},Point2.prototype.isSimple=function(){return!0},Point2.prototype.interfaces_=function(){return[Puntal]},Point2.prototype.getClass=function(){return Point2},staticAccessors2.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(Point2,staticAccessors2),Point2}(Geometry),Polygonal=function(){};Polygonal.prototype.interfaces_=function(){return[]};Polygonal.prototype.getClass=function(){return Polygonal};var Polygon=function(Geometry$$1){function Polygon2(shell,holes,factory){if(Geometry$$1.call(this,factory),this._shell=null,this._holes=null,shell===null&&(shell=this.getFactory().createLinearRing()),holes===null&&(holes=[]),Geometry$$1.hasNullElements(holes))throw new IllegalArgumentException("holes must not contain null elements");if(shell.isEmpty()&&Geometry$$1.hasNonEmptyElements(holes))throw new IllegalArgumentException("shell is empty but holes are not");this._shell=shell,this._holes=holes}Geometry$$1&&(Polygon2.__proto__=Geometry$$1),Polygon2.prototype=Object.create(Geometry$$1&&Geometry$$1.prototype),Polygon2.prototype.constructor=Polygon2;var staticAccessors2={serialVersionUID:{configurable:!0}};return Polygon2.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},Polygon2.prototype.getSortIndex=function(){return Geometry$$1.SORTINDEX_POLYGON},Polygon2.prototype.getCoordinates=function(){var this$1=this;if(this.isEmpty())return[];for(var coordinates=new Array(this.getNumPoints()).fill(null),k=-1,shellCoordinates=this._shell.getCoordinates(),x2=0;x2<shellCoordinates.length;x2++)k++,coordinates[k]=shellCoordinates[x2];for(var i=0;i<this._holes.length;i++)for(var childCoordinates=this$1._holes[i].getCoordinates(),j=0;j<childCoordinates.length;j++)k++,coordinates[k]=childCoordinates[j];return coordinates},Polygon2.prototype.getArea=function(){var this$1=this,area5=0;area5+=Math.abs(CGAlgorithms.signedArea(this._shell.getCoordinateSequence()));for(var i=0;i<this._holes.length;i++)area5-=Math.abs(CGAlgorithms.signedArea(this$1._holes[i].getCoordinateSequence()));return area5},Polygon2.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var seq=this._shell.getCoordinateSequence(),env=this.getEnvelopeInternal(),i=0;i<5;i++){var x2=seq.getX(i);if(!(x2===env.getMinX()||x2===env.getMaxX()))return!1;var y2=seq.getY(i);if(!(y2===env.getMinY()||y2===env.getMaxY()))return!1}for(var prevX=seq.getX(0),prevY=seq.getY(0),i$1=1;i$1<=4;i$1++){var x$1=seq.getX(i$1),y$1=seq.getY(i$1),xChanged=x$1!==prevX,yChanged=y$1!==prevY;if(xChanged===yChanged)return!1;prevX=x$1,prevY=y$1}return!0},Polygon2.prototype.equalsExact=function(){var this$1=this;if(arguments.length===2){var other=arguments[0],tolerance=arguments[1];if(!this.isEquivalentClass(other))return!1;var otherPolygon=other,thisShell=this._shell,otherPolygonShell=otherPolygon._shell;if(!thisShell.equalsExact(otherPolygonShell,tolerance)||this._holes.length!==otherPolygon._holes.length)return!1;for(var i=0;i<this._holes.length;i++)if(!this$1._holes[i].equalsExact(otherPolygon._holes[i],tolerance))return!1;return!0}else return Geometry$$1.prototype.equalsExact.apply(this,arguments)},Polygon2.prototype.normalize=function(){var this$1=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var i=0;i<this._holes.length;i++)this$1.normalize(this$1._holes[i],!1);Arrays.sort(this._holes)}else if(arguments.length===2){var ring=arguments[0],clockwise=arguments[1];if(ring.isEmpty())return null;var uniqueCoordinates=new Array(ring.getCoordinates().length-1).fill(null);System.arraycopy(ring.getCoordinates(),0,uniqueCoordinates,0,uniqueCoordinates.length);var minCoordinate2=CoordinateArrays.minCoordinate(ring.getCoordinates());CoordinateArrays.scroll(uniqueCoordinates,minCoordinate2),System.arraycopy(uniqueCoordinates,0,ring.getCoordinates(),0,uniqueCoordinates.length),ring.getCoordinates()[uniqueCoordinates.length]=uniqueCoordinates[0],CGAlgorithms.isCCW(ring.getCoordinates())===clockwise&&CoordinateArrays.reverse(ring.getCoordinates())}},Polygon2.prototype.getCoordinate=function(){return this._shell.getCoordinate()},Polygon2.prototype.getNumInteriorRing=function(){return this._holes.length},Polygon2.prototype.getBoundaryDimension=function(){return 1},Polygon2.prototype.getDimension=function(){return 2},Polygon2.prototype.getLength=function(){var this$1=this,len=0;len+=this._shell.getLength();for(var i=0;i<this._holes.length;i++)len+=this$1._holes[i].getLength();return len},Polygon2.prototype.getNumPoints=function(){for(var this$1=this,numPoints=this._shell.getNumPoints(),i=0;i<this._holes.length;i++)numPoints+=this$1._holes[i].getNumPoints();return numPoints},Polygon2.prototype.reverse=function(){var this$1=this,poly=this.copy();poly._shell=this._shell.copy().reverse(),poly._holes=new Array(this._holes.length).fill(null);for(var i=0;i<this._holes.length;i++)poly._holes[i]=this$1._holes[i].copy().reverse();return poly},Polygon2.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},Polygon2.prototype.compareToSameClass=function(){var this$1=this;if(arguments.length===1){var o=arguments[0],thisShell=this._shell,otherShell=o._shell;return thisShell.compareToSameClass(otherShell)}else if(arguments.length===2){var o$1=arguments[0],comp=arguments[1],poly=o$1,thisShell$1=this._shell,otherShell$1=poly._shell,shellComp=thisShell$1.compareToSameClass(otherShell$1,comp);if(shellComp!==0)return shellComp;for(var nHole1=this.getNumInteriorRing(),nHole2=poly.getNumInteriorRing(),i=0;i<nHole1&&i<nHole2;){var thisHole=this$1.getInteriorRingN(i),otherHole=poly.getInteriorRingN(i),holeComp=thisHole.compareToSameClass(otherHole,comp);if(holeComp!==0)return holeComp;i++}return i<nHole1?1:i<nHole2?-1:0}},Polygon2.prototype.apply=function(filter17){var this$1=this;if(hasInterface(filter17,CoordinateFilter)){this._shell.apply(filter17);for(var i$1=0;i$1<this._holes.length;i$1++)this$1._holes[i$1].apply(filter17)}else if(hasInterface(filter17,CoordinateSequenceFilter)){if(this._shell.apply(filter17),!filter17.isDone())for(var i$2=0;i$2<this._holes.length&&(this$1._holes[i$2].apply(filter17),!filter17.isDone());i$2++);filter17.isGeometryChanged()&&this.geometryChanged()}else if(hasInterface(filter17,GeometryFilter))filter17.filter(this);else if(hasInterface(filter17,GeometryComponentFilter)){filter17.filter(this),this._shell.apply(filter17);for(var i=0;i<this._holes.length;i++)this$1._holes[i].apply(filter17)}},Polygon2.prototype.getBoundary=function(){var this$1=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var rings=new Array(this._holes.length+1).fill(null);rings[0]=this._shell;for(var i=0;i<this._holes.length;i++)rings[i+1]=this$1._holes[i];return rings.length<=1?this.getFactory().createLinearRing(rings[0].getCoordinateSequence()):this.getFactory().createMultiLineString(rings)},Polygon2.prototype.clone=function(){var this$1=this,poly=Geometry$$1.prototype.clone.call(this);poly._shell=this._shell.clone(),poly._holes=new Array(this._holes.length).fill(null);for(var i=0;i<this._holes.length;i++)poly._holes[i]=this$1._holes[i].clone();return poly},Polygon2.prototype.getGeometryType=function(){return"Polygon"},Polygon2.prototype.copy=function(){for(var this$1=this,shell=this._shell.copy(),holes=new Array(this._holes.length).fill(null),i=0;i<holes.length;i++)holes[i]=this$1._holes[i].copy();return new Polygon2(shell,holes,this._factory)},Polygon2.prototype.getExteriorRing=function(){return this._shell},Polygon2.prototype.isEmpty=function(){return this._shell.isEmpty()},Polygon2.prototype.getInteriorRingN=function(n){return this._holes[n]},Polygon2.prototype.interfaces_=function(){return[Polygonal]},Polygon2.prototype.getClass=function(){return Polygon2},staticAccessors2.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(Polygon2,staticAccessors2),Polygon2}(Geometry),MultiPoint=function(GeometryCollection$$1){function MultiPoint2(){GeometryCollection$$1.apply(this,arguments)}GeometryCollection$$1&&(MultiPoint2.__proto__=GeometryCollection$$1),MultiPoint2.prototype=Object.create(GeometryCollection$$1&&GeometryCollection$$1.prototype),MultiPoint2.prototype.constructor=MultiPoint2;var staticAccessors2={serialVersionUID:{configurable:!0}};return MultiPoint2.prototype.getSortIndex=function(){return Geometry.SORTINDEX_MULTIPOINT},MultiPoint2.prototype.isValid=function(){return!0},MultiPoint2.prototype.equalsExact=function(){if(arguments.length===2){var other=arguments[0],tolerance=arguments[1];return this.isEquivalentClass(other)?GeometryCollection$$1.prototype.equalsExact.call(this,other,tolerance):!1}else return GeometryCollection$$1.prototype.equalsExact.apply(this,arguments)},MultiPoint2.prototype.getCoordinate=function(){if(arguments.length===1){var n=arguments[0];return this._geometries[n].getCoordinate()}else return GeometryCollection$$1.prototype.getCoordinate.apply(this,arguments)},MultiPoint2.prototype.getBoundaryDimension=function(){return Dimension.FALSE},MultiPoint2.prototype.getDimension=function(){return 0},MultiPoint2.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},MultiPoint2.prototype.getGeometryType=function(){return"MultiPoint"},MultiPoint2.prototype.copy=function(){for(var this$1=this,points2=new Array(this._geometries.length).fill(null),i=0;i<points2.length;i++)points2[i]=this$1._geometries[i].copy();return new MultiPoint2(points2,this._factory)},MultiPoint2.prototype.interfaces_=function(){return[Puntal]},MultiPoint2.prototype.getClass=function(){return MultiPoint2},staticAccessors2.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(MultiPoint2,staticAccessors2),MultiPoint2}(GeometryCollection),LinearRing=function(LineString$$1){function LinearRing2(points2,factory){points2 instanceof Coordinate&&factory instanceof GeometryFactory&&(points2=factory.getCoordinateSequenceFactory().create(points2)),LineString$$1.call(this,points2,factory),this.validateConstruction()}LineString$$1&&(LinearRing2.__proto__=LineString$$1),LinearRing2.prototype=Object.create(LineString$$1&&LineString$$1.prototype),LinearRing2.prototype.constructor=LinearRing2;var staticAccessors2={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return LinearRing2.prototype.getSortIndex=function(){return Geometry.SORTINDEX_LINEARRING},LinearRing2.prototype.getBoundaryDimension=function(){return Dimension.FALSE},LinearRing2.prototype.isClosed=function(){return this.isEmpty()?!0:LineString$$1.prototype.isClosed.call(this)},LinearRing2.prototype.reverse=function(){var seq=this._points.copy();CoordinateSequences.reverse(seq);var rev=this.getFactory().createLinearRing(seq);return rev},LinearRing2.prototype.validateConstruction=function(){if(!this.isEmpty()&&!LineString$$1.prototype.isClosed.call(this))throw new IllegalArgumentException("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<LinearRing2.MINIMUM_VALID_SIZE)throw new IllegalArgumentException("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},LinearRing2.prototype.getGeometryType=function(){return"LinearRing"},LinearRing2.prototype.copy=function(){return new LinearRing2(this._points.copy(),this._factory)},LinearRing2.prototype.interfaces_=function(){return[]},LinearRing2.prototype.getClass=function(){return LinearRing2},staticAccessors2.MINIMUM_VALID_SIZE.get=function(){return 4},staticAccessors2.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(LinearRing2,staticAccessors2),LinearRing2}(LineString$1),MultiPolygon=function(GeometryCollection$$1){function MultiPolygon2(){GeometryCollection$$1.apply(this,arguments)}GeometryCollection$$1&&(MultiPolygon2.__proto__=GeometryCollection$$1),MultiPolygon2.prototype=Object.create(GeometryCollection$$1&&GeometryCollection$$1.prototype),MultiPolygon2.prototype.constructor=MultiPolygon2;var staticAccessors2={serialVersionUID:{configurable:!0}};return MultiPolygon2.prototype.getSortIndex=function(){return Geometry.SORTINDEX_MULTIPOLYGON},MultiPolygon2.prototype.equalsExact=function(){if(arguments.length===2){var other=arguments[0],tolerance=arguments[1];return this.isEquivalentClass(other)?GeometryCollection$$1.prototype.equalsExact.call(this,other,tolerance):!1}else return GeometryCollection$$1.prototype.equalsExact.apply(this,arguments)},MultiPolygon2.prototype.getBoundaryDimension=function(){return 1},MultiPolygon2.prototype.getDimension=function(){return 2},MultiPolygon2.prototype.reverse=function(){for(var this$1=this,n=this._geometries.length,revGeoms=new Array(n).fill(null),i=0;i<this._geometries.length;i++)revGeoms[i]=this$1._geometries[i].reverse();return this.getFactory().createMultiPolygon(revGeoms)},MultiPolygon2.prototype.getBoundary=function(){var this$1=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var allRings=new ArrayList,i=0;i<this._geometries.length;i++)for(var polygon4=this$1._geometries[i],rings=polygon4.getBoundary(),j=0;j<rings.getNumGeometries();j++)allRings.add(rings.getGeometryN(j));var allRingsArray=new Array(allRings.size()).fill(null);return this.getFactory().createMultiLineString(allRings.toArray(allRingsArray))},MultiPolygon2.prototype.getGeometryType=function(){return"MultiPolygon"},MultiPolygon2.prototype.copy=function(){for(var this$1=this,polygons2=new Array(this._geometries.length).fill(null),i=0;i<polygons2.length;i++)polygons2[i]=this$1._geometries[i].copy();return new MultiPolygon2(polygons2,this._factory)},MultiPolygon2.prototype.interfaces_=function(){return[Polygonal]},MultiPolygon2.prototype.getClass=function(){return MultiPolygon2},staticAccessors2.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(MultiPolygon2,staticAccessors2),MultiPolygon2}(GeometryCollection),GeometryEditor=function(factory){this._factory=factory||null,this._isUserDataCopied=!1},staticAccessors$16={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};GeometryEditor.prototype.setCopyUserData=function(isUserDataCopied){this._isUserDataCopied=isUserDataCopied};GeometryEditor.prototype.edit=function(geometry2,operation){if(geometry2===null)return null;var result=this.editInternal(geometry2,operation);return this._isUserDataCopied&&result.setUserData(geometry2.getUserData()),result};GeometryEditor.prototype.editInternal=function(geometry2,operation){return this._factory===null&&(this._factory=geometry2.getFactory()),geometry2 instanceof GeometryCollection?this.editGeometryCollection(geometry2,operation):geometry2 instanceof Polygon?this.editPolygon(geometry2,operation):geometry2 instanceof Point?operation.edit(geometry2,this._factory):geometry2 instanceof LineString$1?operation.edit(geometry2,this._factory):(Assert.shouldNeverReachHere("Unsupported Geometry class: "+geometry2.getClass().getName()),null)};GeometryEditor.prototype.editGeometryCollection=function(collection,operation){for(var this$1=this,collectionForType=operation.edit(collection,this._factory),geometries=new ArrayList,i=0;i<collectionForType.getNumGeometries();i++){var geometry2=this$1.edit(collectionForType.getGeometryN(i),operation);geometry2===null||geometry2.isEmpty()||geometries.add(geometry2)}return collectionForType.getClass()===MultiPoint?this._factory.createMultiPoint(geometries.toArray([])):collectionForType.getClass()===MultiLineString?this._factory.createMultiLineString(geometries.toArray([])):collectionForType.getClass()===MultiPolygon?this._factory.createMultiPolygon(geometries.toArray([])):this._factory.createGeometryCollection(geometries.toArray([]))};GeometryEditor.prototype.editPolygon=function(polygon4,operation){var this$1=this,newPolygon=operation.edit(polygon4,this._factory);if(newPolygon===null&&(newPolygon=this._factory.createPolygon(null)),newPolygon.isEmpty())return newPolygon;var shell=this.edit(newPolygon.getExteriorRing(),operation);if(shell===null||shell.isEmpty())return this._factory.createPolygon();for(var holes=new ArrayList,i=0;i<newPolygon.getNumInteriorRing();i++){var hole=this$1.edit(newPolygon.getInteriorRingN(i),operation);hole===null||hole.isEmpty()||holes.add(hole)}return this._factory.createPolygon(shell,holes.toArray([]))};GeometryEditor.prototype.interfaces_=function(){return[]};GeometryEditor.prototype.getClass=function(){return GeometryEditor};GeometryEditor.GeometryEditorOperation=function(){};staticAccessors$16.NoOpGeometryOperation.get=function(){return NoOpGeometryOperation};staticAccessors$16.CoordinateOperation.get=function(){return CoordinateOperation};staticAccessors$16.CoordinateSequenceOperation.get=function(){return CoordinateSequenceOperation};Object.defineProperties(GeometryEditor,staticAccessors$16);var NoOpGeometryOperation=function(){};NoOpGeometryOperation.prototype.edit=function(geometry2,factory){return geometry2};NoOpGeometryOperation.prototype.interfaces_=function(){return[GeometryEditor.GeometryEditorOperation]};NoOpGeometryOperation.prototype.getClass=function(){return NoOpGeometryOperation};var CoordinateOperation=function(){};CoordinateOperation.prototype.edit=function(geometry2,factory){var coords=this.editCoordinates(geometry2.getCoordinates(),geometry2);return coords===null?geometry2:geometry2 instanceof LinearRing?factory.createLinearRing(coords):geometry2 instanceof LineString$1?factory.createLineString(coords):geometry2 instanceof Point?coords.length>0?factory.createPoint(coords[0]):factory.createPoint():geometry2};CoordinateOperation.prototype.interfaces_=function(){return[GeometryEditor.GeometryEditorOperation]};CoordinateOperation.prototype.getClass=function(){return CoordinateOperation};var CoordinateSequenceOperation=function(){};CoordinateSequenceOperation.prototype.edit=function(geometry2,factory){return geometry2 instanceof LinearRing?factory.createLinearRing(this.edit(geometry2.getCoordinateSequence(),geometry2)):geometry2 instanceof LineString$1?factory.createLineString(this.edit(geometry2.getCoordinateSequence(),geometry2)):geometry2 instanceof Point?factory.createPoint(this.edit(geometry2.getCoordinateSequence(),geometry2)):geometry2};CoordinateSequenceOperation.prototype.interfaces_=function(){return[GeometryEditor.GeometryEditorOperation]};CoordinateSequenceOperation.prototype.getClass=function(){return CoordinateSequenceOperation};var CoordinateArraySequence=function(){var this$1=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var size11=arguments[0];this._coordinates=new Array(size11).fill(null);for(var i=0;i<size11;i++)this$1._coordinates[i]=new Coordinate}else if(hasInterface(arguments[0],CoordinateSequence)){var coordSeq=arguments[0];if(coordSeq===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=coordSeq.getDimension(),this._coordinates=new Array(coordSeq.size()).fill(null);for(var i$1=0;i$1<this._coordinates.length;i$1++)this$1._coordinates[i$1]=coordSeq.getCoordinateCopy(i$1)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var coordinates=arguments[0],dimension=arguments[1];this._coordinates=coordinates,this._dimension=dimension,coordinates===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var size$1=arguments[0],dimension$1=arguments[1];this._coordinates=new Array(size$1).fill(null),this._dimension=dimension$1;for(var i$2=0;i$2<size$1;i$2++)this$1._coordinates[i$2]=new Coordinate}}},staticAccessors$18={serialVersionUID:{configurable:!0}};CoordinateArraySequence.prototype.setOrdinate=function(index,ordinateIndex,value){switch(ordinateIndex){case CoordinateSequence.X:this._coordinates[index].x=value;break;case CoordinateSequence.Y:this._coordinates[index].y=value;break;case CoordinateSequence.Z:this._coordinates[index].z=value;break;default:throw new IllegalArgumentException("invalid ordinateIndex")}};CoordinateArraySequence.prototype.size=function(){return this._coordinates.length};CoordinateArraySequence.prototype.getOrdinate=function(index,ordinateIndex){switch(ordinateIndex){case CoordinateSequence.X:return this._coordinates[index].x;case CoordinateSequence.Y:return this._coordinates[index].y;case CoordinateSequence.Z:return this._coordinates[index].z;default:}return Double.NaN};CoordinateArraySequence.prototype.getCoordinate=function(){if(arguments.length===1){var i=arguments[0];return this._coordinates[i]}else if(arguments.length===2){var index=arguments[0],coord=arguments[1];coord.x=this._coordinates[index].x,coord.y=this._coordinates[index].y,coord.z=this._coordinates[index].z}};CoordinateArraySequence.prototype.getCoordinateCopy=function(i){return new Coordinate(this._coordinates[i])};CoordinateArraySequence.prototype.getDimension=function(){return this._dimension};CoordinateArraySequence.prototype.getX=function(index){return this._coordinates[index].x};CoordinateArraySequence.prototype.clone=function(){for(var this$1=this,cloneCoordinates=new Array(this.size()).fill(null),i=0;i<this._coordinates.length;i++)cloneCoordinates[i]=this$1._coordinates[i].clone();return new CoordinateArraySequence(cloneCoordinates,this._dimension)};CoordinateArraySequence.prototype.expandEnvelope=function(env){for(var this$1=this,i=0;i<this._coordinates.length;i++)env.expandToInclude(this$1._coordinates[i]);return env};CoordinateArraySequence.prototype.copy=function(){for(var this$1=this,cloneCoordinates=new Array(this.size()).fill(null),i=0;i<this._coordinates.length;i++)cloneCoordinates[i]=this$1._coordinates[i].copy();return new CoordinateArraySequence(cloneCoordinates,this._dimension)};CoordinateArraySequence.prototype.toString=function(){var this$1=this;if(this._coordinates.length>0){var strBuf=new StringBuffer(17*this._coordinates.length);strBuf.append("("),strBuf.append(this._coordinates[0]);for(var i=1;i<this._coordinates.length;i++)strBuf.append(", "),strBuf.append(this$1._coordinates[i]);return strBuf.append(")"),strBuf.toString()}else return"()"};CoordinateArraySequence.prototype.getY=function(index){return this._coordinates[index].y};CoordinateArraySequence.prototype.toCoordinateArray=function(){return this._coordinates};CoordinateArraySequence.prototype.interfaces_=function(){return[CoordinateSequence,Serializable]};CoordinateArraySequence.prototype.getClass=function(){return CoordinateArraySequence};staticAccessors$18.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(CoordinateArraySequence,staticAccessors$18);var CoordinateArraySequenceFactory=function(){},staticAccessors$17={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};CoordinateArraySequenceFactory.prototype.readResolve=function(){return CoordinateArraySequenceFactory.instance()};CoordinateArraySequenceFactory.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var coordinates=arguments[0];return new CoordinateArraySequence(coordinates)}else if(hasInterface(arguments[0],CoordinateSequence)){var coordSeq=arguments[0];return new CoordinateArraySequence(coordSeq)}}else if(arguments.length===2){var size11=arguments[0],dimension=arguments[1];return dimension>3&&(dimension=3),dimension<2?new CoordinateArraySequence(size11):new CoordinateArraySequence(size11,dimension)}};CoordinateArraySequenceFactory.prototype.interfaces_=function(){return[CoordinateSequenceFactory,Serializable]};CoordinateArraySequenceFactory.prototype.getClass=function(){return CoordinateArraySequenceFactory};CoordinateArraySequenceFactory.instance=function(){return CoordinateArraySequenceFactory.instanceObject};staticAccessors$17.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};staticAccessors$17.instanceObject.get=function(){return new CoordinateArraySequenceFactory};Object.defineProperties(CoordinateArraySequenceFactory,staticAccessors$17);var HashMap=function(MapInterface){function HashMap2(){MapInterface.call(this),this.map_=new Map}return MapInterface&&(HashMap2.__proto__=MapInterface),HashMap2.prototype=Object.create(MapInterface&&MapInterface.prototype),HashMap2.prototype.constructor=HashMap2,HashMap2.prototype.get=function(key){return this.map_.get(key)||null},HashMap2.prototype.put=function(key,value){return this.map_.set(key,value),value},HashMap2.prototype.values=function(){for(var arrayList=new ArrayList,it=this.map_.values(),o=it.next();!o.done;)arrayList.add(o.value),o=it.next();return arrayList},HashMap2.prototype.entrySet=function(){var hashSet=new HashSet;return this.map_.entries().forEach(function(entry){return hashSet.add(entry)}),hashSet},HashMap2.prototype.size=function(){return this.map_.size()},HashMap2}(Map$1),PrecisionModel=function PrecisionModel2(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=PrecisionModel2.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Type){var modelType=arguments[0];this._modelType=modelType,modelType===PrecisionModel2.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var scale4=arguments[0];this._modelType=PrecisionModel2.FIXED,this.setScale(scale4)}else if(arguments[0]instanceof PrecisionModel2){var pm=arguments[0];this._modelType=pm._modelType,this._scale=pm._scale}}},staticAccessors$19={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};PrecisionModel.prototype.equals=function(other){if(!(other instanceof PrecisionModel))return!1;var otherPrecisionModel=other;return this._modelType===otherPrecisionModel._modelType&&this._scale===otherPrecisionModel._scale};PrecisionModel.prototype.compareTo=function(o){var other=o,sigDigits=this.getMaximumSignificantDigits(),otherSigDigits=other.getMaximumSignificantDigits();return new Integer(sigDigits).compareTo(new Integer(otherSigDigits))};PrecisionModel.prototype.getScale=function(){return this._scale};PrecisionModel.prototype.isFloating=function(){return this._modelType===PrecisionModel.FLOATING||this._modelType===PrecisionModel.FLOATING_SINGLE};PrecisionModel.prototype.getType=function(){return this._modelType};PrecisionModel.prototype.toString=function(){var description="UNKNOWN";return this._modelType===PrecisionModel.FLOATING?description="Floating":this._modelType===PrecisionModel.FLOATING_SINGLE?description="Floating-Single":this._modelType===PrecisionModel.FIXED&&(description="Fixed (Scale="+this.getScale()+")"),description};PrecisionModel.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var val=arguments[0];if(Double.isNaN(val))return val;if(this._modelType===PrecisionModel.FLOATING_SINGLE){var floatSingleVal=val;return floatSingleVal}return this._modelType===PrecisionModel.FIXED?Math.round(val*this._scale)/this._scale:val}else if(arguments[0]instanceof Coordinate){var coord=arguments[0];if(this._modelType===PrecisionModel.FLOATING)return null;coord.x=this.makePrecise(coord.x),coord.y=this.makePrecise(coord.y)}};PrecisionModel.prototype.getMaximumSignificantDigits=function(){var maxSigDigits=16;return this._modelType===PrecisionModel.FLOATING?maxSigDigits=16:this._modelType===PrecisionModel.FLOATING_SINGLE?maxSigDigits=6:this._modelType===PrecisionModel.FIXED&&(maxSigDigits=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),maxSigDigits};PrecisionModel.prototype.setScale=function(scale4){this._scale=Math.abs(scale4)};PrecisionModel.prototype.interfaces_=function(){return[Serializable,Comparable]};PrecisionModel.prototype.getClass=function(){return PrecisionModel};PrecisionModel.mostPrecise=function(pm1,pm2){return pm1.compareTo(pm2)>=0?pm1:pm2};staticAccessors$19.serialVersionUID.get=function(){return 7777263578777804e3};staticAccessors$19.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(PrecisionModel,staticAccessors$19);var Type=function Type2(name){this._name=name||null,Type2.nameToTypeMap.put(name,this)},staticAccessors$1$1={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Type.prototype.readResolve=function(){return Type.nameToTypeMap.get(this._name)};Type.prototype.toString=function(){return this._name};Type.prototype.interfaces_=function(){return[Serializable]};Type.prototype.getClass=function(){return Type};staticAccessors$1$1.serialVersionUID.get=function(){return-552860263173159e4};staticAccessors$1$1.nameToTypeMap.get=function(){return new HashMap};Object.defineProperties(Type,staticAccessors$1$1);PrecisionModel.Type=Type;PrecisionModel.FIXED=new Type("FIXED");PrecisionModel.FLOATING=new Type("FLOATING");PrecisionModel.FLOATING_SINGLE=new Type("FLOATING SINGLE");var GeometryFactory=function GeometryFactory2(){this._precisionModel=new PrecisionModel,this._SRID=0,this._coordinateSequenceFactory=GeometryFactory2.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?hasInterface(arguments[0],CoordinateSequenceFactory)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof PrecisionModel&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},staticAccessors$2={serialVersionUID:{configurable:!0}};GeometryFactory.prototype.toGeometry=function(envelope3){return envelope3.isNull()?this.createPoint(null):envelope3.getMinX()===envelope3.getMaxX()&&envelope3.getMinY()===envelope3.getMaxY()?this.createPoint(new Coordinate(envelope3.getMinX(),envelope3.getMinY())):envelope3.getMinX()===envelope3.getMaxX()||envelope3.getMinY()===envelope3.getMaxY()?this.createLineString([new Coordinate(envelope3.getMinX(),envelope3.getMinY()),new Coordinate(envelope3.getMaxX(),envelope3.getMaxY())]):this.createPolygon(this.createLinearRing([new Coordinate(envelope3.getMinX(),envelope3.getMinY()),new Coordinate(envelope3.getMinX(),envelope3.getMaxY()),new Coordinate(envelope3.getMaxX(),envelope3.getMaxY()),new Coordinate(envelope3.getMaxX(),envelope3.getMinY()),new Coordinate(envelope3.getMinX(),envelope3.getMinY())]),null)};GeometryFactory.prototype.createLineString=function(coordinates){if(coordinates){if(coordinates instanceof Array)return new LineString$1(this.getCoordinateSequenceFactory().create(coordinates),this);if(hasInterface(coordinates,CoordinateSequence))return new LineString$1(coordinates,this)}else return new LineString$1(this.getCoordinateSequenceFactory().create([]),this)};GeometryFactory.prototype.createMultiLineString=function(){if(arguments.length===0)return new MultiLineString(null,this);if(arguments.length===1){var lineStrings2=arguments[0];return new MultiLineString(lineStrings2,this)}};GeometryFactory.prototype.buildGeometry=function(geomList){for(var geomClass=null,isHeterogeneous=!1,hasGeometryCollection=!1,i=geomList.iterator();i.hasNext();){var geom=i.next(),partClass=geom.getClass();geomClass===null&&(geomClass=partClass),partClass!==geomClass&&(isHeterogeneous=!0),geom.isGeometryCollectionOrDerived()&&(hasGeometryCollection=!0)}if(geomClass===null)return this.createGeometryCollection();if(isHeterogeneous||hasGeometryCollection)return this.createGeometryCollection(GeometryFactory.toGeometryArray(geomList));var geom0=geomList.iterator().next(),isCollection=geomList.size()>1;if(isCollection){if(geom0 instanceof Polygon)return this.createMultiPolygon(GeometryFactory.toPolygonArray(geomList));if(geom0 instanceof LineString$1)return this.createMultiLineString(GeometryFactory.toLineStringArray(geomList));if(geom0 instanceof Point)return this.createMultiPoint(GeometryFactory.toPointArray(geomList));Assert.shouldNeverReachHere("Unhandled class: "+geom0.getClass().getName())}return geom0};GeometryFactory.prototype.createMultiPointFromCoords=function(coordinates){return this.createMultiPoint(coordinates!==null?this.getCoordinateSequenceFactory().create(coordinates):null)};GeometryFactory.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Coordinate){var coordinate2=arguments[0];return this.createPoint(coordinate2!==null?this.getCoordinateSequenceFactory().create([coordinate2]):null)}else if(hasInterface(arguments[0],CoordinateSequence)){var coordinates=arguments[0];return new Point(coordinates,this)}}};GeometryFactory.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};GeometryFactory.prototype.createPolygon=function(){if(arguments.length===0)return new Polygon(null,null,this);if(arguments.length===1){if(hasInterface(arguments[0],CoordinateSequence)){var coordinates=arguments[0];return this.createPolygon(this.createLinearRing(coordinates))}else if(arguments[0]instanceof Array){var coordinates$1=arguments[0];return this.createPolygon(this.createLinearRing(coordinates$1))}else if(arguments[0]instanceof LinearRing){var shell=arguments[0];return this.createPolygon(shell,null)}}else if(arguments.length===2){var shell$1=arguments[0],holes=arguments[1];return new Polygon(shell$1,holes,this)}};GeometryFactory.prototype.getSRID=function(){return this._SRID};GeometryFactory.prototype.createGeometryCollection=function(){if(arguments.length===0)return new GeometryCollection(null,this);if(arguments.length===1){var geometries=arguments[0];return new GeometryCollection(geometries,this)}};GeometryFactory.prototype.createGeometry=function(g){var editor=new GeometryEditor(this);return editor.edit(g,{edit:function(){if(arguments.length===2){var coordSeq=arguments[0];return this._coordinateSequenceFactory.create(coordSeq)}}})};GeometryFactory.prototype.getPrecisionModel=function(){return this._precisionModel};GeometryFactory.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var coordinates=arguments[0];return this.createLinearRing(coordinates!==null?this.getCoordinateSequenceFactory().create(coordinates):null)}else if(hasInterface(arguments[0],CoordinateSequence)){var coordinates$1=arguments[0];return new LinearRing(coordinates$1,this)}}};GeometryFactory.prototype.createMultiPolygon=function(){if(arguments.length===0)return new MultiPolygon(null,this);if(arguments.length===1){var polygons2=arguments[0];return new MultiPolygon(polygons2,this)}};GeometryFactory.prototype.createMultiPoint=function(){var this$1=this;if(arguments.length===0)return new MultiPoint(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var point4=arguments[0];return new MultiPoint(point4,this)}else if(arguments[0]instanceof Array){var coordinates=arguments[0];return this.createMultiPoint(coordinates!==null?this.getCoordinateSequenceFactory().create(coordinates):null)}else if(hasInterface(arguments[0],CoordinateSequence)){var coordinates$1=arguments[0];if(coordinates$1===null)return this.createMultiPoint(new Array(0).fill(null));for(var points2=new Array(coordinates$1.size()).fill(null),i=0;i<coordinates$1.size();i++){var ptSeq=this$1.getCoordinateSequenceFactory().create(1,coordinates$1.getDimension());CoordinateSequences.copy(coordinates$1,i,ptSeq,0,1),points2[i]=this$1.createPoint(ptSeq)}return this.createMultiPoint(points2)}}};GeometryFactory.prototype.interfaces_=function(){return[Serializable]};GeometryFactory.prototype.getClass=function(){return GeometryFactory};GeometryFactory.toMultiPolygonArray=function(multiPolygons){var multiPolygonArray=new Array(multiPolygons.size()).fill(null);return multiPolygons.toArray(multiPolygonArray)};GeometryFactory.toGeometryArray=function(geometries){if(geometries===null)return null;var geometryArray=new Array(geometries.size()).fill(null);return geometries.toArray(geometryArray)};GeometryFactory.getDefaultCoordinateSequenceFactory=function(){return CoordinateArraySequenceFactory.instance()};GeometryFactory.toMultiLineStringArray=function(multiLineStrings){var multiLineStringArray=new Array(multiLineStrings.size()).fill(null);return multiLineStrings.toArray(multiLineStringArray)};GeometryFactory.toLineStringArray=function(lineStrings2){var lineStringArray=new Array(lineStrings2.size()).fill(null);return lineStrings2.toArray(lineStringArray)};GeometryFactory.toMultiPointArray=function(multiPoints){var multiPointArray=new Array(multiPoints.size()).fill(null);return multiPoints.toArray(multiPointArray)};GeometryFactory.toLinearRingArray=function(linearRings){var linearRingArray=new Array(linearRings.size()).fill(null);return linearRings.toArray(linearRingArray)};GeometryFactory.toPointArray=function(points2){var pointArray=new Array(points2.size()).fill(null);return points2.toArray(pointArray)};GeometryFactory.toPolygonArray=function(polygons2){var polygonArray=new Array(polygons2.size()).fill(null);return polygons2.toArray(polygonArray)};GeometryFactory.createPointFromInternalCoord=function(coord,exemplar){return exemplar.getPrecisionModel().makePrecise(coord),exemplar.getFactory().createPoint(coord)};staticAccessors$2.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(GeometryFactory,staticAccessors$2);var geometryTypes=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],GeoJSONParser=function(geometryFactory){this.geometryFactory=geometryFactory||new GeometryFactory};GeoJSONParser.prototype.read=function(json){var obj;typeof json=="string"?obj=JSON.parse(json):obj=json;var type=obj.type;if(!parse2[type])throw new Error("Unknown GeoJSON type: "+obj.type);return geometryTypes.indexOf(type)!==-1?parse2[type].apply(this,[obj.coordinates]):type==="GeometryCollection"?parse2[type].apply(this,[obj.geometries]):parse2[type].apply(this,[obj])};GeoJSONParser.prototype.write=function(geometry2){var type=geometry2.getGeometryType();if(!extract$1$1[type])throw new Error("Geometry is not supported");return extract$1$1[type].apply(this,[geometry2])};var parse2={Feature:function(obj){var feature2={};for(var key in obj)feature2[key]=obj[key];if(obj.geometry){var type=obj.geometry.type;if(!parse2[type])throw new Error("Unknown GeoJSON type: "+obj.type);feature2.geometry=this.read(obj.geometry)}return obj.bbox&&(feature2.bbox=parse2.bbox.apply(this,[obj.bbox])),feature2},FeatureCollection:function(obj){var this$1=this,featureCollection2={};if(obj.features){featureCollection2.features=[];for(var i=0;i<obj.features.length;++i)featureCollection2.features.push(this$1.read(obj.features[i]))}return obj.bbox&&(featureCollection2.bbox=this.parse.bbox.apply(this,[obj.bbox])),featureCollection2},coordinates:function(array){for(var coordinates=[],i=0;i<array.length;++i){var sub2=array[i];coordinates.push(new Coordinate(sub2[0],sub2[1]))}return coordinates},bbox:function(array){return this.geometryFactory.createLinearRing([new Coordinate(array[0],array[1]),new Coordinate(array[2],array[1]),new Coordinate(array[2],array[3]),new Coordinate(array[0],array[3]),new Coordinate(array[0],array[1])])},Point:function(array){var coordinate2=new Coordinate(array[0],array[1]);return this.geometryFactory.createPoint(coordinate2)},MultiPoint:function(array){for(var this$1=this,points2=[],i=0;i<array.length;++i)points2.push(parse2.Point.apply(this$1,[array[i]]));return this.geometryFactory.createMultiPoint(points2)},LineString:function(array){var coordinates=parse2.coordinates.apply(this,[array]);return this.geometryFactory.createLineString(coordinates)},MultiLineString:function(array){for(var this$1=this,lineStrings2=[],i=0;i<array.length;++i)lineStrings2.push(parse2.LineString.apply(this$1,[array[i]]));return this.geometryFactory.createMultiLineString(lineStrings2)},Polygon:function(array){for(var this$1=this,shellCoordinates=parse2.coordinates.apply(this,[array[0]]),shell=this.geometryFactory.createLinearRing(shellCoordinates),holes=[],i=1;i<array.length;++i){var hole=array[i],coordinates=parse2.coordinates.apply(this$1,[hole]),linearRing=this$1.geometryFactory.createLinearRing(coordinates);holes.push(linearRing)}return this.geometryFactory.createPolygon(shell,holes)},MultiPolygon:function(array){for(var this$1=this,polygons2=[],i=0;i<array.length;++i){var polygon4=array[i];polygons2.push(parse2.Polygon.apply(this$1,[polygon4]))}return this.geometryFactory.createMultiPolygon(polygons2)},GeometryCollection:function(array){for(var this$1=this,geometries=[],i=0;i<array.length;++i){var geometry2=array[i];geometries.push(this$1.read(geometry2))}return this.geometryFactory.createGeometryCollection(geometries)}},extract$1$1={coordinate:function(coordinate2){return[coordinate2.x,coordinate2.y]},Point:function(point4){var array=extract$1$1.coordinate.apply(this,[point4.getCoordinate()]);return{type:"Point",coordinates:array}},MultiPoint:function(multipoint3){for(var this$1=this,array=[],i=0;i<multipoint3._geometries.length;++i){var point4=multipoint3._geometries[i],geoJson=extract$1$1.Point.apply(this$1,[point4]);array.push(geoJson.coordinates)}return{type:"MultiPoint",coordinates:array}},LineString:function(linestring3){for(var this$1=this,array=[],coordinates=linestring3.getCoordinates(),i=0;i<coordinates.length;++i){var coordinate2=coordinates[i];array.push(extract$1$1.coordinate.apply(this$1,[coordinate2]))}return{type:"LineString",coordinates:array}},MultiLineString:function(multilinestring3){for(var this$1=this,array=[],i=0;i<multilinestring3._geometries.length;++i){var linestring3=multilinestring3._geometries[i],geoJson=extract$1$1.LineString.apply(this$1,[linestring3]);array.push(geoJson.coordinates)}return{type:"MultiLineString",coordinates:array}},Polygon:function(polygon4){var this$1=this,array=[],shellGeoJson=extract$1$1.LineString.apply(this,[polygon4._shell]);array.push(shellGeoJson.coordinates);for(var i=0;i<polygon4._holes.length;++i){var hole=polygon4._holes[i],holeGeoJson=extract$1$1.LineString.apply(this$1,[hole]);array.push(holeGeoJson.coordinates)}return{type:"Polygon",coordinates:array}},MultiPolygon:function(multipolygon3){for(var this$1=this,array=[],i=0;i<multipolygon3._geometries.length;++i){var polygon4=multipolygon3._geometries[i],geoJson=extract$1$1.Polygon.apply(this$1,[polygon4]);array.push(geoJson.coordinates)}return{type:"MultiPolygon",coordinates:array}},GeometryCollection:function(collection){for(var this$1=this,array=[],i=0;i<collection._geometries.length;++i){var geometry2=collection._geometries[i],type=geometry2.getGeometryType();array.push(extract$1$1[type].apply(this$1,[geometry2]))}return{type:"GeometryCollection",geometries:array}}},GeoJSONReader=function(geometryFactory){this.geometryFactory=geometryFactory||new GeometryFactory,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new GeoJSONParser(this.geometryFactory)};GeoJSONReader.prototype.read=function(geoJson){var geometry2=this.parser.read(geoJson);return this.precisionModel.getType()===PrecisionModel.FIXED&&this.reducePrecision(geometry2),geometry2};GeoJSONReader.prototype.reducePrecision=function(geometry2){var this$1=this,i,len;if(geometry2.coordinate)this.precisionModel.makePrecise(geometry2.coordinate);else if(geometry2.points)for(i=0,len=geometry2.points.length;i<len;i++)this$1.precisionModel.makePrecise(geometry2.points[i]);else if(geometry2.geometries)for(i=0,len=geometry2.geometries.length;i<len;i++)this$1.reducePrecision(geometry2.geometries[i])};var GeoJSONWriter=function(){this.parser=new GeoJSONParser(this.geometryFactory)};GeoJSONWriter.prototype.write=function(geometry2){return this.parser.write(geometry2)};var Position=function(){},staticAccessors$20={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Position.prototype.interfaces_=function(){return[]};Position.prototype.getClass=function(){return Position};Position.opposite=function(position){return position===Position.LEFT?Position.RIGHT:position===Position.RIGHT?Position.LEFT:position};staticAccessors$20.ON.get=function(){return 0};staticAccessors$20.LEFT.get=function(){return 1};staticAccessors$20.RIGHT.get=function(){return 2};Object.defineProperties(Position,staticAccessors$20);function EmptyStackException(message){this.message=message||""}EmptyStackException.prototype=new Error;EmptyStackException.prototype.name="EmptyStackException";function Stack(){this.array_=[]}Stack.prototype=new List;Stack.prototype.add=function(e){return this.array_.push(e),!0};Stack.prototype.get=function(index){if(index<0||index>=this.size())throw new Error;return this.array_[index]};Stack.prototype.push=function(e){return this.array_.push(e),e};Stack.prototype.pop=function(e){if(this.array_.length===0)throw new EmptyStackException;return this.array_.pop()};Stack.prototype.peek=function(){if(this.array_.length===0)throw new EmptyStackException;return this.array_[this.array_.length-1]};Stack.prototype.empty=function(){return this.array_.length===0};Stack.prototype.isEmpty=function(){return this.empty()};Stack.prototype.search=function(o){return this.array_.indexOf(o)};Stack.prototype.size=function(){return this.array_.length};Stack.prototype.toArray=function(){for(var this$1=this,array=[],i=0,len=this.array_.length;i<len;i++)array.push(this$1.array_[i]);return array};var RightmostEdgeFinder=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};RightmostEdgeFinder.prototype.getCoordinate=function(){return this._minCoord};RightmostEdgeFinder.prototype.getRightmostSide=function(de,index){var side=this.getRightmostSideOfSegment(de,index);return side<0&&(side=this.getRightmostSideOfSegment(de,index-1)),side<0&&(this._minCoord=null,this.checkForRightmostCoordinate(de)),side};RightmostEdgeFinder.prototype.findRightmostEdgeAtVertex=function(){var pts=this._minDe.getEdge().getCoordinates();Assert.isTrue(this._minIndex>0&&this._minIndex<pts.length,"rightmost point expected to be interior vertex of edge");var pPrev=pts[this._minIndex-1],pNext=pts[this._minIndex+1],orientation2=CGAlgorithms.computeOrientation(this._minCoord,pNext,pPrev),usePrev=!1;(pPrev.y<this._minCoord.y&&pNext.y<this._minCoord.y&&orientation2===CGAlgorithms.COUNTERCLOCKWISE||pPrev.y>this._minCoord.y&&pNext.y>this._minCoord.y&&orientation2===CGAlgorithms.CLOCKWISE)&&(usePrev=!0),usePrev&&(this._minIndex=this._minIndex-1)};RightmostEdgeFinder.prototype.getRightmostSideOfSegment=function(de,i){var e=de.getEdge(),coord=e.getCoordinates();if(i<0||i+1>=coord.length||coord[i].y===coord[i+1].y)return-1;var pos=Position.LEFT;return coord[i].y<coord[i+1].y&&(pos=Position.RIGHT),pos};RightmostEdgeFinder.prototype.getEdge=function(){return this._orientedDe};RightmostEdgeFinder.prototype.checkForRightmostCoordinate=function(de){for(var this$1=this,coord=de.getEdge().getCoordinates(),i=0;i<coord.length-1;i++)(this$1._minCoord===null||coord[i].x>this$1._minCoord.x)&&(this$1._minDe=de,this$1._minIndex=i,this$1._minCoord=coord[i])};RightmostEdgeFinder.prototype.findRightmostEdgeAtNode=function(){var node=this._minDe.getNode(),star=node.getEdges();this._minDe=star.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};RightmostEdgeFinder.prototype.findEdge=function(dirEdgeList){for(var this$1=this,i=dirEdgeList.iterator();i.hasNext();){var de=i.next();!de.isForward()||this$1.checkForRightmostCoordinate(de)}Assert.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var rightmostSide=this.getRightmostSide(this._minDe,this._minIndex);rightmostSide===Position.LEFT&&(this._orientedDe=this._minDe.getSym())};RightmostEdgeFinder.prototype.interfaces_=function(){return[]};RightmostEdgeFinder.prototype.getClass=function(){return RightmostEdgeFinder};var TopologyException=function(RuntimeException$$1){function TopologyException2(msg,pt){RuntimeException$$1.call(this,TopologyException2.msgWithCoord(msg,pt)),this.pt=pt?new Coordinate(pt):null,this.name="TopologyException"}return RuntimeException$$1&&(TopologyException2.__proto__=RuntimeException$$1),TopologyException2.prototype=Object.create(RuntimeException$$1&&RuntimeException$$1.prototype),TopologyException2.prototype.constructor=TopologyException2,TopologyException2.prototype.getCoordinate=function(){return this.pt},TopologyException2.prototype.interfaces_=function(){return[]},TopologyException2.prototype.getClass=function(){return TopologyException2},TopologyException2.msgWithCoord=function(msg,pt){return pt?msg:msg+" [ "+pt+" ]"},TopologyException2}(RuntimeException),LinkedList=function(){this.array_=[]};LinkedList.prototype.addLast=function(e){this.array_.push(e)};LinkedList.prototype.removeFirst=function(){return this.array_.shift()};LinkedList.prototype.isEmpty=function(){return this.array_.length===0};var BufferSubgraph=function(){this._finder=null,this._dirEdgeList=new ArrayList,this._nodes=new ArrayList,this._rightMostCoord=null,this._env=null,this._finder=new RightmostEdgeFinder};BufferSubgraph.prototype.clearVisitedEdges=function(){for(var it=this._dirEdgeList.iterator();it.hasNext();){var de=it.next();de.setVisited(!1)}};BufferSubgraph.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};BufferSubgraph.prototype.computeNodeDepth=function(n){for(var this$1=this,startEdge=null,i=n.getEdges().iterator();i.hasNext();){var de=i.next();if(de.isVisited()||de.getSym().isVisited()){startEdge=de;break}}if(startEdge===null)throw new TopologyException("unable to find edge to compute depths at "+n.getCoordinate());n.getEdges().computeDepths(startEdge);for(var i$1=n.getEdges().iterator();i$1.hasNext();){var de$1=i$1.next();de$1.setVisited(!0),this$1.copySymDepths(de$1)}};BufferSubgraph.prototype.computeDepth=function(outsideDepth){this.clearVisitedEdges();var de=this._finder.getEdge();de.setEdgeDepths(Position.RIGHT,outsideDepth),this.copySymDepths(de),this.computeDepths(de)};BufferSubgraph.prototype.create=function(node){this.addReachable(node),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};BufferSubgraph.prototype.findResultEdges=function(){for(var it=this._dirEdgeList.iterator();it.hasNext();){var de=it.next();de.getDepth(Position.RIGHT)>=1&&de.getDepth(Position.LEFT)<=0&&!de.isInteriorAreaEdge()&&de.setInResult(!0)}};BufferSubgraph.prototype.computeDepths=function(startEdge){var this$1=this,nodesVisited=new HashSet,nodeQueue=new LinkedList,startNode=startEdge.getNode();for(nodeQueue.addLast(startNode),nodesVisited.add(startNode),startEdge.setVisited(!0);!nodeQueue.isEmpty();){var n=nodeQueue.removeFirst();nodesVisited.add(n),this$1.computeNodeDepth(n);for(var i=n.getEdges().iterator();i.hasNext();){var de=i.next(),sym=de.getSym();if(!sym.isVisited()){var adjNode=sym.getNode();nodesVisited.contains(adjNode)||(nodeQueue.addLast(adjNode),nodesVisited.add(adjNode))}}}};BufferSubgraph.prototype.compareTo=function(o){var graph=o;return this._rightMostCoord.x<graph._rightMostCoord.x?-1:this._rightMostCoord.x>graph._rightMostCoord.x?1:0};BufferSubgraph.prototype.getEnvelope=function(){if(this._env===null){for(var edgeEnv=new Envelope,it=this._dirEdgeList.iterator();it.hasNext();)for(var dirEdge=it.next(),pts=dirEdge.getEdge().getCoordinates(),i=0;i<pts.length-1;i++)edgeEnv.expandToInclude(pts[i]);this._env=edgeEnv}return this._env};BufferSubgraph.prototype.addReachable=function(startNode){var this$1=this,nodeStack=new Stack;for(nodeStack.add(startNode);!nodeStack.empty();){var node=nodeStack.pop();this$1.add(node,nodeStack)}};BufferSubgraph.prototype.copySymDepths=function(de){var sym=de.getSym();sym.setDepth(Position.LEFT,de.getDepth(Position.RIGHT)),sym.setDepth(Position.RIGHT,de.getDepth(Position.LEFT))};BufferSubgraph.prototype.add=function(node,nodeStack){var this$1=this;node.setVisited(!0),this._nodes.add(node);for(var i=node.getEdges().iterator();i.hasNext();){var de=i.next();this$1._dirEdgeList.add(de);var sym=de.getSym(),symNode=sym.getNode();symNode.isVisited()||nodeStack.push(symNode)}};BufferSubgraph.prototype.getNodes=function(){return this._nodes};BufferSubgraph.prototype.getDirectedEdges=function(){return this._dirEdgeList};BufferSubgraph.prototype.interfaces_=function(){return[Comparable]};BufferSubgraph.prototype.getClass=function(){return BufferSubgraph};var TopologyLocation=function TopologyLocation2(){var this$1=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var location2=arguments[0];this.init(location2.length)}else if(Number.isInteger(arguments[0])){var on=arguments[0];this.init(1),this.location[Position.ON]=on}else if(arguments[0]instanceof TopologyLocation2){var gl=arguments[0];if(this.init(gl.location.length),gl!==null)for(var i=0;i<this.location.length;i++)this$1.location[i]=gl.location[i]}}else if(arguments.length===3){var on$1=arguments[0],left=arguments[1],right=arguments[2];this.init(3),this.location[Position.ON]=on$1,this.location[Position.LEFT]=left,this.location[Position.RIGHT]=right}};TopologyLocation.prototype.setAllLocations=function(locValue){for(var this$1=this,i=0;i<this.location.length;i++)this$1.location[i]=locValue};TopologyLocation.prototype.isNull=function(){for(var this$1=this,i=0;i<this.location.length;i++)if(this$1.location[i]!==Location.NONE)return!1;return!0};TopologyLocation.prototype.setAllLocationsIfNull=function(locValue){for(var this$1=this,i=0;i<this.location.length;i++)this$1.location[i]===Location.NONE&&(this$1.location[i]=locValue)};TopologyLocation.prototype.isLine=function(){return this.location.length===1};TopologyLocation.prototype.merge=function(gl){var this$1=this;if(gl.location.length>this.location.length){var newLoc=new Array(3).fill(null);newLoc[Position.ON]=this.location[Position.ON],newLoc[Position.LEFT]=Location.NONE,newLoc[Position.RIGHT]=Location.NONE,this.location=newLoc}for(var i=0;i<this.location.length;i++)this$1.location[i]===Location.NONE&&i<gl.location.length&&(this$1.location[i]=gl.location[i])};TopologyLocation.prototype.getLocations=function(){return this.location};TopologyLocation.prototype.flip=function(){if(this.location.length<=1)return null;var temp2=this.location[Position.LEFT];this.location[Position.LEFT]=this.location[Position.RIGHT],this.location[Position.RIGHT]=temp2};TopologyLocation.prototype.toString=function(){var buf=new StringBuffer;return this.location.length>1&&buf.append(Location.toLocationSymbol(this.location[Position.LEFT])),buf.append(Location.toLocationSymbol(this.location[Position.ON])),this.location.length>1&&buf.append(Location.toLocationSymbol(this.location[Position.RIGHT])),buf.toString()};TopologyLocation.prototype.setLocations=function(on,left,right){this.location[Position.ON]=on,this.location[Position.LEFT]=left,this.location[Position.RIGHT]=right};TopologyLocation.prototype.get=function(posIndex){return posIndex<this.location.length?this.location[posIndex]:Location.NONE};TopologyLocation.prototype.isArea=function(){return this.location.length>1};TopologyLocation.prototype.isAnyNull=function(){for(var this$1=this,i=0;i<this.location.length;i++)if(this$1.location[i]===Location.NONE)return!0;return!1};TopologyLocation.prototype.setLocation=function(){if(arguments.length===1){var locValue=arguments[0];this.setLocation(Position.ON,locValue)}else if(arguments.length===2){var locIndex=arguments[0],locValue$1=arguments[1];this.location[locIndex]=locValue$1}};TopologyLocation.prototype.init=function(size11){this.location=new Array(size11).fill(null),this.setAllLocations(Location.NONE)};TopologyLocation.prototype.isEqualOnSide=function(le2,locIndex){return this.location[locIndex]===le2.location[locIndex]};TopologyLocation.prototype.allPositionsEqual=function(loc){for(var this$1=this,i=0;i<this.location.length;i++)if(this$1.location[i]!==loc)return!1;return!0};TopologyLocation.prototype.interfaces_=function(){return[]};TopologyLocation.prototype.getClass=function(){return TopologyLocation};var Label=function Label2(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var onLoc=arguments[0];this.elt[0]=new TopologyLocation(onLoc),this.elt[1]=new TopologyLocation(onLoc)}else if(arguments[0]instanceof Label2){var lbl=arguments[0];this.elt[0]=new TopologyLocation(lbl.elt[0]),this.elt[1]=new TopologyLocation(lbl.elt[1])}}else if(arguments.length===2){var geomIndex=arguments[0],onLoc$1=arguments[1];this.elt[0]=new TopologyLocation(Location.NONE),this.elt[1]=new TopologyLocation(Location.NONE),this.elt[geomIndex].setLocation(onLoc$1)}else if(arguments.length===3){var onLoc$2=arguments[0],leftLoc=arguments[1],rightLoc=arguments[2];this.elt[0]=new TopologyLocation(onLoc$2,leftLoc,rightLoc),this.elt[1]=new TopologyLocation(onLoc$2,leftLoc,rightLoc)}else if(arguments.length===4){var geomIndex$1=arguments[0],onLoc$3=arguments[1],leftLoc$1=arguments[2],rightLoc$1=arguments[3];this.elt[0]=new TopologyLocation(Location.NONE,Location.NONE,Location.NONE),this.elt[1]=new TopologyLocation(Location.NONE,Location.NONE,Location.NONE),this.elt[geomIndex$1].setLocations(onLoc$3,leftLoc$1,rightLoc$1)}};Label.prototype.getGeometryCount=function(){var count2=0;return this.elt[0].isNull()||count2++,this.elt[1].isNull()||count2++,count2};Label.prototype.setAllLocations=function(geomIndex,location2){this.elt[geomIndex].setAllLocations(location2)};Label.prototype.isNull=function(geomIndex){return this.elt[geomIndex].isNull()};Label.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var location2=arguments[0];this.setAllLocationsIfNull(0,location2),this.setAllLocationsIfNull(1,location2)}else if(arguments.length===2){var geomIndex=arguments[0],location$1=arguments[1];this.elt[geomIndex].setAllLocationsIfNull(location$1)}};Label.prototype.isLine=function(geomIndex){return this.elt[geomIndex].isLine()};Label.prototype.merge=function(lbl){for(var this$1=this,i=0;i<2;i++)this$1.elt[i]===null&&lbl.elt[i]!==null?this$1.elt[i]=new TopologyLocation(lbl.elt[i]):this$1.elt[i].merge(lbl.elt[i])};Label.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};Label.prototype.getLocation=function(){if(arguments.length===1){var geomIndex=arguments[0];return this.elt[geomIndex].get(Position.ON)}else if(arguments.length===2){var geomIndex$1=arguments[0],posIndex=arguments[1];return this.elt[geomIndex$1].get(posIndex)}};Label.prototype.toString=function(){var buf=new StringBuffer;return this.elt[0]!==null&&(buf.append("A:"),buf.append(this.elt[0].toString())),this.elt[1]!==null&&(buf.append(" B:"),buf.append(this.elt[1].toString())),buf.toString()};Label.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var geomIndex=arguments[0];return this.elt[geomIndex].isArea()}};Label.prototype.isAnyNull=function(geomIndex){return this.elt[geomIndex].isAnyNull()};Label.prototype.setLocation=function(){if(arguments.length===2){var geomIndex=arguments[0],location2=arguments[1];this.elt[geomIndex].setLocation(Position.ON,location2)}else if(arguments.length===3){var geomIndex$1=arguments[0],posIndex=arguments[1],location$1=arguments[2];this.elt[geomIndex$1].setLocation(posIndex,location$1)}};Label.prototype.isEqualOnSide=function(lbl,side){return this.elt[0].isEqualOnSide(lbl.elt[0],side)&&this.elt[1].isEqualOnSide(lbl.elt[1],side)};Label.prototype.allPositionsEqual=function(geomIndex,loc){return this.elt[geomIndex].allPositionsEqual(loc)};Label.prototype.toLine=function(geomIndex){this.elt[geomIndex].isArea()&&(this.elt[geomIndex]=new TopologyLocation(this.elt[geomIndex].location[0]))};Label.prototype.interfaces_=function(){return[]};Label.prototype.getClass=function(){return Label};Label.toLineLabel=function(label){for(var lineLabel=new Label(Location.NONE),i=0;i<2;i++)lineLabel.setLocation(i,label.getLocation(i));return lineLabel};var EdgeRing$1=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new ArrayList,this._pts=new ArrayList,this._label=new Label(Location.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new ArrayList,this._geometryFactory=null;var start2=arguments[0],geometryFactory=arguments[1];this._geometryFactory=geometryFactory,this.computePoints(start2),this.computeRing()};EdgeRing$1.prototype.computeRing=function(){var this$1=this;if(this._ring!==null)return null;for(var coord=new Array(this._pts.size()).fill(null),i=0;i<this._pts.size();i++)coord[i]=this$1._pts.get(i);this._ring=this._geometryFactory.createLinearRing(coord),this._isHole=CGAlgorithms.isCCW(this._ring.getCoordinates())};EdgeRing$1.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};EdgeRing$1.prototype.computePoints=function(start2){var this$1=this;this._startDe=start2;var de=start2,isFirstEdge=!0;do{if(de===null)throw new TopologyException("Found null DirectedEdge");if(de.getEdgeRing()===this$1)throw new TopologyException("Directed Edge visited twice during ring-building at "+de.getCoordinate());this$1._edges.add(de);var label=de.getLabel();Assert.isTrue(label.isArea()),this$1.mergeLabel(label),this$1.addPoints(de.getEdge(),de.isForward(),isFirstEdge),isFirstEdge=!1,this$1.setEdgeRing(de,this$1),de=this$1.getNext(de)}while(de!==this._startDe)};EdgeRing$1.prototype.getLinearRing=function(){return this._ring};EdgeRing$1.prototype.getCoordinate=function(i){return this._pts.get(i)};EdgeRing$1.prototype.computeMaxNodeDegree=function(){var this$1=this;this._maxNodeDegree=0;var de=this._startDe;do{var node=de.getNode(),degree=node.getEdges().getOutgoingDegree(this$1);degree>this$1._maxNodeDegree&&(this$1._maxNodeDegree=degree),de=this$1.getNext(de)}while(de!==this._startDe);this._maxNodeDegree*=2};EdgeRing$1.prototype.addPoints=function(edge,isForward,isFirstEdge){var this$1=this,edgePts=edge.getCoordinates();if(isForward){var startIndex=1;isFirstEdge&&(startIndex=0);for(var i=startIndex;i<edgePts.length;i++)this$1._pts.add(edgePts[i])}else{var startIndex$1=edgePts.length-2;isFirstEdge&&(startIndex$1=edgePts.length-1);for(var i$1=startIndex$1;i$1>=0;i$1--)this$1._pts.add(edgePts[i$1])}};EdgeRing$1.prototype.isHole=function(){return this._isHole};EdgeRing$1.prototype.setInResult=function(){var de=this._startDe;do de.getEdge().setInResult(!0),de=de.getNext();while(de!==this._startDe)};EdgeRing$1.prototype.containsPoint=function(p){var shell=this.getLinearRing(),env=shell.getEnvelopeInternal();if(!env.contains(p)||!CGAlgorithms.isPointInRing(p,shell.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();){var hole=i.next();if(hole.containsPoint(p))return!1}return!0};EdgeRing$1.prototype.addHole=function(ring){this._holes.add(ring)};EdgeRing$1.prototype.isShell=function(){return this._shell===null};EdgeRing$1.prototype.getLabel=function(){return this._label};EdgeRing$1.prototype.getEdges=function(){return this._edges};EdgeRing$1.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};EdgeRing$1.prototype.getShell=function(){return this._shell};EdgeRing$1.prototype.mergeLabel=function(){if(arguments.length===1){var deLabel=arguments[0];this.mergeLabel(deLabel,0),this.mergeLabel(deLabel,1)}else if(arguments.length===2){var deLabel$1=arguments[0],geomIndex=arguments[1],loc=deLabel$1.getLocation(geomIndex,Position.RIGHT);if(loc===Location.NONE)return null;if(this._label.getLocation(geomIndex)===Location.NONE)return this._label.setLocation(geomIndex,loc),null}};EdgeRing$1.prototype.setShell=function(shell){this._shell=shell,shell!==null&&shell.addHole(this)};EdgeRing$1.prototype.toPolygon=function(geometryFactory){for(var this$1=this,holeLR=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)holeLR[i]=this$1._holes.get(i).getLinearRing();var poly=geometryFactory.createPolygon(this.getLinearRing(),holeLR);return poly};EdgeRing$1.prototype.interfaces_=function(){return[]};EdgeRing$1.prototype.getClass=function(){return EdgeRing$1};var MinimalEdgeRing=function(EdgeRing$$1){function MinimalEdgeRing2(){var start2=arguments[0],geometryFactory=arguments[1];EdgeRing$$1.call(this,start2,geometryFactory)}return EdgeRing$$1&&(MinimalEdgeRing2.__proto__=EdgeRing$$1),MinimalEdgeRing2.prototype=Object.create(EdgeRing$$1&&EdgeRing$$1.prototype),MinimalEdgeRing2.prototype.constructor=MinimalEdgeRing2,MinimalEdgeRing2.prototype.setEdgeRing=function(de,er){de.setMinEdgeRing(er)},MinimalEdgeRing2.prototype.getNext=function(de){return de.getNextMin()},MinimalEdgeRing2.prototype.interfaces_=function(){return[]},MinimalEdgeRing2.prototype.getClass=function(){return MinimalEdgeRing2},MinimalEdgeRing2}(EdgeRing$1),MaximalEdgeRing=function(EdgeRing$$1){function MaximalEdgeRing2(){var start2=arguments[0],geometryFactory=arguments[1];EdgeRing$$1.call(this,start2,geometryFactory)}return EdgeRing$$1&&(MaximalEdgeRing2.__proto__=EdgeRing$$1),MaximalEdgeRing2.prototype=Object.create(EdgeRing$$1&&EdgeRing$$1.prototype),MaximalEdgeRing2.prototype.constructor=MaximalEdgeRing2,MaximalEdgeRing2.prototype.buildMinimalRings=function(){var this$1=this,minEdgeRings=new ArrayList,de=this._startDe;do{if(de.getMinEdgeRing()===null){var minEr=new MinimalEdgeRing(de,this$1._geometryFactory);minEdgeRings.add(minEr)}de=de.getNext()}while(de!==this._startDe);return minEdgeRings},MaximalEdgeRing2.prototype.setEdgeRing=function(de,er){de.setEdgeRing(er)},MaximalEdgeRing2.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var this$1=this,de=this._startDe;do{var node=de.getNode();node.getEdges().linkMinimalDirectedEdges(this$1),de=de.getNext()}while(de!==this._startDe)},MaximalEdgeRing2.prototype.getNext=function(de){return de.getNext()},MaximalEdgeRing2.prototype.interfaces_=function(){return[]},MaximalEdgeRing2.prototype.getClass=function(){return MaximalEdgeRing2},MaximalEdgeRing2}(EdgeRing$1),GraphComponent=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var label=arguments[0];this._label=label}}};GraphComponent.prototype.setVisited=function(isVisited2){this._isVisited=isVisited2};GraphComponent.prototype.setInResult=function(isInResult2){this._isInResult=isInResult2};GraphComponent.prototype.isCovered=function(){return this._isCovered};GraphComponent.prototype.isCoveredSet=function(){return this._isCoveredSet};GraphComponent.prototype.setLabel=function(label){this._label=label};GraphComponent.prototype.getLabel=function(){return this._label};GraphComponent.prototype.setCovered=function(isCovered2){this._isCovered=isCovered2,this._isCoveredSet=!0};GraphComponent.prototype.updateIM=function(im){Assert.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(im)};GraphComponent.prototype.isInResult=function(){return this._isInResult};GraphComponent.prototype.isVisited=function(){return this._isVisited};GraphComponent.prototype.interfaces_=function(){return[]};GraphComponent.prototype.getClass=function(){return GraphComponent};var Node$2=function(GraphComponent$$1){function Node5(){GraphComponent$$1.call(this),this._coord=null,this._edges=null;var coord=arguments[0],edges2=arguments[1];this._coord=coord,this._edges=edges2,this._label=new Label(0,Location.NONE)}return GraphComponent$$1&&(Node5.__proto__=GraphComponent$$1),Node5.prototype=Object.create(GraphComponent$$1&&GraphComponent$$1.prototype),Node5.prototype.constructor=Node5,Node5.prototype.isIncidentEdgeInResult=function(){for(var it=this.getEdges().getEdges().iterator();it.hasNext();){var de=it.next();if(de.getEdge().isInResult())return!0}return!1},Node5.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},Node5.prototype.getCoordinate=function(){return this._coord},Node5.prototype.print=function(out){out.println("node "+this._coord+" lbl: "+this._label)},Node5.prototype.computeIM=function(im){},Node5.prototype.computeMergedLocation=function(label2,eltIndex){var loc=Location.NONE;if(loc=this._label.getLocation(eltIndex),!label2.isNull(eltIndex)){var nLoc=label2.getLocation(eltIndex);loc!==Location.BOUNDARY&&(loc=nLoc)}return loc},Node5.prototype.setLabel=function(){if(arguments.length===2){var argIndex=arguments[0],onLocation=arguments[1];this._label===null?this._label=new Label(argIndex,onLocation):this._label.setLocation(argIndex,onLocation)}else return GraphComponent$$1.prototype.setLabel.apply(this,arguments)},Node5.prototype.getEdges=function(){return this._edges},Node5.prototype.mergeLabel=function(){var this$1=this;if(arguments[0]instanceof Node5){var n=arguments[0];this.mergeLabel(n._label)}else if(arguments[0]instanceof Label)for(var label2=arguments[0],i=0;i<2;i++){var loc=this$1.computeMergedLocation(label2,i),thisLoc=this$1._label.getLocation(i);thisLoc===Location.NONE&&this$1._label.setLocation(i,loc)}},Node5.prototype.add=function(e){this._edges.insert(e),e.setNode(this)},Node5.prototype.setLabelBoundary=function(argIndex){if(this._label===null)return null;var loc=Location.NONE;this._label!==null&&(loc=this._label.getLocation(argIndex));var newLoc=null;switch(loc){case Location.BOUNDARY:newLoc=Location.INTERIOR;break;case Location.INTERIOR:newLoc=Location.BOUNDARY;break;default:newLoc=Location.BOUNDARY;break}this._label.setLocation(argIndex,newLoc)},Node5.prototype.interfaces_=function(){return[]},Node5.prototype.getClass=function(){return Node5},Node5}(GraphComponent),NodeMap=function(){this.nodeMap=new TreeMap,this.nodeFact=null;var nodeFact=arguments[0];this.nodeFact=nodeFact};NodeMap.prototype.find=function(coord){return this.nodeMap.get(coord)};NodeMap.prototype.addNode=function(){if(arguments[0]instanceof Coordinate){var coord=arguments[0],node=this.nodeMap.get(coord);return node===null&&(node=this.nodeFact.createNode(coord),this.nodeMap.put(coord,node)),node}else if(arguments[0]instanceof Node$2){var n=arguments[0],node$1=this.nodeMap.get(n.getCoordinate());return node$1===null?(this.nodeMap.put(n.getCoordinate(),n),n):(node$1.mergeLabel(n),node$1)}};NodeMap.prototype.print=function(out){for(var it=this.iterator();it.hasNext();){var n=it.next();n.print(out)}};NodeMap.prototype.iterator=function(){return this.nodeMap.values().iterator()};NodeMap.prototype.values=function(){return this.nodeMap.values()};NodeMap.prototype.getBoundaryNodes=function(geomIndex){for(var bdyNodes=new ArrayList,i=this.iterator();i.hasNext();){var node=i.next();node.getLabel().getLocation(geomIndex)===Location.BOUNDARY&&bdyNodes.add(node)}return bdyNodes};NodeMap.prototype.add=function(e){var p=e.getCoordinate(),n=this.addNode(p);n.add(e)};NodeMap.prototype.interfaces_=function(){return[]};NodeMap.prototype.getClass=function(){return NodeMap};var Quadrant=function(){},staticAccessors$21={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Quadrant.prototype.interfaces_=function(){return[]};Quadrant.prototype.getClass=function(){return Quadrant};Quadrant.isNorthern=function(quad){return quad===Quadrant.NE||quad===Quadrant.NW};Quadrant.isOpposite=function(quad1,quad2){if(quad1===quad2)return!1;var diff2=(quad1-quad2+4)%4;return diff2===2};Quadrant.commonHalfPlane=function(quad1,quad2){if(quad1===quad2)return quad1;var diff2=(quad1-quad2+4)%4;if(diff2===2)return-1;var min4=quad1<quad2?quad1:quad2,max3=quad1>quad2?quad1:quad2;return min4===0&&max3===3?3:min4};Quadrant.isInHalfPlane=function(quad,halfPlane){return halfPlane===Quadrant.SE?quad===Quadrant.SE||quad===Quadrant.SW:quad===halfPlane||quad===halfPlane+1};Quadrant.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var dx=arguments[0],dy=arguments[1];if(dx===0&&dy===0)throw new IllegalArgumentException("Cannot compute the quadrant for point ( "+dx+", "+dy+" )");return dx>=0?dy>=0?Quadrant.NE:Quadrant.SE:dy>=0?Quadrant.NW:Quadrant.SW}else if(arguments[0]instanceof Coordinate&&arguments[1]instanceof Coordinate){var p0=arguments[0],p1=arguments[1];if(p1.x===p0.x&&p1.y===p0.y)throw new IllegalArgumentException("Cannot compute the quadrant for two identical points "+p0);return p1.x>=p0.x?p1.y>=p0.y?Quadrant.NE:Quadrant.SE:p1.y>=p0.y?Quadrant.NW:Quadrant.SW}};staticAccessors$21.NE.get=function(){return 0};staticAccessors$21.NW.get=function(){return 1};staticAccessors$21.SW.get=function(){return 2};staticAccessors$21.SE.get=function(){return 3};Object.defineProperties(Quadrant,staticAccessors$21);var EdgeEnd=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var edge=arguments[0];this._edge=edge}else if(arguments.length===3){var edge$1=arguments[0],p0=arguments[1],p1=arguments[2],label=null;this._edge=edge$1,this.init(p0,p1),this._label=label}else if(arguments.length===4){var edge$2=arguments[0],p0$1=arguments[1],p1$1=arguments[2],label$1=arguments[3];this._edge=edge$2,this.init(p0$1,p1$1),this._label=label$1}};EdgeEnd.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:CGAlgorithms.computeOrientation(e._p0,e._p1,this._p1)};EdgeEnd.prototype.getDy=function(){return this._dy};EdgeEnd.prototype.getCoordinate=function(){return this._p0};EdgeEnd.prototype.setNode=function(node){this._node=node};EdgeEnd.prototype.print=function(out){var angle3=Math.atan2(this._dy,this._dx),className=this.getClass().getName(),lastDotPos=className.lastIndexOf("."),name=className.substring(lastDotPos+1);out.print("  "+name+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+angle3+"   "+this._label)};EdgeEnd.prototype.compareTo=function(obj){var e=obj;return this.compareDirection(e)};EdgeEnd.prototype.getDirectedCoordinate=function(){return this._p1};EdgeEnd.prototype.getDx=function(){return this._dx};EdgeEnd.prototype.getLabel=function(){return this._label};EdgeEnd.prototype.getEdge=function(){return this._edge};EdgeEnd.prototype.getQuadrant=function(){return this._quadrant};EdgeEnd.prototype.getNode=function(){return this._node};EdgeEnd.prototype.toString=function(){var angle3=Math.atan2(this._dy,this._dx),className=this.getClass().getName(),lastDotPos=className.lastIndexOf("."),name=className.substring(lastDotPos+1);return"  "+name+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+angle3+"   "+this._label};EdgeEnd.prototype.computeLabel=function(boundaryNodeRule){};EdgeEnd.prototype.init=function(p0,p1){this._p0=p0,this._p1=p1,this._dx=p1.x-p0.x,this._dy=p1.y-p0.y,this._quadrant=Quadrant.quadrant(this._dx,this._dy),Assert.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};EdgeEnd.prototype.interfaces_=function(){return[Comparable]};EdgeEnd.prototype.getClass=function(){return EdgeEnd};var DirectedEdge=function(EdgeEnd$$1){function DirectedEdge2(){var edge=arguments[0],isForward=arguments[1];if(EdgeEnd$$1.call(this,edge),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=isForward,isForward)this.init(edge.getCoordinate(0),edge.getCoordinate(1));else{var n=edge.getNumPoints()-1;this.init(edge.getCoordinate(n),edge.getCoordinate(n-1))}this.computeDirectedLabel()}return EdgeEnd$$1&&(DirectedEdge2.__proto__=EdgeEnd$$1),DirectedEdge2.prototype=Object.create(EdgeEnd$$1&&EdgeEnd$$1.prototype),DirectedEdge2.prototype.constructor=DirectedEdge2,DirectedEdge2.prototype.getNextMin=function(){return this._nextMin},DirectedEdge2.prototype.getDepth=function(position){return this._depth[position]},DirectedEdge2.prototype.setVisited=function(isVisited2){this._isVisited=isVisited2},DirectedEdge2.prototype.computeDirectedLabel=function(){this._label=new Label(this._edge.getLabel()),this._isForward||this._label.flip()},DirectedEdge2.prototype.getNext=function(){return this._next},DirectedEdge2.prototype.setDepth=function(position,depthVal){if(this._depth[position]!==-999&&this._depth[position]!==depthVal)throw new TopologyException("assigned depths do not match",this.getCoordinate());this._depth[position]=depthVal},DirectedEdge2.prototype.isInteriorAreaEdge=function(){for(var this$1=this,isInteriorAreaEdge2=!0,i=0;i<2;i++)this$1._label.isArea(i)&&this$1._label.getLocation(i,Position.LEFT)===Location.INTERIOR&&this$1._label.getLocation(i,Position.RIGHT)===Location.INTERIOR||(isInteriorAreaEdge2=!1);return isInteriorAreaEdge2},DirectedEdge2.prototype.setNextMin=function(nextMin){this._nextMin=nextMin},DirectedEdge2.prototype.print=function(out){EdgeEnd$$1.prototype.print.call(this,out),out.print(" "+this._depth[Position.LEFT]+"/"+this._depth[Position.RIGHT]),out.print(" ("+this.getDepthDelta()+")"),this._isInResult&&out.print(" inResult")},DirectedEdge2.prototype.setMinEdgeRing=function(minEdgeRing){this._minEdgeRing=minEdgeRing},DirectedEdge2.prototype.isLineEdge=function(){var isLine3=this._label.isLine(0)||this._label.isLine(1),isExteriorIfArea0=!this._label.isArea(0)||this._label.allPositionsEqual(0,Location.EXTERIOR),isExteriorIfArea1=!this._label.isArea(1)||this._label.allPositionsEqual(1,Location.EXTERIOR);return isLine3&&isExteriorIfArea0&&isExteriorIfArea1},DirectedEdge2.prototype.setEdgeRing=function(edgeRing){this._edgeRing=edgeRing},DirectedEdge2.prototype.getMinEdgeRing=function(){return this._minEdgeRing},DirectedEdge2.prototype.getDepthDelta=function(){var depthDelta2=this._edge.getDepthDelta();return this._isForward||(depthDelta2=-depthDelta2),depthDelta2},DirectedEdge2.prototype.setInResult=function(isInResult2){this._isInResult=isInResult2},DirectedEdge2.prototype.getSym=function(){return this._sym},DirectedEdge2.prototype.isForward=function(){return this._isForward},DirectedEdge2.prototype.getEdge=function(){return this._edge},DirectedEdge2.prototype.printEdge=function(out){this.print(out),out.print(" "),this._isForward?this._edge.print(out):this._edge.printReverse(out)},DirectedEdge2.prototype.setSym=function(de){this._sym=de},DirectedEdge2.prototype.setVisitedEdge=function(isVisited2){this.setVisited(isVisited2),this._sym.setVisited(isVisited2)},DirectedEdge2.prototype.setEdgeDepths=function(position,depth2){var depthDelta2=this.getEdge().getDepthDelta();this._isForward||(depthDelta2=-depthDelta2);var directionFactor=1;position===Position.LEFT&&(directionFactor=-1);var oppositePos=Position.opposite(position),delta2=depthDelta2*directionFactor,oppositeDepth=depth2+delta2;this.setDepth(position,depth2),this.setDepth(oppositePos,oppositeDepth)},DirectedEdge2.prototype.getEdgeRing=function(){return this._edgeRing},DirectedEdge2.prototype.isInResult=function(){return this._isInResult},DirectedEdge2.prototype.setNext=function(next3){this._next=next3},DirectedEdge2.prototype.isVisited=function(){return this._isVisited},DirectedEdge2.prototype.interfaces_=function(){return[]},DirectedEdge2.prototype.getClass=function(){return DirectedEdge2},DirectedEdge2.depthFactor=function(currLocation,nextLocation){return currLocation===Location.EXTERIOR&&nextLocation===Location.INTERIOR?1:currLocation===Location.INTERIOR&&nextLocation===Location.EXTERIOR?-1:0},DirectedEdge2}(EdgeEnd),NodeFactory=function(){};NodeFactory.prototype.createNode=function(coord){return new Node$2(coord,null)};NodeFactory.prototype.interfaces_=function(){return[]};NodeFactory.prototype.getClass=function(){return NodeFactory};var PlanarGraph=function(){if(this._edges=new ArrayList,this._nodes=null,this._edgeEndList=new ArrayList,arguments.length===0)this._nodes=new NodeMap(new NodeFactory);else if(arguments.length===1){var nodeFact=arguments[0];this._nodes=new NodeMap(nodeFact)}};PlanarGraph.prototype.printEdges=function(out){var this$1=this;out.println("Edges:");for(var i=0;i<this._edges.size();i++){out.println("edge "+i+":");var e=this$1._edges.get(i);e.print(out),e.eiList.print(out)}};PlanarGraph.prototype.find=function(coord){return this._nodes.find(coord)};PlanarGraph.prototype.addNode=function(){if(arguments[0]instanceof Node$2){var node=arguments[0];return this._nodes.addNode(node)}else if(arguments[0]instanceof Coordinate){var coord=arguments[0];return this._nodes.addNode(coord)}};PlanarGraph.prototype.getNodeIterator=function(){return this._nodes.iterator()};PlanarGraph.prototype.linkResultDirectedEdges=function(){for(var nodeit=this._nodes.iterator();nodeit.hasNext();){var node=nodeit.next();node.getEdges().linkResultDirectedEdges()}};PlanarGraph.prototype.debugPrintln=function(o){System.out.println(o)};PlanarGraph.prototype.isBoundaryNode=function(geomIndex,coord){var node=this._nodes.find(coord);if(node===null)return!1;var label=node.getLabel();return label!==null&&label.getLocation(geomIndex)===Location.BOUNDARY};PlanarGraph.prototype.linkAllDirectedEdges=function(){for(var nodeit=this._nodes.iterator();nodeit.hasNext();){var node=nodeit.next();node.getEdges().linkAllDirectedEdges()}};PlanarGraph.prototype.matchInSameDirection=function(p0,p1,ep0,ep1){return p0.equals(ep0)?CGAlgorithms.computeOrientation(p0,p1,ep1)===CGAlgorithms.COLLINEAR&&Quadrant.quadrant(p0,p1)===Quadrant.quadrant(ep0,ep1):!1};PlanarGraph.prototype.getEdgeEnds=function(){return this._edgeEndList};PlanarGraph.prototype.debugPrint=function(o){System.out.print(o)};PlanarGraph.prototype.getEdgeIterator=function(){return this._edges.iterator()};PlanarGraph.prototype.findEdgeInSameDirection=function(p0,p1){for(var this$1=this,i=0;i<this._edges.size();i++){var e=this$1._edges.get(i),eCoord=e.getCoordinates();if(this$1.matchInSameDirection(p0,p1,eCoord[0],eCoord[1])||this$1.matchInSameDirection(p0,p1,eCoord[eCoord.length-1],eCoord[eCoord.length-2]))return e}return null};PlanarGraph.prototype.insertEdge=function(e){this._edges.add(e)};PlanarGraph.prototype.findEdgeEnd=function(e){for(var i=this.getEdgeEnds().iterator();i.hasNext();){var ee=i.next();if(ee.getEdge()===e)return ee}return null};PlanarGraph.prototype.addEdges=function(edgesToAdd){for(var this$1=this,it=edgesToAdd.iterator();it.hasNext();){var e=it.next();this$1._edges.add(e);var de1=new DirectedEdge(e,!0),de2=new DirectedEdge(e,!1);de1.setSym(de2),de2.setSym(de1),this$1.add(de1),this$1.add(de2)}};PlanarGraph.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};PlanarGraph.prototype.getNodes=function(){return this._nodes.values()};PlanarGraph.prototype.findEdge=function(p0,p1){for(var this$1=this,i=0;i<this._edges.size();i++){var e=this$1._edges.get(i),eCoord=e.getCoordinates();if(p0.equals(eCoord[0])&&p1.equals(eCoord[1]))return e}return null};PlanarGraph.prototype.interfaces_=function(){return[]};PlanarGraph.prototype.getClass=function(){return PlanarGraph};PlanarGraph.linkResultDirectedEdges=function(nodes){for(var nodeit=nodes.iterator();nodeit.hasNext();){var node=nodeit.next();node.getEdges().linkResultDirectedEdges()}};var PolygonBuilder=function(){this._geometryFactory=null,this._shellList=new ArrayList;var geometryFactory=arguments[0];this._geometryFactory=geometryFactory};PolygonBuilder.prototype.sortShellsAndHoles=function(edgeRings,shellList,freeHoleList){for(var it=edgeRings.iterator();it.hasNext();){var er=it.next();er.isHole()?freeHoleList.add(er):shellList.add(er)}};PolygonBuilder.prototype.computePolygons=function(shellList){for(var this$1=this,resultPolyList=new ArrayList,it=shellList.iterator();it.hasNext();){var er=it.next(),poly=er.toPolygon(this$1._geometryFactory);resultPolyList.add(poly)}return resultPolyList};PolygonBuilder.prototype.placeFreeHoles=function(shellList,freeHoleList){for(var this$1=this,it=freeHoleList.iterator();it.hasNext();){var hole=it.next();if(hole.getShell()===null){var shell=this$1.findEdgeRingContaining(hole,shellList);if(shell===null)throw new TopologyException("unable to assign hole to a shell",hole.getCoordinate(0));hole.setShell(shell)}}};PolygonBuilder.prototype.buildMinimalEdgeRings=function(maxEdgeRings,shellList,freeHoleList){for(var this$1=this,edgeRings=new ArrayList,it=maxEdgeRings.iterator();it.hasNext();){var er=it.next();if(er.getMaxNodeDegree()>2){er.linkDirectedEdgesForMinimalEdgeRings();var minEdgeRings=er.buildMinimalRings(),shell=this$1.findShell(minEdgeRings);shell!==null?(this$1.placePolygonHoles(shell,minEdgeRings),shellList.add(shell)):freeHoleList.addAll(minEdgeRings)}else edgeRings.add(er)}return edgeRings};PolygonBuilder.prototype.containsPoint=function(p){for(var it=this._shellList.iterator();it.hasNext();){var er=it.next();if(er.containsPoint(p))return!0}return!1};PolygonBuilder.prototype.buildMaximalEdgeRings=function(dirEdges){for(var this$1=this,maxEdgeRings=new ArrayList,it=dirEdges.iterator();it.hasNext();){var de=it.next();if(de.isInResult()&&de.getLabel().isArea()&&de.getEdgeRing()===null){var er=new MaximalEdgeRing(de,this$1._geometryFactory);maxEdgeRings.add(er),er.setInResult()}}return maxEdgeRings};PolygonBuilder.prototype.placePolygonHoles=function(shell,minEdgeRings){for(var it=minEdgeRings.iterator();it.hasNext();){var er=it.next();er.isHole()&&er.setShell(shell)}};PolygonBuilder.prototype.getPolygons=function(){var resultPolyList=this.computePolygons(this._shellList);return resultPolyList};PolygonBuilder.prototype.findEdgeRingContaining=function(testEr,shellList){for(var testRing=testEr.getLinearRing(),testEnv=testRing.getEnvelopeInternal(),testPt=testRing.getCoordinateN(0),minShell=null,minEnv=null,it=shellList.iterator();it.hasNext();){var tryShell=it.next(),tryRing=tryShell.getLinearRing(),tryEnv=tryRing.getEnvelopeInternal();minShell!==null&&(minEnv=minShell.getLinearRing().getEnvelopeInternal());var isContained=!1;tryEnv.contains(testEnv)&&CGAlgorithms.isPointInRing(testPt,tryRing.getCoordinates())&&(isContained=!0),isContained&&(minShell===null||minEnv.contains(tryEnv))&&(minShell=tryShell)}return minShell};PolygonBuilder.prototype.findShell=function(minEdgeRings){for(var shellCount=0,shell=null,it=minEdgeRings.iterator();it.hasNext();){var er=it.next();er.isHole()||(shell=er,shellCount++)}return Assert.isTrue(shellCount<=1,"found two shells in MinimalEdgeRing list"),shell};PolygonBuilder.prototype.add=function(){if(arguments.length===1){var graph=arguments[0];this.add(graph.getEdgeEnds(),graph.getNodes())}else if(arguments.length===2){var dirEdges=arguments[0],nodes=arguments[1];PlanarGraph.linkResultDirectedEdges(nodes);var maxEdgeRings=this.buildMaximalEdgeRings(dirEdges),freeHoleList=new ArrayList,edgeRings=this.buildMinimalEdgeRings(maxEdgeRings,this._shellList,freeHoleList);this.sortShellsAndHoles(edgeRings,this._shellList,freeHoleList),this.placeFreeHoles(this._shellList,freeHoleList)}};PolygonBuilder.prototype.interfaces_=function(){return[]};PolygonBuilder.prototype.getClass=function(){return PolygonBuilder};var Boundable=function(){};Boundable.prototype.getBounds=function(){};Boundable.prototype.interfaces_=function(){return[]};Boundable.prototype.getClass=function(){return Boundable};var ItemBoundable=function(){this._bounds=null,this._item=null;var bounds2=arguments[0],item=arguments[1];this._bounds=bounds2,this._item=item};ItemBoundable.prototype.getItem=function(){return this._item};ItemBoundable.prototype.getBounds=function(){return this._bounds};ItemBoundable.prototype.interfaces_=function(){return[Boundable,Serializable]};ItemBoundable.prototype.getClass=function(){return ItemBoundable};var PriorityQueue=function(){this._size=null,this._items=null,this._size=0,this._items=new ArrayList,this._items.add(null)};PriorityQueue.prototype.poll=function(){if(this.isEmpty())return null;var minItem=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),minItem};PriorityQueue.prototype.size=function(){return this._size};PriorityQueue.prototype.reorder=function(hole){for(var this$1=this,child=null,tmp=this._items.get(hole);hole*2<=this._size&&(child=hole*2,child!==this$1._size&&this$1._items.get(child+1).compareTo(this$1._items.get(child))<0&&child++,this$1._items.get(child).compareTo(tmp)<0);hole=child)this$1._items.set(hole,this$1._items.get(child));this._items.set(hole,tmp)};PriorityQueue.prototype.clear=function(){this._size=0,this._items.clear()};PriorityQueue.prototype.isEmpty=function(){return this._size===0};PriorityQueue.prototype.add=function(x2){var this$1=this;this._items.add(null),this._size+=1;var hole=this._size;for(this._items.set(0,x2);x2.compareTo(this._items.get(Math.trunc(hole/2)))<0;hole/=2)this$1._items.set(hole,this$1._items.get(Math.trunc(hole/2)));this._items.set(hole,x2)};PriorityQueue.prototype.interfaces_=function(){return[]};PriorityQueue.prototype.getClass=function(){return PriorityQueue};var ItemVisitor=function(){};ItemVisitor.prototype.visitItem=function(item){};ItemVisitor.prototype.interfaces_=function(){return[]};ItemVisitor.prototype.getClass=function(){return ItemVisitor};var SpatialIndex=function(){};SpatialIndex.prototype.insert=function(itemEnv,item){};SpatialIndex.prototype.remove=function(itemEnv,item){};SpatialIndex.prototype.query=function(){};SpatialIndex.prototype.interfaces_=function(){return[]};SpatialIndex.prototype.getClass=function(){return SpatialIndex};var AbstractNode=function(){if(this._childBoundables=new ArrayList,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var level=arguments[0];this._level=level}}},staticAccessors$22={serialVersionUID:{configurable:!0}};AbstractNode.prototype.getLevel=function(){return this._level};AbstractNode.prototype.size=function(){return this._childBoundables.size()};AbstractNode.prototype.getChildBoundables=function(){return this._childBoundables};AbstractNode.prototype.addChildBoundable=function(childBoundable){Assert.isTrue(this._bounds===null),this._childBoundables.add(childBoundable)};AbstractNode.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};AbstractNode.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};AbstractNode.prototype.interfaces_=function(){return[Boundable,Serializable]};AbstractNode.prototype.getClass=function(){return AbstractNode};staticAccessors$22.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(AbstractNode,staticAccessors$22);var Collections=function(){};Collections.reverseOrder=function(){return{compare:function(a,b){return b.compareTo(a)}}};Collections.min=function(l){return Collections.sort(l),l.get(0)};Collections.sort=function(l,c){var a=l.toArray();c?Arrays.sort(a,c):Arrays.sort(a);for(var i=l.iterator(),pos=0,alen=a.length;pos<alen;pos++)i.next(),i.set(a[pos])};Collections.singletonList=function(o){var arrayList=new ArrayList;return arrayList.add(o),arrayList};var BoundablePair=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var boundable1=arguments[0],boundable2=arguments[1],itemDistance=arguments[2];this._boundable1=boundable1,this._boundable2=boundable2,this._itemDistance=itemDistance,this._distance=this.distance()};BoundablePair.prototype.expandToQueue=function(priQ,minDistance){var isComp1=BoundablePair.isComposite(this._boundable1),isComp2=BoundablePair.isComposite(this._boundable2);if(isComp1&&isComp2)return BoundablePair.area(this._boundable1)>BoundablePair.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,priQ,minDistance),null):(this.expand(this._boundable2,this._boundable1,priQ,minDistance),null);if(isComp1)return this.expand(this._boundable1,this._boundable2,priQ,minDistance),null;if(isComp2)return this.expand(this._boundable2,this._boundable1,priQ,minDistance),null;throw new IllegalArgumentException("neither boundable is composite")};BoundablePair.prototype.isLeaves=function(){return!(BoundablePair.isComposite(this._boundable1)||BoundablePair.isComposite(this._boundable2))};BoundablePair.prototype.compareTo=function(o){var nd=o;return this._distance<nd._distance?-1:this._distance>nd._distance?1:0};BoundablePair.prototype.expand=function(bndComposite,bndOther,priQ,minDistance){for(var this$1=this,children=bndComposite.getChildBoundables(),i=children.iterator();i.hasNext();){var child=i.next(),bp=new BoundablePair(child,bndOther,this$1._itemDistance);bp.getDistance()<minDistance&&priQ.add(bp)}};BoundablePair.prototype.getBoundable=function(i){return i===0?this._boundable1:this._boundable2};BoundablePair.prototype.getDistance=function(){return this._distance};BoundablePair.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};BoundablePair.prototype.interfaces_=function(){return[Comparable]};BoundablePair.prototype.getClass=function(){return BoundablePair};BoundablePair.area=function(b){return b.getBounds().getArea()};BoundablePair.isComposite=function(item){return item instanceof AbstractNode};var AbstractSTRtree=function AbstractSTRtree2(){if(this._root=null,this._built=!1,this._itemBoundables=new ArrayList,this._nodeCapacity=null,arguments.length===0){var nodeCapacity=AbstractSTRtree2.DEFAULT_NODE_CAPACITY;this._nodeCapacity=nodeCapacity}else if(arguments.length===1){var nodeCapacity$1=arguments[0];Assert.isTrue(nodeCapacity$1>1,"Node capacity must be greater than 1"),this._nodeCapacity=nodeCapacity$1}},staticAccessors$23={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};AbstractSTRtree.prototype.getNodeCapacity=function(){return this._nodeCapacity};AbstractSTRtree.prototype.lastNode=function(nodes){return nodes.get(nodes.size()-1)};AbstractSTRtree.prototype.size=function(){var this$1=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var node=arguments[0],size11=0,i=node.getChildBoundables().iterator();i.hasNext();){var childBoundable=i.next();childBoundable instanceof AbstractNode?size11+=this$1.size(childBoundable):childBoundable instanceof ItemBoundable&&(size11+=1)}return size11}};AbstractSTRtree.prototype.removeItem=function(node,item){for(var childToRemove=null,i=node.getChildBoundables().iterator();i.hasNext();){var childBoundable=i.next();childBoundable instanceof ItemBoundable&&childBoundable.getItem()===item&&(childToRemove=childBoundable)}return childToRemove!==null?(node.getChildBoundables().remove(childToRemove),!0):!1};AbstractSTRtree.prototype.itemsTree=function(){var this$1=this;if(arguments.length===0){this.build();var valuesTree=this.itemsTree(this._root);return valuesTree===null?new ArrayList:valuesTree}else if(arguments.length===1){for(var node=arguments[0],valuesTreeForNode=new ArrayList,i=node.getChildBoundables().iterator();i.hasNext();){var childBoundable=i.next();if(childBoundable instanceof AbstractNode){var valuesTreeForChild=this$1.itemsTree(childBoundable);valuesTreeForChild!==null&&valuesTreeForNode.add(valuesTreeForChild)}else childBoundable instanceof ItemBoundable?valuesTreeForNode.add(childBoundable.getItem()):Assert.shouldNeverReachHere()}return valuesTreeForNode.size()<=0?null:valuesTreeForNode}};AbstractSTRtree.prototype.insert=function(bounds2,item){Assert.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new ItemBoundable(bounds2,item))};AbstractSTRtree.prototype.boundablesAtLevel=function(){var this$1=this;if(arguments.length===1){var level=arguments[0],boundables=new ArrayList;return this.boundablesAtLevel(level,this._root,boundables),boundables}else if(arguments.length===3){var level$1=arguments[0],top=arguments[1],boundables$1=arguments[2];if(Assert.isTrue(level$1>-2),top.getLevel()===level$1)return boundables$1.add(top),null;for(var i=top.getChildBoundables().iterator();i.hasNext();){var boundable=i.next();boundable instanceof AbstractNode?this$1.boundablesAtLevel(level$1,boundable,boundables$1):(Assert.isTrue(boundable instanceof ItemBoundable),level$1===-1&&boundables$1.add(boundable))}return null}};AbstractSTRtree.prototype.query=function(){var this$1=this;if(arguments.length===1){var searchBounds=arguments[0];this.build();var matches=new ArrayList;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),searchBounds)&&this.query(searchBounds,this._root,matches),matches}else if(arguments.length===2){var searchBounds$1=arguments[0],visitor=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),searchBounds$1)&&this.query(searchBounds$1,this._root,visitor)}else if(arguments.length===3){if(hasInterface(arguments[2],ItemVisitor)&&arguments[0]instanceof Object&&arguments[1]instanceof AbstractNode)for(var searchBounds$2=arguments[0],node=arguments[1],visitor$1=arguments[2],childBoundables=node.getChildBoundables(),i=0;i<childBoundables.size();i++){var childBoundable=childBoundables.get(i);!this$1.getIntersectsOp().intersects(childBoundable.getBounds(),searchBounds$2)||(childBoundable instanceof AbstractNode?this$1.query(searchBounds$2,childBoundable,visitor$1):childBoundable instanceof ItemBoundable?visitor$1.visitItem(childBoundable.getItem()):Assert.shouldNeverReachHere())}else if(hasInterface(arguments[2],List)&&arguments[0]instanceof Object&&arguments[1]instanceof AbstractNode)for(var searchBounds$3=arguments[0],node$1=arguments[1],matches$1=arguments[2],childBoundables$1=node$1.getChildBoundables(),i$1=0;i$1<childBoundables$1.size();i$1++){var childBoundable$1=childBoundables$1.get(i$1);!this$1.getIntersectsOp().intersects(childBoundable$1.getBounds(),searchBounds$3)||(childBoundable$1 instanceof AbstractNode?this$1.query(searchBounds$3,childBoundable$1,matches$1):childBoundable$1 instanceof ItemBoundable?matches$1.add(childBoundable$1.getItem()):Assert.shouldNeverReachHere())}}};AbstractSTRtree.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};AbstractSTRtree.prototype.getRoot=function(){return this.build(),this._root};AbstractSTRtree.prototype.remove=function(){var this$1=this;if(arguments.length===2){var searchBounds=arguments[0],item=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),searchBounds)?this.remove(searchBounds,this._root,item):!1}else if(arguments.length===3){var searchBounds$1=arguments[0],node=arguments[1],item$1=arguments[2],found=this.removeItem(node,item$1);if(found)return!0;for(var childToPrune=null,i=node.getChildBoundables().iterator();i.hasNext();){var childBoundable=i.next();if(!!this$1.getIntersectsOp().intersects(childBoundable.getBounds(),searchBounds$1)&&childBoundable instanceof AbstractNode&&(found=this$1.remove(searchBounds$1,childBoundable,item$1),found)){childToPrune=childBoundable;break}}return childToPrune!==null&&childToPrune.getChildBoundables().isEmpty()&&node.getChildBoundables().remove(childToPrune),found}};AbstractSTRtree.prototype.createHigherLevels=function(boundablesOfALevel,level){Assert.isTrue(!boundablesOfALevel.isEmpty());var parentBoundables=this.createParentBoundables(boundablesOfALevel,level+1);return parentBoundables.size()===1?parentBoundables.get(0):this.createHigherLevels(parentBoundables,level+1)};AbstractSTRtree.prototype.depth=function(){var this$1=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var node=arguments[0],maxChildDepth=0,i=node.getChildBoundables().iterator();i.hasNext();){var childBoundable=i.next();if(childBoundable instanceof AbstractNode){var childDepth=this$1.depth(childBoundable);childDepth>maxChildDepth&&(maxChildDepth=childDepth)}}return maxChildDepth+1}};AbstractSTRtree.prototype.createParentBoundables=function(childBoundables,newLevel){var this$1=this;Assert.isTrue(!childBoundables.isEmpty());var parentBoundables=new ArrayList;parentBoundables.add(this.createNode(newLevel));var sortedChildBoundables=new ArrayList(childBoundables);Collections.sort(sortedChildBoundables,this.getComparator());for(var i=sortedChildBoundables.iterator();i.hasNext();){var childBoundable=i.next();this$1.lastNode(parentBoundables).getChildBoundables().size()===this$1.getNodeCapacity()&&parentBoundables.add(this$1.createNode(newLevel)),this$1.lastNode(parentBoundables).addChildBoundable(childBoundable)}return parentBoundables};AbstractSTRtree.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};AbstractSTRtree.prototype.interfaces_=function(){return[Serializable]};AbstractSTRtree.prototype.getClass=function(){return AbstractSTRtree};AbstractSTRtree.compareDoubles=function(a,b){return a>b?1:a<b?-1:0};staticAccessors$23.IntersectsOp.get=function(){return IntersectsOp};staticAccessors$23.serialVersionUID.get=function(){return-3886435814360241e3};staticAccessors$23.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(AbstractSTRtree,staticAccessors$23);var IntersectsOp=function(){},ItemDistance=function(){};ItemDistance.prototype.distance=function(item1,item2){};ItemDistance.prototype.interfaces_=function(){return[]};ItemDistance.prototype.getClass=function(){return ItemDistance};var STRtree=function(AbstractSTRtree$$1){function STRtree2(nodeCapacity){nodeCapacity=nodeCapacity||STRtree2.DEFAULT_NODE_CAPACITY,AbstractSTRtree$$1.call(this,nodeCapacity)}AbstractSTRtree$$1&&(STRtree2.__proto__=AbstractSTRtree$$1),STRtree2.prototype=Object.create(AbstractSTRtree$$1&&AbstractSTRtree$$1.prototype),STRtree2.prototype.constructor=STRtree2;var staticAccessors2={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return STRtree2.prototype.createParentBoundablesFromVerticalSlices=function(verticalSlices,newLevel){var this$1=this;Assert.isTrue(verticalSlices.length>0);for(var parentBoundables=new ArrayList,i=0;i<verticalSlices.length;i++)parentBoundables.addAll(this$1.createParentBoundablesFromVerticalSlice(verticalSlices[i],newLevel));return parentBoundables},STRtree2.prototype.createNode=function(level){return new STRtreeNode(level)},STRtree2.prototype.size=function(){return arguments.length===0?AbstractSTRtree$$1.prototype.size.call(this):AbstractSTRtree$$1.prototype.size.apply(this,arguments)},STRtree2.prototype.insert=function(){if(arguments.length===2){var itemEnv=arguments[0],item=arguments[1];if(itemEnv.isNull())return null;AbstractSTRtree$$1.prototype.insert.call(this,itemEnv,item)}else return AbstractSTRtree$$1.prototype.insert.apply(this,arguments)},STRtree2.prototype.getIntersectsOp=function(){return STRtree2.intersectsOp},STRtree2.prototype.verticalSlices=function(childBoundables,sliceCount){for(var sliceCapacity=Math.trunc(Math.ceil(childBoundables.size()/sliceCount)),slices=new Array(sliceCount).fill(null),i=childBoundables.iterator(),j=0;j<sliceCount;j++){slices[j]=new ArrayList;for(var boundablesAddedToSlice=0;i.hasNext()&&boundablesAddedToSlice<sliceCapacity;){var childBoundable=i.next();slices[j].add(childBoundable),boundablesAddedToSlice++}}return slices},STRtree2.prototype.query=function(){if(arguments.length===1){var searchEnv=arguments[0];return AbstractSTRtree$$1.prototype.query.call(this,searchEnv)}else if(arguments.length===2){var searchEnv$1=arguments[0],visitor=arguments[1];AbstractSTRtree$$1.prototype.query.call(this,searchEnv$1,visitor)}else if(arguments.length===3){if(hasInterface(arguments[2],ItemVisitor)&&arguments[0]instanceof Object&&arguments[1]instanceof AbstractNode){var searchBounds=arguments[0],node=arguments[1],visitor$1=arguments[2];AbstractSTRtree$$1.prototype.query.call(this,searchBounds,node,visitor$1)}else if(hasInterface(arguments[2],List)&&arguments[0]instanceof Object&&arguments[1]instanceof AbstractNode){var searchBounds$1=arguments[0],node$1=arguments[1],matches=arguments[2];AbstractSTRtree$$1.prototype.query.call(this,searchBounds$1,node$1,matches)}}},STRtree2.prototype.getComparator=function(){return STRtree2.yComparator},STRtree2.prototype.createParentBoundablesFromVerticalSlice=function(childBoundables,newLevel){return AbstractSTRtree$$1.prototype.createParentBoundables.call(this,childBoundables,newLevel)},STRtree2.prototype.remove=function(){if(arguments.length===2){var itemEnv=arguments[0],item=arguments[1];return AbstractSTRtree$$1.prototype.remove.call(this,itemEnv,item)}else return AbstractSTRtree$$1.prototype.remove.apply(this,arguments)},STRtree2.prototype.depth=function(){return arguments.length===0?AbstractSTRtree$$1.prototype.depth.call(this):AbstractSTRtree$$1.prototype.depth.apply(this,arguments)},STRtree2.prototype.createParentBoundables=function(childBoundables,newLevel){Assert.isTrue(!childBoundables.isEmpty());var minLeafCount=Math.trunc(Math.ceil(childBoundables.size()/this.getNodeCapacity())),sortedChildBoundables=new ArrayList(childBoundables);Collections.sort(sortedChildBoundables,STRtree2.xComparator);var verticalSlices=this.verticalSlices(sortedChildBoundables,Math.trunc(Math.ceil(Math.sqrt(minLeafCount))));return this.createParentBoundablesFromVerticalSlices(verticalSlices,newLevel)},STRtree2.prototype.nearestNeighbour=function(){if(arguments.length===1){if(hasInterface(arguments[0],ItemDistance)){var itemDist=arguments[0],bp=new BoundablePair(this.getRoot(),this.getRoot(),itemDist);return this.nearestNeighbour(bp)}else if(arguments[0]instanceof BoundablePair){var initBndPair=arguments[0];return this.nearestNeighbour(initBndPair,Double.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof STRtree2&&hasInterface(arguments[1],ItemDistance)){var tree=arguments[0],itemDist$1=arguments[1],bp$1=new BoundablePair(this.getRoot(),tree.getRoot(),itemDist$1);return this.nearestNeighbour(bp$1)}else if(arguments[0]instanceof BoundablePair&&typeof arguments[1]=="number"){var initBndPair$1=arguments[0],maxDistance=arguments[1],distanceLowerBound=maxDistance,minPair=null,priQ=new PriorityQueue;for(priQ.add(initBndPair$1);!priQ.isEmpty()&&distanceLowerBound>0;){var bndPair=priQ.poll(),currentDistance=bndPair.getDistance();if(currentDistance>=distanceLowerBound)break;bndPair.isLeaves()?(distanceLowerBound=currentDistance,minPair=bndPair):bndPair.expandToQueue(priQ,distanceLowerBound)}return[minPair.getBoundable(0).getItem(),minPair.getBoundable(1).getItem()]}}else if(arguments.length===3){var env=arguments[0],item=arguments[1],itemDist$2=arguments[2],bnd=new ItemBoundable(env,item),bp$2=new BoundablePair(this.getRoot(),bnd,itemDist$2);return this.nearestNeighbour(bp$2)[0]}},STRtree2.prototype.interfaces_=function(){return[SpatialIndex,Serializable]},STRtree2.prototype.getClass=function(){return STRtree2},STRtree2.centreX=function(e){return STRtree2.avg(e.getMinX(),e.getMaxX())},STRtree2.avg=function(a,b){return(a+b)/2},STRtree2.centreY=function(e){return STRtree2.avg(e.getMinY(),e.getMaxY())},staticAccessors2.STRtreeNode.get=function(){return STRtreeNode},staticAccessors2.serialVersionUID.get=function(){return 0x39920f7d5f261e0},staticAccessors2.xComparator.get=function(){return{interfaces_:function(){return[Comparator]},compare:function(o1,o2){return AbstractSTRtree$$1.compareDoubles(STRtree2.centreX(o1.getBounds()),STRtree2.centreX(o2.getBounds()))}}},staticAccessors2.yComparator.get=function(){return{interfaces_:function(){return[Comparator]},compare:function(o1,o2){return AbstractSTRtree$$1.compareDoubles(STRtree2.centreY(o1.getBounds()),STRtree2.centreY(o2.getBounds()))}}},staticAccessors2.intersectsOp.get=function(){return{interfaces_:function(){return[AbstractSTRtree$$1.IntersectsOp]},intersects:function(aBounds,bBounds){return aBounds.intersects(bBounds)}}},staticAccessors2.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(STRtree2,staticAccessors2),STRtree2}(AbstractSTRtree),STRtreeNode=function(AbstractNode$$1){function STRtreeNode2(){var level=arguments[0];AbstractNode$$1.call(this,level)}return AbstractNode$$1&&(STRtreeNode2.__proto__=AbstractNode$$1),STRtreeNode2.prototype=Object.create(AbstractNode$$1&&AbstractNode$$1.prototype),STRtreeNode2.prototype.constructor=STRtreeNode2,STRtreeNode2.prototype.computeBounds=function(){for(var bounds2=null,i=this.getChildBoundables().iterator();i.hasNext();){var childBoundable=i.next();bounds2===null?bounds2=new Envelope(childBoundable.getBounds()):bounds2.expandToInclude(childBoundable.getBounds())}return bounds2},STRtreeNode2.prototype.interfaces_=function(){return[]},STRtreeNode2.prototype.getClass=function(){return STRtreeNode2},STRtreeNode2}(AbstractNode),SegmentPointComparator=function(){};SegmentPointComparator.prototype.interfaces_=function(){return[]};SegmentPointComparator.prototype.getClass=function(){return SegmentPointComparator};SegmentPointComparator.relativeSign=function(x0,x12){return x0<x12?-1:x0>x12?1:0};SegmentPointComparator.compare=function(octant2,p0,p1){if(p0.equals2D(p1))return 0;var xSign=SegmentPointComparator.relativeSign(p0.x,p1.x),ySign=SegmentPointComparator.relativeSign(p0.y,p1.y);switch(octant2){case 0:return SegmentPointComparator.compareValue(xSign,ySign);case 1:return SegmentPointComparator.compareValue(ySign,xSign);case 2:return SegmentPointComparator.compareValue(ySign,-xSign);case 3:return SegmentPointComparator.compareValue(-xSign,ySign);case 4:return SegmentPointComparator.compareValue(-xSign,-ySign);case 5:return SegmentPointComparator.compareValue(-ySign,-xSign);case 6:return SegmentPointComparator.compareValue(-ySign,xSign);case 7:return SegmentPointComparator.compareValue(xSign,-ySign);default:}return Assert.shouldNeverReachHere("invalid octant value"),0};SegmentPointComparator.compareValue=function(compareSign0,compareSign1){return compareSign0<0?-1:compareSign0>0?1:compareSign1<0?-1:compareSign1>0?1:0};var SegmentNode=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var segString=arguments[0],coord=arguments[1],segmentIndex=arguments[2],segmentOctant=arguments[3];this._segString=segString,this.coord=new Coordinate(coord),this.segmentIndex=segmentIndex,this._segmentOctant=segmentOctant,this._isInterior=!coord.equals2D(segString.getCoordinate(segmentIndex))};SegmentNode.prototype.getCoordinate=function(){return this.coord};SegmentNode.prototype.print=function(out){out.print(this.coord),out.print(" seg # = "+this.segmentIndex)};SegmentNode.prototype.compareTo=function(obj){var other=obj;return this.segmentIndex<other.segmentIndex?-1:this.segmentIndex>other.segmentIndex?1:this.coord.equals2D(other.coord)?0:SegmentPointComparator.compare(this._segmentOctant,this.coord,other.coord)};SegmentNode.prototype.isEndPoint=function(maxSegmentIndex){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===maxSegmentIndex};SegmentNode.prototype.isInterior=function(){return this._isInterior};SegmentNode.prototype.interfaces_=function(){return[Comparable]};SegmentNode.prototype.getClass=function(){return SegmentNode};var SegmentNodeList=function(){this._nodeMap=new TreeMap,this._edge=null;var edge=arguments[0];this._edge=edge};SegmentNodeList.prototype.getSplitCoordinates=function(){var this$1=this,coordList=new CoordinateList;this.addEndpoints();for(var it=this.iterator(),eiPrev=it.next();it.hasNext();){var ei=it.next();this$1.addEdgeCoordinates(eiPrev,ei,coordList),eiPrev=ei}return coordList.toCoordinateArray()};SegmentNodeList.prototype.addCollapsedNodes=function(){var this$1=this,collapsedVertexIndexes=new ArrayList;this.findCollapsesFromInsertedNodes(collapsedVertexIndexes),this.findCollapsesFromExistingVertices(collapsedVertexIndexes);for(var it=collapsedVertexIndexes.iterator();it.hasNext();){var vertexIndex=it.next().intValue();this$1.add(this$1._edge.getCoordinate(vertexIndex),vertexIndex)}};SegmentNodeList.prototype.print=function(out){out.println("Intersections:");for(var it=this.iterator();it.hasNext();){var ei=it.next();ei.print(out)}};SegmentNodeList.prototype.findCollapsesFromExistingVertices=function(collapsedVertexIndexes){for(var this$1=this,i=0;i<this._edge.size()-2;i++){var p0=this$1._edge.getCoordinate(i),p2=this$1._edge.getCoordinate(i+2);p0.equals2D(p2)&&collapsedVertexIndexes.add(new Integer(i+1))}};SegmentNodeList.prototype.addEdgeCoordinates=function(ei0,ei1,coordList){var this$1=this,lastSegStartPt=this._edge.getCoordinate(ei1.segmentIndex),useIntPt1=ei1.isInterior()||!ei1.coord.equals2D(lastSegStartPt);coordList.add(new Coordinate(ei0.coord),!1);for(var i=ei0.segmentIndex+1;i<=ei1.segmentIndex;i++)coordList.add(this$1._edge.getCoordinate(i));useIntPt1&&coordList.add(new Coordinate(ei1.coord))};SegmentNodeList.prototype.iterator=function(){return this._nodeMap.values().iterator()};SegmentNodeList.prototype.addSplitEdges=function(edgeList){var this$1=this;this.addEndpoints(),this.addCollapsedNodes();for(var it=this.iterator(),eiPrev=it.next();it.hasNext();){var ei=it.next(),newEdge=this$1.createSplitEdge(eiPrev,ei);edgeList.add(newEdge),eiPrev=ei}};SegmentNodeList.prototype.findCollapseIndex=function(ei0,ei1,collapsedVertexIndex){if(!ei0.coord.equals2D(ei1.coord))return!1;var numVerticesBetween=ei1.segmentIndex-ei0.segmentIndex;return ei1.isInterior()||numVerticesBetween--,numVerticesBetween===1?(collapsedVertexIndex[0]=ei0.segmentIndex+1,!0):!1};SegmentNodeList.prototype.findCollapsesFromInsertedNodes=function(collapsedVertexIndexes){for(var this$1=this,collapsedVertexIndex=new Array(1).fill(null),it=this.iterator(),eiPrev=it.next();it.hasNext();){var ei=it.next(),isCollapsed=this$1.findCollapseIndex(eiPrev,ei,collapsedVertexIndex);isCollapsed&&collapsedVertexIndexes.add(new Integer(collapsedVertexIndex[0])),eiPrev=ei}};SegmentNodeList.prototype.getEdge=function(){return this._edge};SegmentNodeList.prototype.addEndpoints=function(){var maxSegIndex=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(maxSegIndex),maxSegIndex)};SegmentNodeList.prototype.createSplitEdge=function(ei0,ei1){var this$1=this,npts=ei1.segmentIndex-ei0.segmentIndex+2,lastSegStartPt=this._edge.getCoordinate(ei1.segmentIndex),useIntPt1=ei1.isInterior()||!ei1.coord.equals2D(lastSegStartPt);useIntPt1||npts--;var pts=new Array(npts).fill(null),ipt=0;pts[ipt++]=new Coordinate(ei0.coord);for(var i=ei0.segmentIndex+1;i<=ei1.segmentIndex;i++)pts[ipt++]=this$1._edge.getCoordinate(i);return useIntPt1&&(pts[ipt]=new Coordinate(ei1.coord)),new NodedSegmentString(pts,this._edge.getData())};SegmentNodeList.prototype.add=function(intPt,segmentIndex){var eiNew=new SegmentNode(this._edge,intPt,segmentIndex,this._edge.getSegmentOctant(segmentIndex)),ei=this._nodeMap.get(eiNew);return ei!==null?(Assert.isTrue(ei.coord.equals2D(intPt),"Found equal nodes with different coordinates"),ei):(this._nodeMap.put(eiNew,eiNew),eiNew)};SegmentNodeList.prototype.checkSplitEdgesCorrectness=function(splitEdges){var edgePts=this._edge.getCoordinates(),split0=splitEdges.get(0),pt0=split0.getCoordinate(0);if(!pt0.equals2D(edgePts[0]))throw new RuntimeException("bad split edge start point at "+pt0);var splitn=splitEdges.get(splitEdges.size()-1),splitnPts=splitn.getCoordinates(),ptn=splitnPts[splitnPts.length-1];if(!ptn.equals2D(edgePts[edgePts.length-1]))throw new RuntimeException("bad split edge end point at "+ptn)};SegmentNodeList.prototype.interfaces_=function(){return[]};SegmentNodeList.prototype.getClass=function(){return SegmentNodeList};var Octant=function(){};Octant.prototype.interfaces_=function(){return[]};Octant.prototype.getClass=function(){return Octant};Octant.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var dx=arguments[0],dy=arguments[1];if(dx===0&&dy===0)throw new IllegalArgumentException("Cannot compute the octant for point ( "+dx+", "+dy+" )");var adx=Math.abs(dx),ady=Math.abs(dy);return dx>=0?dy>=0?adx>=ady?0:1:adx>=ady?7:6:dy>=0?adx>=ady?3:2:adx>=ady?4:5}else if(arguments[0]instanceof Coordinate&&arguments[1]instanceof Coordinate){var p0=arguments[0],p1=arguments[1],dx$1=p1.x-p0.x,dy$1=p1.y-p0.y;if(dx$1===0&&dy$1===0)throw new IllegalArgumentException("Cannot compute the octant for two identical points "+p0);return Octant.octant(dx$1,dy$1)}};var SegmentString=function(){};SegmentString.prototype.getCoordinates=function(){};SegmentString.prototype.size=function(){};SegmentString.prototype.getCoordinate=function(i){};SegmentString.prototype.isClosed=function(){};SegmentString.prototype.setData=function(data){};SegmentString.prototype.getData=function(){};SegmentString.prototype.interfaces_=function(){return[]};SegmentString.prototype.getClass=function(){return SegmentString};var NodableSegmentString=function(){};NodableSegmentString.prototype.addIntersection=function(intPt,segmentIndex){};NodableSegmentString.prototype.interfaces_=function(){return[SegmentString]};NodableSegmentString.prototype.getClass=function(){return NodableSegmentString};var NodedSegmentString=function(){this._nodeList=new SegmentNodeList(this),this._pts=null,this._data=null;var pts=arguments[0],data=arguments[1];this._pts=pts,this._data=data};NodedSegmentString.prototype.getCoordinates=function(){return this._pts};NodedSegmentString.prototype.size=function(){return this._pts.length};NodedSegmentString.prototype.getCoordinate=function(i){return this._pts[i]};NodedSegmentString.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};NodedSegmentString.prototype.getSegmentOctant=function(index){return index===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(index),this.getCoordinate(index+1))};NodedSegmentString.prototype.setData=function(data){this._data=data};NodedSegmentString.prototype.safeOctant=function(p0,p1){return p0.equals2D(p1)?0:Octant.octant(p0,p1)};NodedSegmentString.prototype.getData=function(){return this._data};NodedSegmentString.prototype.addIntersection=function(){if(arguments.length===2){var intPt$1=arguments[0],segmentIndex=arguments[1];this.addIntersectionNode(intPt$1,segmentIndex)}else if(arguments.length===4){var li=arguments[0],segmentIndex$1=arguments[1],intIndex=arguments[3],intPt=new Coordinate(li.getIntersection(intIndex));this.addIntersection(intPt,segmentIndex$1)}};NodedSegmentString.prototype.toString=function(){return WKTWriter.toLineString(new CoordinateArraySequence(this._pts))};NodedSegmentString.prototype.getNodeList=function(){return this._nodeList};NodedSegmentString.prototype.addIntersectionNode=function(intPt,segmentIndex){var normalizedSegmentIndex=segmentIndex,nextSegIndex=normalizedSegmentIndex+1;if(nextSegIndex<this._pts.length){var nextPt=this._pts[nextSegIndex];intPt.equals2D(nextPt)&&(normalizedSegmentIndex=nextSegIndex)}var ei=this._nodeList.add(intPt,normalizedSegmentIndex);return ei};NodedSegmentString.prototype.addIntersections=function(li,segmentIndex,geomIndex){for(var this$1=this,i=0;i<li.getIntersectionNum();i++)this$1.addIntersection(li,segmentIndex,geomIndex,i)};NodedSegmentString.prototype.interfaces_=function(){return[NodableSegmentString]};NodedSegmentString.prototype.getClass=function(){return NodedSegmentString};NodedSegmentString.getNodedSubstrings=function(){if(arguments.length===1){var segStrings=arguments[0],resultEdgelist=new ArrayList;return NodedSegmentString.getNodedSubstrings(segStrings,resultEdgelist),resultEdgelist}else if(arguments.length===2)for(var segStrings$1=arguments[0],resultEdgelist$1=arguments[1],i=segStrings$1.iterator();i.hasNext();){var ss=i.next();ss.getNodeList().addSplitEdges(resultEdgelist$1)}};var LineSegment=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Coordinate,this.p1=new Coordinate;else if(arguments.length===1){var ls=arguments[0];this.p0=new Coordinate(ls.p0),this.p1=new Coordinate(ls.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var x0=arguments[0],y0=arguments[1],x12=arguments[2],y12=arguments[3];this.p0=new Coordinate(x0,y0),this.p1=new Coordinate(x12,y12)}},staticAccessors$24={serialVersionUID:{configurable:!0}};LineSegment.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};LineSegment.prototype.orientationIndex=function(){if(arguments[0]instanceof LineSegment){var seg=arguments[0],orient0=CGAlgorithms.orientationIndex(this.p0,this.p1,seg.p0),orient1=CGAlgorithms.orientationIndex(this.p0,this.p1,seg.p1);return orient0>=0&&orient1>=0||orient0<=0&&orient1<=0?Math.max(orient0,orient1):0}else if(arguments[0]instanceof Coordinate){var p=arguments[0];return CGAlgorithms.orientationIndex(this.p0,this.p1,p)}};LineSegment.prototype.toGeometry=function(geomFactory){return geomFactory.createLineString([this.p0,this.p1])};LineSegment.prototype.isVertical=function(){return this.p0.x===this.p1.x};LineSegment.prototype.equals=function(o){if(!(o instanceof LineSegment))return!1;var other=o;return this.p0.equals(other.p0)&&this.p1.equals(other.p1)};LineSegment.prototype.intersection=function(line){var li=new RobustLineIntersector;return li.computeIntersection(this.p0,this.p1,line.p0,line.p1),li.hasIntersection()?li.getIntersection(0):null};LineSegment.prototype.project=function(){if(arguments[0]instanceof Coordinate){var p=arguments[0];if(p.equals(this.p0)||p.equals(this.p1))return new Coordinate(p);var r=this.projectionFactor(p),coord=new Coordinate;return coord.x=this.p0.x+r*(this.p1.x-this.p0.x),coord.y=this.p0.y+r*(this.p1.y-this.p0.y),coord}else if(arguments[0]instanceof LineSegment){var seg=arguments[0],pf0=this.projectionFactor(seg.p0),pf1=this.projectionFactor(seg.p1);if(pf0>=1&&pf1>=1||pf0<=0&&pf1<=0)return null;var newp0=this.project(seg.p0);pf0<0&&(newp0=this.p0),pf0>1&&(newp0=this.p1);var newp1=this.project(seg.p1);return pf1<0&&(newp1=this.p0),pf1>1&&(newp1=this.p1),new LineSegment(newp0,newp1)}};LineSegment.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};LineSegment.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};LineSegment.prototype.getCoordinate=function(i){return i===0?this.p0:this.p1};LineSegment.prototype.distancePerpendicular=function(p){return CGAlgorithms.distancePointLinePerpendicular(p,this.p0,this.p1)};LineSegment.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};LineSegment.prototype.midPoint=function(){return LineSegment.midPoint(this.p0,this.p1)};LineSegment.prototype.projectionFactor=function(p){if(p.equals(this.p0))return 0;if(p.equals(this.p1))return 1;var dx=this.p1.x-this.p0.x,dy=this.p1.y-this.p0.y,len=dx*dx+dy*dy;if(len<=0)return Double.NaN;var r=((p.x-this.p0.x)*dx+(p.y-this.p0.y)*dy)/len;return r};LineSegment.prototype.closestPoints=function(line){var intPt=this.intersection(line);if(intPt!==null)return[intPt,intPt];var closestPt=new Array(2).fill(null),minDistance=Double.MAX_VALUE,dist2=null,close00=this.closestPoint(line.p0);minDistance=close00.distance(line.p0),closestPt[0]=close00,closestPt[1]=line.p0;var close01=this.closestPoint(line.p1);dist2=close01.distance(line.p1),dist2<minDistance&&(minDistance=dist2,closestPt[0]=close01,closestPt[1]=line.p1);var close10=line.closestPoint(this.p0);dist2=close10.distance(this.p0),dist2<minDistance&&(minDistance=dist2,closestPt[0]=this.p0,closestPt[1]=close10);var close11=line.closestPoint(this.p1);return dist2=close11.distance(this.p1),dist2<minDistance&&(minDistance=dist2,closestPt[0]=this.p1,closestPt[1]=close11),closestPt};LineSegment.prototype.closestPoint=function(p){var factor=this.projectionFactor(p);if(factor>0&&factor<1)return this.project(p);var dist0=this.p0.distance(p),dist1=this.p1.distance(p);return dist0<dist1?this.p0:this.p1};LineSegment.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};LineSegment.prototype.getLength=function(){return this.p0.distance(this.p1)};LineSegment.prototype.compareTo=function(o){var other=o,comp0=this.p0.compareTo(other.p0);return comp0!==0?comp0:this.p1.compareTo(other.p1)};LineSegment.prototype.reverse=function(){var temp2=this.p0;this.p0=this.p1,this.p1=temp2};LineSegment.prototype.equalsTopo=function(other){return this.p0.equals(other.p0)&&(this.p1.equals(other.p1)||this.p0.equals(other.p1))&&this.p1.equals(other.p0)};LineSegment.prototype.lineIntersection=function(line){try{var intPt=HCoordinate.intersection(this.p0,this.p1,line.p0,line.p1);return intPt}catch(ex){if(!(ex instanceof NotRepresentableException))throw ex}finally{}return null};LineSegment.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};LineSegment.prototype.pointAlongOffset=function(segmentLengthFraction,offsetDistance){var segx=this.p0.x+segmentLengthFraction*(this.p1.x-this.p0.x),segy=this.p0.y+segmentLengthFraction*(this.p1.y-this.p0.y),dx=this.p1.x-this.p0.x,dy=this.p1.y-this.p0.y,len=Math.sqrt(dx*dx+dy*dy),ux=0,uy=0;if(offsetDistance!==0){if(len<=0)throw new Error("Cannot compute offset from zero-length line segment");ux=offsetDistance*dx/len,uy=offsetDistance*dy/len}var offsetx=segx-uy,offsety=segy+ux,coord=new Coordinate(offsetx,offsety);return coord};LineSegment.prototype.setCoordinates=function(){if(arguments.length===1){var ls=arguments[0];this.setCoordinates(ls.p0,ls.p1)}else if(arguments.length===2){var p0=arguments[0],p1=arguments[1];this.p0.x=p0.x,this.p0.y=p0.y,this.p1.x=p1.x,this.p1.y=p1.y}};LineSegment.prototype.segmentFraction=function(inputPt){var segFrac=this.projectionFactor(inputPt);return segFrac<0?segFrac=0:(segFrac>1||Double.isNaN(segFrac))&&(segFrac=1),segFrac};LineSegment.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};LineSegment.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};LineSegment.prototype.distance=function(){if(arguments[0]instanceof LineSegment){var ls=arguments[0];return CGAlgorithms.distanceLineLine(this.p0,this.p1,ls.p0,ls.p1)}else if(arguments[0]instanceof Coordinate){var p=arguments[0];return CGAlgorithms.distancePointLine(p,this.p0,this.p1)}};LineSegment.prototype.pointAlong=function(segmentLengthFraction){var coord=new Coordinate;return coord.x=this.p0.x+segmentLengthFraction*(this.p1.x-this.p0.x),coord.y=this.p0.y+segmentLengthFraction*(this.p1.y-this.p0.y),coord};LineSegment.prototype.hashCode=function(){var bits0=Double.doubleToLongBits(this.p0.x);bits0^=Double.doubleToLongBits(this.p0.y)*31;var hash0=Math.trunc(bits0)^Math.trunc(bits0>>32),bits1=Double.doubleToLongBits(this.p1.x);bits1^=Double.doubleToLongBits(this.p1.y)*31;var hash1=Math.trunc(bits1)^Math.trunc(bits1>>32);return hash0^hash1};LineSegment.prototype.interfaces_=function(){return[Comparable,Serializable]};LineSegment.prototype.getClass=function(){return LineSegment};LineSegment.midPoint=function(p0,p1){return new Coordinate((p0.x+p1.x)/2,(p0.y+p1.y)/2)};staticAccessors$24.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(LineSegment,staticAccessors$24);var MonotoneChainOverlapAction=function(){this.tempEnv1=new Envelope,this.tempEnv2=new Envelope,this._overlapSeg1=new LineSegment,this._overlapSeg2=new LineSegment};MonotoneChainOverlapAction.prototype.overlap=function(){if(arguments.length!==2){if(arguments.length===4){var mc1=arguments[0],start1=arguments[1],mc2=arguments[2],start2=arguments[3];mc1.getLineSegment(start1,this._overlapSeg1),mc2.getLineSegment(start2,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}};MonotoneChainOverlapAction.prototype.interfaces_=function(){return[]};MonotoneChainOverlapAction.prototype.getClass=function(){return MonotoneChainOverlapAction};var MonotoneChain=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var pts=arguments[0],start2=arguments[1],end=arguments[2],context=arguments[3];this._pts=pts,this._start=start2,this._end=end,this._context=context};MonotoneChain.prototype.getLineSegment=function(index,ls){ls.p0=this._pts[index],ls.p1=this._pts[index+1]};MonotoneChain.prototype.computeSelect=function(searchEnv,start0,end0,mcs){var p0=this._pts[start0],p1=this._pts[end0];if(mcs.tempEnv1.init(p0,p1),end0-start0===1)return mcs.select(this,start0),null;if(!searchEnv.intersects(mcs.tempEnv1))return null;var mid=Math.trunc((start0+end0)/2);start0<mid&&this.computeSelect(searchEnv,start0,mid,mcs),mid<end0&&this.computeSelect(searchEnv,mid,end0,mcs)};MonotoneChain.prototype.getCoordinates=function(){for(var this$1=this,coord=new Array(this._end-this._start+1).fill(null),index=0,i=this._start;i<=this._end;i++)coord[index++]=this$1._pts[i];return coord};MonotoneChain.prototype.computeOverlaps=function(mc,mco){this.computeOverlapsInternal(this._start,this._end,mc,mc._start,mc._end,mco)};MonotoneChain.prototype.setId=function(id){this._id=id};MonotoneChain.prototype.select=function(searchEnv,mcs){this.computeSelect(searchEnv,this._start,this._end,mcs)};MonotoneChain.prototype.getEnvelope=function(){if(this._env===null){var p0=this._pts[this._start],p1=this._pts[this._end];this._env=new Envelope(p0,p1)}return this._env};MonotoneChain.prototype.getEndIndex=function(){return this._end};MonotoneChain.prototype.getStartIndex=function(){return this._start};MonotoneChain.prototype.getContext=function(){return this._context};MonotoneChain.prototype.getId=function(){return this._id};MonotoneChain.prototype.computeOverlapsInternal=function(start0,end0,mc,start1,end1,mco){var p002=this._pts[start0],p012=this._pts[end0],p102=mc._pts[start1],p112=mc._pts[end1];if(end0-start0===1&&end1-start1===1)return mco.overlap(this,start0,mc,start1),null;if(mco.tempEnv1.init(p002,p012),mco.tempEnv2.init(p102,p112),!mco.tempEnv1.intersects(mco.tempEnv2))return null;var mid0=Math.trunc((start0+end0)/2),mid1=Math.trunc((start1+end1)/2);start0<mid0&&(start1<mid1&&this.computeOverlapsInternal(start0,mid0,mc,start1,mid1,mco),mid1<end1&&this.computeOverlapsInternal(start0,mid0,mc,mid1,end1,mco)),mid0<end0&&(start1<mid1&&this.computeOverlapsInternal(mid0,end0,mc,start1,mid1,mco),mid1<end1&&this.computeOverlapsInternal(mid0,end0,mc,mid1,end1,mco))};MonotoneChain.prototype.interfaces_=function(){return[]};MonotoneChain.prototype.getClass=function(){return MonotoneChain};var MonotoneChainBuilder=function(){};MonotoneChainBuilder.prototype.interfaces_=function(){return[]};MonotoneChainBuilder.prototype.getClass=function(){return MonotoneChainBuilder};MonotoneChainBuilder.getChainStartIndices=function(pts){var start2=0,startIndexList=new ArrayList;startIndexList.add(new Integer(start2));do{var last=MonotoneChainBuilder.findChainEnd(pts,start2);startIndexList.add(new Integer(last)),start2=last}while(start2<pts.length-1);var startIndex=MonotoneChainBuilder.toIntArray(startIndexList);return startIndex};MonotoneChainBuilder.findChainEnd=function(pts,start2){for(var safeStart=start2;safeStart<pts.length-1&&pts[safeStart].equals2D(pts[safeStart+1]);)safeStart++;if(safeStart>=pts.length-1)return pts.length-1;for(var chainQuad=Quadrant.quadrant(pts[safeStart],pts[safeStart+1]),last=start2+1;last<pts.length;){if(!pts[last-1].equals2D(pts[last])){var quad=Quadrant.quadrant(pts[last-1],pts[last]);if(quad!==chainQuad)break}last++}return last-1};MonotoneChainBuilder.getChains=function(){if(arguments.length===1){var pts=arguments[0];return MonotoneChainBuilder.getChains(pts,null)}else if(arguments.length===2){for(var pts$1=arguments[0],context=arguments[1],mcList=new ArrayList,startIndex=MonotoneChainBuilder.getChainStartIndices(pts$1),i=0;i<startIndex.length-1;i++){var mc=new MonotoneChain(pts$1,startIndex[i],startIndex[i+1],context);mcList.add(mc)}return mcList}};MonotoneChainBuilder.toIntArray=function(list){for(var array=new Array(list.size()).fill(null),i=0;i<array.length;i++)array[i]=list.get(i).intValue();return array};var Noder=function(){};Noder.prototype.computeNodes=function(segStrings){};Noder.prototype.getNodedSubstrings=function(){};Noder.prototype.interfaces_=function(){return[]};Noder.prototype.getClass=function(){return Noder};var SinglePassNoder=function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var segInt=arguments[0];this.setSegmentIntersector(segInt)}}};SinglePassNoder.prototype.setSegmentIntersector=function(segInt){this._segInt=segInt};SinglePassNoder.prototype.interfaces_=function(){return[Noder]};SinglePassNoder.prototype.getClass=function(){return SinglePassNoder};var MCIndexNoder=function(SinglePassNoder$$1){function MCIndexNoder2(si){si?SinglePassNoder$$1.call(this,si):SinglePassNoder$$1.call(this),this._monoChains=new ArrayList,this._index=new STRtree,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}SinglePassNoder$$1&&(MCIndexNoder2.__proto__=SinglePassNoder$$1),MCIndexNoder2.prototype=Object.create(SinglePassNoder$$1&&SinglePassNoder$$1.prototype),MCIndexNoder2.prototype.constructor=MCIndexNoder2;var staticAccessors2={SegmentOverlapAction:{configurable:!0}};return MCIndexNoder2.prototype.getMonotoneChains=function(){return this._monoChains},MCIndexNoder2.prototype.getNodedSubstrings=function(){return NodedSegmentString.getNodedSubstrings(this._nodedSegStrings)},MCIndexNoder2.prototype.getIndex=function(){return this._index},MCIndexNoder2.prototype.add=function(segStr){for(var this$1=this,segChains=MonotoneChainBuilder.getChains(segStr.getCoordinates(),segStr),i=segChains.iterator();i.hasNext();){var mc=i.next();mc.setId(this$1._idCounter++),this$1._index.insert(mc.getEnvelope(),mc),this$1._monoChains.add(mc)}},MCIndexNoder2.prototype.computeNodes=function(inputSegStrings){var this$1=this;this._nodedSegStrings=inputSegStrings;for(var i=inputSegStrings.iterator();i.hasNext();)this$1.add(i.next());this.intersectChains()},MCIndexNoder2.prototype.intersectChains=function(){for(var this$1=this,overlapAction=new SegmentOverlapAction(this._segInt),i=this._monoChains.iterator();i.hasNext();)for(var queryChain=i.next(),overlapChains=this$1._index.query(queryChain.getEnvelope()),j=overlapChains.iterator();j.hasNext();){var testChain=j.next();if(testChain.getId()>queryChain.getId()&&(queryChain.computeOverlaps(testChain,overlapAction),this$1._nOverlaps++),this$1._segInt.isDone())return null}},MCIndexNoder2.prototype.interfaces_=function(){return[]},MCIndexNoder2.prototype.getClass=function(){return MCIndexNoder2},staticAccessors2.SegmentOverlapAction.get=function(){return SegmentOverlapAction},Object.defineProperties(MCIndexNoder2,staticAccessors2),MCIndexNoder2}(SinglePassNoder),SegmentOverlapAction=function(MonotoneChainOverlapAction$$1){function SegmentOverlapAction2(){MonotoneChainOverlapAction$$1.call(this),this._si=null;var si=arguments[0];this._si=si}return MonotoneChainOverlapAction$$1&&(SegmentOverlapAction2.__proto__=MonotoneChainOverlapAction$$1),SegmentOverlapAction2.prototype=Object.create(MonotoneChainOverlapAction$$1&&MonotoneChainOverlapAction$$1.prototype),SegmentOverlapAction2.prototype.constructor=SegmentOverlapAction2,SegmentOverlapAction2.prototype.overlap=function(){if(arguments.length===4){var mc1=arguments[0],start1=arguments[1],mc2=arguments[2],start2=arguments[3],ss1=mc1.getContext(),ss2=mc2.getContext();this._si.processIntersections(ss1,start1,ss2,start2)}else return MonotoneChainOverlapAction$$1.prototype.overlap.apply(this,arguments)},SegmentOverlapAction2.prototype.interfaces_=function(){return[]},SegmentOverlapAction2.prototype.getClass=function(){return SegmentOverlapAction2},SegmentOverlapAction2}(MonotoneChainOverlapAction),BufferParameters=function BufferParameters2(){if(this._quadrantSegments=BufferParameters2.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=BufferParameters2.CAP_ROUND,this._joinStyle=BufferParameters2.JOIN_ROUND,this._mitreLimit=BufferParameters2.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=BufferParameters2.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var quadrantSegments=arguments[0];this.setQuadrantSegments(quadrantSegments)}else if(arguments.length===2){var quadrantSegments$1=arguments[0],endCapStyle=arguments[1];this.setQuadrantSegments(quadrantSegments$1),this.setEndCapStyle(endCapStyle)}else if(arguments.length===4){var quadrantSegments$2=arguments[0],endCapStyle$1=arguments[1],joinStyle=arguments[2],mitreLimit=arguments[3];this.setQuadrantSegments(quadrantSegments$2),this.setEndCapStyle(endCapStyle$1),this.setJoinStyle(joinStyle),this.setMitreLimit(mitreLimit)}}},staticAccessors$25={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};BufferParameters.prototype.getEndCapStyle=function(){return this._endCapStyle};BufferParameters.prototype.isSingleSided=function(){return this._isSingleSided};BufferParameters.prototype.setQuadrantSegments=function(quadSegs){this._quadrantSegments=quadSegs,this._quadrantSegments===0&&(this._joinStyle=BufferParameters.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=BufferParameters.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),quadSegs<=0&&(this._quadrantSegments=1),this._joinStyle!==BufferParameters.JOIN_ROUND&&(this._quadrantSegments=BufferParameters.DEFAULT_QUADRANT_SEGMENTS)};BufferParameters.prototype.getJoinStyle=function(){return this._joinStyle};BufferParameters.prototype.setJoinStyle=function(joinStyle){this._joinStyle=joinStyle};BufferParameters.prototype.setSimplifyFactor=function(simplifyFactor){this._simplifyFactor=simplifyFactor<0?0:simplifyFactor};BufferParameters.prototype.getSimplifyFactor=function(){return this._simplifyFactor};BufferParameters.prototype.getQuadrantSegments=function(){return this._quadrantSegments};BufferParameters.prototype.setEndCapStyle=function(endCapStyle){this._endCapStyle=endCapStyle};BufferParameters.prototype.getMitreLimit=function(){return this._mitreLimit};BufferParameters.prototype.setMitreLimit=function(mitreLimit){this._mitreLimit=mitreLimit};BufferParameters.prototype.setSingleSided=function(isSingleSided2){this._isSingleSided=isSingleSided2};BufferParameters.prototype.interfaces_=function(){return[]};BufferParameters.prototype.getClass=function(){return BufferParameters};BufferParameters.bufferDistanceError=function(quadSegs){var alpha=Math.PI/2/quadSegs;return 1-Math.cos(alpha/2)};staticAccessors$25.CAP_ROUND.get=function(){return 1};staticAccessors$25.CAP_FLAT.get=function(){return 2};staticAccessors$25.CAP_SQUARE.get=function(){return 3};staticAccessors$25.JOIN_ROUND.get=function(){return 1};staticAccessors$25.JOIN_MITRE.get=function(){return 2};staticAccessors$25.JOIN_BEVEL.get=function(){return 3};staticAccessors$25.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};staticAccessors$25.DEFAULT_MITRE_LIMIT.get=function(){return 5};staticAccessors$25.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(BufferParameters,staticAccessors$25);var BufferInputLineSimplifier=function(inputLine){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=CGAlgorithms.COUNTERCLOCKWISE,this._inputLine=inputLine||null},staticAccessors$26={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};BufferInputLineSimplifier.prototype.isDeletable=function(i0,i1,i2,distanceTol){var p0=this._inputLine[i0],p1=this._inputLine[i1],p2=this._inputLine[i2];return!this.isConcave(p0,p1,p2)||!this.isShallow(p0,p1,p2,distanceTol)?!1:this.isShallowSampled(p0,p1,i0,i2,distanceTol)};BufferInputLineSimplifier.prototype.deleteShallowConcavities=function(){for(var this$1=this,index=1,midIndex=this.findNextNonDeletedIndex(index),lastIndex=this.findNextNonDeletedIndex(midIndex),isChanged=!1;lastIndex<this._inputLine.length;){var isMiddleVertexDeleted=!1;this$1.isDeletable(index,midIndex,lastIndex,this$1._distanceTol)&&(this$1._isDeleted[midIndex]=BufferInputLineSimplifier.DELETE,isMiddleVertexDeleted=!0,isChanged=!0),isMiddleVertexDeleted?index=lastIndex:index=midIndex,midIndex=this$1.findNextNonDeletedIndex(index),lastIndex=this$1.findNextNonDeletedIndex(midIndex)}return isChanged};BufferInputLineSimplifier.prototype.isShallowConcavity=function(p0,p1,p2,distanceTol){var orientation2=CGAlgorithms.computeOrientation(p0,p1,p2),isAngleToSimplify=orientation2===this._angleOrientation;if(!isAngleToSimplify)return!1;var dist2=CGAlgorithms.distancePointLine(p1,p0,p2);return dist2<distanceTol};BufferInputLineSimplifier.prototype.isShallowSampled=function(p0,p2,i0,i2,distanceTol){var this$1=this,inc=Math.trunc((i2-i0)/BufferInputLineSimplifier.NUM_PTS_TO_CHECK);inc<=0&&(inc=1);for(var i=i0;i<i2;i+=inc)if(!this$1.isShallow(p0,p2,this$1._inputLine[i],distanceTol))return!1;return!0};BufferInputLineSimplifier.prototype.isConcave=function(p0,p1,p2){var orientation2=CGAlgorithms.computeOrientation(p0,p1,p2),isConcave2=orientation2===this._angleOrientation;return isConcave2};BufferInputLineSimplifier.prototype.simplify=function(distanceTol){var this$1=this;this._distanceTol=Math.abs(distanceTol),distanceTol<0&&(this._angleOrientation=CGAlgorithms.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var isChanged=!1;do isChanged=this$1.deleteShallowConcavities();while(isChanged);return this.collapseLine()};BufferInputLineSimplifier.prototype.findNextNonDeletedIndex=function(index){for(var next3=index+1;next3<this._inputLine.length&&this._isDeleted[next3]===BufferInputLineSimplifier.DELETE;)next3++;return next3};BufferInputLineSimplifier.prototype.isShallow=function(p0,p1,p2,distanceTol){var dist2=CGAlgorithms.distancePointLine(p1,p0,p2);return dist2<distanceTol};BufferInputLineSimplifier.prototype.collapseLine=function(){for(var this$1=this,coordList=new CoordinateList,i=0;i<this._inputLine.length;i++)this$1._isDeleted[i]!==BufferInputLineSimplifier.DELETE&&coordList.add(this$1._inputLine[i]);return coordList.toCoordinateArray()};BufferInputLineSimplifier.prototype.interfaces_=function(){return[]};BufferInputLineSimplifier.prototype.getClass=function(){return BufferInputLineSimplifier};BufferInputLineSimplifier.simplify=function(inputLine,distanceTol){var simp=new BufferInputLineSimplifier(inputLine);return simp.simplify(distanceTol)};staticAccessors$26.INIT.get=function(){return 0};staticAccessors$26.DELETE.get=function(){return 1};staticAccessors$26.KEEP.get=function(){return 1};staticAccessors$26.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(BufferInputLineSimplifier,staticAccessors$26);var OffsetSegmentString=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new ArrayList},staticAccessors$28={COORDINATE_ARRAY_TYPE:{configurable:!0}};OffsetSegmentString.prototype.getCoordinates=function(){var coord=this._ptList.toArray(OffsetSegmentString.COORDINATE_ARRAY_TYPE);return coord};OffsetSegmentString.prototype.setPrecisionModel=function(precisionModel){this._precisionModel=precisionModel};OffsetSegmentString.prototype.addPt=function(pt){var bufPt=new Coordinate(pt);if(this._precisionModel.makePrecise(bufPt),this.isRedundant(bufPt))return null;this._ptList.add(bufPt)};OffsetSegmentString.prototype.revere=function(){};OffsetSegmentString.prototype.addPts=function(pt,isForward){var this$1=this;if(isForward)for(var i=0;i<pt.length;i++)this$1.addPt(pt[i]);else for(var i$1=pt.length-1;i$1>=0;i$1--)this$1.addPt(pt[i$1])};OffsetSegmentString.prototype.isRedundant=function(pt){if(this._ptList.size()<1)return!1;var lastPt=this._ptList.get(this._ptList.size()-1),ptDist=pt.distance(lastPt);return ptDist<this._minimimVertexDistance};OffsetSegmentString.prototype.toString=function(){var fact=new GeometryFactory,line=fact.createLineString(this.getCoordinates());return line.toString()};OffsetSegmentString.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var startPt=new Coordinate(this._ptList.get(0)),lastPt=this._ptList.get(this._ptList.size()-1);if(startPt.equals(lastPt))return null;this._ptList.add(startPt)};OffsetSegmentString.prototype.setMinimumVertexDistance=function(minimimVertexDistance){this._minimimVertexDistance=minimimVertexDistance};OffsetSegmentString.prototype.interfaces_=function(){return[]};OffsetSegmentString.prototype.getClass=function(){return OffsetSegmentString};staticAccessors$28.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(OffsetSegmentString,staticAccessors$28);var Angle=function(){},staticAccessors$29={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Angle.prototype.interfaces_=function(){return[]};Angle.prototype.getClass=function(){return Angle};Angle.toDegrees=function(radians2){return radians2*180/Math.PI};Angle.normalize=function(angle3){for(;angle3>Math.PI;)angle3-=Angle.PI_TIMES_2;for(;angle3<=-Math.PI;)angle3+=Angle.PI_TIMES_2;return angle3};Angle.angle=function(){if(arguments.length===1){var p=arguments[0];return Math.atan2(p.y,p.x)}else if(arguments.length===2){var p0=arguments[0],p1=arguments[1],dx=p1.x-p0.x,dy=p1.y-p0.y;return Math.atan2(dy,dx)}};Angle.isAcute=function(p0,p1,p2){var dx0=p0.x-p1.x,dy0=p0.y-p1.y,dx1=p2.x-p1.x,dy1=p2.y-p1.y,dotprod=dx0*dx1+dy0*dy1;return dotprod>0};Angle.isObtuse=function(p0,p1,p2){var dx0=p0.x-p1.x,dy0=p0.y-p1.y,dx1=p2.x-p1.x,dy1=p2.y-p1.y,dotprod=dx0*dx1+dy0*dy1;return dotprod<0};Angle.interiorAngle=function(p0,p1,p2){var anglePrev=Angle.angle(p1,p0),angleNext=Angle.angle(p1,p2);return Math.abs(angleNext-anglePrev)};Angle.normalizePositive=function(angle3){if(angle3<0){for(;angle3<0;)angle3+=Angle.PI_TIMES_2;angle3>=Angle.PI_TIMES_2&&(angle3=0)}else{for(;angle3>=Angle.PI_TIMES_2;)angle3-=Angle.PI_TIMES_2;angle3<0&&(angle3=0)}return angle3};Angle.angleBetween=function(tip1,tail,tip2){var a1=Angle.angle(tail,tip1),a2=Angle.angle(tail,tip2);return Angle.diff(a1,a2)};Angle.diff=function(ang1,ang2){var delAngle=null;return ang1<ang2?delAngle=ang2-ang1:delAngle=ang1-ang2,delAngle>Math.PI&&(delAngle=2*Math.PI-delAngle),delAngle};Angle.toRadians=function(angleDegrees){return angleDegrees*Math.PI/180};Angle.getTurn=function(ang1,ang2){var crossproduct=Math.sin(ang2-ang1);return crossproduct>0?Angle.COUNTERCLOCKWISE:crossproduct<0?Angle.CLOCKWISE:Angle.NONE};Angle.angleBetweenOriented=function(tip1,tail,tip2){var a1=Angle.angle(tail,tip1),a2=Angle.angle(tail,tip2),angDel=a2-a1;return angDel<=-Math.PI?angDel+Angle.PI_TIMES_2:angDel>Math.PI?angDel-Angle.PI_TIMES_2:angDel};staticAccessors$29.PI_TIMES_2.get=function(){return 2*Math.PI};staticAccessors$29.PI_OVER_2.get=function(){return Math.PI/2};staticAccessors$29.PI_OVER_4.get=function(){return Math.PI/4};staticAccessors$29.COUNTERCLOCKWISE.get=function(){return CGAlgorithms.COUNTERCLOCKWISE};staticAccessors$29.CLOCKWISE.get=function(){return CGAlgorithms.CLOCKWISE};staticAccessors$29.NONE.get=function(){return CGAlgorithms.COLLINEAR};Object.defineProperties(Angle,staticAccessors$29);var OffsetSegmentGenerator=function OffsetSegmentGenerator2(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new LineSegment,this._seg1=new LineSegment,this._offset0=new LineSegment,this._offset1=new LineSegment,this._side=0,this._hasNarrowConcaveAngle=!1;var precisionModel=arguments[0],bufParams=arguments[1],distance12=arguments[2];this._precisionModel=precisionModel,this._bufParams=bufParams,this._li=new RobustLineIntersector,this._filletAngleQuantum=Math.PI/2/bufParams.getQuadrantSegments(),bufParams.getQuadrantSegments()>=8&&bufParams.getJoinStyle()===BufferParameters.JOIN_ROUND&&(this._closingSegLengthFactor=OffsetSegmentGenerator2.MAX_CLOSING_SEG_LEN_FACTOR),this.init(distance12)},staticAccessors$27={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};OffsetSegmentGenerator.prototype.addNextSegment=function(p,addStartPoint){if(this._s0=this._s1,this._s1=this._s2,this._s2=p,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var orientation2=CGAlgorithms.computeOrientation(this._s0,this._s1,this._s2),outsideTurn=orientation2===CGAlgorithms.CLOCKWISE&&this._side===Position.LEFT||orientation2===CGAlgorithms.COUNTERCLOCKWISE&&this._side===Position.RIGHT;orientation2===0?this.addCollinear(addStartPoint):outsideTurn?this.addOutsideTurn(orientation2,addStartPoint):this.addInsideTurn(orientation2,addStartPoint)};OffsetSegmentGenerator.prototype.addLineEndCap=function(p0,p1){var seg=new LineSegment(p0,p1),offsetL=new LineSegment;this.computeOffsetSegment(seg,Position.LEFT,this._distance,offsetL);var offsetR=new LineSegment;this.computeOffsetSegment(seg,Position.RIGHT,this._distance,offsetR);var dx=p1.x-p0.x,dy=p1.y-p0.y,angle3=Math.atan2(dy,dx);switch(this._bufParams.getEndCapStyle()){case BufferParameters.CAP_ROUND:this._segList.addPt(offsetL.p1),this.addFilletArc(p1,angle3+Math.PI/2,angle3-Math.PI/2,CGAlgorithms.CLOCKWISE,this._distance),this._segList.addPt(offsetR.p1);break;case BufferParameters.CAP_FLAT:this._segList.addPt(offsetL.p1),this._segList.addPt(offsetR.p1);break;case BufferParameters.CAP_SQUARE:var squareCapSideOffset=new Coordinate;squareCapSideOffset.x=Math.abs(this._distance)*Math.cos(angle3),squareCapSideOffset.y=Math.abs(this._distance)*Math.sin(angle3);var squareCapLOffset=new Coordinate(offsetL.p1.x+squareCapSideOffset.x,offsetL.p1.y+squareCapSideOffset.y),squareCapROffset=new Coordinate(offsetR.p1.x+squareCapSideOffset.x,offsetR.p1.y+squareCapSideOffset.y);this._segList.addPt(squareCapLOffset),this._segList.addPt(squareCapROffset);break;default:}};OffsetSegmentGenerator.prototype.getCoordinates=function(){var pts=this._segList.getCoordinates();return pts};OffsetSegmentGenerator.prototype.addMitreJoin=function(p,offset0,offset1,distance12){var isMitreWithinLimit=!0,intPt=null;try{intPt=HCoordinate.intersection(offset0.p0,offset0.p1,offset1.p0,offset1.p1);var mitreRatio=distance12<=0?1:intPt.distance(p)/Math.abs(distance12);mitreRatio>this._bufParams.getMitreLimit()&&(isMitreWithinLimit=!1)}catch(ex){if(ex instanceof NotRepresentableException)intPt=new Coordinate(0,0),isMitreWithinLimit=!1;else throw ex}finally{}isMitreWithinLimit?this._segList.addPt(intPt):this.addLimitedMitreJoin(offset0,offset1,distance12,this._bufParams.getMitreLimit())};OffsetSegmentGenerator.prototype.addFilletCorner=function(p,p0,p1,direction,radius){var dx0=p0.x-p.x,dy0=p0.y-p.y,startAngle=Math.atan2(dy0,dx0),dx1=p1.x-p.x,dy1=p1.y-p.y,endAngle=Math.atan2(dy1,dx1);direction===CGAlgorithms.CLOCKWISE?startAngle<=endAngle&&(startAngle+=2*Math.PI):startAngle>=endAngle&&(startAngle-=2*Math.PI),this._segList.addPt(p0),this.addFilletArc(p,startAngle,endAngle,direction,radius),this._segList.addPt(p1)};OffsetSegmentGenerator.prototype.addOutsideTurn=function(orientation2,addStartPoint){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*OffsetSegmentGenerator.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===BufferParameters.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===BufferParameters.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(addStartPoint&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,orientation2,this._distance),this._segList.addPt(this._offset1.p0))};OffsetSegmentGenerator.prototype.createSquare=function(p){this._segList.addPt(new Coordinate(p.x+this._distance,p.y+this._distance)),this._segList.addPt(new Coordinate(p.x+this._distance,p.y-this._distance)),this._segList.addPt(new Coordinate(p.x-this._distance,p.y-this._distance)),this._segList.addPt(new Coordinate(p.x-this._distance,p.y+this._distance)),this._segList.closeRing()};OffsetSegmentGenerator.prototype.addSegments=function(pt,isForward){this._segList.addPts(pt,isForward)};OffsetSegmentGenerator.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};OffsetSegmentGenerator.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};OffsetSegmentGenerator.prototype.initSideSegments=function(s1,s2,side){this._s1=s1,this._s2=s2,this._side=side,this._seg1.setCoordinates(s1,s2),this.computeOffsetSegment(this._seg1,side,this._distance,this._offset1)};OffsetSegmentGenerator.prototype.addLimitedMitreJoin=function(offset0,offset1,distance12,mitreLimit){var basePt=this._seg0.p1,ang0=Angle.angle(basePt,this._seg0.p0),angDiff=Angle.angleBetweenOriented(this._seg0.p0,basePt,this._seg1.p1),angDiffHalf=angDiff/2,midAng=Angle.normalize(ang0+angDiffHalf),mitreMidAng=Angle.normalize(midAng+Math.PI),mitreDist=mitreLimit*distance12,bevelDelta=mitreDist*Math.abs(Math.sin(angDiffHalf)),bevelHalfLen=distance12-bevelDelta,bevelMidX=basePt.x+mitreDist*Math.cos(mitreMidAng),bevelMidY=basePt.y+mitreDist*Math.sin(mitreMidAng),bevelMidPt=new Coordinate(bevelMidX,bevelMidY),mitreMidLine=new LineSegment(basePt,bevelMidPt),bevelEndLeft=mitreMidLine.pointAlongOffset(1,bevelHalfLen),bevelEndRight=mitreMidLine.pointAlongOffset(1,-bevelHalfLen);this._side===Position.LEFT?(this._segList.addPt(bevelEndLeft),this._segList.addPt(bevelEndRight)):(this._segList.addPt(bevelEndRight),this._segList.addPt(bevelEndLeft))};OffsetSegmentGenerator.prototype.computeOffsetSegment=function(seg,side,distance12,offset){var sideSign=side===Position.LEFT?1:-1,dx=seg.p1.x-seg.p0.x,dy=seg.p1.y-seg.p0.y,len=Math.sqrt(dx*dx+dy*dy),ux=sideSign*distance12*dx/len,uy=sideSign*distance12*dy/len;offset.p0.x=seg.p0.x-uy,offset.p0.y=seg.p0.y+ux,offset.p1.x=seg.p1.x-uy,offset.p1.y=seg.p1.y+ux};OffsetSegmentGenerator.prototype.addFilletArc=function(p,startAngle,endAngle,direction,radius){var this$1=this,directionFactor=direction===CGAlgorithms.CLOCKWISE?-1:1,totalAngle=Math.abs(startAngle-endAngle),nSegs=Math.trunc(totalAngle/this._filletAngleQuantum+.5);if(nSegs<1)return null;for(var initAngle=0,currAngleInc=totalAngle/nSegs,currAngle=initAngle,pt=new Coordinate;currAngle<totalAngle;){var angle3=startAngle+directionFactor*currAngle;pt.x=p.x+radius*Math.cos(angle3),pt.y=p.y+radius*Math.sin(angle3),this$1._segList.addPt(pt),currAngle+=currAngleInc}};OffsetSegmentGenerator.prototype.addInsideTurn=function(orientation2,addStartPoint){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*OffsetSegmentGenerator.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var mid0=new Coordinate((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(mid0);var mid1=new Coordinate((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(mid1)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};OffsetSegmentGenerator.prototype.createCircle=function(p){var pt=new Coordinate(p.x+this._distance,p.y);this._segList.addPt(pt),this.addFilletArc(p,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};OffsetSegmentGenerator.prototype.addBevelJoin=function(offset0,offset1){this._segList.addPt(offset0.p1),this._segList.addPt(offset1.p0)};OffsetSegmentGenerator.prototype.init=function(distance12){this._distance=distance12,this._maxCurveSegmentError=distance12*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new OffsetSegmentString,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(distance12*OffsetSegmentGenerator.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};OffsetSegmentGenerator.prototype.addCollinear=function(addStartPoint){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var numInt=this._li.getIntersectionNum();numInt>=2&&(this._bufParams.getJoinStyle()===BufferParameters.JOIN_BEVEL||this._bufParams.getJoinStyle()===BufferParameters.JOIN_MITRE?(addStartPoint&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,CGAlgorithms.CLOCKWISE,this._distance))};OffsetSegmentGenerator.prototype.closeRing=function(){this._segList.closeRing()};OffsetSegmentGenerator.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};OffsetSegmentGenerator.prototype.interfaces_=function(){return[]};OffsetSegmentGenerator.prototype.getClass=function(){return OffsetSegmentGenerator};staticAccessors$27.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};staticAccessors$27.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};staticAccessors$27.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};staticAccessors$27.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(OffsetSegmentGenerator,staticAccessors$27);var OffsetCurveBuilder=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var precisionModel=arguments[0],bufParams=arguments[1];this._precisionModel=precisionModel,this._bufParams=bufParams};OffsetCurveBuilder.prototype.getOffsetCurve=function(inputPts,distance12){if(this._distance=distance12,distance12===0)return null;var isRightSide=distance12<0,posDistance=Math.abs(distance12),segGen=this.getSegGen(posDistance);inputPts.length<=1?this.computePointCurve(inputPts[0],segGen):this.computeOffsetCurve(inputPts,isRightSide,segGen);var curvePts=segGen.getCoordinates();return isRightSide&&CoordinateArrays.reverse(curvePts),curvePts};OffsetCurveBuilder.prototype.computeSingleSidedBufferCurve=function(inputPts,isRightSide,segGen){var distTol=this.simplifyTolerance(this._distance);if(isRightSide){segGen.addSegments(inputPts,!0);var simp2=BufferInputLineSimplifier.simplify(inputPts,-distTol),n2=simp2.length-1;segGen.initSideSegments(simp2[n2],simp2[n2-1],Position.LEFT),segGen.addFirstSegment();for(var i=n2-2;i>=0;i--)segGen.addNextSegment(simp2[i],!0)}else{segGen.addSegments(inputPts,!1);var simp1=BufferInputLineSimplifier.simplify(inputPts,distTol),n1=simp1.length-1;segGen.initSideSegments(simp1[0],simp1[1],Position.LEFT),segGen.addFirstSegment();for(var i$1=2;i$1<=n1;i$1++)segGen.addNextSegment(simp1[i$1],!0)}segGen.addLastSegment(),segGen.closeRing()};OffsetCurveBuilder.prototype.computeRingBufferCurve=function(inputPts,side,segGen){var distTol=this.simplifyTolerance(this._distance);side===Position.RIGHT&&(distTol=-distTol);var simp=BufferInputLineSimplifier.simplify(inputPts,distTol),n=simp.length-1;segGen.initSideSegments(simp[n-1],simp[0],side);for(var i=1;i<=n;i++){var addStartPoint=i!==1;segGen.addNextSegment(simp[i],addStartPoint)}segGen.closeRing()};OffsetCurveBuilder.prototype.computeLineBufferCurve=function(inputPts,segGen){var distTol=this.simplifyTolerance(this._distance),simp1=BufferInputLineSimplifier.simplify(inputPts,distTol),n1=simp1.length-1;segGen.initSideSegments(simp1[0],simp1[1],Position.LEFT);for(var i=2;i<=n1;i++)segGen.addNextSegment(simp1[i],!0);segGen.addLastSegment(),segGen.addLineEndCap(simp1[n1-1],simp1[n1]);var simp2=BufferInputLineSimplifier.simplify(inputPts,-distTol),n2=simp2.length-1;segGen.initSideSegments(simp2[n2],simp2[n2-1],Position.LEFT);for(var i$1=n2-2;i$1>=0;i$1--)segGen.addNextSegment(simp2[i$1],!0);segGen.addLastSegment(),segGen.addLineEndCap(simp2[1],simp2[0]),segGen.closeRing()};OffsetCurveBuilder.prototype.computePointCurve=function(pt,segGen){switch(this._bufParams.getEndCapStyle()){case BufferParameters.CAP_ROUND:segGen.createCircle(pt);break;case BufferParameters.CAP_SQUARE:segGen.createSquare(pt);break;default:}};OffsetCurveBuilder.prototype.getLineCurve=function(inputPts,distance12){if(this._distance=distance12,distance12<0&&!this._bufParams.isSingleSided()||distance12===0)return null;var posDistance=Math.abs(distance12),segGen=this.getSegGen(posDistance);if(inputPts.length<=1)this.computePointCurve(inputPts[0],segGen);else if(this._bufParams.isSingleSided()){var isRightSide=distance12<0;this.computeSingleSidedBufferCurve(inputPts,isRightSide,segGen)}else this.computeLineBufferCurve(inputPts,segGen);var lineCoord=segGen.getCoordinates();return lineCoord};OffsetCurveBuilder.prototype.getBufferParameters=function(){return this._bufParams};OffsetCurveBuilder.prototype.simplifyTolerance=function(bufDistance){return bufDistance*this._bufParams.getSimplifyFactor()};OffsetCurveBuilder.prototype.getRingCurve=function(inputPts,side,distance12){if(this._distance=distance12,inputPts.length<=2)return this.getLineCurve(inputPts,distance12);if(distance12===0)return OffsetCurveBuilder.copyCoordinates(inputPts);var segGen=this.getSegGen(distance12);return this.computeRingBufferCurve(inputPts,side,segGen),segGen.getCoordinates()};OffsetCurveBuilder.prototype.computeOffsetCurve=function(inputPts,isRightSide,segGen){var distTol=this.simplifyTolerance(this._distance);if(isRightSide){var simp2=BufferInputLineSimplifier.simplify(inputPts,-distTol),n2=simp2.length-1;segGen.initSideSegments(simp2[n2],simp2[n2-1],Position.LEFT),segGen.addFirstSegment();for(var i=n2-2;i>=0;i--)segGen.addNextSegment(simp2[i],!0)}else{var simp1=BufferInputLineSimplifier.simplify(inputPts,distTol),n1=simp1.length-1;segGen.initSideSegments(simp1[0],simp1[1],Position.LEFT),segGen.addFirstSegment();for(var i$1=2;i$1<=n1;i$1++)segGen.addNextSegment(simp1[i$1],!0)}segGen.addLastSegment()};OffsetCurveBuilder.prototype.getSegGen=function(distance12){return new OffsetSegmentGenerator(this._precisionModel,this._bufParams,distance12)};OffsetCurveBuilder.prototype.interfaces_=function(){return[]};OffsetCurveBuilder.prototype.getClass=function(){return OffsetCurveBuilder};OffsetCurveBuilder.copyCoordinates=function(pts){for(var copy7=new Array(pts.length).fill(null),i=0;i<copy7.length;i++)copy7[i]=new Coordinate(pts[i]);return copy7};var SubgraphDepthLocater=function(){this._subgraphs=null,this._seg=new LineSegment,this._cga=new CGAlgorithms;var subgraphs=arguments[0];this._subgraphs=subgraphs},staticAccessors$30={DepthSegment:{configurable:!0}};SubgraphDepthLocater.prototype.findStabbedSegments=function(){var this$1=this;if(arguments.length===1){for(var stabbingRayLeftPt=arguments[0],stabbedSegments=new ArrayList,i=this._subgraphs.iterator();i.hasNext();){var bsg=i.next(),env=bsg.getEnvelope();stabbingRayLeftPt.y<env.getMinY()||stabbingRayLeftPt.y>env.getMaxY()||this$1.findStabbedSegments(stabbingRayLeftPt,bsg.getDirectedEdges(),stabbedSegments)}return stabbedSegments}else if(arguments.length===3){if(hasInterface(arguments[2],List)&&arguments[0]instanceof Coordinate&&arguments[1]instanceof DirectedEdge)for(var stabbingRayLeftPt$1=arguments[0],dirEdge=arguments[1],stabbedSegments$1=arguments[2],pts=dirEdge.getEdge().getCoordinates(),i$1=0;i$1<pts.length-1;i$1++){this$1._seg.p0=pts[i$1],this$1._seg.p1=pts[i$1+1],this$1._seg.p0.y>this$1._seg.p1.y&&this$1._seg.reverse();var maxx=Math.max(this$1._seg.p0.x,this$1._seg.p1.x);if(!(maxx<stabbingRayLeftPt$1.x)&&!this$1._seg.isHorizontal()&&!(stabbingRayLeftPt$1.y<this$1._seg.p0.y||stabbingRayLeftPt$1.y>this$1._seg.p1.y)&&CGAlgorithms.computeOrientation(this$1._seg.p0,this$1._seg.p1,stabbingRayLeftPt$1)!==CGAlgorithms.RIGHT){var depth2=dirEdge.getDepth(Position.LEFT);this$1._seg.p0.equals(pts[i$1])||(depth2=dirEdge.getDepth(Position.RIGHT));var ds=new DepthSegment(this$1._seg,depth2);stabbedSegments$1.add(ds)}}else if(hasInterface(arguments[2],List)&&arguments[0]instanceof Coordinate&&hasInterface(arguments[1],List))for(var stabbingRayLeftPt$2=arguments[0],dirEdges=arguments[1],stabbedSegments$2=arguments[2],i$2=dirEdges.iterator();i$2.hasNext();){var de=i$2.next();!de.isForward()||this$1.findStabbedSegments(stabbingRayLeftPt$2,de,stabbedSegments$2)}}};SubgraphDepthLocater.prototype.getDepth=function(p){var stabbedSegments=this.findStabbedSegments(p);if(stabbedSegments.size()===0)return 0;var ds=Collections.min(stabbedSegments);return ds._leftDepth};SubgraphDepthLocater.prototype.interfaces_=function(){return[]};SubgraphDepthLocater.prototype.getClass=function(){return SubgraphDepthLocater};staticAccessors$30.DepthSegment.get=function(){return DepthSegment};Object.defineProperties(SubgraphDepthLocater,staticAccessors$30);var DepthSegment=function(){this._upwardSeg=null,this._leftDepth=null;var seg=arguments[0],depth2=arguments[1];this._upwardSeg=new LineSegment(seg),this._leftDepth=depth2};DepthSegment.prototype.compareTo=function(obj){var other=obj;if(this._upwardSeg.minX()>=other._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=other._upwardSeg.minX())return-1;var orientIndex=this._upwardSeg.orientationIndex(other._upwardSeg);return orientIndex!==0||(orientIndex=-1*other._upwardSeg.orientationIndex(this._upwardSeg),orientIndex!==0)?orientIndex:this._upwardSeg.compareTo(other._upwardSeg)};DepthSegment.prototype.compareX=function(seg0,seg1){var compare0=seg0.p0.compareTo(seg1.p0);return compare0!==0?compare0:seg0.p1.compareTo(seg1.p1)};DepthSegment.prototype.toString=function(){return this._upwardSeg.toString()};DepthSegment.prototype.interfaces_=function(){return[Comparable]};DepthSegment.prototype.getClass=function(){return DepthSegment};var Triangle$1=function(p0,p1,p2){this.p0=p0||null,this.p1=p1||null,this.p2=p2||null};Triangle$1.prototype.area=function(){return Triangle$1.area(this.p0,this.p1,this.p2)};Triangle$1.prototype.signedArea=function(){return Triangle$1.signedArea(this.p0,this.p1,this.p2)};Triangle$1.prototype.interpolateZ=function(p){if(p===null)throw new IllegalArgumentException("Supplied point is null.");return Triangle$1.interpolateZ(p,this.p0,this.p1,this.p2)};Triangle$1.prototype.longestSideLength=function(){return Triangle$1.longestSideLength(this.p0,this.p1,this.p2)};Triangle$1.prototype.isAcute=function(){return Triangle$1.isAcute(this.p0,this.p1,this.p2)};Triangle$1.prototype.circumcentre=function(){return Triangle$1.circumcentre(this.p0,this.p1,this.p2)};Triangle$1.prototype.area3D=function(){return Triangle$1.area3D(this.p0,this.p1,this.p2)};Triangle$1.prototype.centroid=function(){return Triangle$1.centroid(this.p0,this.p1,this.p2)};Triangle$1.prototype.inCentre=function(){return Triangle$1.inCentre(this.p0,this.p1,this.p2)};Triangle$1.prototype.interfaces_=function(){return[]};Triangle$1.prototype.getClass=function(){return Triangle$1};Triangle$1.area=function(a,b,c){return Math.abs(((c.x-a.x)*(b.y-a.y)-(b.x-a.x)*(c.y-a.y))/2)};Triangle$1.signedArea=function(a,b,c){return((c.x-a.x)*(b.y-a.y)-(b.x-a.x)*(c.y-a.y))/2};Triangle$1.det=function(m00,m01,m10,m11){return m00*m11-m01*m10};Triangle$1.interpolateZ=function(p,v0,v1,v2){var x0=v0.x,y0=v0.y,a=v1.x-x0,b=v2.x-x0,c=v1.y-y0,d=v2.y-y0,det2=a*d-b*c,dx=p.x-x0,dy=p.y-y0,t=(d*dx-b*dy)/det2,u=(-c*dx+a*dy)/det2,z=v0.z+t*(v1.z-v0.z)+u*(v2.z-v0.z);return z};Triangle$1.longestSideLength=function(a,b,c){var lenAB=a.distance(b),lenBC=b.distance(c),lenCA=c.distance(a),maxLen=lenAB;return lenBC>maxLen&&(maxLen=lenBC),lenCA>maxLen&&(maxLen=lenCA),maxLen};Triangle$1.isAcute=function(a,b,c){return!(!Angle.isAcute(a,b,c)||!Angle.isAcute(b,c,a)||!Angle.isAcute(c,a,b))};Triangle$1.circumcentre=function(a,b,c){var cx=c.x,cy=c.y,ax=a.x-cx,ay=a.y-cy,bx=b.x-cx,by=b.y-cy,denom=2*Triangle$1.det(ax,ay,bx,by),numx=Triangle$1.det(ay,ax*ax+ay*ay,by,bx*bx+by*by),numy=Triangle$1.det(ax,ax*ax+ay*ay,bx,bx*bx+by*by),ccx=cx-numx/denom,ccy=cy+numy/denom;return new Coordinate(ccx,ccy)};Triangle$1.perpendicularBisector=function(a,b){var dx=b.x-a.x,dy=b.y-a.y,l1=new HCoordinate(a.x+dx/2,a.y+dy/2,1),l2=new HCoordinate(a.x-dy+dx/2,a.y+dx+dy/2,1);return new HCoordinate(l1,l2)};Triangle$1.angleBisector=function(a,b,c){var len0=b.distance(a),len2=b.distance(c),frac=len0/(len0+len2),dx=c.x-a.x,dy=c.y-a.y,splitPt=new Coordinate(a.x+frac*dx,a.y+frac*dy);return splitPt};Triangle$1.area3D=function(a,b,c){var ux=b.x-a.x,uy=b.y-a.y,uz=b.z-a.z,vx=c.x-a.x,vy=c.y-a.y,vz=c.z-a.z,crossx=uy*vz-uz*vy,crossy=uz*vx-ux*vz,crossz=ux*vy-uy*vx,absSq=crossx*crossx+crossy*crossy+crossz*crossz,area3D3=Math.sqrt(absSq)/2;return area3D3};Triangle$1.centroid=function(a,b,c){var x2=(a.x+b.x+c.x)/3,y2=(a.y+b.y+c.y)/3;return new Coordinate(x2,y2)};Triangle$1.inCentre=function(a,b,c){var len0=b.distance(c),len1=a.distance(c),len2=a.distance(b),circum=len0+len1+len2,inCentreX=(len0*a.x+len1*b.x+len2*c.x)/circum,inCentreY=(len0*a.y+len1*b.y+len2*c.y)/circum;return new Coordinate(inCentreX,inCentreY)};var OffsetCurveSetBuilder=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new ArrayList;var inputGeom=arguments[0],distance12=arguments[1],curveBuilder=arguments[2];this._inputGeom=inputGeom,this._distance=distance12,this._curveBuilder=curveBuilder};OffsetCurveSetBuilder.prototype.addPoint=function(p){if(this._distance<=0)return null;var coord=p.getCoordinates(),curve=this._curveBuilder.getLineCurve(coord,this._distance);this.addCurve(curve,Location.EXTERIOR,Location.INTERIOR)};OffsetCurveSetBuilder.prototype.addPolygon=function(p){var this$1=this,offsetDistance=this._distance,offsetSide=Position.LEFT;this._distance<0&&(offsetDistance=-this._distance,offsetSide=Position.RIGHT);var shell=p.getExteriorRing(),shellCoord=CoordinateArrays.removeRepeatedPoints(shell.getCoordinates());if(this._distance<0&&this.isErodedCompletely(shell,this._distance)||this._distance<=0&&shellCoord.length<3)return null;this.addPolygonRing(shellCoord,offsetDistance,offsetSide,Location.EXTERIOR,Location.INTERIOR);for(var i=0;i<p.getNumInteriorRing();i++){var hole=p.getInteriorRingN(i),holeCoord=CoordinateArrays.removeRepeatedPoints(hole.getCoordinates());this$1._distance>0&&this$1.isErodedCompletely(hole,-this$1._distance)||this$1.addPolygonRing(holeCoord,offsetDistance,Position.opposite(offsetSide),Location.INTERIOR,Location.EXTERIOR)}};OffsetCurveSetBuilder.prototype.isTriangleErodedCompletely=function(triangleCoord,bufferDistance){var tri=new Triangle$1(triangleCoord[0],triangleCoord[1],triangleCoord[2]),inCentre3=tri.inCentre(),distToCentre=CGAlgorithms.distancePointLine(inCentre3,tri.p0,tri.p1);return distToCentre<Math.abs(bufferDistance)};OffsetCurveSetBuilder.prototype.addLineString=function(line){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var coord=CoordinateArrays.removeRepeatedPoints(line.getCoordinates()),curve=this._curveBuilder.getLineCurve(coord,this._distance);this.addCurve(curve,Location.EXTERIOR,Location.INTERIOR)};OffsetCurveSetBuilder.prototype.addCurve=function(coord,leftLoc,rightLoc){if(coord===null||coord.length<2)return null;var e=new NodedSegmentString(coord,new Label(0,Location.BOUNDARY,leftLoc,rightLoc));this._curveList.add(e)};OffsetCurveSetBuilder.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};OffsetCurveSetBuilder.prototype.addPolygonRing=function(coord,offsetDistance,side,cwLeftLoc,cwRightLoc){if(offsetDistance===0&&coord.length<LinearRing.MINIMUM_VALID_SIZE)return null;var leftLoc=cwLeftLoc,rightLoc=cwRightLoc;coord.length>=LinearRing.MINIMUM_VALID_SIZE&&CGAlgorithms.isCCW(coord)&&(leftLoc=cwRightLoc,rightLoc=cwLeftLoc,side=Position.opposite(side));var curve=this._curveBuilder.getRingCurve(coord,side,offsetDistance);this.addCurve(curve,leftLoc,rightLoc)};OffsetCurveSetBuilder.prototype.add=function(g){if(g.isEmpty())return null;g instanceof Polygon?this.addPolygon(g):g instanceof LineString$1?this.addLineString(g):g instanceof Point?this.addPoint(g):g instanceof MultiPoint?this.addCollection(g):g instanceof MultiLineString?this.addCollection(g):g instanceof MultiPolygon?this.addCollection(g):g instanceof GeometryCollection&&this.addCollection(g)};OffsetCurveSetBuilder.prototype.isErodedCompletely=function(ring,bufferDistance){var ringCoord=ring.getCoordinates();if(ringCoord.length<4)return bufferDistance<0;if(ringCoord.length===4)return this.isTriangleErodedCompletely(ringCoord,bufferDistance);var env=ring.getEnvelopeInternal(),envMinDimension=Math.min(env.getHeight(),env.getWidth());return bufferDistance<0&&2*Math.abs(bufferDistance)>envMinDimension};OffsetCurveSetBuilder.prototype.addCollection=function(gc){for(var this$1=this,i=0;i<gc.getNumGeometries();i++){var g=gc.getGeometryN(i);this$1.add(g)}};OffsetCurveSetBuilder.prototype.interfaces_=function(){return[]};OffsetCurveSetBuilder.prototype.getClass=function(){return OffsetCurveSetBuilder};var PointOnGeometryLocator=function(){};PointOnGeometryLocator.prototype.locate=function(p){};PointOnGeometryLocator.prototype.interfaces_=function(){return[]};PointOnGeometryLocator.prototype.getClass=function(){return PointOnGeometryLocator};var GeometryCollectionIterator=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var parent=arguments[0];this._parent=parent,this._atStart=!0,this._index=0,this._max=parent.getNumGeometries()};GeometryCollectionIterator.prototype.next=function(){if(this._atStart)return this._atStart=!1,GeometryCollectionIterator.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new NoSuchElementException;var obj=this._parent.getGeometryN(this._index++);return obj instanceof GeometryCollection?(this._subcollectionIterator=new GeometryCollectionIterator(obj),this._subcollectionIterator.next()):obj};GeometryCollectionIterator.prototype.remove=function(){throw new Error(this.getClass().getName())};GeometryCollectionIterator.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};GeometryCollectionIterator.prototype.interfaces_=function(){return[Iterator]};GeometryCollectionIterator.prototype.getClass=function(){return GeometryCollectionIterator};GeometryCollectionIterator.isAtomic=function(geom){return!(geom instanceof GeometryCollection)};var SimplePointInAreaLocator=function(){this._geom=null;var geom=arguments[0];this._geom=geom};SimplePointInAreaLocator.prototype.locate=function(p){return SimplePointInAreaLocator.locate(p,this._geom)};SimplePointInAreaLocator.prototype.interfaces_=function(){return[PointOnGeometryLocator]};SimplePointInAreaLocator.prototype.getClass=function(){return SimplePointInAreaLocator};SimplePointInAreaLocator.isPointInRing=function(p,ring){return ring.getEnvelopeInternal().intersects(p)?CGAlgorithms.isPointInRing(p,ring.getCoordinates()):!1};SimplePointInAreaLocator.containsPointInPolygon=function(p,poly){if(poly.isEmpty())return!1;var shell=poly.getExteriorRing();if(!SimplePointInAreaLocator.isPointInRing(p,shell))return!1;for(var i=0;i<poly.getNumInteriorRing();i++){var hole=poly.getInteriorRingN(i);if(SimplePointInAreaLocator.isPointInRing(p,hole))return!1}return!0};SimplePointInAreaLocator.containsPoint=function(p,geom){if(geom instanceof Polygon)return SimplePointInAreaLocator.containsPointInPolygon(p,geom);if(geom instanceof GeometryCollection)for(var geomi=new GeometryCollectionIterator(geom);geomi.hasNext();){var g2=geomi.next();if(g2!==geom&&SimplePointInAreaLocator.containsPoint(p,g2))return!0}return!1};SimplePointInAreaLocator.locate=function(p,geom){return geom.isEmpty()?Location.EXTERIOR:SimplePointInAreaLocator.containsPoint(p,geom)?Location.INTERIOR:Location.EXTERIOR};var EdgeEndStar=function(){this._edgeMap=new TreeMap,this._edgeList=null,this._ptInAreaLocation=[Location.NONE,Location.NONE]};EdgeEndStar.prototype.getNextCW=function(ee){this.getEdges();var i=this._edgeList.indexOf(ee),iNextCW=i-1;return i===0&&(iNextCW=this._edgeList.size()-1),this._edgeList.get(iNextCW)};EdgeEndStar.prototype.propagateSideLabels=function(geomIndex){for(var startLoc=Location.NONE,it=this.iterator();it.hasNext();){var e=it.next(),label=e.getLabel();label.isArea(geomIndex)&&label.getLocation(geomIndex,Position.LEFT)!==Location.NONE&&(startLoc=label.getLocation(geomIndex,Position.LEFT))}if(startLoc===Location.NONE)return null;for(var currLoc=startLoc,it$1=this.iterator();it$1.hasNext();){var e$1=it$1.next(),label$1=e$1.getLabel();if(label$1.getLocation(geomIndex,Position.ON)===Location.NONE&&label$1.setLocation(geomIndex,Position.ON,currLoc),label$1.isArea(geomIndex)){var leftLoc=label$1.getLocation(geomIndex,Position.LEFT),rightLoc=label$1.getLocation(geomIndex,Position.RIGHT);if(rightLoc!==Location.NONE){if(rightLoc!==currLoc)throw new TopologyException("side location conflict",e$1.getCoordinate());leftLoc===Location.NONE&&Assert.shouldNeverReachHere("found single null side (at "+e$1.getCoordinate()+")"),currLoc=leftLoc}else Assert.isTrue(label$1.getLocation(geomIndex,Position.LEFT)===Location.NONE,"found single null side"),label$1.setLocation(geomIndex,Position.RIGHT,currLoc),label$1.setLocation(geomIndex,Position.LEFT,currLoc)}}};EdgeEndStar.prototype.getCoordinate=function(){var it=this.iterator();if(!it.hasNext())return null;var e=it.next();return e.getCoordinate()};EdgeEndStar.prototype.print=function(out){System.out.println("EdgeEndStar:   "+this.getCoordinate());for(var it=this.iterator();it.hasNext();){var e=it.next();e.print(out)}};EdgeEndStar.prototype.isAreaLabelsConsistent=function(geomGraph){return this.computeEdgeEndLabels(geomGraph.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};EdgeEndStar.prototype.checkAreaLabelsConsistent=function(geomIndex){var edges2=this.getEdges();if(edges2.size()<=0)return!0;var lastEdgeIndex=edges2.size()-1,startLabel=edges2.get(lastEdgeIndex).getLabel(),startLoc=startLabel.getLocation(geomIndex,Position.LEFT);Assert.isTrue(startLoc!==Location.NONE,"Found unlabelled area edge");for(var currLoc=startLoc,it=this.iterator();it.hasNext();){var e=it.next(),label=e.getLabel();Assert.isTrue(label.isArea(geomIndex),"Found non-area edge");var leftLoc=label.getLocation(geomIndex,Position.LEFT),rightLoc=label.getLocation(geomIndex,Position.RIGHT);if(leftLoc===rightLoc||rightLoc!==currLoc)return!1;currLoc=leftLoc}return!0};EdgeEndStar.prototype.findIndex=function(eSearch){var this$1=this;this.iterator();for(var i=0;i<this._edgeList.size();i++){var e=this$1._edgeList.get(i);if(e===eSearch)return i}return-1};EdgeEndStar.prototype.iterator=function(){return this.getEdges().iterator()};EdgeEndStar.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new ArrayList(this._edgeMap.values())),this._edgeList};EdgeEndStar.prototype.getLocation=function(geomIndex,p,geom){return this._ptInAreaLocation[geomIndex]===Location.NONE&&(this._ptInAreaLocation[geomIndex]=SimplePointInAreaLocator.locate(p,geom[geomIndex].getGeometry())),this._ptInAreaLocation[geomIndex]};EdgeEndStar.prototype.toString=function(){var buf=new StringBuffer;buf.append("EdgeEndStar:   "+this.getCoordinate()),buf.append(`
`);for(var it=this.iterator();it.hasNext();){var e=it.next();buf.append(e),buf.append(`
`)}return buf.toString()};EdgeEndStar.prototype.computeEdgeEndLabels=function(boundaryNodeRule){for(var it=this.iterator();it.hasNext();){var ee=it.next();ee.computeLabel(boundaryNodeRule)}};EdgeEndStar.prototype.computeLabelling=function(geomGraph){var this$1=this;this.computeEdgeEndLabels(geomGraph[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var hasDimensionalCollapseEdge=[!1,!1],it=this.iterator();it.hasNext();)for(var e=it.next(),label=e.getLabel(),geomi=0;geomi<2;geomi++)label.isLine(geomi)&&label.getLocation(geomi)===Location.BOUNDARY&&(hasDimensionalCollapseEdge[geomi]=!0);for(var it$1=this.iterator();it$1.hasNext();)for(var e$1=it$1.next(),label$1=e$1.getLabel(),geomi$1=0;geomi$1<2;geomi$1++)if(label$1.isAnyNull(geomi$1)){var loc=Location.NONE;if(hasDimensionalCollapseEdge[geomi$1])loc=Location.EXTERIOR;else{var p=e$1.getCoordinate();loc=this$1.getLocation(geomi$1,p,geomGraph)}label$1.setAllLocationsIfNull(geomi$1,loc)}};EdgeEndStar.prototype.getDegree=function(){return this._edgeMap.size()};EdgeEndStar.prototype.insertEdgeEnd=function(e,obj){this._edgeMap.put(e,obj),this._edgeList=null};EdgeEndStar.prototype.interfaces_=function(){return[]};EdgeEndStar.prototype.getClass=function(){return EdgeEndStar};var DirectedEdgeStar=function(EdgeEndStar$$1){function DirectedEdgeStar2(){EdgeEndStar$$1.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return EdgeEndStar$$1&&(DirectedEdgeStar2.__proto__=EdgeEndStar$$1),DirectedEdgeStar2.prototype=Object.create(EdgeEndStar$$1&&EdgeEndStar$$1.prototype),DirectedEdgeStar2.prototype.constructor=DirectedEdgeStar2,DirectedEdgeStar2.prototype.linkResultDirectedEdges=function(){var this$1=this;this.getResultAreaEdges();for(var firstOut=null,incoming=null,state=this._SCANNING_FOR_INCOMING,i=0;i<this._resultAreaEdgeList.size();i++){var nextOut=this$1._resultAreaEdgeList.get(i),nextIn=nextOut.getSym();if(!!nextOut.getLabel().isArea())switch(firstOut===null&&nextOut.isInResult()&&(firstOut=nextOut),state){case this$1._SCANNING_FOR_INCOMING:if(!nextIn.isInResult())continue;incoming=nextIn,state=this$1._LINKING_TO_OUTGOING;break;case this$1._LINKING_TO_OUTGOING:if(!nextOut.isInResult())continue;incoming.setNext(nextOut),state=this$1._SCANNING_FOR_INCOMING;break;default:}}if(state===this._LINKING_TO_OUTGOING){if(firstOut===null)throw new TopologyException("no outgoing dirEdge found",this.getCoordinate());Assert.isTrue(firstOut.isInResult(),"unable to link last incoming dirEdge"),incoming.setNext(firstOut)}},DirectedEdgeStar2.prototype.insert=function(ee){var de=ee;this.insertEdgeEnd(de,de)},DirectedEdgeStar2.prototype.getRightmostEdge=function(){var edges2=this.getEdges(),size11=edges2.size();if(size11<1)return null;var de0=edges2.get(0);if(size11===1)return de0;var deLast=edges2.get(size11-1),quad0=de0.getQuadrant(),quad1=deLast.getQuadrant();return Quadrant.isNorthern(quad0)&&Quadrant.isNorthern(quad1)?de0:!Quadrant.isNorthern(quad0)&&!Quadrant.isNorthern(quad1)?deLast:de0.getDy()!==0?de0:deLast.getDy()!==0?deLast:(Assert.shouldNeverReachHere("found two horizontal edges incident on node"),null)},DirectedEdgeStar2.prototype.print=function(out){System.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var it=this.iterator();it.hasNext();){var de=it.next();out.print("out "),de.print(out),out.println(),out.print("in "),de.getSym().print(out),out.println()}},DirectedEdgeStar2.prototype.getResultAreaEdges=function(){var this$1=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new ArrayList;for(var it=this.iterator();it.hasNext();){var de=it.next();(de.isInResult()||de.getSym().isInResult())&&this$1._resultAreaEdgeList.add(de)}return this._resultAreaEdgeList},DirectedEdgeStar2.prototype.updateLabelling=function(nodeLabel){for(var it=this.iterator();it.hasNext();){var de=it.next(),label=de.getLabel();label.setAllLocationsIfNull(0,nodeLabel.getLocation(0)),label.setAllLocationsIfNull(1,nodeLabel.getLocation(1))}},DirectedEdgeStar2.prototype.linkAllDirectedEdges=function(){var this$1=this;this.getEdges();for(var prevOut=null,firstIn=null,i=this._edgeList.size()-1;i>=0;i--){var nextOut=this$1._edgeList.get(i),nextIn=nextOut.getSym();firstIn===null&&(firstIn=nextIn),prevOut!==null&&nextIn.setNext(prevOut),prevOut=nextOut}firstIn.setNext(prevOut)},DirectedEdgeStar2.prototype.computeDepths=function(){var this$1=this;if(arguments.length===1){var de=arguments[0],edgeIndex=this.findIndex(de),startDepth=de.getDepth(Position.LEFT),targetLastDepth=de.getDepth(Position.RIGHT),nextDepth=this.computeDepths(edgeIndex+1,this._edgeList.size(),startDepth),lastDepth=this.computeDepths(0,edgeIndex,nextDepth);if(lastDepth!==targetLastDepth)throw new TopologyException("depth mismatch at "+de.getCoordinate())}else if(arguments.length===3){for(var startIndex=arguments[0],endIndex=arguments[1],startDepth$1=arguments[2],currDepth=startDepth$1,i=startIndex;i<endIndex;i++){var nextDe=this$1._edgeList.get(i);nextDe.setEdgeDepths(Position.RIGHT,currDepth),currDepth=nextDe.getDepth(Position.LEFT)}return currDepth}},DirectedEdgeStar2.prototype.mergeSymLabels=function(){for(var it=this.iterator();it.hasNext();){var de=it.next(),label=de.getLabel();label.merge(de.getSym().getLabel())}},DirectedEdgeStar2.prototype.linkMinimalDirectedEdges=function(er){for(var this$1=this,firstOut=null,incoming=null,state=this._SCANNING_FOR_INCOMING,i=this._resultAreaEdgeList.size()-1;i>=0;i--){var nextOut=this$1._resultAreaEdgeList.get(i),nextIn=nextOut.getSym();switch(firstOut===null&&nextOut.getEdgeRing()===er&&(firstOut=nextOut),state){case this$1._SCANNING_FOR_INCOMING:if(nextIn.getEdgeRing()!==er)continue;incoming=nextIn,state=this$1._LINKING_TO_OUTGOING;break;case this$1._LINKING_TO_OUTGOING:if(nextOut.getEdgeRing()!==er)continue;incoming.setNextMin(nextOut),state=this$1._SCANNING_FOR_INCOMING;break;default:}}state===this._LINKING_TO_OUTGOING&&(Assert.isTrue(firstOut!==null,"found null for first outgoing dirEdge"),Assert.isTrue(firstOut.getEdgeRing()===er,"unable to link last incoming dirEdge"),incoming.setNextMin(firstOut))},DirectedEdgeStar2.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var degree=0,it=this.iterator();it.hasNext();){var de=it.next();de.isInResult()&&degree++}return degree}else if(arguments.length===1){for(var er=arguments[0],degree$1=0,it$1=this.iterator();it$1.hasNext();){var de$1=it$1.next();de$1.getEdgeRing()===er&&degree$1++}return degree$1}},DirectedEdgeStar2.prototype.getLabel=function(){return this._label},DirectedEdgeStar2.prototype.findCoveredLineEdges=function(){for(var startLoc=Location.NONE,it=this.iterator();it.hasNext();){var nextOut=it.next(),nextIn=nextOut.getSym();if(!nextOut.isLineEdge()){if(nextOut.isInResult()){startLoc=Location.INTERIOR;break}if(nextIn.isInResult()){startLoc=Location.EXTERIOR;break}}}if(startLoc===Location.NONE)return null;for(var currLoc=startLoc,it$1=this.iterator();it$1.hasNext();){var nextOut$1=it$1.next(),nextIn$1=nextOut$1.getSym();nextOut$1.isLineEdge()?nextOut$1.getEdge().setCovered(currLoc===Location.INTERIOR):(nextOut$1.isInResult()&&(currLoc=Location.EXTERIOR),nextIn$1.isInResult()&&(currLoc=Location.INTERIOR))}},DirectedEdgeStar2.prototype.computeLabelling=function(geom){var this$1=this;EdgeEndStar$$1.prototype.computeLabelling.call(this,geom),this._label=new Label(Location.NONE);for(var it=this.iterator();it.hasNext();)for(var ee=it.next(),e=ee.getEdge(),eLabel=e.getLabel(),i=0;i<2;i++){var eLoc=eLabel.getLocation(i);(eLoc===Location.INTERIOR||eLoc===Location.BOUNDARY)&&this$1._label.setLocation(i,Location.INTERIOR)}},DirectedEdgeStar2.prototype.interfaces_=function(){return[]},DirectedEdgeStar2.prototype.getClass=function(){return DirectedEdgeStar2},DirectedEdgeStar2}(EdgeEndStar),OverlayNodeFactory=function(NodeFactory$$1){function OverlayNodeFactory2(){NodeFactory$$1.apply(this,arguments)}return NodeFactory$$1&&(OverlayNodeFactory2.__proto__=NodeFactory$$1),OverlayNodeFactory2.prototype=Object.create(NodeFactory$$1&&NodeFactory$$1.prototype),OverlayNodeFactory2.prototype.constructor=OverlayNodeFactory2,OverlayNodeFactory2.prototype.createNode=function(coord){return new Node$2(coord,new DirectedEdgeStar)},OverlayNodeFactory2.prototype.interfaces_=function(){return[]},OverlayNodeFactory2.prototype.getClass=function(){return OverlayNodeFactory2},OverlayNodeFactory2}(NodeFactory),OrientedCoordinateArray=function OrientedCoordinateArray2(){this._pts=null,this._orientation=null;var pts=arguments[0];this._pts=pts,this._orientation=OrientedCoordinateArray2.orientation(pts)};OrientedCoordinateArray.prototype.compareTo=function(o1){var oca=o1,comp=OrientedCoordinateArray.compareOriented(this._pts,this._orientation,oca._pts,oca._orientation);return comp};OrientedCoordinateArray.prototype.interfaces_=function(){return[Comparable]};OrientedCoordinateArray.prototype.getClass=function(){return OrientedCoordinateArray};OrientedCoordinateArray.orientation=function(pts){return CoordinateArrays.increasingDirection(pts)===1};OrientedCoordinateArray.compareOriented=function(pts1,orientation1,pts2,orientation2){for(var dir1=orientation1?1:-1,dir2=orientation2?1:-1,limit1=orientation1?pts1.length:-1,limit2=orientation2?pts2.length:-1,i1=orientation1?0:pts1.length-1,i2=orientation2?0:pts2.length-1;;){var compPt=pts1[i1].compareTo(pts2[i2]);if(compPt!==0)return compPt;i1+=dir1,i2+=dir2;var done1=i1===limit1,done2=i2===limit2;if(done1&&!done2)return-1;if(!done1&&done2)return 1;if(done1&&done2)return 0}};var EdgeList=function(){this._edges=new ArrayList,this._ocaMap=new TreeMap};EdgeList.prototype.print=function(out){var this$1=this;out.print("MULTILINESTRING ( ");for(var j=0;j<this._edges.size();j++){var e=this$1._edges.get(j);j>0&&out.print(","),out.print("(");for(var pts=e.getCoordinates(),i=0;i<pts.length;i++)i>0&&out.print(","),out.print(pts[i].x+" "+pts[i].y);out.println(")")}out.print(")  ")};EdgeList.prototype.addAll=function(edgeColl){for(var this$1=this,i=edgeColl.iterator();i.hasNext();)this$1.add(i.next())};EdgeList.prototype.findEdgeIndex=function(e){for(var this$1=this,i=0;i<this._edges.size();i++)if(this$1._edges.get(i).equals(e))return i;return-1};EdgeList.prototype.iterator=function(){return this._edges.iterator()};EdgeList.prototype.getEdges=function(){return this._edges};EdgeList.prototype.get=function(i){return this._edges.get(i)};EdgeList.prototype.findEqualEdge=function(e){var oca=new OrientedCoordinateArray(e.getCoordinates()),matchEdge=this._ocaMap.get(oca);return matchEdge};EdgeList.prototype.add=function(e){this._edges.add(e);var oca=new OrientedCoordinateArray(e.getCoordinates());this._ocaMap.put(oca,e)};EdgeList.prototype.interfaces_=function(){return[]};EdgeList.prototype.getClass=function(){return EdgeList};var SegmentIntersector=function(){};SegmentIntersector.prototype.processIntersections=function(e0,segIndex0,e1,segIndex1){};SegmentIntersector.prototype.isDone=function(){};SegmentIntersector.prototype.interfaces_=function(){return[]};SegmentIntersector.prototype.getClass=function(){return SegmentIntersector};var IntersectionAdder=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var li=arguments[0];this._li=li};IntersectionAdder.prototype.isTrivialIntersection=function(e0,segIndex0,e1,segIndex1){if(e0===e1&&this._li.getIntersectionNum()===1){if(IntersectionAdder.isAdjacentSegments(segIndex0,segIndex1))return!0;if(e0.isClosed()){var maxSegIndex=e0.size()-1;if(segIndex0===0&&segIndex1===maxSegIndex||segIndex1===0&&segIndex0===maxSegIndex)return!0}}return!1};IntersectionAdder.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};IntersectionAdder.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};IntersectionAdder.prototype.getLineIntersector=function(){return this._li};IntersectionAdder.prototype.hasProperIntersection=function(){return this._hasProper};IntersectionAdder.prototype.processIntersections=function(e0,segIndex0,e1,segIndex1){if(e0===e1&&segIndex0===segIndex1)return null;this.numTests++;var p002=e0.getCoordinates()[segIndex0],p012=e0.getCoordinates()[segIndex0+1],p102=e1.getCoordinates()[segIndex1],p112=e1.getCoordinates()[segIndex1+1];this._li.computeIntersection(p002,p012,p102,p112),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e0,segIndex0,e1,segIndex1)||(this._hasIntersection=!0,e0.addIntersections(this._li,segIndex0,0),e1.addIntersections(this._li,segIndex1,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};IntersectionAdder.prototype.hasIntersection=function(){return this._hasIntersection};IntersectionAdder.prototype.isDone=function(){return!1};IntersectionAdder.prototype.hasInteriorIntersection=function(){return this._hasInterior};IntersectionAdder.prototype.interfaces_=function(){return[SegmentIntersector]};IntersectionAdder.prototype.getClass=function(){return IntersectionAdder};IntersectionAdder.isAdjacentSegments=function(i1,i2){return Math.abs(i1-i2)===1};var EdgeIntersection=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var coord=arguments[0],segmentIndex=arguments[1],dist2=arguments[2];this.coord=new Coordinate(coord),this.segmentIndex=segmentIndex,this.dist=dist2};EdgeIntersection.prototype.getSegmentIndex=function(){return this.segmentIndex};EdgeIntersection.prototype.getCoordinate=function(){return this.coord};EdgeIntersection.prototype.print=function(out){out.print(this.coord),out.print(" seg # = "+this.segmentIndex),out.println(" dist = "+this.dist)};EdgeIntersection.prototype.compareTo=function(obj){var other=obj;return this.compare(other.segmentIndex,other.dist)};EdgeIntersection.prototype.isEndPoint=function(maxSegmentIndex){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===maxSegmentIndex};EdgeIntersection.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};EdgeIntersection.prototype.getDistance=function(){return this.dist};EdgeIntersection.prototype.compare=function(segmentIndex,dist2){return this.segmentIndex<segmentIndex?-1:this.segmentIndex>segmentIndex?1:this.dist<dist2?-1:this.dist>dist2?1:0};EdgeIntersection.prototype.interfaces_=function(){return[Comparable]};EdgeIntersection.prototype.getClass=function(){return EdgeIntersection};var EdgeIntersectionList=function(){this._nodeMap=new TreeMap,this.edge=null;var edge=arguments[0];this.edge=edge};EdgeIntersectionList.prototype.print=function(out){out.println("Intersections:");for(var it=this.iterator();it.hasNext();){var ei=it.next();ei.print(out)}};EdgeIntersectionList.prototype.iterator=function(){return this._nodeMap.values().iterator()};EdgeIntersectionList.prototype.addSplitEdges=function(edgeList){var this$1=this;this.addEndpoints();for(var it=this.iterator(),eiPrev=it.next();it.hasNext();){var ei=it.next(),newEdge=this$1.createSplitEdge(eiPrev,ei);edgeList.add(newEdge),eiPrev=ei}};EdgeIntersectionList.prototype.addEndpoints=function(){var maxSegIndex=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[maxSegIndex],maxSegIndex,0)};EdgeIntersectionList.prototype.createSplitEdge=function(ei0,ei1){var this$1=this,npts=ei1.segmentIndex-ei0.segmentIndex+2,lastSegStartPt=this.edge.pts[ei1.segmentIndex],useIntPt1=ei1.dist>0||!ei1.coord.equals2D(lastSegStartPt);useIntPt1||npts--;var pts=new Array(npts).fill(null),ipt=0;pts[ipt++]=new Coordinate(ei0.coord);for(var i=ei0.segmentIndex+1;i<=ei1.segmentIndex;i++)pts[ipt++]=this$1.edge.pts[i];return useIntPt1&&(pts[ipt]=ei1.coord),new Edge$1(pts,new Label(this.edge._label))};EdgeIntersectionList.prototype.add=function(intPt,segmentIndex,dist2){var eiNew=new EdgeIntersection(intPt,segmentIndex,dist2),ei=this._nodeMap.get(eiNew);return ei!==null?ei:(this._nodeMap.put(eiNew,eiNew),eiNew)};EdgeIntersectionList.prototype.isIntersection=function(pt){for(var it=this.iterator();it.hasNext();){var ei=it.next();if(ei.coord.equals(pt))return!0}return!1};EdgeIntersectionList.prototype.interfaces_=function(){return[]};EdgeIntersectionList.prototype.getClass=function(){return EdgeIntersectionList};var MonotoneChainIndexer=function(){};MonotoneChainIndexer.prototype.getChainStartIndices=function(pts){var this$1=this,start2=0,startIndexList=new ArrayList;startIndexList.add(new Integer(start2));do{var last=this$1.findChainEnd(pts,start2);startIndexList.add(new Integer(last)),start2=last}while(start2<pts.length-1);var startIndex=MonotoneChainIndexer.toIntArray(startIndexList);return startIndex};MonotoneChainIndexer.prototype.findChainEnd=function(pts,start2){for(var chainQuad=Quadrant.quadrant(pts[start2],pts[start2+1]),last=start2+1;last<pts.length;){var quad=Quadrant.quadrant(pts[last-1],pts[last]);if(quad!==chainQuad)break;last++}return last-1};MonotoneChainIndexer.prototype.interfaces_=function(){return[]};MonotoneChainIndexer.prototype.getClass=function(){return MonotoneChainIndexer};MonotoneChainIndexer.toIntArray=function(list){for(var array=new Array(list.size()).fill(null),i=0;i<array.length;i++)array[i]=list.get(i).intValue();return array};var MonotoneChainEdge=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Envelope,this.env2=new Envelope;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var mcb=new MonotoneChainIndexer;this.startIndex=mcb.getChainStartIndices(this.pts)};MonotoneChainEdge.prototype.getCoordinates=function(){return this.pts};MonotoneChainEdge.prototype.getMaxX=function(chainIndex){var x12=this.pts[this.startIndex[chainIndex]].x,x2=this.pts[this.startIndex[chainIndex+1]].x;return x12>x2?x12:x2};MonotoneChainEdge.prototype.getMinX=function(chainIndex){var x12=this.pts[this.startIndex[chainIndex]].x,x2=this.pts[this.startIndex[chainIndex+1]].x;return x12<x2?x12:x2};MonotoneChainEdge.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var chainIndex0=arguments[0],mce=arguments[1],chainIndex1=arguments[2],si=arguments[3];this.computeIntersectsForChain(this.startIndex[chainIndex0],this.startIndex[chainIndex0+1],mce,mce.startIndex[chainIndex1],mce.startIndex[chainIndex1+1],si)}else if(arguments.length===6){var start0=arguments[0],end0=arguments[1],mce$1=arguments[2],start1=arguments[3],end1=arguments[4],ei=arguments[5],p002=this.pts[start0],p012=this.pts[end0],p102=mce$1.pts[start1],p112=mce$1.pts[end1];if(end0-start0===1&&end1-start1===1)return ei.addIntersections(this.e,start0,mce$1.e,start1),null;if(this.env1.init(p002,p012),this.env2.init(p102,p112),!this.env1.intersects(this.env2))return null;var mid0=Math.trunc((start0+end0)/2),mid1=Math.trunc((start1+end1)/2);start0<mid0&&(start1<mid1&&this.computeIntersectsForChain(start0,mid0,mce$1,start1,mid1,ei),mid1<end1&&this.computeIntersectsForChain(start0,mid0,mce$1,mid1,end1,ei)),mid0<end0&&(start1<mid1&&this.computeIntersectsForChain(mid0,end0,mce$1,start1,mid1,ei),mid1<end1&&this.computeIntersectsForChain(mid0,end0,mce$1,mid1,end1,ei))}};MonotoneChainEdge.prototype.getStartIndexes=function(){return this.startIndex};MonotoneChainEdge.prototype.computeIntersects=function(mce,si){for(var this$1=this,i=0;i<this.startIndex.length-1;i++)for(var j=0;j<mce.startIndex.length-1;j++)this$1.computeIntersectsForChain(i,mce,j,si)};MonotoneChainEdge.prototype.interfaces_=function(){return[]};MonotoneChainEdge.prototype.getClass=function(){return MonotoneChainEdge};var Depth=function Depth2(){var this$1=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var i=0;i<2;i++)for(var j=0;j<3;j++)this$1._depth[i][j]=Depth2.NULL_VALUE},staticAccessors$31={NULL_VALUE:{configurable:!0}};Depth.prototype.getDepth=function(geomIndex,posIndex){return this._depth[geomIndex][posIndex]};Depth.prototype.setDepth=function(geomIndex,posIndex,depthValue){this._depth[geomIndex][posIndex]=depthValue};Depth.prototype.isNull=function(){var this$1=this;if(arguments.length===0){for(var i=0;i<2;i++)for(var j=0;j<3;j++)if(this$1._depth[i][j]!==Depth.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var geomIndex=arguments[0];return this._depth[geomIndex][1]===Depth.NULL_VALUE}else if(arguments.length===2){var geomIndex$1=arguments[0],posIndex=arguments[1];return this._depth[geomIndex$1][posIndex]===Depth.NULL_VALUE}};Depth.prototype.normalize=function(){for(var this$1=this,i=0;i<2;i++)if(!this$1.isNull(i)){var minDepth=this$1._depth[i][1];this$1._depth[i][2]<minDepth&&(minDepth=this$1._depth[i][2]),minDepth<0&&(minDepth=0);for(var j=1;j<3;j++){var newValue=0;this$1._depth[i][j]>minDepth&&(newValue=1),this$1._depth[i][j]=newValue}}};Depth.prototype.getDelta=function(geomIndex){return this._depth[geomIndex][Position.RIGHT]-this._depth[geomIndex][Position.LEFT]};Depth.prototype.getLocation=function(geomIndex,posIndex){return this._depth[geomIndex][posIndex]<=0?Location.EXTERIOR:Location.INTERIOR};Depth.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Depth.prototype.add=function(){var this$1=this;if(arguments.length===1)for(var lbl=arguments[0],i=0;i<2;i++)for(var j=1;j<3;j++){var loc=lbl.getLocation(i,j);(loc===Location.EXTERIOR||loc===Location.INTERIOR)&&(this$1.isNull(i,j)?this$1._depth[i][j]=Depth.depthAtLocation(loc):this$1._depth[i][j]+=Depth.depthAtLocation(loc))}else if(arguments.length===3){var geomIndex=arguments[0],posIndex=arguments[1],location2=arguments[2];location2===Location.INTERIOR&&this._depth[geomIndex][posIndex]++}};Depth.prototype.interfaces_=function(){return[]};Depth.prototype.getClass=function(){return Depth};Depth.depthAtLocation=function(location2){return location2===Location.EXTERIOR?0:location2===Location.INTERIOR?1:Depth.NULL_VALUE};staticAccessors$31.NULL_VALUE.get=function(){return-1};Object.defineProperties(Depth,staticAccessors$31);var Edge$1=function(GraphComponent$$1){function Edge3(){if(GraphComponent$$1.call(this),this.pts=null,this._env=null,this.eiList=new EdgeIntersectionList(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Depth,this._depthDelta=0,arguments.length===1){var pts=arguments[0];Edge3.call(this,pts,null)}else if(arguments.length===2){var pts$1=arguments[0],label=arguments[1];this.pts=pts$1,this._label=label}}return GraphComponent$$1&&(Edge3.__proto__=GraphComponent$$1),Edge3.prototype=Object.create(GraphComponent$$1&&GraphComponent$$1.prototype),Edge3.prototype.constructor=Edge3,Edge3.prototype.getDepth=function(){return this._depth},Edge3.prototype.getCollapsedEdge=function(){var newPts=new Array(2).fill(null);newPts[0]=this.pts[0],newPts[1]=this.pts[1];var newe=new Edge3(newPts,Label.toLineLabel(this._label));return newe},Edge3.prototype.isIsolated=function(){return this._isIsolated},Edge3.prototype.getCoordinates=function(){return this.pts},Edge3.prototype.setIsolated=function(isIsolated2){this._isIsolated=isIsolated2},Edge3.prototype.setName=function(name){this._name=name},Edge3.prototype.equals=function(o){var this$1=this;if(!(o instanceof Edge3))return!1;var e=o;if(this.pts.length!==e.pts.length)return!1;for(var isEqualForward=!0,isEqualReverse=!0,iRev=this.pts.length,i=0;i<this.pts.length;i++)if(this$1.pts[i].equals2D(e.pts[i])||(isEqualForward=!1),this$1.pts[i].equals2D(e.pts[--iRev])||(isEqualReverse=!1),!isEqualForward&&!isEqualReverse)return!1;return!0},Edge3.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var i=arguments[0];return this.pts[i]}},Edge3.prototype.print=function(out){var this$1=this;out.print("edge "+this._name+": "),out.print("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&out.print(","),out.print(this$1.pts[i].x+" "+this$1.pts[i].y);out.print(")  "+this._label+" "+this._depthDelta)},Edge3.prototype.computeIM=function(im){Edge3.updateIM(this._label,im)},Edge3.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},Edge3.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},Edge3.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},Edge3.prototype.getDepthDelta=function(){return this._depthDelta},Edge3.prototype.getNumPoints=function(){return this.pts.length},Edge3.prototype.printReverse=function(out){var this$1=this;out.print("edge "+this._name+": ");for(var i=this.pts.length-1;i>=0;i--)out.print(this$1.pts[i]+" ");out.println("")},Edge3.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new MonotoneChainEdge(this)),this._mce},Edge3.prototype.getEnvelope=function(){var this$1=this;if(this._env===null){this._env=new Envelope;for(var i=0;i<this.pts.length;i++)this$1._env.expandToInclude(this$1.pts[i])}return this._env},Edge3.prototype.addIntersection=function(li,segmentIndex,geomIndex,intIndex){var intPt=new Coordinate(li.getIntersection(intIndex)),normalizedSegmentIndex=segmentIndex,dist2=li.getEdgeDistance(geomIndex,intIndex),nextSegIndex=normalizedSegmentIndex+1;if(nextSegIndex<this.pts.length){var nextPt=this.pts[nextSegIndex];intPt.equals2D(nextPt)&&(normalizedSegmentIndex=nextSegIndex,dist2=0)}this.eiList.add(intPt,normalizedSegmentIndex,dist2)},Edge3.prototype.toString=function(){var this$1=this,buf=new StringBuffer;buf.append("edge "+this._name+": "),buf.append("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&buf.append(","),buf.append(this$1.pts[i].x+" "+this$1.pts[i].y);return buf.append(")  "+this._label+" "+this._depthDelta),buf.toString()},Edge3.prototype.isPointwiseEqual=function(e){var this$1=this;if(this.pts.length!==e.pts.length)return!1;for(var i=0;i<this.pts.length;i++)if(!this$1.pts[i].equals2D(e.pts[i]))return!1;return!0},Edge3.prototype.setDepthDelta=function(depthDelta2){this._depthDelta=depthDelta2},Edge3.prototype.getEdgeIntersectionList=function(){return this.eiList},Edge3.prototype.addIntersections=function(li,segmentIndex,geomIndex){for(var this$1=this,i=0;i<li.getIntersectionNum();i++)this$1.addIntersection(li,segmentIndex,geomIndex,i)},Edge3.prototype.interfaces_=function(){return[]},Edge3.prototype.getClass=function(){return Edge3},Edge3.updateIM=function(){if(arguments.length===2){var label=arguments[0],im=arguments[1];im.setAtLeastIfValid(label.getLocation(0,Position.ON),label.getLocation(1,Position.ON),1),label.isArea()&&(im.setAtLeastIfValid(label.getLocation(0,Position.LEFT),label.getLocation(1,Position.LEFT),2),im.setAtLeastIfValid(label.getLocation(0,Position.RIGHT),label.getLocation(1,Position.RIGHT),2))}else return GraphComponent$$1.prototype.updateIM.apply(this,arguments)},Edge3}(GraphComponent),BufferBuilder=function(bufParams){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new EdgeList,this._bufParams=bufParams||null};BufferBuilder.prototype.setWorkingPrecisionModel=function(pm){this._workingPrecisionModel=pm};BufferBuilder.prototype.insertUniqueEdge=function(e){var existingEdge=this._edgeList.findEqualEdge(e);if(existingEdge!==null){var existingLabel=existingEdge.getLabel(),labelToMerge=e.getLabel();existingEdge.isPointwiseEqual(e)||(labelToMerge=new Label(e.getLabel()),labelToMerge.flip()),existingLabel.merge(labelToMerge);var mergeDelta=BufferBuilder.depthDelta(labelToMerge),existingDelta=existingEdge.getDepthDelta(),newDelta=existingDelta+mergeDelta;existingEdge.setDepthDelta(newDelta)}else this._edgeList.add(e),e.setDepthDelta(BufferBuilder.depthDelta(e.getLabel()))};BufferBuilder.prototype.buildSubgraphs=function(subgraphList,polyBuilder){for(var processedGraphs=new ArrayList,i=subgraphList.iterator();i.hasNext();){var subgraph=i.next(),p=subgraph.getRightmostCoordinate(),locater=new SubgraphDepthLocater(processedGraphs),outsideDepth=locater.getDepth(p);subgraph.computeDepth(outsideDepth),subgraph.findResultEdges(),processedGraphs.add(subgraph),polyBuilder.add(subgraph.getDirectedEdges(),subgraph.getNodes())}};BufferBuilder.prototype.createSubgraphs=function(graph){for(var subgraphList=new ArrayList,i=graph.getNodes().iterator();i.hasNext();){var node=i.next();if(!node.isVisited()){var subgraph=new BufferSubgraph;subgraph.create(node),subgraphList.add(subgraph)}}return Collections.sort(subgraphList,Collections.reverseOrder()),subgraphList};BufferBuilder.prototype.createEmptyResultGeometry=function(){var emptyGeom=this._geomFact.createPolygon();return emptyGeom};BufferBuilder.prototype.getNoder=function(precisionModel){if(this._workingNoder!==null)return this._workingNoder;var noder=new MCIndexNoder,li=new RobustLineIntersector;return li.setPrecisionModel(precisionModel),noder.setSegmentIntersector(new IntersectionAdder(li)),noder};BufferBuilder.prototype.buffer=function(g,distance12){var precisionModel=this._workingPrecisionModel;precisionModel===null&&(precisionModel=g.getPrecisionModel()),this._geomFact=g.getFactory();var curveBuilder=new OffsetCurveBuilder(precisionModel,this._bufParams),curveSetBuilder=new OffsetCurveSetBuilder(g,distance12,curveBuilder),bufferSegStrList=curveSetBuilder.getCurves();if(bufferSegStrList.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(bufferSegStrList,precisionModel),this._graph=new PlanarGraph(new OverlayNodeFactory),this._graph.addEdges(this._edgeList.getEdges());var subgraphList=this.createSubgraphs(this._graph),polyBuilder=new PolygonBuilder(this._geomFact);this.buildSubgraphs(subgraphList,polyBuilder);var resultPolyList=polyBuilder.getPolygons();if(resultPolyList.size()<=0)return this.createEmptyResultGeometry();var resultGeom=this._geomFact.buildGeometry(resultPolyList);return resultGeom};BufferBuilder.prototype.computeNodedEdges=function(bufferSegStrList,precisionModel){var this$1=this,noder=this.getNoder(precisionModel);noder.computeNodes(bufferSegStrList);for(var nodedSegStrings=noder.getNodedSubstrings(),i=nodedSegStrings.iterator();i.hasNext();){var segStr=i.next(),pts=segStr.getCoordinates();if(!(pts.length===2&&pts[0].equals2D(pts[1]))){var oldLabel=segStr.getData(),edge=new Edge$1(segStr.getCoordinates(),new Label(oldLabel));this$1.insertUniqueEdge(edge)}}};BufferBuilder.prototype.setNoder=function(noder){this._workingNoder=noder};BufferBuilder.prototype.interfaces_=function(){return[]};BufferBuilder.prototype.getClass=function(){return BufferBuilder};BufferBuilder.depthDelta=function(label){var lLoc=label.getLocation(0,Position.LEFT),rLoc=label.getLocation(0,Position.RIGHT);return lLoc===Location.INTERIOR&&rLoc===Location.EXTERIOR?1:lLoc===Location.EXTERIOR&&rLoc===Location.INTERIOR?-1:0};BufferBuilder.convertSegStrings=function(it){for(var fact=new GeometryFactory,lines=new ArrayList;it.hasNext();){var ss=it.next(),line=fact.createLineString(ss.getCoordinates());lines.add(line)}return fact.buildGeometry(lines)};var ScaledNoder=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var noder=arguments[0],scaleFactor=arguments[1];this._noder=noder,this._scaleFactor=scaleFactor,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var noder$1=arguments[0],scaleFactor$1=arguments[1],offsetX=arguments[2],offsetY=arguments[3];this._noder=noder$1,this._scaleFactor=scaleFactor$1,this._offsetX=offsetX,this._offsetY=offsetY,this._isScaled=!this.isIntegerPrecision()}};ScaledNoder.prototype.rescale=function(){var this$1=this;if(hasInterface(arguments[0],Collection))for(var segStrings=arguments[0],i=segStrings.iterator();i.hasNext();){var ss=i.next();this$1.rescale(ss.getCoordinates())}else if(arguments[0]instanceof Array){for(var pts=arguments[0],i$1=0;i$1<pts.length;i$1++)pts[i$1].x=pts[i$1].x/this$1._scaleFactor+this$1._offsetX,pts[i$1].y=pts[i$1].y/this$1._scaleFactor+this$1._offsetY;pts.length===2&&pts[0].equals2D(pts[1])&&System.out.println(pts)}};ScaledNoder.prototype.scale=function(){var this$1=this;if(hasInterface(arguments[0],Collection)){for(var segStrings=arguments[0],nodedSegmentStrings=new ArrayList,i=segStrings.iterator();i.hasNext();){var ss=i.next();nodedSegmentStrings.add(new NodedSegmentString(this$1.scale(ss.getCoordinates()),ss.getData()))}return nodedSegmentStrings}else if(arguments[0]instanceof Array){for(var pts=arguments[0],roundPts=new Array(pts.length).fill(null),i$1=0;i$1<pts.length;i$1++)roundPts[i$1]=new Coordinate(Math.round((pts[i$1].x-this$1._offsetX)*this$1._scaleFactor),Math.round((pts[i$1].y-this$1._offsetY)*this$1._scaleFactor),pts[i$1].z);var roundPtsNoDup=CoordinateArrays.removeRepeatedPoints(roundPts);return roundPtsNoDup}};ScaledNoder.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};ScaledNoder.prototype.getNodedSubstrings=function(){var splitSS=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(splitSS),splitSS};ScaledNoder.prototype.computeNodes=function(inputSegStrings){var intSegStrings=inputSegStrings;this._isScaled&&(intSegStrings=this.scale(inputSegStrings)),this._noder.computeNodes(intSegStrings)};ScaledNoder.prototype.interfaces_=function(){return[Noder]};ScaledNoder.prototype.getClass=function(){return ScaledNoder};var NodingValidator=function(){this._li=new RobustLineIntersector,this._segStrings=null;var segStrings=arguments[0];this._segStrings=segStrings},staticAccessors$33={fact:{configurable:!0}};NodingValidator.prototype.checkEndPtVertexIntersections=function(){var this$1=this;if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();){var ss=i.next(),pts=ss.getCoordinates();this$1.checkEndPtVertexIntersections(pts[0],this$1._segStrings),this$1.checkEndPtVertexIntersections(pts[pts.length-1],this$1._segStrings)}else if(arguments.length===2){for(var testPt=arguments[0],segStrings=arguments[1],i$1=segStrings.iterator();i$1.hasNext();)for(var ss$1=i$1.next(),pts$1=ss$1.getCoordinates(),j=1;j<pts$1.length-1;j++)if(pts$1[j].equals(testPt))throw new RuntimeException("found endpt/interior pt intersection at index "+j+" :pt "+testPt)}};NodingValidator.prototype.checkInteriorIntersections=function(){var this$1=this;if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();)for(var ss0=i.next(),j=this._segStrings.iterator();j.hasNext();){var ss1=j.next();this$1.checkInteriorIntersections(ss0,ss1)}else if(arguments.length===2)for(var ss0$1=arguments[0],ss1$1=arguments[1],pts0=ss0$1.getCoordinates(),pts1=ss1$1.getCoordinates(),i0=0;i0<pts0.length-1;i0++)for(var i1=0;i1<pts1.length-1;i1++)this$1.checkInteriorIntersections(ss0$1,i0,ss1$1,i1);else if(arguments.length===4){var e0=arguments[0],segIndex0=arguments[1],e1=arguments[2],segIndex1=arguments[3];if(e0===e1&&segIndex0===segIndex1)return null;var p002=e0.getCoordinates()[segIndex0],p012=e0.getCoordinates()[segIndex0+1],p102=e1.getCoordinates()[segIndex1],p112=e1.getCoordinates()[segIndex1+1];if(this._li.computeIntersection(p002,p012,p102,p112),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,p002,p012)||this.hasInteriorIntersection(this._li,p102,p112)))throw new RuntimeException("found non-noded intersection at "+p002+"-"+p012+" and "+p102+"-"+p112)}};NodingValidator.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};NodingValidator.prototype.checkCollapses=function(){var this$1=this;if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();){var ss=i.next();this$1.checkCollapses(ss)}else if(arguments.length===1)for(var ss$1=arguments[0],pts=ss$1.getCoordinates(),i$1=0;i$1<pts.length-2;i$1++)this$1.checkCollapse(pts[i$1],pts[i$1+1],pts[i$1+2])};NodingValidator.prototype.hasInteriorIntersection=function(li,p0,p1){for(var i=0;i<li.getIntersectionNum();i++){var intPt=li.getIntersection(i);if(!(intPt.equals(p0)||intPt.equals(p1)))return!0}return!1};NodingValidator.prototype.checkCollapse=function(p0,p1,p2){if(p0.equals(p2))throw new RuntimeException("found non-noded collapse at "+NodingValidator.fact.createLineString([p0,p1,p2]))};NodingValidator.prototype.interfaces_=function(){return[]};NodingValidator.prototype.getClass=function(){return NodingValidator};staticAccessors$33.fact.get=function(){return new GeometryFactory};Object.defineProperties(NodingValidator,staticAccessors$33);var HotPixel=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var pt=arguments[0],scaleFactor=arguments[1],li=arguments[2];if(this._originalPt=pt,this._pt=pt,this._scaleFactor=scaleFactor,this._li=li,scaleFactor<=0)throw new IllegalArgumentException("Scale factor must be non-zero");scaleFactor!==1&&(this._pt=new Coordinate(this.scale(pt.x),this.scale(pt.y)),this._p0Scaled=new Coordinate,this._p1Scaled=new Coordinate),this.initCorners(this._pt)},staticAccessors$34={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};HotPixel.prototype.intersectsScaled=function(p0,p1){var segMinx=Math.min(p0.x,p1.x),segMaxx=Math.max(p0.x,p1.x),segMiny=Math.min(p0.y,p1.y),segMaxy=Math.max(p0.y,p1.y),isOutsidePixelEnv=this._maxx<segMinx||this._minx>segMaxx||this._maxy<segMiny||this._miny>segMaxy;if(isOutsidePixelEnv)return!1;var intersects7=this.intersectsToleranceSquare(p0,p1);return Assert.isTrue(!(isOutsidePixelEnv&&intersects7),"Found bad envelope test"),intersects7};HotPixel.prototype.initCorners=function(pt){var tolerance=.5;this._minx=pt.x-tolerance,this._maxx=pt.x+tolerance,this._miny=pt.y-tolerance,this._maxy=pt.y+tolerance,this._corner[0]=new Coordinate(this._maxx,this._maxy),this._corner[1]=new Coordinate(this._minx,this._maxy),this._corner[2]=new Coordinate(this._minx,this._miny),this._corner[3]=new Coordinate(this._maxx,this._miny)};HotPixel.prototype.intersects=function(p0,p1){return this._scaleFactor===1?this.intersectsScaled(p0,p1):(this.copyScaled(p0,this._p0Scaled),this.copyScaled(p1,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};HotPixel.prototype.scale=function(val){return Math.round(val*this._scaleFactor)};HotPixel.prototype.getCoordinate=function(){return this._originalPt};HotPixel.prototype.copyScaled=function(p,pScaled){pScaled.x=this.scale(p.x),pScaled.y=this.scale(p.y)};HotPixel.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var safeTolerance=HotPixel.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Envelope(this._originalPt.x-safeTolerance,this._originalPt.x+safeTolerance,this._originalPt.y-safeTolerance,this._originalPt.y+safeTolerance)}return this._safeEnv};HotPixel.prototype.intersectsPixelClosure=function(p0,p1){return this._li.computeIntersection(p0,p1,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(p0,p1,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(p0,p1,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(p0,p1,this._corner[3],this._corner[0]),this._li.hasIntersection()))};HotPixel.prototype.intersectsToleranceSquare=function(p0,p1){var intersectsLeft=!1,intersectsBottom=!1;return this._li.computeIntersection(p0,p1,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(p0,p1,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(intersectsLeft=!0),this._li.computeIntersection(p0,p1,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(intersectsBottom=!0),this._li.computeIntersection(p0,p1,this._corner[3],this._corner[0]),this._li.isProper())||intersectsLeft&&intersectsBottom||p0.equals(this._pt)||p1.equals(this._pt))};HotPixel.prototype.addSnappedNode=function(segStr,segIndex){var p0=segStr.getCoordinate(segIndex),p1=segStr.getCoordinate(segIndex+1);return this.intersects(p0,p1)?(segStr.addIntersection(this.getCoordinate(),segIndex),!0):!1};HotPixel.prototype.interfaces_=function(){return[]};HotPixel.prototype.getClass=function(){return HotPixel};staticAccessors$34.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(HotPixel,staticAccessors$34);var MonotoneChainSelectAction=function(){this.tempEnv1=new Envelope,this.selectedSegment=new LineSegment};MonotoneChainSelectAction.prototype.select=function(){if(arguments.length!==1){if(arguments.length===2){var mc=arguments[0],startIndex=arguments[1];mc.getLineSegment(startIndex,this.selectedSegment),this.select(this.selectedSegment)}}};MonotoneChainSelectAction.prototype.interfaces_=function(){return[]};MonotoneChainSelectAction.prototype.getClass=function(){return MonotoneChainSelectAction};var MCIndexPointSnapper=function(){this._index=null;var index=arguments[0];this._index=index},staticAccessors$35={HotPixelSnapAction:{configurable:!0}};MCIndexPointSnapper.prototype.snap=function(){if(arguments.length===1){var hotPixel=arguments[0];return this.snap(hotPixel,null,-1)}else if(arguments.length===3){var hotPixel$1=arguments[0],parentEdge=arguments[1],hotPixelVertexIndex=arguments[2],pixelEnv=hotPixel$1.getSafeEnvelope(),hotPixelSnapAction=new HotPixelSnapAction(hotPixel$1,parentEdge,hotPixelVertexIndex);return this._index.query(pixelEnv,{interfaces_:function(){return[ItemVisitor]},visitItem:function(item){var testChain=item;testChain.select(pixelEnv,hotPixelSnapAction)}}),hotPixelSnapAction.isNodeAdded()}};MCIndexPointSnapper.prototype.interfaces_=function(){return[]};MCIndexPointSnapper.prototype.getClass=function(){return MCIndexPointSnapper};staticAccessors$35.HotPixelSnapAction.get=function(){return HotPixelSnapAction};Object.defineProperties(MCIndexPointSnapper,staticAccessors$35);var HotPixelSnapAction=function(MonotoneChainSelectAction$$1){function HotPixelSnapAction2(){MonotoneChainSelectAction$$1.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var hotPixel=arguments[0],parentEdge=arguments[1],hotPixelVertexIndex=arguments[2];this._hotPixel=hotPixel,this._parentEdge=parentEdge,this._hotPixelVertexIndex=hotPixelVertexIndex}return MonotoneChainSelectAction$$1&&(HotPixelSnapAction2.__proto__=MonotoneChainSelectAction$$1),HotPixelSnapAction2.prototype=Object.create(MonotoneChainSelectAction$$1&&MonotoneChainSelectAction$$1.prototype),HotPixelSnapAction2.prototype.constructor=HotPixelSnapAction2,HotPixelSnapAction2.prototype.isNodeAdded=function(){return this._isNodeAdded},HotPixelSnapAction2.prototype.select=function(){if(arguments.length===2){var mc=arguments[0],startIndex=arguments[1],ss=mc.getContext();if(this._parentEdge!==null&&ss===this._parentEdge&&startIndex===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(ss,startIndex)}else return MonotoneChainSelectAction$$1.prototype.select.apply(this,arguments)},HotPixelSnapAction2.prototype.interfaces_=function(){return[]},HotPixelSnapAction2.prototype.getClass=function(){return HotPixelSnapAction2},HotPixelSnapAction2}(MonotoneChainSelectAction),InteriorIntersectionFinderAdder=function(){this._li=null,this._interiorIntersections=null;var li=arguments[0];this._li=li,this._interiorIntersections=new ArrayList};InteriorIntersectionFinderAdder.prototype.processIntersections=function(e0,segIndex0,e1,segIndex1){var this$1=this;if(e0===e1&&segIndex0===segIndex1)return null;var p002=e0.getCoordinates()[segIndex0],p012=e0.getCoordinates()[segIndex0+1],p102=e1.getCoordinates()[segIndex1],p112=e1.getCoordinates()[segIndex1+1];if(this._li.computeIntersection(p002,p012,p102,p112),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var intIndex=0;intIndex<this._li.getIntersectionNum();intIndex++)this$1._interiorIntersections.add(this$1._li.getIntersection(intIndex));e0.addIntersections(this._li,segIndex0,0),e1.addIntersections(this._li,segIndex1,1)}};InteriorIntersectionFinderAdder.prototype.isDone=function(){return!1};InteriorIntersectionFinderAdder.prototype.getInteriorIntersections=function(){return this._interiorIntersections};InteriorIntersectionFinderAdder.prototype.interfaces_=function(){return[SegmentIntersector]};InteriorIntersectionFinderAdder.prototype.getClass=function(){return InteriorIntersectionFinderAdder};var MCIndexSnapRounder=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var pm=arguments[0];this._pm=pm,this._li=new RobustLineIntersector,this._li.setPrecisionModel(pm),this._scaleFactor=pm.getScale()};MCIndexSnapRounder.prototype.checkCorrectness=function(inputSegmentStrings){var resultSegStrings=NodedSegmentString.getNodedSubstrings(inputSegmentStrings),nv=new NodingValidator(resultSegStrings);try{nv.checkValid()}catch(ex){if(ex instanceof Exception)ex.printStackTrace();else throw ex}finally{}};MCIndexSnapRounder.prototype.getNodedSubstrings=function(){return NodedSegmentString.getNodedSubstrings(this._nodedSegStrings)};MCIndexSnapRounder.prototype.snapRound=function(segStrings,li){var intersections=this.findInteriorIntersections(segStrings,li);this.computeIntersectionSnaps(intersections),this.computeVertexSnaps(segStrings)};MCIndexSnapRounder.prototype.findInteriorIntersections=function(segStrings,li){var intFinderAdder=new InteriorIntersectionFinderAdder(li);return this._noder.setSegmentIntersector(intFinderAdder),this._noder.computeNodes(segStrings),intFinderAdder.getInteriorIntersections()};MCIndexSnapRounder.prototype.computeVertexSnaps=function(){var this$1=this;if(hasInterface(arguments[0],Collection))for(var edges2=arguments[0],i0=edges2.iterator();i0.hasNext();){var edge0=i0.next();this$1.computeVertexSnaps(edge0)}else if(arguments[0]instanceof NodedSegmentString)for(var e=arguments[0],pts0=e.getCoordinates(),i=0;i<pts0.length;i++){var hotPixel=new HotPixel(pts0[i],this$1._scaleFactor,this$1._li),isNodeAdded=this$1._pointSnapper.snap(hotPixel,e,i);isNodeAdded&&e.addIntersection(pts0[i],i)}};MCIndexSnapRounder.prototype.computeNodes=function(inputSegmentStrings){this._nodedSegStrings=inputSegmentStrings,this._noder=new MCIndexNoder,this._pointSnapper=new MCIndexPointSnapper(this._noder.getIndex()),this.snapRound(inputSegmentStrings,this._li)};MCIndexSnapRounder.prototype.computeIntersectionSnaps=function(snapPts){for(var this$1=this,it=snapPts.iterator();it.hasNext();){var snapPt=it.next(),hotPixel=new HotPixel(snapPt,this$1._scaleFactor,this$1._li);this$1._pointSnapper.snap(hotPixel)}};MCIndexSnapRounder.prototype.interfaces_=function(){return[Noder]};MCIndexSnapRounder.prototype.getClass=function(){return MCIndexSnapRounder};var BufferOp=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new BufferParameters,this._resultGeometry=null,this._saveException=null,arguments.length===1){var g=arguments[0];this._argGeom=g}else if(arguments.length===2){var g$1=arguments[0],bufParams=arguments[1];this._argGeom=g$1,this._bufParams=bufParams}},staticAccessors$32={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};BufferOp.prototype.bufferFixedPrecision=function(fixedPM){var noder=new ScaledNoder(new MCIndexSnapRounder(new PrecisionModel(1)),fixedPM.getScale()),bufBuilder=new BufferBuilder(this._bufParams);bufBuilder.setWorkingPrecisionModel(fixedPM),bufBuilder.setNoder(noder),this._resultGeometry=bufBuilder.buffer(this._argGeom,this._distance)};BufferOp.prototype.bufferReducedPrecision=function(){var this$1=this;if(arguments.length===0){for(var precDigits=BufferOp.MAX_PRECISION_DIGITS;precDigits>=0;precDigits--){try{this$1.bufferReducedPrecision(precDigits)}catch(ex){if(ex instanceof TopologyException)this$1._saveException=ex;else throw ex}finally{}if(this$1._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var precisionDigits=arguments[0],sizeBasedScaleFactor=BufferOp.precisionScaleFactor(this._argGeom,this._distance,precisionDigits),fixedPM=new PrecisionModel(sizeBasedScaleFactor);this.bufferFixedPrecision(fixedPM)}};BufferOp.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var argPM=this._argGeom.getFactory().getPrecisionModel();argPM.getType()===PrecisionModel.FIXED?this.bufferFixedPrecision(argPM):this.bufferReducedPrecision()};BufferOp.prototype.setQuadrantSegments=function(quadrantSegments){this._bufParams.setQuadrantSegments(quadrantSegments)};BufferOp.prototype.bufferOriginalPrecision=function(){try{var bufBuilder=new BufferBuilder(this._bufParams);this._resultGeometry=bufBuilder.buffer(this._argGeom,this._distance)}catch(ex){if(ex instanceof RuntimeException)this._saveException=ex;else throw ex}finally{}};BufferOp.prototype.getResultGeometry=function(distance12){return this._distance=distance12,this.computeGeometry(),this._resultGeometry};BufferOp.prototype.setEndCapStyle=function(endCapStyle){this._bufParams.setEndCapStyle(endCapStyle)};BufferOp.prototype.interfaces_=function(){return[]};BufferOp.prototype.getClass=function(){return BufferOp};BufferOp.bufferOp=function(){if(arguments.length===2){var g=arguments[0],distance12=arguments[1],gBuf=new BufferOp(g),geomBuf=gBuf.getResultGeometry(distance12);return geomBuf}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Geometry&&typeof arguments[1]=="number"){var g$1=arguments[0],distance$1=arguments[1],quadrantSegments=arguments[2],bufOp=new BufferOp(g$1);bufOp.setQuadrantSegments(quadrantSegments);var geomBuf$1=bufOp.getResultGeometry(distance$1);return geomBuf$1}else if(arguments[2]instanceof BufferParameters&&arguments[0]instanceof Geometry&&typeof arguments[1]=="number"){var g$2=arguments[0],distance$22=arguments[1],params=arguments[2],bufOp$1=new BufferOp(g$2,params),geomBuf$2=bufOp$1.getResultGeometry(distance$22);return geomBuf$2}}else if(arguments.length===4){var g$3=arguments[0],distance$3=arguments[1],quadrantSegments$1=arguments[2],endCapStyle=arguments[3],bufOp$2=new BufferOp(g$3);bufOp$2.setQuadrantSegments(quadrantSegments$1),bufOp$2.setEndCapStyle(endCapStyle);var geomBuf$3=bufOp$2.getResultGeometry(distance$3);return geomBuf$3}};BufferOp.precisionScaleFactor=function(g,distance12,maxPrecisionDigits){var env=g.getEnvelopeInternal(),envMax=MathUtil.max(Math.abs(env.getMaxX()),Math.abs(env.getMaxY()),Math.abs(env.getMinX()),Math.abs(env.getMinY())),expandByDistance=distance12>0?distance12:0,bufEnvMax=envMax+2*expandByDistance,bufEnvPrecisionDigits=Math.trunc(Math.log(bufEnvMax)/Math.log(10)+1),minUnitLog10=maxPrecisionDigits-bufEnvPrecisionDigits,scaleFactor=Math.pow(10,minUnitLog10);return scaleFactor};staticAccessors$32.CAP_ROUND.get=function(){return BufferParameters.CAP_ROUND};staticAccessors$32.CAP_BUTT.get=function(){return BufferParameters.CAP_FLAT};staticAccessors$32.CAP_FLAT.get=function(){return BufferParameters.CAP_FLAT};staticAccessors$32.CAP_SQUARE.get=function(){return BufferParameters.CAP_SQUARE};staticAccessors$32.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(BufferOp,staticAccessors$32);var PointPairDistance=function(){this._pt=[new Coordinate,new Coordinate],this._distance=Double.NaN,this._isNull=!0};PointPairDistance.prototype.getCoordinates=function(){return this._pt};PointPairDistance.prototype.getCoordinate=function(i){return this._pt[i]};PointPairDistance.prototype.setMinimum=function(){if(arguments.length===1){var ptDist=arguments[0];this.setMinimum(ptDist._pt[0],ptDist._pt[1])}else if(arguments.length===2){var p0=arguments[0],p1=arguments[1];if(this._isNull)return this.initialize(p0,p1),null;var dist2=p0.distance(p1);dist2<this._distance&&this.initialize(p0,p1,dist2)}};PointPairDistance.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var p0=arguments[0],p1=arguments[1];this._pt[0].setCoordinate(p0),this._pt[1].setCoordinate(p1),this._distance=p0.distance(p1),this._isNull=!1}else if(arguments.length===3){var p0$1=arguments[0],p1$1=arguments[1],distance12=arguments[2];this._pt[0].setCoordinate(p0$1),this._pt[1].setCoordinate(p1$1),this._distance=distance12,this._isNull=!1}};PointPairDistance.prototype.getDistance=function(){return this._distance};PointPairDistance.prototype.setMaximum=function(){if(arguments.length===1){var ptDist=arguments[0];this.setMaximum(ptDist._pt[0],ptDist._pt[1])}else if(arguments.length===2){var p0=arguments[0],p1=arguments[1];if(this._isNull)return this.initialize(p0,p1),null;var dist2=p0.distance(p1);dist2>this._distance&&this.initialize(p0,p1,dist2)}};PointPairDistance.prototype.interfaces_=function(){return[]};PointPairDistance.prototype.getClass=function(){return PointPairDistance};var DistanceToPointFinder=function(){};DistanceToPointFinder.prototype.interfaces_=function(){return[]};DistanceToPointFinder.prototype.getClass=function(){return DistanceToPointFinder};DistanceToPointFinder.computeDistance=function(){if(arguments[2]instanceof PointPairDistance&&arguments[0]instanceof LineString$1&&arguments[1]instanceof Coordinate)for(var line=arguments[0],pt=arguments[1],ptDist=arguments[2],coords=line.getCoordinates(),tempSegment=new LineSegment,i=0;i<coords.length-1;i++){tempSegment.setCoordinates(coords[i],coords[i+1]);var closestPt=tempSegment.closestPoint(pt);ptDist.setMinimum(closestPt,pt)}else if(arguments[2]instanceof PointPairDistance&&arguments[0]instanceof Polygon&&arguments[1]instanceof Coordinate){var poly=arguments[0],pt$1=arguments[1],ptDist$1=arguments[2];DistanceToPointFinder.computeDistance(poly.getExteriorRing(),pt$1,ptDist$1);for(var i$1=0;i$1<poly.getNumInteriorRing();i$1++)DistanceToPointFinder.computeDistance(poly.getInteriorRingN(i$1),pt$1,ptDist$1)}else if(arguments[2]instanceof PointPairDistance&&arguments[0]instanceof Geometry&&arguments[1]instanceof Coordinate){var geom=arguments[0],pt$2=arguments[1],ptDist$2=arguments[2];if(geom instanceof LineString$1)DistanceToPointFinder.computeDistance(geom,pt$2,ptDist$2);else if(geom instanceof Polygon)DistanceToPointFinder.computeDistance(geom,pt$2,ptDist$2);else if(geom instanceof GeometryCollection)for(var gc=geom,i$2=0;i$2<gc.getNumGeometries();i$2++){var g=gc.getGeometryN(i$2);DistanceToPointFinder.computeDistance(g,pt$2,ptDist$2)}else ptDist$2.setMinimum(geom.getCoordinate(),pt$2)}else if(arguments[2]instanceof PointPairDistance&&arguments[0]instanceof LineSegment&&arguments[1]instanceof Coordinate){var segment=arguments[0],pt$3=arguments[1],ptDist$3=arguments[2],closestPt$1=segment.closestPoint(pt$3);ptDist$3.setMinimum(closestPt$1,pt$3)}};var BufferCurveMaximumDistanceFinder=function(inputGeom){this._maxPtDist=new PointPairDistance,this._inputGeom=inputGeom||null},staticAccessors$36={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};BufferCurveMaximumDistanceFinder.prototype.computeMaxMidpointDistance=function(curve){var distFilter=new MaxMidpointDistanceFilter(this._inputGeom);curve.apply(distFilter),this._maxPtDist.setMaximum(distFilter.getMaxPointDistance())};BufferCurveMaximumDistanceFinder.prototype.computeMaxVertexDistance=function(curve){var distFilter=new MaxPointDistanceFilter(this._inputGeom);curve.apply(distFilter),this._maxPtDist.setMaximum(distFilter.getMaxPointDistance())};BufferCurveMaximumDistanceFinder.prototype.findDistance=function(bufferCurve){return this.computeMaxVertexDistance(bufferCurve),this.computeMaxMidpointDistance(bufferCurve),this._maxPtDist.getDistance()};BufferCurveMaximumDistanceFinder.prototype.getDistancePoints=function(){return this._maxPtDist};BufferCurveMaximumDistanceFinder.prototype.interfaces_=function(){return[]};BufferCurveMaximumDistanceFinder.prototype.getClass=function(){return BufferCurveMaximumDistanceFinder};staticAccessors$36.MaxPointDistanceFilter.get=function(){return MaxPointDistanceFilter};staticAccessors$36.MaxMidpointDistanceFilter.get=function(){return MaxMidpointDistanceFilter};Object.defineProperties(BufferCurveMaximumDistanceFinder,staticAccessors$36);var MaxPointDistanceFilter=function(geom){this._maxPtDist=new PointPairDistance,this._minPtDist=new PointPairDistance,this._geom=geom||null};MaxPointDistanceFilter.prototype.filter=function(pt){this._minPtDist.initialize(),DistanceToPointFinder.computeDistance(this._geom,pt,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};MaxPointDistanceFilter.prototype.getMaxPointDistance=function(){return this._maxPtDist};MaxPointDistanceFilter.prototype.interfaces_=function(){return[CoordinateFilter]};MaxPointDistanceFilter.prototype.getClass=function(){return MaxPointDistanceFilter};var MaxMidpointDistanceFilter=function(geom){this._maxPtDist=new PointPairDistance,this._minPtDist=new PointPairDistance,this._geom=geom||null};MaxMidpointDistanceFilter.prototype.filter=function(seq,index){if(index===0)return null;var p0=seq.getCoordinate(index-1),p1=seq.getCoordinate(index),midPt=new Coordinate((p0.x+p1.x)/2,(p0.y+p1.y)/2);this._minPtDist.initialize(),DistanceToPointFinder.computeDistance(this._geom,midPt,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};MaxMidpointDistanceFilter.prototype.isDone=function(){return!1};MaxMidpointDistanceFilter.prototype.isGeometryChanged=function(){return!1};MaxMidpointDistanceFilter.prototype.getMaxPointDistance=function(){return this._maxPtDist};MaxMidpointDistanceFilter.prototype.interfaces_=function(){return[CoordinateSequenceFilter]};MaxMidpointDistanceFilter.prototype.getClass=function(){return MaxMidpointDistanceFilter};var PolygonExtracter=function(comps){this._comps=comps||null};PolygonExtracter.prototype.filter=function(geom){geom instanceof Polygon&&this._comps.add(geom)};PolygonExtracter.prototype.interfaces_=function(){return[GeometryFilter]};PolygonExtracter.prototype.getClass=function(){return PolygonExtracter};PolygonExtracter.getPolygons=function(){if(arguments.length===1){var geom=arguments[0];return PolygonExtracter.getPolygons(geom,new ArrayList)}else if(arguments.length===2){var geom$1=arguments[0],list=arguments[1];return geom$1 instanceof Polygon?list.add(geom$1):geom$1 instanceof GeometryCollection&&geom$1.apply(new PolygonExtracter(list)),list}};var LinearComponentExtracter=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var lines=arguments[0];this._lines=lines}else if(arguments.length===2){var lines$1=arguments[0],isForcedToLineString=arguments[1];this._lines=lines$1,this._isForcedToLineString=isForcedToLineString}};LinearComponentExtracter.prototype.filter=function(geom){if(this._isForcedToLineString&&geom instanceof LinearRing){var line=geom.getFactory().createLineString(geom.getCoordinateSequence());return this._lines.add(line),null}geom instanceof LineString$1&&this._lines.add(geom)};LinearComponentExtracter.prototype.setForceToLineString=function(isForcedToLineString){this._isForcedToLineString=isForcedToLineString};LinearComponentExtracter.prototype.interfaces_=function(){return[GeometryComponentFilter]};LinearComponentExtracter.prototype.getClass=function(){return LinearComponentExtracter};LinearComponentExtracter.getGeometry=function(){if(arguments.length===1){var geom=arguments[0];return geom.getFactory().buildGeometry(LinearComponentExtracter.getLines(geom))}else if(arguments.length===2){var geom$1=arguments[0],forceToLineString=arguments[1];return geom$1.getFactory().buildGeometry(LinearComponentExtracter.getLines(geom$1,forceToLineString))}};LinearComponentExtracter.getLines=function(){if(arguments.length===1){var geom=arguments[0];return LinearComponentExtracter.getLines(geom,!1)}else if(arguments.length===2){if(hasInterface(arguments[0],Collection)&&hasInterface(arguments[1],Collection)){for(var geoms=arguments[0],lines$1=arguments[1],i=geoms.iterator();i.hasNext();){var g=i.next();LinearComponentExtracter.getLines(g,lines$1)}return lines$1}else if(arguments[0]instanceof Geometry&&typeof arguments[1]=="boolean"){var geom$1=arguments[0],forceToLineString=arguments[1],lines=new ArrayList;return geom$1.apply(new LinearComponentExtracter(lines,forceToLineString)),lines}else if(arguments[0]instanceof Geometry&&hasInterface(arguments[1],Collection)){var geom$2=arguments[0],lines$2=arguments[1];return geom$2 instanceof LineString$1?lines$2.add(geom$2):geom$2.apply(new LinearComponentExtracter(lines$2)),lines$2}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&hasInterface(arguments[0],Collection)&&hasInterface(arguments[1],Collection)){for(var geoms$1=arguments[0],lines$3=arguments[1],forceToLineString$1=arguments[2],i$1=geoms$1.iterator();i$1.hasNext();){var g$1=i$1.next();LinearComponentExtracter.getLines(g$1,lines$3,forceToLineString$1)}return lines$3}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Geometry&&hasInterface(arguments[1],Collection)){var geom$3=arguments[0],lines$4=arguments[1],forceToLineString$2=arguments[2];return geom$3.apply(new LinearComponentExtracter(lines$4,forceToLineString$2)),lines$4}}};var PointLocator=function(){if(this._boundaryRule=BoundaryNodeRule.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0){if(arguments.length===1){var boundaryRule=arguments[0];if(boundaryRule===null)throw new IllegalArgumentException("Rule must be non-null");this._boundaryRule=boundaryRule}}};PointLocator.prototype.locateInternal=function(){var this$1=this;if(arguments[0]instanceof Coordinate&&arguments[1]instanceof Polygon){var p=arguments[0],poly=arguments[1];if(poly.isEmpty())return Location.EXTERIOR;var shell=poly.getExteriorRing(),shellLoc=this.locateInPolygonRing(p,shell);if(shellLoc===Location.EXTERIOR)return Location.EXTERIOR;if(shellLoc===Location.BOUNDARY)return Location.BOUNDARY;for(var i=0;i<poly.getNumInteriorRing();i++){var hole=poly.getInteriorRingN(i),holeLoc=this$1.locateInPolygonRing(p,hole);if(holeLoc===Location.INTERIOR)return Location.EXTERIOR;if(holeLoc===Location.BOUNDARY)return Location.BOUNDARY}return Location.INTERIOR}else if(arguments[0]instanceof Coordinate&&arguments[1]instanceof LineString$1){var p$1=arguments[0],l=arguments[1];if(!l.getEnvelopeInternal().intersects(p$1))return Location.EXTERIOR;var pt=l.getCoordinates();return!l.isClosed()&&(p$1.equals(pt[0])||p$1.equals(pt[pt.length-1]))?Location.BOUNDARY:CGAlgorithms.isOnLine(p$1,pt)?Location.INTERIOR:Location.EXTERIOR}else if(arguments[0]instanceof Coordinate&&arguments[1]instanceof Point){var p$2=arguments[0],pt$1=arguments[1],ptCoord=pt$1.getCoordinate();return ptCoord.equals2D(p$2)?Location.INTERIOR:Location.EXTERIOR}};PointLocator.prototype.locateInPolygonRing=function(p,ring){return ring.getEnvelopeInternal().intersects(p)?CGAlgorithms.locatePointInRing(p,ring.getCoordinates()):Location.EXTERIOR};PointLocator.prototype.intersects=function(p,geom){return this.locate(p,geom)!==Location.EXTERIOR};PointLocator.prototype.updateLocationInfo=function(loc){loc===Location.INTERIOR&&(this._isIn=!0),loc===Location.BOUNDARY&&this._numBoundaries++};PointLocator.prototype.computeLocation=function(p,geom){var this$1=this;if(geom instanceof Point&&this.updateLocationInfo(this.locateInternal(p,geom)),geom instanceof LineString$1)this.updateLocationInfo(this.locateInternal(p,geom));else if(geom instanceof Polygon)this.updateLocationInfo(this.locateInternal(p,geom));else if(geom instanceof MultiLineString)for(var ml=geom,i=0;i<ml.getNumGeometries();i++){var l=ml.getGeometryN(i);this$1.updateLocationInfo(this$1.locateInternal(p,l))}else if(geom instanceof MultiPolygon)for(var mpoly=geom,i$1=0;i$1<mpoly.getNumGeometries();i$1++){var poly=mpoly.getGeometryN(i$1);this$1.updateLocationInfo(this$1.locateInternal(p,poly))}else if(geom instanceof GeometryCollection)for(var geomi=new GeometryCollectionIterator(geom);geomi.hasNext();){var g2=geomi.next();g2!==geom&&this$1.computeLocation(p,g2)}};PointLocator.prototype.locate=function(p,geom){return geom.isEmpty()?Location.EXTERIOR:geom instanceof LineString$1?this.locateInternal(p,geom):geom instanceof Polygon?this.locateInternal(p,geom):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(p,geom),this._boundaryRule.isInBoundary(this._numBoundaries)?Location.BOUNDARY:this._numBoundaries>0||this._isIn?Location.INTERIOR:Location.EXTERIOR)};PointLocator.prototype.interfaces_=function(){return[]};PointLocator.prototype.getClass=function(){return PointLocator};var GeometryLocation=function GeometryLocation2(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var component=arguments[0],pt=arguments[1];GeometryLocation2.call(this,component,GeometryLocation2.INSIDE_AREA,pt)}else if(arguments.length===3){var component$1=arguments[0],segIndex=arguments[1],pt$1=arguments[2];this._component=component$1,this._segIndex=segIndex,this._pt=pt$1}},staticAccessors$38={INSIDE_AREA:{configurable:!0}};GeometryLocation.prototype.isInsideArea=function(){return this._segIndex===GeometryLocation.INSIDE_AREA};GeometryLocation.prototype.getCoordinate=function(){return this._pt};GeometryLocation.prototype.getGeometryComponent=function(){return this._component};GeometryLocation.prototype.getSegmentIndex=function(){return this._segIndex};GeometryLocation.prototype.interfaces_=function(){return[]};GeometryLocation.prototype.getClass=function(){return GeometryLocation};staticAccessors$38.INSIDE_AREA.get=function(){return-1};Object.defineProperties(GeometryLocation,staticAccessors$38);var PointExtracter=function(pts){this._pts=pts||null};PointExtracter.prototype.filter=function(geom){geom instanceof Point&&this._pts.add(geom)};PointExtracter.prototype.interfaces_=function(){return[GeometryFilter]};PointExtracter.prototype.getClass=function(){return PointExtracter};PointExtracter.getPoints=function(){if(arguments.length===1){var geom=arguments[0];return geom instanceof Point?Collections.singletonList(geom):PointExtracter.getPoints(geom,new ArrayList)}else if(arguments.length===2){var geom$1=arguments[0],list=arguments[1];return geom$1 instanceof Point?list.add(geom$1):geom$1 instanceof GeometryCollection&&geom$1.apply(new PointExtracter(list)),list}};var ConnectedElementLocationFilter=function(){this._locations=null;var locations=arguments[0];this._locations=locations};ConnectedElementLocationFilter.prototype.filter=function(geom){(geom instanceof Point||geom instanceof LineString$1||geom instanceof Polygon)&&this._locations.add(new GeometryLocation(geom,0,geom.getCoordinate()))};ConnectedElementLocationFilter.prototype.interfaces_=function(){return[GeometryFilter]};ConnectedElementLocationFilter.prototype.getClass=function(){return ConnectedElementLocationFilter};ConnectedElementLocationFilter.getLocations=function(geom){var locations=new ArrayList;return geom.apply(new ConnectedElementLocationFilter(locations)),locations};var DistanceOp=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new PointLocator,this._minDistanceLocation=null,this._minDistance=Double.MAX_VALUE,arguments.length===2){var g0=arguments[0],g1=arguments[1];this._geom=[g0,g1],this._terminateDistance=0}else if(arguments.length===3){var g0$1=arguments[0],g1$1=arguments[1],terminateDistance=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=g0$1,this._geom[1]=g1$1,this._terminateDistance=terminateDistance}};DistanceOp.prototype.computeContainmentDistance=function(){var this$1=this;if(arguments.length===0){var locPtPoly=new Array(2).fill(null);if(this.computeContainmentDistance(0,locPtPoly),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,locPtPoly)}else if(arguments.length===2){var polyGeomIndex=arguments[0],locPtPoly$1=arguments[1],locationsIndex=1-polyGeomIndex,polys=PolygonExtracter.getPolygons(this._geom[polyGeomIndex]);if(polys.size()>0){var insideLocs=ConnectedElementLocationFilter.getLocations(this._geom[locationsIndex]);if(this.computeContainmentDistance(insideLocs,polys,locPtPoly$1),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[locationsIndex]=locPtPoly$1[0],this._minDistanceLocation[polyGeomIndex]=locPtPoly$1[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&hasInterface(arguments[0],List)&&hasInterface(arguments[1],List)){for(var locs=arguments[0],polys$1=arguments[1],locPtPoly$2=arguments[2],i=0;i<locs.size();i++)for(var loc=locs.get(i),j=0;j<polys$1.size();j++)if(this$1.computeContainmentDistance(loc,polys$1.get(j),locPtPoly$2),this$1._minDistance<=this$1._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof GeometryLocation&&arguments[1]instanceof Polygon){var ptLoc=arguments[0],poly=arguments[1],locPtPoly$3=arguments[2],pt=ptLoc.getCoordinate();if(Location.EXTERIOR!==this._ptLocator.locate(pt,poly))return this._minDistance=0,locPtPoly$3[0]=ptLoc,locPtPoly$3[1]=new GeometryLocation(poly,pt),null}}};DistanceOp.prototype.computeMinDistanceLinesPoints=function(lines,points2,locGeom){for(var this$1=this,i=0;i<lines.size();i++)for(var line=lines.get(i),j=0;j<points2.size();j++){var pt=points2.get(j);if(this$1.computeMinDistance(line,pt,locGeom),this$1._minDistance<=this$1._terminateDistance)return null}};DistanceOp.prototype.computeFacetDistance=function(){var locGeom=new Array(2).fill(null),lines0=LinearComponentExtracter.getLines(this._geom[0]),lines1=LinearComponentExtracter.getLines(this._geom[1]),pts0=PointExtracter.getPoints(this._geom[0]),pts1=PointExtracter.getPoints(this._geom[1]);if(this.computeMinDistanceLines(lines0,lines1,locGeom),this.updateMinDistance(locGeom,!1),this._minDistance<=this._terminateDistance||(locGeom[0]=null,locGeom[1]=null,this.computeMinDistanceLinesPoints(lines0,pts1,locGeom),this.updateMinDistance(locGeom,!1),this._minDistance<=this._terminateDistance)||(locGeom[0]=null,locGeom[1]=null,this.computeMinDistanceLinesPoints(lines1,pts0,locGeom),this.updateMinDistance(locGeom,!0),this._minDistance<=this._terminateDistance))return null;locGeom[0]=null,locGeom[1]=null,this.computeMinDistancePoints(pts0,pts1,locGeom),this.updateMinDistance(locGeom,!1)};DistanceOp.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};DistanceOp.prototype.updateMinDistance=function(locGeom,flip4){if(locGeom[0]===null)return null;flip4?(this._minDistanceLocation[0]=locGeom[1],this._minDistanceLocation[1]=locGeom[0]):(this._minDistanceLocation[0]=locGeom[0],this._minDistanceLocation[1]=locGeom[1])};DistanceOp.prototype.nearestPoints=function(){this.computeMinDistance();var nearestPts=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return nearestPts};DistanceOp.prototype.computeMinDistance=function(){var this$1=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof LineString$1&&arguments[1]instanceof Point){var line=arguments[0],pt=arguments[1],locGeom=arguments[2];if(line.getEnvelopeInternal().distance(pt.getEnvelopeInternal())>this._minDistance)return null;for(var coord0=line.getCoordinates(),coord=pt.getCoordinate(),i=0;i<coord0.length-1;i++){var dist2=CGAlgorithms.distancePointLine(coord,coord0[i],coord0[i+1]);if(dist2<this$1._minDistance){this$1._minDistance=dist2;var seg=new LineSegment(coord0[i],coord0[i+1]),segClosestPoint=seg.closestPoint(coord);locGeom[0]=new GeometryLocation(line,i,segClosestPoint),locGeom[1]=new GeometryLocation(pt,0,coord)}if(this$1._minDistance<=this$1._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof LineString$1&&arguments[1]instanceof LineString$1){var line0=arguments[0],line1=arguments[1],locGeom$1=arguments[2];if(line0.getEnvelopeInternal().distance(line1.getEnvelopeInternal())>this._minDistance)return null;for(var coord0$1=line0.getCoordinates(),coord1=line1.getCoordinates(),i$1=0;i$1<coord0$1.length-1;i$1++)for(var j=0;j<coord1.length-1;j++){var dist$12=CGAlgorithms.distanceLineLine(coord0$1[i$1],coord0$1[i$1+1],coord1[j],coord1[j+1]);if(dist$12<this$1._minDistance){this$1._minDistance=dist$12;var seg0=new LineSegment(coord0$1[i$1],coord0$1[i$1+1]),seg1=new LineSegment(coord1[j],coord1[j+1]),closestPt=seg0.closestPoints(seg1);locGeom$1[0]=new GeometryLocation(line0,i$1,closestPt[0]),locGeom$1[1]=new GeometryLocation(line1,j,closestPt[1])}if(this$1._minDistance<=this$1._terminateDistance)return null}}}};DistanceOp.prototype.computeMinDistancePoints=function(points0,points1,locGeom){for(var this$1=this,i=0;i<points0.size();i++)for(var pt0=points0.get(i),j=0;j<points1.size();j++){var pt1=points1.get(j),dist2=pt0.getCoordinate().distance(pt1.getCoordinate());if(dist2<this$1._minDistance&&(this$1._minDistance=dist2,locGeom[0]=new GeometryLocation(pt0,0,pt0.getCoordinate()),locGeom[1]=new GeometryLocation(pt1,0,pt1.getCoordinate())),this$1._minDistance<=this$1._terminateDistance)return null}};DistanceOp.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new IllegalArgumentException("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};DistanceOp.prototype.computeMinDistanceLines=function(lines0,lines1,locGeom){for(var this$1=this,i=0;i<lines0.size();i++)for(var line0=lines0.get(i),j=0;j<lines1.size();j++){var line1=lines1.get(j);if(this$1.computeMinDistance(line0,line1,locGeom),this$1._minDistance<=this$1._terminateDistance)return null}};DistanceOp.prototype.interfaces_=function(){return[]};DistanceOp.prototype.getClass=function(){return DistanceOp};DistanceOp.distance=function(g0,g1){var distOp=new DistanceOp(g0,g1);return distOp.distance()};DistanceOp.isWithinDistance=function(g0,g1,distance12){var distOp=new DistanceOp(g0,g1,distance12);return distOp.distance()<=distance12};DistanceOp.nearestPoints=function(g0,g1){var distOp=new DistanceOp(g0,g1);return distOp.nearestPoints()};var PointPairDistance$2=function(){this._pt=[new Coordinate,new Coordinate],this._distance=Double.NaN,this._isNull=!0};PointPairDistance$2.prototype.getCoordinates=function(){return this._pt};PointPairDistance$2.prototype.getCoordinate=function(i){return this._pt[i]};PointPairDistance$2.prototype.setMinimum=function(){if(arguments.length===1){var ptDist=arguments[0];this.setMinimum(ptDist._pt[0],ptDist._pt[1])}else if(arguments.length===2){var p0=arguments[0],p1=arguments[1];if(this._isNull)return this.initialize(p0,p1),null;var dist2=p0.distance(p1);dist2<this._distance&&this.initialize(p0,p1,dist2)}};PointPairDistance$2.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var p0=arguments[0],p1=arguments[1];this._pt[0].setCoordinate(p0),this._pt[1].setCoordinate(p1),this._distance=p0.distance(p1),this._isNull=!1}else if(arguments.length===3){var p0$1=arguments[0],p1$1=arguments[1],distance12=arguments[2];this._pt[0].setCoordinate(p0$1),this._pt[1].setCoordinate(p1$1),this._distance=distance12,this._isNull=!1}};PointPairDistance$2.prototype.toString=function(){return WKTWriter.toLineString(this._pt[0],this._pt[1])};PointPairDistance$2.prototype.getDistance=function(){return this._distance};PointPairDistance$2.prototype.setMaximum=function(){if(arguments.length===1){var ptDist=arguments[0];this.setMaximum(ptDist._pt[0],ptDist._pt[1])}else if(arguments.length===2){var p0=arguments[0],p1=arguments[1];if(this._isNull)return this.initialize(p0,p1),null;var dist2=p0.distance(p1);dist2>this._distance&&this.initialize(p0,p1,dist2)}};PointPairDistance$2.prototype.interfaces_=function(){return[]};PointPairDistance$2.prototype.getClass=function(){return PointPairDistance$2};var DistanceToPoint=function(){};DistanceToPoint.prototype.interfaces_=function(){return[]};DistanceToPoint.prototype.getClass=function(){return DistanceToPoint};DistanceToPoint.computeDistance=function(){if(arguments[2]instanceof PointPairDistance$2&&arguments[0]instanceof LineString$1&&arguments[1]instanceof Coordinate)for(var line=arguments[0],pt=arguments[1],ptDist=arguments[2],tempSegment=new LineSegment,coords=line.getCoordinates(),i=0;i<coords.length-1;i++){tempSegment.setCoordinates(coords[i],coords[i+1]);var closestPt=tempSegment.closestPoint(pt);ptDist.setMinimum(closestPt,pt)}else if(arguments[2]instanceof PointPairDistance$2&&arguments[0]instanceof Polygon&&arguments[1]instanceof Coordinate){var poly=arguments[0],pt$1=arguments[1],ptDist$1=arguments[2];DistanceToPoint.computeDistance(poly.getExteriorRing(),pt$1,ptDist$1);for(var i$1=0;i$1<poly.getNumInteriorRing();i$1++)DistanceToPoint.computeDistance(poly.getInteriorRingN(i$1),pt$1,ptDist$1)}else if(arguments[2]instanceof PointPairDistance$2&&arguments[0]instanceof Geometry&&arguments[1]instanceof Coordinate){var geom=arguments[0],pt$2=arguments[1],ptDist$2=arguments[2];if(geom instanceof LineString$1)DistanceToPoint.computeDistance(geom,pt$2,ptDist$2);else if(geom instanceof Polygon)DistanceToPoint.computeDistance(geom,pt$2,ptDist$2);else if(geom instanceof GeometryCollection)for(var gc=geom,i$2=0;i$2<gc.getNumGeometries();i$2++){var g=gc.getGeometryN(i$2);DistanceToPoint.computeDistance(g,pt$2,ptDist$2)}else ptDist$2.setMinimum(geom.getCoordinate(),pt$2)}else if(arguments[2]instanceof PointPairDistance$2&&arguments[0]instanceof LineSegment&&arguments[1]instanceof Coordinate){var segment=arguments[0],pt$3=arguments[1],ptDist$3=arguments[2],closestPt$1=segment.closestPoint(pt$3);ptDist$3.setMinimum(closestPt$1,pt$3)}};var DiscreteHausdorffDistance=function(){this._g0=null,this._g1=null,this._ptDist=new PointPairDistance$2,this._densifyFrac=0;var g0=arguments[0],g1=arguments[1];this._g0=g0,this._g1=g1},staticAccessors$39={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};DiscreteHausdorffDistance.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};DiscreteHausdorffDistance.prototype.setDensifyFraction=function(densifyFrac){if(densifyFrac>1||densifyFrac<=0)throw new IllegalArgumentException("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=densifyFrac};DiscreteHausdorffDistance.prototype.compute=function(g0,g1){this.computeOrientedDistance(g0,g1,this._ptDist),this.computeOrientedDistance(g1,g0,this._ptDist)};DiscreteHausdorffDistance.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};DiscreteHausdorffDistance.prototype.computeOrientedDistance=function(discreteGeom,geom,ptDist){var distFilter=new MaxPointDistanceFilter$1(geom);if(discreteGeom.apply(distFilter),ptDist.setMaximum(distFilter.getMaxPointDistance()),this._densifyFrac>0){var fracFilter=new MaxDensifiedByFractionDistanceFilter(geom,this._densifyFrac);discreteGeom.apply(fracFilter),ptDist.setMaximum(fracFilter.getMaxPointDistance())}};DiscreteHausdorffDistance.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};DiscreteHausdorffDistance.prototype.interfaces_=function(){return[]};DiscreteHausdorffDistance.prototype.getClass=function(){return DiscreteHausdorffDistance};DiscreteHausdorffDistance.distance=function(){if(arguments.length===2){var g0=arguments[0],g1=arguments[1],dist2=new DiscreteHausdorffDistance(g0,g1);return dist2.distance()}else if(arguments.length===3){var g0$1=arguments[0],g1$1=arguments[1],densifyFrac=arguments[2],dist$12=new DiscreteHausdorffDistance(g0$1,g1$1);return dist$12.setDensifyFraction(densifyFrac),dist$12.distance()}};staticAccessors$39.MaxPointDistanceFilter.get=function(){return MaxPointDistanceFilter$1};staticAccessors$39.MaxDensifiedByFractionDistanceFilter.get=function(){return MaxDensifiedByFractionDistanceFilter};Object.defineProperties(DiscreteHausdorffDistance,staticAccessors$39);var MaxPointDistanceFilter$1=function(){this._maxPtDist=new PointPairDistance$2,this._minPtDist=new PointPairDistance$2,this._euclideanDist=new DistanceToPoint,this._geom=null;var geom=arguments[0];this._geom=geom};MaxPointDistanceFilter$1.prototype.filter=function(pt){this._minPtDist.initialize(),DistanceToPoint.computeDistance(this._geom,pt,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};MaxPointDistanceFilter$1.prototype.getMaxPointDistance=function(){return this._maxPtDist};MaxPointDistanceFilter$1.prototype.interfaces_=function(){return[CoordinateFilter]};MaxPointDistanceFilter$1.prototype.getClass=function(){return MaxPointDistanceFilter$1};var MaxDensifiedByFractionDistanceFilter=function(){this._maxPtDist=new PointPairDistance$2,this._minPtDist=new PointPairDistance$2,this._geom=null,this._numSubSegs=0;var geom=arguments[0],fraction=arguments[1];this._geom=geom,this._numSubSegs=Math.trunc(Math.round(1/fraction))};MaxDensifiedByFractionDistanceFilter.prototype.filter=function(seq,index){var this$1=this;if(index===0)return null;for(var p0=seq.getCoordinate(index-1),p1=seq.getCoordinate(index),delx=(p1.x-p0.x)/this._numSubSegs,dely=(p1.y-p0.y)/this._numSubSegs,i=0;i<this._numSubSegs;i++){var x2=p0.x+i*delx,y2=p0.y+i*dely,pt=new Coordinate(x2,y2);this$1._minPtDist.initialize(),DistanceToPoint.computeDistance(this$1._geom,pt,this$1._minPtDist),this$1._maxPtDist.setMaximum(this$1._minPtDist)}};MaxDensifiedByFractionDistanceFilter.prototype.isDone=function(){return!1};MaxDensifiedByFractionDistanceFilter.prototype.isGeometryChanged=function(){return!1};MaxDensifiedByFractionDistanceFilter.prototype.getMaxPointDistance=function(){return this._maxPtDist};MaxDensifiedByFractionDistanceFilter.prototype.interfaces_=function(){return[CoordinateSequenceFilter]};MaxDensifiedByFractionDistanceFilter.prototype.getClass=function(){return MaxDensifiedByFractionDistanceFilter};var BufferDistanceValidator=function(input,bufDistance,result){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=input||null,this._bufDistance=bufDistance||null,this._result=result||null},staticAccessors$37={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};BufferDistanceValidator.prototype.checkMaximumDistance=function(input,bufCurve,maxDist){var haus=new DiscreteHausdorffDistance(bufCurve,input);if(haus.setDensifyFraction(.25),this._maxDistanceFound=haus.orientedDistance(),this._maxDistanceFound>maxDist){this._isValid=!1;var pts=haus.getCoordinates();this._errorLocation=pts[1],this._errorIndicator=input.getFactory().createLineString(pts),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+WKTWriter.toLineString(pts[0],pts[1])+")"}};BufferDistanceValidator.prototype.isValid=function(){var posDistance=Math.abs(this._bufDistance),distDelta=BufferDistanceValidator.MAX_DISTANCE_DIFF_FRAC*posDistance;return this._minValidDistance=posDistance-distDelta,this._maxValidDistance=posDistance+distDelta,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),BufferDistanceValidator.VERBOSE&&System.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};BufferDistanceValidator.prototype.checkNegativeValid=function(){if(!(this._input instanceof Polygon||this._input instanceof MultiPolygon||this._input instanceof GeometryCollection))return null;var inputCurve=this.getPolygonLines(this._input);if(this.checkMinimumDistance(inputCurve,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(inputCurve,this._result,this._maxValidDistance)};BufferDistanceValidator.prototype.getErrorIndicator=function(){return this._errorIndicator};BufferDistanceValidator.prototype.checkMinimumDistance=function(g1,g2,minDist){var distOp=new DistanceOp(g1,g2,minDist);if(this._minDistanceFound=distOp.distance(),this._minDistanceFound<minDist){this._isValid=!1;var pts=distOp.nearestPoints();this._errorLocation=distOp.nearestPoints()[1],this._errorIndicator=g1.getFactory().createLineString(pts),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+WKTWriter.toLineString(pts[0],pts[1])+" )"}};BufferDistanceValidator.prototype.checkPositiveValid=function(){var bufCurve=this._result.getBoundary();if(this.checkMinimumDistance(this._input,bufCurve,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,bufCurve,this._maxValidDistance)};BufferDistanceValidator.prototype.getErrorLocation=function(){return this._errorLocation};BufferDistanceValidator.prototype.getPolygonLines=function(g){for(var lines=new ArrayList,lineExtracter=new LinearComponentExtracter(lines),polys=PolygonExtracter.getPolygons(g),i=polys.iterator();i.hasNext();){var poly=i.next();poly.apply(lineExtracter)}return g.getFactory().buildGeometry(lines)};BufferDistanceValidator.prototype.getErrorMessage=function(){return this._errMsg};BufferDistanceValidator.prototype.interfaces_=function(){return[]};BufferDistanceValidator.prototype.getClass=function(){return BufferDistanceValidator};staticAccessors$37.VERBOSE.get=function(){return!1};staticAccessors$37.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(BufferDistanceValidator,staticAccessors$37);var BufferResultValidator=function(input,distance12,result){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=input||null,this._distance=distance12||null,this._result=result||null},staticAccessors$40={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};BufferResultValidator.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};BufferResultValidator.prototype.checkEnvelope=function(){if(this._distance<0)return null;var padding=this._distance*BufferResultValidator.MAX_ENV_DIFF_FRAC;padding===0&&(padding=.001);var expectedEnv=new Envelope(this._input.getEnvelopeInternal());expectedEnv.expandBy(this._distance);var bufEnv=new Envelope(this._result.getEnvelopeInternal());bufEnv.expandBy(padding),bufEnv.contains(expectedEnv)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(bufEnv)),this.report("Envelope")};BufferResultValidator.prototype.checkDistance=function(){var distValid=new BufferDistanceValidator(this._input,this._distance,this._result);distValid.isValid()||(this._isValid=!1,this._errorMsg=distValid.getErrorMessage(),this._errorLocation=distValid.getErrorLocation(),this._errorIndicator=distValid.getErrorIndicator()),this.report("Distance")};BufferResultValidator.prototype.checkArea=function(){var inputArea=this._input.getArea(),resultArea=this._result.getArea();this._distance>0&&inputArea>resultArea&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&inputArea<resultArea&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};BufferResultValidator.prototype.checkPolygonal=function(){this._result instanceof Polygon||this._result instanceof MultiPolygon||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};BufferResultValidator.prototype.getErrorIndicator=function(){return this._errorIndicator};BufferResultValidator.prototype.getErrorLocation=function(){return this._errorLocation};BufferResultValidator.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};BufferResultValidator.prototype.report=function(checkName){if(!BufferResultValidator.VERBOSE)return null;System.out.println("Check "+checkName+": "+(this._isValid?"passed":"FAILED"))};BufferResultValidator.prototype.getErrorMessage=function(){return this._errorMsg};BufferResultValidator.prototype.interfaces_=function(){return[]};BufferResultValidator.prototype.getClass=function(){return BufferResultValidator};BufferResultValidator.isValidMsg=function(g,distance12,result){var validator=new BufferResultValidator(g,distance12,result);return validator.isValid()?null:validator.getErrorMessage()};BufferResultValidator.isValid=function(g,distance12,result){var validator=new BufferResultValidator(g,distance12,result);return!!validator.isValid()};staticAccessors$40.VERBOSE.get=function(){return!1};staticAccessors$40.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(BufferResultValidator,staticAccessors$40);var BasicSegmentString=function(){this._pts=null,this._data=null;var pts=arguments[0],data=arguments[1];this._pts=pts,this._data=data};BasicSegmentString.prototype.getCoordinates=function(){return this._pts};BasicSegmentString.prototype.size=function(){return this._pts.length};BasicSegmentString.prototype.getCoordinate=function(i){return this._pts[i]};BasicSegmentString.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};BasicSegmentString.prototype.getSegmentOctant=function(index){return index===this._pts.length-1?-1:Octant.octant(this.getCoordinate(index),this.getCoordinate(index+1))};BasicSegmentString.prototype.setData=function(data){this._data=data};BasicSegmentString.prototype.getData=function(){return this._data};BasicSegmentString.prototype.toString=function(){return WKTWriter.toLineString(new CoordinateArraySequence(this._pts))};BasicSegmentString.prototype.interfaces_=function(){return[SegmentString]};BasicSegmentString.prototype.getClass=function(){return BasicSegmentString};var InteriorIntersectionFinder=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new ArrayList,this._intersectionCount=0,this._keepIntersections=!0;var li=arguments[0];this._li=li,this._interiorIntersection=null};InteriorIntersectionFinder.prototype.getInteriorIntersection=function(){return this._interiorIntersection};InteriorIntersectionFinder.prototype.setCheckEndSegmentsOnly=function(isCheckEndSegmentsOnly){this._isCheckEndSegmentsOnly=isCheckEndSegmentsOnly};InteriorIntersectionFinder.prototype.getIntersectionSegments=function(){return this._intSegments};InteriorIntersectionFinder.prototype.count=function(){return this._intersectionCount};InteriorIntersectionFinder.prototype.getIntersections=function(){return this._intersections};InteriorIntersectionFinder.prototype.setFindAllIntersections=function(findAllIntersections){this._findAllIntersections=findAllIntersections};InteriorIntersectionFinder.prototype.setKeepIntersections=function(keepIntersections){this._keepIntersections=keepIntersections};InteriorIntersectionFinder.prototype.processIntersections=function(e0,segIndex0,e1,segIndex1){if(!this._findAllIntersections&&this.hasIntersection()||e0===e1&&segIndex0===segIndex1)return null;if(this._isCheckEndSegmentsOnly){var isEndSegPresent=this.isEndSegment(e0,segIndex0)||this.isEndSegment(e1,segIndex1);if(!isEndSegPresent)return null}var p002=e0.getCoordinates()[segIndex0],p012=e0.getCoordinates()[segIndex0+1],p102=e1.getCoordinates()[segIndex1],p112=e1.getCoordinates()[segIndex1+1];this._li.computeIntersection(p002,p012,p102,p112),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=p002,this._intSegments[1]=p012,this._intSegments[2]=p102,this._intSegments[3]=p112,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};InteriorIntersectionFinder.prototype.isEndSegment=function(segStr,index){return index===0||index>=segStr.size()-2};InteriorIntersectionFinder.prototype.hasIntersection=function(){return this._interiorIntersection!==null};InteriorIntersectionFinder.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};InteriorIntersectionFinder.prototype.interfaces_=function(){return[SegmentIntersector]};InteriorIntersectionFinder.prototype.getClass=function(){return InteriorIntersectionFinder};InteriorIntersectionFinder.createAllIntersectionsFinder=function(li){var finder=new InteriorIntersectionFinder(li);return finder.setFindAllIntersections(!0),finder};InteriorIntersectionFinder.createAnyIntersectionFinder=function(li){return new InteriorIntersectionFinder(li)};InteriorIntersectionFinder.createIntersectionCounter=function(li){var finder=new InteriorIntersectionFinder(li);return finder.setFindAllIntersections(!0),finder.setKeepIntersections(!1),finder};var FastNodingValidator=function(){this._li=new RobustLineIntersector,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var segStrings=arguments[0];this._segStrings=segStrings};FastNodingValidator.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};FastNodingValidator.prototype.getIntersections=function(){return this._segInt.getIntersections()};FastNodingValidator.prototype.isValid=function(){return this.execute(),this._isValid};FastNodingValidator.prototype.setFindAllIntersections=function(findAllIntersections){this._findAllIntersections=findAllIntersections};FastNodingValidator.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new InteriorIntersectionFinder(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var noder=new MCIndexNoder;if(noder.setSegmentIntersector(this._segInt),noder.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};FastNodingValidator.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new TopologyException(this.getErrorMessage(),this._segInt.getInteriorIntersection())};FastNodingValidator.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var intSegs=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+WKTWriter.toLineString(intSegs[0],intSegs[1])+" and "+WKTWriter.toLineString(intSegs[2],intSegs[3])};FastNodingValidator.prototype.interfaces_=function(){return[]};FastNodingValidator.prototype.getClass=function(){return FastNodingValidator};FastNodingValidator.computeIntersections=function(segStrings){var nv=new FastNodingValidator(segStrings);return nv.setFindAllIntersections(!0),nv.isValid(),nv.getIntersections()};var EdgeNodingValidator=function EdgeNodingValidator2(){this._nv=null;var edges2=arguments[0];this._nv=new FastNodingValidator(EdgeNodingValidator2.toSegmentStrings(edges2))};EdgeNodingValidator.prototype.checkValid=function(){this._nv.checkValid()};EdgeNodingValidator.prototype.interfaces_=function(){return[]};EdgeNodingValidator.prototype.getClass=function(){return EdgeNodingValidator};EdgeNodingValidator.toSegmentStrings=function(edges2){for(var segStrings=new ArrayList,i=edges2.iterator();i.hasNext();){var e=i.next();segStrings.add(new BasicSegmentString(e.getCoordinates(),e))}return segStrings};EdgeNodingValidator.checkValid=function(edges2){var validator=new EdgeNodingValidator(edges2);validator.checkValid()};var GeometryCollectionMapper=function(mapOp){this._mapOp=mapOp};GeometryCollectionMapper.prototype.map=function(gc){for(var this$1=this,mapped=new ArrayList,i=0;i<gc.getNumGeometries();i++){var g=this$1._mapOp.map(gc.getGeometryN(i));g.isEmpty()||mapped.add(g)}return gc.getFactory().createGeometryCollection(GeometryFactory.toGeometryArray(mapped))};GeometryCollectionMapper.prototype.interfaces_=function(){return[]};GeometryCollectionMapper.prototype.getClass=function(){return GeometryCollectionMapper};GeometryCollectionMapper.map=function(gc,op){var mapper=new GeometryCollectionMapper(op);return mapper.map(gc)};var LineBuilder=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new ArrayList,this._resultLineList=new ArrayList;var op=arguments[0],geometryFactory=arguments[1],ptLocator=arguments[2];this._op=op,this._geometryFactory=geometryFactory,this._ptLocator=ptLocator};LineBuilder.prototype.collectLines=function(opCode){for(var this$1=this,it=this._op.getGraph().getEdgeEnds().iterator();it.hasNext();){var de=it.next();this$1.collectLineEdge(de,opCode,this$1._lineEdgesList),this$1.collectBoundaryTouchEdge(de,opCode,this$1._lineEdgesList)}};LineBuilder.prototype.labelIsolatedLine=function(e,targetIndex){var loc=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(targetIndex));e.getLabel().setLocation(targetIndex,loc)};LineBuilder.prototype.build=function(opCode){return this.findCoveredLineEdges(),this.collectLines(opCode),this.buildLines(opCode),this._resultLineList};LineBuilder.prototype.collectLineEdge=function(de,opCode,edges2){var label=de.getLabel(),e=de.getEdge();de.isLineEdge()&&!de.isVisited()&&OverlayOp.isResultOfOp(label,opCode)&&!e.isCovered()&&(edges2.add(e),de.setVisitedEdge(!0))};LineBuilder.prototype.findCoveredLineEdges=function(){for(var this$1=this,nodeit=this._op.getGraph().getNodes().iterator();nodeit.hasNext();){var node=nodeit.next();node.getEdges().findCoveredLineEdges()}for(var it=this._op.getGraph().getEdgeEnds().iterator();it.hasNext();){var de=it.next(),e=de.getEdge();if(de.isLineEdge()&&!e.isCoveredSet()){var isCovered2=this$1._op.isCoveredByA(de.getCoordinate());e.setCovered(isCovered2)}}};LineBuilder.prototype.labelIsolatedLines=function(edgesList){for(var this$1=this,it=edgesList.iterator();it.hasNext();){var e=it.next(),label=e.getLabel();e.isIsolated()&&(label.isNull(0)?this$1.labelIsolatedLine(e,0):this$1.labelIsolatedLine(e,1))}};LineBuilder.prototype.buildLines=function(opCode){for(var this$1=this,it=this._lineEdgesList.iterator();it.hasNext();){var e=it.next(),line=this$1._geometryFactory.createLineString(e.getCoordinates());this$1._resultLineList.add(line),e.setInResult(!0)}};LineBuilder.prototype.collectBoundaryTouchEdge=function(de,opCode,edges2){var label=de.getLabel();if(de.isLineEdge()||de.isVisited()||de.isInteriorAreaEdge()||de.getEdge().isInResult())return null;Assert.isTrue(!(de.isInResult()||de.getSym().isInResult())||!de.getEdge().isInResult()),OverlayOp.isResultOfOp(label,opCode)&&opCode===OverlayOp.INTERSECTION&&(edges2.add(de.getEdge()),de.setVisitedEdge(!0))};LineBuilder.prototype.interfaces_=function(){return[]};LineBuilder.prototype.getClass=function(){return LineBuilder};var PointBuilder=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new ArrayList;var op=arguments[0],geometryFactory=arguments[1];this._op=op,this._geometryFactory=geometryFactory};PointBuilder.prototype.filterCoveredNodeToPoint=function(n){var coord=n.getCoordinate();if(!this._op.isCoveredByLA(coord)){var pt=this._geometryFactory.createPoint(coord);this._resultPointList.add(pt)}};PointBuilder.prototype.extractNonCoveredResultNodes=function(opCode){for(var this$1=this,nodeit=this._op.getGraph().getNodes().iterator();nodeit.hasNext();){var n=nodeit.next();if(!n.isInResult()&&!n.isIncidentEdgeInResult()&&(n.getEdges().getDegree()===0||opCode===OverlayOp.INTERSECTION)){var label=n.getLabel();OverlayOp.isResultOfOp(label,opCode)&&this$1.filterCoveredNodeToPoint(n)}}};PointBuilder.prototype.build=function(opCode){return this.extractNonCoveredResultNodes(opCode),this._resultPointList};PointBuilder.prototype.interfaces_=function(){return[]};PointBuilder.prototype.getClass=function(){return PointBuilder};var GeometryTransformer=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};GeometryTransformer.prototype.transformPoint=function(geom,parent){return this._factory.createPoint(this.transformCoordinates(geom.getCoordinateSequence(),geom))};GeometryTransformer.prototype.transformPolygon=function(geom,parent){var this$1=this,isAllValidLinearRings=!0,shell=this.transformLinearRing(geom.getExteriorRing(),geom);(shell===null||!(shell instanceof LinearRing)||shell.isEmpty())&&(isAllValidLinearRings=!1);for(var holes=new ArrayList,i=0;i<geom.getNumInteriorRing();i++){var hole=this$1.transformLinearRing(geom.getInteriorRingN(i),geom);hole===null||hole.isEmpty()||(hole instanceof LinearRing||(isAllValidLinearRings=!1),holes.add(hole))}if(isAllValidLinearRings)return this._factory.createPolygon(shell,holes.toArray([]));var components=new ArrayList;return shell!==null&&components.add(shell),components.addAll(holes),this._factory.buildGeometry(components)};GeometryTransformer.prototype.createCoordinateSequence=function(coords){return this._factory.getCoordinateSequenceFactory().create(coords)};GeometryTransformer.prototype.getInputGeometry=function(){return this._inputGeom};GeometryTransformer.prototype.transformMultiLineString=function(geom,parent){for(var this$1=this,transGeomList=new ArrayList,i=0;i<geom.getNumGeometries();i++){var transformGeom=this$1.transformLineString(geom.getGeometryN(i),geom);transformGeom!==null&&(transformGeom.isEmpty()||transGeomList.add(transformGeom))}return this._factory.buildGeometry(transGeomList)};GeometryTransformer.prototype.transformCoordinates=function(coords,parent){return this.copy(coords)};GeometryTransformer.prototype.transformLineString=function(geom,parent){return this._factory.createLineString(this.transformCoordinates(geom.getCoordinateSequence(),geom))};GeometryTransformer.prototype.transformMultiPoint=function(geom,parent){for(var this$1=this,transGeomList=new ArrayList,i=0;i<geom.getNumGeometries();i++){var transformGeom=this$1.transformPoint(geom.getGeometryN(i),geom);transformGeom!==null&&(transformGeom.isEmpty()||transGeomList.add(transformGeom))}return this._factory.buildGeometry(transGeomList)};GeometryTransformer.prototype.transformMultiPolygon=function(geom,parent){for(var this$1=this,transGeomList=new ArrayList,i=0;i<geom.getNumGeometries();i++){var transformGeom=this$1.transformPolygon(geom.getGeometryN(i),geom);transformGeom!==null&&(transformGeom.isEmpty()||transGeomList.add(transformGeom))}return this._factory.buildGeometry(transGeomList)};GeometryTransformer.prototype.copy=function(seq){return seq.copy()};GeometryTransformer.prototype.transformGeometryCollection=function(geom,parent){for(var this$1=this,transGeomList=new ArrayList,i=0;i<geom.getNumGeometries();i++){var transformGeom=this$1.transform(geom.getGeometryN(i));transformGeom!==null&&(this$1._pruneEmptyGeometry&&transformGeom.isEmpty()||transGeomList.add(transformGeom))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(GeometryFactory.toGeometryArray(transGeomList)):this._factory.buildGeometry(transGeomList)};GeometryTransformer.prototype.transform=function(inputGeom){if(this._inputGeom=inputGeom,this._factory=inputGeom.getFactory(),inputGeom instanceof Point)return this.transformPoint(inputGeom,null);if(inputGeom instanceof MultiPoint)return this.transformMultiPoint(inputGeom,null);if(inputGeom instanceof LinearRing)return this.transformLinearRing(inputGeom,null);if(inputGeom instanceof LineString$1)return this.transformLineString(inputGeom,null);if(inputGeom instanceof MultiLineString)return this.transformMultiLineString(inputGeom,null);if(inputGeom instanceof Polygon)return this.transformPolygon(inputGeom,null);if(inputGeom instanceof MultiPolygon)return this.transformMultiPolygon(inputGeom,null);if(inputGeom instanceof GeometryCollection)return this.transformGeometryCollection(inputGeom,null);throw new IllegalArgumentException("Unknown Geometry subtype: "+inputGeom.getClass().getName())};GeometryTransformer.prototype.transformLinearRing=function(geom,parent){var seq=this.transformCoordinates(geom.getCoordinateSequence(),geom);if(seq===null)return this._factory.createLinearRing(null);var seqSize=seq.size();return seqSize>0&&seqSize<4&&!this._preserveType?this._factory.createLineString(seq):this._factory.createLinearRing(seq)};GeometryTransformer.prototype.interfaces_=function(){return[]};GeometryTransformer.prototype.getClass=function(){return GeometryTransformer};var LineStringSnapper=function LineStringSnapper2(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new LineSegment,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof LineString$1&&typeof arguments[1]=="number"){var srcLine=arguments[0],snapTolerance=arguments[1];LineStringSnapper2.call(this,srcLine.getCoordinates(),snapTolerance)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var srcPts=arguments[0],snapTolerance$1=arguments[1];this._srcPts=srcPts,this._isClosed=LineStringSnapper2.isClosed(srcPts),this._snapTolerance=snapTolerance$1}};LineStringSnapper.prototype.snapVertices=function(srcCoords,snapPts){for(var this$1=this,end=this._isClosed?srcCoords.size()-1:srcCoords.size(),i=0;i<end;i++){var srcPt=srcCoords.get(i),snapVert=this$1.findSnapForVertex(srcPt,snapPts);snapVert!==null&&(srcCoords.set(i,new Coordinate(snapVert)),i===0&&this$1._isClosed&&srcCoords.set(srcCoords.size()-1,new Coordinate(snapVert)))}};LineStringSnapper.prototype.findSnapForVertex=function(pt,snapPts){for(var this$1=this,i=0;i<snapPts.length;i++){if(pt.equals2D(snapPts[i]))return null;if(pt.distance(snapPts[i])<this$1._snapTolerance)return snapPts[i]}return null};LineStringSnapper.prototype.snapTo=function(snapPts){var coordList=new CoordinateList(this._srcPts);this.snapVertices(coordList,snapPts),this.snapSegments(coordList,snapPts);var newPts=coordList.toCoordinateArray();return newPts};LineStringSnapper.prototype.snapSegments=function(srcCoords,snapPts){var this$1=this;if(snapPts.length===0)return null;var distinctPtCount=snapPts.length;snapPts[0].equals2D(snapPts[snapPts.length-1])&&(distinctPtCount=snapPts.length-1);for(var i=0;i<distinctPtCount;i++){var snapPt=snapPts[i],index=this$1.findSegmentIndexToSnap(snapPt,srcCoords);index>=0&&srcCoords.add(index+1,new Coordinate(snapPt),!1)}};LineStringSnapper.prototype.findSegmentIndexToSnap=function(snapPt,srcCoords){for(var this$1=this,minDist=Double.MAX_VALUE,snapIndex=-1,i=0;i<srcCoords.size()-1;i++){if(this$1._seg.p0=srcCoords.get(i),this$1._seg.p1=srcCoords.get(i+1),this$1._seg.p0.equals2D(snapPt)||this$1._seg.p1.equals2D(snapPt)){if(this$1._allowSnappingToSourceVertices)continue;return-1}var dist2=this$1._seg.distance(snapPt);dist2<this$1._snapTolerance&&dist2<minDist&&(minDist=dist2,snapIndex=i)}return snapIndex};LineStringSnapper.prototype.setAllowSnappingToSourceVertices=function(allowSnappingToSourceVertices){this._allowSnappingToSourceVertices=allowSnappingToSourceVertices};LineStringSnapper.prototype.interfaces_=function(){return[]};LineStringSnapper.prototype.getClass=function(){return LineStringSnapper};LineStringSnapper.isClosed=function(pts){return pts.length<=1?!1:pts[0].equals2D(pts[pts.length-1])};var GeometrySnapper=function(srcGeom){this._srcGeom=srcGeom||null},staticAccessors$41={SNAP_PRECISION_FACTOR:{configurable:!0}};GeometrySnapper.prototype.snapTo=function(snapGeom,snapTolerance){var snapPts=this.extractTargetCoordinates(snapGeom),snapTrans=new SnapTransformer(snapTolerance,snapPts);return snapTrans.transform(this._srcGeom)};GeometrySnapper.prototype.snapToSelf=function(snapTolerance,cleanResult){var snapPts=this.extractTargetCoordinates(this._srcGeom),snapTrans=new SnapTransformer(snapTolerance,snapPts,!0),snappedGeom=snapTrans.transform(this._srcGeom),result=snappedGeom;return cleanResult&&hasInterface(result,Polygonal)&&(result=snappedGeom.buffer(0)),result};GeometrySnapper.prototype.computeSnapTolerance=function(ringPts){var minSegLen=this.computeMinimumSegmentLength(ringPts),snapTol=minSegLen/10;return snapTol};GeometrySnapper.prototype.extractTargetCoordinates=function(g){for(var ptSet=new TreeSet,pts=g.getCoordinates(),i=0;i<pts.length;i++)ptSet.add(pts[i]);return ptSet.toArray(new Array(0).fill(null))};GeometrySnapper.prototype.computeMinimumSegmentLength=function(pts){for(var minSegLen=Double.MAX_VALUE,i=0;i<pts.length-1;i++){var segLen=pts[i].distance(pts[i+1]);segLen<minSegLen&&(minSegLen=segLen)}return minSegLen};GeometrySnapper.prototype.interfaces_=function(){return[]};GeometrySnapper.prototype.getClass=function(){return GeometrySnapper};GeometrySnapper.snap=function(g0,g1,snapTolerance){var snapGeom=new Array(2).fill(null),snapper0=new GeometrySnapper(g0);snapGeom[0]=snapper0.snapTo(g1,snapTolerance);var snapper1=new GeometrySnapper(g1);return snapGeom[1]=snapper1.snapTo(snapGeom[0],snapTolerance),snapGeom};GeometrySnapper.computeOverlaySnapTolerance=function(){if(arguments.length===1){var g=arguments[0],snapTolerance=GeometrySnapper.computeSizeBasedSnapTolerance(g),pm=g.getPrecisionModel();if(pm.getType()===PrecisionModel.FIXED){var fixedSnapTol=1/pm.getScale()*2/1.415;fixedSnapTol>snapTolerance&&(snapTolerance=fixedSnapTol)}return snapTolerance}else if(arguments.length===2){var g0=arguments[0],g1=arguments[1];return Math.min(GeometrySnapper.computeOverlaySnapTolerance(g0),GeometrySnapper.computeOverlaySnapTolerance(g1))}};GeometrySnapper.computeSizeBasedSnapTolerance=function(g){var env=g.getEnvelopeInternal(),minDimension=Math.min(env.getHeight(),env.getWidth()),snapTol=minDimension*GeometrySnapper.SNAP_PRECISION_FACTOR;return snapTol};GeometrySnapper.snapToSelf=function(geom,snapTolerance,cleanResult){var snapper0=new GeometrySnapper(geom);return snapper0.snapToSelf(snapTolerance,cleanResult)};staticAccessors$41.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(GeometrySnapper,staticAccessors$41);var SnapTransformer=function(GeometryTransformer$$1){function SnapTransformer2(snapTolerance,snapPts,isSelfSnap){GeometryTransformer$$1.call(this),this._snapTolerance=snapTolerance||null,this._snapPts=snapPts||null,this._isSelfSnap=isSelfSnap!==void 0?isSelfSnap:!1}return GeometryTransformer$$1&&(SnapTransformer2.__proto__=GeometryTransformer$$1),SnapTransformer2.prototype=Object.create(GeometryTransformer$$1&&GeometryTransformer$$1.prototype),SnapTransformer2.prototype.constructor=SnapTransformer2,SnapTransformer2.prototype.snapLine=function(srcPts,snapPts){var snapper=new LineStringSnapper(srcPts,this._snapTolerance);return snapper.setAllowSnappingToSourceVertices(this._isSelfSnap),snapper.snapTo(snapPts)},SnapTransformer2.prototype.transformCoordinates=function(coords,parent){var srcPts=coords.toCoordinateArray(),newPts=this.snapLine(srcPts,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(newPts)},SnapTransformer2.prototype.interfaces_=function(){return[]},SnapTransformer2.prototype.getClass=function(){return SnapTransformer2},SnapTransformer2}(GeometryTransformer),CommonBits=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};CommonBits.prototype.getCommon=function(){return Double.longBitsToDouble(this._commonBits)};CommonBits.prototype.add=function(num){var numBits=Double.doubleToLongBits(num);if(this._isFirst)return this._commonBits=numBits,this._commonSignExp=CommonBits.signExpBits(this._commonBits),this._isFirst=!1,null;var numSignExp=CommonBits.signExpBits(numBits);if(numSignExp!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=CommonBits.numCommonMostSigMantissaBits(this._commonBits,numBits),this._commonBits=CommonBits.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};CommonBits.prototype.toString=function(){if(arguments.length===1){var bits=arguments[0],x2=Double.longBitsToDouble(bits),numStr=Double.toBinaryString(bits),padStr="0000000000000000000000000000000000000000000000000000000000000000"+numStr,bitStr=padStr.substring(padStr.length-64),str=bitStr.substring(0,1)+"  "+bitStr.substring(1,12)+"(exp) "+bitStr.substring(12)+" [ "+x2+" ]";return str}};CommonBits.prototype.interfaces_=function(){return[]};CommonBits.prototype.getClass=function(){return CommonBits};CommonBits.getBit=function(bits,i){var mask2=1<<i;return(bits&mask2)!==0?1:0};CommonBits.signExpBits=function(num){return num>>52};CommonBits.zeroLowerBits=function(bits,nBits){var invMask=(1<<nBits)-1,mask2=~invMask,zeroed=bits&mask2;return zeroed};CommonBits.numCommonMostSigMantissaBits=function(num1,num2){for(var count2=0,i=52;i>=0;i--){if(CommonBits.getBit(num1,i)!==CommonBits.getBit(num2,i))return count2;count2++}return 52};var CommonBitsRemover=function(){this._commonCoord=null,this._ccFilter=new CommonCoordinateFilter},staticAccessors$42={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};CommonBitsRemover.prototype.addCommonBits=function(geom){var trans=new Translater(this._commonCoord);geom.apply(trans),geom.geometryChanged()};CommonBitsRemover.prototype.removeCommonBits=function(geom){if(this._commonCoord.x===0&&this._commonCoord.y===0)return geom;var invCoord=new Coordinate(this._commonCoord);invCoord.x=-invCoord.x,invCoord.y=-invCoord.y;var trans=new Translater(invCoord);return geom.apply(trans),geom.geometryChanged(),geom};CommonBitsRemover.prototype.getCommonCoordinate=function(){return this._commonCoord};CommonBitsRemover.prototype.add=function(geom){geom.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};CommonBitsRemover.prototype.interfaces_=function(){return[]};CommonBitsRemover.prototype.getClass=function(){return CommonBitsRemover};staticAccessors$42.CommonCoordinateFilter.get=function(){return CommonCoordinateFilter};staticAccessors$42.Translater.get=function(){return Translater};Object.defineProperties(CommonBitsRemover,staticAccessors$42);var CommonCoordinateFilter=function(){this._commonBitsX=new CommonBits,this._commonBitsY=new CommonBits};CommonCoordinateFilter.prototype.filter=function(coord){this._commonBitsX.add(coord.x),this._commonBitsY.add(coord.y)};CommonCoordinateFilter.prototype.getCommonCoordinate=function(){return new Coordinate(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};CommonCoordinateFilter.prototype.interfaces_=function(){return[CoordinateFilter]};CommonCoordinateFilter.prototype.getClass=function(){return CommonCoordinateFilter};var Translater=function(){this.trans=null;var trans=arguments[0];this.trans=trans};Translater.prototype.filter=function(seq,i){var xp=seq.getOrdinate(i,0)+this.trans.x,yp=seq.getOrdinate(i,1)+this.trans.y;seq.setOrdinate(i,0,xp),seq.setOrdinate(i,1,yp)};Translater.prototype.isDone=function(){return!1};Translater.prototype.isGeometryChanged=function(){return!0};Translater.prototype.interfaces_=function(){return[CoordinateSequenceFilter]};Translater.prototype.getClass=function(){return Translater};var SnapOverlayOp=function(g1,g2){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=g1,this._geom[1]=g2,this.computeSnapTolerance()};SnapOverlayOp.prototype.selfSnap=function(geom){var snapper0=new GeometrySnapper(geom),snapGeom=snapper0.snapTo(geom,this._snapTolerance);return snapGeom};SnapOverlayOp.prototype.removeCommonBits=function(geom){this._cbr=new CommonBitsRemover,this._cbr.add(geom[0]),this._cbr.add(geom[1]);var remGeom=new Array(2).fill(null);return remGeom[0]=this._cbr.removeCommonBits(geom[0].copy()),remGeom[1]=this._cbr.removeCommonBits(geom[1].copy()),remGeom};SnapOverlayOp.prototype.prepareResult=function(geom){return this._cbr.addCommonBits(geom),geom};SnapOverlayOp.prototype.getResultGeometry=function(opCode){var prepGeom=this.snap(this._geom),result=OverlayOp.overlayOp(prepGeom[0],prepGeom[1],opCode);return this.prepareResult(result)};SnapOverlayOp.prototype.checkValid=function(g){g.isValid()||System.out.println("Snapped geometry is invalid")};SnapOverlayOp.prototype.computeSnapTolerance=function(){this._snapTolerance=GeometrySnapper.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};SnapOverlayOp.prototype.snap=function(geom){var remGeom=this.removeCommonBits(geom),snapGeom=GeometrySnapper.snap(remGeom[0],remGeom[1],this._snapTolerance);return snapGeom};SnapOverlayOp.prototype.interfaces_=function(){return[]};SnapOverlayOp.prototype.getClass=function(){return SnapOverlayOp};SnapOverlayOp.overlayOp=function(g0,g1,opCode){var op=new SnapOverlayOp(g0,g1);return op.getResultGeometry(opCode)};SnapOverlayOp.union=function(g0,g1){return SnapOverlayOp.overlayOp(g0,g1,OverlayOp.UNION)};SnapOverlayOp.intersection=function(g0,g1){return SnapOverlayOp.overlayOp(g0,g1,OverlayOp.INTERSECTION)};SnapOverlayOp.symDifference=function(g0,g1){return SnapOverlayOp.overlayOp(g0,g1,OverlayOp.SYMDIFFERENCE)};SnapOverlayOp.difference=function(g0,g1){return SnapOverlayOp.overlayOp(g0,g1,OverlayOp.DIFFERENCE)};var SnapIfNeededOverlayOp=function(g1,g2){this._geom=new Array(2).fill(null),this._geom[0]=g1,this._geom[1]=g2};SnapIfNeededOverlayOp.prototype.getResultGeometry=function(opCode){var result=null,isSuccess=!1,savedException=null;try{result=OverlayOp.overlayOp(this._geom[0],this._geom[1],opCode);var isValid8=!0;isValid8&&(isSuccess=!0)}catch(ex){if(ex instanceof RuntimeException)savedException=ex;else throw ex}finally{}if(!isSuccess)try{result=SnapOverlayOp.overlayOp(this._geom[0],this._geom[1],opCode)}catch(ex){throw ex instanceof RuntimeException?savedException:ex}finally{}return result};SnapIfNeededOverlayOp.prototype.interfaces_=function(){return[]};SnapIfNeededOverlayOp.prototype.getClass=function(){return SnapIfNeededOverlayOp};SnapIfNeededOverlayOp.overlayOp=function(g0,g1,opCode){var op=new SnapIfNeededOverlayOp(g0,g1);return op.getResultGeometry(opCode)};SnapIfNeededOverlayOp.union=function(g0,g1){return SnapIfNeededOverlayOp.overlayOp(g0,g1,OverlayOp.UNION)};SnapIfNeededOverlayOp.intersection=function(g0,g1){return SnapIfNeededOverlayOp.overlayOp(g0,g1,OverlayOp.INTERSECTION)};SnapIfNeededOverlayOp.symDifference=function(g0,g1){return SnapIfNeededOverlayOp.overlayOp(g0,g1,OverlayOp.SYMDIFFERENCE)};SnapIfNeededOverlayOp.difference=function(g0,g1){return SnapIfNeededOverlayOp.overlayOp(g0,g1,OverlayOp.DIFFERENCE)};var MonotoneChain$2=function(){this.mce=null,this.chainIndex=null;var mce=arguments[0],chainIndex=arguments[1];this.mce=mce,this.chainIndex=chainIndex};MonotoneChain$2.prototype.computeIntersections=function(mc,si){this.mce.computeIntersectsForChain(this.chainIndex,mc.mce,mc.chainIndex,si)};MonotoneChain$2.prototype.interfaces_=function(){return[]};MonotoneChain$2.prototype.getClass=function(){return MonotoneChain$2};var SweepLineEvent=function SweepLineEvent2(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var x2=arguments[0],insertEvent=arguments[1];this._eventType=SweepLineEvent2.DELETE,this._xValue=x2,this._insertEvent=insertEvent}else if(arguments.length===3){var label=arguments[0],x$1=arguments[1],obj=arguments[2];this._eventType=SweepLineEvent2.INSERT,this._label=label,this._xValue=x$1,this._obj=obj}},staticAccessors$43={INSERT:{configurable:!0},DELETE:{configurable:!0}};SweepLineEvent.prototype.isDelete=function(){return this._eventType===SweepLineEvent.DELETE};SweepLineEvent.prototype.setDeleteEventIndex=function(deleteEventIndex){this._deleteEventIndex=deleteEventIndex};SweepLineEvent.prototype.getObject=function(){return this._obj};SweepLineEvent.prototype.compareTo=function(o){var pe=o;return this._xValue<pe._xValue?-1:this._xValue>pe._xValue?1:this._eventType<pe._eventType?-1:this._eventType>pe._eventType?1:0};SweepLineEvent.prototype.getInsertEvent=function(){return this._insertEvent};SweepLineEvent.prototype.isInsert=function(){return this._eventType===SweepLineEvent.INSERT};SweepLineEvent.prototype.isSameLabel=function(ev){return this._label===null?!1:this._label===ev._label};SweepLineEvent.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};SweepLineEvent.prototype.interfaces_=function(){return[Comparable]};SweepLineEvent.prototype.getClass=function(){return SweepLineEvent};staticAccessors$43.INSERT.get=function(){return 1};staticAccessors$43.DELETE.get=function(){return 2};Object.defineProperties(SweepLineEvent,staticAccessors$43);var EdgeSetIntersector=function(){};EdgeSetIntersector.prototype.interfaces_=function(){return[]};EdgeSetIntersector.prototype.getClass=function(){return EdgeSetIntersector};var SegmentIntersector$2=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var li=arguments[0],includeProper=arguments[1],recordIsolated=arguments[2];this._li=li,this._includeProper=includeProper,this._recordIsolated=recordIsolated};SegmentIntersector$2.prototype.isTrivialIntersection=function(e0,segIndex0,e1,segIndex1){if(e0===e1&&this._li.getIntersectionNum()===1){if(SegmentIntersector$2.isAdjacentSegments(segIndex0,segIndex1))return!0;if(e0.isClosed()){var maxSegIndex=e0.getNumPoints()-1;if(segIndex0===0&&segIndex1===maxSegIndex||segIndex1===0&&segIndex0===maxSegIndex)return!0}}return!1};SegmentIntersector$2.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};SegmentIntersector$2.prototype.setIsDoneIfProperInt=function(isDoneWhenProperInt){this._isDoneWhenProperInt=isDoneWhenProperInt};SegmentIntersector$2.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};SegmentIntersector$2.prototype.isBoundaryPointInternal=function(li,bdyNodes){for(var i=bdyNodes.iterator();i.hasNext();){var node=i.next(),pt=node.getCoordinate();if(li.isIntersection(pt))return!0}return!1};SegmentIntersector$2.prototype.hasProperIntersection=function(){return this._hasProper};SegmentIntersector$2.prototype.hasIntersection=function(){return this._hasIntersection};SegmentIntersector$2.prototype.isDone=function(){return this._isDone};SegmentIntersector$2.prototype.isBoundaryPoint=function(li,bdyNodes){return bdyNodes===null?!1:!!(this.isBoundaryPointInternal(li,bdyNodes[0])||this.isBoundaryPointInternal(li,bdyNodes[1]))};SegmentIntersector$2.prototype.setBoundaryNodes=function(bdyNodes0,bdyNodes1){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=bdyNodes0,this._bdyNodes[1]=bdyNodes1};SegmentIntersector$2.prototype.addIntersections=function(e0,segIndex0,e1,segIndex1){if(e0===e1&&segIndex0===segIndex1)return null;this.numTests++;var p002=e0.getCoordinates()[segIndex0],p012=e0.getCoordinates()[segIndex0+1],p102=e1.getCoordinates()[segIndex1],p112=e1.getCoordinates()[segIndex1+1];this._li.computeIntersection(p002,p012,p102,p112),this._li.hasIntersection()&&(this._recordIsolated&&(e0.setIsolated(!1),e1.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e0,segIndex0,e1,segIndex1)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e0.addIntersections(this._li,segIndex0,0),e1.addIntersections(this._li,segIndex1,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};SegmentIntersector$2.prototype.interfaces_=function(){return[]};SegmentIntersector$2.prototype.getClass=function(){return SegmentIntersector$2};SegmentIntersector$2.isAdjacentSegments=function(i1,i2){return Math.abs(i1-i2)===1};var SimpleMCSweepLineIntersector=function(EdgeSetIntersector$$1){function SimpleMCSweepLineIntersector2(){EdgeSetIntersector$$1.call(this),this.events=new ArrayList,this.nOverlaps=null}return EdgeSetIntersector$$1&&(SimpleMCSweepLineIntersector2.__proto__=EdgeSetIntersector$$1),SimpleMCSweepLineIntersector2.prototype=Object.create(EdgeSetIntersector$$1&&EdgeSetIntersector$$1.prototype),SimpleMCSweepLineIntersector2.prototype.constructor=SimpleMCSweepLineIntersector2,SimpleMCSweepLineIntersector2.prototype.prepareEvents=function(){var this$1=this;Collections.sort(this.events);for(var i=0;i<this.events.size();i++){var ev=this$1.events.get(i);ev.isDelete()&&ev.getInsertEvent().setDeleteEventIndex(i)}},SimpleMCSweepLineIntersector2.prototype.computeIntersections=function(){var this$1=this;if(arguments.length===1){var si=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var i=0;i<this.events.size();i++){var ev=this$1.events.get(i);if(ev.isInsert()&&this$1.processOverlaps(i,ev.getDeleteEventIndex(),ev,si),si.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof SegmentIntersector$2&&hasInterface(arguments[0],List)&&hasInterface(arguments[1],List)){var edges0=arguments[0],edges1=arguments[1],si$1=arguments[2];this.addEdges(edges0,edges0),this.addEdges(edges1,edges1),this.computeIntersections(si$1)}else if(typeof arguments[2]=="boolean"&&hasInterface(arguments[0],List)&&arguments[1]instanceof SegmentIntersector$2){var edges2=arguments[0],si$2=arguments[1],testAllSegments=arguments[2];testAllSegments?this.addEdges(edges2,null):this.addEdges(edges2),this.computeIntersections(si$2)}}},SimpleMCSweepLineIntersector2.prototype.addEdge=function(edge,edgeSet){for(var this$1=this,mce=edge.getMonotoneChainEdge(),startIndex=mce.getStartIndexes(),i=0;i<startIndex.length-1;i++){var mc=new MonotoneChain$2(mce,i),insertEvent=new SweepLineEvent(edgeSet,mce.getMinX(i),mc);this$1.events.add(insertEvent),this$1.events.add(new SweepLineEvent(mce.getMaxX(i),insertEvent))}},SimpleMCSweepLineIntersector2.prototype.processOverlaps=function(start2,end,ev0,si){for(var this$1=this,mc0=ev0.getObject(),i=start2;i<end;i++){var ev1=this$1.events.get(i);if(ev1.isInsert()){var mc1=ev1.getObject();ev0.isSameLabel(ev1)||(mc0.computeIntersections(mc1,si),this$1.nOverlaps++)}}},SimpleMCSweepLineIntersector2.prototype.addEdges=function(){var this$1=this;if(arguments.length===1)for(var edges2=arguments[0],i=edges2.iterator();i.hasNext();){var edge=i.next();this$1.addEdge(edge,edge)}else if(arguments.length===2)for(var edges$1=arguments[0],edgeSet=arguments[1],i$1=edges$1.iterator();i$1.hasNext();){var edge$1=i$1.next();this$1.addEdge(edge$1,edgeSet)}},SimpleMCSweepLineIntersector2.prototype.interfaces_=function(){return[]},SimpleMCSweepLineIntersector2.prototype.getClass=function(){return SimpleMCSweepLineIntersector2},SimpleMCSweepLineIntersector2}(EdgeSetIntersector),IntervalRTreeNode=function(){this._min=Double.POSITIVE_INFINITY,this._max=Double.NEGATIVE_INFINITY},staticAccessors$45={NodeComparator:{configurable:!0}};IntervalRTreeNode.prototype.getMin=function(){return this._min};IntervalRTreeNode.prototype.intersects=function(queryMin,queryMax){return!(this._min>queryMax||this._max<queryMin)};IntervalRTreeNode.prototype.getMax=function(){return this._max};IntervalRTreeNode.prototype.toString=function(){return WKTWriter.toLineString(new Coordinate(this._min,0),new Coordinate(this._max,0))};IntervalRTreeNode.prototype.interfaces_=function(){return[]};IntervalRTreeNode.prototype.getClass=function(){return IntervalRTreeNode};staticAccessors$45.NodeComparator.get=function(){return NodeComparator};Object.defineProperties(IntervalRTreeNode,staticAccessors$45);var NodeComparator=function(){};NodeComparator.prototype.compare=function(o1,o2){var n1=o1,n2=o2,mid1=(n1._min+n1._max)/2,mid2=(n2._min+n2._max)/2;return mid1<mid2?-1:mid1>mid2?1:0};NodeComparator.prototype.interfaces_=function(){return[Comparator]};NodeComparator.prototype.getClass=function(){return NodeComparator};var IntervalRTreeLeafNode=function(IntervalRTreeNode$$1){function IntervalRTreeLeafNode2(){IntervalRTreeNode$$1.call(this),this._item=null;var min4=arguments[0],max3=arguments[1],item=arguments[2];this._min=min4,this._max=max3,this._item=item}return IntervalRTreeNode$$1&&(IntervalRTreeLeafNode2.__proto__=IntervalRTreeNode$$1),IntervalRTreeLeafNode2.prototype=Object.create(IntervalRTreeNode$$1&&IntervalRTreeNode$$1.prototype),IntervalRTreeLeafNode2.prototype.constructor=IntervalRTreeLeafNode2,IntervalRTreeLeafNode2.prototype.query=function(queryMin,queryMax,visitor){if(!this.intersects(queryMin,queryMax))return null;visitor.visitItem(this._item)},IntervalRTreeLeafNode2.prototype.interfaces_=function(){return[]},IntervalRTreeLeafNode2.prototype.getClass=function(){return IntervalRTreeLeafNode2},IntervalRTreeLeafNode2}(IntervalRTreeNode),IntervalRTreeBranchNode=function(IntervalRTreeNode$$1){function IntervalRTreeBranchNode2(){IntervalRTreeNode$$1.call(this),this._node1=null,this._node2=null;var n1=arguments[0],n2=arguments[1];this._node1=n1,this._node2=n2,this.buildExtent(this._node1,this._node2)}return IntervalRTreeNode$$1&&(IntervalRTreeBranchNode2.__proto__=IntervalRTreeNode$$1),IntervalRTreeBranchNode2.prototype=Object.create(IntervalRTreeNode$$1&&IntervalRTreeNode$$1.prototype),IntervalRTreeBranchNode2.prototype.constructor=IntervalRTreeBranchNode2,IntervalRTreeBranchNode2.prototype.buildExtent=function(n1,n2){this._min=Math.min(n1._min,n2._min),this._max=Math.max(n1._max,n2._max)},IntervalRTreeBranchNode2.prototype.query=function(queryMin,queryMax,visitor){if(!this.intersects(queryMin,queryMax))return null;this._node1!==null&&this._node1.query(queryMin,queryMax,visitor),this._node2!==null&&this._node2.query(queryMin,queryMax,visitor)},IntervalRTreeBranchNode2.prototype.interfaces_=function(){return[]},IntervalRTreeBranchNode2.prototype.getClass=function(){return IntervalRTreeBranchNode2},IntervalRTreeBranchNode2}(IntervalRTreeNode),SortedPackedIntervalRTree=function(){this._leaves=new ArrayList,this._root=null,this._level=0};SortedPackedIntervalRTree.prototype.buildTree=function(){var this$1=this;Collections.sort(this._leaves,new IntervalRTreeNode.NodeComparator);for(var src=this._leaves,temp2=null,dest=new ArrayList;;){if(this$1.buildLevel(src,dest),dest.size()===1)return dest.get(0);temp2=src,src=dest,dest=temp2}};SortedPackedIntervalRTree.prototype.insert=function(min4,max3,item){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new IntervalRTreeLeafNode(min4,max3,item))};SortedPackedIntervalRTree.prototype.query=function(min4,max3,visitor){this.init(),this._root.query(min4,max3,visitor)};SortedPackedIntervalRTree.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};SortedPackedIntervalRTree.prototype.printNode=function(node){System.out.println(WKTWriter.toLineString(new Coordinate(node._min,this._level),new Coordinate(node._max,this._level)))};SortedPackedIntervalRTree.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};SortedPackedIntervalRTree.prototype.buildLevel=function(src,dest){this._level++,dest.clear();for(var i=0;i<src.size();i+=2){var n1=src.get(i),n2=i+1<src.size()?src.get(i):null;if(n2===null)dest.add(n1);else{var node=new IntervalRTreeBranchNode(src.get(i),src.get(i+1));dest.add(node)}}};SortedPackedIntervalRTree.prototype.interfaces_=function(){return[]};SortedPackedIntervalRTree.prototype.getClass=function(){return SortedPackedIntervalRTree};var ArrayListVisitor=function(){this._items=new ArrayList};ArrayListVisitor.prototype.visitItem=function(item){this._items.add(item)};ArrayListVisitor.prototype.getItems=function(){return this._items};ArrayListVisitor.prototype.interfaces_=function(){return[ItemVisitor]};ArrayListVisitor.prototype.getClass=function(){return ArrayListVisitor};var IndexedPointInAreaLocator=function(){this._index=null;var g=arguments[0];if(!hasInterface(g,Polygonal))throw new IllegalArgumentException("Argument must be Polygonal");this._index=new IntervalIndexedGeometry(g)},staticAccessors$44={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};IndexedPointInAreaLocator.prototype.locate=function(p){var rcc=new RayCrossingCounter(p),visitor=new SegmentVisitor(rcc);return this._index.query(p.y,p.y,visitor),rcc.getLocation()};IndexedPointInAreaLocator.prototype.interfaces_=function(){return[PointOnGeometryLocator]};IndexedPointInAreaLocator.prototype.getClass=function(){return IndexedPointInAreaLocator};staticAccessors$44.SegmentVisitor.get=function(){return SegmentVisitor};staticAccessors$44.IntervalIndexedGeometry.get=function(){return IntervalIndexedGeometry};Object.defineProperties(IndexedPointInAreaLocator,staticAccessors$44);var SegmentVisitor=function(){this._counter=null;var counter=arguments[0];this._counter=counter};SegmentVisitor.prototype.visitItem=function(item){var seg=item;this._counter.countSegment(seg.getCoordinate(0),seg.getCoordinate(1))};SegmentVisitor.prototype.interfaces_=function(){return[ItemVisitor]};SegmentVisitor.prototype.getClass=function(){return SegmentVisitor};var IntervalIndexedGeometry=function(){this._index=new SortedPackedIntervalRTree;var geom=arguments[0];this.init(geom)};IntervalIndexedGeometry.prototype.init=function(geom){for(var this$1=this,lines=LinearComponentExtracter.getLines(geom),i=lines.iterator();i.hasNext();){var line=i.next(),pts=line.getCoordinates();this$1.addLine(pts)}};IntervalIndexedGeometry.prototype.addLine=function(pts){for(var this$1=this,i=1;i<pts.length;i++){var seg=new LineSegment(pts[i-1],pts[i]),min4=Math.min(seg.p0.y,seg.p1.y),max3=Math.max(seg.p0.y,seg.p1.y);this$1._index.insert(min4,max3,seg)}};IntervalIndexedGeometry.prototype.query=function(){if(arguments.length===2){var min4=arguments[0],max3=arguments[1],visitor=new ArrayListVisitor;return this._index.query(min4,max3,visitor),visitor.getItems()}else if(arguments.length===3){var min$1=arguments[0],max$1=arguments[1],visitor$1=arguments[2];this._index.query(min$1,max$1,visitor$1)}};IntervalIndexedGeometry.prototype.interfaces_=function(){return[]};IntervalIndexedGeometry.prototype.getClass=function(){return IntervalIndexedGeometry};var GeometryGraph=function(PlanarGraph$$1){function GeometryGraph2(){if(PlanarGraph$$1.call(this),this._parentGeom=null,this._lineEdgeMap=new HashMap,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new PointLocator,arguments.length===2){var argIndex=arguments[0],parentGeom=arguments[1],boundaryNodeRule=BoundaryNodeRule.OGC_SFS_BOUNDARY_RULE;this._argIndex=argIndex,this._parentGeom=parentGeom,this._boundaryNodeRule=boundaryNodeRule,parentGeom!==null&&this.add(parentGeom)}else if(arguments.length===3){var argIndex$1=arguments[0],parentGeom$1=arguments[1],boundaryNodeRule$1=arguments[2];this._argIndex=argIndex$1,this._parentGeom=parentGeom$1,this._boundaryNodeRule=boundaryNodeRule$1,parentGeom$1!==null&&this.add(parentGeom$1)}}return PlanarGraph$$1&&(GeometryGraph2.__proto__=PlanarGraph$$1),GeometryGraph2.prototype=Object.create(PlanarGraph$$1&&PlanarGraph$$1.prototype),GeometryGraph2.prototype.constructor=GeometryGraph2,GeometryGraph2.prototype.insertBoundaryPoint=function(argIndex,coord){var n=this._nodes.addNode(coord),lbl=n.getLabel(),boundaryCount=1,loc=Location.NONE;loc=lbl.getLocation(argIndex,Position.ON),loc===Location.BOUNDARY&&boundaryCount++;var newLoc=GeometryGraph2.determineBoundary(this._boundaryNodeRule,boundaryCount);lbl.setLocation(argIndex,newLoc)},GeometryGraph2.prototype.computeSelfNodes=function(){if(arguments.length===2){var li=arguments[0],computeRingSelfNodes=arguments[1];return this.computeSelfNodes(li,computeRingSelfNodes,!1)}else if(arguments.length===3){var li$1=arguments[0],computeRingSelfNodes$1=arguments[1],isDoneIfProperInt=arguments[2],si=new SegmentIntersector$2(li$1,!0,!1);si.setIsDoneIfProperInt(isDoneIfProperInt);var esi=this.createEdgeSetIntersector(),isRings=this._parentGeom instanceof LinearRing||this._parentGeom instanceof Polygon||this._parentGeom instanceof MultiPolygon,computeAllSegments=computeRingSelfNodes$1||!isRings;return esi.computeIntersections(this._edges,si,computeAllSegments),this.addSelfIntersectionNodes(this._argIndex),si}},GeometryGraph2.prototype.computeSplitEdges=function(edgelist){for(var i=this._edges.iterator();i.hasNext();){var e=i.next();e.eiList.addSplitEdges(edgelist)}},GeometryGraph2.prototype.computeEdgeIntersections=function(g,li,includeProper){var si=new SegmentIntersector$2(li,includeProper,!0);si.setBoundaryNodes(this.getBoundaryNodes(),g.getBoundaryNodes());var esi=this.createEdgeSetIntersector();return esi.computeIntersections(this._edges,g._edges,si),si},GeometryGraph2.prototype.getGeometry=function(){return this._parentGeom},GeometryGraph2.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},GeometryGraph2.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},GeometryGraph2.prototype.addPoint=function(){if(arguments[0]instanceof Point){var p=arguments[0],coord=p.getCoordinate();this.insertPoint(this._argIndex,coord,Location.INTERIOR)}else if(arguments[0]instanceof Coordinate){var pt=arguments[0];this.insertPoint(this._argIndex,pt,Location.INTERIOR)}},GeometryGraph2.prototype.addPolygon=function(p){var this$1=this;this.addPolygonRing(p.getExteriorRing(),Location.EXTERIOR,Location.INTERIOR);for(var i=0;i<p.getNumInteriorRing();i++){var hole=p.getInteriorRingN(i);this$1.addPolygonRing(hole,Location.INTERIOR,Location.EXTERIOR)}},GeometryGraph2.prototype.addEdge=function(e){this.insertEdge(e);var coord=e.getCoordinates();this.insertPoint(this._argIndex,coord[0],Location.BOUNDARY),this.insertPoint(this._argIndex,coord[coord.length-1],Location.BOUNDARY)},GeometryGraph2.prototype.addLineString=function(line){var coord=CoordinateArrays.removeRepeatedPoints(line.getCoordinates());if(coord.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=coord[0],null;var e=new Edge$1(coord,new Label(this._argIndex,Location.INTERIOR));this._lineEdgeMap.put(line,e),this.insertEdge(e),Assert.isTrue(coord.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,coord[0]),this.insertBoundaryPoint(this._argIndex,coord[coord.length-1])},GeometryGraph2.prototype.getInvalidPoint=function(){return this._invalidPoint},GeometryGraph2.prototype.getBoundaryPoints=function(){for(var coll=this.getBoundaryNodes(),pts=new Array(coll.size()).fill(null),i=0,it=coll.iterator();it.hasNext();){var node=it.next();pts[i++]=node.getCoordinate().copy()}return pts},GeometryGraph2.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},GeometryGraph2.prototype.addSelfIntersectionNode=function(argIndex,coord,loc){if(this.isBoundaryNode(argIndex,coord))return null;loc===Location.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(argIndex,coord):this.insertPoint(argIndex,coord,loc)},GeometryGraph2.prototype.addPolygonRing=function(lr,cwLeft,cwRight){if(lr.isEmpty())return null;var coord=CoordinateArrays.removeRepeatedPoints(lr.getCoordinates());if(coord.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=coord[0],null;var left=cwLeft,right=cwRight;CGAlgorithms.isCCW(coord)&&(left=cwRight,right=cwLeft);var e=new Edge$1(coord,new Label(this._argIndex,Location.BOUNDARY,left,right));this._lineEdgeMap.put(lr,e),this.insertEdge(e),this.insertPoint(this._argIndex,coord[0],Location.BOUNDARY)},GeometryGraph2.prototype.insertPoint=function(argIndex,coord,onLocation){var n=this._nodes.addNode(coord),lbl=n.getLabel();lbl===null?n._label=new Label(argIndex,onLocation):lbl.setLocation(argIndex,onLocation)},GeometryGraph2.prototype.createEdgeSetIntersector=function(){return new SimpleMCSweepLineIntersector},GeometryGraph2.prototype.addSelfIntersectionNodes=function(argIndex){for(var this$1=this,i=this._edges.iterator();i.hasNext();)for(var e=i.next(),eLoc=e.getLabel().getLocation(argIndex),eiIt=e.eiList.iterator();eiIt.hasNext();){var ei=eiIt.next();this$1.addSelfIntersectionNode(argIndex,ei.coord,eLoc)}},GeometryGraph2.prototype.add=function(){if(arguments.length===1){var g=arguments[0];if(g.isEmpty())return null;if(g instanceof MultiPolygon&&(this._useBoundaryDeterminationRule=!1),g instanceof Polygon)this.addPolygon(g);else if(g instanceof LineString$1)this.addLineString(g);else if(g instanceof Point)this.addPoint(g);else if(g instanceof MultiPoint)this.addCollection(g);else if(g instanceof MultiLineString)this.addCollection(g);else if(g instanceof MultiPolygon)this.addCollection(g);else if(g instanceof GeometryCollection)this.addCollection(g);else throw new Error(g.getClass().getName())}else return PlanarGraph$$1.prototype.add.apply(this,arguments)},GeometryGraph2.prototype.addCollection=function(gc){for(var this$1=this,i=0;i<gc.getNumGeometries();i++){var g=gc.getGeometryN(i);this$1.add(g)}},GeometryGraph2.prototype.locate=function(pt){return hasInterface(this._parentGeom,Polygonal)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new IndexedPointInAreaLocator(this._parentGeom)),this._areaPtLocator.locate(pt)):this._ptLocator.locate(pt,this._parentGeom)},GeometryGraph2.prototype.findEdge=function(){if(arguments.length===1){var line=arguments[0];return this._lineEdgeMap.get(line)}else return PlanarGraph$$1.prototype.findEdge.apply(this,arguments)},GeometryGraph2.prototype.interfaces_=function(){return[]},GeometryGraph2.prototype.getClass=function(){return GeometryGraph2},GeometryGraph2.determineBoundary=function(boundaryNodeRule,boundaryCount){return boundaryNodeRule.isInBoundary(boundaryCount)?Location.BOUNDARY:Location.INTERIOR},GeometryGraph2}(PlanarGraph),GeometryGraphOp=function(){if(this._li=new RobustLineIntersector,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var g0=arguments[0];this.setComputationPrecision(g0.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new GeometryGraph(0,g0)}else if(arguments.length===2){var g0$1=arguments[0],g1=arguments[1],boundaryNodeRule=BoundaryNodeRule.OGC_SFS_BOUNDARY_RULE;g0$1.getPrecisionModel().compareTo(g1.getPrecisionModel())>=0?this.setComputationPrecision(g0$1.getPrecisionModel()):this.setComputationPrecision(g1.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new GeometryGraph(0,g0$1,boundaryNodeRule),this._arg[1]=new GeometryGraph(1,g1,boundaryNodeRule)}else if(arguments.length===3){var g0$2=arguments[0],g1$1=arguments[1],boundaryNodeRule$1=arguments[2];g0$2.getPrecisionModel().compareTo(g1$1.getPrecisionModel())>=0?this.setComputationPrecision(g0$2.getPrecisionModel()):this.setComputationPrecision(g1$1.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new GeometryGraph(0,g0$2,boundaryNodeRule$1),this._arg[1]=new GeometryGraph(1,g1$1,boundaryNodeRule$1)}};GeometryGraphOp.prototype.getArgGeometry=function(i){return this._arg[i].getGeometry()};GeometryGraphOp.prototype.setComputationPrecision=function(pm){this._resultPrecisionModel=pm,this._li.setPrecisionModel(this._resultPrecisionModel)};GeometryGraphOp.prototype.interfaces_=function(){return[]};GeometryGraphOp.prototype.getClass=function(){return GeometryGraphOp};var GeometryMapper=function(){};GeometryMapper.prototype.interfaces_=function(){return[]};GeometryMapper.prototype.getClass=function(){return GeometryMapper};GeometryMapper.map=function(){if(arguments[0]instanceof Geometry&&hasInterface(arguments[1],GeometryMapper.MapOp)){for(var geom=arguments[0],op=arguments[1],mapped=new ArrayList,i=0;i<geom.getNumGeometries();i++){var g=op.map(geom.getGeometryN(i));g!==null&&mapped.add(g)}return geom.getFactory().buildGeometry(mapped)}else if(hasInterface(arguments[0],Collection)&&hasInterface(arguments[1],GeometryMapper.MapOp)){for(var geoms=arguments[0],op$1=arguments[1],mapped$1=new ArrayList,i$1=geoms.iterator();i$1.hasNext();){var g$1=i$1.next(),gr=op$1.map(g$1);gr!==null&&mapped$1.add(gr)}return mapped$1}};GeometryMapper.MapOp=function(){};var OverlayOp=function(GeometryGraphOp3){function OverlayOp2(){var g0=arguments[0],g1=arguments[1];GeometryGraphOp3.call(this,g0,g1),this._ptLocator=new PointLocator,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new EdgeList,this._resultPolyList=new ArrayList,this._resultLineList=new ArrayList,this._resultPointList=new ArrayList,this._graph=new PlanarGraph(new OverlayNodeFactory),this._geomFact=g0.getFactory()}return GeometryGraphOp3&&(OverlayOp2.__proto__=GeometryGraphOp3),OverlayOp2.prototype=Object.create(GeometryGraphOp3&&GeometryGraphOp3.prototype),OverlayOp2.prototype.constructor=OverlayOp2,OverlayOp2.prototype.insertUniqueEdge=function(e){var existingEdge=this._edgeList.findEqualEdge(e);if(existingEdge!==null){var existingLabel=existingEdge.getLabel(),labelToMerge=e.getLabel();existingEdge.isPointwiseEqual(e)||(labelToMerge=new Label(e.getLabel()),labelToMerge.flip());var depth2=existingEdge.getDepth();depth2.isNull()&&depth2.add(existingLabel),depth2.add(labelToMerge),existingLabel.merge(labelToMerge)}else this._edgeList.add(e)},OverlayOp2.prototype.getGraph=function(){return this._graph},OverlayOp2.prototype.cancelDuplicateResultEdges=function(){for(var it=this._graph.getEdgeEnds().iterator();it.hasNext();){var de=it.next(),sym=de.getSym();de.isInResult()&&sym.isInResult()&&(de.setInResult(!1),sym.setInResult(!1))}},OverlayOp2.prototype.isCoveredByLA=function(coord){return!!(this.isCovered(coord,this._resultLineList)||this.isCovered(coord,this._resultPolyList))},OverlayOp2.prototype.computeGeometry=function(resultPointList,resultLineList,resultPolyList,opcode){var geomList=new ArrayList;return geomList.addAll(resultPointList),geomList.addAll(resultLineList),geomList.addAll(resultPolyList),geomList.isEmpty()?OverlayOp2.createEmptyResult(opcode,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(geomList)},OverlayOp2.prototype.mergeSymLabels=function(){for(var nodeit=this._graph.getNodes().iterator();nodeit.hasNext();){var node=nodeit.next();node.getEdges().mergeSymLabels()}},OverlayOp2.prototype.isCovered=function(coord,geomList){for(var this$1=this,it=geomList.iterator();it.hasNext();){var geom=it.next(),loc=this$1._ptLocator.locate(coord,geom);if(loc!==Location.EXTERIOR)return!0}return!1},OverlayOp2.prototype.replaceCollapsedEdges=function(){for(var newEdges=new ArrayList,it=this._edgeList.iterator();it.hasNext();){var e=it.next();e.isCollapsed()&&(it.remove(),newEdges.add(e.getCollapsedEdge()))}this._edgeList.addAll(newEdges)},OverlayOp2.prototype.updateNodeLabelling=function(){for(var nodeit=this._graph.getNodes().iterator();nodeit.hasNext();){var node=nodeit.next(),lbl=node.getEdges().getLabel();node.getLabel().merge(lbl)}},OverlayOp2.prototype.getResultGeometry=function(overlayOpCode){return this.computeOverlay(overlayOpCode),this._resultGeom},OverlayOp2.prototype.insertUniqueEdges=function(edges2){for(var this$1=this,i=edges2.iterator();i.hasNext();){var e=i.next();this$1.insertUniqueEdge(e)}},OverlayOp2.prototype.computeOverlay=function(opCode){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var baseSplitEdges=new ArrayList;this._arg[0].computeSplitEdges(baseSplitEdges),this._arg[1].computeSplitEdges(baseSplitEdges),this.insertUniqueEdges(baseSplitEdges),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),EdgeNodingValidator.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(opCode),this.cancelDuplicateResultEdges();var polyBuilder=new PolygonBuilder(this._geomFact);polyBuilder.add(this._graph),this._resultPolyList=polyBuilder.getPolygons();var lineBuilder=new LineBuilder(this,this._geomFact,this._ptLocator);this._resultLineList=lineBuilder.build(opCode);var pointBuilder=new PointBuilder(this,this._geomFact,this._ptLocator);this._resultPointList=pointBuilder.build(opCode),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,opCode)},OverlayOp2.prototype.labelIncompleteNode=function(n,targetIndex){var loc=this._ptLocator.locate(n.getCoordinate(),this._arg[targetIndex].getGeometry());n.getLabel().setLocation(targetIndex,loc)},OverlayOp2.prototype.copyPoints=function(argIndex){for(var this$1=this,i=this._arg[argIndex].getNodeIterator();i.hasNext();){var graphNode=i.next(),newNode=this$1._graph.addNode(graphNode.getCoordinate());newNode.setLabel(argIndex,graphNode.getLabel().getLocation(argIndex))}},OverlayOp2.prototype.findResultAreaEdges=function(opCode){for(var it=this._graph.getEdgeEnds().iterator();it.hasNext();){var de=it.next(),label=de.getLabel();label.isArea()&&!de.isInteriorAreaEdge()&&OverlayOp2.isResultOfOp(label.getLocation(0,Position.RIGHT),label.getLocation(1,Position.RIGHT),opCode)&&de.setInResult(!0)}},OverlayOp2.prototype.computeLabelsFromDepths=function(){for(var it=this._edgeList.iterator();it.hasNext();){var e=it.next(),lbl=e.getLabel(),depth2=e.getDepth();if(!depth2.isNull()){depth2.normalize();for(var i=0;i<2;i++)!lbl.isNull(i)&&lbl.isArea()&&!depth2.isNull(i)&&(depth2.getDelta(i)===0?lbl.toLine(i):(Assert.isTrue(!depth2.isNull(i,Position.LEFT),"depth of LEFT side has not been initialized"),lbl.setLocation(i,Position.LEFT,depth2.getLocation(i,Position.LEFT)),Assert.isTrue(!depth2.isNull(i,Position.RIGHT),"depth of RIGHT side has not been initialized"),lbl.setLocation(i,Position.RIGHT,depth2.getLocation(i,Position.RIGHT))))}}},OverlayOp2.prototype.computeLabelling=function(){for(var this$1=this,nodeit=this._graph.getNodes().iterator();nodeit.hasNext();){var node=nodeit.next();node.getEdges().computeLabelling(this$1._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},OverlayOp2.prototype.labelIncompleteNodes=function(){for(var this$1=this,ni=this._graph.getNodes().iterator();ni.hasNext();){var n=ni.next(),label=n.getLabel();n.isIsolated()&&(label.isNull(0)?this$1.labelIncompleteNode(n,0):this$1.labelIncompleteNode(n,1)),n.getEdges().updateLabelling(label)}},OverlayOp2.prototype.isCoveredByA=function(coord){return!!this.isCovered(coord,this._resultPolyList)},OverlayOp2.prototype.interfaces_=function(){return[]},OverlayOp2.prototype.getClass=function(){return OverlayOp2},OverlayOp2}(GeometryGraphOp);OverlayOp.overlayOp=function(geom0,geom1,opCode){var gov=new OverlayOp(geom0,geom1),geomOv=gov.getResultGeometry(opCode);return geomOv};OverlayOp.intersection=function(g,other){if(g.isEmpty()||other.isEmpty())return OverlayOp.createEmptyResult(OverlayOp.INTERSECTION,g,other,g.getFactory());if(g.isGeometryCollection()){var g2=other;return GeometryCollectionMapper.map(g,{interfaces_:function(){return[GeometryMapper.MapOp]},map:function(g3){return g3.intersection(g2)}})}return g.checkNotGeometryCollection(g),g.checkNotGeometryCollection(other),SnapIfNeededOverlayOp.overlayOp(g,other,OverlayOp.INTERSECTION)};OverlayOp.symDifference=function(g,other){if(g.isEmpty()||other.isEmpty()){if(g.isEmpty()&&other.isEmpty())return OverlayOp.createEmptyResult(OverlayOp.SYMDIFFERENCE,g,other,g.getFactory());if(g.isEmpty())return other.copy();if(other.isEmpty())return g.copy()}return g.checkNotGeometryCollection(g),g.checkNotGeometryCollection(other),SnapIfNeededOverlayOp.overlayOp(g,other,OverlayOp.SYMDIFFERENCE)};OverlayOp.resultDimension=function(opCode,g0,g1){var dim0=g0.getDimension(),dim1=g1.getDimension(),resultDimension=-1;switch(opCode){case OverlayOp.INTERSECTION:resultDimension=Math.min(dim0,dim1);break;case OverlayOp.UNION:resultDimension=Math.max(dim0,dim1);break;case OverlayOp.DIFFERENCE:resultDimension=dim0;break;case OverlayOp.SYMDIFFERENCE:resultDimension=Math.max(dim0,dim1);break;default:}return resultDimension};OverlayOp.createEmptyResult=function(overlayOpCode,a,b,geomFact){var result=null;switch(OverlayOp.resultDimension(overlayOpCode,a,b)){case-1:result=geomFact.createGeometryCollection(new Array(0).fill(null));break;case 0:result=geomFact.createPoint();break;case 1:result=geomFact.createLineString();break;case 2:result=geomFact.createPolygon();break;default:}return result};OverlayOp.difference=function(g,other){return g.isEmpty()?OverlayOp.createEmptyResult(OverlayOp.DIFFERENCE,g,other,g.getFactory()):other.isEmpty()?g.copy():(g.checkNotGeometryCollection(g),g.checkNotGeometryCollection(other),SnapIfNeededOverlayOp.overlayOp(g,other,OverlayOp.DIFFERENCE))};OverlayOp.isResultOfOp=function(){if(arguments.length===2){var label=arguments[0],opCode=arguments[1],loc0=label.getLocation(0),loc1=label.getLocation(1);return OverlayOp.isResultOfOp(loc0,loc1,opCode)}else if(arguments.length===3){var loc0$1=arguments[0],loc1$1=arguments[1],overlayOpCode=arguments[2];switch(loc0$1===Location.BOUNDARY&&(loc0$1=Location.INTERIOR),loc1$1===Location.BOUNDARY&&(loc1$1=Location.INTERIOR),overlayOpCode){case OverlayOp.INTERSECTION:return loc0$1===Location.INTERIOR&&loc1$1===Location.INTERIOR;case OverlayOp.UNION:return loc0$1===Location.INTERIOR||loc1$1===Location.INTERIOR;case OverlayOp.DIFFERENCE:return loc0$1===Location.INTERIOR&&loc1$1!==Location.INTERIOR;case OverlayOp.SYMDIFFERENCE:return loc0$1===Location.INTERIOR&&loc1$1!==Location.INTERIOR||loc0$1!==Location.INTERIOR&&loc1$1===Location.INTERIOR;default:}return!1}};OverlayOp.INTERSECTION=1;OverlayOp.UNION=2;OverlayOp.DIFFERENCE=3;OverlayOp.SYMDIFFERENCE=4;var FuzzyPointLocator=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new PointLocator,this._seg=new LineSegment;var g=arguments[0],boundaryDistanceTolerance=arguments[1];this._g=g,this._boundaryDistanceTolerance=boundaryDistanceTolerance,this._linework=this.extractLinework(g)};FuzzyPointLocator.prototype.isWithinToleranceOfBoundary=function(pt){for(var this$1=this,i=0;i<this._linework.getNumGeometries();i++)for(var line=this$1._linework.getGeometryN(i),seq=line.getCoordinateSequence(),j=0;j<seq.size()-1;j++){seq.getCoordinate(j,this$1._seg.p0),seq.getCoordinate(j+1,this$1._seg.p1);var dist2=this$1._seg.distance(pt);if(dist2<=this$1._boundaryDistanceTolerance)return!0}return!1};FuzzyPointLocator.prototype.getLocation=function(pt){return this.isWithinToleranceOfBoundary(pt)?Location.BOUNDARY:this._ptLocator.locate(pt,this._g)};FuzzyPointLocator.prototype.extractLinework=function(g){var extracter=new PolygonalLineworkExtracter;g.apply(extracter);var linework=extracter.getLinework(),lines=GeometryFactory.toLineStringArray(linework);return g.getFactory().createMultiLineString(lines)};FuzzyPointLocator.prototype.interfaces_=function(){return[]};FuzzyPointLocator.prototype.getClass=function(){return FuzzyPointLocator};var PolygonalLineworkExtracter=function(){this._linework=null,this._linework=new ArrayList};PolygonalLineworkExtracter.prototype.getLinework=function(){return this._linework};PolygonalLineworkExtracter.prototype.filter=function(g){var this$1=this;if(g instanceof Polygon){var poly=g;this._linework.add(poly.getExteriorRing());for(var i=0;i<poly.getNumInteriorRing();i++)this$1._linework.add(poly.getInteriorRingN(i))}};PolygonalLineworkExtracter.prototype.interfaces_=function(){return[GeometryFilter]};PolygonalLineworkExtracter.prototype.getClass=function(){return PolygonalLineworkExtracter};var OffsetPointGenerator=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var g=arguments[0];this._g=g};OffsetPointGenerator.prototype.extractPoints=function(line,offsetDistance,offsetPts){for(var this$1=this,pts=line.getCoordinates(),i=0;i<pts.length-1;i++)this$1.computeOffsetPoints(pts[i],pts[i+1],offsetDistance,offsetPts)};OffsetPointGenerator.prototype.setSidesToGenerate=function(doLeft,doRight){this._doLeft=doLeft,this._doRight=doRight};OffsetPointGenerator.prototype.getPoints=function(offsetDistance){for(var this$1=this,offsetPts=new ArrayList,lines=LinearComponentExtracter.getLines(this._g),i=lines.iterator();i.hasNext();){var line=i.next();this$1.extractPoints(line,offsetDistance,offsetPts)}return offsetPts};OffsetPointGenerator.prototype.computeOffsetPoints=function(p0,p1,offsetDistance,offsetPts){var dx=p1.x-p0.x,dy=p1.y-p0.y,len=Math.sqrt(dx*dx+dy*dy),ux=offsetDistance*dx/len,uy=offsetDistance*dy/len,midX=(p1.x+p0.x)/2,midY=(p1.y+p0.y)/2;if(this._doLeft){var offsetLeft=new Coordinate(midX-uy,midY+ux);offsetPts.add(offsetLeft)}if(this._doRight){var offsetRight=new Coordinate(midX+uy,midY-ux);offsetPts.add(offsetRight)}};OffsetPointGenerator.prototype.interfaces_=function(){return[]};OffsetPointGenerator.prototype.getClass=function(){return OffsetPointGenerator};var OverlayResultValidator=function OverlayResultValidator2(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=OverlayResultValidator2.TOLERANCE,this._testCoords=new ArrayList;var a=arguments[0],b=arguments[1],result=arguments[2];this._boundaryDistanceTolerance=OverlayResultValidator2.computeBoundaryDistanceTolerance(a,b),this._geom=[a,b,result],this._locFinder=[new FuzzyPointLocator(this._geom[0],this._boundaryDistanceTolerance),new FuzzyPointLocator(this._geom[1],this._boundaryDistanceTolerance),new FuzzyPointLocator(this._geom[2],this._boundaryDistanceTolerance)]},staticAccessors$46={TOLERANCE:{configurable:!0}};OverlayResultValidator.prototype.reportResult=function(overlayOp3,location2,expectedInterior){System.out.println("Overlay result invalid - A:"+Location.toLocationSymbol(location2[0])+" B:"+Location.toLocationSymbol(location2[1])+" expected:"+(expectedInterior?"i":"e")+" actual:"+Location.toLocationSymbol(location2[2]))};OverlayResultValidator.prototype.isValid=function(overlayOp3){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var isValid8=this.checkValid(overlayOp3);return isValid8};OverlayResultValidator.prototype.checkValid=function(){var this$1=this;if(arguments.length===1){for(var overlayOp3=arguments[0],i=0;i<this._testCoords.size();i++){var pt=this$1._testCoords.get(i);if(!this$1.checkValid(overlayOp3,pt))return this$1._invalidLocation=pt,!1}return!0}else if(arguments.length===2){var overlayOp$1=arguments[0],pt$1=arguments[1];return this._location[0]=this._locFinder[0].getLocation(pt$1),this._location[1]=this._locFinder[1].getLocation(pt$1),this._location[2]=this._locFinder[2].getLocation(pt$1),OverlayResultValidator.hasLocation(this._location,Location.BOUNDARY)?!0:this.isValidResult(overlayOp$1,this._location)}};OverlayResultValidator.prototype.addTestPts=function(g){var ptGen=new OffsetPointGenerator(g);this._testCoords.addAll(ptGen.getPoints(5*this._boundaryDistanceTolerance))};OverlayResultValidator.prototype.isValidResult=function(overlayOp3,location2){var expectedInterior=OverlayOp.isResultOfOp(location2[0],location2[1],overlayOp3),resultInInterior=location2[2]===Location.INTERIOR,isValid8=!(expectedInterior^resultInInterior);return isValid8||this.reportResult(overlayOp3,location2,expectedInterior),isValid8};OverlayResultValidator.prototype.getInvalidLocation=function(){return this._invalidLocation};OverlayResultValidator.prototype.interfaces_=function(){return[]};OverlayResultValidator.prototype.getClass=function(){return OverlayResultValidator};OverlayResultValidator.hasLocation=function(location2,loc){for(var i=0;i<3;i++)if(location2[i]===loc)return!0;return!1};OverlayResultValidator.computeBoundaryDistanceTolerance=function(g0,g1){return Math.min(GeometrySnapper.computeSizeBasedSnapTolerance(g0),GeometrySnapper.computeSizeBasedSnapTolerance(g1))};OverlayResultValidator.isValid=function(a,b,overlayOp3,result){var validator=new OverlayResultValidator(a,b,result);return validator.isValid(overlayOp3)};staticAccessors$46.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(OverlayResultValidator,staticAccessors$46);var GeometryCombiner=function GeometryCombiner2(geoms){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=GeometryCombiner2.extractFactory(geoms),this._inputGeoms=geoms};GeometryCombiner.prototype.extractElements=function(geom,elems){var this$1=this;if(geom===null)return null;for(var i=0;i<geom.getNumGeometries();i++){var elemGeom=geom.getGeometryN(i);this$1._skipEmpty&&elemGeom.isEmpty()||elems.add(elemGeom)}};GeometryCombiner.prototype.combine=function(){for(var this$1=this,elems=new ArrayList,i=this._inputGeoms.iterator();i.hasNext();){var g=i.next();this$1.extractElements(g,elems)}return elems.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(elems)};GeometryCombiner.prototype.interfaces_=function(){return[]};GeometryCombiner.prototype.getClass=function(){return GeometryCombiner};GeometryCombiner.combine=function(){if(arguments.length===1){var geoms=arguments[0],combiner=new GeometryCombiner(geoms);return combiner.combine()}else if(arguments.length===2){var g0=arguments[0],g1=arguments[1],combiner$1=new GeometryCombiner(GeometryCombiner.createList(g0,g1));return combiner$1.combine()}else if(arguments.length===3){var g0$1=arguments[0],g1$1=arguments[1],g2=arguments[2],combiner$2=new GeometryCombiner(GeometryCombiner.createList(g0$1,g1$1,g2));return combiner$2.combine()}};GeometryCombiner.extractFactory=function(geoms){return geoms.isEmpty()?null:geoms.iterator().next().getFactory()};GeometryCombiner.createList=function(){if(arguments.length===2){var obj0=arguments[0],obj1=arguments[1],list=new ArrayList;return list.add(obj0),list.add(obj1),list}else if(arguments.length===3){var obj0$1=arguments[0],obj1$1=arguments[1],obj2=arguments[2],list$1=new ArrayList;return list$1.add(obj0$1),list$1.add(obj1$1),list$1.add(obj2),list$1}};var CascadedPolygonUnion=function(){this._inputPolys=null,this._geomFactory=null;var polys=arguments[0];this._inputPolys=polys,this._inputPolys===null&&(this._inputPolys=new ArrayList)},staticAccessors$47={STRTREE_NODE_CAPACITY:{configurable:!0}};CascadedPolygonUnion.prototype.reduceToGeometries=function(geomTree){for(var this$1=this,geoms=new ArrayList,i=geomTree.iterator();i.hasNext();){var o=i.next(),geom=null;hasInterface(o,List)?geom=this$1.unionTree(o):o instanceof Geometry&&(geom=o),geoms.add(geom)}return geoms};CascadedPolygonUnion.prototype.extractByEnvelope=function(env,geom,disjointGeoms){for(var intersectingGeoms=new ArrayList,i=0;i<geom.getNumGeometries();i++){var elem=geom.getGeometryN(i);elem.getEnvelopeInternal().intersects(env)?intersectingGeoms.add(elem):disjointGeoms.add(elem)}return this._geomFactory.buildGeometry(intersectingGeoms)};CascadedPolygonUnion.prototype.unionOptimized=function(g0,g1){var g0Env=g0.getEnvelopeInternal(),g1Env=g1.getEnvelopeInternal();if(!g0Env.intersects(g1Env)){var combo=GeometryCombiner.combine(g0,g1);return combo}if(g0.getNumGeometries()<=1&&g1.getNumGeometries()<=1)return this.unionActual(g0,g1);var commonEnv=g0Env.intersection(g1Env);return this.unionUsingEnvelopeIntersection(g0,g1,commonEnv)};CascadedPolygonUnion.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var index=new STRtree(CascadedPolygonUnion.STRTREE_NODE_CAPACITY),i=this._inputPolys.iterator();i.hasNext();){var item=i.next();index.insert(item.getEnvelopeInternal(),item)}this._inputPolys=null;var itemTree=index.itemsTree(),unionAll=this.unionTree(itemTree);return unionAll};CascadedPolygonUnion.prototype.binaryUnion=function(){if(arguments.length===1){var geoms=arguments[0];return this.binaryUnion(geoms,0,geoms.size())}else if(arguments.length===3){var geoms$1=arguments[0],start2=arguments[1],end=arguments[2];if(end-start2<=1){var g0=CascadedPolygonUnion.getGeometry(geoms$1,start2);return this.unionSafe(g0,null)}else{if(end-start2===2)return this.unionSafe(CascadedPolygonUnion.getGeometry(geoms$1,start2),CascadedPolygonUnion.getGeometry(geoms$1,start2+1));var mid=Math.trunc((end+start2)/2),g0$1=this.binaryUnion(geoms$1,start2,mid),g1=this.binaryUnion(geoms$1,mid,end);return this.unionSafe(g0$1,g1)}}};CascadedPolygonUnion.prototype.repeatedUnion=function(geoms){for(var union7=null,i=geoms.iterator();i.hasNext();){var g=i.next();union7===null?union7=g.copy():union7=union7.union(g)}return union7};CascadedPolygonUnion.prototype.unionSafe=function(g0,g1){return g0===null&&g1===null?null:g0===null?g1.copy():g1===null?g0.copy():this.unionOptimized(g0,g1)};CascadedPolygonUnion.prototype.unionActual=function(g0,g1){return CascadedPolygonUnion.restrictToPolygons(g0.union(g1))};CascadedPolygonUnion.prototype.unionTree=function(geomTree){var geoms=this.reduceToGeometries(geomTree),union7=this.binaryUnion(geoms);return union7};CascadedPolygonUnion.prototype.unionUsingEnvelopeIntersection=function(g0,g1,common){var disjointPolys=new ArrayList,g0Int=this.extractByEnvelope(common,g0,disjointPolys),g1Int=this.extractByEnvelope(common,g1,disjointPolys),union7=this.unionActual(g0Int,g1Int);disjointPolys.add(union7);var overallUnion=GeometryCombiner.combine(disjointPolys);return overallUnion};CascadedPolygonUnion.prototype.bufferUnion=function(){if(arguments.length===1){var geoms=arguments[0],factory=geoms.get(0).getFactory(),gColl=factory.buildGeometry(geoms),unionAll=gColl.buffer(0);return unionAll}else if(arguments.length===2){var g0=arguments[0],g1=arguments[1],factory$1=g0.getFactory(),gColl$1=factory$1.createGeometryCollection([g0,g1]),unionAll$1=gColl$1.buffer(0);return unionAll$1}};CascadedPolygonUnion.prototype.interfaces_=function(){return[]};CascadedPolygonUnion.prototype.getClass=function(){return CascadedPolygonUnion};CascadedPolygonUnion.restrictToPolygons=function(g){if(hasInterface(g,Polygonal))return g;var polygons2=PolygonExtracter.getPolygons(g);return polygons2.size()===1?polygons2.get(0):g.getFactory().createMultiPolygon(GeometryFactory.toPolygonArray(polygons2))};CascadedPolygonUnion.getGeometry=function(list,index){return index>=list.size()?null:list.get(index)};CascadedPolygonUnion.union=function(polys){var op=new CascadedPolygonUnion(polys);return op.union()};staticAccessors$47.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(CascadedPolygonUnion,staticAccessors$47);var UnionOp=function(){};UnionOp.prototype.interfaces_=function(){return[]};UnionOp.prototype.getClass=function(){return UnionOp};UnionOp.union=function(g,other){if(g.isEmpty()||other.isEmpty()){if(g.isEmpty()&&other.isEmpty())return OverlayOp.createEmptyResult(OverlayOp.UNION,g,other,g.getFactory());if(g.isEmpty())return other.copy();if(other.isEmpty())return g.copy()}return g.checkNotGeometryCollection(g),g.checkNotGeometryCollection(other),SnapIfNeededOverlayOp.overlayOp(g,other,OverlayOp.UNION)};function difference3(polygon1,polygon22){var geom1=getGeom(polygon1),geom2=getGeom(polygon22),properties=polygon1.properties||{};if(geom1=removeEmptyPolygon(geom1),geom2=removeEmptyPolygon(geom2),!geom1)return null;if(!geom2)return feature(geom1,properties);var reader=new GeoJSONReader,a=reader.read(geom1),b=reader.read(geom2),differenced=OverlayOp.difference(a,b);if(differenced.isEmpty())return null;var writer=new GeoJSONWriter,geom=writer.write(differenced);return feature(geom,properties)}function removeEmptyPolygon(geom){switch(geom.type){case"Polygon":return area$1(geom)>1?geom:null;case"MultiPolygon":var coordinates=[];if(flattenEach(geom,function(feature$$1){area$1(feature$$1)>1&&coordinates.push(feature$$1.geometry.coordinates)}),coordinates.length)return{type:"MultiPolygon",coordinates}}}var adder=function(){return new Adder};function Adder(){this.reset()}Adder.prototype={constructor:Adder,reset:function(){this.s=this.t=0},add:function(y2){add$1(temp,y2,this.t),add$1(this,temp.s,this.s),this.s?this.t+=temp.t:this.s=temp.t},valueOf:function(){return this.s}};var temp=new Adder;function add$1(adder2,a,b){var x2=adder2.s=a+b,bv=x2-a,av=x2-bv;adder2.t=a-av+(b-bv)}var epsilon$1=1e-6,pi=Math.PI,halfPi=pi/2,quarterPi=pi/4,tau=pi*2,degrees=180/pi,radians=pi/180,abs2=Math.abs,atan=Math.atan,atan2=Math.atan2,cos=Math.cos,exp=Math.exp,log=Math.log,sin=Math.sin,sqrt3=Math.sqrt,tan=Math.tan;function acos(x2){return x2>1?0:x2<-1?pi:Math.acos(x2)}function asin(x2){return x2>1?halfPi:x2<-1?-halfPi:Math.asin(x2)}function noop2(){}function streamGeometry(geometry2,stream){geometry2&&streamGeometryType.hasOwnProperty(geometry2.type)&&streamGeometryType[geometry2.type](geometry2,stream)}var streamObjectType={Feature:function(object2,stream){streamGeometry(object2.geometry,stream)},FeatureCollection:function(object2,stream){for(var features=object2.features,i=-1,n=features.length;++i<n;)streamGeometry(features[i].geometry,stream)}},streamGeometryType={Sphere:function(object2,stream){stream.sphere()},Point:function(object2,stream){object2=object2.coordinates,stream.point(object2[0],object2[1],object2[2])},MultiPoint:function(object2,stream){for(var coordinates=object2.coordinates,i=-1,n=coordinates.length;++i<n;)object2=coordinates[i],stream.point(object2[0],object2[1],object2[2])},LineString:function(object2,stream){streamLine(object2.coordinates,stream,0)},MultiLineString:function(object2,stream){for(var coordinates=object2.coordinates,i=-1,n=coordinates.length;++i<n;)streamLine(coordinates[i],stream,0)},Polygon:function(object2,stream){streamPolygon(object2.coordinates,stream)},MultiPolygon:function(object2,stream){for(var coordinates=object2.coordinates,i=-1,n=coordinates.length;++i<n;)streamPolygon(coordinates[i],stream)},GeometryCollection:function(object2,stream){for(var geometries=object2.geometries,i=-1,n=geometries.length;++i<n;)streamGeometry(geometries[i],stream)}};function streamLine(coordinates,stream,closed){var i=-1,n=coordinates.length-closed,coordinate2;for(stream.lineStart();++i<n;)coordinate2=coordinates[i],stream.point(coordinate2[0],coordinate2[1],coordinate2[2]);stream.lineEnd()}function streamPolygon(coordinates,stream){var i=-1,n=coordinates.length;for(stream.polygonStart();++i<n;)streamLine(coordinates[i],stream,1);stream.polygonEnd()}var geoStream=function(object2,stream){object2&&streamObjectType.hasOwnProperty(object2.type)?streamObjectType[object2.type](object2,stream):streamGeometry(object2,stream)},areaRingSum=adder(),areaSum=adder();function spherical(cartesian2){return[atan2(cartesian2[1],cartesian2[0]),asin(cartesian2[2])]}function cartesian(spherical2){var lambda=spherical2[0],phi=spherical2[1],cosPhi=cos(phi);return[cosPhi*cos(lambda),cosPhi*sin(lambda),sin(phi)]}function cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function cartesianAddInPlace(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function cartesianNormalizeInPlace(d){var l=sqrt3(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l,d[1]/=l,d[2]/=l}var deltaSum=adder(),compose=function(a,b){function compose2(x2,y2){return x2=a(x2,y2),b(x2[0],x2[1])}return a.invert&&b.invert&&(compose2.invert=function(x2,y2){return x2=b.invert(x2,y2),x2&&a.invert(x2[0],x2[1])}),compose2};function rotationIdentity(lambda,phi){return[lambda>pi?lambda-tau:lambda<-pi?lambda+tau:lambda,phi]}rotationIdentity.invert=rotationIdentity;function rotateRadians(deltaLambda,deltaPhi,deltaGamma){return(deltaLambda%=tau)?deltaPhi||deltaGamma?compose(rotationLambda(deltaLambda),rotationPhiGamma(deltaPhi,deltaGamma)):rotationLambda(deltaLambda):deltaPhi||deltaGamma?rotationPhiGamma(deltaPhi,deltaGamma):rotationIdentity}function forwardRotationLambda(deltaLambda){return function(lambda,phi){return lambda+=deltaLambda,[lambda>pi?lambda-tau:lambda<-pi?lambda+tau:lambda,phi]}}function rotationLambda(deltaLambda){var rotation2=forwardRotationLambda(deltaLambda);return rotation2.invert=forwardRotationLambda(-deltaLambda),rotation2}function rotationPhiGamma(deltaPhi,deltaGamma){var cosDeltaPhi=cos(deltaPhi),sinDeltaPhi=sin(deltaPhi),cosDeltaGamma=cos(deltaGamma),sinDeltaGamma=sin(deltaGamma);function rotation2(lambda,phi){var cosPhi=cos(phi),x2=cos(lambda)*cosPhi,y2=sin(lambda)*cosPhi,z=sin(phi),k=z*cosDeltaPhi+x2*sinDeltaPhi;return[atan2(y2*cosDeltaGamma-k*sinDeltaGamma,x2*cosDeltaPhi-z*sinDeltaPhi),asin(k*cosDeltaGamma+y2*sinDeltaGamma)]}return rotation2.invert=function(lambda,phi){var cosPhi=cos(phi),x2=cos(lambda)*cosPhi,y2=sin(lambda)*cosPhi,z=sin(phi),k=z*cosDeltaGamma-y2*sinDeltaGamma;return[atan2(y2*cosDeltaGamma+z*sinDeltaGamma,x2*cosDeltaPhi+k*sinDeltaPhi),asin(k*cosDeltaPhi-x2*sinDeltaPhi)]},rotation2}var rotation=function(rotate){rotate=rotateRadians(rotate[0]*radians,rotate[1]*radians,rotate.length>2?rotate[2]*radians:0);function forward(coordinates){return coordinates=rotate(coordinates[0]*radians,coordinates[1]*radians),coordinates[0]*=degrees,coordinates[1]*=degrees,coordinates}return forward.invert=function(coordinates){return coordinates=rotate.invert(coordinates[0]*radians,coordinates[1]*radians),coordinates[0]*=degrees,coordinates[1]*=degrees,coordinates},forward};function circleStream(stream,radius,delta2,direction,t0,t1){if(!!delta2){var cosRadius=cos(radius),sinRadius=sin(radius),step=direction*delta2;t0==null?(t0=radius+direction*tau,t1=radius-step/2):(t0=circleRadius(cosRadius,t0),t1=circleRadius(cosRadius,t1),(direction>0?t0<t1:t0>t1)&&(t0+=direction*tau));for(var point4,t=t0;direction>0?t>t1:t<t1;t-=step)point4=spherical([cosRadius,-sinRadius*cos(t),-sinRadius*sin(t)]),stream.point(point4[0],point4[1])}}function circleRadius(cosRadius,point4){point4=cartesian(point4),point4[0]-=cosRadius,cartesianNormalizeInPlace(point4);var radius=acos(-point4[1]);return((-point4[2]<0?-radius:radius)+tau-epsilon$1)%tau}var clipBuffer=function(){var lines=[],line;return{point:function(x2,y2){line.push([x2,y2])},lineStart:function(){lines.push(line=[])},lineEnd:noop2,rejoin:function(){lines.length>1&&lines.push(lines.pop().concat(lines.shift()))},result:function(){var result=lines;return lines=[],line=null,result}}},clipLine=function(a,b,x0,y0,x12,y12){var ax=a[0],ay=a[1],bx=b[0],by=b[1],t0=0,t1=1,dx=bx-ax,dy=by-ay,r;if(r=x0-ax,!(!dx&&r>0)){if(r/=dx,dx<0){if(r<t0)return;r<t1&&(t1=r)}else if(dx>0){if(r>t1)return;r>t0&&(t0=r)}if(r=x12-ax,!(!dx&&r<0)){if(r/=dx,dx<0){if(r>t1)return;r>t0&&(t0=r)}else if(dx>0){if(r<t0)return;r<t1&&(t1=r)}if(r=y0-ay,!(!dy&&r>0)){if(r/=dy,dy<0){if(r<t0)return;r<t1&&(t1=r)}else if(dy>0){if(r>t1)return;r>t0&&(t0=r)}if(r=y12-ay,!(!dy&&r<0)){if(r/=dy,dy<0){if(r>t1)return;r>t0&&(t0=r)}else if(dy>0){if(r<t0)return;r<t1&&(t1=r)}return t0>0&&(a[0]=ax+t0*dx,a[1]=ay+t0*dy),t1<1&&(b[0]=ax+t1*dx,b[1]=ay+t1*dy),!0}}}}},pointEqual=function(a,b){return abs2(a[0]-b[0])<epsilon$1&&abs2(a[1]-b[1])<epsilon$1};function Intersection(point4,points2,other,entry){this.x=point4,this.z=points2,this.o=other,this.e=entry,this.v=!1,this.n=this.p=null}var clipPolygon$1=function(segments,compareIntersection2,startInside,interpolate,stream){var subject=[],clip2=[],i,n;if(segments.forEach(function(segment){if(!((n2=segment.length-1)<=0)){var n2,p0=segment[0],p1=segment[n2],x2;if(pointEqual(p0,p1)){for(stream.lineStart(),i=0;i<n2;++i)stream.point((p0=segment[i])[0],p0[1]);stream.lineEnd();return}subject.push(x2=new Intersection(p0,segment,null,!0)),clip2.push(x2.o=new Intersection(p0,null,x2,!1)),subject.push(x2=new Intersection(p1,segment,null,!1)),clip2.push(x2.o=new Intersection(p1,null,x2,!0))}}),!!subject.length){for(clip2.sort(compareIntersection2),link(subject),link(clip2),i=0,n=clip2.length;i<n;++i)clip2[i].e=startInside=!startInside;for(var start2=subject[0],points2,point4;;){for(var current=start2,isSubject=!0;current.v;)if((current=current.n)===start2)return;points2=current.z,stream.lineStart();do{if(current.v=current.o.v=!0,current.e){if(isSubject)for(i=0,n=points2.length;i<n;++i)stream.point((point4=points2[i])[0],point4[1]);else interpolate(current.x,current.n.x,1,stream);current=current.n}else{if(isSubject)for(points2=current.p.z,i=points2.length-1;i>=0;--i)stream.point((point4=points2[i])[0],point4[1]);else interpolate(current.x,current.p.x,-1,stream);current=current.p}current=current.o,points2=current.z,isSubject=!isSubject}while(!current.v);stream.lineEnd()}}};function link(array){if(!!(n=array.length)){for(var n,i=0,a=array[0],b;++i<n;)a.n=b=array[i],b.p=a,a=b;a.n=b=array[0],b.p=a}}var ascending=function(a,b){return a<b?-1:a>b?1:a>=b?0:NaN},bisector=function(compare10){return compare10.length===1&&(compare10=ascendingComparator(compare10)),{left:function(a,x2,lo,hi){for(lo==null&&(lo=0),hi==null&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare10(a[mid],x2)<0?lo=mid+1:hi=mid}return lo},right:function(a,x2,lo,hi){for(lo==null&&(lo=0),hi==null&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare10(a[mid],x2)>0?hi=mid:lo=mid+1}return lo}}};function ascendingComparator(f){return function(d,x2){return ascending(f(d),x2)}}var ascendingBisect=bisector(ascending),merge$1=function(arrays){for(var n=arrays.length,m,i=-1,j=0,merged,array;++i<n;)j+=arrays[i].length;for(merged=new Array(j);--n>=0;)for(array=arrays[n],m=array.length;--m>=0;)merged[--j]=array[m];return merged},clipMax=1e9,clipMin=-clipMax;function clipExtent(x0,y0,x12,y12){function visible(x2,y2){return x0<=x2&&x2<=x12&&y0<=y2&&y2<=y12}function interpolate(from,to,direction,stream){var a=0,a1=0;if(from==null||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoint(from,to)<0^direction>0)do stream.point(a===0||a===3?x0:x12,a>1?y12:y0);while((a=(a+direction+4)%4)!==a1);else stream.point(to[0],to[1])}function corner(p,direction){return abs2(p[0]-x0)<epsilon$1?direction>0?0:3:abs2(p[0]-x12)<epsilon$1?direction>0?2:1:abs2(p[1]-y0)<epsilon$1?direction>0?1:0:direction>0?3:2}function compareIntersection2(a,b){return comparePoint(a.x,b.x)}function comparePoint(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:ca===0?b[1]-a[1]:ca===1?a[0]-b[0]:ca===2?a[1]-b[1]:b[0]-a[0]}return function(stream){var activeStream=stream,bufferStream=clipBuffer(),segments,polygon4,ring,x__,y__,v__,x_,y_,v_,first,clean,clipStream={point:point4,lineStart,lineEnd,polygonStart,polygonEnd};function point4(x2,y2){visible(x2,y2)&&activeStream.point(x2,y2)}function polygonInside(){for(var winding=0,i=0,n=polygon4.length;i<n;++i)for(var ring2=polygon4[i],j=1,m=ring2.length,point5=ring2[0],a0,a1,b0=point5[0],b1=point5[1];j<m;++j)a0=b0,a1=b1,point5=ring2[j],b0=point5[0],b1=point5[1],a1<=y12?b1>y12&&(b0-a0)*(y12-a1)>(b1-a1)*(x0-a0)&&++winding:b1<=y12&&(b0-a0)*(y12-a1)<(b1-a1)*(x0-a0)&&--winding;return winding}function polygonStart(){activeStream=bufferStream,segments=[],polygon4=[],clean=!0}function polygonEnd(){var startInside=polygonInside(),cleanInside=clean&&startInside,visible2=(segments=merge$1(segments)).length;(cleanInside||visible2)&&(stream.polygonStart(),cleanInside&&(stream.lineStart(),interpolate(null,null,1,stream),stream.lineEnd()),visible2&&clipPolygon$1(segments,compareIntersection2,startInside,interpolate,stream),stream.polygonEnd()),activeStream=stream,segments=polygon4=ring=null}function lineStart(){clipStream.point=linePoint,polygon4&&polygon4.push(ring=[]),first=!0,v_=!1,x_=y_=NaN}function lineEnd(){segments&&(linePoint(x__,y__),v__&&v_&&bufferStream.rejoin(),segments.push(bufferStream.result())),clipStream.point=point4,v_&&activeStream.lineEnd()}function linePoint(x2,y2){var v=visible(x2,y2);if(polygon4&&ring.push([x2,y2]),first)x__=x2,y__=y2,v__=v,first=!1,v&&(activeStream.lineStart(),activeStream.point(x2,y2));else if(v&&v_)activeStream.point(x2,y2);else{var a=[x_=Math.max(clipMin,Math.min(clipMax,x_)),y_=Math.max(clipMin,Math.min(clipMax,y_))],b=[x2=Math.max(clipMin,Math.min(clipMax,x2)),y2=Math.max(clipMin,Math.min(clipMax,y2))];clipLine(a,b,x0,y0,x12,y12)?(v_||(activeStream.lineStart(),activeStream.point(a[0],a[1])),activeStream.point(b[0],b[1]),v||activeStream.lineEnd(),clean=!1):v&&(activeStream.lineStart(),activeStream.point(x2,y2),clean=!1)}x_=x2,y_=y2,v_=v}return clipStream}}var sum$1=adder(),polygonContains=function(polygon4,point4){var lambda=point4[0],phi=point4[1],normal=[sin(lambda),-cos(lambda),0],angle3=0,winding=0;sum$1.reset();for(var i=0,n=polygon4.length;i<n;++i)if(!!(m=(ring=polygon4[i]).length))for(var ring,m,point0=ring[m-1],lambda0=point0[0],phi0=point0[1]/2+quarterPi,sinPhi0=sin(phi0),cosPhi0=cos(phi0),j=0;j<m;++j,lambda0=lambda1,sinPhi0=sinPhi1,cosPhi0=cosPhi1,point0=point1){var point1=ring[j],lambda1=point1[0],phi1=point1[1]/2+quarterPi,sinPhi1=sin(phi1),cosPhi1=cos(phi1),delta2=lambda1-lambda0,sign3=delta2>=0?1:-1,absDelta=sign3*delta2,antimeridian=absDelta>pi,k=sinPhi0*sinPhi1;if(sum$1.add(atan2(k*sign3*sin(absDelta),cosPhi0*cosPhi1+k*cos(absDelta))),angle3+=antimeridian?delta2+sign3*tau:delta2,antimeridian^lambda0>=lambda^lambda1>=lambda){var arc=cartesianCross(cartesian(point0),cartesian(point1));cartesianNormalizeInPlace(arc);var intersection9=cartesianCross(normal,arc);cartesianNormalizeInPlace(intersection9);var phiArc=(antimeridian^delta2>=0?-1:1)*asin(intersection9[2]);(phi>phiArc||phi===phiArc&&(arc[0]||arc[1]))&&(winding+=antimeridian^delta2>=0?1:-1)}}return(angle3<-epsilon$1||angle3<epsilon$1&&sum$1<-epsilon$1)^winding&1},lengthSum=adder(),identity$2=function(x2){return x2},areaSum$1=adder(),areaRingSum$1=adder(),x0$2=1/0,y0$2=x0$2,x1=-x0$2,y1=x1,boundsStream$1={point:boundsPoint$1,lineStart:noop2,lineEnd:noop2,polygonStart:noop2,polygonEnd:noop2,result:function(){var bounds2=[[x0$2,y0$2],[x1,y1]];return x1=y1=-(y0$2=x0$2=1/0),bounds2}};function boundsPoint$1(x2,y2){x2<x0$2&&(x0$2=x2),x2>x1&&(x1=x2),y2<y0$2&&(y0$2=y2),y2>y1&&(y1=y2)}var lengthSum$1=adder(),clip=function(pointVisible,clipLine2,interpolate,start2){return function(rotate,sink){var line=clipLine2(sink),rotatedStart=rotate.invert(start2[0],start2[1]),ringBuffer=clipBuffer(),ringSink=clipLine2(ringBuffer),polygonStarted=!1,polygon4,segments,ring,clip2={point:point4,lineStart,lineEnd,polygonStart:function(){clip2.point=pointRing,clip2.lineStart=ringStart,clip2.lineEnd=ringEnd,segments=[],polygon4=[]},polygonEnd:function(){clip2.point=point4,clip2.lineStart=lineStart,clip2.lineEnd=lineEnd,segments=merge$1(segments);var startInside=polygonContains(polygon4,rotatedStart);segments.length?(polygonStarted||(sink.polygonStart(),polygonStarted=!0),clipPolygon$1(segments,compareIntersection,startInside,interpolate,sink)):startInside&&(polygonStarted||(sink.polygonStart(),polygonStarted=!0),sink.lineStart(),interpolate(null,null,1,sink),sink.lineEnd()),polygonStarted&&(sink.polygonEnd(),polygonStarted=!1),segments=polygon4=null},sphere:function(){sink.polygonStart(),sink.lineStart(),interpolate(null,null,1,sink),sink.lineEnd(),sink.polygonEnd()}};function point4(lambda,phi){var point5=rotate(lambda,phi);pointVisible(lambda=point5[0],phi=point5[1])&&sink.point(lambda,phi)}function pointLine(lambda,phi){var point5=rotate(lambda,phi);line.point(point5[0],point5[1])}function lineStart(){clip2.point=pointLine,line.lineStart()}function lineEnd(){clip2.point=point4,line.lineEnd()}function pointRing(lambda,phi){ring.push([lambda,phi]);var point5=rotate(lambda,phi);ringSink.point(point5[0],point5[1])}function ringStart(){ringSink.lineStart(),ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]),ringSink.lineEnd();var clean=ringSink.clean(),ringSegments=ringBuffer.result(),i,n=ringSegments.length,m,segment,point5;if(ring.pop(),polygon4.push(ring),ring=null,!!n){if(clean&1){if(segment=ringSegments[0],(m=segment.length-1)>0){for(polygonStarted||(sink.polygonStart(),polygonStarted=!0),sink.lineStart(),i=0;i<m;++i)sink.point((point5=segment[i])[0],point5[1]);sink.lineEnd()}return}n>1&&clean&2&&ringSegments.push(ringSegments.pop().concat(ringSegments.shift())),segments.push(ringSegments.filter(validSegment))}}return clip2}};function validSegment(segment){return segment.length>1}function compareIntersection(a,b){return((a=a.x)[0]<0?a[1]-halfPi-epsilon$1:halfPi-a[1])-((b=b.x)[0]<0?b[1]-halfPi-epsilon$1:halfPi-b[1])}var clipAntimeridian=clip(function(){return!0},clipAntimeridianLine,clipAntimeridianInterpolate,[-pi,-halfPi]);function clipAntimeridianLine(stream){var lambda0=NaN,phi0=NaN,sign0=NaN,clean;return{lineStart:function(){stream.lineStart(),clean=1},point:function(lambda1,phi1){var sign1=lambda1>0?pi:-pi,delta2=abs2(lambda1-lambda0);abs2(delta2-pi)<epsilon$1?(stream.point(lambda0,phi0=(phi0+phi1)/2>0?halfPi:-halfPi),stream.point(sign0,phi0),stream.lineEnd(),stream.lineStart(),stream.point(sign1,phi0),stream.point(lambda1,phi0),clean=0):sign0!==sign1&&delta2>=pi&&(abs2(lambda0-sign0)<epsilon$1&&(lambda0-=sign0*epsilon$1),abs2(lambda1-sign1)<epsilon$1&&(lambda1-=sign1*epsilon$1),phi0=clipAntimeridianIntersect(lambda0,phi0,lambda1,phi1),stream.point(sign0,phi0),stream.lineEnd(),stream.lineStart(),stream.point(sign1,phi0),clean=0),stream.point(lambda0=lambda1,phi0=phi1),sign0=sign1},lineEnd:function(){stream.lineEnd(),lambda0=phi0=NaN},clean:function(){return 2-clean}}}function clipAntimeridianIntersect(lambda0,phi0,lambda1,phi1){var cosPhi0,cosPhi1,sinLambda0Lambda1=sin(lambda0-lambda1);return abs2(sinLambda0Lambda1)>epsilon$1?atan((sin(phi0)*(cosPhi1=cos(phi1))*sin(lambda1)-sin(phi1)*(cosPhi0=cos(phi0))*sin(lambda0))/(cosPhi0*cosPhi1*sinLambda0Lambda1)):(phi0+phi1)/2}function clipAntimeridianInterpolate(from,to,direction,stream){var phi;if(from==null)phi=direction*halfPi,stream.point(-pi,phi),stream.point(0,phi),stream.point(pi,phi),stream.point(pi,0),stream.point(pi,-phi),stream.point(0,-phi),stream.point(-pi,-phi),stream.point(-pi,0),stream.point(-pi,phi);else if(abs2(from[0]-to[0])>epsilon$1){var lambda=from[0]<to[0]?pi:-pi;phi=direction*lambda/2,stream.point(-lambda,phi),stream.point(0,phi),stream.point(lambda,phi)}else stream.point(to[0],to[1])}var clipCircle=function(radius,delta2){var cr=cos(radius),smallRadius=cr>0,notHemisphere=abs2(cr)>epsilon$1;function interpolate(from,to,direction,stream){circleStream(stream,radius,delta2,direction,from,to)}function visible(lambda,phi){return cos(lambda)*cos(phi)>cr}function clipLine2(stream){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=!1,clean=1},point:function(lambda,phi){var point1=[lambda,phi],point22,v=visible(lambda,phi),c=smallRadius?v?0:code(lambda,phi):v?code(lambda+(lambda<0?pi:-pi),phi):0;if(!point0&&(v00=v0=v)&&stream.lineStart(),v!==v0&&(point22=intersect2(point0,point1),(!point22||pointEqual(point0,point22)||pointEqual(point1,point22))&&(point1[0]+=epsilon$1,point1[1]+=epsilon$1,v=visible(point1[0],point1[1]))),v!==v0)clean=0,v?(stream.lineStart(),point22=intersect2(point1,point0),stream.point(point22[0],point22[1])):(point22=intersect2(point0,point1),stream.point(point22[0],point22[1]),stream.lineEnd()),point0=point22;else if(notHemisphere&&point0&&smallRadius^v){var t;!(c&c0)&&(t=intersect2(point1,point0,!0))&&(clean=0,smallRadius?(stream.lineStart(),stream.point(t[0][0],t[0][1]),stream.point(t[1][0],t[1][1]),stream.lineEnd()):(stream.point(t[1][0],t[1][1]),stream.lineEnd(),stream.lineStart(),stream.point(t[0][0],t[0][1])))}v&&(!point0||!pointEqual(point0,point1))&&stream.point(point1[0],point1[1]),point0=point1,v0=v,c0=c},lineEnd:function(){v0&&stream.lineEnd(),point0=null},clean:function(){return clean|(v00&&v0)<<1}}}function intersect2(a,b,two){var pa=cartesian(a),pb=cartesian(b),n1=[1,0,0],n2=cartesianCross(pa,pb),n2n2=cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=cartesianCross(n1,n2),A=cartesianScale(n1,c1),B=cartesianScale(n2,c2);cartesianAddInPlace(A,B);var u=n1xn2,w=cartesianDot(A,u),uu=cartesianDot(u,u),t2=w*w-uu*(cartesianDot(A,A)-1);if(!(t2<0)){var t=sqrt3(t2),q=cartesianScale(u,(-w-t)/uu);if(cartesianAddInPlace(q,A),q=spherical(q),!two)return q;var lambda0=a[0],lambda1=b[0],phi0=a[1],phi1=b[1],z;lambda1<lambda0&&(z=lambda0,lambda0=lambda1,lambda1=z);var delta3=lambda1-lambda0,polar=abs2(delta3-pi)<epsilon$1,meridian=polar||delta3<epsilon$1;if(!polar&&phi1<phi0&&(z=phi0,phi0=phi1,phi1=z),meridian?polar?phi0+phi1>0^q[1]<(abs2(q[0]-lambda0)<epsilon$1?phi0:phi1):phi0<=q[1]&&q[1]<=phi1:delta3>pi^(lambda0<=q[0]&&q[0]<=lambda1)){var q1=cartesianScale(u,(-w+t)/uu);return cartesianAddInPlace(q1,A),[q,spherical(q1)]}}}function code(lambda,phi){var r=smallRadius?radius:pi-radius,code2=0;return lambda<-r?code2|=1:lambda>r&&(code2|=2),phi<-r?code2|=4:phi>r&&(code2|=8),code2}return clip(visible,clipLine2,interpolate,smallRadius?[0,-radius]:[-pi,radius-pi])};function transformer(methods){return function(stream){var s=new TransformStream;for(var key in methods)s[key]=methods[key];return s.stream=stream,s}}function TransformStream(){}TransformStream.prototype={constructor:TransformStream,point:function(x2,y2){this.stream.point(x2,y2)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function fitExtent(projection2,extent,object2){var w=extent[1][0]-extent[0][0],h=extent[1][1]-extent[0][1],clip2=projection2.clipExtent&&projection2.clipExtent();projection2.scale(150).translate([0,0]),clip2!=null&&projection2.clipExtent(null),geoStream(object2,projection2.stream(boundsStream$1));var b=boundsStream$1.result(),k=Math.min(w/(b[1][0]-b[0][0]),h/(b[1][1]-b[0][1])),x2=+extent[0][0]+(w-k*(b[1][0]+b[0][0]))/2,y2=+extent[0][1]+(h-k*(b[1][1]+b[0][1]))/2;return clip2!=null&&projection2.clipExtent(clip2),projection2.scale(k*150).translate([x2,y2])}function fitSize(projection2,size11,object2){return fitExtent(projection2,[[0,0],size11],object2)}var maxDepth=16,cosMinDistance=cos(30*radians),resample=function(project2,delta2){return+delta2?resample$1(project2,delta2):resampleNone(project2)};function resampleNone(project2){return transformer({point:function(x2,y2){x2=project2(x2,y2),this.stream.point(x2[0],x2[1])}})}function resample$1(project2,delta2){function resampleLineTo(x0,y0,lambda0,a0,b0,c0,x12,y12,lambda1,a1,b1,c1,depth2,stream){var dx=x12-x0,dy=y12-y0,d2=dx*dx+dy*dy;if(d2>4*delta2&&depth2--){var a=a0+a1,b=b0+b1,c=c0+c1,m=sqrt3(a*a+b*b+c*c),phi2=asin(c/=m),lambda2=abs2(abs2(c)-1)<epsilon$1||abs2(lambda0-lambda1)<epsilon$1?(lambda0+lambda1)/2:atan2(b,a),p=project2(lambda2,phi2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;(dz*dz/d2>delta2||abs2((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance)&&(resampleLineTo(x0,y0,lambda0,a0,b0,c0,x2,y2,lambda2,a/=m,b/=m,c,depth2,stream),stream.point(x2,y2),resampleLineTo(x2,y2,lambda2,a,b,c,x12,y12,lambda1,a1,b1,c1,depth2,stream))}}return function(stream){var lambda00,x00,y00,a00,b00,c00,lambda0,x0,y0,a0,b0,c0,resampleStream={point:point4,lineStart,lineEnd,polygonStart:function(){stream.polygonStart(),resampleStream.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd(),resampleStream.lineStart=lineStart}};function point4(x2,y2){x2=project2(x2,y2),stream.point(x2[0],x2[1])}function lineStart(){x0=NaN,resampleStream.point=linePoint,stream.lineStart()}function linePoint(lambda,phi){var c=cartesian([lambda,phi]),p=project2(lambda,phi);resampleLineTo(x0,y0,lambda0,a0,b0,c0,x0=p[0],y0=p[1],lambda0=lambda,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream),stream.point(x0,y0)}function lineEnd(){resampleStream.point=point4,stream.lineEnd()}function ringStart(){lineStart(),resampleStream.point=ringPoint,resampleStream.lineEnd=ringEnd}function ringPoint(lambda,phi){linePoint(lambda00=lambda,phi),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0,resampleStream.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,lambda0,a0,b0,c0,x00,y00,lambda00,a00,b00,c00,maxDepth,stream),resampleStream.lineEnd=lineEnd,lineEnd()}return resampleStream}}var transformRadians=transformer({point:function(x2,y2){this.stream.point(x2*radians,y2*radians)}});function projection(project2){return projectionMutator(function(){return project2})()}function projectionMutator(projectAt){var project2,k=150,x2=480,y2=250,dx,dy,lambda=0,phi=0,deltaLambda=0,deltaPhi=0,deltaGamma=0,rotate,projectRotate,theta=null,preclip=clipAntimeridian,x0=null,y0,x12,y12,postclip=identity$2,delta2=.5,projectResample=resample(projectTransform,delta2),cache,cacheStream;function projection2(point4){return point4=projectRotate(point4[0]*radians,point4[1]*radians),[point4[0]*k+dx,dy-point4[1]*k]}function invert(point4){return point4=projectRotate.invert((point4[0]-dx)/k,(dy-point4[1])/k),point4&&[point4[0]*degrees,point4[1]*degrees]}function projectTransform(x3,y3){return x3=project2(x3,y3),[x3[0]*k+dx,dy-x3[1]*k]}projection2.stream=function(stream){return cache&&cacheStream===stream?cache:cache=transformRadians(preclip(rotate,projectResample(postclip(cacheStream=stream))))},projection2.clipAngle=function(_){return arguments.length?(preclip=+_?clipCircle(theta=_*radians,6*radians):(theta=null,clipAntimeridian),reset()):theta*degrees},projection2.clipExtent=function(_){return arguments.length?(postclip=_==null?(x0=y0=x12=y12=null,identity$2):clipExtent(x0=+_[0][0],y0=+_[0][1],x12=+_[1][0],y12=+_[1][1]),reset()):x0==null?null:[[x0,y0],[x12,y12]]},projection2.scale=function(_){return arguments.length?(k=+_,recenter()):k},projection2.translate=function(_){return arguments.length?(x2=+_[0],y2=+_[1],recenter()):[x2,y2]},projection2.center=function(_){return arguments.length?(lambda=_[0]%360*radians,phi=_[1]%360*radians,recenter()):[lambda*degrees,phi*degrees]},projection2.rotate=function(_){return arguments.length?(deltaLambda=_[0]%360*radians,deltaPhi=_[1]%360*radians,deltaGamma=_.length>2?_[2]%360*radians:0,recenter()):[deltaLambda*degrees,deltaPhi*degrees,deltaGamma*degrees]},projection2.precision=function(_){return arguments.length?(projectResample=resample(projectTransform,delta2=_*_),reset()):sqrt3(delta2)},projection2.fitExtent=function(extent$$1,object2){return fitExtent(projection2,extent$$1,object2)},projection2.fitSize=function(size11,object2){return fitSize(projection2,size11,object2)};function recenter(){projectRotate=compose(rotate=rotateRadians(deltaLambda,deltaPhi,deltaGamma),project2);var center2=project2(lambda,phi);return dx=x2-center2[0]*k,dy=y2+center2[1]*k,reset()}function reset(){return cache=cacheStream=null,projection2}return function(){return project2=projectAt.apply(this,arguments),projection2.invert=project2.invert&&invert,recenter()}}function mercatorRaw(lambda,phi){return[lambda,log(tan((halfPi+phi)/2))]}mercatorRaw.invert=function(x2,y2){return[x2,2*atan(exp(y2))-halfPi]};function mercatorProjection(project2){var m=projection(project2),center2=m.center,scale4=m.scale,translate2=m.translate,clipExtent2=m.clipExtent,x0=null,y0,x12,y12;m.scale=function(_){return arguments.length?(scale4(_),reclip()):scale4()},m.translate=function(_){return arguments.length?(translate2(_),reclip()):translate2()},m.center=function(_){return arguments.length?(center2(_),reclip()):center2()},m.clipExtent=function(_){return arguments.length?(_==null?x0=y0=x12=y12=null:(x0=+_[0][0],y0=+_[0][1],x12=+_[1][0],y12=+_[1][1]),reclip()):x0==null?null:[[x0,y0],[x12,y12]]};function reclip(){var k=pi*scale4(),t=m(rotation(m.rotate()).invert([0,0]));return clipExtent2(x0==null?[[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]]:project2===mercatorRaw?[[Math.max(t[0]-k,x0),y0],[Math.min(t[0]+k,x12),y12]]:[[x0,Math.max(t[1]-k,y0)],[x12,Math.min(t[1]+k,y12)]])}return reclip()}function transverseMercatorRaw(lambda,phi){return[log(tan((halfPi+phi)/2)),-lambda]}transverseMercatorRaw.invert=function(x2,y2){return[-y2,2*atan(exp(x2))-halfPi]};var geoTransverseMercator=function(){var m=mercatorProjection(transverseMercatorRaw),center2=m.center,rotate=m.rotate;return m.center=function(_){return arguments.length?center2([-_[1],_[0]]):(_=center2(),[_[1],-_[0]])},m.rotate=function(_){return arguments.length?rotate([_[0],_[1],_.length>2?_[2]+90:90]):(_=rotate(),[_[0],_[1],_[2]-90])},rotate([0,0,90]).scale(159.155)};function buffer$1(geojson,radius,options){options=options||{};var units=options.units,steps=options.steps||64;if(!geojson)throw new Error("geojson is required");if(typeof options!="object")throw new Error("options must be an object");if(typeof steps!="number")throw new Error("steps must be an number");if(radius===void 0)throw new Error("radius is required");if(steps<=0)throw new Error("steps must be greater than 0");steps=steps||64,units=units||"kilometers";var results=[];switch(geojson.type){case"GeometryCollection":return geomEach(geojson,function(geometry$$1){var buffered=bufferFeature(geometry$$1,radius,units,steps);buffered&&results.push(buffered)}),featureCollection(results);case"FeatureCollection":return featureEach(geojson,function(feature$$1){var multiBuffered=bufferFeature(feature$$1,radius,units,steps);multiBuffered&&featureEach(multiBuffered,function(buffered){buffered&&results.push(buffered)})}),featureCollection(results)}return bufferFeature(geojson,radius,units,steps)}function bufferFeature(geojson,radius,units,steps){var properties=geojson.properties||{},geometry$$1=geojson.type==="Feature"?geojson.geometry:geojson;if(geometry$$1.type==="GeometryCollection"){var results=[];return geomEach(geojson,function(geometry$$12){var buffered2=bufferFeature(geometry$$12,radius,units,steps);buffered2&&results.push(buffered2)}),featureCollection(results)}var projected,bbox$$1=bbox(geojson),needsTransverseMercator=bbox$$1[1]>50&&bbox$$1[3]>50;needsTransverseMercator?projected={type:geometry$$1.type,coordinates:projectCoords(geometry$$1.coordinates,defineProjection(geometry$$1))}:projected=toMercator(geometry$$1);var reader=new GeoJSONReader,geom=reader.read(projected),distance12=radiansToLength(lengthToRadians(radius,units),"meters"),buffered=BufferOp.bufferOp(geom,distance12),writer=new GeoJSONWriter;if(buffered=writer.write(buffered),!coordsIsNaN(buffered.coordinates)){var result;return needsTransverseMercator?result={type:buffered.type,coordinates:unprojectCoords(buffered.coordinates,defineProjection(geometry$$1))}:result=toWgs84(buffered),result.geometry?result:feature(result,properties)}}function coordsIsNaN(coords){return Array.isArray(coords[0])?coordsIsNaN(coords[0]):isNaN(coords[0])}function projectCoords(coords,proj){return typeof coords[0]!="object"?proj(coords):coords.map(function(coord){return projectCoords(coord,proj)})}function unprojectCoords(coords,proj){return typeof coords[0]!="object"?proj.invert(coords):coords.map(function(coord){return unprojectCoords(coord,proj)})}function defineProjection(geojson){var coords=center(geojson).geometry.coordinates.reverse(),rotate=coords.map(function(coord){return-coord});return geoTransverseMercator().center(coords).rotate(rotate).scale(earthRadius)}function union6(){for(var reader=new GeoJSONReader,result=reader.read(JSON.stringify(arguments[0].geometry)),i=1;i<arguments.length;i++)result=UnionOp.union(result,reader.read(JSON.stringify(arguments[i].geometry)));var writer=new GeoJSONWriter;return result=writer.write(result),{type:"Feature",geometry:result,properties:arguments[0].properties}}function intersect$2(poly1,poly2){var geom1=getGeom(poly1),geom2=getGeom(poly2);if(cleanCoords(truncate(geom2,{precision:4})).coordinates[0].length<4||cleanCoords(truncate(geom1,{precision:4})).coordinates[0].length<4)return null;var reader=new GeoJSONReader,a=reader.read(truncate(geom1)),b=reader.read(truncate(geom2)),intersection9=OverlayOp.intersection(a,b);if(intersection9.isEmpty())return null;var writer=new GeoJSONWriter,geom=writer.write(intersection9);return feature(geom)}/**
 * @license get-closest https://github.com/cosmosio/get-closest
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2014-2017 Olivier Scherrer <pode.fr@gmail.com>
 */function _getClosest(item,array,getDiff){var closest,diff2;if(!Array.isArray(array))throw new Error("Get closest expects an array as second argument");return array.forEach(function(comparedItem,comparedItemIndex){var thisDiff=getDiff(comparedItem,item);thisDiff>=0&&(typeof diff2>"u"||thisDiff<diff2)&&(diff2=thisDiff,closest=comparedItemIndex)}),closest}function closestGreaterNumber(item,array){return _getClosest(item,array,function(comparedItem,item2){return comparedItem-item2})}function dissolve$1(featureCollection$$1,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var propertyName=options.propertyName;collectionOf(featureCollection$$1,"Polygon","dissolve");var fc=clone2(featureCollection$$1),features=fc.features,originalIndexOfItemsRemoved=[];features.forEach(function(f,i2){f.properties.origIndexPosition=i2});var tree=geojsonRbush();tree.load(fc);for(var i in features){var polygon$$1=features[i],featureChanged=!1;if(tree.search(polygon$$1).features.forEach(function(potentialMatchingFeature){polygon$$1=features[i];var matchFeaturePosition=potentialMatchingFeature.properties.origIndexPosition;if(originalIndexOfItemsRemoved.length>0&&matchFeaturePosition!==0)if(matchFeaturePosition>originalIndexOfItemsRemoved[originalIndexOfItemsRemoved.length-1])matchFeaturePosition=matchFeaturePosition-originalIndexOfItemsRemoved.length;else{var closestNumber$$1=closestGreaterNumber(matchFeaturePosition,originalIndexOfItemsRemoved);closestNumber$$1!==0&&(matchFeaturePosition=matchFeaturePosition-closestNumber$$1)}if(matchFeaturePosition!==+i){var matchFeature=features[matchFeaturePosition];!matchFeature||!polygon$$1||propertyName!==void 0&&matchFeature.properties[propertyName]!==polygon$$1.properties[propertyName]||!booleanOverlap(polygon$$1,matchFeature)||!ringsIntersect(polygon$$1,matchFeature)||(features[i]=union6(polygon$$1,matchFeature),originalIndexOfItemsRemoved.push(potentialMatchingFeature.properties.origIndexPosition),originalIndexOfItemsRemoved.sort(function(a,b){return a-b}),tree.remove(potentialMatchingFeature),features.splice(matchFeaturePosition,1),polygon$$1.properties.origIndexPosition=i,tree.remove(polygon$$1,function(a,b){return a.properties.origIndexPosition===b.properties.origIndexPosition}),featureChanged=!0)}}),featureChanged){if(!polygon$$1)continue;polygon$$1.properties.origIndexPosition=i,tree.insert(polygon$$1),i--}}return features.forEach(function(f){delete f.properties.origIndexPosition,delete f.bbox}),fc}function ringsIntersect(poly1,poly2){var line1=lineString(coordAll(poly1)),line2=lineString(coordAll(poly2)),points$$1=lineIntersect(line1,line2).features;return points$$1.length>0}function hexGrid(bbox2,cellSide,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var properties=options.properties||{},triangles=options.triangles,mask2=options.mask;if(cellSide==null)throw new Error("cellSide is required");if(!isNumber(cellSide))throw new Error("cellSide is invalid");if(!bbox2)throw new Error("bbox is required");if(!Array.isArray(bbox2))throw new Error("bbox must be array");if(bbox2.length!==4)throw new Error("bbox must contain 4 numbers");if(mask2&&["Polygon","MultiPolygon"].indexOf(getType(mask2))===-1)throw new Error("options.mask must be a (Multi)Polygon");var west=bbox2[0],south=bbox2[1],east=bbox2[2],north=bbox2[3],centerY=(south+north)/2,centerX=(west+east)/2,xFraction=cellSide*2/distance2([west,centerY],[east,centerY],options),cellWidth=xFraction*(east-west),yFraction=cellSide*2/distance2([centerX,south],[centerX,north],options),cellHeight=yFraction*(north-south),radius=cellWidth/2,hex_width=radius*2,hex_height=Math.sqrt(3)/2*cellHeight,box_width=east-west,box_height=north-south,x_interval=3/4*hex_width,y_interval=hex_height,x_span=(box_width-hex_width)/(hex_width-radius/2),x_count=Math.floor(x_span),x_adjust=(x_count*x_interval-radius/2-box_width)/2-radius/2+x_interval/2,y_count=Math.floor((box_height-hex_height)/hex_height),y_adjust=(box_height-y_count*hex_height)/2,hasOffsetY=y_count*hex_height-box_height>hex_height/2;hasOffsetY&&(y_adjust-=hex_height/4);for(var cosines=[],sines=[],i=0;i<6;i++){var angle3=2*Math.PI/6*i;cosines.push(Math.cos(angle3)),sines.push(Math.sin(angle3))}for(var results=[],x2=0;x2<=x_count;x2++)for(var y2=0;y2<=y_count;y2++){var isOdd=x2%2===1;if(!(y2===0&&isOdd)&&!(y2===0&&hasOffsetY)){var center_x=x2*x_interval+west-x_adjust,center_y=y2*y_interval+south+y_adjust;if(isOdd&&(center_y-=hex_height/2),triangles===!0)hexTriangles([center_x,center_y],cellWidth/2,cellHeight/2,properties,cosines,sines).forEach(function(triangle){mask2?intersect$2(mask2,triangle)&&results.push(triangle):results.push(triangle)});else{var hex=hexagon([center_x,center_y],cellWidth/2,cellHeight/2,properties,cosines,sines);mask2?intersect$2(mask2,hex)&&results.push(hex):results.push(hex)}}}return featureCollection(results)}function hexagon(center2,rx,ry,properties,cosines,sines){for(var vertices=[],i=0;i<6;i++){var x2=center2[0]+rx*cosines[i],y2=center2[1]+ry*sines[i];vertices.push([x2,y2])}return vertices.push(vertices[0].slice()),polygon([vertices],properties)}function hexTriangles(center2,rx,ry,properties,cosines,sines){for(var triangles=[],i=0;i<6;i++){var vertices=[];vertices.push(center2),vertices.push([center2[0]+rx*cosines[i],center2[1]+ry*sines[i]]),vertices.push([center2[0]+rx*cosines[(i+1)%6],center2[1]+ry*sines[(i+1)%6]]),vertices.push(center2),triangles.push(polygon([vertices],properties))}return triangles}function mask(polygon$$1,mask2){var maskPolygon=createMask(mask2),separated=separatePolygons(polygon$$1),polygonOuters=separated[0],polygonInners=separated[1];polygonOuters=unionPolygons(polygonOuters),polygonInners=unionPolygons(polygonInners);var masked=buildMask(maskPolygon,polygonOuters,polygonInners);return masked}function buildMask(maskPolygon,polygonOuters,polygonInners){var coordinates=[];return coordinates.push(maskPolygon.geometry.coordinates[0]),flattenEach(polygonOuters,function(feature$$1){coordinates.push(feature$$1.geometry.coordinates[0])}),flattenEach(polygonInners,function(feature$$1){coordinates.push(feature$$1.geometry.coordinates[0])}),polygon(coordinates)}function separatePolygons(poly){var outers=[],inners=[];return flattenEach(poly,function(feature$$1){var coordinates=feature$$1.geometry.coordinates,featureOuter=coordinates[0],featureInner=coordinates.slice(1);outers.push(polygon([featureOuter])),featureInner.forEach(function(inner){inners.push(polygon([inner]))})}),[featureCollection(outers),featureCollection(inners)]}function createMask(mask2){var world=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],coordinates=mask2&&mask2.geometry.coordinates||world;return polygon(coordinates)}function unionPolygons(polygons$$1){if(polygons$$1.features.length<=1)return polygons$$1;var tree=createIndex(polygons$$1),results=[],removed={};return flattenEach(polygons$$1,function(currentFeature,currentIndex){if(removed[currentIndex])return!0;for(tree.remove({index:currentIndex},filterByIndex),removed[currentIndex]=!0;;){var bbox$$1=bbox(currentFeature),search=tree.search({minX:bbox$$1[0],minY:bbox$$1[1],maxX:bbox$$1[2],maxY:bbox$$1[3]});if(search.length>0){var polys=search.map(function(item){return removed[item.index]=!0,tree.remove({index:item.index},filterByIndex),item.geojson});polys.push(currentFeature),currentFeature=union6.apply(this,polys)}if(search.length===0)break}results.push(currentFeature)}),featureCollection(results)}function filterByIndex(a,b){return a.index===b.index}function createIndex(features){var tree=rbush_1(),load=[];return flattenEach(features,function(feature$$1,index){var bbox$$1=bbox(feature$$1);load.push({minX:bbox$$1[0],minY:bbox$$1[1],maxX:bbox$$1[2],maxY:bbox$$1[3],geojson:feature$$1,index})}),tree.load(load),tree}function squareGrid(bbox2,cellSide,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var properties=options.properties,mask2=options.mask,results=[];if(cellSide==null)throw new Error("cellSide is required");if(!isNumber(cellSide))throw new Error("cellSide is invalid");if(!bbox2)throw new Error("bbox is required");if(!Array.isArray(bbox2))throw new Error("bbox must be array");if(bbox2.length!==4)throw new Error("bbox must contain 4 numbers");if(mask2&&["Polygon","MultiPolygon"].indexOf(getType(mask2))===-1)throw new Error("options.mask must be a (Multi)Polygon");for(var west=bbox2[0],south=bbox2[1],east=bbox2[2],north=bbox2[3],xFraction=cellSide/distance2([west,south],[east,south],options),cellWidth=xFraction*(east-west),yFraction=cellSide/distance2([west,south],[west,north],options),cellHeight=yFraction*(north-south),bboxWidth=east-west,bboxHeight=north-south,columns=Math.floor(bboxWidth/cellWidth),rows=Math.floor(bboxHeight/cellHeight),deltaX=(bboxWidth-columns*cellWidth)/2,deltaY=(bboxHeight-rows*cellHeight)/2,currentX=west+deltaX,column=0;column<columns;column++){for(var currentY=south+deltaY,row=0;row<rows;row++){var cellPoly=polygon([[[currentX,currentY],[currentX,currentY+cellHeight],[currentX+cellWidth,currentY+cellHeight],[currentX+cellWidth,currentY],[currentX,currentY]]],properties);mask2?intersect$2(mask2,cellPoly)&&results.push(cellPoly):results.push(cellPoly),currentY+=cellHeight}currentX+=cellWidth}return featureCollection(results)}function triangleGrid(bbox2,cellSide,options){if(options=options||{},!isObject(options))throw new Error("options is invalid");var properties=options.properties,mask2=options.mask,results=[];if(cellSide==null)throw new Error("cellSide is required");if(!isNumber(cellSide))throw new Error("cellSide is invalid");if(!bbox2)throw new Error("bbox is required");if(!Array.isArray(bbox2))throw new Error("bbox must be array");if(bbox2.length!==4)throw new Error("bbox must contain 4 numbers");if(mask2&&["Polygon","MultiPolygon"].indexOf(getType(mask2))===-1)throw new Error("options.mask must be a (Multi)Polygon");for(var xFraction=cellSide/distance2([bbox2[0],bbox2[1]],[bbox2[2],bbox2[1]],options),cellWidth=xFraction*(bbox2[2]-bbox2[0]),yFraction=cellSide/distance2([bbox2[0],bbox2[1]],[bbox2[0],bbox2[3]],options),cellHeight=yFraction*(bbox2[3]-bbox2[1]),xi=0,currentX=bbox2[0];currentX<=bbox2[2];){for(var yi=0,currentY=bbox2[1];currentY<=bbox2[3];){var cellTriangle1=null,cellTriangle2=null;xi%2===0&&yi%2===0?(cellTriangle1=polygon([[[currentX,currentY],[currentX,currentY+cellHeight],[currentX+cellWidth,currentY],[currentX,currentY]]],properties),cellTriangle2=polygon([[[currentX,currentY+cellHeight],[currentX+cellWidth,currentY+cellHeight],[currentX+cellWidth,currentY],[currentX,currentY+cellHeight]]],properties)):xi%2===0&&yi%2===1?(cellTriangle1=polygon([[[currentX,currentY],[currentX+cellWidth,currentY+cellHeight],[currentX+cellWidth,currentY],[currentX,currentY]]],properties),cellTriangle2=polygon([[[currentX,currentY],[currentX,currentY+cellHeight],[currentX+cellWidth,currentY+cellHeight],[currentX,currentY]]],properties)):yi%2===0&&xi%2===1?(cellTriangle1=polygon([[[currentX,currentY],[currentX,currentY+cellHeight],[currentX+cellWidth,currentY+cellHeight],[currentX,currentY]]],properties),cellTriangle2=polygon([[[currentX,currentY],[currentX+cellWidth,currentY+cellHeight],[currentX+cellWidth,currentY],[currentX,currentY]]],properties)):yi%2===1&&xi%2===1&&(cellTriangle1=polygon([[[currentX,currentY],[currentX,currentY+cellHeight],[currentX+cellWidth,currentY],[currentX,currentY]]],properties),cellTriangle2=polygon([[[currentX,currentY+cellHeight],[currentX+cellWidth,currentY+cellHeight],[currentX+cellWidth,currentY],[currentX,currentY+cellHeight]]],properties)),mask2?(intersect$2(mask2,cellTriangle1)&&results.push(cellTriangle1),intersect$2(mask2,cellTriangle2)&&results.push(cellTriangle2)):(results.push(cellTriangle1),results.push(cellTriangle2)),currentY+=cellHeight,yi++}xi++,currentX+=cellWidth}return featureCollection(results)}function interpolate$1(points$$1,cellSize,options){if(options=options||{},typeof options!="object")throw new Error("options is invalid");var gridType=options.gridType,property=options.property,weight=options.weight;if(!points$$1)throw new Error("points is required");if(collectionOf(points$$1,"Point","input must contain Points"),!cellSize)throw new Error("cellSize is required");if(weight!==void 0&&typeof weight!="number")throw new Error("weight must be a number");property=property||"elevation",gridType=gridType||"square",weight=weight||1;var box=bbox(points$$1),grid;switch(gridType){case"point":case"points":grid=pointGrid(box,cellSize,options);break;case"square":case"squares":grid=squareGrid(box,cellSize,options);break;case"hex":case"hexes":grid=hexGrid(box,cellSize,options);break;case"triangle":case"triangles":grid=triangleGrid(box,cellSize,options);break;default:throw new Error("invalid gridType")}var results=[];return featureEach(grid,function(gridFeature){var zw=0,sw=0;featureEach(points$$1,function(point$$1){var gridPoint=gridType==="point"?gridFeature:centroid(gridFeature),d=distance2(gridPoint,point$$1,options),zValue;if(property!==void 0&&(zValue=point$$1.properties[property]),zValue===void 0&&(zValue=point$$1.geometry.coordinates[2]),zValue===void 0)throw new Error("zValue is missing");d===0&&(zw=zValue);var w=1/Math.pow(d,weight);sw+=w,zw+=w*zValue});var newFeature=clone2(gridFeature);newFeature.properties[property]=zw/sw,results.push(newFeature)}),featureCollection(results)}var turf_default={projection:main_es$3,random:main_es$4,clusters:main_es$5,helpers:main_es$1,invariant:main_es$2,meta:main_es,isolines,convex,pointsWithinPolygon,concave,collect,flip,simplify,bezierSpline:bezier,tag,sample,envelope,square,circle,midpoint,center,centerOfMass,centroid,combine,distance:distance2,explode,bbox,tesselate,bboxPolygon,booleanPointInPolygon,nearestPoint,nearestPointOnLine,nearestPointToLine,planepoint,tin,bearing,destination,kinks,pointOnFeature,area:area$1,along,length:length2,lineSlice,lineSliceAlong,pointGrid,truncate,flatten,lineIntersect,lineChunk,unkinkPolygon,greatCircle,lineSegment,lineSplit,lineArc,polygonToLine,lineToPolygon,bboxClip,lineOverlap,sector,rhumbBearing,rhumbDistance,rhumbDestination,polygonTangents,rewind,isobands,transformRotate,transformScale,transformTranslate,lineOffset,polygonize:polygonize$1,booleanDisjoint,booleanContains,booleanCrosses,booleanClockwise,booleanOverlap,booleanPointOnLine,booleanEqual,booleanWithin,clone:clone2,cleanCoords,clustersDbscan,clustersKmeans,pointToLineDistance,booleanParallel,booleanIntersects,shortestPath,voronoi:voronoi$1,ellipse,centerMean,centerMedian,standardDeviationalEllipse,difference:difference3,buffer:buffer$1,union:union6,intersect:intersect$2,dissolve:dissolve$1,hexGrid,mask,squareGrid,triangleGrid,interpolate:interpolate$1,pointOnSurface:pointOnFeature,polygonToLineString:polygonToLine,lineStringToPolygon:lineToPolygon,inside:booleanPointInPolygon,within:pointsWithinPolygon,bezier,nearest:nearestPoint,pointOnLine:nearestPointOnLine,lineDistance:length2,radians2degrees:radiansToDegrees,degrees2radians:degreesToRadians,distanceToDegrees:lengthToDegrees,distanceToRadians:lengthToRadians,radiansToDistance:radiansToLength,bearingToAngle:bearingToAzimuth,convertDistance:convertLength,toMercator,toWgs84,randomPosition,randomPoint,randomPolygon,randomLineString,getCluster,clusterEach,clusterReduce,createBins,applyFilter,propertiesContainsFilter,filterProperties,earthRadius,factors,unitsFactors,areaFactors,feature,geometry,point,points,polygon,polygons,lineString,lineStrings,featureCollection,multiLineString,multiPoint,multiPolygon,geometryCollection,round,radiansToLength,lengthToRadians,lengthToDegrees,bearingToAzimuth,radiansToDegrees,degreesToRadians,convertLength,convertArea,isNumber,isObject,validateBBox,validateId,getCoord,getCoords,containsNumber,geojsonType,featureOf,collectionOf,getGeom,getGeomType,getType,coordEach,coordReduce,propEach,propReduce,featureEach,featureReduce,coordAll,geomEach,geomReduce,flattenEach,flattenReduce,segmentEach,segmentReduce,lineEach,lineReduce};function EV_E3mLayerManager(scene){ContextLimits_default._maximumCombinedTextureImageUnits=Cesium.ContextLimits._maximumCombinedTextureImageUnits,ContextLimits_default._maximumCubeMapSize=Cesium.ContextLimits._maximumCubeMapSize,ContextLimits_default._maximumFragmentUniformVectors=Cesium.ContextLimits._maximumFragmentUniformVectors,ContextLimits_default._maximumTextureImageUnits=Cesium.ContextLimits._maximumTextureImageUnits,ContextLimits_default._maximumRenderbufferSize=Cesium.ContextLimits._maximumRenderbufferSize,ContextLimits_default._maximumTextureSize=Cesium.ContextLimits._maximumTextureSize,ContextLimits_default._maximumVertexAttributes=Cesium.ContextLimits._maximumVertexAttributes,ContextLimits_default._maximumVertexTextureImageUnits=Cesium.ContextLimits._maximumVertexTextureImageUnits,ContextLimits_default._maximumVertexUniformVectors=Cesium.ContextLimits._maximumVertexUniformVectors,ContextLimits_default._minimumAliasedLineWidth=Cesium.ContextLimits._minimumAliasedLineWidth,ContextLimits_default._maximumAliasedLineWidth=Cesium.ContextLimits._maximumAliasedLineWidth,ContextLimits_default._minimumAliasedPointSize=Cesium.ContextLimits._minimumAliasedPointSize,ContextLimits_default._maximumAliasedPointSize=Cesium.ContextLimits._maximumAliasedPointSize,ContextLimits_default._maximumViewportWidth=Cesium.ContextLimits._maximumViewportWidth,ContextLimits_default._maximumViewportHeight=Cesium.ContextLimits._maximumViewportHeight,ContextLimits_default._highpFloatSupported=Cesium.ContextLimits._highpFloatSupported,ContextLimits_default._highpIntSupported=Cesium.ContextLimits._highpIntSupported,ContextLimits_default._maximumTextureFilterAnisotropy=Cesium.ContextLimits._maximumTextureFilterAnisotropy,ContextLimits_default._maximumDrawBuffers=Cesium.ContextLimits._maximumDrawBuffers,ContextLimits_default._maximumColorAttachments=Cesium.ContextLimits._maximumColorAttachments,this._scene=scene,this._primitives=scene._primitives,this._e3ms=new Cesium.AssociativeArray,this.layerAddedEvent=new Cesium.Event,this.layerRemovedEvent=new Cesium.Event,this.layerMovedEvent=new Cesium.Event,this.layerShownOrHiddenEvent=new Cesium.Event,this.selectionChanged=new Cesium.Event,this.featureSelectionChanged=new Cesium.Event,this._selectedFeature=void 0,this._scene.logarithmicDepthBuffer=!0,this._scene.postProcessStages._fxaa.enabled=!0,this._scene._context._gl.getExtension("EXT_shader_texture_lod");var ext=this._scene._context._gl.getExtension("OES_texture_float");ext?window.NO_support_OES_float=!1:window.NO_support_OES_float=!0}Object.defineProperties(EV_E3mLayerManager.prototype,{scene:{get:function(){return this._scene}},selectedFeature:{get:function(){return this._selectedFeature},set:function(feature2){this._selectedFeature!==feature2&&(this._selectedFeature=feature2,this.featureSelectionChanged.raiseEvent(this._selectedFeature))}}});EV_E3mLayerManager.prototype.add=function(options){var layer=addEVLayer(this,options);return Cesium.defined(layer.scene)||(layer.scene=this._scene),layer};EV_E3mLayerManager.prototype.remove=function(name){if(name instanceof EV_E3MLayer_default){var layer=name;return removeLayer(this,layer)}return remove6(this,name)};EV_E3mLayerManager.prototype.removeAll=function(){var hash=getArray2(this);if(!hash)return!1;for(var values3=hash.values;values3.length>0;){var layer=values3[0],removedLayer=removeLayer(this,layer);if(!removedLayer)return!1}return!0};EV_E3mLayerManager.prototype.get=function(name){if(!Cesium.defined(name))throw new Cesium.DeveloperError("name is required.");var hash=getArray2(this);if(!Cesium.defined(hash))throw new Cesium.DeveloperError("name is error");var layer;if(typeof name=="string"){if(hash.contains(name))return layer=hash.get(name),Array.isArray(layer._name)?layer._cesiumLayer.getLayer(name):layer}else if(typeof name=="number"){var index=name,values3=hash.values;return layer=values3[index],Array.isArray(layer._name)?layer._cesiumLayer.getLayer(name):layer}return null};EV_E3mLayerManager.prototype.getLayerCount=function(){return this._e3ms.length};EV_E3mLayerManager.prototype.isLayerExits=function(name){var hash=getArray2(this);return hash?hash.contains(name):!1};EV_E3mLayerManager.prototype.getLayerCollection=function(){var collection=getArray2(this);return collection};EV_E3mLayerManager.prototype.getE3mLayer=function(layer){return getEVLayer2(this,layer)};function removeLayer(manager,layer){return!Cesium.defined(layer)||!Cesium.defined(layer.name)||!Cesium.defined(layer.url)?(console.warn("please check layer content. name and url is required!"),!1):remove6(manager,layer.name)}function remove6(manager,name){var layer=manager._e3ms.get(name),cesiumLayer=layer.getCesiumLayer();return manager._scene._primitives.remove(cesiumLayer),manager._e3ms.remove(name),layer&&manager.layerRemovedEvent.raiseEvent(layer),layer}function getArray2(manager){return manager._e3ms}function find3(manager,name){var layerHash=getArray2(manager);return layerHash.contains(name)?layerHash.get(name):null}function addEVLayer(manager,options){var name=options.name;if(!Cesium.defined(name))throw new Cesium.DeveloperError("name is required");var url=options.url;if(!Cesium.defined(url))throw new Cesium.DeveloperError("url is required");if(typeof name=="string"){if(Cesium.defined(find3(manager,name)))throw new Cesium.DeveloperError(name+"already exists")}else throw new Cesium.DeveloperError("name is required to be a string");var layer=new EV_E3MLayer_default(options);manager._primitives.add(layer.getCesiumLayer());var listeners=layer.layerShownOrHidden._listeners;listeners.length===0&&layer.layerShownOrHidden.addEventListener(function(layer2,index,show){layerShownOrHidden2(manager,layer2,index,show)}),listeners=layer.selectionChanged._listeners,listeners.length===0&&layer.selectionChanged.addEventListener(function(layer2,selectedFeatureName){layerSelectioned2(manager,layer2,selectedFeatureName)});var layerArray=getArray2(manager);return layerArray.set(name,layer),manager.layerAddedEvent.raiseEvent(layer),layer}function getEVLayer2(manager,layer){for(var hash=getArray2(manager),values3=hash.values,i=0;i<values3.length;i++){var evLayer=values3[i];if(evLayer.getCesiumLayer()===layer)return evLayer}return layer}function layerShownOrHidden2(manager,layer,index,show){var evLayer=layer;manager.layerShownOrHiddenEvent.raiseEvent(evLayer,show)}function layerSelectioned2(manager,layer,selectedFeatureName){manager.selectionChanged.raiseEvent(layer,selectedFeatureName)}EV_E3mLayerManager.prototype.getNearestTileProperty=function(showDistance){var camera=this.scene.camera,cameraPos=camera.position.clone(),dir=camera.direction.clone(),newP=Cesium.Cartesian3.multiplyByScalar(dir,5,new Cesium.Cartesian3);Cesium.Cartesian3.add(cameraPos,newP,cameraPos);for(var hash=this._e3ms,values3=hash.values,properties=[],i=0;i<values3.length;i++){var evLayer=values3[i],tileset=evLayer.getCesiumLayer();if(!(!Cesium.defined(tileset.flowLines)||!tileset.show))for(var selectedTiles=tileset.selectedTiles,j=0;j<selectedTiles.length;j++){var tile=selectedTiles[j],center2=tile.boundingSphere.center,distance12=Cesium.Cartesian3.distance(cameraPos,center2);if(distance12<tile.boundingSphere.radius+showDistance)if(Cesium.defined(tile.content._contents)){for(var contents=tile.content._contents,k=0;k<contents.length;k++)if(Cesium.defined(contents[k].flowLines))for(var l=0;l<contents[k].flowLines.length;l++){var lines=contents[k].flowLines[l],result=pointToLine(lines[0],lines[1],cameraPos);if(result.distance<showDistance&&pointIsVisible2(result.point,camera.frustum._offCenterFrustum._cullingVolume)){var info={};for(var obj in contents[k].batchTable._properties)info[obj]=contents[k].batchTable._properties[obj][l];info.result=result,properties.push(info)}}}else{var content=tile.content;if(Cesium.defined(content.flowLines))for(var l=0;l<content.flowLines.length;l++){var lines=content.flowLines[l],result=pointToLine(lines[0],lines[1],cameraPos);if(result.distance<showDistance&&pointIsVisible2(result.point,camera.frustum._offCenterFrustum._cullingVolume)){var info={};for(var obj in content.batchTable._properties)info[obj]=content.batchTable._properties[obj][l];info.result=result,properties.push(info)}}}}}return properties};function pointToLine(pt1,pt2,pt){var result={},egdeV1=Cesium.Cartesian3.subtract(pt2,pt1,new Cesium.Cartesian3),egdeV2=Cesium.Cartesian3.subtract(pt,pt1,new Cesium.Cartesian3),v1Nor=Cesium.Cartesian3.normalize(egdeV1,new Cesium.Cartesian3),v2Nor=Cesium.Cartesian3.normalize(egdeV2,new Cesium.Cartesian3),cos1=Cesium.Cartesian3.dot(v1Nor,v2Nor);if(cos1<=0)return result.distance=Cesium.Cartesian3.distance(pt,pt1,new Cesium.Cartesian3),result.point=pt1,result;var egdeV3=Cesium.Cartesian3.subtract(pt1,pt2,new Cesium.Cartesian3),egdeV4=Cesium.Cartesian3.subtract(pt,pt2,new Cesium.Cartesian3),v3Nor=Cesium.Cartesian3.normalize(egdeV3,new Cesium.Cartesian3),v4Nor=Cesium.Cartesian3.normalize(egdeV4,new Cesium.Cartesian3),cos2=Cesium.Cartesian3.dot(v3Nor,v4Nor);if(cos2<=0)return result.distance=Cesium.Cartesian3.distance(pt,pt2),result.point=pt2,result;var sin1=Math.sqrt(1-cos1*cos1),distance12=Cesium.Cartesian3.distance(pt,pt1),point4=new Cesium.Cartesian3;return Cesium.Cartesian3.multiplyByScalar(v1Nor,distance12*cos1,point4),Cesium.Cartesian3.add(pt1,point4,point4),result.distance=distance12*sin1,result.point=point4,result}function pointIsVisible2(position,cullingVolume){for(var planes=cullingVolume.planes,intersecting=!1,scratchPlane=new Cesium.Plane(new Cesium.Cartesian3(1,0,0),0),k=0,len=planes.length;k<len;++k){var plane=Cesium.Plane.fromCartesian4(planes[k],scratchPlane),center2=position,normal=plane.normal,distanceToPlane=Cesium.Cartesian3.dot(normal,center2)+plane.distance;if(distanceToPlane<=0)return!1;intersecting=!0}return intersecting}EV_E3mLayerManager.prototype.getNearestTileCentreLine=function(){for(var camera=this.scene.camera,cameraPos=camera.position,hash=this._e3ms,values3=hash.values,properties=[],i=0;i<values3.length;i++){var evLayer=values3[i],tileset=evLayer.getCesiumLayer();if(!(!Cesium.defined(tileset.flowLines)||!tileset.show))for(var selectedTiles=tileset.selectedTiles,j=0;j<selectedTiles.length;j++){var tile=selectedTiles[j],center2=tile.boundingSphere.center,distance12=Cesium.Cartesian3.distance(cameraPos,center2);if(distance12<tile.boundingSphere.radius)if(Cesium.defined(tile.content._contents)){for(var contents=tile.content._contents,k=0;k<contents.length;k++)if(Cesium.defined(contents[k].centreLine)){properties.push(contents[k].centreLine);break}}else Cesium.defined(tile.content.centreLine)&&properties.push(tile.content.centreLine)}}return properties};EV_E3mLayerManager.prototype.queryTile=function(positions){for(var hash=this._e3ms,values3=hash.values,properties=[],i=0;i<values3.length;i++){var evLayer=values3[i],tileset=evLayer.getCesiumLayer();if(!(!Cesium.defined(tileset.flowLines)||!tileset.show))for(var selectedTiles=tileset.selectedTiles,j=0;j<selectedTiles.length;j++){var tile=selectedTiles[j];if(isInboundingSphere(positions,tile.boundingSphere)){var property={};if(property.dataSet=evLayer.customTag.name,Cesium.defined(tile.content._contents)){property.content={};for(var contents=tile.content._contents,k=0;k<contents.length;k++)if(!!contents[k].centreLine){var result=lineIntersect2(positions,contents[k].centreLine);if(result.length>0){for(var l=0;l<result.length;l++){var index=result[l].index;for(var obj in contents[k].batchTable._properties)property.content[obj]=contents[k].batchTable._properties[obj][index]}properties.push(property)}}}else{if(!tile.content.centreLine)continue;var result=lineIntersect2(positions,tile.content.centreLine);if(result.length>0){property.content={};for(var l=0;l<result.length;l++){var index=result[l].index;for(var obj in tile.content.batchTable._properties)property.content[obj]=tile.content.batchTable._properties[obj][index]}properties.push(property)}}}}}return properties};function isInboundingSphere(positions,boundingSphere){for(var center2=boundingSphere.center,cart=Cesium.Cartographic.fromCartesian(center2),height2=Cesium.Cartographic.fromCartesian(positions[0]).height,position=Cesium.Cartesian3.fromRadians(cart.longitude,cart.latitude,height2),i=0;i<positions.length;i++){var pos=positions[i],distance12=Cesium.Cartesian3.distance(pos,position);if(distance12<boundingSphere.radius)return!0}return!1}function lineIntersect2(positions,lines){for(var result=[],coordinates=[],i=0;i<positions.length;i++){var cart=Cesium.Cartographic.fromCartesian(positions[i]),x2=turf_default.radiansToDegrees(cart.longitude),y2=turf_default.radiansToDegrees(cart.latitude);coordinates.push([x2,y2])}var cart=Cesium.Cartographic.fromCartesian(positions[0]),x2=turf_default.radiansToDegrees(cart.longitude),y2=turf_default.radiansToDegrees(cart.latitude);coordinates.push([x2,y2]);for(var polygon4=turf_default.polygon([coordinates]),i=0;i<lines.length;i++){for(var line=lines[i],coords=[],j=0;j<line.length;j+=3){var x2=turf_default.radiansToDegrees(line[j]),y2=turf_default.radiansToDegrees(line[j+1]);coords.push([x2,y2])}var turfLine=turf_default.lineString(coords),intersects7=turf_default.lineIntersect(polygon4,turfLine);intersects7.features.length>0&&result.push({index:i,intersects:intersects7})}return result}var EV_E3mLayerManager_default=EV_E3mLayerManager;function EVSelectorEventHandler(viewer2,evLayerManager){this._viewer=viewer2,this._evLayerManager=evLayerManager,this._eventHandler=new Cesium.ScreenSpaceEventHandler(viewer2.canvas),this._selectedFeature=void 0,this._selectedColor=new Cesium.Color(1,.5,.5,.8),this.eventTypes=[],this._silhouetteStage=void 0,this._edgeDetectionStage=void 0}Object.defineProperties(EVSelectorEventHandler.prototype,{selectedColor:{get:function(){return this._selectedColor},set:function(color){color instanceof Cesium.Color&&(this._selectedColor=color)}}});EVSelectorEventHandler.prototype.start=function(){start(this)};EVSelectorEventHandler.prototype.stop=function(){stop(this)};var selectedTileset=[],selectedCross=void 0,multConditions=[];EVSelectorEventHandler.prototype.startSelected=function(type,eventType){Cesium.defined(eventType)||(eventType=Cesium.ScreenSpaceEventType.LEFT_CLICK),this.eventTypes.indexOf(eventType)===-1&&this.eventTypes.push(eventType);var handler=this,viewer2=this._viewer,action=function(movement){var position;Cesium.defined(movement.endPosition)?position=movement.endPosition:position=movement.position;var pickedFeature=viewer2.scene.pick(position);if(!Cesium.defined(pickedFeature)){handler.clear();return}var evLayerManager=handler._evLayerManager;if(pickedFeature instanceof Cesium3DTileFeature_default){var cesiumTileset=pickedFeature.tileset,evLayer=evLayerManager.getE3mLayer(cesiumTileset);if(clearTileset(cesiumTileset),type===0){pickedFeature.primitive.colorBlendMode=Cesium.ColorBlendMode.HIGHLIGHT;var phaseType=pickedFeature.getProperty("phaseType"),id=pickedFeature.getProperty("id");if(Cesium.defined(phaseType)&&Cesium.defined(id)){var cssColor=handler._selectedColor.toCssColorString(),constr='${phaseType} === "'+phaseType+'" && ${id} ==='+id,con=[],conditions=[],lastCon=[];con.push(constr),con.push(cssColor),lastCon.push("true"),lastCon.push("color('white')"),conditions.push(con),conditions.push(lastCon),Cesium.defined(cesiumTileset.style)?(cesiumTileset.style.color={conditions},cesiumTileset._styleEngine._styleDirty=!0):cesiumTileset.style=new Cesium3DTileStyle_default({color:{conditions}})}else{var EVID=pickedFeature.getProperty("EVID");if(Cesium.defined(EVID)){var EVIDs=[];EVIDs.push(EVID),evLayer.setFeaturesColor("EVID",EVIDs,handler._selectedColor)}else{var propertyNames=pickedFeature.getPropertyNames();propertyNames.indexOf("name")!=-1&&propertyNames.indexOf("id")!=-1&&propertyNames.splice(propertyNames.indexOf("name"),1);for(var values3=[],len=pickedFeature.content._features.length,i=0;i<len;i++){var featureName=pickedFeature._content.batchTable.getProperty(i,propertyNames[0]);values3.indexOf(featureName)===-1&&values3.push(featureName)}evLayer.setFeaturesColor(propertyNames[0],values3,handler._selectedColor)}}}else if(type===1){pickedFeature.content instanceof Vector3DTileContent_default&&(pickedFeature.primitive.colorBlendMode=Cesium.ColorBlendMode.REPLACE);var propertyNames=pickedFeature.getPropertyNames();propertyNames.indexOf("name")!=-1&&propertyNames.indexOf("id")!=-1&&propertyNames.splice(propertyNames.indexOf("name"),1);for(var constr="",i=0;i<propertyNames.length;i++){var featureName=pickedFeature.getProperty(propertyNames[i]);typeof featureName=="number"?constr+="${"+propertyNames[i]+"} ==="+featureName+" && ":typeof featureName=="string"&&(constr+="${"+propertyNames[i]+'} ==="'+featureName+'" && ')}constr=constr.substr(0,constr.length-4);var cssColor=handler._selectedColor.toCssColorString(),con=[],conditions=[],lastCon=[];con.push(constr),con.push(cssColor),lastCon.push("true"),lastCon.push("color('white')"),conditions.push(con),conditions.push(lastCon),Cesium.defined(cesiumTileset.style)?(cesiumTileset.style.color={conditions},cesiumTileset._styleEngine._styleDirty=!0):cesiumTileset.style=new Cesium3DTileStyle_default({color:{conditions}})}else if(type===2){if(Cesium.PostProcessStageLibrary.isSilhouetteSupported(viewer2.scene)){Cesium.defined(handler._silhouetteStage)||(handler._edgeDetectionStage=Cesium.PostProcessStageLibrary.createEdgeDetectionStage(),handler._edgeDetectionStage.uniforms.color=handler._selectedColor,handler._edgeDetectionStage.uniforms.length=.01,handler._edgeDetectionStage.selected=[]),Cesium.defined(handler._silhouetteStage)||(handler._silhouetteStage=Cesium.PostProcessStageLibrary.createSilhouetteStage([handler._edgeDetectionStage]),viewer2.scene.postProcessStages.add(handler._silhouetteStage));var highlightedFeature=handler._edgeDetectionStage.selected[0];pickedFeature===highlightedFeature&&(handler._edgeDetectionStage.selected=[]),handler._edgeDetectionStage.selected=[pickedFeature]}}else if(type===3){if(Cesium.PostProcessStageLibrary.isSilhouetteSupported(viewer2.scene)){Cesium.defined(handler._silhouetteStage)||(handler._edgeDetectionStage=Cesium.PostProcessStageLibrary.createModelFeatureDetectionStage(viewer2),handler._edgeDetectionStage.uniforms.color=handler._selectedColor,handler._edgeDetectionStage.uniforms.outlineWidth=5,handler._edgeDetectionStage.edgeWidth=20,handler._edgeDetectionStage.uniforms.useAnimation=!1,handler._edgeDetectionStage.uniforms.length=.01,handler._edgeDetectionStage.selected=[]),Cesium.defined(handler._silhouetteStage)||(handler._silhouetteStage=Cesium.PostProcessStageLibrary.createSilhouetteStage([handler._edgeDetectionStage]),viewer2.scene.postProcessStages.add(handler._silhouetteStage));var highlightedFeature=handler._edgeDetectionStage.selected[0];pickedFeature===highlightedFeature&&(handler._edgeDetectionStage.selected=[]),handler._edgeDetectionStage.selected=[pickedFeature]}handler._eventHandler.setInputAction(function(movement2){var startpoint=viewer2.scene.pickPosition(position);if(!!Cesium.defined(startpoint)){var endpoint=Cesium.Cartesian3.add(startpoint,new Cesium.Cartesian3(5,0,0),new Cesium.Cartesian3),startscreen=Cesium.SceneTransforms.wgs84ToWindowCoordinates(viewer2.scene,startpoint,new Cesium.Cartesian2),endscreen=Cesium.SceneTransforms.wgs84ToWindowCoordinates(viewer2.scene,endpoint,new Cesium.Cartesian2),distanceSceen=Cesium.Cartesian2.distance(startscreen,endscreen);handler._edgeDetectionStage.uniforms.outlineWidth=distanceSceen}},Cesium.ScreenSpaceEventType.WHEEL)}evLayer.selectedFeature=pickedFeature,evLayerManager.selectedFeature=pickedFeature}else if(Cesium.defined(pickedFeature.primitive)&&Cesium.defined(pickedFeature.primitive.crossid)){var owner=pickedFeature.primitive.owner,evLayer=evLayerManager._crossDataSources.get(owner);Cesium.defined(selectedCross)&&evLayerManager._crossDataSources.get(selectedCross.owner).setSelectedColor(selectedCross.crossid,Cesium.Color.WHITE),evLayer.setSelectedColor(pickedFeature.primitive.crossid,handler._selectedColor),evLayerManager.selectedFeature=pickedFeature.primitive,selectedCross=pickedFeature.primitive}else handler.clear()};if(handler._eventHandler.setInputAction(action,eventType),type===1){var ctrlAction=function(movement){var position;Cesium.defined(movement.endPosition)?position=movement.endPosition:position=movement.position;var pickedFeature=viewer2.scene.pick(position);if(!Cesium.defined(pickedFeature)){handler.clear();return}var evLayerManager=handler._evLayerManager;if(pickedFeature instanceof Cesium3DTileFeature_default){var cesiumTileset=pickedFeature.tileset,evLayer=evLayerManager.getE3mLayer(cesiumTileset);if(clearTileset(cesiumTileset),type===1){var propertyNames=pickedFeature.getPropertyNames();propertyNames.indexOf("name")!=-1&&propertyNames.indexOf("id")!=-1&&propertyNames.splice(propertyNames.indexOf("name"),1);for(var constr="",i=0;i<propertyNames.length;i++){var featureName=pickedFeature.getProperty(propertyNames[i]);typeof featureName=="number"?constr+="${"+propertyNames[i]+"} ==="+featureName+" && ":typeof featureName=="string"&&(constr+="${"+propertyNames[i]+'} ==="'+featureName+'" && ')}constr=constr.substr(0,constr.length-4);var cssColor=handler._selectedColor.toCssColorString(),con=[],conditions=[],lastCon=[];con.push(constr),con.push(cssColor),multConditions.indexOf(con)===-1&&multConditions.push(con),lastCon.push("true"),lastCon.push("color('white')");for(var j=0;j<multConditions.length;j++)conditions.push(multConditions[j]);conditions.push(lastCon),Cesium.defined(cesiumTileset.style)?(cesiumTileset.style.color={conditions},cesiumTileset._styleEngine._styleDirty=!0):cesiumTileset.style=new Cesium3DTileStyle_default({color:{conditions}})}evLayer.selectedFeature=pickedFeature,evLayerManager.selectedFeature=pickedFeature}};handler._eventHandler.setInputAction(ctrlAction,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.KeyboardEventModifier.CTRL)}};EVSelectorEventHandler.prototype.clear=function(){for(var i=0;i<selectedTileset.length;i++)Cesium.defined(selectedTileset[i].style)&&selectedTileset[i].style.color&&(selectedTileset[i].style.color=void 0,selectedTileset[i]._styleEngine._styleDirty=!0);selectedTileset=[];var viewer2=this._viewer;Cesium.defined(this._silhouetteStage)&&(this._edgeDetectionStage.selected=[]),Cesium.defined(this._silhouetteStage)&&(viewer2.scene.postProcessStages.remove(this._silhouetteStage),this._edgeDetectionStage=void 0,this._silhouetteStage=void 0)};EVSelectorEventHandler.prototype.stopSelected=function(){for(var handler=this,i=0;i<handler.eventTypes.length;i++)handler._eventHandler.removeInputAction(handler.eventTypes[i]);handler.eventTypes=[];var viewer2=handler._viewer;Cesium.defined(handler._silhouetteStage)&&(handler._edgeDetectionStage.selected=[]),Cesium.defined(handler._silhouetteStage)&&(viewer2.scene.postProcessStages.remove(handler._silhouetteStage),handler._edgeDetectionStage=void 0,handler._silhouetteStage=void 0);var evLayerManager=this._evLayerManager;evLayerManager._selectedFeature=void 0};EVSelectorEventHandler.prototype.getPropertyNames=function(callBack){var handler=this;handler._eventHandler.setInputAction(function(movement){var position=movement.position,names,pickedFeature=viewer.scene.pick(position);return Cesium.defined(pickedFeature)&&pickedFeature instanceof Cesium3DTileFeature_default?callBack(pickedFeature.getPropertyNames()):callBack(void 0)},Cesium.ScreenSpaceEventType.LEFT_CLICK)};function start(handler){handler._eventHandler.setInputAction(function(movement){var viewer2=handler._viewer,position=movement.position;handler._actionType===Cesium.ScreenSpaceEventType.MOUSE_MOVE&&(position=movement.endPosition);var pickedFeature=viewer2.scene.pick(position);if(!Cesium.defined(pickedFeature)){for(var e3mLayers=handler._evLayerManager._e3ms._array,i=0;i<e3mLayers.length;i++){var evLayer=e3mLayers[i];evLayer.clearSelection(),handler._selectedFeature=void 0}return}handler._selectedFeature=pickedFeature;var evLayerManager=handler._evLayerManager;if(pickedFeature instanceof Cesium3DTileFeature_default||pickedFeature.cesium3DTileFeature){var featureName=pickedFeature.getProperty("name");if(featureName){var cesiumTileset=pickedFeature.tileset,evLayer=evLayerManager.getE3mLayer(cesiumTileset);evLayer&&evLayer.setSelectedComponentName&&featureName!==evLayer.getSelectedComponentName()&&(evLayer.setSelectedComponentName(featureName),evLayer.selectedFeature=pickedFeature)}}else evLayerManager.selectionChanged.raiseEvent(evLayer,pickedFeature.name)},Cesium.ScreenSpaceEventType.LEFT_CLICK)}function clearTileset(tileset){selectedTileset.indexOf(tileset)===-1&&selectedTileset.push(tileset);for(var i=0;i<selectedTileset.length;i++)Cesium.defined(selectedTileset[i].style)&&selectedTileset[i].style.color&&(selectedTileset[i].style.color=void 0,selectedTileset[i]._styleEngine._styleDirty=!0)}function stop(handler){handler._eventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),handler._selectedFeature=void 0}var EV_SelectorEventHandler_default=EVSelectorEventHandler;var VERSION="1.96";return __toCommonJS(CesiumExternal_exports);})();
